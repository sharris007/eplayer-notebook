define("core/include", ["./Account", "./WebPDF", "./UserConfig", "./Viewer", "./Framework/Config", "./Framework/ReaderApp", "./uupaa-color.mini", "./uupaa-excanvas", "./Common/Environment", "./Common/Support", "./Common/Math/Rect", "./Common/Math/Point", "./Common/Math/JSMap", "./Common/Math/Matrix", "./Common/CommonDialog", "./Tools/Tools", "./Plugins/Action/PDFDestination", "./Framework/View/MainFrame", "./Framework/View/PDFDocView", "./Framework/View/PDFPageView", "./Framework/View/PDFView", "./Plugins/Annot/DrawingAnnot/DrawingUtils", "./Framework/View/LayoutInfo", "./Framework/View/ProgressiveViewerGenerator", "./Framework/View/PDFContinuousView", "./Framework/View/PDFSinglePageView", "./Framework/View/PDFFacingPageView", "./Common/ServerService", "./Common/apis", "./Common/ajax/index", "./Common/ajax/AjaxEndpoint", "./Common/ajax/polyfill", "./Common/ajax/template", "./Common/ajax/Ajax", "./Common/ajax/FilterChain", "./Common/ajax/utils", "./Common/ajax/errors", "./Common/ajax/commonAjaxFilters", "./Framework/View/SinglePageViewLayout", "./Common/Common", "./Interface/IMainFrmEventHandler", "./Interface/IMousePtHander", "./Tools/HandToolHandler", "./Plugins/Menu/MenuItem", "./Plugins/Text/TextManager", "./Plugins/Text/PDFTextObject", "./Plugins/Text/PDFTextPage", "./Plugins/Offline/OfflineFileCache", "./WebStorage", "./Framework/DataControls", "./Framework/JSDataControls", "./Framework/ServerDataControls", "./ImageEngine/ImageLazyLoad", "./Plugins/PDFJS/pdfjs", "./Plugins/PDFJS/app", "./Plugins/PDFJS/color", "./Plugins/PDFJS/field", "./Plugins/Form/service/PDFFormConstants", "./Plugins/PDFJS/doc", "./Plugins/PDFJS/utils", "./Plugins/Loupe/LoupePlugin", "./Plugins/Loupe/LoupeToolHandler", "./Plugins/Loupe/LoupeView", "./Plugins/Loupe/LoupeDlg", "./ImageEngine/ImageTitlesLazyLoad", "./Plugins/MarqueeTool/MarqueeToolPlugin", "./Plugins/MarqueeTool/MarqueeToolHandler", "./Plugins/MarqueeTool/MarqueeToolService", "./Plugins/MarqueeTool/MarqueeToolView", "./Plugins/TextSelection/PDFTextSelectTool", "./Plugins/TextSelection/PDFTextPageSelect", "./Plugins/Print/PrintConfig", "./Plugins/Navigation/NavigationComponent", "./Plugins/Navigation/MobileNavigationView", "./Plugins/Navigation/PCNavigationView", "./Plugins/Thumbnail/thumbnailController", "./Plugins/Thumbnail/thumbnailView_mobile", "./Plugins/Thumbnail/thumbnailView_pc", "./Plugins/Bookmark/BookmarkController", "./Plugins/Bookmark/Bookmarkns", "./Plugins/Bookmark/BookmarkListView", "./Plugins/Bookmark/BookmarkTreeView", "./Plugins/Bookmark/BookmarkService", "./Plugins/Bookmark/PDFBookmark", "./Plugins/Bookmark/PDFBookmarkInfo", "./Plugins/Bookmark/BookmarkLoader", "./Plugins/Action/PDFGoToAction", "./Plugins/DocProperties/DocPropertiesPlugin", "./Plugins/Form/FormPlugin", "./Plugins/Form/service/PDFForm", "./Plugins/Form/service/PDFFormField", "./Plugins/Form/service/PDFFormControl", "./Plugins/Form/view/formViewer", "./Plugins/Form/view/baseControlView", "./Plugins/TextSelection/TextSelectComponent", "./Plugins/TextSelection/TextSelectToolHandler", "./Plugins/TextSelection/TextSelectView", "./Plugins/TextSelection/TextSelectService", "./Plugins/Menu/MenuPlugin", "./Plugins/FindTool/SearchComponent", "./Plugins/FindTool/MobileSearchView", "./Common/Interface", "./Plugins/FindTool/SearchView", "./Plugins/FindTool/PCSearchView", "./Plugins/FindTool/SearchService", "./Plugins/FindTool/SearchResult", "./Plugins/Annot/BaseAnnotPlugin", "./Plugins/Annot/PDFAnnot", "./Plugins/Annot/Annot", "./Plugins/Annot/AnnotHandleManager", "./Plugins/Annot/AnnotUIManager", "./Common/CanvasUtils", "./Plugins/Annot/PDFAnnotationLoader", "./Plugins/Annot/MarkupAnnotHandler", "./Plugins/Annot/PopupMousePtHandler", "./Plugins/Annot/PDFTypewriter", "./Plugins/Annot/CommentAnnot/CommentAnnotHandler", "./Plugins/Annot/CommentAnnot/CommentAnnotService", "./Plugins/Annot/CommentAnnot/CommentAnnotView", "./Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", "./Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", "./Plugins/Annot/DrawingPropertyDlg", "./Plugins/Annot/LinkAnnotHandler", "./Plugins/Annot/TextAnnotHandler", "./Plugins/Annot/TextAnnotView", "./Plugins/Annot/TextAnnotService", "./Plugins/Annot/TypewriterAnnotHandler", "./Plugins/Annot/TypewriterAnnotView", "./Plugins/Annot/TypewriterAnnotService", "./Plugins/Annot/CalloutAnnotHandler", "./Plugins/Annot/CalloutAnnotView", "./Plugins/Annot/CalloutAnnotService", "./Plugins/Annot/TextboxAnnotHandler", "./Plugins/Annot/TextboxAnnotView", "./Plugins/Annot/TextboxAnnotService", "./Plugins/Annot/DrawingAnnot/DrawingAnnotService", "./Plugins/Annot/DrawingAnnot/InkAnnotHandler", "./Plugins/Annot/DrawingAnnot/InkAnnotView", "./Plugins/Annot/DrawingAnnot/DrawingAnnotView", "./Common/CoordinateUtils", "./Plugins/Annot/DrawingAnnot/DrawingAnnotHandler", "./Plugins/Annot/DrawingAnnot/CircleAnnotView", "./Plugins/Annot/DrawingAnnot/PolygonAnnotView", "./Plugins/Annot/DrawingAnnot/PolygonAnnotService", "./Plugins/Annot/DrawingAnnot/SquareAnnotView", "./Plugins/Annot/DrawingAnnot/LineAnnotView", "./Plugins/Annot/DistanceAnnot/DistanceAnnotView", "./Plugins/Annot/DistanceAnnot/common", "./Plugins/Annot/DistanceAnnot/units", "./Plugins/Annot/DistanceAnnot/DistanceScale", "./Plugins/Annot/DrawingAnnot/LineAnnotHandler", "./Plugins/Annot/DistanceAnnot/DistanceAnnotHandler", "./Plugins/Annot/CommonMarkupAnnotHandler", "./Plugins/Annot/StampAnnotHandler", "./Plugins/Annot/ImageAnnot/ImageAnnotHandler", "./Plugins/Annot/Undo/AnnotUndo", "./Plugins/Annot/AnnotMousePtHandler", "./Plugins/Annot/AnnotSelectionTool", "./Plugins/Annot/TextAnnotToolHandler", "./Plugins/Annot/AnnotFactory", "./Plugins/Annot/PDFMarkup", "./Plugins/Annot/CommentAnnot/CommentAnnot", "./Plugins/Annot/PDFLink", "./Plugins/Action/Action", "./Plugins/Annot/PDFInk", "./Plugins/Annot/PDFCallout", "./Plugins/Annot/PDFTextBox", "./Plugins/Annot/ImageAnnot/PDFImage", "./Plugins/Signature/PDFSignature", "./Plugins/InkSign/PDFInkSign", "./Plugins/Annot/DrawingAnnot/PDFCircle", "./Plugins/Annot/DrawingAnnot/PDFSquare", "./Plugins/Annot/DrawingAnnot/PDFPolygon", "./Plugins/Annot/DrawingAnnot/PDFLine", "./Plugins/Annot/AnnotCommonView", "./Plugins/Annot/TypewriterAnnotToolHandler", "./Plugins/Annot/TextboxAnnotToolHandler", "./Plugins/Annot/CalloutAnnotToolHandler", "./Plugins/Annot/ImageAnnot/ImageAnnotToolHandler", "./Plugins/Annot/StampAnnotToolHandler", "./Plugins/Annot/PDFStamp", "./Plugins/Annot/DrawingAnnot/DrawingAnnotToolHandler", "./Plugins/Annot/DrawingAnnot/CircleTools", "./Plugins/Annot/DrawingAnnot/SquareTools", "./Plugins/Annot/DrawingAnnot/LineTools", "./Plugins/Annot/DistanceAnnot/DistanceLineTool", "./Plugins/Annot/DrawingAnnot/PolygonTools", "./Plugins/Annot/DistanceAnnot/DistanceAnnotToolHandler", "./Plugins/Annot/DistanceAnnot/DistanceRulerView", "./Plugins/Annot/DistanceAnnot/RulerView", "./Plugins/Annot/DistanceAnnot/Ruler", "./Plugins/Annot/DistanceAnnot/DistanceToolPopup", "./Plugins/Annot/CommentAnnot/CommentAnnotToolHandler", "./Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotToolHandler", "./Plugins/Annot/DrawingAnnot/InkAnnotToolHandler", "./Plugins/Annot/DrawingAnnot/InkTools", "./Plugins/CommentList/CommentListPlugin", "./Plugins/CommentList/CommentListService", "./Plugins/CommentList/MobileCommentListView", "./Plugins/CommentList/CommentListView", "./Plugins/CommentList/PCCommentListView", "./Plugins/Signature/SignaturePlugin", "./Plugins/Signature/SignatureView", "./Plugins/Signature/SignatureService", "./Plugins/Signature/NormalSigToolHandler", "./Plugins/Signature/StraddleSigToolHandler", "./Plugins/Signature/SignatureMouseHandler", "./Plugins/InkSign/InkSignPlugin", "./Plugins/InkSign/InkSignToolHandler", "./Plugins/InkSign/PDFInkSignLoader", "./Plugins/InkSign/MobileInkSignView", "./Plugins/InkSign/InkSignView", "./Plugins/InkSign/PCInkSignView", "./Plugins/InkSign/InkSignService", "./Plugins/PanAndZoom/panAndZoomPlugin", "./Plugins/PanAndZoom/panAndZoomView", "./Plugins/PanAndZoom/panAndZoomMousePtHandler", "./Plugins/Snapshot/SnapshotPlugin", "./Plugins/Snapshot/SnapshotToolHandler", "./Interface/IReaderToolHandler", "./Interface/IReaderPlugin", "./Common/Event", "./Framework/File/FileUtils", "./Plugins/Annot/Stamp/StampListManager", "./Plugins/Annot/Stamp/StampList", "./Plugins/Annot/Stamp/StampView", "./Plugins/InkSign/InkSignListManager", "./Plugins/Annot/ImageAnnot/ImageAnnotPlugin", "./Plugins/InkSign/PCInkSign", "./Common/WriteCanvasTool", "./Plugins/InkSign/MobileInkSign", "./Framework/DocumentLoader", "./Framework/PDFDocument", "./Framework/PDFPage", "./Plugins/Annot/Undo/AnnotUndoStack", "./Plugins/DocProperties/PDFDocProperties", "./Plugins/DocProperties/DocProperties", "./ImageEngine/ImagePageViewRender", "./ImageEngine/ImageEngine", "./Framework/AjaxRetryManager", "./ImageEngine/JSImagePageViewRender", "./ImageEngine/ServerImagePageViewRender"], function(a, b, c) {
        a("./Account"), a("./Viewer")
    }), define("core/Account", ["core/WebPDF", "core/UserConfig"], function(a, b, c) {
        var d = a("core/WebPDF");
        a("core/UserConfig"), d.Account = function(a, b) {
            function c() {
                d.ViewerInstance.on(d.EventList.USER_LOGIN_STATE_CHANGED, function(a, b) {
                    i = b.isLogin, e = b.email, f = b.userId, g = b.accessToken, null == l && (l = new d.UserConfig(j)), l.getConfig(f, e, Configs.defaults, null, null), d.ViewerInstance.updateUserData()
                })
            }
            var e = "",
                f = "",
                g = "",
                h = null,
                i = !1,
                j = a,
                k = null;
            "undefined" != typeof d.ConnectPdf && (k = new d.LoginProcessor(b));
            var l = null;
            c(), this.getUserAccount = function() {
                return k && k.isSignIn() ? k.getUserAccount() : e
            }, this.setUserAccount = function(a) {
                e = a
            }, this.getUserId = function() {
                return k && k.isSignIn() ? k.getUserId() : f
            }, this.setUserId = function(a) {
                f = a
            }, this.getAccessToken = function() {
                return k ? k.getAccessToken() : g
            }, this.isLogin = function() {
                return k ? k.isSignIn() : i
            }, this.setLoginState = function(a) {
                i = a
            }, this.setAccessToken = function(a) {
                a && $.ajaxSetup({
                    headers: {
                        accessToken: a
                    }
                }), g = a
            }, this.getLoginProcessor = function() {
                return k
            }, this.getUserConfig = function() {
                return _readerApp.isOffline() ? Configs.defaults : l ? l.getUserConfig() : null
            }, this.initUserConfig = function(a, b, c) {
                null == l && (l = new d.UserConfig(j)), l.getConfig(f, e, a, c)
            }, this.setWatermarkInfo = function(a) {
                h = a
            }, this.getWatermarkInfo = function() {
                return h
            }
        }, d.createAccount = function(a, b) {
            var c = new d.Account(a, b);
            return d.AccountInstance = c, c
        }
    }),
    function() {
        if (!window.WebPDF) {
            "undefined" == typeof console && (window.console = {
                log: function() {},
                warn: function() {},
                error: function() {}
            });
            var a = {
                document: {
                    getDocument: function() {
                        return {
                            type: "default"
                        }
                    },
                    exportDocument: function() {
                        return {
                            type: "default"
                        }
                    }
                },
                signature: {
                    getSignature: function() {
                        return {
                            type: "default"
                        }
                    },
                    getContents: function() {
                        return {
                            type: "default"
                        }
                    },
                    exportSignedDocument: function() {
                        return {
                            type: "default"
                        }
                    },
                    getSignedDocument: function() {
                        return {
                            type: "default"
                        }
                    }
                },
                form: {
                    importForm: function() {
                        return {
                            type: "default"
                        }
                    },
                    exportForm: function() {
                        return {
                            type: "default"
                        }
                    }
                },
                user: {
                    getUserInfo: function() {
                        return {
                            type: "default"
                        }
                    },
                    getUserPermission: function() {
                        return {
                            type: "default"
                        }
                    }
                }
            };
            window.WebPDF = {
                version: "2.2.0",
                timestamp: "2017-12-25 20",
                optionParameters: {
                    scrollBarType: 0
                },
                baseUrl: getBaseUrl(),
                serverBaseUrl: getBaseUrl(),
                ready: function(b, c) {
                    $.extend(!0, a, apiConfig), apiConfig = a;
                    var d = arguments[2],
                        e = new Promise(function(a, e) {
                            var f = {
                                lng: c.language,
                                load: "current",
                                useCookie: !1,
                                useDataAttrOptions: !0,
                                defaultValueFromfContent: !1,
                                fallbackLng: !1,
                                useLocalStorage: !1,
                                localStorageExpirationTime: 864e5,
                                resGetPath: "../__ns__-__lng__.json"
                            };
                            i18n.init(f, function(e) {
                                $("body").i18n(), WebPDF.optionParameters = $.extend(WebPDF.optionParameters, c);
                                var f = !0,
                                    g = WebPDF.baseUrl + "/eplayer/pdf/foxit_client_lib/webpdf.mini.js";
                                f ? d && (g = WebPDF.baseUrl + "/eplayer/pdf/foxit_client_lib/webpdf.mini.js") : g = d ? WebPDF.baseUrl + "/scripts/core/main.js" : WebPDF.baseUrl + "/scripts/core/include.js", seajs.use([g], function(c) {
                                    WebPDF.createViewer(b, WebPDF.optionParameters), WebPDF.createAccount(WebPDF.optionParameters.serverBaseUrl, WebPDF.optionParameters.language), !WebPDF.Environment.mobile && WebPDF.JsPlugin ? WebPDF.JsPlugin.loadAllPlugins().then(function() {
                                        a()
                                    }) : a(), setTimeout(function() {
                                        $(WebPDF).trigger(WebPDF.EventList.APP_READY, {})
                                    }, 200)
                                })
                            })
                        });
                    return e
                },
                onReady: function(a) {
                    $(WebPDF).on("appReady", function(b) {
                        $.isFunction(a) && a(b)
                    })
                }
            }
        }
    }(), define("core/WebPDF", [], function(a, b, c) {
        return window.WebPDF
    }), define("core/UserConfig", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.UserConfig = function(a) {
            function b(a) {
                if (null === e) return e = $.extend(e, a), !1;
                var b = !1;
                if (e.userId = a.userId, e.userName = a.userName, e.inkSignList.length > 0) {
                    b = !0;
                    for (var c = 0; c < a.inkSignList.length; c++) 1 == a.inkSignList[c].def && (a.inkSignList[c].def = 0)
                }
                return $.merge(e.inkSignList, a.inkSignList), e.annot.highLight.clr !== Configs.AnnotProperty.highLight.clr ? b = !0 : e.annot.highLight.clr = a.annot.highLight.clr, e.annot.underLine.clr !== Configs.AnnotProperty.underLine.clr ? b = !0 : e.annot.underLine.clr = a.annot.underLine.clr, e.annot.pencil.clr !== Configs.AnnotProperty.pencil.clr ? b = !0 : e.annot.pencil.clr = a.annot.pencil.clr, e.annot.typeWriter.clr !== Configs.AnnotProperty.typeWriter.clr ? b = !0 : e.annot.typeWriter.clr = a.annot.typeWriter.clr, e.annot.callout.clr !== Configs.AnnotProperty.callout.clr ? b = !0 : e.annot.callout.clr = a.annot.callout.clr, e.annot.circle.clr !== Configs.AnnotProperty.circle.clr ? b = !0 : e.annot.circle.clr = a.annot.circle.clr, e.annot.square.clr !== Configs.AnnotProperty.square.clr ? b = !0 : e.annot.square.clr = a.annot.square.clr, e.annot.line.clr !== Configs.AnnotProperty.line.clr ? b = !0 : e.annot.line.clr = a.annot.line.clr, e.annot.distance && (e.annot.distance.clr !== Configs.AnnotProperty.distance.clr ? b = !0 : e.annot.distance.clr = a.annot.distance.clr), b
            }

            function c() {
                var a = e.userId;
                if (null !== a && "Anonymous" != a && 0 !== a) {
                    var b = f + "api/systemuser/userconfig/save",
                        c = {
                            id: a,
                            userName: e.userName,
                            userConfig: JSON.stringify(e)
                        };
                    $.ajax({
                        type: "post",
                        url: b,
                        dataType: "json",
                        data: c,
                        success: function(a) {},
                        error: function(a) {}
                    })
                }
            }
            var e = null,
                f = a;
            this.getUserConfig = function() {
                return e
            }, this.getConfig = function(a, e, g, h) {
                if (d.Tool.getReaderApp().isOffline()) return void($.isFunction(h) && h());
                var i = f + "api/systemuser/userconfig/info?" + Math.random(),
                    j = {
                        id: a
                    };
                $.ajax({
                    type: "GET",
                    url: i,
                    dataType: "json",
                    data: j,
                    success: function(f) {
                        if (0 === f.error) {
                            var i = $.parseJSON(f.data);
                            null == i ? i = {
                                userId: a,
                                userName: e
                            } : (void 0 === i.userId && (i.userId = a), void 0 === i.userName && (i.userName = e)), i = $.extend(!0, {}, g, i);
                            var j = !1;
                            j = b(i), j && c(), d.ViewerInstance.fire(d.EventList.USER_CONFIG_CHANGED, null), $.isFunction(h) && h()
                        }
                    },
                    error: function(a) {
                        $.isFunction(h) && h()
                    }
                })
            }
        }
    }), define("core/Viewer", ["core/WebPDF", "core/Framework/Config", "core/Framework/ReaderApp", "core/uupaa-color.mini", "core/uupaa-excanvas", "core/Common/Environment", "core/Common/Support", "core/Common/Math/Rect", "core/Common/Math/Point", "core/Common/Math/JSMap", "core/Common/Math/Matrix", "core/Common/CommonDialog", "core/Tools/Tools", "core/Plugins/Action/PDFDestination", "core/Framework/View/MainFrame", "core/Framework/View/PDFDocView", "core/Framework/View/PDFPageView", "core/Framework/View/PDFView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Framework/View/LayoutInfo", "core/Framework/View/ProgressiveViewerGenerator", "core/Framework/View/PDFContinuousView", "core/Framework/View/PDFSinglePageView", "core/Framework/View/PDFFacingPageView", "core/Common/ServerService", "core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters", "core/Framework/View/SinglePageViewLayout", "core/Common/Common", "core/Interface/IMainFrmEventHandler", "core/Interface/IMousePtHander", "core/Tools/HandToolHandler", "core/Plugins/Menu/MenuItem", "core/Plugins/Text/TextManager", "core/Plugins/Text/PDFTextObject", "core/Plugins/Text/PDFTextPage", "core/Plugins/Offline/OfflineFileCache", "core/WebStorage", "core/Framework/DataControls", "core/Framework/JSDataControls", "core/Framework/ServerDataControls", "core/ImageEngine/ImageLazyLoad", "core/Plugins/PDFJS/pdfjs", "core/Plugins/PDFJS/app", "core/Plugins/PDFJS/color", "core/Plugins/PDFJS/field", "core/Plugins/Form/service/PDFFormConstants", "core/Plugins/PDFJS/doc", "core/Plugins/PDFJS/utils", "core/Plugins/Loupe/LoupePlugin", "core/Plugins/Loupe/LoupeToolHandler", "core/Plugins/Loupe/LoupeView", "core/Plugins/Loupe/LoupeDlg", "core/ImageEngine/ImageTitlesLazyLoad", "core/Plugins/MarqueeTool/MarqueeToolPlugin", "core/Plugins/MarqueeTool/MarqueeToolHandler", "core/Plugins/MarqueeTool/MarqueeToolService", "core/Plugins/MarqueeTool/MarqueeToolView", "core/Plugins/TextSelection/PDFTextSelectTool", "core/Plugins/TextSelection/PDFTextPageSelect", "core/Plugins/Print/PrintConfig", "core/Plugins/Navigation/NavigationComponent", "core/Plugins/Navigation/MobileNavigationView", "core/Plugins/Navigation/PCNavigationView", "core/Plugins/Thumbnail/thumbnailController", "core/Plugins/Thumbnail/thumbnailView_mobile", "core/Plugins/Thumbnail/thumbnailView_pc", "core/Plugins/Bookmark/BookmarkController", "core/Plugins/Bookmark/Bookmarkns", "core/Plugins/Bookmark/BookmarkListView", "core/Plugins/Bookmark/BookmarkTreeView", "core/Plugins/Bookmark/BookmarkService", "core/Plugins/Bookmark/PDFBookmark", "core/Plugins/Bookmark/PDFBookmarkInfo", "core/Plugins/Bookmark/BookmarkLoader", "core/Plugins/Action/PDFGoToAction", "core/Plugins/DocProperties/DocPropertiesPlugin", "core/Plugins/Form/FormPlugin", "core/Plugins/Form/service/PDFForm", "core/Plugins/Form/service/PDFFormField", "core/Plugins/Form/service/PDFFormControl", "core/Plugins/Form/view/formViewer", "core/Plugins/Form/view/baseControlView", "core/Plugins/TextSelection/TextSelectComponent", "core/Plugins/TextSelection/TextSelectToolHandler", "core/Plugins/TextSelection/TextSelectView", "core/Plugins/TextSelection/TextSelectService", "core/Plugins/Menu/MenuPlugin", "core/Plugins/FindTool/SearchComponent", "core/Plugins/FindTool/MobileSearchView", "core/Common/Interface", "core/Plugins/FindTool/SearchView", "core/Plugins/FindTool/PCSearchView", "core/Plugins/FindTool/SearchService", "core/Plugins/FindTool/SearchResult", "core/Plugins/Annot/BaseAnnotPlugin", "core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/Plugins/Annot/AnnotHandleManager", "core/Plugins/Annot/AnnotUIManager", "core/Common/CanvasUtils", "core/Plugins/Annot/PDFAnnotationLoader", "core/Plugins/Annot/MarkupAnnotHandler", "core/Plugins/Annot/PopupMousePtHandler", "core/Plugins/Annot/PDFTypewriter", "core/Plugins/Annot/CommentAnnot/CommentAnnotHandler", "core/Plugins/Annot/CommentAnnot/CommentAnnotService", "core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", "core/Plugins/Annot/DrawingPropertyDlg", "core/Plugins/Annot/LinkAnnotHandler", "core/Plugins/Annot/TextAnnotHandler", "core/Plugins/Annot/TextAnnotView", "core/Plugins/Annot/TextAnnotService", "core/Plugins/Annot/TypewriterAnnotHandler", "core/Plugins/Annot/TypewriterAnnotView", "core/Plugins/Annot/TypewriterAnnotService", "core/Plugins/Annot/CalloutAnnotHandler", "core/Plugins/Annot/CalloutAnnotView", "core/Plugins/Annot/CalloutAnnotService", "core/Plugins/Annot/TextboxAnnotHandler", "core/Plugins/Annot/TextboxAnnotView", "core/Plugins/Annot/TextboxAnnotService", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService", "core/Plugins/Annot/DrawingAnnot/InkAnnotHandler", "core/Plugins/Annot/DrawingAnnot/InkAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotHandler", "core/Plugins/Annot/DrawingAnnot/CircleAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Plugins/Annot/DrawingAnnot/SquareAnnotView", "core/Plugins/Annot/DrawingAnnot/LineAnnotView", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotView", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DrawingAnnot/LineAnnotHandler", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotHandler", "core/Plugins/Annot/CommonMarkupAnnotHandler", "core/Plugins/Annot/StampAnnotHandler", "core/Plugins/Annot/ImageAnnot/ImageAnnotHandler", "core/Plugins/Annot/Undo/AnnotUndo", "core/Plugins/Annot/AnnotMousePtHandler", "core/Plugins/Annot/AnnotSelectionTool", "core/Plugins/Annot/TextAnnotToolHandler", "core/Plugins/Annot/AnnotFactory", "core/Plugins/Annot/PDFMarkup", "core/Plugins/Annot/CommentAnnot/CommentAnnot", "core/Plugins/Annot/PDFLink", "core/Plugins/Action/Action", "core/Plugins/Annot/PDFInk", "core/Plugins/Annot/PDFCallout", "core/Plugins/Annot/PDFTextBox", "core/Plugins/Annot/ImageAnnot/PDFImage", "core/Plugins/Signature/PDFSignature", "core/Plugins/InkSign/PDFInkSign", "core/Plugins/Annot/DrawingAnnot/PDFCircle", "core/Plugins/Annot/DrawingAnnot/PDFSquare", "core/Plugins/Annot/DrawingAnnot/PDFPolygon", "core/Plugins/Annot/DrawingAnnot/PDFLine", "core/Plugins/Annot/AnnotCommonView", "core/Plugins/Annot/TypewriterAnnotToolHandler", "core/Plugins/Annot/TextboxAnnotToolHandler", "core/Plugins/Annot/CalloutAnnotToolHandler", "core/Plugins/Annot/ImageAnnot/ImageAnnotToolHandler", "core/Plugins/Annot/StampAnnotToolHandler", "core/Plugins/Annot/PDFStamp", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/CircleTools", "core/Plugins/Annot/DrawingAnnot/SquareTools", "core/Plugins/Annot/DrawingAnnot/LineTools", "core/Plugins/Annot/DistanceAnnot/DistanceLineTool", "core/Plugins/Annot/DrawingAnnot/PolygonTools", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotToolHandler", "core/Plugins/Annot/DistanceAnnot/DistanceRulerView", "core/Plugins/Annot/DistanceAnnot/RulerView", "core/Plugins/Annot/DistanceAnnot/Ruler", "core/Plugins/Annot/DistanceAnnot/DistanceToolPopup", "core/Plugins/Annot/CommentAnnot/CommentAnnotToolHandler", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/InkAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/InkTools", "core/Plugins/CommentList/CommentListPlugin", "core/Plugins/CommentList/CommentListService", "core/Plugins/CommentList/MobileCommentListView", "core/Plugins/CommentList/CommentListView", "core/Plugins/CommentList/PCCommentListView", "core/Plugins/Signature/SignaturePlugin", "core/Plugins/Signature/SignatureView", "core/Plugins/Signature/SignatureService", "core/Plugins/Signature/NormalSigToolHandler", "core/Plugins/Signature/StraddleSigToolHandler", "core/Plugins/Signature/SignatureMouseHandler", "core/Plugins/InkSign/InkSignPlugin", "core/Plugins/InkSign/InkSignToolHandler", "core/Plugins/InkSign/PDFInkSignLoader", "core/Plugins/InkSign/MobileInkSignView", "core/Plugins/InkSign/InkSignView", "core/Plugins/InkSign/PCInkSignView", "core/Plugins/InkSign/InkSignService", "core/Plugins/PanAndZoom/panAndZoomPlugin", "core/Plugins/PanAndZoom/panAndZoomView", "core/Plugins/PanAndZoom/panAndZoomMousePtHandler", "core/Plugins/Snapshot/SnapshotPlugin", "core/Plugins/Snapshot/SnapshotToolHandler", "core/Interface/IReaderToolHandler", "core/Interface/IReaderPlugin", "core/Common/Event", "core/Framework/File/FileUtils", "core/Plugins/Annot/Stamp/StampListManager", "core/Plugins/Annot/Stamp/StampList", "core/Plugins/Annot/Stamp/StampView", "core/Plugins/InkSign/InkSignListManager", "core/Plugins/Annot/ImageAnnot/ImageAnnotPlugin", "core/Plugins/InkSign/PCInkSign", "core/Common/WriteCanvasTool", "core/Plugins/InkSign/MobileInkSign", "core/Framework/DocumentLoader", "core/Framework/PDFDocument", "core/Framework/PDFPage", "core/Plugins/Annot/Undo/AnnotUndoStack", "core/Plugins/DocProperties/PDFDocProperties", "core/Plugins/DocProperties/DocProperties", "core/ImageEngine/ImagePageViewRender", "core/ImageEngine/ImageEngine", "core/Framework/AjaxRetryManager", "core/ImageEngine/JSImagePageViewRender", "core/ImageEngine/ServerImagePageViewRender"], function(a, b, c) {
        var d = a("core/WebPDF"),
            e = a("core/Framework/Config"),
            f = a("core/Framework/ReaderApp"),
            g = a("core/Common/ServerService");
            sv = a("core/Plugins/FindTool/SearchView");
            ss = a("core/Plugins/FindTool/SearchService");
        a("core/Common/Common"), a("core/Common/Event");
        var h = a("core/Framework/File/FileUtils");
        d.Viewer = function(b, c) {
            function i() {
                return null == r.getMainView() ? null : r.getMainView().getDocView()
            }

            function i() {
                return null === r || null == r.getMainView() ? null : r.getMainView().getDocView()
            }

            function j() {
                var a = function(a) {
                    if (a) d.Engine.JR ? d.ViewerInstance.openFileByBuffer(r.getPDFbuffer(), r.getFileName(), r.getOptions().url) : d.ViewerInstance.openFile(r.getOptions().url);
                    else {
                        var b = r.getFileID();
                        if (null === b || void 0 === b) return;
                        var e = c.baseUrl + "api/systemuser/" + b + "/userdata/clear";
                        $.ajax({
                            url: e,
                            type: "POST",
                            headers: {
                                "x-auth-doc": r.getPDFPassword()
                            },
                            success: function(a) {},
                            error: function(a) {}
                        })
                    }
                    d.endConfirm()
                };
                d.confirm(null, null, i18n.t("Login.UserDataLoadingTips"), null, null, a)
            }

            function k(a, b, c, e, f, g, h) {
                d.AccountInstance && (d.AccountInstance.setUserAccount(c), d.AccountInstance.setUserId(b), d.AccountInstance.setAccessToken(e), d.AccountInstance.setLoginState(a), d.AccountInstance.initUserConfig(Configs.defaults, f, h))
            }

            function l() {
                return d.Environment.ie8OrLower || d.Environment.ie9Compact ? (d.alert(null, null, i18n.t("Compatible.IE9orLower")), !1) : !0
            }

            function m(a) {
                switch (a = (a + "").toLowerCase()) {
                    case "title":
                        return "title";
                    case "author":
                        return "atr";
                    case "subject":
                        return "sbj";
                    case "keywords":
                        return "kwd";
                    case "creator":
                        return "ctr";
                    case "producer":
                        return "pdr";
                    case "creationdate":
                        return "ctd";
                    case "moddate":
                        return "mdd";
                    default:
                        return null
                }
            }
            var n = $("#" + b),
                o = b + "_leftPanel",
                p = null,
                q = this,
                r = null,
                s = null,
                t = c.language;
            p = s, c = $.extend(d.Config.defaults, c);
            e.defaults.requestRetryCount;
            "undefined" == typeof c.readerType && (c.readerType = d.ReaderEngineType.IMAGE), r = new f("", c.fileName, b, c, o, null, null), d.Tool.setReaderApp(r), this.init = function() {
                if (a("core/Plugins/Annot/Stamp/StampListManager"), a("core/Plugins/Annot/Stamp/StampList"), a("core/Plugins/InkSign/InkSignListManager"), a("core/Plugins/Annot/ImageAnnot/ImageAnnotPlugin"), d.Environment.mobile) {
                    var b = a("core/Plugins/InkSign/MobileInkSign"),
                        c = new b;
                    c.init()
                } else a("core/Plugins/InkSign/PCInkSign")
            }, this.load = function() {
                // For poc
                /*if (r.isOffline()) return r.registerBaseModule(), void r.initInstance();
                try {
                    $.ajax({
                        url: c.baseUrl + "api/config/plugins",
                        type: "GET",
                        success: function(a) {
                            var b = $.parseJSON(a.result);
                            r.setPlugin(b.plugin), r.registerBaseModule(), r.initInstance()
                        },
                        error: function() {
                            r.setPlugin(1023), r.registerBaseModule(), r.initInstance()
                        }
                    })
                } catch (a) {
                    console.error(a)
                }*/
                return r.setPlugin(1023), r.registerBaseModule(), r.initInstance();
            }, this.saveAnnots = function(a, b) {
                return new Promise(function(c, e) {
                    if (r) {
                        var f = r.getPluginByName(d.BASEANNOT_PLUGIN_NAME);
                        f ? f.saveAnnots(!0, "comments", !0, b, b, null, c, e, a) : c()
                    } else c()
                })
            }, this.save = function(a, b) {
                function c() {
                    if (d.ConnectPdf && !d.ConnectPdf.isConnectedPDF()) {
                        var a = d.ConnectPdf.isSaveInConnectedPDF();
                        return d.ConnectPdf.iscPDFEngineReady() && a ? void(b !== !1 ? d.ConnectPdf.saveAsCpdf(d.ConnectPdf.successConvertCpdf_callback, d.ConnectPdf.failConvertCpdf_callback) : d.ConnectPdf.saveAsCpdf(d.ConnectPdf.successConvertCpdfNotOpenFile_callback, d.ConnectPdf.failConvertCpdf_callback)) : void 0
                    }
                }

                function e(a) {
                    var b = [];
                    b.push(d.ViewerInstance.saveAnnots(a));
                    var c = d.ViewerInstance.getPluginByName(d.FormPluginName);
                    c && b.push(c.save());
                    var e = d.ViewerInstance.getPluginByName(d.InkSignPluginName);
                    e && b.push(e.save());
                    Promise.all(b).then(function() {
                        r.clearAnnotUndo();
                        var a = r.getMainView().getDocView();
                        a.setModified(!1), q.fire(d.EventList.DOCUMENT_SAVED)
                    })["catch"](function(a) {
                        a && d.alert(d.Tool.readerApp, "", a)
                    })
                }
                if (!this.isDocModified()) return !1;
                var f = d.AccountInstance.isLogin();
                return f ? (r.isLargeFileReady().then(function(b) {
                    b ? (c(), e(a)) : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                }), !0) : (d.alert(null, null, i18n.t("Login.SaveTips")), !1)
            }, this.getZoomLevels = function() {
                var a = i(),
                    b = a ? a.getCurrentZoomList() : null;
                return b = b ? b : d.Config.defaults.zoomList, b.filter(function(a) {
                    return a <= r.supportedMaxScale() || "string" == typeof a
                })
            }, this.zoomTo = function(a) {
                var b = i(),
                    c = parseFloat(a);
                return c >= .1 && 10 >= c ? (a = c, a > r.supportedMaxScale() ? !1 : (b.setFitWidth(!1), b.setFitPage(!1), b.getCurMode() >= 0 && this.setLayoutShowMode(b.getCurMode()), b.onZoom(a))) : a === d.ZOOM_IN ? b.zoomIn() : a === d.ZOOM_OUT ? b.zoomOut() : a === d.ZOOM_FIT_WIDTH ? (b.setFitPage(!1), b.fitWidth()) : a === d.ZOOM_FIT_PAGE ? (b.setFitWidth(!1), b.setFitPage(!0), this.setLayoutShowMode(d.PDFView.RD_BRMODE_SINGLE_PAGE), b.onZoom(a)) : !1
            }, this.showFullPage = function() {
                var a = i();
                if (a) return this.setLayoutShowMode(d.PDFView.RD_BRMODE_SINGLE_PAGE), a.onZoom(d.ZOOM_FIT_PAGE), !0
            }, this.rotate = function(a) {
                var b = i();
                return a === d.ROTATE_LEFT ? b.rotateLeft() : a === d.ROTATE_RIGHT ? b.rotateRight() : !1
            }, this.isFitWidth = function() {
                var a = i();
                return a ? a.isFitWidth() : void 0
            }, this.isFitPage = function() {
                var a = i();
                return a ? a.isFitPage() : void 0
            }, this.getCurZoomLevel = function() {
                var a = i();
                return a ? a.getScale() : void 0
            }, this.gotoPage = function(a, b, c) {
                var d = i();
                return d ? d.gotoPage(a, b, c) : !1
            }, this.gotoPrevPage = function() {
                var a = i();
                return a ? a.gotoPrevPage() : void 0
            }, this.gotoNextPage = function() {
                var a = i();
                return a ? a.gotoNextPage() : !1
            }, this.gotoPageByDestination = function(a) {
                return r.getMainView().getDocView().gotoPageByDestination(a)
            }, this.getPageCount = function() {
                var a = i();
                return a ? a.getPageCount() : null
            }, this.getCurPageIndex = function() {
                var a = i();
                return a.getCurPageIndex()
            }, this.getPagesLabelInfo = function() {
                if (d.Engine.JR) return void console.log("This function does not support client-side rendering.");
                for (var a = i(), b = a.getPDFDoc(), c = b.getPageCount(), e = [], f = 0; c > f; f++) {
                    var g = b.getPage(f),
                        h = g.getPageLabel(),
                        j = {
                            pageIndex: f.toString(),
                            pageLabel: h
                        };
                    e.push(j)
                }
                return e
            }, this.focus = function() {
                $("#" + r.getDocView().getDocViewContainerID()).focus()
            }, this.updateLayout = function(a, b) {
                r && r.onResize(a, b)
            }, this.on = function(a, b) {
                return $(r).on(a, b), q
            }, this.getOptions = function() {
                return r ? r.getOptions() : 0
            }, this.off = function(a, b) {
                return $(r).off(a, b), q
            }, this.fire = function(a, b) {
                $(r).trigger(a, b)
            }, this.getFileName = function() {
                return r.getFileName()
            }, this.setCurrentToolByName = function(a) {
                return r.setCurrentToolByName(a)
            }, this.getCurToolHandlerName = function() {
                return r.getCurToolHandler().getName()
            }, this.getToolHandlerByName = function(a) {
                return r.getToolHandlerByName(a)
            }, this.setCurToolHandler = function(a) {
                return r.setCurToolHandler(a)
            }, this.getPluginByName = function(a) {
                return r.getPluginByName(a)
            }, this.searchText = function(a, b, c) {
                var e = r.getPluginByName(d.FindToolPluginName);
                return e ? r.isLargeFile() ? void r.isLargeFileReady().then(function(c) {
                    return c ? b === d.SearchDirection.Down ? e.searchTextDown(a) : b === d.SearchDirection.Up ? e.searchTextUp(a) : (console.warn("Invalid direction parameter for searching text."), !1) : void d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                }) : b === d.SearchDirection.Down ? e.searchTextDown(a) : b === d.SearchDirection.Up ? e.searchTextUp(a) : (console.warn("Invalid direction parameter for searching text."), !1) : (console.warn("Find tool is not enabled."), !1)
            }, this.searchAllText = function(a, b, c, e) {
                var f = r.getPluginByName(d.FindToolPluginName),
                    g = this.getPageCount();
                return null == a || "" == a || null == e || null == b || 0 == b || e > g ? null : void(f ? r.isLargeFile() ? r.isLargeFileReady().then(function(g) {
                    g ? f.searchAllText(a, b, c, e) : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                }) : f.searchAllText(a, b, c, e) : console.warn("Find tool is not enabled."))
            }, this.isDocLoaded = function() {
                return r.isDocLoaded()
            }, this.print = function() {
                return r.isDisablePrint() ? !1 : r.print()
            }, this.offlineCurFile = function(a, b) {
                return r.isLargeFile() ? void console.warn("This method is not support large file now!") : void r.offlineCurFile(a, b)
            }, this.offlineFileByUrl = function(a, b, c) {
                r.offlineFileByUrl(a, b, c)
            }, this.openOfflineFile = function(a, b) {
                r.openOfflineFile(a, b)
            }, this.cancelOfflineFile = function() {
                r.cancelOffLine()
            }, this.changeOffline = function(a, b) {
                function c(a) {
                    1 == a ? r.activeOffline(b) : b(!1), d.endConfirm()
                }
                if (a) {
                    if (r.isLargeFile()) return void console.info("This method is not support large file now!");
                    if (null == window.Worker) {
                        var e = i18n.t("CommonDialog.NotSupportBrowserForOffline");
                        return d.notSupportBrowser(e, !1), void b(!1)
                    }
                    if (r.isOffline()) return void b(!1);
                    var e = i18n.t("PCLng.offlineMsg"),
                        f = i18n.t("CommonDialog.DefaultOKBtnTitle"),
                        g = i18n.t("CommonDialog.DefaultCancelBtnTitle");
                    d.confirm(r, null, e, f, g, c)
                } else {
                    if (!r.isOffline()) return void b(!1);
                    r.activeOnline(b)
                }
            }, this.isOffline = function() {
                return r.isOffline()
            }, this.isLargeFile = function() {
                return r.isLargeFile()
            }, this.isLargeFileReady = function() {
                return r.isLargeFileReady()
            }, this.openLastOpenedFile = function() {
                return h.openLastOpenedFile()
            }, this.exportAnnotsToFDF = function() {
                var a = r.getPDFDoc();
                return a ? r.isAnnot() ? void(r.isLargeFile() ? r.isLargeFileReady().then(function(b) {
                    b ? a.exportToFDF() : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                }) : a.exportToFDF()) : (d.alert(null, null, i18n.t("License.PermissionDeny")), !1) : !1
            }, this.exportAnnotsToXFDF = function() {
                if (l() && !d.Environment.mobile) {
                    var a = r.getPDFDoc();
                    if (a) return r.isAnnot() ? r.isLargeFile() ? r.isLargeFileReady().then(function(b) {
                        return b ? a.loadAllAnnotations().then(function() {
                            a.exportToXFDF()
                        }, function() {
                            d.alert(null, null, i18n.t("PCLng.ToolBar.ExportFile.FDFFailed"))
                        }) : void d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                    }) : a.loadAllAnnotations().then(function() {
                        a.exportToXFDF()
                    }, function() {
                        d.alert(null, null, i18n.t("PCLng.ToolBar.ExportFile.FDFFailed"))
                    }) : void d.alert(null, null, i18n.t("License.PermissionDeny"))
                }
            }, this.exportAnnotsToXFDFStream = function(a) {
                if (l()) {
                    var b = r.getPDFDoc();
                    if (b) return r.isAnnot() ? void(r.isLargeFile() ? r.isLargeFileReady().then(function(c) {
                        return c ? b.loadAllAnnotations().then(function() {
                            b.exportToXFDF(!0, a)
                        }, function() {
                            d.alert(null, null, i18n.t("PCLng.ToolBar.ExportFile.FDFFailed"))
                        }) : void d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                    }) : b.loadAllAnnotations().then(function() {
                        b.exportToXFDF(!0, a)
                    }, function() {
                        d.alert(null, null, i18n.t("PCLng.ToolBar.ExportFile.FDFFailed"))
                    })) : void d.alert(null, null, i18n.t("License.PermissionDeny"))
                }
            }, this.importAnnotsFromXFDF = function(a) {
                if (l()) {
                    var b = r.getPDFDoc();
                    if (b) return r.isAnnot() ? void(r.isLargeFile() ? r.isLargeFileReady().then(function(c) {
                        c ? b.importAnnotsFromXFDFBuffer(a) : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                    }) : b.importAnnotsFromXFDFBuffer(a)) : void d.alert(null, null, i18n.t("License.PermissionDeny"))
                }
            }, this.getDocumentUrl = function(a, b) {
                var c = r.getPDFDoc();
                c && c.getDocumentUrl(a, b)
            }, this.exportDocument = function(a) {
                function b() {
                    if (c)
                        if (d.ConnectPdf)
                            if (a || (a = r.getFileName()), d.ConnectPdf.isConnectedPDF()) c.saveCPDFFile(a, null, null);
                            else {
                                var b = d.AccountInstance.getLoginProcessor();
                                if (null != b && !b.isSignIn()) return void b.showSignInDialog();
                                d.ConnectPdf.convertTocPdf(function(b, d, e) {
                                    c.saveCPDFFile(a, d, e)
                                }, function() {})
                            }
                    else {
                        if (!l()) return;
                        c.exportDocument(a, t, !1, null, null, null, null)
                    }
                }
                if (!d.Environment.mobile) {
                    var c = r.getPDFDoc();
                    return r.isDisableDownload() ? !1 : void b()
                }
            }, this.exportDocumentStream = function(a) {
                var b = r.getPDFDoc();
                if (r.isDisableDownload()) return !1;
                if (b && l()) return r.isLargeFile() ? r.isLargeFileReady().then(function(c) {
                    c ? b.exportDocument(null, t, !1, null, null, null, {
                        bToStream: !0,
                        recieve: a
                    }) : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                }) : void b.exportDocument(null, t, !1, null, null, null, {
                    bToStream: !0,
                    recieve: a
                })
            }, this.exportDocumentToUrl = function(a, b, c, e) {
                if (b || (apiConfig && apiConfig.document && "object" == typeof apiConfig.document.exportDocument ? b = apiConfig.document.exportDocument : apiConfig && apiConfig.document && "function" == typeof apiConfig.document.exportDocument ? b = apiConfig.document.exportDocument() : console.error("apiConfig.document.exportDocument format error,mush object or function"), b = b ? b : {}), d.Engine.JR) return void console.log("function exportDocumentToUrl is not supported with JR and restful api.");
                if (!r.isDisableDownload()) {
                    var f = r.getPDFDoc();
                    if (!f) return;
                    if (r.isLargeFile()) return r.isLargeFileReady().then(function(g) {
                        g ? f.exportDocument(a, t, !0, b, c, e) : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                    });
                    f.exportDocument(a, t, !0, b, c, e)
                }
            }, this.getThumbnail = function(a, b) {
                if (r.isLargeFile()) return void console.error("this method not support large file now");
                0 > a ? a = 0 : a >= this.getPageCount() && (a = this.getPageCount() - 1);
                var c = i().getPageView(a),
                    d = r.getMainView().getDocView().getPageViewRender();
                return d.loadThumb(c, a, b, e.defaults.requestRetryCount)
            }, this.getThumbnailPrivate = function(a, b) {
                0 > a ? a = 0 : a >= this.getPageCount() && (a = this.getPageCount() - 1);
                var c = i().getPageView(a),
                    d = r.getMainView().getDocView().getPageViewRender();
                return d.loadThumb(c, a, b, e.defaults.requestRetryCount)
            }, this.highlightText = function(a, b) {
                if (r.isLargeFile()) return void console.error("this method not support large file now");
                //var c = r.getPluginByName(d.FindToolPluginName);
                var aa = ss.createSearchServie(d.Tool.getReaderApp());
                var c = sv.prototype;
                return c ? (c.resetHighLightText(!0), c.curPageIndex = a, aa.setHighlightRects(b), aa.setSeacrchedPageIndex(a), c.highlightSearchedText(a, b)) : !1
            }, this.addContextMenu = function(a) {
                return r.addMenuItem(menuItemDefinition)
            }, this.registerMainFrmEventHandler = function(a) {
                return r.registerMainFrmEventHandler(a)
            }, this.registerMousePtHandler = function(a) {
                return r.registerMousePtHandler(a)
            }, this.openFileByBuffer = function(b, e, f) {
                q.closeFile(), r.setPDFbuffer(b), r.setFileName(e), s = f;
                var g = s.indexOf("asserts"); - 1 == g ? c.baseUrl = f : c.baseUrl = s.substr(0, g), s.lastIndexOf("/") != s.length - 1 && s.lastIndexOf("\\") != s.length - 1 && (s += "/"), c.url = s, c = $.extend(d.Config.defaults, c);
                try {
                    n.children().remove(), d.Environment.mobile && (n.addClass("fwr_main_frame_wnd_wap"), c.defaultZoom = d.ZOOM_FIT_WIDTH);
                    var h = null,
                        i = null;
                    switch (c.readerType) {
                        case d.ReaderEngineType.IMAGE:
                            a("core/Framework/DocumentLoader"), a("core/ImageEngine/ImagePageViewRender"), h = new d.DocumentLoader, i = new d.ImageEngine.ImagePageViewRender;
                            break;
                        case d.ReaderEngineType.HTML5:
                            $.error("Unsupported engine.");
                            break;
                        default:
                            $.error("Invalid type of reader.")
                    }
                    r.setDocumentHandle(h), r.setPageViewRender(i), r.setOptions(c)
                } catch (j) {
                    return console.error(j), null
                }
                q.load()
            }, this.openFileByUri = function(a) {
                a = a || {};
                var b = a.isLargeFile || a.fileSize >= d.Config.defaults.LargeFileSize;
                return "string" == typeof a.fileId ? h.openFileByFileId(a.fileId, b) : h.openFileByUri(a.url || "", b)
            }, this.openFile = function(b, e) {
                s = b;
                var f = s.indexOf("asserts");
                c.baseUrl = s.substr(0, f), s.lastIndexOf("/") != s.length - 1 && s.lastIndexOf("\\") != s.length - 1 && (s += "/"), c.url = s, c = $.extend(d.Config.defaults, c), q.closeFile(), e && e.isLargeFile && (r.openLargeFileMode(), r.setLargeFileDocId(e.docId), r.setLargeFileTaskId(e.taskId));
                try {
                    d.Environment.mobile && (n.addClass("fwr_main_frame_wnd_wap"), c.defaultZoom = d.ZOOM_FIT_WIDTH);
                    var g = null,
                        h = null;
                    switch (c.readerType) {
                        case d.ReaderEngineType.IMAGE:
                            a("core/Framework/DocumentLoader"), a("core/ImageEngine/ImagePageViewRender"), g = new d.DocumentLoader(s), h = new d.ImageEngine.ImagePageViewRender;
                            break;
                        case d.ReaderEngineType.HTML5:
                            $.error("Unsupported engine.");
                            break;
                        default:
                            $.error("Invalid type of reader.")
                    }
                    r.setDocumentHandle(g), r.setPageViewRender(h), r.setOptions(c)
                } catch (i) {
                    return console.error(i), null
                }
                q.load()
            }, this.closeFile = function() {
                if (!r) return !1;
                r.getPDFDoc() && $(r).trigger(d.EventList.DOCUMENT_CLOSED, {}), r.resetResouce(), r.closeCurrentDocument();
                var a = i();
                return a && a.unBindScrollEvent(), n.children().remove(), $("#fields_highlight").is(":visible") && $("#fields_highlight").hide(), !0
            }, this.getFileID = function() {
                return r.getFileID()
            }, this.setFileID = function(a) {
                r.setFileID(a)
            }, this.getFileUrl = function() {
                return p
            }, this.setFileUrl = function(a) {
                p = a
            }, this.hasForm = function() {
                return r.isForm()
            }, this.setLayoutShowMode = function(a) {
                var b = i();
                if (b) return b.changeShowMode(a, !0)
            }, this.getViewMode = function() {
                var a = i();
                return a.getViewMode()
            }, this.showAllAnnots = function() {
                var a = i();
                if (a) {
                    for (var b = this.getPageCount(), c = 0; b > c; c++) {
                        var d = a.getPDFDoc().getPage(c);
                        d.enumAnnots(function(a) {
                            a && a.isVisible() && !a.isAnnotDel() && a.showInViewer()
                        })
                    }
                    a.showAnnots(!0)
                }
            }, this.hideAllAnnots = function() {
                var a = i();
                if (a) {
                    for (var b = this.getPageCount(), c = 0; b > c; c++) {
                        var d = a.getPDFDoc().getPage(c);
                        d.enumAnnots(function(a) {
                            a && a.isVisible() && !a.isAnnotDel() && a.hideInViewer()
                        })
                    }
                    a.showAnnots(!1)
                }
            }, this.showAnnots = function(a) {
                var b = Object.prototype.toString.call(a);
                if ("[object Array]" == b) {
                    var c = i();
                    if (c) {
                        for (var d = this.getPageCount(), e = 0; d > e; e++)
                            for (var f = c.getPDFDoc().getPage(e), g = 0; g < a.length; g++) {
                                var h = f.getAnnotByName(a[g].name);
                                h && h.isVisible() && !h.isAnnotDel() && h.showInViewer()
                            }
                        c && c.showAnnots(c.isShowAnnots())
                    }
                }
            }, this.hideAnnots = function(a) {
                var b = Object.prototype.toString.call(a);
                if ("[object Array]" == b) {
                    var c = i();
                    if (c) {
                        for (var d = this.getPageCount(), e = 0; d > e; e++)
                            for (var f = c.getPDFDoc().getPage(e), g = 0; g < a.length; g++) {
                                var h = f.getAnnotByName(a[g].name);
                                h && h.isVisible() && !h.isAnnotDel() && h.hideInViewer()
                            }
                        c && c.showAnnots(c.isShowAnnots())
                    }
                }
            }, this.isJREngineReady = function() {
                var a = r.getWorker();
                return a ? !0 : !1
            }, this.reload = function() {
                r.isDocumentLoaded() || r.reloadDocument()
            }, this.isDocModified = function() {
                return r.isDocModified()
            }, this.getSecurityType = function() {
                return r.getSecurityType()
            }, this.getLanguage = function() {
                return t
            }, this.loadDataControl = function(a) {
                var b = r.getWorker();
                return b || d.waiting(r, null, i18n.t("Load.PreParing")), r.loadDataControl(a)
            }, this.getDataControl = function() {
                return r.getDataControl()
            }, this.updateUUID = function(a, b, e) {
                var f = {
                        isLogin: !0,
                        userId: a,
                        email: b,
                        accessToken: e
                    },
                    g = d.AccountInstance.getUserId(),
                    h = q.getFileID();
                if (null !== h && void 0 !== h) {
                    var i = {
                            userId: a,
                            userName: b
                        },
                        j = c.baseUrl;
                    $.ajax({
                        url: j + "api/users/" + h + "/info",
                        type: "POST",
                        data: i,
                        success: function(a) {
                            if ("0" === a.resultCode) {
                                var b = a.resultBody.uuid;
                                b != h && (q.setFileID(a.resultBody.uuid), q.fire("docOpen"), q.fire(d.EventList.USER_LOGIN_STATE_CHANGED, f))
                            }
                        },
                        error: function() {}
                    })
                } else if (g != a) return void q.fire(d.EventList.USER_LOGIN_STATE_CHANGED, f)
            }, this.updateUserData = function() {
                var a = r.getFileID();
                if (null !== a && void 0 !== a) {
                    var b = c.baseUrl + "api/systemuser/" + a + "/userdata";
                    $.ajax({
                        url: b,
                        headers: {
                            "x-auth-doc": r.getPDFPassword()
                        },
                        success: function(a) {
                            null !== a && "" !== a && "true" == a && j()
                        },
                        error: function(a) {}
                    })
                }
            }, this.updateCurrentUserInfo = function(a, b) {
                a || (apiConfig && apiConfig.user && "object" == typeof apiConfig.user.getUserInfo ? a = apiConfig.user.getUserInfo : apiConfig && apiConfig.user && "function" == typeof apiConfig.user.getUserInfo ? a = apiConfig.user.getUserInfo() : console.error("apiConfig.user.getUserInfo format error,mush object or function"), a = a ? a : {});
                var e = new Promise(function(f, g) {
                    if (r.isOffline()) k(!0, Configs.DefaultUserId, Configs.DefaultAccount, Configs.DefaultAccessToken, c.baseUrl, c, f);
                    else {
                        var h = d.optionParameters.serverBaseUrl + "api/systemuser/info?" + Math.random(),
                            i = null,
                            j = null,
                            l = null;
                        if ("restful" != a.type) {
                            if (i = a.userId, j = a.userName, l = a.accessToken, a.userId && a.userName && a.accessToken) return k(!0, a.userId, a.userName, a.accessToken, c.baseUrl, c, f), e;
                            $.extend(!0, a, {
                                heads: {
                                    defaultuser: getCookie("default_user")
                                }
                            })
                        }
                        var m = {
                            params: JSON.stringify(a)
                        };
                        $.ajax({
                            type: "GET",
                            url: h,
                            dataType: "json",
                            data: m,
                            success: function(a) {
                                if ("0" !== a.resultCode) k(!1, Configs.DefaultUserId, Configs.DefaultAccount, Configs.DefaultAccessToken, c.baseUrl, c, f);
                                else {
                                    setCookie("default_user", a.resultBody.id, "/", 720);
                                    var b = i ? i : a.resultBody.id,
                                        d = j ? j : a.resultBody.userName,
                                        e = l ? l : a.resultBody.accessToken;
                                    k(!0, b, d, e, c.baseUrl, c, f)
                                }
                            },
                            error: function(a) {
                                b || d.alert(null, null, i18n.t("User.GetUserIdFalied")), k(!1, Configs.DefaultUserId, Configs.DefaultAccount, Configs.DefaultAccessToken, c.baseUrl, c, f)
                            }
                        })
                    }
                });
                return e
            }, this.CheckLoginStatus = function() {
                var a = d.optionParameters.serverBaseUrl,
                    b = d.AccountInstance.getLoginProcessor(),
                    c = {
                        language: t
                    };
                $.ajax({
                    url: a + "cpdf/users?random=" + Math.random(),
                    type: "GET",
                    data: c,
                    success: function(c) {
                        var e = c.resultBody.ret;
                        if ("0" === e) c.resultBody.collectedData && 2 == c.resultBody.collectedData && d.ConnectPdf.setCollectionStatus(!1), c.resultBody.saveInConnectedPDF && 2 == c.resultBody.saveInConnectedPDF && d.ConnectPdf.SetSaveInConnectedPDFStatus(!1), k(!0, c.resultBody.userId, c.resultBody.email, c.resultBody.accessToken, a, null, !1, null), d.Environment.mobile ? b.showAccount(c.resultBody.email, c.resultBody.accessToken, c.resultBody.userId, c.resultBody.firstName, c.resultBody.lastName, c.resultBody.avatar, !0) : b.showLoginState(c.resultBody.email, c.resultBody.accessToken, c.resultBody.userId, c.resultBody.firstName, c.resultBody.lastName, c.resultBody.avatar, !0), d.ViewerInstance.openFileByUri();
                        else {
                            var f = i18n.t("MobileLng.More.MyAccount.SignIn");
                            $("#btnSignIn").text(f), k(!1, Configs.DefaultUserId, Configs.DefaultAccount, Configs.DefaultAccessToken, a, null, !1, null), d.ViewerInstance.openFileByUri()
                        }
                        d.Environment.mobile || $("#homepage-viewbtn").removeAttr("disabled")
                    },
                    error: function() {
                        k(!1, Configs.DefaultUserId, Configs.DefaultAccount, Configs.DefaultAccessToken, a, null, !1, null), d.ViewerInstance.openFileByUri()
                    }
                })
            }, this.getUserPermission = function() {
                return r ? r.getUserPermission() : null
            }, this.getPageAnnots = function(a, b) {
                if (!$.isFunction(b)) return !1;
                var c = r.getPDFDoc();
                if (c) {
                    if (!r.isAnnot()) return void d.alert(null, null, i18n.t("License.PermissionDeny"));
                    var e = c.getPageCount();
                    return 0 > a || a > e - 1 ? !1 : void(r.isLargeFile() ? r.isLargeFileReady().then(function(e) {
                        e ? c.getAnnotationInfo(a, b) : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                    }) : c.getAnnotationInfo(a, b))
                }
            }, this.getPDFOutline = function() {
                var a = r.getBookmark(),
                    b = null;
                return a && (b = a.getBookmarkService()), b
            }, this.importAnnotsFromFDF = function(a) {
                var b = r.getPDFDoc();
                if (b) return r.isAnnot() ? void(r.isLargeFile() ? r.isLargeFileReady().then(function(c) {
                    c ? b.importAnnotsFromFDF(a) : d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing"))
                }) : b.importAnnotsFromFDF(a)) : void d.alert(null, null, i18n.t("License.PermissionDeny"))
            }, this.openFileByStream = function(a, b, e) {
                return l() ? !a || a.length <= 0 ? void console.error("The file buffer is empty!") : b && e ? void d.Common.getEngine(c.baseUrl, function(c) {
                    function f() {
                        d.FileUtils.openFileByStream(a, b, e)
                    }
                    if (!d.Engine.JR && a.length > d.Config.defaults.LargeFileSize) return void d.alert(null, null, i18n.t("ParseError.OutOfViewerFileSizeLimit"));
                    d.ViewerInstance.loadDataControl(d.Engine.JR);
                    var g = d.ViewerInstance.getDataControl(),
                        h = {
                            type: "initLoad",
                            success: f
                        };
                    g.initLoad(h)
                }) : void console.error("The version or file name is empty!") : void 0
            }, this.enableJSAction = function(a) {
                d.JSEngine && (d.JSEngine.enable = a)
            }, this.enableSafeMode = function(a) {
                d.JSEngine && (d.JSEngine.enableSafeMode = a)
            }, this.insertPagesFromSteam = function(a, b, c, e, f) {
                function h() {
                    function h() {
                        d.closeWaiting()
                    }

                    function i() {
                        return g.upload(a, f, {
                            loadstart: function() {
                                d.uploading(null, 0)
                            },
                            loadend: function() {
                                d.uploading(null, 100)
                            },
                            progress: function(a) {
                                console.info("uploading", a), d.uploading(null, Math.round(a.loaded / a.total * 1e4) / 100)
                            },
                            error: function() {
                                d.closeUploading(), d.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                            }
                        }).then(null, function(a) {
                            return d.closeUploading(), Promise.reject(a)
                        })
                    }

                    function j(a) {
                        d.closeUploading(), d.waiting(null, null, i18n.t("Load.Processing")), b = d.Common.base64encode(b);
                        var f = {
                            insertPassword: b,
                            insertDocid: a.docid,
                            pageRanges: c,
                            insertPos: e,
                            pageCount: d.ViewerInstance.getPageCount(),
                            flag: 0
                        };
                        return g.insertPages(d.Tool.readerApp.getFileID(), f)
                    }

                    function k(a) {
                        return g.waitingForInsertPageTaskComplete(a.taskid).then(function(b) {
                            return {
                                data: a,
                                taskInfo: b
                            }
                        })
                    }

                    function l(a) {
                        var b = a.data,
                            c = a.taskInfo,
                            e = d.Tool.getReaderApp(),
                            f = c.size >= d.Config.defaults.LargeFileSize;
                        d.ViewerInstance.openFileByUri({
                            isLargeFile: f,
                            fileId: c.uuid
                        }), b.fileName && e.setFileName(b.fileName), $(window).resize()
                    }
                    return r.isLargeFileReady().then(function(a) {
                        return a ? void 0 : (d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing")), Promise.reject(!1))
                    }).then(i).then(j).then(k).then(l, h)
                }
                if (r.isJRorMobile()) return Promise.reject("JR and Mobile are not support now!");
                if (!a || a.length <= 0 || !f || !c || "number" != typeof e || -1 > e) return Promise.reject("parameters error");
                if ("-1" != c && !d.Common.isValidPageNum(c)) return Promise.reject("parameters error");
                if (a.length > d.Config.defaults.LargeFileSize) return Promise.reject("out of file size limit");
                var i = r.getPDFDoc();
                return i ? i.hasPermission(d.PDFPermission.FPDFPERM_MODIFY) ? h() : Promise.reject("no permission to edit the document") : Promise.reject("unknown error")
            }, this.flattenPages = function(a, b, c) {
                if (d.Engine.JR || d.Engine.isJR || d.Environment.mobile) return Promise.reject("not support JR engine or mobile!");
                var e = this;
                if (!b || 0 == b.length || "number" != typeof c || 0 > c || c > 7) return Promise.reject("parameter error!");
                if (!r || !r.getPDFDoc()) return Promise.reject("no document opened!");
                if (e.isDocModified() && $.isFunction(a)) {
                    var f = a("flattenPages");
                    if (!f) return Promise.reject("need save first")
                }
                var h = r.getPDFDoc(),
                    i = e.getFileID();
                return e.isLargeFile() ? r.isLargeFileReady().then(function(a) {
                    return a ? void 0 : (d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing")), Promise.reject(!1))
                }).then(function() {
                    return g.flattenPages({
                        uuid: i,
                        pageRanges: b,
                        flag: c
                    })
                }).then(function(a) {
                    return g.waitingForFlattenTaskComplete(a.taskid).then(function(a) {
                        return {
                            docid: a.docid,
                            md5: a.md5,
                            uuid: a.uuid
                        }
                    })
                }) : h.flattenPages(i, b, c).then(function(a) {
                    return a
                }, function(a) {
                    return console.error("flatten pages error", a), Promise.reject("flatten error!")
                })
            }, this.setMetaData = function(a, b) {
                if (d.Engine.JR || d.Engine.isJR || d.Environment.mobile) return !1;
                if (!r.getPDFDoc().hasPermission(8)) return !1;
                if (r) {
                    var c = r.getPDFDoc();
                    if (c) {
                        var e = c.getDocProperties();
                        if (e) {
                            if (!a || a.length <= 0) return !1;
                            var f = m(a);
                            return f ? (e._docPropertiesJSONData[f] = b, !0) : !1
                        }
                        return !1
                    }
                    return !1
                }
                return !1
            }, this.getMetaData = function(a) {
                if (!a || a.length <= 0) return null;
                if (r) {
                    var b = r.getPDFDoc();
                    if (b) {
                        var c = b.getDocProperties();
                        if (c) {
                            var d = m(a);
                            if (!d) return null;
                            var e = c._docPropertiesJSONData[d];
                            return ("ctd" == d || "mdd" == d) && (e += "UTC"), e
                        }
                        return null
                    }
                    return null
                }
                return null
            }, this.splitDocByPageRange = function(a, b) {
                if (d.Engine.JR || d.Engine.isJR || d.Environment.mobile) return Promise.reject("not support JR engine or mobile!");
                if (!b || b.length <= 0) return Promise.reject("parameter error!");
                if (!r || !r.getPDFDoc()) return Promise.reject("no document open!");
                var c = !1;
                if (q.isDocModified() && $.isFunction(a) && (c = a("splitDocByPageRange"), !c)) return Promise.reject("need save first");
                var e = q.getFileID();
                if (q.isLargeFile()) return r.isLargeFileReady().then(function(a) {
                    return a ? g.splitDocument({
                        uuid: e,
                        pageRanges: b
                    }) : (d.alert(null, null, i18n.t("ParseError.DocumentIsProcessing")), Promise.reject(!1))
                }).then(function(a) {
                    return g.waitingForSplitTaskComplete(a.taskid, 5e3).then(function(a) {
                        return a.files
                    })
                });
                var f = r.getPDFDoc();
                return f.splitDoc(e, b).then(function(a) {
                    return a
                }, function(a) {
                    return console.error(a), Promise.reject("split error!")
                })
            }, this.undo = function(a) {
                r.annotUndo(a)
            }
        }, d.createViewer = function(a, b) {
            if (!d.ViewerInstance) {
                var c = new d.Viewer(a, b);
                d.ViewerInstance = c, d.ViewerInstance.init()
            }
            return d.ViewerInstance
        }
    }), define("core/Framework/Config", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.Config = {}, d.Config.defaults = {
            language: "en-US",
            defaultLanguage: "en-US",
            zoomList: [.5, .75, 1, 1.25, 1.5, 2, 4, 8, 10],
            minZoomSize: .5,
            maxZoomSize: 2,
            maxNewPagesPerTime: 20,
            maxResizePagesPerTime: 20,
            requestRetryCount: 20,
            maxRequestRetryCount: 100,
            requestRetryInterval: 2e3,
            collectinDataSubmitInterval: 15e3,
            maxManifestRetryCount: 60,
            errPageImgWidth: 558,
            errPageImgHeight: 106,
            defaultZoom: 1,
            leftPanelShowOnStart: !0,
            showDownloadLimitBtn: !0,
            disablePrint: !1,
            TooltipTimeout: 3e3,
            autoDetectElasticScroll: !0,
            scrollBarType: 0,
            url: null,
            fileName: "",
            formMode: !0,
            drawingSelectSize: 8,
            LargeFileSize: 209715200
        }, d.Config.ToolBar = [{
            name: "Logo",
            btns: ["FoxitLog"],
            width: 250
        }, {
            name: "Tools",
            btns: ["ToolBarSeparator", "HandTool", "TextTool"]
        }, {
            name: "document",
            btns: ["ToolBarSeparator", "First Page", "Prev Page", "Next Page", "Last Page", "GotoPage", "ToolBarSeparator"]
        }, {
            name: "Zoom",
            btns: ["FitWidth", "ZoomIn", "ZoomOut", "SelectZoom", "ToolBarSeparator"]
        }, {
            name: "Search",
            btns: ["SearchAllText", "SearchText", "SearchPrev", "SearchNext", "ToolBarSeparator"]
        }, {
            name: "DownloadPDF",
            btns: ["DownLoadPDF", "ToolBarSeparator"]
        }, {
            name: "Highlight",
            btns: ["Highlight", "ExportData", "ToolBarSeparator"]
        }, {
            name: "DocProperties",
            btns: ["PopupDocProperties", "ToolBarSeparator"]
        }, {
            name: "CommentAnnotTool",
            btns: ["ToolBarSeparator", "HighlightAnnot", "UnderlineAnnot"]
        }], d.Config.RibbonToolBar = {
            left: ["DownLoadPDF", "ToolBarSeparator", "HandTool", "TextTool"],
            right: ["SearchAllText", "SearchText", "SearchPrev", "SearchNext", "QRCode"]
        }, d.Config.RibbonStatusBar = {
            center: ["First Page", "Prev Page", "GotoPage", "Next Page", "Last Page"],
            right: ["FitWidth", "SelectZoom", "ZoomOut", "ZoomSlider", "ZoomIn"]
        }, d.Config.MenuBar = [{
            plugin: "document",
            items: [{
                item: "MenuZoom50",
                subitems: []
            }, {
                item: "MenuZoom75",
                subitems: []
            }, {
                item: "MenuZoom100",
                subitems: []
            }, {
                item: "MenuZoom125",
                subitems: []
            }, {
                item: "MenuZoom150",
                subitems: []
            }, {
                item: "MenuZoom200",
                subitems: []
            }, {
                item: "FitPage",
                subitems: []
            }, {
                item: "FitWidth",
                subitems: []
            }, {
                item: "MenuSeparator",
                subitems: []
            }, {
                item: "MenuPrevPage",
                subitems: []
            }, {
                item: "MenuNextPage",
                subitems: []
            }]
        }, {
            plugin: "DocProperties",
            items: [{
                item: "MenuSeparator",
                subitems: []
            }, {
                item: "MenuDocProperties",
                subitems: []
            }]
        }], d.Config.Plugins = {
            load: {
                Annot: !0,
                FindTool: !0,
                NavigationPanel: !0,
                Thumbnail: !0,
                Bookmark: !0,
                DocProperties: !0,
                ToolBar: !0,
                Menu: !0,
                Form: !0,
                TextSelection: !0,
                Print: !0,
                Signature: !0,
                InkSign: !0
            },
            flag: {
                FindTool: 1,
                Print: 2,
                Comments: 4,
                Thumbnail: 8,
                TextSelection: 16,
                Form: 32,
                Bookmark: 64,
                Menu: 128,
                Signature: 256,
                InkSign: 512
            }
        }, d.Config
    }), define("core/Framework/ReaderApp", ["core/uupaa-color.mini", "core/uupaa-excanvas", "core/WebPDF", "core/Common/Environment", "core/Framework/Config", "core/Common/Support", "core/Common/Math/Rect", "core/Common/Math/Point", "core/Common/Math/JSMap", "core/Common/Math/Matrix", "core/Common/CommonDialog", "core/Tools/Tools", "core/Plugins/Action/PDFDestination", "core/Framework/View/MainFrame", "core/Framework/View/PDFDocView", "core/Framework/View/PDFPageView", "core/Framework/View/PDFView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Framework/View/LayoutInfo", "core/Framework/View/ProgressiveViewerGenerator", "core/Framework/View/PDFContinuousView", "core/Framework/View/PDFSinglePageView", "core/Framework/View/PDFFacingPageView", "core/Common/ServerService", "core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters", "core/Framework/View/SinglePageViewLayout", "core/Common/Common", "core/Interface/IMainFrmEventHandler", "core/Interface/IMousePtHander", "core/Tools/HandToolHandler", "core/Plugins/Menu/MenuItem", "core/Plugins/Text/TextManager", "core/Plugins/Text/PDFTextObject", "core/Plugins/Text/PDFTextPage", "core/Plugins/Offline/OfflineFileCache", "core/WebStorage", "core/Framework/DataControls", "core/Framework/JSDataControls", "core/Framework/ServerDataControls", "core/ImageEngine/ImageLazyLoad", "core/Plugins/PDFJS/pdfjs", "core/Plugins/PDFJS/app", "core/Plugins/PDFJS/color", "core/Plugins/PDFJS/field", "core/Plugins/Form/service/PDFFormConstants", "core/Plugins/PDFJS/doc", "core/Plugins/PDFJS/utils", "core/Plugins/Loupe/LoupePlugin", "core/Plugins/Loupe/LoupeToolHandler", "core/Plugins/Loupe/LoupeView", "core/Plugins/Loupe/LoupeDlg", "core/ImageEngine/ImageTitlesLazyLoad", "core/Plugins/MarqueeTool/MarqueeToolPlugin", "core/Plugins/MarqueeTool/MarqueeToolHandler", "core/Plugins/MarqueeTool/MarqueeToolService", "core/Plugins/MarqueeTool/MarqueeToolView", "core/Plugins/TextSelection/PDFTextSelectTool", "core/Plugins/TextSelection/PDFTextPageSelect", "core/Plugins/Print/PrintConfig", "core/Plugins/Navigation/NavigationComponent", "core/Plugins/Navigation/MobileNavigationView", "core/Plugins/Navigation/PCNavigationView", "core/Plugins/Thumbnail/thumbnailController", "core/Plugins/Thumbnail/thumbnailView_mobile", "core/Plugins/Thumbnail/thumbnailView_pc", "core/Plugins/Bookmark/BookmarkController", "core/Plugins/Bookmark/Bookmarkns", "core/Plugins/Bookmark/BookmarkListView", "core/Plugins/Bookmark/BookmarkTreeView", "core/Plugins/Bookmark/BookmarkService", "core/Plugins/Bookmark/PDFBookmark", "core/Plugins/Bookmark/PDFBookmarkInfo", "core/Plugins/Bookmark/BookmarkLoader", "core/Plugins/Action/PDFGoToAction", "core/Plugins/DocProperties/DocPropertiesPlugin", "core/Plugins/Form/FormPlugin", "core/Plugins/Form/service/PDFForm", "core/Plugins/Form/service/PDFFormField", "core/Plugins/Form/service/PDFFormControl", "core/Plugins/Form/view/formViewer", "core/Plugins/Form/view/baseControlView", "core/Plugins/TextSelection/TextSelectComponent", "core/Plugins/TextSelection/TextSelectToolHandler", "core/Plugins/TextSelection/TextSelectView", "core/Plugins/TextSelection/TextSelectService", "core/Plugins/Menu/MenuPlugin", "core/Plugins/FindTool/SearchComponent", "core/Plugins/FindTool/MobileSearchView", "core/Common/Interface", "core/Plugins/FindTool/SearchView", "core/Plugins/FindTool/PCSearchView", "core/Plugins/FindTool/SearchService", "core/Plugins/FindTool/SearchResult", "core/Plugins/Annot/BaseAnnotPlugin", "core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/Plugins/Annot/AnnotHandleManager", "core/Plugins/Annot/AnnotUIManager", "core/Common/CanvasUtils", "core/Plugins/Annot/PDFAnnotationLoader", "core/Plugins/Annot/MarkupAnnotHandler", "core/Plugins/Annot/PopupMousePtHandler", "core/Plugins/Annot/PDFTypewriter", "core/Plugins/Annot/CommentAnnot/CommentAnnotHandler", "core/Plugins/Annot/CommentAnnot/CommentAnnotService", "core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", "core/Plugins/Annot/DrawingPropertyDlg", "core/Plugins/Annot/LinkAnnotHandler", "core/Plugins/Annot/TextAnnotHandler", "core/Plugins/Annot/TextAnnotView", "core/Plugins/Annot/TextAnnotService", "core/Plugins/Annot/TypewriterAnnotHandler", "core/Plugins/Annot/TypewriterAnnotView", "core/Plugins/Annot/TypewriterAnnotService", "core/Plugins/Annot/CalloutAnnotHandler", "core/Plugins/Annot/CalloutAnnotView", "core/Plugins/Annot/CalloutAnnotService", "core/Plugins/Annot/TextboxAnnotHandler", "core/Plugins/Annot/TextboxAnnotView", "core/Plugins/Annot/TextboxAnnotService", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService", "core/Plugins/Annot/DrawingAnnot/InkAnnotHandler", "core/Plugins/Annot/DrawingAnnot/InkAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotHandler", "core/Plugins/Annot/DrawingAnnot/CircleAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Plugins/Annot/DrawingAnnot/SquareAnnotView", "core/Plugins/Annot/DrawingAnnot/LineAnnotView", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotView", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DrawingAnnot/LineAnnotHandler", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotHandler", "core/Plugins/Annot/CommonMarkupAnnotHandler", "core/Plugins/Annot/StampAnnotHandler", "core/Plugins/Annot/ImageAnnot/ImageAnnotHandler", "core/Plugins/Annot/Undo/AnnotUndo", "core/Plugins/Annot/AnnotMousePtHandler", "core/Plugins/Annot/AnnotSelectionTool", "core/Plugins/Annot/TextAnnotToolHandler", "core/Plugins/Annot/AnnotFactory", "core/Plugins/Annot/PDFMarkup", "core/Plugins/Annot/CommentAnnot/CommentAnnot", "core/Plugins/Annot/PDFLink", "core/Plugins/Action/Action", "core/Plugins/Annot/PDFInk", "core/Plugins/Annot/PDFCallout", "core/Plugins/Annot/PDFTextBox", "core/Plugins/Annot/ImageAnnot/PDFImage", "core/Plugins/Signature/PDFSignature", "core/Plugins/InkSign/PDFInkSign", "core/Plugins/Annot/DrawingAnnot/PDFCircle", "core/Plugins/Annot/DrawingAnnot/PDFSquare", "core/Plugins/Annot/DrawingAnnot/PDFPolygon", "core/Plugins/Annot/DrawingAnnot/PDFLine", "core/Plugins/Annot/AnnotCommonView", "core/Plugins/Annot/TypewriterAnnotToolHandler", "core/Plugins/Annot/TextboxAnnotToolHandler", "core/Plugins/Annot/CalloutAnnotToolHandler", "core/Plugins/Annot/ImageAnnot/ImageAnnotToolHandler", "core/Plugins/Annot/StampAnnotToolHandler", "core/Plugins/Annot/PDFStamp", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/CircleTools", "core/Plugins/Annot/DrawingAnnot/SquareTools", "core/Plugins/Annot/DrawingAnnot/LineTools", "core/Plugins/Annot/DistanceAnnot/DistanceLineTool", "core/Plugins/Annot/DrawingAnnot/PolygonTools", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotToolHandler", "core/Plugins/Annot/DistanceAnnot/DistanceRulerView", "core/Plugins/Annot/DistanceAnnot/RulerView", "core/Plugins/Annot/DistanceAnnot/Ruler", "core/Plugins/Annot/DistanceAnnot/DistanceToolPopup", "core/Plugins/Annot/CommentAnnot/CommentAnnotToolHandler", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/InkAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/InkTools", "core/Plugins/CommentList/CommentListPlugin", "core/Plugins/CommentList/CommentListService", "core/Plugins/CommentList/MobileCommentListView", "core/Plugins/CommentList/CommentListView", "core/Plugins/CommentList/PCCommentListView", "core/Plugins/Signature/SignaturePlugin", "core/Plugins/Signature/SignatureView", "core/Plugins/Signature/SignatureService", "core/Plugins/Signature/NormalSigToolHandler", "core/Plugins/Signature/StraddleSigToolHandler", "core/Plugins/Signature/SignatureMouseHandler", "core/Plugins/InkSign/InkSignPlugin", "core/Plugins/InkSign/InkSignToolHandler", "core/Plugins/InkSign/PDFInkSignLoader", "core/Plugins/InkSign/MobileInkSignView", "core/Plugins/InkSign/InkSignView", "core/Plugins/InkSign/PCInkSignView", "core/Plugins/InkSign/InkSignService", "core/Plugins/PanAndZoom/panAndZoomPlugin", "core/Plugins/PanAndZoom/panAndZoomView", "core/Plugins/PanAndZoom/panAndZoomMousePtHandler", "core/Plugins/Snapshot/SnapshotPlugin", "core/Plugins/Snapshot/SnapshotToolHandler", "core/Interface/IReaderToolHandler", "core/Interface/IReaderPlugin"], function(a, b, c) {
        function d(a, b) {
            function c() {
                window.document.addEventListener("touchstart", function(a) {
                    $("#fwr-annots-context-menu").hide(), $("#fwr-textSelect-context-menu").hide()
                }, !1), d.off("touchstart touchmove touchend").on("touchstart touchmove touchend", function(a) {
                    var c = 0,
                        d = 0;
                    switch (a.type) {
                        case "touchstart":
                            if ("fx_doc_qrcode_image" != a.currentTarget.id && $("#fx_doc_qrcode_image").hide(), !a.originalEvent) return;
                            if (a.originalEvent && null != a.originalEvent.touches && 1 != a.originalEvent.touches.length) return;
                            var f = a.originalEvent.touches[0],
                                h = f.target;
                            if (e.Common.isElemInteractive(b, h)) return !0;
                            g.onLButtonDown(f), i = !0;
                            break;
                        case "touchmove":
                            if (null != a.originalEvent.touches && 1 != a.originalEvent.touches.length) return;
                            var f = a.originalEvent.touches[0];
                            if (e.Common.isElemInteractive(b, f.target)) return;
                            c = f.pageX, d = f.pageY, g.onMouseMove(f), a.preventDefault(), a.stopPropagation();
                            break;
                        case "touchend":
                            if (!a.originalEvent) return;
                            var f = a.originalEvent.changedTouches[0];
                            if (e.Common.isElemInteractive(b, f.target)) return;
                            c = f.pageX, d = f.pageY, a.pageX = c, a.pageY = d, g.onLButtonUp(a), i = !1
                    }
                }), q || (q = new Hammer(d.get(0))), q.add(new Hammer.Pinch);
                var a = !0;
                q.off("pinchin").on("pinchin", function(b) {
                    if (a) {
                        a = !1;
                        var c = h.getMainView().getDocView();
                        c.zoomPageOnPoint(-.03, b.center.x, b.center.y), a = !0
                    }
                    b.preventDefault()
                });
                var c = !0;
                q.off("pinchout").on("pinchout", function(a) {
                    if (c) {
                        c = !1;
                        var b = h.getMainView().getDocView();
                        b.zoomPageOnPoint(.03, a.center.x, a.center.y), c = !0
                    }
                    a.preventDefault()
                }), q.off("doubletap").on("doubletap", function(a) {
                    a.pageX = a.srcEvent.pageX, a.pageY = a.srcEvent.pageY, g.onLButtonDbClick(a)
                }), q.off("press").on("press", function(a) {
                    g.onHold(a), a.preventDefault()
                })
            }
            var d = $("#" + b.getMainFrameId()),
                g = this,
                h = b,
                i = !1,
                j = null,
                k = {
                    onLButtonDown: ["onLButtonDown", "onLButtonDown"],
                    onLButtonUp: ["onLButtonUp", "onLButtonUp"],
                    onRButtonDown: ["onRButtonDown", "onRButtonDown"],
                    onRButtonUp: ["onRButtonUp", "onRButtonUp"],
                    onLButtonDbClick: ["onLButtonDblClk", "onLButtonDbClick"],
                    onRButtonDbClick: ["onRButtonDblClk", "onRButtonDbClick"],
                    onMouseMove: ["onMouseMove", "onMouseMove"],
                    onMouseLeave: ["onMouseLeave", "onMouseLeave"],
                    onMouseEnter: ["onMouseEnter", "onMouseEnter"],
                    onMouseOver: ["onMouseOver", "onMouseOver"],
                    onMouseOut: ["onMouseOut", "onMouseOut"],
                    onDoubleTap: ["onDoubleTap", "onDoubleTap"],
                    onPinchIn: ["onPinchIn", "onPinchIn"],
                    onPinchOut: ["onPinchOut", "onPinchOut"],
                    onHold: ["onHold", "onHold"]
                };
            $.each(k, function(a, b) {
                var c = b[0],
                    d = b[1];
                g[a] = function(a) {
                    var b = h.getCurToolHandler();
                    if (b)
                        if (b.isProcessing()) {
                            if (!b[c]) return;
                            b[c](a)
                        } else {
                            var e = h[d](a);
                            e || b[c](a)
                        }
                }
            }), this.bind = function() {
                return f.mobile ? void c() : ($(document).off("keydown.webpdf").on("keydown.webpdf", function(a) {
                    if (90 == a.keyCode && a.ctrlKey && !h.isJRorMobile()) return h.annotUndo(!0);
                    if (89 == a.keyCode && a.ctrlKey && !h.isJRorMobile()) return h.annotUndo(!1);
                    var b = h.getCurToolHandler();
                    b && $.isFunction(b.onKeyDown) && b.onKeyDown(a)
                }), $(document).off("keydown.webpdf", ".popup_child .fwr_popup_content, .fwr-typewriter-annot-edit, .fwr-callout-annot-edit, .fwr-textbox-annot-edit").on("keydown.webpdf", ".popup_child .fwr_popup_content, .fwr-typewriter-annot-edit, .fwr-callout-annot-edit, .fwr-textbox-annot-edit", function(a) {
                    var b = !0;
                    return 90 == a.keyCode && a.ctrlKey && !h.isJRorMobile() ? (h.annotUndo(!0), b = !1) : 89 == a.keyCode && a.ctrlKey && !h.isJRorMobile() && (h.annotUndo(!1), b = !1), b
                }), $(document).off("keyup.webpdf").on("keyup.webpdf", function(a) {
                    // if (27 == a.keyCode) {
                    //     var b = h.getToolHandlerByName(e.Tools.TOOL_NAME_HAND);
                    //     h.setCurToolHandler(b)
                    // }
                    var c = h.getCurToolHandler();
                    c && $.isFunction(c.onKeyUp) && c.onKeyUp(a)
                }), $(document).bind("mouseup", function(a) {
                    i && d.trigger("mouseup")
                }), d.off("mousedown").on("mousedown", function(a) {
                    var c = a.target;
                    if (0 === a.button || 1 === a.button) {
                        var d = h.getMainView();
                        if (!d) return !1;
                        var f = d.getDocView(),
                            k = f.getDocViewClientRect();
                        if (!e.RectUtils.ptInRect(k, a.pageX, a.pageY)) return !0;
                        if (e.Common.isElemInteractive(b, c)) return !0;
                        e.Common.preventDefaults(a, !0), c.setCapture ? (j = c, j.setCapture()) : window.captureEvents && window.captureEvents(Event.MOUSEUP), document.activeElement && $.isFunction(document.activeElement.blur), document.getElementById(f.getDocViewContainerID()).focus(), g.onLButtonDown(a), i = !0
                    } else(2 === a.button || 3 === a.button) && g.onRButtonDown(a);
                    return !0
                }), d.off("mousemove").on("mousemove", function(a) {
                    return g.onMouseMove(a), !0
                }), d.off("mouseup").on("mouseup", function(a) {
                    return !i && e.Common.isElemInteractive(b, a.target) ? !0 : (a.button && 0 !== a.button && 1 !== a.button ? (2 === a.button || 3 === a.button) && g.onRButtonUp(a) : (j && j.releaseCapture ? j.releaseCapture() : window.releaseEvents && window.releaseEvents(Event.MOUSEUP), g.onLButtonUp(a)), i = !1, j = null, !0)
                }), d.off("dblclick").on("dblclick", function(a) {
                    return e.Common.isElemInteractive(b, a.target) ? !0 : (e.Common.preventDefaults(a, !0), 0 === a.button || 1 === a.button ? g.onLButtonDbClick(a) : (2 === a.button || 3 === a.button) && g.onRButtonDbClick(a), !0)
                }), d.off("mouseover").on("mouseover", function(a) {
                    if (i) {
                        var b = $(a.target);
                        if (b.hasClass("fwrJspTrack")) return g.onLButtonUp(a), !1
                    }
                    g.onMouseOver(a)
                }), d.off("mouseout").on("mouseout", function(a) {
                    g.onMouseOut(a)
                }), d.off("mouseleave").on("mouseleave", function(a) {
                    g.onMouseLeave(a)
                }), void d.off("mouseenter").on("mouseenter", function(a) {
                    g.onMouseEnter(a)
                }))
            }
        }
        a("core/uupaa-color.mini"), a("core/uupaa-excanvas");
        var e = a("core/WebPDF");
        a("core/Common/Environment");
        var f = e.Environment;
        a("core/Framework/Config"), a("core/Common/Support");
        var g = e.Config;
        a("core/Common/Math/Rect"), a("core/Common/Math/Point"), a("core/Common/Math/JSMap"), a("core/Common/Math/Matrix"), a("core/Common/CommonDialog"), a("core/Tools/Tools"), a("core/Plugins/Action/PDFDestination");
        var h = a("core/Framework/View/MainFrame"),
            i = (a("core/Framework/View/PDFDocView"), null);
        $.support.canvas || (a("core/uupaa-color.mini"), a("core/uupaa-excanvas")), a("core/Interface/IMainFrmEventHandler"), a("core/Interface/IMousePtHander");
        var j, k = a("core/Tools/HandToolHandler"),
            l = a("core/Plugins/Menu/MenuItem"),
            m = a("core/Framework/View/LayoutInfo");
        a("core/Plugins/Text/TextManager");
        var n = a("core/Plugins/Offline/OfflineFileCache"),
            o = e.Common,
            p = null;
        e.Tool = {
            readerApp: null,
            getReaderApp: function() {
                return e.Tool.readerApp
            },
            setReaderApp: function(a) {
                e.Tool.readerApp = a
            }
        };
        var q = null;
        return e.ReaderEngineType = {
            IMAGE: 0,
            HTML5: 1
        }, e.ConversionState = {
            SUCCESS: 0,
            INITIALIZE: 1,
            IN_PROGRESS: 2,
            SERVICE_BUSY: 3,
            CONVERSION_ERROR: 4,
            UNKNOWN_ERROR: 5
        }, e.PDFError = {
            ERROR_UNKNOWN: -1,
            ERROR_SUCCESS: 0,
            ERROR_PDFPARSE_FILE: 1,
            ERROR_PDFPARSE_FORMAT: 2,
            ERROR_PDFPARSE_PASSWORD: 3,
            ERROR_PDFPARSE_HANDLER: 4,
            ERROR_PDFPARSE_CERT: 5,
            ERROR_COM_CALL: 6,
            ERROR_EXCEPTION: 7,
            ERROR_MANIFEST_GET_ERROR: 8,
            ERROR_FILE_WRITE_ERROR: 9,
            ERROR_CREATE_IMAGE_ERROR: 10,
            ERROR_CREATE_TEXT_ERROR: 11,
            ERROR_CREATE_PATH_ERROR: 12,
            ERROR_PDFPARSE_PAGE_COUNT_EXCEED: 13,
            ERROR_CREAT_FORM_INFO_ERROR: 14,
            ERROR_CACHE_ERROR: 15,
            ERROR_LICENSE_ERROR: 16,
            ERROR_PDFPARSE_FOXITCONNECTEDDRM: 17,
            ERROR_USER_NOTLOGIN: 18,
            ERROR_NETWORK_ERROR: 19,
            ERROR_USER_NOPERMISSION: 20
        }, e.PDFDocType = {
            PDF: 1,
            FORM: 2,
            XFA: 3
        }, e.PDFPermission = {
            FPDFPERM_PRINT: 4,
            FPDFPERM_MODIFY: 8,
            FPDFPERM_EXTRACT: 16,
            FPDFPERM_ANNOT_FORM: 32,
            FPDFPERM_FILL_FORM: 256,
            FPDFPERM_EXTRACT_ACCESS: 512,
            FPDFPERM_ASSEMBLE: 1024,
            FPDFPERM_PRINT_HIGH: 2048
        }, e.UserPermission = {
            DOCUMENT_VIEW: 1,
            USER_ADMIN: 2,
            EXTRACTCONTENT: 4,
            PRINT: 8,
            DOWNLOAD: 16,
            COMMENT: 32,
            SIGNATURE: 64,
            FORM: 128,
            OFFONLINE: 256
        }, e.ReaderApp = function(b, c, q, r, s, t, u) {
            function v(a, b) {
                Ma = !1, Sa = a.val(), Sa = e.Common.base64encode(Sa), Ra = b, Ta = g.defaults.maxManifestRetryCount, e.waiting(wa, null, i18n.t("Load.Opening")), z(Sa)
            }

            function w(a) {
                return 0 == (ka & a) ? !1 : !0
            }

            function x(a) {
                if ($.isPlainObject(a) && "undefined" != typeof a.error && "undefined" != typeof a.status) {
                    var b = a.error;
                    if (0 != b)
                        if (b == e.PDFError.ERROR_PDFPARSE_PASSWORD) {
                            e.closeWaiting(wa);
                            var c = '{"DocSecurity":"PasswordEncryption","Status":"Attempt to open password protected file."}';
                            wa.addRecord("ReadOnly", "Open", c), Na || (e.confirmPassword(wa, "", i18n.t("ParseError.EnterPassword"), v), Na = !0), Ma || Ra.html("<span style='color:red'>" + i18n.t("ParseError.PasswordIncorrect") + "</span>")
                        } else {
                            if (b == e.PDFError.ERROR_USER_NOTLOGIN) {
                                e.closeWaiting(wa), ua = 1;
                                var c = '{"DocSecurity":"cDRMEncryption","Status":"Attempt to open FoxitConnectedPDFDRM protected file without login."}';
                                wa.addRecord("ReadOnly", "Open", c);
                                var d = e.AccountInstance.getLoginProcessor();
                                return void(d && d.showSignInDialog())
                            }
                            if (b == e.PDFError.ERROR_USER_NOPERMISSION) {
                                var f = a.ownerEmail,
                                    h = i18n.t("cPDFError.NoPermissionToOpenDRMDocument"),
                                    i = h.indexOf("("),
                                    j = h.indexOf(")"),
                                    k = h.substring(0, i + 1) + f + h.substring(j, h.length);
                                e.alert(wa, i18n.t("CommonDialog.DefaultDlgTitle"), k), e.closeWaiting(wa), ua = 1;
                                var c = '{"DocSecurity":"cDRMEncryption","Status":"Attempt to open FoxitConnectedPDFDRM protected file without authorization."}';
                                wa.addRecord("ReadOnly", "Open", c)
                            } else if (b == e.PDFError.ERROR_NETWORK_ERROR) {
                                e.alert(wa, i18n.t("CommonDialog.DefaultDlgTitle"), i18n.t("cPDFError.NetWorkOrServerError")), e.closeWaiting(wa);
                                var c = '{"Status":"Failed to open the file for the network not avaiable."}';
                                wa.addRecord("ReadOnly", "Open", c)
                            } else if (b === e.PDFError.ERROR_PDFPARSE_FOXITCONNECTEDDRM) {
                                if (!e.ConnectPdf) return e.alert(wa, i18n.t("CommonDialog.DefaultDlgTitle"), i18n.t("ParseError.ErrHandle")), void e.closeWaiting(wa)
                            } else {
                                var l = a.status;
                                if (e.Common.isNeedRetry(l)) Ta--, setTimeout(function() {
                                    z.call(wa, Sa, !0, Ta)
                                }, g.defaults.requestRetryInterval);
                                else {
                                    Na = !1, e.endConfirmPassword(), e.closeWaiting(wa);
                                    var c = '{"Status":"Failed to open the file."}';
                                    wa.addRecord("ReadOnly", "Open", c), B(b, l)
                                }
                            }
                        }
                } else {
                    e.alert(wa, i18n.t("CommonDialog.DefaultDlgTitle"), i18n.t("ParseError.LoadError")), e.closeWaiting(wa);
                    var c = '{"Status":"Failed to open the file."}';
                    wa.addRecord("ReadOnly", "Open", c)
                }
            }

            function y(a, b) {
                if (e.closeWaiting(wa), e.endConfirmPassword(), S.setReaderApp(wa), S.setImageRenderEngine(), !a) {
                    var c = '{"Status":"Failed to open the file."}';
                    return wa.addRecord("ReadOnly", "Open", c), void e.alert(wa, i18n.t("CommonDialog.DefaultDlgTitle"), i18n.t("ParseError.LoadError"))
                }
                try {
                    O = a, Ma = !0;
                    var d = new m;
                    if (U = new h(P, Q, O, S, d, wa), wa.isOffline()) {
                        var g = wa.getCurOfflineFile(),
                            i = JSON.parse(g);
                        if (i.uuid == Qa) {
                            var k = U.getDocView();
                            k.onZoom(i.zoom), k.gotoPage(i.pageIndex, 0, i.offsetTop)
                        }
                    }
                    if (wa.onResize(), $(window).resize) try {
                        $(window).resize()
                    } catch (l) {}
                    var n = O.hasPermission(e.PDFPermission.FPDFPERM_PRINT) && w(e.UserPermission.PRINT);
                    ba = O.hasPermission(e.PDFPermission.FPDFPERM_ANNOT_FORM) && w(e.UserPermission.COMMENT);
                    var o = (O.hasPermission(e.PDFPermission.FPDFPERM_ANNOT_FORM) || O.hasPermission(e.PDFPermission.FPDFPERM_FILL_FORM)) && w(e.UserPermission.FORM);
                    Z = O.hasPermission(e.PDFPermission.FPDFPERM_EXTRACT) && w(e.UserPermission.EXTRACTCONTENT);
                    var p = O.hasPermission(e.PDFPermission.FPDFPERM_MODIFY),
                        q = O.hasPermission(e.PDFPermission.FPDFPERM_ANNOT_FORM) && p && w(e.UserPermission.SIGNATURE),
                        s = w(e.UserPermission.OFFONLINE),
                        t = O.hasPermission(e.UserPermission.USER_ADMIN),
                        u = {
                            isAnnot: ba,
                            isForm: o,
                            isCopyText: Z,
                            isPrint: n,
                            isSignature: q,
                            userAdmin: t
                        };
                    wa.setDocPermission(u), ba = r.plugins & e.Config.Plugins.flag.Comments ? ba : !1, o = r.plugins & e.Config.Plugins.flag.Form ? o : !1, q = r.plugins & e.Config.Plugins.flag.Signature ? q : !1, Y = !ba && !o && !q;
                    var v = r.disablePrint ? !0 : !n;
                    _ = !v, aa = R.disableDownload ? !0 : !w(e.UserPermission.DOWNLOAD), document.getElementById(U.getDocView().getDocViewContainerID()).focus(), L(), j.createTextSelectToolHandler(), J(), v && wa.disablePrint();
                    var x = wa.getToolHandlerByName(e.Tools.TOOL_NAME_HAND);
                    wa.setCurToolHandler(x), Ua = !0, V.init(), ua = O.getSecurityType(), 1 === ua && D();
                    var y = e.AccountInstance.isLogin();
                    y ? $(".cwebpdf-login")[0] && $(".cwebpdf-login").parents(".fx-balloon-msg").remove() : f.mobile && C(), ta = e.Common.formatDate(new Date, e.Common.CollectTimeFormat);
                    var c = '{"Status":"Successful"}';
                    wa.addRecord("ReadOnly", "Open", c), wa.collectTurnPageData(-1, 0), e.documentLoad && $.isFunction(e.documentLoad) && e.documentLoad();
                    var z = "",
                        A = "";
                    if (wa.isOffline()) {
                        var g = wa.getCurOfflineFile(),
                            i = JSON.parse(g);
                        i.uuid == Qa && ($(wa).trigger(e.EventList.DOCVIEW_ZOOM_CHANGED, {
                            oldScale: 1,
                            newScale: i.zoom
                        }), $(wa).trigger(e.EventList.DOCVIEW_PAGE_CHANGED, {
                            oldIndex: 0,
                            curIndex: i.pageIndex,
                            isPageLoaded: !1
                        })), z = i18n.t("PCLng.ToolBar.Online"), A = i18n.t("PCLng.ToolBar.OnlineTip")
                    } else z = i18n.t("PCLng.ToolBar.Offline"), A = i18n.t("PCLng.ToolBar.OfflineTip");
                    var u = wa.getDocPermission(),
                        B = wa.isOffline();
                    B && (s = !0, aa = !0, v = !0), $(wa).trigger(e.EventList.OFFLINEMODE_CHANGED, {
                        plugins: R.plugins,
                        readOnly: Y,
                        disablePrint: v,
                        disableDownload: aa,
                        docPermission: u,
                        securityType: ua,
                        isOffline: B,
                        title: z,
                        tips: A,
                        isLargeFile: ma
                    }), $(wa).trigger(e.EventList.DOCUMENT_LOADED, {
                        plugins: R.plugins,
                        readOnly: Y,
                        disablePrint: v,
                        disableDownload: aa,
                        docPermission: u,
                        securityType: ua,
                        disableOffonline: !s
                    }), $(wa).trigger(e.EventList.DOCVIEW_PAGE_CHANGED, {
                        oldIndex: -1,
                        curIndex: 0
                    })
                } catch (l) {
                    console.error(l);
                    var c = '{"Status":"Failed to open the file."}';
                    return wa.addRecord("ReadOnly", "Open", c), !1
                }
                return !0
            }

            function z(a, b) {
                return 0 >= Ta ? (e.closeWaiting(wa), void B(e.PDFError.ERROR_UNKNOWN, e.ConversionState.SERVICE_BUSY)) : void T.asyncLoadDocument(wa, a, b, y, x)
            }

            function A() {
                e.Engine.JR || $.ajax({
                    type: "GET",
                    url: r.baseUrl + "api/file/info",
                    data: {
                        fileId: X
                    },
                    success: function(a) {
                        N || (N = a.fname)
                    }
                })
            }

            function B(a, b) {
                var c = null,
                    d = e.PDFError;
                switch (a) {
                    case d.ERROR_COM_CALL:
                    case d.ERROR_PDFPARSE_FILE:
                        e.alert(wa, c, i18n.t("ParseError.FailToOpen"));
                        break;
                    case d.ERROR_PDFPARSE_FORMAT:
                        e.alert(wa, c, i18n.t("ParseError.ErrFormat"));
                        break;
                    case d.ERROR_PDFPARSE_HANDLER:
                        e.alert(wa, c, i18n.t("ParseError.ErrHandle"));
                        break;
                    case d.ERROR_PDFPARSE_CERT:
                        e.alert(wa, c, i18n.t("ParseError.ErrCert"));
                        break;
                    case d.ERROR_PDFPARSE_PAGE_COUNT_EXCEED:
                        e.alert(wa, c, i18n.t("ParseError.ErrPage"));
                        break;
                    case d.ERROR_LICENSE_ERROR:
                        e.alert(wa, c, i18n.t("ParseError.ErrLicenseExpired"));
                        break;
                    default:
                        b == e.ConversionState.SERVICE_BUSY ? e.alert(wa, c, i18n.t("ParseError.ServiceBusy")) : e.alert(wa, c, i18n.t("ParseError.FailToOpen"))
                }
            }

            function C() {
                var a = $("#" + U.getDocView().getDocViewContainerID()),
                    b = "<div id='user_notlogin_tips' class='fwr-notlogin-tips' style='display: none;'>" + i18n.t("NotLoginTips") + "</div>";
                a.append(b);
                var c = $("#user_notlogin_tips"),
                    d = c.width(),
                    e = parseFloat(c.css("padding-left"));
                c.css({
                    "margin-left": "" + -(d / 2 + e) + "px"
                }), c.show(), setTimeout(function() {
                    c.hide()
                }, 3e3)
            }

            function D() {
                var a = "drm_tips",
                    b = $("#" + U.getDocView().getDocViewContainerID());
                b.append("<div id='" + a + "' class='fwr-drmtips-div' style='display: none;'>" + i18n.t("cDRMTips") + "</div>");
                var c = $("#" + a),
                    d = (b.height(), c.width());
                c.height();
                c.css({
                    "margin-left": "" + -1 * d / 2 + "px"
                }), e.Environment.mobile ? (c.css({
                    "background-color": "rgba(0,0,0,.8)"
                }), c.css({
                    color: "#ffffffff"
                })) : c.css({
                    border: "1px solid #E1DD66"
                }), c.show(), setTimeout(function() {
                    c.hide()
                }, 3e3)
            }

            function E() {
                return new Promise(function(a, b) {
                    wa.isOffline() ? a() : $.ajax({
                        url: e.optionParameters.serverBaseUrl + "api/config",
                        type: "GET",
                        cache: !1,
                        data: {
                            params: ["tile"]
                        },
                        async: !1,
                        success: function(b) {
                            if (0 != b.resultCode) return void console.err("request config fail,restule is :" + b);
                            var c = {
                                enable: !0,
                                size: 400
                            };
                            b.resultBody && b.resultBody.tile && $.extend(c, JSON.parse(b.resultBody.tile)), $.extend(!0, Configs, {
                                tile: c
                            }), a()
                        },
                        error: function(a) {
                            console.error("request config err", a), b(a)
                        }
                    })
                })
            }

            function F() {
                return new Promise(function(a, b) {
                    wa.isOffline() ? (W = "127.0.0.1", a()) : $.ajax({
                        url: e.optionParameters.serverBaseUrl + "asserts/ip",
                        type: "GET",
                        async: !1,
                        success: function(b) {
                            W = b.result, a()
                        },
                        error: function() {
                            b()
                        }
                    })
                })
            }

            function G() {
                return new Promise(function(a, b) {
                    $.ajax({
                        method: "GET",
                        url: e.serverBaseUrl + "api/config/plugins",
                        cache: !1,
                        dataType: "json",
                        success: function(b) {
                            b = $.parseJSON(b.result);
                            var c = 1023;
                            b && b.plugin && (c = b.plugin), wa.setPlugin(c), a()
                        },
                        error: function() {
                            wa.setPlugin(1023), a()
                        }
                    })
                })
            }

            function H() {
                return new Promise(function(a, b) {
                    var c = R.baseUrl + "api/systemuser/permission",
                        d = {};
                    apiConfig && apiConfig.user && "object" == typeof apiConfig.user.getUserPermission ? d = apiConfig.user.getUserPermission : apiConfig && apiConfig.user && "function" == typeof apiConfig.user.getUserPermission ? d = apiConfig.user.getUserPermission() : console.error("apiConfig.user.getUserPermission format error,mush object or function"), d = d ? d : {};
                    var f = {
                        params: JSON.stringify(d),
                        uuid: X
                    };
                    $.ajax({
                        url: c,
                        dataType: "json",
                        headers: {
                            accessToken: e.AccountInstance.getAccessToken()
                        },
                        data: f,
                        success: function(c) {
                            if (!c) return b(), console.error("failed to get user permission!"), !1;
                            var d = c.error;
                            return 0 == d ? (ka = c.permission, a(), !0) : (b(), console.error("failed to get user permission!"), !1)
                        },
                        error: function() {
                            return b(), console.error("failed to get user permission!"), !1
                        }
                    })
                })
            }

            function I() {
                var a = O.hasPermission(e.PDFPermission.FPDFPERM_PRINT) && w(e.UserPermission.PRINT);
                ba = O.hasPermission(e.PDFPermission.FPDFPERM_ANNOT_FORM) && w(e.UserPermission.COMMENT);
                var b = (O.hasPermission(e.PDFPermission.FPDFPERM_ANNOT_FORM) || O.hasPermission(e.PDFPermission.FPDFPERM_FILL_FORM)) && w(e.UserPermission.FORM);
                Z = O.hasPermission(e.PDFPermission.FPDFPERM_EXTRACT) && w(e.UserPermission.EXTRACTCONTENT);
                var c = O.hasPermission(e.PDFPermission.FPDFPERM_MODIFY),
                    d = O.hasPermission(e.PDFPermission.FPDFPERM_ANNOT_FORM) && c && w(e.UserPermission.SIGNATURE),
                    f = {
                        isAnnot: ba,
                        isForm: b,
                        isCopyText: Z,
                        isPrint: a,
                        isSignature: d
                    };
                wa.setDocPermission(f), ba = r.plugins & e.Config.Plugins.flag.Comments ? ba : !1, b = r.plugins & e.Config.Plugins.flag.Form ? b : !1, d = r.plugins & e.Config.Plugins.flag.Signature ? d : !1, Y = !ba && !b && !d;
                var g = r.disablePrint ? !0 : !a;
                _ = !g, aa = R.disableDownload ? !0 : !w(e.UserPermission.DOWNLOAD)
            }

            function J() {
                $.each(Ba, function(a, b) {
                    try {
                        b.init()
                    } catch (c) {
                        console.error(c)
                    }
                    return !0
                })
            }

            function K(a, b) {
                var c = !1;
                if ("StrikeOutTextEdit" == b.it) {
                    var d = a.getPDFPage().getAnnotByName(b.irt);
                    d.setGrp(b.n), c = !0
                }
                return c
            }

            function L() {
                var a = $("#" + U.getDocView().getDocViewContainerID());
                a.length <= 0 && $.error("Doc view container is not exist!"), new d(a, wa).bind()
            }
            var M = b,
                N = c,
                O = null,
                P = q,
                Q = s,
                R = r,
                S = u,
                T = t,
                U = null,
                V = null,
                W = "",
                X = M.split("/")[M.split("/").length - 2],
                Y = !0,
                Z = !1,
                _ = !1,
                aa = !1,
                ba = !1,
                ca = !1,
                da = !1,
                ea = !1,
                fa = !1,
                ga = !1,
                ha = !1,
                ia = !1,
                ja = {},
                ka = 0,
                la = null,
                ma = !1,
                na = null,
                oa = null,
                pa = !1,
                qa = !1;
            this.isMobile = function() {
                var a = !1;
                return navigator.userAgent.match(/mobile|Android|iPhone|ios|iPod/i) && (a = !0), a
            };
            var ra = null,
                sa = null;
            this.loadDataControl = function(b, c) {
                b && null == ra && this.loadWorker(c), p = null, p = a("core/Framework/DataControls").createDataControls(b, ra)
            }, this.loadWorker = function(a) {
                function b(b) {
                    e.closeWaiting(), null == a && (a = "Load Worker fail"), e.alert(wa, null, a, "OK", null, !0, 0)
                }
                // For poc
                function c(a) {}!this.isMobile() && e.Engine.JR && (ra && (ra.terminate(), ra = null), ra = new Worker(getBaseUrl() + "eplayer/pdf/foxit_client_lib/fxcore_worker.js"), ra.addEventListener("error", b, !0), ra.addEventListener("message", c, !0), ra.postMessage({
                    type: "initWorker",
                    baseUrl: e.optionParameters.serverBaseUrl
                }))
            }, this.getWorker = function() {
                return ra
            }, this.getDataControl = function() {
                return p
            }, this.clearJR = function() {
                for (var a = U.getDocView().getPageCount(), b = 0; a > b; b++) {
                    var c = U.getDocView().getPageView(b);
                    c.setPageLoaded(!1)
                }
                U.getDocView().clearCache()
            };
            var ta = null,
                ua = 0,
                va = null;
            this.getOpenTimeEx = function() {
                return ta
            }, this.closeCurrentDocument = function() {
                O && O.clearAnnotUndo(), Qa = "", M = "", N = "", O = null, sa = null, S = null, T = null, U = null, V = null, X = "", Y = !0, Z = !1, _ = !1, aa = !1, ta = null, ua = 0, ma = !1, na = null, oa = null
            }, this.collectTurnPageData = function(a, b) {
                if (-1 == a || null == va) {
                    var c = new Date,
                        d = c.getHours() + c.getTimezoneOffset() / 60;
                    c.setHours(d), va = e.Common.formatDate(c, e.Common.CollectTimeFormat)
                } else {
                    var c = new Date,
                        d = c.getHours() + c.getTimezoneOffset() / 60;
                    c.setHours(d);
                    var f = e.Common.formatDate(c, e.Common.CollectTimeFormat),
                        g = {
                            EntryTime: va,
                            LeaveTime: f,
                            PageFrom: a,
                            PageTo: b
                        };
                    g = JSON.stringify(g), this.addRecord("ReadOnly", "TurnPage", g), va = f
                }
            }, this.getDocId = function() {
                return O ? O.getDocId() : ""
            }, this.setAnnotEventInit = function(a) {
                ca = a
            }, this.isAnnotEventInit = function() {
                return ca
            }, this.setMarkUpEventInit = function(a) {
                da = a
            }, this.isMarkUpEventInit = function() {
                return da
            }, this.setFindToolEventInit = function(a) {
                ea = a
            }, this.isFindToolEventInit = function() {
                return ea
            }, this.setSignatureEventInit = function(a) {
                fa = a
            }, this.isSignatureEventInit = function() {
                return fa
            }, this.isCommentlistEventInit = function() {
                return ia
            }, this.setCommentlistEventInit = function(a) {
                ia = a
            }, this.setInkSignEventInit = function(a) {
                ga = a
            }, this.isInkSignEventInit = function() {
                return ga
            }, this.setTextSelectEventInit = function(a) {
                ha = a
            }, this.isTextSelectEventInit = function() {
                return ha
            }, this.setDocumentHandle = function(a) {
                T = a
            }, this.setPageViewRender = function(a) {
                S = a
            }, this.setOptions = function(a) {
                R = a
            }, this.isDocumentLoaded = function() {
                return T ? T.isDocumentLoaded() : !1
            }, this.isLargeFile = function() {
                return ma
            }, this.supportedMaxScale = function() {
                return ma ? 2 : 1 / 0
            }, this.openLargeFileMode = function() {
                ma = !0
            }, this.getLargeFileTaskId = function() {
                return na
            }, this.getLargeFileDocId = function() {
                return oa
            }, this.isLargeFileReady = function() {
                return ma ? Promise.resolve(null != oa) : Promise.resolve(!0)
            }, this.setLargeFileTaskId = function(a) {
                na = a
            }, this.setLargeFileDocId = function(a) {
                oa = a
            }, this.getUserPermission = function() {
                return ka
            }, this.setOffline = function(a) {
                return ma ? void console.warn("offline mode is not supported whlie a large file openning") : void localStorage.setItem("isOffLine", a)
            }, this.setCurOfflineFile = function(a) {
                ma || localStorage.setItem("OffLineFile", a)
            }, this.getCurOfflineFile = function() {
                return localStorage.getItem("OffLineFile")
            }, this.setCurFile = function(a) {
                ja = a
            }, this.isOffline = function() {
                if (e.ConnectPdf || window.PhantomOnline || e.Environment.mobile || ma) return !1;
                var a = localStorage.getItem("isOffLine");
                return "true" == a || 1 == a
            };
            var wa = this;
            F(), E();
            var xa = new Date,
                ya = xa.valueOf(),
                za = Math.floor(ya / 1e3).toString(),
                Aa = o.timestampToDateString(za, o.WaterMarkTimeFormat),
                Aa = o.timestampToDateString(za, o.WaterMarkTimeFormat),
                Ba = {},
                Ca = [],
                Da = {},
                Ea = null,
                Fa = [],
                Ga = {},
                Ha = !aa,
                Ia = !1,
                Ja = null,
                Ka = "x-auth-token",
                La = 0,
                Ma = !0,
                Na = !1,
                Oa = null,
                Pa = localStorage.getItem("isOffLine"),
                Qa = "";
            Pa && (e.Engine || (e.Engine = {}, e.Engine.JR = !0, R.plugins = 1023 & ~e.Config.Plugins.flag.Comments & ~e.Config.Plugins.flag.Form & ~e.Config.Plugins.flag.Signature));
            var Ra = null,
                Sa = "",
                Ta = 0,
                Ua = !1,
                Va = [];
            this.reloadDocument = function() {
                1 === ua && (Ta--, setTimeout(function() {
                    z.call(wa, Sa, !0, Ta)
                }, g.defaults.requestRetryInterval))
            }, this.getBookmark = function() {
                return V
            }, this.isAnnot = function() {
                return ba
            }, this.isDocLoaded = function() {
                return Ua
            }, this.setPDFbuffer = function(a) {
                sa = a
            }, this.getPDFbuffer = function(a) {
                return sa
            }, this.getTileConfig = function() {
                return this.isOffline() ? {
                    enable: !1
                } : this.isLargeFile() ? {
                    size: window.Configs.tile.size,
                    enable: !1
                } : window.Configs.tile
            }, this.getFileBuffer = function(a, b, c) {
                if (!e.Engine.JR) {
                    a || (a = X);
                    var d = "",
                        f = "",
                        g = "";
                    if (b) {
                        var h = wa.getPluginByName(e.BASEANNOT_PLUGIN_NAME),
                            i = [];
                        h && (i = h.getAnnotationDataToSave());
                        var d = JSON.stringify(i),
                            j = wa.getPluginByName(e.InkSignPluginName);
                        j && (f = j.getInkSignData()), f = f ? f : ""
                    }
                    var k = "annotsData=" + d + "&formData=" + g + "&inkData=" + f + "&watermarkInfo=" + O.getAllDisaplyWateramrkInfo(),
                        l = new XMLHttpRequest;
                    l.open("POST", r.baseUrl + "asserts/" + a + "/getFileBuffer", !0), l.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), l.responseType = "arraybuffer", l.onload = function(a) {
                        var b = new Uint8Array(this.response);
                        c(b)
                    }, l.send(k)
                }
            }, this.isDocumentCanBePrint = function() {
                return O.hasPermission(e.PDFPermission.FPDFPERM_PRINT)
            }, this.isEditable = function() {
                return !0
            }, this.getUrlConfig = function() {
                return _urlConfig
            }, this.addIgnoreMouseEventClass = function(a) {
                $.isArray(a) ? $.each(a, function(a, b) {
                    wa.addIgnoreMouseEventClass(b)
                }) : a && Va.push(a)
            }, this.getIgnoreMouseEventClasses = function() {
                return Va
            }, this.getAppId = function() {
                return P
            }, this.getMainFrameId = function() {
                return P
            }, this.getOptions = function() {
                return R
            }, this.setPlugin = function(a) {
                R.plugins = a
            }, this.isReadOnly = function() {
                return Y
            }, this.isDisablePrint = function() {
                return !_
            }, this.isDisableDownload = function() {
                return aa
            }, this.isCopyText = function() {
                return Z
            }, this.isFormMode = function() {
                return R.formMode
            }, this.getBaseUrl = function() {
                return R.baseUrl
            }, this.isForm = function() {
                var a = e.Config.Plugins.load;
                return wa.isFormMode() && a.Form === !0 && O.getDocType() == e.PDFDocType.FORM
            }, this.registerBaseModule = function() {
                var b = new k;
                wa.registerToolHandler(b);
                var c = a("core/Plugins/PDFJS/pdfjs");
                wa.registerPlugin(c);
                var d = e.Config.Plugins.load,
                    g = e.Config.Plugins.flag;
                if (f.mobile) {
                    a("core/Plugins/Navigation/NavigationComponent").createNavigationComponent(wa).init();
                    a("core/Plugins/Thumbnail/thumbnailController").createThumbnailController(wa);
                    if (d.Annot === !0 && R.plugins & g.Comments) {
                        var h = a("core/Plugins/Annot/BaseAnnotPlugin");
                        wa.registerPlugin(h);
                        var l = a("core/Plugins/CommentList/CommentListPlugin");
                        wa.registerPlugin(l)
                    }
                    if (d.TextSelection === !0 && (i = a("core/Plugins/TextSelection/TextSelectComponent").createTextSelectComponent(wa)), V = a("core/Plugins/Bookmark/BookmarkController").createBookmarkController(wa), 1 == d.Print && R.plugins & g.Print) {
                        var m = a("core/Plugins/Print/PrintConfig");
                        wa.registerPlugin(m)
                    }
                    if (d.Form === !0 && R.plugins & g.Form) {
                        var n = a("core/Plugins/Form/FormPlugin");
                        wa.registerPlugin(n)
                    }
                    if (R.plugins & g.InkSign) {
                        var o = a("core/Plugins/InkSign/InkSignPlugin");
                        wa.registerPlugin(o)
                    }
                    if (R.plugins & g.InkSign || R.plugins & g.Signature) {
                        var p = a("core/Plugins/Signature/SignaturePlugin");
                        wa.registerPlugin(p)
                    }
                    a("core/Plugins/FindTool/SearchComponent").createSearchComponent(wa)
                } else {
                    var q = a("core/Plugins/Loupe/LoupePlugin");
                    wa.registerPlugin(q);
                    var r = a("core/Plugins/MarqueeTool/MarqueeToolPlugin");
                    if (wa.registerPlugin(r), 1 == d.Print && R.plugins & g.Print) {
                        var m = a("core/Plugins/Print/PrintConfig");
                        wa.registerPlugin(m)
                    }
                    a("core/Plugins/Navigation/NavigationComponent").createNavigationComponent(wa).init();
                    a("core/Plugins/Thumbnail/thumbnailController").createThumbnailController(wa);
                    if (V = a("core/Plugins/Bookmark/BookmarkController").createBookmarkController(wa), d.DocProperties === !0) {
                        var s = a("core/Plugins/DocProperties/DocPropertiesPlugin");
                        wa.registerPlugin(s)
                    }
                    if (d.Form === !0) {
                        var n = a("core/Plugins/Form/FormPlugin");
                        wa.registerPlugin(n)
                    }
                    if (d.TextSelection === !0 && (j = a("core/Plugins/TextSelection/TextSelectComponent").createTextSelectComponent(wa)), d.Menu === !0 && R.plugins & g.Menu) {
                        var t = a("core/Plugins/Menu/MenuPlugin");
                        wa.registerPlugin(t)
                    }
                    if (a("core/Plugins/FindTool/SearchComponent").createSearchComponent(wa), d.Annot === !0 && R.plugins & g.Comments) {
                        var h = a("core/Plugins/Annot/BaseAnnotPlugin");
                        wa.registerPlugin(h);
                        var l = a("core/Plugins/CommentList/CommentListPlugin");
                        wa.registerPlugin(l)
                    }
                    if (R.plugins & g.Signature) {
                        var p = a("core/Plugins/Signature/SignaturePlugin");
                        wa.registerPlugin(p)
                    }
                    if (!e.Engine.JR && R.plugins & g.InkSign) {
                        var o = a("core/Plugins/InkSign/InkSignPlugin");
                        wa.registerPlugin(o)
                    }
                    var u = a("core/Plugins/PanAndZoom/panAndZoomPlugin");
                    wa.registerPlugin(u);
                    var v = a("core/Plugins/Snapshot/SnapshotPlugin");
                    wa.registerPlugin(v)
                }
            }, this.disablePrint = function() {
                var a = "body { display:none; }",
                    b = document.head || document.getElementsByTagName("head")[0],
                    c = document.createElement("style");
                c.type = "text/css", c.media = "print", c.styleSheet ? c.styleSheet.cssText = a : c.appendChild(document.createTextNode(a)), b.appendChild(c)
            }, this.canDownloadPDF = function() {
                return Ha
            }, this.setDownloadPDFPermission = function(a) {
                Ha = a
            }, this.getDocPermission = function() {
                return La
            }, this.setDocPermission = function(a) {
                La = a
            }, this.isTrail = function() {
                return Ia
            }, this.setTrail = function(a) {
                Ia = a
            }, this.getSessionId = function() {
                return Ja
            }, this.setSessionId = function(a) {
                Ja = a
            }, this.getSessionIdAuthHeader = function() {
                return Ka
            }, this.print = function() {
                return wa.getPluginByName(e.PrintPluginName).showPrintDlg()
            }, this.getTextManager = function() {
                return null == Oa && (Oa = new e.Text.TextManager(wa)), Oa
            }, this.addMenuItem = function(a) {
                if (null == a) return !1;
                var b = new l(a);
                return Ga[b.name] = b, !0
            }, this.getMenuItem = function(a) {
                return Ga[a]
            }, this.registerMainFrmEventHandler = function(a) {
                return a ? (Fa.push(a), !0) : !1
            }, this.unRegisterMainFrmEventHandler = function(a) {
                if (!a) return !1;
                for (var b = 0; b < Fa.length; b++)
                    if (Fa[b] === a) return delete Fa[b], Fa.splice(b, 1), !0;
                return !1
            }, this.registerMousePtHandler = function(a) {
                return a ? (Y || Ca.push(a), !0) : !1
            }, this.unRegisterMousePtHandler = function(a) {
                if (!a) return !1;
                for (var b = 0; b < Ca.length; b++)
                    if (Ca[b] === a) return delete Ca[b], !0;
                return !1
            }, this.resetResouce = function() {
                if (Ea && "function" == typeof Ea.onDeactivate) try {
                    Ea.onDeactivate()
                } catch (a) {
                    console.error(a)
                }
                Na = !1, Ma = !0, $.each(Ba, function(a, b) {
                    try {
                        b.unload(), delete b
                    } catch (c) {
                        console.error(c)
                    }
                    return !0
                }), Ba = {};
                var b = this.getDataControl();
                b && b.terminate({
                    type: "terminate"
                }), Oa && (delete Oa, Oa = null), $.each(Fa, function(a, b) {
                    wa.unRegisterMainFrmEventHandler(b)
                }), $.each(Da, function(a, b) {
                    delete b
                }), Da = {}, Ea = null, $.each(Ca, function(a, b) {
                    wa.unRegisterMousePtHandler(b)
                }), Ca.length = 0
            }, this.registerPlugin = function(a) {
                if (!a) return null;
                var b = a.createPlugin(wa);
                if (null == b) return null;
                try {
                    var c = b.getName();
                    Ba[c] && $.error("The plugin '" + c + "' has been registered!"), Ba[c] = b, b.onRegister()
                } catch (d) {
                    return console.error(d), null
                }
                return b
            }, this.getPluginByName = function(a) {
                return Ba[a]
            }, this.getFileID = function() {
                return X
            }, this.setFileID = function(a) {
                X = a;
                var b = R.url,
                    c = b.search(/asserts/i);
                b = b.substr(0, c + 8), b = b + X + "/", R.url = b
            }, this.getPDFPassword = function() {
                return Sa
            }, this.getFileName = function() {
                return N
            }, this.setFileName = function(a) {
                N = a
            }, this.getOpenTime = function() {
                return Aa
            }, this.getIP = function() {
                return W
            }, this.getMainView = function() {
                return U
            }, this.getPDFDoc = function() {
                return O
            }, this.getDocView = function() {
                return wa.getMainView().getDocView()
            }, this.getSecurityType = function() {
                return ua
            }, this.initInstance = function() {
                if (M = R.url, X = M.split("/")[M.split("/").length - 2], "null" == X && (X = null), e.destructorDlg(), e.ConnectPdf) return $.ajax({
                    type: "GET",
                    url: r.baseUrl + "api/file/info",
                    data: {
                        fileId: X
                    },
                    success: function(a) {
                        e.Engine.JR || (N = a.fname), ka = -1
                    }
                }), e.waiting(wa, null, i18n.t("")), Ta = g.defaults.maxManifestRetryCount, void z(null, !1);
                if (wa.isOffline()) return A(), e.waiting(wa, null, i18n.t("")), Ta = g.defaults.maxManifestRetryCount, z(null, !1), !0;
                var a = R.baseUrl + "api/systemuser/permission",
                    b = {};
                apiConfig && apiConfig.user && "object" == typeof apiConfig.user.getUserPermission ? b = apiConfig.user.getUserPermission : apiConfig && apiConfig.user && "function" == typeof apiConfig.user.getUserPermission ? b = apiConfig.user.getUserPermission() : console.error("apiConfig.user.getUserPermission format error,mush object or function"), b = b ? b : {};
                var c = {
                    params: JSON.stringify(b),
                    uuid: X
                };
                /*$.ajax({
                    url: a,
                    dataType: "json",
                    headers: {
                        accessToken: e.AccountInstance.getAccessToken()
                    },
                    data: c,
                    success: function(a) {
                        if (!a) return console.error("failed to get user permission!"), !1;
                        var b = a.error;
                        return 0 == b ? (ka = a.permission, w(e.UserPermission.DOCUMENT_VIEW) ? (A(), e.waiting(wa, null, i18n.t("Load.Opening")), Ta = g.defaults.maxManifestRetryCount, z(null, !1), !0) : void e.alert(wa, i18n.t("CommonDialog.DefaultDlgTitle"), i18n.t("User.NoViewPermission"))) : (console.error("failed to get user permission!"), !1)
                    },
                    error: function() {
                        console.error("failed to get user permission!");
                        var a = i18n.t("OffLine.FailToOpenInOnline");
                        return e.alert(e.Tool.getReaderApp(), null, a, null, null, !1, 0), !1
                    }
                })*/
                // For poc
                let aa = {error: 0, permission: -1};
                let bb = aa.error;
                return 0 == bb ? (ka = aa.permission, w(e.UserPermission.DOCUMENT_VIEW) ? (A(), e.waiting(wa, null, i18n.t("Load.Opening")), Ta = g.defaults.maxManifestRetryCount, z(null, !1), !0) : void e.alert(wa, i18n.t("CommonDialog.DefaultDlgTitle"), i18n.t("User.NoViewPermission"))) : (console.error("failed to get user permission!"), !1)
            }, this.onResize = function(a, b) {
                U && U.onResize(a, b), $(wa).trigger(e.EventList.MAINFRAME_RESIZE, {})
            }, this.registerToolHandler = function(a) {
                if (!a) return !1;
                try {
                    var b = a.getName();
                    if (Da[b]) return !0;
                    Da[b] = a, a.onInit(wa)
                } catch (c) {
                    return console.error(c), !1
                }
                return !0
            }, this.setCurToolHandler = function(a) {
                if (!a) return !1;
                var b = Ea;
                if (b !== a && b && b.onDeactivate(), Ea = a, b !== a) {
                    Ea && Ea.onActivate();
                    var c = this.getPluginByName(e.BASEANNOT_PLUGIN_NAME);
                    if (c) {
                        var d = c.getAnnotHandlerMgr();
                        d && d.clearSelection()
                    }
                    $(wa).trigger(e.EventList.TOOL_CHANGED, {
                        oldToolName: b ? b.getName() : "",
                        newToolName: Ea ? Ea.getName() : ""
                    })
                }
                return !0
            }, this.setCurrentToolByName = function(a) {
                if ((e.Engine.JR || e.Engine.isJR || e.Environment.mobile) && (a == e.Tools.TOOL_NAME_LOUPE || a === e.Tools.TOOL_NAME_DRAWING_DISTANCE)) return !1;
                var b = wa.getCurToolHandler(),
                    c = wa.getToolHandlerByName(a);
                return c != b && null != c ? wa.setCurToolHandler(c) : !1
            }, this.getCurToolHandler = function() {
                return Ea
            }, this.getToolHandlerByName = function(a) {
                return Da[a]
            }, this.isCurrentHandTool = function() {
                var a = wa.getToolHandlerByName(e.Tools.TOOL_NAME_HAND);
                return a === Ea
            }, this.setModified = function(a, b, c) {
                b && b.setModified(c), a && a.setModified(c)
            }, this.isDocModified = function() {
                var a = wa.getMainView();
                if (!a) return !1;
                var b = wa.getMainView().getDocView();
                return b.isModified()
            }, this.getDocVersion = function() {
                return 0
            }, this.updateVersion = function(a) {}, this.isCancleOffLineFile = function() {
                return this._isCancleOffLine
            }, this.resetCancleOffLineFile = function() {
                this._isCancleOffLine = !1
            }, this.cancelOffLine = function() {
                this._isCancleOffLine = !0
            }, this.openOfflineCacheFile = function(a) {
                n.openOfflineFile(a)
            }, this.openOfflineFile = function(a, b) {
                if (ja = b, b.fileId) {
                    var c = r.baseUrl + "asserts/" + b.fileId;
                    e.ViewerInstance.openFileByBuffer(a, b.fileName, c), Qa = b.fileId
                } else e.FileUtils.openFileByStream(new Uint8Array(a), b.lastModifyTime, b.fileName)
            }, this.offlineCurFile = function(a, b) {
                function c(c) {
                    if (wa.isCancleOffLineFile()) wa.resetCancleOffLineFile(), $.isFunction(b) && (b(), c = null);
                    else {
                        var d = wa.getPDFDoc();
                        d.setOfflineBuffer(c), a(c, f)
                    }
                }

                function d() {
                    b()
                }
                this._isCancleOffLine = !1;
                var f = this.getOfflineFileInfoJson();
                try {
                    e.Common.getDocumentBuffer(r.baseUrl, X, c, d)
                } catch (g) {
                    $.isFunction(b) && (b(), bufferArray = null);
                    var h = i18n.t("CommonDialog.NotSupportBrowserForOffline");
                    return void e.notSupportBrowser(h, !1)
                }
            }, this.offlineFileByUrl = function(a, b, d) {
                function f(a) {
                    function c(c) {
                        var d = {
                                fileId: a.result
                            },
                            e = JSON.stringify(d);
                        $.isFunction(b) && b(c, e)
                    }
                    e.Common.getDocumentBuffer(r.baseUrl, a.result, c, d)
                }
                if (e.Engine.JR) {
                    var g = a.lastIndexOf("/");
                    c = a.substring(g + 1);
                    var h = new XMLHttpRequest,
                        i = a.indexOf("blob") ? "blob" : "arraybuffer";
                    h.open("GET", a, !0), h.responseType = i;
                    var j = new SparkMD5.ArrayBuffer;
                    h.addEventListener("load", function(d) {
                        var e = this.getResponseHeader("Last-Modified"),
                            f = this.response,
                            g = f.size,
                            h = new FileReader;
                        h.readAsArrayBuffer(f), h.onload = function(d) {
                            var f, h, i = new Uint8Array(d.target.result);
                            1048576 > g ? f = i.buffer : (h = new Uint8Array(i.subarray(0, 1024)), f = h.buffer), j.append(f);
                            var k = j.end();
                            h = null;
                            var l = {
                                    fileId: "",
                                    md5: k,
                                    lastModifyTime: e,
                                    fileUrl: a,
                                    fileName: c
                                },
                                m = JSON.stringify(l);
                            $.isFunction(b) && b(i.buffer, m)
                        }
                    }, !1), h.addEventListener("error", function() {}, !1), h.send()
                } else {
                    var k = {
                            params: {
                                file: a
                            }
                        },
                        l = JSON.stringify(k),
                        m = {
                            params: l,
                            type: "http"
                        };
                    e.Common.generateDocId(r.baseUrl, "", m, f, d)
                }
            }, this.activeOffline = function(a) {
                function b() {
                    e.closeWaiting(), $.isFunction(a) && a(!1)
                }

                function c(a) {
                    var c = X;
                    ja = {
                        fileName: e.Tool.getReaderApp().getFileName(),
                        fileId: c,
                        offlineID: c
                    }, n.addCacheFromStream(c, a, ja).then(function() {
                        var b = i18n.t("CommonDialog.SettingOfflineFail");
                        e.Engine.JR = !0, e.Tool.getReaderApp().loadDataControl(!0, b);
                        var c = U.getDocView().getPageViewRender();
                        c.setImageRenderEngine(), f(a, e.Tool.getReaderApp().getFileName())
                    })["catch"](b)
                }

                function d(a) {
                    var c = a.pdfBuffer,
                        d = X;
                    ja = {
                        fileName: e.Tool.getReaderApp().getFileName(),
                        fileId: d,
                        offlineID: d
                    };
                    var f = new Blob([c], {
                        type: "application/pdf"
                    });
                    n.addCacheFromStream(d, c, ja).then(function() {
                        g(f, e.Tool.getReaderApp().getFileName())
                    })["catch"](b)
                }

                function f(a, b) {
                    function c() {
                        function c() {
                            e.closeWaiting(), g(d, b)
                        }

                        function h() {
                            e.closeWaiting()
                        }
                        var i = Sa ? window.atob(Sa) : "",
                            j = {
                                buf: a,
                                pdfPassword: i
                            },
                            k = {
                                type: "loadPDF",
                                data: j,
                                success: c,
                                error: h
                            };
                        f.loadPDF(k)
                    }
                    var d = new Blob([a], {
                            type: "application/pdf"
                        }),
                        f = wa.getDataControl(),
                        h = {
                            type: "initLoad",
                            success: c
                        };
                    f.initLoad(h)
                }

                function g(b, c) {
                    $.isFunction(a) && a(!0), e.Common.getReaderApp().setOffline(!0);
                    var d = {
                        uuid: ja.fileId,
                        pageIndex: 0,
                        offsetTop: 0,
                        zoom: 1
                    };
                    Qa = ja.fileId;
                    var f = JSON.stringify(d);
                    e.Common.getReaderApp().setCurOfflineFile(f), e.closeWaiting();
                    var g = R.plugins & ~e.Config.Plugins.flag.Comments & ~e.Config.Plugins.flag.Form & ~e.Config.Plugins.flag.Signature;
                    wa.setPlugin(g), U.getDocView().reloadOffLinePages(), wa.setCurrentToolByName(e.Tools.TOOL_NAME_HAND);
                    var h = wa.getDocPermission(),
                        i = i18n.t("PCLng.ToolBar.Online"),
                        j = i18n.t("PCLng.ToolBar.OnlineTip");
                    $(wa).trigger(e.EventList.OFFLINEMODE_CHANGED, {
                        plugins: R.plugins,
                        readOnly: Y,
                        disablePrint: !0,
                        disableDownload: !0,
                        docPermission: h,
                        securityType: ua,
                        isOffline: !0,
                        title: i,
                        tips: j,
                        isLargeFile: ma
                    }), e.Environment.safari || webpdfsaveAs(b, c)
                }
                if (e.waiting(this, null, i18n.t("CommonDialog.SettingOffline")), e.Engine.JR) {
                    var h = this.getDataControl(),
                        i = {
                            type: "getPdfBuffer",
                            success: d
                        };
                    h.getPdfBuffer(i)
                } else e.Common.getDocumentBuffer(r.baseUrl, X, c, b)
            }, this.activeOnline = function(a) {
                this.setOffline(!1), Promise.all([F(), E(), G(), H(), e.ViewerInstance.updateCurrentUserInfo(null, !0)]).then(function() {
                    $.isFunction(a) && a(!0), I(), wa.doOnline()
                })["catch"](function() {
                    $.isFunction(a) && a(!1), _readerApp.setOffline(!0), e.alert(null, null, i18n.t("OffLine.FailToChangeOnline"))
                })
            }, this.doOnline = function() {
                function a(a) {
                    function d(a) {
                        function c(a) {
                            function c(a) {
                                b(a.result)
                            }

                            function d() {}
                            var f = "Guest",
                                g = "Guest";
                            e.AccountInstance && (f = e.AccountInstance.getUserAccount(), g = e.AccountInstance.getUserId());
                            var h = {
                                    userName: f,
                                    userId: g,
                                    file: a,
                                    fileName: ja.fileName,
                                    lastModifiedDate: ja.lastModifyTime.toString()
                                },
                                i = JSON.stringify(h),
                                j = {
                                    params: i,
                                    type: "local"
                                };
                            e.Common.generateDocId(R.baseUrl, a, j, c, d)
                        }
                        e.Engine.JR = !1, wa.loadDataControl(!1);
                        var d = U.getDocView().getPageViewRender();
                        d.setImageRenderEngine();
                        var f = a.pdfBuffer;
                        e.Common.uploadFileByBuffer(R.baseUrl, f, ja.md5, ja.lastModifyTime, f.byteLength, ja.url, c)
                    }

                    function f(a) {
                        var c = a.pdfBuffer;
                        e.Common.getFileId(ja.md5, ja.lastModifyTime, c.byteLength, ja.fileName, c, ja.url, !0, b)
                    }
                    if (a)
                        if (ja.fileId) b(ja.fileId);
                        else {
                            var g = {
                                type: "getPdfBuffer",
                                success: f
                            };
                            c.getPdfBuffer(g)
                        }
                    else if (ja.fileId) {
                        e.Engine.JR = !1, wa.loadDataControl(!1);
                        var h = U.getDocView().getPageViewRender();
                        h.setImageRenderEngine(), b(ja.fileId)
                    } else {
                        var g = {
                            type: "getPdfBuffer",
                            success: d
                        };
                        c.getPdfBuffer(g)
                    }
                }

                function b(a) {
                    function b() {
                        H().then(c)
                    }

                    function c() {
                        I(), wa.reloadOnLinePlugin();
                        var a = wa.getDocPermission(),
                            b = i18n.t("PCLng.ToolBar.Offline"),
                            c = i18n.t("PCLng.ToolBar.OfflineTip");
                        $(wa).trigger(e.EventList.OFFLINEMODE_CHANGED, {
                            plugins: R.plugins,
                            readOnly: Y,
                            disablePrint: !_,
                            disableDownload: aa,
                            docPermission: a,
                            securityType: ua,
                            isOffline: !1,
                            title: b,
                            tips: c,
                            isLargeFile: ma
                        }), U.getDocView().reloadOnLinePages(), localStorage.setItem("isOffLine", !1)
                    }
                    R.url = R.baseUrl + "asserts/" + a + "/", X = a;
                    var d = R.url + "manifest",
                        f = {
                            language: R.language
                        },
                        g = wa.getDataControl(),
                        h = {
                            url: d,
                            buf: null,
                            pdfPassword: Sa,
                            requestData: f
                        },
                        i = {
                            type: "loadPDF",
                            data: h,
                            success: b,
                            error: null
                        };
                    g.loadPDF(i, !0)
                }
                var c = this.getDataControl();
                e.Common.getEngine(e.optionParameters.serverBaseUrl, a)
            }, this.reloadOnLinePlugin = function() {
                var b = e.Config.Plugins.load,
                    c = e.Config.Plugins.flag,
                    d = Ba.WebPDFForm;
                if (b.Form === !0 && R.plugins & c.Form && null == d) {
                    var f = a("core/Plugins/Form/FormPlugin");
                    wa.registerPlugin(f), Ba.WebPDFForm.init()
                }
                var g = Ba[e.BASEANNOT_PLUGIN_NAME];
                if (b.Annot === !0 && R.plugins & c.Comments && null == g) {
                    var h = a("core/Plugins/Annot/BaseAnnotPlugin");
                    wa.registerPlugin(h), Ba[e.BASEANNOT_PLUGIN_NAME].init();
                    var i = a("core/Plugins/CommentList/CommentListPlugin");
                    wa.registerPlugin(i), Ba[e.CommentListPluginName].init()
                }
                var j = Ba[e.SignaturePluginName];
                if (R.plugins & c.Signature && null == j) {
                    var k = a("core/Plugins/Signature/SignaturePlugin");
                    wa.registerPlugin(k), Ba[e.SignaturePluginName].init()
                }
                var l = Ba[e.InkSignPluginName];
                if (R.plugins & c.InkSign && null == l) {
                    var m = a("core/Plugins/InkSign/InkSignPlugin");
                    wa.registerPlugin(m), Ba[e.InkSignPluginName].init()
                }
                var n = Ba[e.SNAPSHOT_PLUGIN_NAME];
                if (!n) {
                    var o = a("core/Plugins/Snapshot/SnapshotPlugin");
                    wa.registerPlugin(o).init()
                }
            }, this.unloadOfflineLinePlugin = function() {
                for (var a = ["WebPDFForm", e.BASEANNOT_PLUGIN_NAME, e.CommentListPluginName, e.SignaturePluginName], b = 0; b < a.length; b++) Ba[a[b]] && (Ba[a[b]].unload(), delete Ba[a[b]], Ba[a[b]] = null)
            }, this.getPixelsPerPoint = function() {
                return 96 / 72
            }, this.getTextSelectCompoment = function() {
                return j
            }, this.setTextSelectCompoment = function(a) {
                j = a
            }, this.addAnnotUndo = function(a, b) {
                this.isJRorMobile() || (b ? O.addAnnotContentEditUndo(a) : O.addAnnotUndo(a))
            }, this.clearAnnotUndo = function(a) {
                this.isJRorMobile() || (a ? O.clearAnnotContentEditUndo() : O.clearAnnotUndo())
            }, this.annotUndo = function(a) {
                if (this.isJRorMobile()) return !0;
                if (this.isProcessing()) return !1;
                var b = O.getAnnotUndo(a);
                if (!b) return !1;
                var c = this.getPluginByName(e.BASEANNOT_PLUGIN_NAME);
                if (c) {
                    var d = c.getAnnotHandlerMgr();
                    if (d) {
                        var f = this.getMainView().getDocView().getPageView(b.pageIndex);
                        if (b.type === e.Annot.UndoType.ANNOT_CREATE)
                            if (a)
                                for (var g = 0; g < b.annotDataList.length; g++) b.annotDataList[g].isReply ? d.deleteReplyAnnot(f.getPageIndex(), b.annotDataList[g].annotJSONData.n, !0, !0) : d.deleteAnnot(f, b.annotDataList[g].n, !0, !0);
                            else
                                for (var g = 0; g < b.annotDataList.length; g++)
                                    if (b.annotDataList[g].isReply) f.importReplyAnnot(b.annotDataList[g].annotJSONData, b.annotDataList[g].parentAnnotName, !0, f.getPDFPage().isAnnotLoaded());
                                    else {
                                        var h = K(f, b.annotDataList[g]);
                                        f.importAnnotFromJsonData(b.annotDataList[g], !1, !0, f.getPDFPage().isAnnotLoaded(), h, !0)
                                    }
                        else if (b.type === e.Annot.UndoType.ANNOT_DELETE)
                            if (a)
                                for (var g = 0; g < b.annotDataList.length; g++)
                                    if (b.annotDataList[g].isReply) f.importReplyAnnot(b.annotDataList[g].annotJSONData, b.annotDataList[g].parentAnnotName, !0, f.getPDFPage().isAnnotLoaded());
                                    else {
                                        var h = K(f, b.annotDataList[g]);
                                        f.importAnnotFromJsonData(b.annotDataList[g], !1, !0, f.getPDFPage().isAnnotLoaded(), h, !0)
                                    }
                        else
                            for (var g = 0; g < b.annotDataList.length; g++) b.annotDataList[g].isReply ? d.deleteReplyAnnot(f.getPageIndex(), b.annotDataList[g].annotJSONData.n, !0, !0) : d.deleteAnnot(f, b.annotDataList[g].n, !0, !0);
                        else if (b.type === e.Annot.UndoType.ANNOT_MOVE)
                            for (var g = 0; g < b.annotDataList.length; g++) {
                                var i = f.getPDFPage().getAnnotByName(b.annotDataList[g].name);
                                if (!i) return;
                                a ? (i.setRect(b.annotDataList[g].oldRect), "Line" === i.getSubType() ? (i.setStartPoint(b.annotDataList[g].oldStartPoint), i.setEndPoint(b.annotDataList[g].oldEndPoint), "LineDimension" === i.getIntent() && i.setContents(b.annotDataList[g].oldContents)) : "Polygon" === i.getSubType() || "PolyLine" === i.getSubType() ? i.setVts(b.annotDataList[g].oldVts) : "Ink" === i.getSubType() ? i.setInkList(b.annotDataList[g].oldInkList) : "Callout" === i.getType() && (i.setRectDiffer(b.annotDataList[g].oldRectDiffer), i.setFreeCoordinatesLine(b.annotDataList[g].oldFreeCoordLine))) : (i.setRect(b.annotDataList[g].newRect), "Line" === i.getSubType() ? (i.setStartPoint(b.annotDataList[g].newStartPoint), i.setEndPoint(b.annotDataList[g].newEndPoint), "LineDimension" === i.getIntent() && i.setContents(b.annotDataList[g].newContents)) : "Polygon" === i.getSubType() || "PolyLine" === i.getSubType() ? i.setVts(b.annotDataList[g].newVts) : "Ink" === i.getSubType() ? i.setInkList(b.annotDataList[g].newInkList) : "Callout" === i.getType() && (i.setRectDiffer(b.annotDataList[g].newRectDiffer), i.setFreeCoordinatesLine(b.annotDataList[g].newFreeCoordLine)));
                                var j = d.getAnnotHandlerByAnnot(i);
                                j && (j.onUpdatePosition(f, i), "Line" === i.getSubType() && "LineDimension" === i.getIntent() && d.updateAnnotContent(b.pageIndex, b.annotDataList[g].name, a ? b.annotDataList[g].oldContents : b.annotDataList[g].newContents))
                            } else if (b.type === e.Annot.UndoType.ANNOT_PROPERTY)
                                for (var g = 0; g < b.annotDataList.length; g++) d.updateProperties(f, b.annotDataList[g].name, b.annotDataList[g].type, a ? b.annotDataList[g].oldData : b.annotDataList[g].newData), wa.setModified(f, f.getDocView(), !0);
                            else if (b.type === e.Annot.UndoType.ANNOT_CONTENT) {
                            var i = f.getPDFPage().getAnnotByName(b.annotDataList.name);
                            if (!i) return;
                            var k = "FreeText" === i.getSubType();
                            if (d.updateAnnotContent(b.pageIndex, b.annotDataList.name, a ? b.annotDataList.oldContents : b.annotDataList.newContents, this.isAnnotContentEdit(), k), k) {
                                var j = d.getAnnotHandlerByAnnot(i);
                                j && j.resizeTextArea(f, i)
                            }
                        }
                    }
                }
                return !1
            };
            var Wa = {};
            this.getDigestId = function(a) {
                if (Wa[a]) return Wa[a];
                var b = this;
                return $.ajax({
                    type: "get",
                    url: b.getBaseUrl() + "api/file/" + a + "/digest",
                    cache: !1,
                    async: !1,
                    success: function(c) {
                        0 == c.resultCode && b.storeDigestId(a, c.resultBody.digest)
                    }
                }), Wa[a]
            }, this.storeDigestId = function(a, b) {
                Wa[a] = b
            };
            var Xa = new Array;
            this.addExtToolBtn = function(a) {
                Xa.push(a)
            }, this.listExtToolBtn = function() {
                return Xa
            }, this.setAnnotEditCallback = function(a) {
                la = a
            }, this.getAnnotEditCallback = function() {
                return la
            }, this.saveCurDocOfflineInfo = function(a, b, c) {
                var d = wa.getCurOfflineFile(),
                    e = JSON.parse(d);
                if (e.uuid == Qa) {
                    e.zoom = b, e.pageIndex = a, e.offsetTop = c;
                    var f = JSON.stringify(e);
                    wa.setCurOfflineFile(f)
                }
            }, this.isProcessing = function() {
                pa = !1;
                var a = this.getPluginByName(e.BASEANNOT_PLUGIN_NAME),
                    b = !1;
                if (a) {
                    var c = a.getAnnotHandlerMgr();
                    b = c.isProcessing()
                }
                var d = _readerApp.getCurToolHandler();
                return d && (d.isDrawing ? d.isDrawing() : d.isProcessing()) && (pa = !0), pa || b
            }, this.setProcessing = function(a) {
                pa = a
            }, this.isJRorMobile = function() {
                return e.Engine.JR || e.Engine.isJR || e.Environment.mobile
            }, this.isAnnotContentEdit = function() {
                return qa
            }, this.setAnnotContentEdit = function(a) {
                qa = a
            };
            var Ya = {
                onLButtonDown: "onLButtonDown",
                onLButtonUp: "onLButtonUp",
                onLButtonDbClick: "onLButtonDblClk",
                onMouseMove: "onMouseMove",
                onRButtonDown: "onRButtonDown",
                onRButtonUp: "onRButtonUp",
                onRButtonDblClk: "onRButtonDblClk",
                onMouseWheel: "onMouseWheel",
                onMouseOver: "onMouseOver",
                onMouseOut: "onMouseOut",
                onMouseLeave: "onMouseLeave",
                onMouseEnter: "onMouseEnter",
                onDoubleTap: "onDoubleTap",
                onPinchIn: "onPinchIn",
                onPinchOut: "onPinchOut",
                onHold: "onHold"
            };
            $.each(Ya, function(a, b) {
                wa[a] = function(c) {
                    //("onLButtonDbClick" === a || "onLButtonDown" === a || "onLButtonUp" === a || "onRButtonDbClick" === a || "onRButtonDown" === a || "onRButtonUp" === a) && $(".fwr-toolbar-icontext-form").hide();
                    var d = !1;
                    return $.each(Ca, function(a, e) {
                        return d = e ? e[b](c) : !1, !d
                    }), d
                }
            })
        }, e.ReaderApp.prototype = {
            addRecord: function(a, b, c) {}
        }, e.ReaderApp
    }), define("core/uupaa-color.mini", [], function(a, b, c) {
        var d;
        window.uu || (window.uu = function() {
            return d._impl.apply(this, arguments)
        }, window.uu.mix = function(a, b, c) {
            for (var e in b) a[e] = b[e];
            return c ? d.mix(a, c) : a
        }, window.uu.mix.param = function(a, b, c) {
            for (var e in b) !(e in a) && (a[e] = b[e]);
            return c ? d.mix.param(a, c) : a
        }, window.uuClass = {}, window.uuConst = {}), d = window.uu, uuClass.Color || (uuClass.Color = function(a, b, c, d) {
            this.construct.apply(this, arguments)
        }, d.color = function(a, b, c, d) {
            return new uuClass.Color(a, b, c, d)
        }, uuClass.ColorDictionary = function() {
            var a = this,
                b = arguments.callee;
            return b.instance || (b.instance = a, a.construct.apply(a, arguments)), b.instance
        }, function() {
            var a, b = parseInt,
                c = parseFloat,
                e = Math.round,
                f = uuClass.Color,
                g = "000000black,888888gray,ccccccsilver,ffffffwhite,ff0000red,ffff00yellow,00ff00lime,00ffffaqua,00ffffcyan,0000ffblue,ff00fffuchsia,ff00ffmagenta,880000maroon,888800olive,008800green,008888teal,000088navy,880088purple,696969dimgray,808080gray,a9a9a9darkgray,c0c0c0silver,d3d3d3lightgrey,dcdcdcgainsboro,f5f5f5whitesmoke,fffafasnow,708090slategray,778899lightslategray,b0c4delightsteelblue,4682b4steelblue,5f9ea0cadetblue,4b0082indigo,483d8bdarkslateblue,6a5acdslateblue,7b68eemediumslateblue,9370dbmediumpurple,f8f8ffghostwhite,00008bdarkblue,0000cdmediumblue,4169e1royalblue,1e90ffdodgerblue,6495edcornflowerblue,87cefalightskyblue,add8e6lightblue,f0f8ffaliceblue,191970midnightblue,00bfffdeepskyblue,87ceebskyblue,b0e0e6powderblue,2f4f4fdarkslategray,00ced1darkturquoise,afeeeepaleturquoise,f0ffffazure,008b8bdarkcyan,20b2aalightseagreen,48d1ccmediumturquoise,40e0d0turquoise,7fffd4aquamarine,e0fffflightcyan,00fa9amediumspringgreen,7cfc00lawngreen,00ff7fspringgreen,7fff00chartreuse,adff2fgreenyellow,2e8b57seagreen,3cb371mediumseagreen,66cdaamediumaquamarine,98fb98palegreen,f5fffamintcream,006400darkgreen,228b22forestgreen,32cd32limegreen,90ee90lightgreen,f0fff0honeydew,556b2fdarkolivegreen,6b8e23olivedrab,9acd32yellowgreen,8fbc8fdarkseagreen,9400d3darkviolet,8a2be2blueviolet,dda0ddplum,d8bfd8thistle,8b008bdarkmagenta,9932ccdarkorchid,ba55d3mediumorchid,da70d6orchid,ee82eeviolet,e6e6falavender,c71585mediumvioletred,bc8f8frosybrown,ff69b4hotpink,ffc0cbpink,ffe4e1mistyrose,ff1493deeppink,db7093palevioletred,e9967adarksalmon,ffb6c1lightpink,fff0f5lavenderblush,cd5c5cindianred,f08080lightcoral,f4a460sandybrown,fff5eeseashell,dc143ccrimson,ff6347tomato,ff7f50coral,fa8072salmon,ffa07alightsalmon,ffdab9peachpuff,ffffe0lightyellow,b22222firebrick,ff4500orangered,ff8c00darkorange,ffa500orange,ffd700gold,fafad2lightgoldenrodyellow,8b0000darkred,a52a2abrown,a0522dsienna,b8860bdarkgoldenrod,daa520goldenrod,deb887burlywood,f0e68ckhaki,fffacdlemonchiffon,d2691echocolate,cd853fperu,bdb76bdarkkhaki,bdb76btan,eee8aapalegoldenrod,f5f5dcbeige,ffdeadnavajowhite,ffe4b5moccasin,ffe4c4bisque,ffebcdblanchedalmond,ffefd5papayawhip,fff8dccornsilk,f5deb3wheat,faebd7antiquewhite,faf0e6linen,fdf5e6oldlace,fffaf0floralwhite,fffff0ivory",
                h = {
                    ZERO: {
                        r: 0,
                        g: 0,
                        b: 0,
                        a: 0
                    },
                    BLACK: {
                        r: 0,
                        g: 0,
                        b: 0,
                        a: 1
                    },
                    WHITE: {
                        r: 255,
                        g: 255,
                        b: 255,
                        a: 1
                    }
                },
                i = {
                    RGBAHash: function(a) {
                        return a
                    },
                    HEX: function(b) {
                        var c = a.dec2hex;
                        return ["#", c[b.r], c[b.g], c[b.b]].join("")
                    },
                    RGB: function(a) {
                        return "rgb(" + [a.r, a.g, a.b].join(",") + ")"
                    },
                    RGBA: function(a) {
                        return "rgba(" + [a.r, a.g, a.b, a.a].join(",") + ")"
                    },
                    HSVA: function(a) {
                        var b = f._rgba2hsva(a);
                        return "hsva(" + [(100 * b.h | 0) / 100, (100 * b.s | 0) / 100, (100 * b.v | 0) / 100, b.a].join(",") + ")"
                    },
                    HSLA: function(a) {
                        var b = f._rgba2hsla(a);
                        return "hsla(" + [(100 * b.h | 0) / 100, (100 * b.s | 0) / 100, (100 * b.l | 0) / 100, b.a].join(",") + ")"
                    }
                },
                j = /^#(([\da-f])([\da-f])([\da-f]))(([\da-f])([\da-f]{2}))?$/,
                k = /(rgb[a]?)\s*\(\s*([0-9a-f\.%]+)\s*,\s*([0-9a-f\.%]+)\s*,\s*([0-9a-f\.%]+)(?:\s*,\s*([0-9\.]+))?\s*\)/,
                l = {
                    number: 1,
                    string: 2
                };
            uuClass.ColorDictionary.prototype = {
                construct: function() {
                    this.name2hash = {}, this.dec2hex = Array(256), this.hex2dec = Array(256), this.hexAlphaCache = {}, this.hexAlphaCacheCount = 0;
                    var a, c, d, e, h, i, j, k, l = g.split(",");
                    for (a = 0; 16 > a; ++a)
                        for (c = 0; 16 > c; ++c) j = 16 * a + c, k = a.toString(16) + c.toString(16), this.dec2hex[j] = k, this.hex2dec[k] = j;
                    for (a = 0, d = l.length; d > a; ++a) e = l[a], h = e.substring(0, 6), i = e.substring(6), this.name2hash[i] = {
                        rgba: f._toRGBAHash(b(h, 16), 1),
                        hex: "#" + h
                    };
                    this.name2hash.transparent = {
                        rgba: f._toRGBAHash(0, 0),
                        hex: "#000000"
                    }
                },
                addColor: function(a) {
                    for (var b, c, d = a.toLowerCase().replace(/^[\s;]*|[\s;]*$/g, "").split(";"), e = 0, g = d.length; g > e; ++e) b = d[e].split(":"), c = f._hash(b[1]), this.name2hash[b[0]] = {
                        rgba: c,
                        hex: i.HEX(c)
                    }
                },
                clearCache: function(a) {
                    this.hexAlphaCacheCount > a && (this.hexAlphaCache = {}, this.hexAlphaCacheCount = 0)
                }
            }, uuClass.Color.prototype = {
                construct: function(a, b, c, d) {
                    this._lock = 0, this._stack = [], this.push(a, b, c, d)
                },
                push: function(a, b, c, e) {
                    var g, h, i, j;
                    if (void 0 !== a)
                        if (a instanceof f)
                            for (h = 0, i = a._stack.length; i > h; ++h) this._stack.push(d.mix({}, a._stack[h]));
                        else if (a instanceof Array)
                        for (h = 0, i = a.length; i > h; ++h)(g = f._hash(a[h])) && this._stack.push(g);
                    else if ("string" == typeof a && a.indexOf(";") > -1)
                        for (j = a.toLowerCase().replace(/^[\s;]*|[\s;]*$/g, "").split(";"), h = 0, i = j.length; i > h; ++h)(g = f._hash(j[h])) && this._stack.push(g);
                    else(g = f._hash(a, b, c, e)) && this._stack.push(g);
                    return this
                },
                pop: function(a) {
                    this.unlock();
                    var b = a || "RGBAHash",
                        c = this._stack.pop() || h.ZERO;
                    return i[b](c)
                },
                clear: function() {
                    return this._stack = [], this.unlock()
                },
                size: function() {
                    return this._stack.length
                },
                empty: function() {
                    return !this._stack.length
                },
                top: function() {
                    return this.ref(this._stack.length - 1)
                },
                bottom: function() {
                    return this.ref(0)
                },
                ref: function(a) {
                    return this._stack[this._ref(a)] || h.ZERO
                },
                _ref: function(a) {
                    return void 0 !== a ? a : this._lock ? this._lock - 1 : this._stack.length ? this._stack.length - 1 : 0
                },
                copy: function(a) {
                    return this._stack.push(this.ref(a)), this
                },
                lock: function() {
                    return this._lock = this._stack.length, this
                },
                unlock: function() {
                    return this._lock = 0, this
                },
                forEach: function(a, b, c) {
                    for (var d, e = 0, f = this._stack.length, g = void 0 === c, h = i[c || "RGBAHash"]; f > e; ++e) d = g ? this._stack[e] : h(this._stack[e]), a.call(b, d, e, this);
                    return this
                },
                hexEach: function(a, b) {
                    return this.forEach(a, b, "HEX")
                },
                rgbaEach: function(a, b) {
                    return this.forEach(a, b, "RGBA")
                },
                zero: function() {
                    return this._stack.push(h.ZERO), this
                },
                black: function() {
                    return this._stack.push(h.BLACK), this
                },
                white: function() {
                    return this._stack.push(h.WHITE), this
                },
                hex: function(a) {
                    return i.HEX(this.ref(a))
                },
                rgb: function(a) {
                    return i.RGB(this.ref(a))
                },
                rgba: function(a) {
                    return i.RGBA(this.ref(a))
                },
                hsva: function(a) {
                    return i.HSVA(this.ref(a))
                },
                hsla: function(a) {
                    return i.HSLA(this.ref(a))
                },
                toString: function() {
                    return this.hex()
                },
                tone: function(a, b, c) {
                    if (!a && !b && !c) return this.copy();
                    var d = f._rgba2hsva(this.ref());
                    return d.h += a, d.h = d.h > 360 ? d.h - 360 : d.h < 0 ? d.h + 360 : d.h, d.s += b, d.s = d.s > 100 ? 100 : d.s < 0 ? 0 : d.s, d.v += c, d.v = d.v > 100 ? 100 : d.v < 0 ? 0 : d.v, this._stack.push(f._hsva2rgba(d)), this
                },
                complementary: function() {
                    var a = this.ref();
                    return this._stack.push({
                        r: 255 ^ a.r,
                        g: 255 ^ a.g,
                        b: 255 ^ a.b,
                        a: a.a
                    }), this
                },
                gray: function() {
                    var a = this.ref();
                    return this._stack.push({
                        r: a.g,
                        g: a.g,
                        b: a.g,
                        a: a.a
                    }), this
                },
                sepia: function() {
                    var a, b = this.ref(),
                        c = b.r,
                        d = b.g,
                        e = b.b,
                        f = .299 * c + .587 * d + .114 * e,
                        g = -.091,
                        h = .056;
                    return c = f + 1.4026 * h, d = f - .3444 * g - .7114 * h, e = f + 1.733 * g, c *= 1.2, e *= .8, c = 0 > c ? 0 : c > 255 ? 255 : c, d = 0 > d ? 0 : d > 255 ? 255 : d, e = 0 > e ? 0 : e > 255 ? 255 : e, a = {
                        r: 0 | c,
                        g: 0 | d,
                        b: 0 | e,
                        a: b.a
                    }, this._stack.push(a), this
                }
            }, d.mix(uuClass.Color, {
                _toDec: function(a) {
                    var d = -1 === a.lastIndexOf("%") ? b(a) : 255 * c(a) / 100 | 0;
                    return d > 255 ? 255 : d
                },
                _toRGBAHash: function(a, b) {
                    return {
                        r: a >> 16 & 255,
                        g: a >> 8 & 255,
                        b: 255 & a,
                        a: b
                    }
                },
                _hash: function(b, e, g, h) {
                    if (void 0 === b || null === b) return 0;
                    var i, m = l[typeof b] || 0,
                        n = a.name2hash,
                        o = a.hex2dec,
                        p = f._toDec;
                    if (1 === m) return void 0 === e ? this._toRGBAHash(b, 1) : {
                        r: b,
                        g: e,
                        b: g,
                        a: void 0 === h ? 1 : h
                    };
                    if (2 === m) {
                        if (b = b.toLowerCase(), b in n) return n[b].rgba;
                        if (i = b.match(j)) return b.length > 4 ? {
                            r: o[i[2] + i[3]],
                            g: o[i[4] + i[6]],
                            b: o[i[7]],
                            a: 1
                        } : {
                            r: o[i[2] + i[2]],
                            g: o[i[3] + i[3]],
                            b: o[i[4] + i[4]],
                            a: 1
                        };
                        if (i = b.match(k)) return {
                            r: p(i[2]),
                            g: p(i[3]),
                            b: p(i[4]),
                            a: "rgba" === i[1] ? c(i[5]) : 1
                        }
                    } else {
                        if ("r" in b) return d.mix({}, b);
                        if ("v" in b) return f._hsva2rgba(b);
                        if ("l" in b) return f._hsla2rgba(b)
                    }
                    return 0
                },
                _hexAlpha: function(b) {
                    var d, e, g, h, i, m, n = a.hexAlphaCache,
                        o = a;
                    if (2 === (l[typeof b] || 0)) {
                        if (b in n) return n[b];
                        h = o.name2hash, e = b.toLowerCase(), e in h ? (g = h[e], d = [g.hex, g.rgba.a]) : (g = e.match(j)) ? d = e.length > 4 ? [e, 1] : [
                            ["#", g[2], g[2], g[3], g[3], g[4], g[4]].join(""), 1
                        ] : (g = e.match(k)) ? (i = o.dec2hex, m = f._toDec, d = [
                            ["#", i[m(g[2])], i[m(g[3])], i[m(g[4])]].join(""), "rgba" === g[1] ? c(g[5]) : 1
                        ]) : d = ["#000000", 0], o.hexAlphaCache[b] = d, ++o.hexAlphaCacheCount
                    } else d = ["#000000", 0];
                    return d
                },
                _rgba2hsva: function(a) {
                    var b = a.r / 255,
                        c = a.g / 255,
                        d = a.b / 255,
                        f = Math.max(b, c, d),
                        g = f - Math.min(b, c, d),
                        h = 0,
                        i = f ? e(g / f * 100) : 0,
                        j = e(100 * f);
                    return i ? (h = b === f ? 60 * (c - d) / g : c === f ? 60 * (d - b) / g + 120 : 60 * (b - c) / g + 240, {
                        h: 0 > h ? h + 360 : h,
                        s: i,
                        v: j,
                        a: a.a
                    }) : {
                        h: 0,
                        s: 0,
                        v: j,
                        a: a.a
                    }
                },
                _hsva2rgba: function(a) {
                    function b() {
                        var a = e,
                            b = a((1 - d) * f * 255),
                            c = a((1 - d * j) * f * 255),
                            h = a((1 - d * (1 - j)) * f * 255),
                            k = a(255 * f);
                        switch (i) {
                            case 0:
                                return {
                                    r: k,
                                    g: h,
                                    b: b,
                                    a: g
                                };
                            case 1:
                                return {
                                    r: c,
                                    g: k,
                                    b: b,
                                    a: g
                                };
                            case 2:
                                return {
                                    r: b,
                                    g: k,
                                    b: h,
                                    a: g
                                };
                            case 3:
                                return {
                                    r: b,
                                    g: c,
                                    b: k,
                                    a: g
                                };
                            case 4:
                                return {
                                    r: h,
                                    g: b,
                                    b: k,
                                    a: g
                                };
                            case 5:
                                return {
                                    r: k,
                                    g: b,
                                    b: c,
                                    a: g
                                }
                        }
                        return {
                            r: 0,
                            g: 0,
                            b: 0,
                            a: g
                        }
                    }
                    var c = 360 === a.h ? 0 : a.h,
                        d = a.s / 100,
                        f = a.v / 100,
                        g = a.a,
                        h = c / 60,
                        i = 0 | h,
                        j = h - i;
                    return d ? b() : (c = e(255 * f), {
                        r: c,
                        g: c,
                        b: c,
                        a: g
                    })
                },
                _rgba2hsla: function(a) {
                    var b = a.r / 255,
                        c = a.g / 255,
                        d = a.b / 255,
                        f = Math.max(b, c, d),
                        g = Math.min(b, c, d),
                        h = f - g,
                        i = 0,
                        j = 0,
                        k = (g + f) / 2;
                    return k > 0 && 1 > k && (j = h / (.5 > k ? 2 * k : 2 - 2 * k)), h > 0 && (f === b && f !== c ? i += (c - d) / h : f === c && f !== d ? i += (d - b) / h + 2 : f === d && f !== b && (i += (b - c) / h + 4), i *= 60), {
                        h: i,
                        s: e(100 * j),
                        l: e(100 * k),
                        a: a.a
                    }
                },
                _hsla2rgba: function(a) {
                    var b, c, d, f, g, h, i, j = 360 === a.h ? 0 : a.h,
                        k = a.s / 100,
                        l = a.l / 100;
                    return 120 > j ? (b = (120 - j) / 60, c = j / 60, d = 0) : 240 > j ? (b = 0, c = (240 - j) / 60, d = (j - 120) / 60) : (b = (j - 240) / 60, c = 0, d = (360 - j) / 60), f = 1 - k, g = 2 * k, b = g * (b > 1 ? 1 : b) + f, c = g * (c > 1 ? 1 : c) + f, d = g * (d > 1 ? 1 : d) + f, .5 > l ? (b *= l, c *= l, d *= l) : (h = 1 - l, i = 2 * l - 1, b = h * b + i, c = h * c + i, d = h * d + i), {
                        r: e(255 * b),
                        g: e(255 * c),
                        b: e(255 * d),
                        a: a.a
                    }
                }
            }), a = new uuClass.ColorDictionary
        }())
    }), define("core/uupaa-excanvas", [], function(a, b, c) {
        uuClass.Canvas || (uuClass.Canvas = function(a, b) {
            var c = navigator.userAgent.toLowerCase();
            return !document.uniqueID || /trident/.test(c) ? a : uuClass.Canvas._initDynamicElement(a, b)
        }, uuClass.Canvas.xamlsrc = "#xaml", uuClass.Matrix = {
            identity: function() {
                return [
                    [1, 0, 0],
                    [0, 1, 0],
                    [0, 0, 1]
                ]
            },
            multiply: function(a, b) {
                var c, d, e, f, g = uuClass.Matrix.identity();
                for (c = 0; 3 > c; ++c)
                    for (d = 0; 3 > d; ++d) {
                        for (f = 0, e = 0; 3 > e; ++e) f += a[c][e] * b[e][d];
                        g[c][d] = f
                    }
                return g
            },
            translate: function(a, b) {
                return [
                    [1, 0, 0],
                    [0, 1, 0],
                    [a, b, 1]
                ]
            },
            rotate: function(a) {
                var b = Math.cos(a),
                    c = Math.sin(a);
                return [
                    [b, c, 0],
                    [-c, b, 0],
                    [0, 0, 1]
                ]
            },
            scale: function(a, b) {
                return [
                    [a, 0, 0],
                    [0, b, 0],
                    [0, 0, 1]
                ]
            },
            transform: function(a, b, c, d, e, f) {
                return [
                    [a, b, 0],
                    [c, d, 0],
                    [e, f, 1]
                ]
            }
        }, Math.toDegrees || (Math.toDegrees = 180 / Math.PI), Math.toRadians || (Math.toRadians = Math.PI / 180), function() {
            function a(a) {
                var b, c = y;
                return (void 0 !== a && !a || !c.em) && (b = p.body.appendChild(p.createElement("div")), b.style.width = "12em", c.em = b.clientWidth / 12, b.style.height = "12pt", c.pt = b.clientHeight / 12, p.body.removeChild(b)), c
            }

            function b(a, b) {
                z || (z = p.createElement("div"), z.id = "uupaa-canvas-text-rect", z.style.cssText = "position:absolute;top:-9999px;left:-9999px;text-align:left;visibility:hidden;border:1px solid red", p.body.appendChild(z)), z.style.font = b, z.innerText = a;
                var c, d, e = z.getBoundingClientRect();
                return c = e.right - e.left, d = e.bottom - e.top, {
                    w: s(c),
                    h: s(d)
                }
            }

            function c(b) {
                var c, d = {
                    FontStyle: "normal",
                    FontVariant: "normal",
                    FontWeight: "normal",
                    FontSize: "medium",
                    LineHeight: "1",
                    FontFamily: ""
                };
                if ((c = b.match(/^(normal|italic|oblique)/)) && (d.FontStyle = c[1], b = b.slice(c[0].length)), (c = b.match(/^\s*(normal|small-caps)/)) && (d.FontVariant = c[1], b = b.slice(c[0].length)), (c = b.match(/^\s*(normal|bolder|bold|lighter|100|200|300|400|500|600|700|800|900)/)) && (d.FontWeight = c[1], b = b.slice(c[0].length)), c = b.match(/^\s*(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|[\d]+(px|em|pt))/)) {
                    if (c[2]) switch (c[2]) {
                        case "px":
                            d.FontSize = r(c[1]);
                            break;
                        case "em":
                            d.FontSize = r(c[1]) * a().em;
                            break;
                        case "pt":
                            d.FontSize = r(c[1]) * a().pt
                    } else d.FontSize = c[1];
                    b = b.slice(c[0].length)
                }
                if (c = b.match(/^\s*\/\s*(normal|[\d\.]+(px|em|pt)|[\d\.]+)/)) {
                    if (c[2]) switch (c[2]) {
                        case "px":
                            d.LineHeight = r(c[1]);
                            break;
                        case "em":
                            d.LineHeight = r(c[1]) * a().em;
                            break;
                        case "pt":
                            d.LineHeight = r(c[1]) * a().pt
                    } else "normal" === c[1] && (c[1] = 1), d.LineHeight = c[1];
                    b = b.slice(c[0].length)
                }
                return d.FontFamily = b.replace(/^\s*/, "").replace(/,/g, ",,").replace(/\"\'/g, ""), d
            }

            function d(a, b) {
                var c = 1,
                    d = 0;
                return b ? 10 >= a ? (c = .8, d = 0) : 20 >= a ? (c = .92, d = 0) : 30 >= a ? (c = .97, d = 0) : 40 >= a ? (c = .98, d = 0) : 50 >= a ? (c = .98, d = -2) : 60 >= a ? (c = .99, d = -4) : (c = 1, d = 0) : 10 >= a ? (c = .88, d = 0) : 20 >= a ? (c = .9, d = -3) : 30 >= a ? (c = .93, d = -5) : 40 >= a ? (c = .97, d = -6) : 50 >= a ? (c = .98, d = -10) : 60 >= a ? (c = .98, d = -12) : 80 >= a ? (c = .98, d = -12) : 100 >= a ? (c = .98, d = -16) : 120 >= a ? (c = .99, d = -16) : 140 >= a ? (c = .99, d = -26) : (c = 1, d = -16), {
                    scale: c,
                    margin: d
                }
            }

            function e(a) {
                for (var b, c = "white", d = a; d && (!d.currentStyle || (c = d.currentStyle.backgroundColor, "transparent" === c));) d = d.parentNode;
                return b = x("transparent" === c ? "white" : c), b[0]
            }

            function f(a) {
                var b, c;
                (c = C[a.propertyName] || 0) && (b = a.srcElement, 1 === c ? (b.style.width = b.attributes.width.nodeValue + "px", uuClass.Canvas.ready() && b.getContext()._clear()) : (b.style.height = b.attributes.height.nodeValue + "px", uuClass.Canvas.ready() && b.getContext()._clear()))
            }

            function g(a) {
                var b = a.srcElement;
                b.firstChild && (b.firstChild.style.cssText = "width:" + b.clientWidth + "pxheight:" + b.clientHeight + "px")
            }

            function h(a) {
                var b, c = p.createElement(a.outerHTML);
                return a.parentNode ? a.parentNode.replaceChild(c, a) : c = a, c.getContext = function() {
                    return c._ctx2d ? c._ctx2d : c._ctx2d = new i(c)
                }, c.attachEvent("onpropertychange", f), c.attachEvent("onresize", g), b = c.attributes, b.width && b.width.specified ? c.style.width = b.width.nodeValue + "px" : c.width = c.clientWidth, b.height && b.height.specified ? c.style.height = b.height.nodeValue + "px" : c.height = c.clientHeight, c
            }

            function i(a) {
                this.canvas = a, this.globalAlpha = 1, this.globalCompositeOperation = "source-over", this.strokeStyle = "#000000", this.fillStyle = "#000000", this.lineWidth = 1, this.lineCap = "butt", this.lineJoin = "miter", this.miterLimit = 10, this.shadowOffsetX = 0, this.shadowOffsetY = 0, this.shadowBlur = 0, this.shadowColor = "rgba(0,0,0,0)", this.font = "10px sans-serif", this.textAlign = "start", this.textBaseline = "alphabetic", this.xClearColor = "#ffffff", this.xClipStyle = "#ffffff", this.xFontScaleW = 1, this.xFontScaleH = .9, this.xTextMarginTop = 0, this.xType = "VML2D", this.contextReady = 1, this._lineScale = 1, this._scaleX = 1, this._scaleY = 1, this._mtxEffected = 0, this._zindex = -1, this._mtx = q.identity(), this._stack = [], this._path = [], this._clipPath = null, this._px = 0, this._py = 0, this._elm = a.appendChild(p.createElement("div")), this._elm.style.width = a.clientWidth + "px", this._elm.style.height = a.clientHeight + "px", this._elm.style.overflow = "hidden", this._elm.style.position = "absolute";
                var b = e(this._elm);
                this.xClearColor = b, this.xClipStyle = b, this._clipRect = this._rect(0, 0, this.canvas.width, this.canvas.height)
            }

            function j(a, b) {
                this._type = a, this._param = b, this._colorStop = []
            }

            function k(a, b) {
                switch (b = b || "repeat") {
                    case "repeat":
                        break;
                    default:
                        throw TypeError("bad argument")
                }
                if (this._type = 3, "src" in a) "uuIEBoostAlphapngSrc" in a ? this._src = a.uuIEBoostAlphapngSrc : this._src = a.src, this._repeat = b;
                else if ("getContext" in a) throw Error("not impl")
            }

            function l(a, b) {
                this.width = a, this.height = b
            }

            function m() {
                function a(a) {
                    function b(a, b, e) {
                        return c[d(b.toLowerCase())] = d(e.toLowerCase())
                    }
                    var c = {},
                        d = o.decodeURIComponent;
                    return a.replace(/^.*\?/, "").replace(/&amp;/g, "&").replace(/(?:([^\=]+)\=([^\&]+)&?)/g, b), c
                }
                var b = p.getElementById("uupaa-excanvas.js");
                b && -1 !== b.src.indexOf("?") && uu.mix(B, a(b.src.slice(b.src.indexOf("?") + 1)))
            }

            function n() {
                var a = navigator.userAgent.toLowerCase();
                if (p.uniqueID && /msie/.test(a) && document.all) {
                    if (/msie/.test(a) && !/opera/.test(a)) {
                        var b = parseFloat(a.match(/msie (\d+)/)[1]),
                            c = "BackCompat" == document.compatMode,
                            d = !!document.documentMode && document.documentMode < 9,
                            e = 8 == document.documentMode,
                            f = 7 == b && !document.documentMode || 7 == document.documentMode,
                            g = 7 > b || c;
                        (e || f || g || d) && (p.namespaces.v || p.namespaces.add("v", "urn:schemas-microsoft-com:vml"), p.namespaces.o || p.namespaces.add("o", "urn:schemas-microsoft-com:office:office"), p.createStyleSheet().cssText = "canvas{display:inline-block;text-align:left;width:300px;height:150px}v\\:*{behavior:url(#default#VML)} .uvml{behavior: url(#default#VML);}o\\:*{behavior:url(#default#VML)}")
                    }
                    o.CanvasError = function(a, b) {
                        var c = p.getElementById("output");
                        c && (c.innerHTML = ["type=", b.ErrorType, "code=", b.ErrorCode, "msg=", b.ErrorMessage].join(" "))
                    }, p.attachEvent("onreadystatechange", function() {
                        if (/loaded|complete/.test(p.readyState)) {
                            var a, b = p.getElementsByTagName("canvas"),
                                c = 0,
                                d = b.length,
                                e = 0,
                                f = 0;
                            if (d)
                                for (; d > c; ++c) a = b[c], a.getContext || (" " + a.className + " ").indexOf(" vml ") > -1 && (h(a), ++e);
                            f || ++A
                        }
                    })
                } else o.opera ? o.addEventListener("load", function() {
                    ++A
                }, !1) : /WebKit/.test(navigator.userAgent) && p.readyState ? ! function() {
                    return /loaded|complete/.test(p.readyState) ? void++A : void setTimeout(arguments.callee, 16)
                }() : /Gecko\//.test(navigator.userAgent) ? p.addEventListener("DOMContentLoaded", function() {
                    ++A
                }, !1) : ++A
            }
            var o = window,
                p = document,
                q = uuClass.Matrix,
                r = parseInt,
                s = Math.round,
                t = Math.sin,
                u = Math.cos,
                v = 10,
                w = v / 2,
                x = (new uuClass.ColorDictionary, uuClass.Color._hexAlpha),
                y = {
                    em: 0,
                    pt: 0
                },
                z = null,
                A = 0,
                B = {
                    xamlsrc: uuClass.Canvas.xamlsrc
                },
                C = {
                    width: 1,
                    height: 2
                },
                D = {
                    "source-over": 1,
                    "destination-over": 5,
                    copy: 11
                },
                E = {
                    start: 1,
                    left: 1,
                    center: 2,
                    right: 3,
                    end: 3
                },
                F = {
                    strokeStyle: 1,
                    fillStyle: 1,
                    globalAlpha: 1,
                    lineWidth: 1,
                    lineCap: 1,
                    lineJoin: 1,
                    miterLimit: 1,
                    shadowOffsetX: 1,
                    shadowOffsetY: 1,
                    shadowBlur: 1,
                    shadowColor: 1,
                    globalCompositeOperation: 1,
                    font: 1,
                    textAlign: 1,
                    textBaseline: 1,
                    _lineScale: 1,
                    _scaleX: 1,
                    _scaleY: 1,
                    _mtxEffected: 1,
                    _clipPath: 1
                },
                G = {
                    square: "square",
                    butt: "flat",
                    round: "round"
                };
            uuClass.Canvas.ready = function(a, b) {
                var c, d, e, f;
                if (b) {
                    if (!p.uniqueID) return void a();
                    d = b instanceof Array ? b : [b], e = 0, f = d.length, c = o.setInterval(function() {
                        for (e = 0; f > e; ++e)
                            if (!d[e].getContext().contextReady) return;
                        clearInterval(c), null != a && a()
                    }, 16)
                } else c = o.setInterval(function() {
                    A && (clearInterval(c), null != a && a())
                }, 16)
            }, uuClass.Canvas.already = function(a) {
                if (a) {
                    if (!p.uniqueID) return !0;
                    for (var b = a instanceof Array ? a : [a], c = 0, d = b.length; d > c; ++c)
                        if (!b[c].getContext().contextReady) return !1;
                    return !0
                }
                return !!A
            }, uuClass.Canvas._initDynamicElement = function(a, b) {
                return b ? a.getContext ? a : h(a) : a.getContext ? a : null
            }, i.prototype = {
                save: function() {
                    var a, b = {};
                    for (a in F) b[a] = this[a];
                    this._stack.push([b, uu.mix([], this._mtx), this._clipPath ? String(this._clipPath) : null])
                },
                restore: function() {
                    if (this._stack.length) {
                        var a, b = this._stack.pop();
                        for (a in F) this[a] = b[0][a];
                        this._mtx = b[1], this._clipPath = b[2]
                    }
                },
                scale: function(a, b) {
                    ++this._mtxEffected, this._mtx = q.multiply(q.scale(a, b), this._mtx), this._scaleX *= a, this._scaleY *= b, this._lineScale = (this._mtx[0][0] + this._mtx[1][1]) / 2
                },
                rotate: function(a) {
                    ++this._mtxEffected, this._mtx = q.multiply(q.rotate(a), this._mtx)
                },
                translate: function(a, b) {
                    ++this._mtxEffected, this._mtx = q.multiply(q.translate(a, b), this._mtx)
                },
                transform: function(a, b, c, d, e, f) {
                    this._mtx = q.multiply(q.transform(a, b, c, d, e, f), this._mtx)
                },
                setTransform: function(a, b, c, d, e, f) {
                    this._mtx = q.transform(a, b, c, d, e, f)
                },
                clearRect: function(a, b, c, d) {
                    if (a || b || c != parseInt(this.canvas.width) || d != parseInt(this.canvas.height)) {
                        var e, f = s,
                            g = this._map(a, b),
                            h = this._map(a + c, b),
                            i = this._map(a + c, b + d),
                            j = this._map(a, b + d),
                            k = [" m", f(g.x), " ", f(g.y), " l", f(h.x), " ", f(h.y), " l", f(i.x), " ", f(i.y), " l", f(j.x), " ", f(j.y), " x"].join(""),
                            l = 0,
                            m = x(this.xClearColor),
                            n = m[0],
                            o = m[1] * this.globalAlpha;
                        switch (D[this.globalCompositeOperation] || 1) {
                            case 5:
                                l = --this._zindex;
                                break;
                            case 11:
                                this._clear()
                        }
                        e = ['<v:shape class=uvml style="z-index:', l, ';position:absolute;width:10px;height:10px" filled="t" stroked="f" coordorigin="0,0" coordsize="100,100" path="', k, '"><v:fill class=uvml type="solid" color="', n, '" opacity="', o, '" /></v:shape>'].join(""), this._elm.insertAdjacentHTML("beforeEnd", this._clipPath ? this._clippy(e) : e)
                    } else this._elm.innerHTML = "", this._zindex = 0
                },
                _clear: function() {
                    this._elm.innerHTML = "", this._zindex = 0
                },
                fillRect: function(a, b, c, d) {
                    var e = this._rect(a, b, c, d);
                    this._path = [e], this._px = a, this._py = b, e === this._clipRect && "string" == typeof this.fillStyle && (this.xClipStyle = this.fillStyle), this.fill()
                },
                strokeRect: function(a, b, c, d) {
                    this._path = [], this.rect(a, b, c, d), this.stroke()
                },
                beginPath: function() {
                    this._path = []
                },
                closePath: function() {
                    this._path.push(" x")
                },
                moveTo: function(a, b) {
                    var c = s,
                        d = this._map(a, b);
                    this._path.push("m ", c(d.x), " ", c(d.y)), this._px = a, this._py = b
                },
                lineTo: function(a, b) {
                    var c = s,
                        d = this._map(a, b);
                    this._path.push("l ", c(d.x), " ", c(d.y)), this._px = a, this._py = b
                },
                quadraticCurveTo: function(a, b, c, d) {
                    var e = s,
                        f = this._px + 2 / 3 * (a - this._px),
                        g = this._py + 2 / 3 * (b - this._py),
                        h = f + (c - this._px) / 3,
                        i = g + (d - this._py) / 3,
                        j = this._map(c, d),
                        k = this._map(f, g),
                        l = this._map(h, i);
                    this._path.push("c ", e(k.x), " ", e(k.y), " ", e(l.x), " ", e(l.y), " ", e(j.x), " ", e(j.y)), this._px = c, this._py = d
                },
                bezierCurveTo: function(a, b, c, d, e, f) {
                    var g = s,
                        h = this._map(e, f),
                        i = this._map(a, b),
                        j = this._map(c, d);
                    this._path.push("c ", g(i.x), " ", g(i.y), " ", g(j.x), " ", g(j.y), " ", g(h.x), " ", g(h.y)), this._px = e, this._py = f
                },
                arcTo: function(a, b, c, d, e) {},
                rect: function(a, b, c, d) {
                    this._path.push(this._rect(a, b, c, d)), this._px = a, this._py = b
                },
                _rect: function(a, b, c, d) {
                    var e = s,
                        f = this._map(a, b),
                        g = this._map(a + c, b),
                        h = this._map(a + c, b + d),
                        i = this._map(a, b + d);
                    return [" m", e(f.x), " ", e(f.y), " l", e(g.x), " ", e(g.y), " l", e(h.x), " ", e(h.y), " l", e(i.x), " ", e(i.y), " x"].join("")
                },
                arc: function(a, b, c, d, e, f) {
                    c *= v;
                    var g, h, i, j, k, l = s,
                        m = a + u(d) * c - w,
                        n = b + t(d) * c - w,
                        o = a + u(e) * c - w,
                        p = b + t(e) * c - w;
                    m !== o || f || (m += .125), g = this._map(a, b), h = this._map(m, n), i = this._map(o, p), j = this._scaleX * c, k = this._scaleY * c, this._path.push(f ? "at " : "wa ", l(g.x - j), " ", l(g.y - k), " ", l(g.x + j), " ", l(g.y + k), " ", l(h.x), " ", l(h.y), " ", l(i.x), " ", l(i.y))
                },
                fill: function() {
                    var a = "",
                        b = this._path.join("");
                    if ("string" == typeof this.fillStyle) a = this._fill(this.fillStyle, b);
                    else switch (this.fillStyle._type) {
                        case 1:
                            a = this._linearGradientFill(this.fillStyle, b);
                            break;
                        case 2:
                            a = this._radialGradientFill(this.fillStyle, b);
                            break;
                        case 3:
                            a = this._patternFill(this.fillStyle, b)
                    }
                    a && this._elm.insertAdjacentHTML("beforeEnd", this._clipPath ? this._clippy(a) : a), this._path = []
                },
                _fill: function(a, b, c) {
                    var d = x(a),
                        e = d[0],
                        f = d[1] * this.globalAlpha,
                        g = 0;
                    switch (D[this.globalCompositeOperation] || 1) {
                        case 5:
                            g = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', g, ';position:absolute;width:10px;height:10px" filled="t" stroked="f" coordorigin="0,0" coordsize="100,100" path="', b, '"><v:fill class=uvml type="solid" color="', e, '" opacity="', c || f, '" />', "</v:shape>"].join("")
                },
                _linearGradientFill: function(a, b, c) {
                    var d = a._param,
                        e = this._buildColor(a._colorStop),
                        f = this.globalAlpha,
                        g = 0,
                        h = Math.atan2(Math.pow(d.x1 - d.x0, 2), Math.pow(d.y1 - d.y0, 2)) * Math.toDegrees;
                    switch (d.x0 > d.x1 && (h += 90), d.y0 > d.y1 && (h += 90), h >= 360 && (h -= 360), D[this.globalCompositeOperation] || 1) {
                        case 5:
                            g = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', g, ';position:absolute;width:10px;height:10px" filled="t" stroked="f" coordorigin="0,0" coordsize="100,100" path="', b, '"><v:fill class=uvml type="gradient" method="sigma" focus="0%" colors="', e, '" opacity="', c || f, '" angle="', h, '" /></v:shape>'].join("")
                },
                _radialGradientFill: function(a, b, c) {
                    var d, e, f, g, h = [],
                        i = a._param,
                        j = this._buildColor(a._colorStop),
                        k = this.globalAlpha,
                        l = 0,
                        m = 0,
                        n = i.x1 - i.r1,
                        o = i.y1 - i.r1,
                        p = i.r1 * this._scaleX,
                        q = i.r1 * this._scaleY,
                        r = this._map(n, o);
                    switch (d = i.r0 / i.r1, e = (1 - d + (i.x0 - i.x1) / i.r1) / 2, f = (1 - d + (i.y0 - i.y1) / i.r1) / 2, D[this.globalCompositeOperation] || 1) {
                        case 5:
                            l = --this._zindex, m = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return a._colorStop.length && (g = a._colorStop[0], g.color[1] > .001 && h.push('<v:shape class=uvml style="z-index:', m, ';position:absolute;width:10px;height:10px" filled="t" stroked="f" coordorigin="0,0" coordsize="100,100" path="', b, '"><v:fill class=uvml type="solid" color="', g.color[0], '" opacity="', c || g.color[1] * k, '" /></v:shape>')), h.push('<v:oval class=uvml style="z-index:', l, ";position:absolute;left:", s(r.x / v), "px;top:", s(r.y / v), "px;width:", p, "px;height:", q, 'px" stroked="f" coordorigin="0,0" coordsize="11000,11000"><v:fill class=uvml type="gradientradial" method="sigma" focussize="', d, ",", d, '" focusposition="', e, ",", f, '" opacity="', c || k, '" colors="', j, '" /></v:oval>'), h.join("")
                },
                _patternFill: function(a, b, c) {
                    var d = a._src,
                        e = this.globalAlpha,
                        f = 0;
                    switch (D[this.globalCompositeOperation] || 1) {
                        case 5:
                            f = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', f, ';position:absolute;width:10px;height:10px" filled="t" stroked="f" coordorigin="0,0" coordsize="100,100" path="', b, '"><v:fill class=uvml type="tile" opacity="', c || e, '" src="', d, '" /></v:shape>'].join("")
                },
                stroke: function() {
                    var a = "";
                    if ("string" == typeof this.strokeStyle) a = this._stroke(this.strokeStyle);
                    else switch (this.strokeStyle._type) {
                        case 1:
                            a = this._linearGradientStroke(this.strokeStyle);
                            break;
                        case 2:
                            a = this._radialGradientStroke(this.strokeStyle);
                            break;
                        case 3:
                            a = this._patternStroke(this.strokeStyle)
                    }
                    a && this._elm.insertAdjacentHTML("beforeEnd", this._clipPath ? this._clippy(a) : a), this._path = []
                },
                _stroke: function(a) {
                    var b = x(a),
                        c = b[0],
                        d = b[1] * this.globalAlpha,
                        e = this._path.join(""),
                        f = 0,
                        g = this.lineWidth * this._lineScale,
                        h = this.lineJoin,
                        i = this.miterLimit,
                        j = G[this.lineCap] || "square";
                    switch (D[this.globalCompositeOperation] || 1) {
                        case 5:
                            f = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', f, ';position:absolute;width:10px;height:10px" filled="f" stroked="t" coordorigin="0,0" coordsize="100,100" path="', e, '"><v:stroke class=uvml color="', c, '" weight="', g, 'px" endcap="', j, '" opacity="', d, '" joinstyle="', h, '" miterlimit="', i, '" /></v:shape>'].join("")
                },
                _linearGradientStroke: function(a) {
                    var b = a._param,
                        c = this._path.join(""),
                        d = 0,
                        e = this._buildColor(a._colorStop),
                        f = this.globalAlpha,
                        g = this.lineWidth * this._lineScale,
                        h = this.lineJoin,
                        i = this.miterLimit,
                        j = G[this.lineCap] || "square",
                        k = Math.atan2(Math.pow(b.x1 - b.x0, 2), Math.pow(b.y1 - b.y0, 2)) * Math.toDegrees;
                    switch (b.x0 > b.x1 && (k += 90), b.y0 > b.y1 && (k += 90), k >= 360 && (k -= 360), D[this.globalCompositeOperation] || 1) {
                        case 5:
                            d = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', d, ';position:absolute;width:10px;height:10px" filled="f" stroked="t" coordorigin="0,0" coordsize="100,100" path="', c, '"><v:stroke class=uvml filltype="solid" colors="', e, '" angle="', k, '" weight="', g, 'px" endcap="', j, '" opacity="', f, '" joinstyle="', h, '" miterlimit="', i, '" /></v:shape>'].join("")
                },
                _radialGradientStroke: function(a) {
                    var b, c, d = [],
                        e = a._param,
                        f = 0,
                        g = 0,
                        h = this.lineWidth * this._lineScale,
                        i = this.lineJoin,
                        j = this.miterLimit,
                        k = G[this.lineCap] || "square",
                        l = e.x1 - e.r1,
                        m = e.y1 - e.r1,
                        n = e.r1 * this._scaleX,
                        o = e.r1 * this._scaleY,
                        p = this._map(l, m);
                    switch (D[this.globalCompositeOperation] || 1) {
                        case 5:
                            f = --this._zindex, g = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return a._colorStop.length && (b = a._colorStop[0], b.color[1] > .001 && (c = this._path.join(""), d.push('<v:shape class=uvml style="z-index:', g, ';position:absolute;width:10px;height:10px" filled="t" stroked="f" coordorigin="0,0" coordsize="100,100" path="', c, '"><v:fill class=uvml type="solid" color="', b.color[0], '" opacity="', b.color[1] * this.globalAlpha, '" /></v:shape>')), b = a._colorStop[s(a._colorStop.length / 2) - 1], d.push('<v:oval class=uvml style="z-index:', f, ";position:absolute;left:", s(p.x / v), "px;top:", s(p.y / v), "px;width:", n, "px;height:", o, 'px" stroked="t" coordorigin="0,0" coordsize="11000,11000">', '<v:stroke class=uvml filltype="tile" weight="', h, 'px" endcap="', k, '" joinstyle="', i, '" miterlimit="', j, ",", '" opacity="', b.color[1] * this.globalAlpha, '" color="', b.color[0], '" /></v:oval>')), d.join("")
                },
                _patternStroke: function(a) {
                    var b = this._path.join(""),
                        c = 0,
                        d = a._src,
                        e = this.globalAlpha,
                        f = this.lineWidth * this._lineScale,
                        g = this.lineJoin,
                        h = this.miterLimit,
                        i = G[this.lineCap] || "square";
                    switch (D[this.globalCompositeOperation] || 1) {
                        case 5:
                            c = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', c, ';position:absolute;width:10px;height:10px" filled="f" stroked="t" coordorigin="0,0" coordsize="100,100" path="', b, '"><v:stroke class=uvml filltype="tile" weight="', f, 'px" endcap="', i, '" opacity="', e, '" joinstyle="', g, '" miterlimit="', h, '" src="', d, '" /></v:shape>'].join("")
                },
                clip: function() {
                    this._clipPath = this._clipRect + " x " + this._path.join("")
                },
                _clippy: function(a) {
                    return [a, '<v:shape class=uvml style="position:absolute;width:10px;height:10px" filled="t" stroked="f" coordorigin="0,0" coordsize="100,100" path="', this._clipPath, '"><v:fill class=uvml type="solid" color="', this.xClipStyle, '" />', "</v:shape>"].join("")
                },
                isPointInPath: function(a, b) {},
                fillText: function(a, b, c, d) {
                    var e;
                    if ("string" == typeof this.fillStyle) e = this._fillText(a, b, c, d, this.fillStyle);
                    else switch (this.fillStyle._type) {
                        case 1:
                            e = this._linearGradientFillText(a, b, c, d, this.fillStyle);
                            break;
                        case 2:
                            e = this._radialGradientFillText(a, b, c, d, this.fillStyle);
                            break;
                        case 3:
                            e = this._patternFillText(a, b, c, d, this.fillStyle)
                    }
                    e && this._elm.insertAdjacentHTML("beforeEnd", this._clipPath ? this._clippy(e) : e)
                },
                _fillText: function(a, e, f, g, h) {
                    a = a.replace(/( |\t|\v|\f|\r\n|\r|\n)/g, " ");
                    var i, j, k, l = x(h),
                        m = l[0],
                        n = l[1] * this.globalAlpha,
                        o = 0,
                        p = E[this.textAlign] || 1,
                        q = b(a, this.font),
                        r = 0;
                    switch (k = d(c(this.font).FontSize, 1), i = q.w * this.xFontScaleW, j = q.h * this.xFontScaleH * k.scale, 2 === p ? r = i / 2 : 3 === p && (r = i), D[this.globalCompositeOperation] || 1) {
                        case 5:
                            o = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', o, ";position:absolute;width:", i, "px;height:", j, "px;left:", e - r, "px;top:", f + this.xTextMarginTop + k.margin, 'px;" stroked="f" coordSize="21600,21600" o:spt="136" strokeColor="', m, '" fillColor="', m, ' opacity="', n, '">', '<v:textpath class=uvml style="font:', this.font, '" string="', a, '" />', "</v:shape>"].join("")
                },
                strokeText: function(a, b, c, d) {
                    var e;
                    "string" == typeof this.fillStyle && (e = this._strokeText(a, b, c, d, this.strokeStyle)), e && this._elm.insertAdjacentHTML("beforeEnd", this._clipPath ? this._clippy(e) : e)
                },
                _strokeText: function(a, e, f, g, h) {
                    a = a.replace(/( |\t|\v|\f|\r\n|\r|\n)/g, " ");
                    var i, j, k, l = x(h),
                        m = l[0],
                        n = l[1] * this.globalAlpha,
                        o = 0,
                        p = b(a, this.font),
                        q = E[this.textAlign] || 1,
                        r = 0;
                    switch (k = d(c(this.font).FontSize, 1), i = p.w * this.xFontScaleW, j = p.h * this.xFontScaleH * k.scale, 2 === q ? r = i / 2 : 3 === q && (r = i), D[this.globalCompositeOperation] || 1) {
                        case 5:
                            o = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return ['<v:shape class=uvml style="z-index:', o, ";position:absolute;width:", i, "px;height:", j, "px;left:", e - r, "px;top:", f + this.xTextMarginTop + k.margin, 'px;" stroked="t" filled="f" coordSize="21600,21600" o:spt="136" strokeColor="', m, '" fillColor="', m, ' opacity="', n, '">', '<v:textpath class=uvml style="font:', this.font, '" string="', a, '" />', "</v:shape>"].join("")
                },
                measureText: function(a) {
                    var c = b(a, this.font),
                        d = c.w * this.xFontScaleW,
                        e = c.h * this.xFontScaleH;
                    return new l(d, e)
                },
                drawImage: function(a) {
                    var b, c, d, e, f, g, h, i, j, k, l, m = "",
                        n = arguments;
                    if ("src" in a) {
                        switch (j = a.width, k = a.height, n.length) {
                            case 3:
                                b = n[1], c = n[2], d = j, e = k, f = 0, g = 0, h = j, i = k, l = "image";
                                break;
                            case 5:
                                b = n[1], c = n[2], d = n[3], e = n[4], f = 0, g = 0, h = j, i = k, l = "scale";
                                break;
                            case 9:
                                b = n[5], c = n[6], d = n[7], e = n[8], f = n[1], g = n[2], h = n[3], i = n[4], l = "scale";
                                break;
                            default:
                                throw TypeError("CanvasRenderingContext2D.drawImage")
                        }
                        m = this._drawImage(a, f, g, h, i, b, c, d, e, j, k, l), this._elm.insertAdjacentHTML("beforeEnd", this._clipPath ? this._clippy(m) : m)
                    }
                },
                _drawImage: function(a, b, c, d, e, f, g, h, i, j, k, l) {
                    function m(a, b, c, d) {
                        var e = n._mtx,
                            f = s,
                            g = n._map(a, b),
                            h = n._map(a + c, b),
                            i = n._map(a, b + d),
                            j = n._map(a + c, b + d),
                            k = ["M11='", e[0][0], "',M12='", e[1][0], "',M21='", e[0][1], "',M22='", e[1][1], "',Dx='", f(g.x / v), "',Dy='", f(g.y / v), "'"],
                            l = ["padding:0 ", f(Math.max(g.x, h.x, i.x, j.x) / v), "px ", f(Math.max(g.y, h.y, i.y, j.y) / v), "px 0;", "filter:progid:DXImageTransform.Microsoft.Matrix(", k.join(""), ",sizingmethod='clip')"];
                        return l.join("")
                    }
                    var n = this,
                        o = [],
                        p = s,
                        q = this._map(f, g),
                        r = 0,
                        t = "filter:progid:DxImageTransform.Microsoft",
                        w = b || c;
                    switch (D[this.globalCompositeOperation] || 1) {
                        case 5:
                            r = --this._zindex;
                            break;
                        case 11:
                            this._clear()
                    }
                    return this._mtxEffected ? o.push('<div style="z-index:', r, ";position:absolute;", m(f, g, h, i), '">') : o.push('<div style="z-index:', r, ";position:absolute;", "top:", p(q.y / v), "px;left:", p(q.x / v), "px", '">'), o.push('<div style="position:relative;overflow:hidden;width:', p(h), "px;height:", p(i), 'px">'), w && o.push('<div style="width:', u(h + b * h / d), "px;", "height:", u(i + c * i / e), "px;", t, ".Matrix(Dx=", -b * h / d, ",Dy=", -c * i / e, ')">'), o.push('<div style="width:', p(j * h / d), "px;", "height:", p(k * i / e), "px;", t, ".AlphaImageLoader(src=", a.src, ",sizingMethod=" + l + ')"></div>'), o.push(w ? "</div>" : "", "</div></div>"), o.join("")
                },
                createImageData: function(a, b) {},
                getImageData: function(a, b, c, d) {},
                putImageData: function(a, b, c, d, e, f, g) {},
                createLinearGradient: function(a, b, c, d) {
                    return new j(1, {
                        x0: a,
                        y0: b,
                        x1: c,
                        y1: d
                    })
                },
                createRadialGradient: function(a, b, c, d, e, f) {
                    return new j(2, {
                        x0: a,
                        y0: b,
                        r0: c,
                        x1: d,
                        y1: e,
                        r1: f
                    })
                },
                createPattern: function(a, b) {
                    return new k(a, b)
                },
                _buildColor: function(a) {
                    for (var b = [], c = 0, d = a.length; d > c; ++c) b.push(a[c].offset + " " + a[c].color[0]);
                    return b.join(",")
                },
                _map: function(a, b) {
                    return {
                        x: v * (a * this._mtx[0][0] + b * this._mtx[1][0] + this._mtx[2][0]) - w,
                        y: v * (a * this._mtx[0][1] + b * this._mtx[1][1] + this._mtx[2][1]) - w
                    }
                },
                xClearBegin: function(a, b) {
                    if (this._node) {
                        this._elm.innerHTML = "", this._zindex = 0;
                        var c = s,
                            d = this._map(a, b);
                        this._path = ["m ", c(d.x), " ", c(d.y)], this._px = a, this._py = b
                    }
                }
            }, j.prototype.addColorStop = function(a, b) {
                function c(a, b) {
                    return a.offset - b.offset
                }
                for (var d, e = 0, f = this._colorStop.length; f > e; ++e) d = this._colorStop[e], d.offset === a && 1 > a && a > 0 && (a += f / 1e3);
                this._colorStop.push({
                    offset: 1 - a,
                    color: x(b)
                }), this._colorStop.sort(c)
            }, uuClass.Canvas.VML2D = i, uuClass.Canvas.VMLGradient = j, uuClass.Canvas.VMLPattern = k, uuClass.Canvas.VMLTextMetrics = l, p.uniqueID && (o.CanvasRenderingContext2D = function() {}, o.CanvasGradient = function() {}, o.CanvasPattern = function() {}), uuClass.Canvas.InitCavansElement = function(a) {
                null != a && (a.getContext || (" " + a.className + " ").indexOf(" vml ") > -1 && h(a))
            }, m(), n()
        }())
    }), define("core/Common/Environment", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF"),
            e = function() {
                var a = navigator.userAgent.toLowerCase(),
                    b = window.opera,
                    c = {
                        ie: /msie/.test(a) && !/opera/.test(a) && document.all,
                        ieAtLeast11: !/msie/.test(a) && /trident/.test(a) && !/opera/.test(a),
                        edge: a.indexOf("edge") > -1,
                        opera: !!b && b.version,
                        webkit: a.indexOf(" applewebkit/") > -1,
                        chrome: a.indexOf("chrome") > -1,
                        safari: a.indexOf("safari") > -1 && -1 == a.indexOf("chrome"),
                        gecko: a.indexOf("gecko") > -1 || "Gecko" == navigator.product,
                        mac: a.indexOf("macintosh") > -1,
                        quirks: "BackCompact" == document.CompactMode,
                        iOS: /(ipad|iphone|ipod)/.test(a),
                        android: /android/i.test(a),
                        blackberry: /blackberry/i.test(a),
                        webos: /webos/i.test(a),
                        kindle: /silk|kindle/i.test(a),
                        secure: "https:" == location.protocol
                    };
                if (c.mobile = /mobile/i.test(a) || c.iOS || c.android || c.blackberry || c.webos || c.kindle, c.mobile) {
                    var d = !0;
                    if (c.iOS) {
                        var e = navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);
                        e && e.length > 0 && parseInt(e[1]) < 4 && (console.log("Version of IOS is lower than 4.0"), d = !1)
                    } else if (c.android) {
                        var f = a.match(/android\s+([\d\.]+)/);
                        if (f && f.length > 0) {
                            var g = a.match(/android\s+([\d\.]+)/)[1];
                            parseFloat(g) < 4 && (console.log("Version of android is lower than 4.0"), d = !1)
                        } else d = !1
                    }
                    $.support.isElasticScrollSupported = d
                }
                c.gecko = "Gecko" == navigator.product && !c.webkit && !c.opera;
                var h = 0;
                if (c.ie ? (h = parseFloat(a.match(/msie (\d+)/)[1]), c.ie8 = !!document.documentMode && document.documentMode < 8, c.ie8Compact = 8 == document.documentMode, c.ie9Compact = 9 == document.documentMode, c.ie10Compact = 10 == document.documentMode, c.ie7Compact = 7 == h && !document.documentMode || 7 == document.documentMode, c.ie6Compact = 7 > h || c.quirks, c.ie8OrLower = c.ie8 || c.ie8Compact || c.ie7Compact || c.ie6Compact) : c.ie8OrLower = !1, c.gecko) {
                    var i = a.match(/rv:([\d\.]+)/);
                    i && (i = i[1].split("."), h = 1e4 * i[0] + 100 * (i[1] || 0) + 1 * (i[2] || 0))
                }
                return c.opera && (h = parseFloat(b.version())), c.webkit && (h = parseFloat(a.match(/ applewebkit\/(\d+)/)[1])), c.version = h, c.isCompatible = c.iOS && h >= 534 || !c.mobile && (c.ie && h >= 6 || c.gecko && h >= 10801 || c.opera && h >= 9.5 || c.webkit && h >= 522 || !1), c
            }();
        return d.Environment = {
            ie: e.ie,
            chrome: e.chrome,
            safari: e.safari,
            ieAtLeast11: e.ieAtLeast11,
            edge: e.edge,
            opera: e.opera,
            webkit: e.webkit,
            gecko: e.gecko,
            mac: e.mac,
            quirks: e.quirks,
            mobile: e.mobile,
            iOS: e.iOS,
            secure: e.secure,
            version: e.version,
            ie8: e.ie8,
            ie8Compact: e.ie8Compact,
            ie9Compact: e.ie9Compact,
            ie10Compact: e.ie10Compact,
            ie7Compact: e.ie7Compact,
            ie6Compact: e.ie6Compact,
            ie8OrLower: e.ie8OrLower,
            isCompatible: e.isCompatible
        }, d.Environment
    }), define("core/Common/Support", ["core/WebPDF"], function(a, b, c) {
        function d(a, b, c, d) {
            var e, f, g, h = "",
                k = document.createElement("div"),
                l = document.body,
                m = l || document.createElement("body");
            if (parseInt(c, 10))
                for (; c--;) g = document.createElement("div"), g.id = d ? d[c] : j + (c + 1), k.appendChild(g);
            return e = ["&#173;", '<style id="s', j, '">', a, "</style>"].join(""), k.id = j, (l ? k : m).innerHTML += e, m.appendChild(k), l || (m.style.background = "", m.style.overflow = "hidden", h = i.style.overflow, i.style.overflow = "hidden", i.appendChild(m)), f = b(k, a), l ? k.parentNode.removeChild(k) : (m.parentNode.removeChild(m), i.style.overflow = h), !!f
        }

        function e(a) {
            l.cssText = a
        }

        function f(a, b) {
            return !!~("" + a).indexOf(b)
        }
        var g = (a("core/WebPDF"), {}),
            h = " -webkit- -moz- -o- -ms- ".split(" "),
            i = document.documentElement,
            j = "modernizr",
            k = document.createElement(j),
            l = k.style;
        g.touch = function() {
            var a = !1;
            return "ontouchstart" in window || window.DocumentTouch && document instanceof DocumentTouch ? a = !0 : d(["@media (", h.join("touch-enabled),("), j, ")", "{#modernizr{top:9px;position:absolute}}"].join(""), function(b) {
                a = 9 === b.offsetTop
            }), a
        }, g.canvas = function() {
            var a = document.createElement("canvas");
            return !(!a.getContext || !a.getContext("2d"))
        }, g.rgba = function() {
            return e("background-color:rgba(150,255,150,.5)"), f(l.backgroundColor, "rgba")
        }, g.setLineDash = function() {
            var a = !1,
                b = document.createElement("canvas");
            if ($.support.canvas) {
                var c = b.getContext("2d");
                "setLineDash" in c && (a = !0)
            }
            return a
        }, g.placeholder = function() {
            return "placeholder" in document.createElement("input")
        }, $.support.canvas = g.canvas(), $.support.rgba = g.rgba(), $.support.touch = g.touch(), $.support.setLineDash = g.setLineDash(), $.support.cors = !0, $.support.placeholder = g.placeholder()
    }), define("core/Common/Math/Rect", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.RectUtils = {
            clone: function(a) {
                return new d.PDFRect(a.left, a.top, a.right, a.bottom)
            },
            copy: function(a, b) {
                b.left = a.left, b.top = a.top, b.right = a.right, b.bottom = a.bottom
            },
            equal: function(a, b) {
                return b.left === a.left && b.top === a.top && b.right === a.right && b.bottom === a.bottom
            },
            width: function(a) {
                return Math.abs(a.right - a.left)
            },
            height: function(a) {
                return Math.abs(a.bottom - a.top)
            },
            empty: function(a) {
                a.left = a.top = a.right = a.bottom = 0
            },
            isEmpty: function(a) {
                return a.left >= a.right || a.bottom >= a.top
            },
            offset: function(a, b, c) {
                a.left += b, a.right += b, a.top += c, a.bottom += c
            },
            ptInRect: function(a) {
                var b = 0,
                    c = 0;
                return 2 == arguments.length ? (b = arguments[1].x, c = arguments[1].y) : 3 != arguments.length || isNaN(arguments[1]) || isNaN(arguments[2]) || (b = arguments[1], c = arguments[2]), b >= a.left && b <= a.right && c <= a.top && c >= a.bottom
            },
            intersect: function(a, b) {
                a.left = Math.max(a.left, b.left), a.top = Math.min(a.top, b.top), a.right = Math.min(a.right, b.right), a.bottom = Math.max(a.bottom, b.bottom)
            },
            intersectInUserSpace: function(a, b) {
                a.left = Math.max(a.left, b.left), a.top = Math.max(a.top, b.top), a.right = Math.min(a.right, b.right), a.bottom = Math.min(a.bottom, b.bottom)
            },
            normalize: function(a) {
                var b;
                a.left > a.right && (b = a.left, a.left = a.right, a.right = b), a.bottom > a.top && (b = a.bottom, a.bottom = a.top, a.top = b)
            },
            normalizeEx: function(a) {
                var b;
                a.left > a.right && (b = a.left, a.left = a.right, a.right = b), a.top > a.bottom && (b = a.bottom, a.bottom = a.top, a.top = b)
            },
            union: function(a, b) {
                a.left = Math.min(a.left, b.left), a.top = Math.max(a.top, b.top), a.right = Math.max(a.right, b.right), a.bottom = Math.min(a.bottom, b.bottom)
            },
            deflate: function(a, b) {
                a.left += b, a.right -= b, a.top -= b, a.bottom += b
            },
            inflate: function(a, b) {
                a.left -= b, a.right += b, a.top += b, a.bottom -= b
            },
            deflateEx: function(a, b) {
                a.left += b, a.right -= b, a.top += b, a.bottom -= b
            },
            inflateEx: function(a, b) {
                a.left -= b, a.right += b, a.top -= b, a.bottom += b
            },
            setRect: function(a) {
                2 == arguments.length ? d.RectUtils.copy(arguments[1], this) : 5 == arguments.length && (isNaN(arguments[1]) || isNaN(arguments[2]) || isNaN(arguments[3]) || isNaN(arguments[4]) || (a.left = arguments[1], a.top = arguments[2], a.right = arguments[3], a.bottom = arguments[4]))
            }
        }, d.PDFRect = function() {
            switch (this.left = this.top = this.right = this.bottom = 0, arguments.length) {
                case 1:
                    d.RectUtils.setRect(this, arguments[0]);
                    break;
                case 4:
                    d.RectUtils.setRect(this, arguments[0], arguments[1], arguments[2], arguments[3])
            }
        }, d.PDFRect
    }), define("core/Common/Math/Point", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.PDFPoint = function(a, b) {
            this.x = this.y = 0, 2 === arguments.length && (this.x = isNaN(a) ? 0 : a, this.y = isNaN(b) ? 0 : b), this.clone = function() {
                return new this.constructor(this.x, this.y)
            }, this.setPoint = function(a, b) {
                isNaN(a) || isNaN(b) || (this.x = a, this.y = b)
            }, this.offset = function(a, b) {
                isNaN(a) || isNaN(b) || (this.x += a, this.y += b)
            }, this.equal = function(a) {
                return this.x === a.x && this.y === a.y
            }
        }, d.PDFPoint
    }), define("core/Common/Math/JSMap", ["core/WebPDF"], function(a, b, c) {
        function d() {
            var a = function(a, b) {
                    this.key = a, this.value = b
                },
                b = function(b, c) {
                    for (var d = 0; d < this.arr.length; d++)
                        if (this.arr[d].key === b) return void(this.arr[d].value = c);
                    this.arr[this.arr.length] = new a(b, c)
                },
                c = function(a) {
                    for (var b = 0; b < this.arr.length; b++)
                        if (this.arr[b].key === a) return this.arr[b].value;
                    return null
                },
                d = function(a) {
                    for (var b, c = 0; c < this.arr.length; c++) b = this.arr.pop(), b.key !== a && this.arr.unshift(b)
                },
                e = function() {
                    return this.arr.length
                },
                f = function() {
                    return this.arr.length <= 0
                };
            this.arr = new Array, this.get = c, this.put = b, this.remove = d, this.size = e, this.isEmpty = f
        }
        var e = a("core/WebPDF");
        return e.CMap = d, e.CMap
    }), define("core/Common/Math/Matrix", ["core/WebPDF"], function(b, c, e) {
        return b("core/WebPDF"), WebPDF.PDFMatrix = function() {
            this.a = 1, this.b = 0, this.c = 0, this.d = 1, this.e = 0, this.f = 0, this.Set = function(a, b, c, d, e, f) {
                this.a = a, this.b = b, this.c = c, this.d = d, this.e = e, this.f = f
            }, this.Reset = function() {
                this.a = this.d = 1, this.b = this.c = this.e = this.f = 0
            }, this.SetReverse = function(a) {
                var b = a.a * a.d - a.b * a.c;
                if (0 != b) {
                    var c = -b;
                    this.a = a.d / b, this.b = a.b / c, this.c = a.c / c, this.d = a.a / b, this.e = (a.c * a.f - a.d * a.e) / b, this.f = (a.a * a.f - a.b * a.e) / c
                }
            }, this.Rotate = function(a, b) {
                var c = Math.cos(a),
                    d = Math.sin(a),
                    e = new WebPDF.PDFMatrix;
                e.Set(c, d, -d, c, 0, 0);
                var f = null;
                f = b ? WebPDF.PDFMatrix.Concat2mt(e, this) : WebPDF.PDFMatrix.Concat2mt(this, e), this.Set(f.a, f.b, f.c, f.d, f.e, f.f)
            }, this.RotateAt = function(a, b, c, d) {
                this.Translate(a, b, d), this.Rotate(c, d), this.Translate(-a, -b, d)
            }, this.Concat = function(a, b, c, d, e, f, g) {
                var h = new WebPDF.PDFMatrix;
                h.Set(a, b, c, d, e, f);
                var i = null;
                i = g ? WebPDF.PDFMatrix.Concat2mt(h, this) : WebPDF.PDFMatrix.Concat2mt(this, h), this.Set(i.a, i.b, i.c, i.d, i.e, i.f)
            }, this.Is90Rotated = function() {
                var a = 1e3 * this.a;
                0 > a && (a *= -1);
                var b = 1e3 * this.d;
                0 > b && (b *= -1);
                var c = this.b;
                0 > c && (c *= -1);
                var d = this.c;
                return 0 > d && (d *= -1), c > a && d > b
            }, this.IsScaled = function() {
                var a = 1e3 * this.b;
                0 > a && (a *= -1);
                var b = 1e3 * this.c;
                0 > b && (b *= -1);
                var c = this.a;
                0 > c && (c *= -1);
                var d = this.d;
                return 0 > d && (d *= -1), c > a && d > b
            }, this.GetA = function() {
                return this.a
            }, this.GetB = function() {
                return this.b
            }, this.GetC = function() {
                return this.c
            }, this.GetD = function() {
                return this.d
            }, this.GetE = function() {
                return this.e
            }, this.GetF = function() {
                return this.f
            }, this.Translate = function(a, b, c) {
                c ? (this.e += a * this.a + b * this.c, this.f += b * this.d + a * this.b) : (this.e += a, this.f += b)
            }, this.Scale = function(a, b, c) {
                this.a *= a, this.d *= b, c ? (this.b *= a, this.c *= b) : (this.b *= b, this.c *= a, this.e *= a, this.f *= b)
            }, this.TransformXDistance = function(a) {
                var b = this.a * a,
                    c = this.b * a;
                return Math.sqrt(b * b + c * c)
            }, this.TransformYDistance = function(a) {
                var b = this.c * a,
                    c = this.d * a;
                return Math.sqrt(b * b + c * c)
            }, this.TransformDistance = function(a, b) {
                var c = this.a * a + this.c * b,
                    d = this.b * a + this.d * b;
                return Math.sqrt(c * c + d * d)
            }, this.TransFormPoint = function(a, b) {
                var c = this.a * a + this.c * b + this.e,
                    d = this.b * a + this.d * b + this.f,
                    e = [];
                return e[0] = parseFloat(c.toFixed(3)), e[1] = parseFloat(d.toFixed(3)), e
            }, this.TransFormRect = function(a, b, c, d) {
                var e = function(a, b, c, d) {
                        var e = [],
                            f = [];
                        e[0] = a, f[0] = c, e[1] = a, f[1] = d, e[2] = b, f[2] = c, e[3] = b, f[3] = d;
                        for (var g, h = 0; 4 > h; h++) g = this.TransFormPoint(e[h], f[h]), e[h] = g[0], f[h] = g[1];
                        g = null;
                        var i = [e[0], e[0], f[0], f[0]];
                        for (h = 1; 4 > h; h++) i[0] > e[h] && (i[0] = e[h]), i[1] < e[h] && (i[1] = e[h]), i[2] > f[h] && (i[2] = f[h]), i[3] < f[h] && (i[3] = f[h]);
                        return i
                    },
                    f = e.call(this, a, c, b, d),
                    g = [];
                return g[0] = f[0], g[1] = f[2], g[2] = f[1], g[3] = f[3], f = null, e = null, g
            }, this.GetXUnit = function() {
                return 0 === this.b ? Math.abs(this.a) : 0 === a ? Math.abs(this.b) : Math.sqrt(this.a * this.a + this.b * this.b)
            }, this.GetYUnit = function() {
                return 0 === this.c ? Math.abs(this.d) : 0 === d ? Math.abs(this.c) : Math.sqrt(this.c * this.c + this.d * this.d)
            }, this.GetUnitRect = function() {
                return this.TransFormRect(0, 0, 1, 1)
            }, this.MatchRect = function(a, b) {
                var c = b[0] - b[2];
                this.a = Math.abs(c) < .001 ? 1 : (a[0] - a[2]) / c, c = b[3] - b[1], this.d = Math.abs(c) < .001 ? 1 : (a[3] - a[1]) / c, this.e = a[0] - b[0] * this.a, this.f = a[3] - b[3] * this.d, this.b = 0, this.c = 0
            }
        }, WebPDF.PDFMatrix.Concat2mt = function(a, b) {
            var c = a.a * b.a + a.b * b.c,
                d = a.a * b.b + a.b * b.d,
                e = a.c * b.a + a.d * b.c,
                f = a.c * b.b + a.d * b.d,
                g = a.e * b.a + a.f * b.c + b.e,
                h = a.e * b.b + a.f * b.d + b.f,
                i = new WebPDF.PDFMatrix;
            return i.Set(c, d, e, f, g, h), i
        }, WebPDF.PDFMatrix
    }), define("core/Common/CommonDialog", ["core/WebPDF"], function(a, b, c) {
        function d(a, b, c, d, e) {
            v = i18n.t("CommonDialog.DefaultDlgTitle");
            var g = "fwrTextCopyArea",
                h = "fwrTextCopyDlg",
                i = "fwrTextCopyClose",
                j = "fwrTextCopyTitle",
                k = null,
                l = null,
                m = null;
            if (!r) {
                var n = "";
                n = f.Environment.mobile ? "<textarea id='" + g + "' class='t-copy'  type='text' value=''  />" : "<textarea id='" + g + "' type='text' value=''  readonly='readonly'/>", a.addIgnoreMouseEventClass("fwr-text-copy-dlg"), p = "<div id='" + h + "' class='fwr-modal fwr-hide fwr-fade fwr-in fwr-text-copy-dlg'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 id='" + j + "'>Text Copy</h4></div><div class='fwr-modal-body'><div ><span id='textCopyMsg' data-i18n='[html]CommonDialog.TextCopyLimitMsg'>Current browser is not able to copy the text directly. Please copy the text manually.</span></div>" + n + "</div><div class='fwr-modal-footer'><a href='#' id='" + i + "' class='btn'  webpdf-data-dismiss='modal' data-i18n='[html]CommonDialog.DefaultCloseBtnTitle'>Close</a></div></div>", $("#" + a.getMainFrameId()).append(p), q = $("#" + h), r = !0
            }
            if (q) {
                k = $("#" + j), l = $("#" + i), m = $("#" + g), c || (c = v), k.html(c);
                var o = $("#textCopyMsg");
                o.html(i18n.t("CommonDialog.TextCopyLimitMsg")), $.isFunction(e) && q.off("hidden.bs.webpdf-modal").on("hidden.bs.webpdf-modal", function() {
                    e()
                }), m.val(b), d || (d = i18n.t("CommonDialog.DefaultCloseBtnTitle")), l.text(d), a.isMobile() && f.Environment.iOS && (l.unbind("touchstart").bind("touchstart", function() {
                    q.webPDFModal("hide")
                }), q.find(".close").unbind("touchstart").bind("touchstart", function() {
                    q.webPDFModal("hide")
                }), q.find("textarea").unbind("touchstart").bind("touchstart", function() {
                    this.setSelectionRange(0, m.val().length), m.focus()
                })), q.webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    manager: "#" + a.getMainFrameId()
                }), q.focus(), f.Environment.mobile ? m.off("click").on("click", function() {
                    return this.setSelectionRange(0, m.val().length), m.focus(), !1
                }) : (m.focus(), m.select())
            }
        }

        function e(a) {
            if (window.netscape) {
                try {
                    netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")
                } catch (b) {
                    return !1
                }
                var c = Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);
                if (!c) return;
                var d = Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);
                if (!d) return;
                d.addDataFlavor("text/unicode");
                var e = Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);
                e.data = a, d.setTransferData("text/unicode", e, 2 * a.length);
                var f = Components.interfaces.nsIClipboard;
                return c ? (c.setData(d, null, f.kGlobalClipboard), !0) : !1
            }
        }
        var f = a("core/WebPDF"),
            g = "",
            h = null,
            i = !1,
            j = "",
            k = null,
            l = !1,
            m = "",
            n = !1,
            o = null,
            p = "",
            q = null,
            r = !1,
            s = {},
            t = {},
            u = {},
            v = "";
        f.notSupportBrowser = function(a, b) {
            var c = document.getElementById("notSupportBrowser");
            null != c && $(c).show(), b === !0 ? $(c).children("p").html(a) : ($(c).children("p").html(a), window.setTimeout(function() {
                $(c).hide(), $(this).resize()
            }, 1e4)), f.closeWaiting()
        }, f.waiting = function(a, b, c) {
            null == a && (a = f.Tool.getReaderApp()), null == b && (b = "fwr-ajax-loading"), c || (c = "");
            var d = $("#" + f.Tool.getReaderApp().getMainFrameId());
            if (!d.hasClass("fwr-doc-viewer-loading")) {
                v = i18n.t("CommonDialog.DefaultDlgTitle");
                var e = "LoadingDlg" + b,
                    g = !1;
                if (u[b] ? g = !0 : (a.addIgnoreMouseEventClass(b), s[b] = "<div id='" + e + "' class='fwr-modal fwr-hide fwr-fade fwr-in " + b + "'><span id='fwr_loadingText' class='fwr-ajax-loading-text'>" + c + "</span></div>", t[b] = $(s[b]), u[b] = !0), t[b]) {
                    t[b].i18n(), t[b].webPDFModal({
                        keyboard: !1,
                        backdrop: "static",
                        manager: "#" + f.Tool.getReaderApp().getMainFrameId()
                    }), g && $("#fwr_loadingText").text(c);
                    var h = $(".fwr-modal-backdrop");
                    h.length > 0 && h.addClass("fwr-modal-backdrop-loading"), d.addClass("fwr-doc-viewer-loading")
                }
            }
        }, f.closeWaiting = function(a, b) {
            null == a && (a = f.Tool.getReaderApp()), null == b && (b = "fwr-ajax-loading"), t && t[b] && t[b].webPDFModal("hide");
            var c = $("#" + f.Tool.getReaderApp().getMainFrameId());
            c.removeClass("fwr-doc-viewer-loading")
        }, f.uploading = function(a, b) {
            var c = $("#" + f.Tool.getReaderApp().getMainFrameId()),
                d = "fwr-ajax-uploading";
            null == a && (a = f.Tool.getReaderApp()), v = i18n.t("CommonDialog.DefaultDlgTitle");
            var e = {
                waitingDlgId: "LoadingDlg_" + d,
                loadingCss: d,
                uploadingTextId: "uploadingText",
                uploadingText: b + "% " + i18n.t("CommonLng.Create.Uploading")
            };
            if (!u[d]) {
                a.addIgnoreMouseEventClass(d);
                var g = "<div id='{waitingDlgId}' class='fwr-modal fwr-hide fwr-fade fwr-in {loadingCss}'><span id='uploadingText' class='fwr-ajax-uploading-text'>{uploadingText}</span></div>";
                s[d] = g.format(e), t[d] = $(s[d]), u[d] = !0
            }
            if (t[d]) {
                t[d].i18n(), t[d].webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    manager: "#" + f.Tool.getReaderApp().getMainFrameId()
                }), $("#" + e.uploadingTextId).text(e.uploadingText);
                var h = $(".fwr-modal-backdrop");
                h.length > 0 && h.addClass("fwr-modal-backdrop-loading"), c.addClass("fwr-doc-viewer-loading")
            }
        }, f.closeUploading = function(a) {
            null == a && (a = f.Tool.getReaderApp());
            var b = "fwr-ajax-uploading";
            t && t[b] && t[b].webPDFModal("hide");
            var c = $("#" + f.Tool.getReaderApp().getMainFrameId());
            c.removeClass("fwr-doc-viewer-loading")
        }, f.downloading = function(a) {
            var b = $("#" + f.Tool.getReaderApp().getMainFrameId()),
                c = "fwr-ajax-uploading";
            null == a && (a = f.Tool.getReaderApp()), v = i18n.t("CommonDialog.DefaultDlgTitle");
            var d = {
                waitingDlgId: "DownloadingDlg_" + c,
                loadingCss: c,
                downloadingTextId: "downloadingText",
                downloadingText: i18n.t("CommonLng.Create.downloading")
            };
            if (!u[c]) {
                a.addIgnoreMouseEventClass(c);
                var e = "<div id='{waitingDlgId}' class='fwr-modal fwr-hide fwr-fade fwr-in {loadingCss}'><span id='uploadingText' class='fwr-ajax-uploading-text'>{downloadingText}</span></div>";
                s[c] = e.format(d), t[c] = $(s[c]), u[c] = !0
            }
            if (t[c]) {
                t[c].i18n(), t[c].webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    manager: "#" + f.Tool.getReaderApp().getMainFrameId()
                }), $("#" + d.downloadingText).text(d.downloadingText);
                var g = $(".fwr-modal-backdrop");
                g.length > 0 && g.addClass("fwr-modal-backdrop-loading"), b.addClass("fwr-doc-viewer-loading")
            }
        }, f.closeDownloading = function(a) {
            null == a && (a = f.Tool.getReaderApp());
            var b = "fwr-ajax-uploading";
            t && t[b] && t[b].webPDFModal("hide");
            var c = $("#" + f.Tool.getReaderApp().getMainFrameId());
            c.removeClass("fwr-doc-viewer-loading")
        }, f.alert = function(a, b, c, d, e, j, k) {
            function l(a) {
                var b;
                switch (a.target.id) {
                    case w:
                        b = 3;
                        break;
                    case n:
                        b = 2 > k ? 1 : 4;
                        break;
                    case x:
                        b = 2
                }
                return $.isFunction(e) && e(b), h.webPDFModal("hide"), !1
            }
            null == a && (a = f.Tool.getReaderApp());
            var m = "fwrAlertDlg",
                n = "fwrAlertDialogCloseBtn",
                o = null,
                p = "fwrAlertDialogMsgHolder",
                q = null,
                r = "fwrAlertDialogTitle",
                s = null;
            if (v = i18n.t("CommonDialog.DefaultDlgTitle"), !i) {
                a.addIgnoreMouseEventClass("fwr-alert"), g = "<div id='" + m + "' class='fwr-modal fwr-hide fwr-fade fwr-in fwr-alert' style='display: none;'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 id='" + r + "'>Foxit Web PDF</h4></div><div class='fwr-modal-body'><p id='" + p + "'>Msg Body</p></div><div class='fwr-modal-footer' ><a href='#' id='" + n + "' class='btn margin-right-30' webpdf-data-dismiss='modal' data-i18n='CommonDialog.DefaultOKBtnTitle'>Close</a></div></div>", $("#" + a.getMainFrameId()).append(g), h = $("#" + m);
                var t = h.height(),
                    u = Math.round(t / 2);
                h.css("marginTop", "-" + u + "px"), i = !0
            }
            if (h) {
                var w = "fwrAlertDialogNoBtn",
                    x = "fwrAlertDialogCancleBtn";
                if ($("#" + w).remove(), $("#" + x).remove(), "number" == typeof k) switch (k) {
                    case 3:
                        $(".fwr-modal-footer").append('<a href="#" id="' + w + '" class="btn" webpdf-data-dismiss="modal">No</a>'), $(".fwr-modal-footer").append('<a href="#" id="' + x + '" class="btn" webpdf-data-dismiss="modal">Cancle</a>');
                        break;
                    case 2:
                        $(".fwr-modal-footer").append('<a href="#" id="' + w + '" class="btn" webpdf-data-dismiss="modal">No</a>');
                        break;
                    case 1:
                        $(".fwr-modal-footer").append('<a href="#" id="' + x + '" class="btn" webpdf-data-dismiss="modal">Cancle</a>')
                }
                o = $("#" + n), s = $("#" + r), q = $("#" + p), o.off("click").on("click", l).off("mousedown").on("mousedown", function() {
                    return !1
                }), 0 !== $("#" + w).length && $("#" + w).off("click").on("click", l).off("mousedown").on("mousedown", function() {
                    return !1
                }), 0 !== $("#" + x).length && $("#" + x).off("click").on("click", l).off("mousedown").on("mousedown", function() {
                    return !1
                }), b || (b = v), s.html(b), c || (c = ""), q.html(c), d || (d = i18n.t("CommonDialog.DefaultOKBtnTitle")), "undefined" == typeof k && $.isFunction(e) && h.off("hidden.bs.webpdf-modal").on("hidden.bs.webpdf-modal", function(a) {
                    e(a)
                }), h.i18n(), o.text(d), h.webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    manager: "#" + a.getMainFrameId()
                }), h.focus()
            }
        }, f.endAlert = function() {
            h && h.webPDFModal("hide")
        }, f.confirm = function(a, b, c, d, e, g) {
            v = i18n.t("CommonDialog.DefaultDlgTitle");
            var h = "fwrConfirmDlg",
                i = "fwrConfirmDlgMsgHolder",
                m = null,
                n = "fwrConfirmDlgOkBtn",
                o = "fwrConfirmDlgCancelBtn",
                p = null,
                q = null,
                r = "fwrConfirmDialogTitle",
                s = null;
            null == a && (a = f.Tool.getReaderApp()), l || ($("#" + h).remove(), a.addIgnoreMouseEventClass("fwr-confirm"), j = "<div id='" + h + "' class='fwr-modal fwr-hide fwr-fade fwr-in fwr-confirm'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 id='" + r + "'>Foxit Web PDF</h4></div><div class='fwr-modal-body'><p id='" + i + "' >Body Msg</p></div><div class='fwr-modal-footer'><a href='#' type='button' class='btn btn-success'   id='" + n + "' webpdf-data-dismiss='modal' >OK</a>  <a href='#' type='button' class='btn'  id='" + o + "' webpdf-data-dismiss='modal' >Cancel</a></div></div>", $("#" + a.getMainFrameId()).append(j), k = $("#" + h), l = !0), k && (s = $("#" + r), m = $("#" + i), p = $("#" + n), q = $("#" + o),
                b || (b = v), s.html(b), c || (c = ""), m.html(c), d || (d = i18n.t("CommonDialog.DefaultOKBtnTitle")), e || (e = i18n.t("CommonDialog.DefaultCancelBtnTitle")), p.text(d), q.text(e), $.isFunction(g) || (g = function() {
                    k.webPDFModal("hide")
                }), p.text(d).off("click").on("click", function() {
                    $("#header-more").css("display", "none"), $("#more-menu-list").css("display", "none"), g(!0)
                }), q.text(e).off("click").on("click", function() {
                    f.endConfirm(), g(!1)
                }), k.i18n(), k.webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    manager: "#" + a.getMainFrameId()
                }), k.focus())
        }, f.confirmed = function(a, b, c, d, e) {
            function g(a) {
                return a !== !1 && h(), a
            }

            function h() {
                k.webPDFModal("hide")
            }
            var i = "CommonDialog.DefaultDlgTitle";
            b || (b = i), c || (c = ""), d || (d = "CommonDialog.DefaultOKBtnTitle"), e || (e = "CommonDialog.DefaultCancelBtnTitle"), null == a && (a = f.Tool.getReaderApp());
            var j = "<div class='fwr-modal fwr-hide fwr-fade fwr-in fwr-confirm'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 data-role='title'>Foxit Web PDF</h4></div><div class='fwr-modal-body' data-role='body'><p data-role='message'>Body Msg</p></div><div class='fwr-modal-footer'><a href='#' type='button' data-role='ok' class='btn btn-success'  webpdf-data-dismiss='modal' >OK</a>  <a href='#' type='button' data-role='cancel' class='btn'  webpdf-data-dismiss='modal' >Cancel</a></div></div>",
                k = $(j);
            $("#" + a.getMainFrameId()).append();
            var l = k.find("[data-role=title]"),
                m = k.find("[data-role=message]"),
                n = k.find("[data-role=ok]"),
                o = k.find("[data-role=cancel]");
            l.attr("data-i18n", b), m.attr("data-i18n", c), n.attr("data-i18n", d), o.attr("data-i18n", e), n.text(d), o.text(e), k.i18n(), k.webPDFModal({
                keyboard: !1,
                backdrop: "static",
                manager: "#" + a.getMainFrameId()
            }), k.focus();
            var p = new Promise(function(a, b) {
                n.on("click", function() {
                    a(k)
                }), o.on("click", function() {
                    b(k)
                })
            });
            return p.then(g, g), p
        }, f.endConfirm = function() {
            k && k.webPDFModal("hide")
        };
        var w = "fwrPasswordDlgPasswordInput",
            x = null;
        f.confirmPassword = function(a, b, c, d, e, g) {
            v = i18n.t("CommonDialog.DefaultDlgTitle");
            var h = "fwrPasswordDlg",
                i = "fwrPasswordDlgMsgHolder",
                j = "fwrPasswordDlgErrorLabel",
                k = "fwrPasswordDlgOkBtn",
                l = "fwrPasswordDlgCancelBtn",
                p = null,
                q = null,
                r = "fwrPasswordDialogTitle",
                s = null,
                t = null,
                u = null,
                y = "fwr-password-confirm";
            f.Environment.mobile && (y = "fwr-password-confirm-mobile"), n || (a.addIgnoreMouseEventClass("fwr-password-confirm"), a.addIgnoreMouseEventClass("fwr-password-confirm-mobile"), m = "<div id='" + h + "' class='fwr-modal fwr-hide fwr-fade fwr-in " + y + "'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 id='" + r + "'>Foxit Web PDF</h4></div><div class='fwr-modal-body'><div id='' class='fwr-password-warn' data-i18n='ParseError.EnterPassword'>password</div><div class='fwr-password-block'> <span class='fwr-password-lable'  data-i18n='CommonDialog.EnterPasswordTip'>Password:</span><input type='password' autocomplete='off' id='" + w + "' name='fwr-password' /></div><div class='error-info'><span id='" + j + "'>Error code</span><br /></div></div><div class='fwr-modal-footer'><a href='#' type='button' class='btn btn-success'   id='" + k + "' data-i18n='CommonDialog.DefaultOKBtnTitle'>OK</a> <a href='#' type='button' class='btn'  id='" + l + "' webpdf-data-dismiss='modal' data-i18n='CommonDialog.DefaultCancelBtnTitle'>Cancel</a></div></div>", $("#" + a.getMainFrameId()).append(m), o = $("#" + h), x = $("#" + w), x.off("keyup").on("keyup", function(a) {
                var b = a || window.event,
                    c = b.keyCode || b.which || b.charCode;
                "13" == c && p.click()
            }), o.off("shown.bs.webpdf-modal").on("shown.bs.webpdf-modal", function() {
                f.Environment.mobile || x.focus()
            }), n = !0), o && (p = $("#" + k), q = $("#" + l), q.off("click").on("click", function() {
                o.webPDFModal("hide")
            }), x = $("#" + w), s = $("#" + r), u = $("#" + i), t = $("#" + j), x.empty(), t.empty(), b || (b = v), s.html(b), c || (c = ""), u.html(c), e || (e = i18n.t("CommonDialog.DefaultOKBtnTitle")), g || (g = i18n.t("CommonDialog.DefaultCancelBtnTitle")), q.text(g), $.isFunction(d) || (d = function() {
                o.webPDFModal("hide")
            }), p.text(e).off("click").on("click", function() {
                d(x, t)
            }), o.i18n(), o.webPDFModal({
                keyboard: !1,
                backdrop: "static",
                manager: "#" + a.getMainFrameId()
            }))
        }, f.endConfirmPassword = function() {
            o && (x.empty().val(""), o.webPDFModal("hide"))
        }, f.copyText = function(a, b, c, f, g, h) {
            try {
                if (window.clipboardData) {
                    var i = window.clipboardData.setData("Text", b);
                    if (!i) return d(a, b, c, f, g, h), !1
                } else {
                    if (!window.netscape) return d(a, b, c, f, g, h), !1;
                    if (!e(b)) return d(a, b, c, f, g, h), !1
                }
            } catch (j) {
                return console.error(j), d(a, b, c, f, g, h), !1
            }
            return !0
        }, f.endTextCopyDlg = function() {
            q && q.dialog("close")
        }, f.destructorDlg = function() {
            if (g = "", h || delete h, h = null, i = !1, j = "", k || delete k, k = null, l = !1, m = "", n = !1, o || delete o, o = null, p = "", q || delete q, q = null, r = !1, s = {}, t) {
                for (var a in t) t[a].webPDFModal("hide");
                if (f.Tool.getReaderApp() && $("#" + f.Tool.getReaderApp().getMainFrameId())) {
                    var b = $("#" + f.Tool.getReaderApp().getMainFrameId());
                    b.removeClass("fwr-doc-viewer-loading")
                }
            }
            t = {}, u = {}, v = ""
        }
    }), define("core/Tools/Tools", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.Tools = {}
    }), define("core/Plugins/Action/PDFDestination", ["core/WebPDF"], function(a, b, c) {
        return a("core/WebPDF"), WebPDF.PDFDestination = function(a) {
            this.DestinationInfoJsonFormat = {
                left: "l",
                top: "t",
                width: "w",
                height: "h",
                pageIndex: "p",
                zoomToMode: "zm",
                scale: "s",
                bPdfCord: "bp",
                bLink: "bl",
                offsetX: "x",
                offsetY: "y"
            }, this.left = -1, this.top = -1, this.width = -1, this.height = -1, this.pageIndex = 0, this.zoomToMode = 0, this.scale = 1, this.bPdfCord = !0, this.bLink = !0, this.parseJSONData = function(a) {
                this.left = a[this.DestinationInfoJsonFormat.left], this.top = a[this.DestinationInfoJsonFormat.top], this.width = a[this.DestinationInfoJsonFormat.width], this.height = a[this.DestinationInfoJsonFormat.height], this.pageIndex = a[this.DestinationInfoJsonFormat.pageIndex], this.zoomToMode = 0, this.dbScale = a[this.DestinationInfoJsonFormat.scale], this.bPdfCord = 1 == a[this.DestinationInfoJsonFormat.bPdfCord] ? !0 : !1, this.bLink = 1 == a[this.DestinationInfoJsonFormat.bLink] ? !0 : !1
            }, this.parseJSONData(a)
        }, WebPDF.PDFDestination
    }), define("core/Framework/View/MainFrame", ["core/Framework/View/PDFDocView", "core/Framework/View/PDFPageView", "core/Framework/View/PDFView", "core/WebPDF", "core/Common/Math/Rect", "core/Common/Math/Point", "core/Framework/Config", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Framework/View/LayoutInfo", "core/Framework/View/ProgressiveViewerGenerator", "core/Framework/View/PDFContinuousView", "core/Framework/View/PDFSinglePageView", "core/Framework/View/PDFFacingPageView", "core/Common/ServerService", "core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters", "core/Framework/View/SinglePageViewLayout", "core/Common/Common"], function(a, b, c) {
        var d = a("core/Framework/View/PDFDocView");
        a("core/Framework/View/LayoutInfo");
        return WebPDF.PDFView.CMainFrame = function(a, b, c, e, f, g) {
            function h() {
                i = new d(c, e, k, f, l);
                var a = $("#" + k);
                i.setDocViewWidth(a.width()), i.setDocViewHeight(a.height()), i.init()
            }
            var i = null,
                j = b,
                k = a,
                l = g;
            h(), this.getDocView = function() {
                return i
            }, this.getMainFrameID = function() {
                return k
            }, this.getLeftPanelID = function() {
                return j
            }, this.onResize = function(a, b) {
                var c = $("#" + k);
                if (null != g.getMainView()) {
                    if (g.isMobile()) {
                        var d = $("#fields_highlight"),
                            e = d.is(":visible") ? d.outerHeight() : 0,
                            f = c.parent(),
                            h = parseFloat(f.css("top"));
                        h += e, f.css({
                            top: h
                        }), b -= e, c.css({
                            top: 0,
                            height: b
                        })
                    } else {
                        (null == a || null == b) && (a = c.outerWidth() ? c.outerWidth() : $(window).width(), b = c.outerHeight() ? c.outerHeight() : $(window).height());
                        var l = $("#navigation"),
                            m = $("#navigationPanel"),
                            n = $("#fields_highlight"),
                            o = l.is(":visible") ? l.outerWidth() : 0;
                        o = m.is(":visible") ? m.outerWidth() + o : o, o += i.getRulerOffset();
                        var p = n.is(":visible") ? n.outerHeight() : 0;
                        a -= o, b -= p, l.height(b), l.css({
                            left: 0
                        }), m.height(b), c.css({
                            width: a,
                            height: b,
                            "margin-left": o
                        })
                    }(a || b) && (c.width(a), c.height(b));
                    var a = c.outerWidth(),
                        b = c.outerHeight(),
                        q = $("#" + j),
                        r = b,
                        s = q.is(":hidden") ? 0 : q.innerWidth();
                    if (q.css({
                            top: 0,
                            height: r
                        }), null != i) {
                        var t = a - s,
                            u = b,
                            v = s,
                            w = 0;
                        if (t === i.getDocViewWidth() && u === i.getDocViewHeight() && v === i.getDocViewOffsetLeft() && w === i.getDocViewOffsetTop()) return;
                        i.onSize(t, u, v, w)
                    }
                }
            }
        }, WebPDF.PDFView.CMainFrame
    }), define("core/Framework/View/PDFDocView", ["core/Framework/View/PDFPageView", "core/Framework/View/PDFView", "core/WebPDF", "core/Common/Math/Rect", "core/Common/Math/Point", "core/Framework/Config", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Framework/View/LayoutInfo", "core/Framework/View/ProgressiveViewerGenerator", "core/Framework/View/PDFContinuousView", "core/Framework/View/PDFSinglePageView", "core/Framework/View/PDFFacingPageView", "core/Common/ServerService", "core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters", "core/Framework/View/SinglePageViewLayout", "core/Common/Common"], function(a, b, c) {
        var d = a("core/Framework/View/PDFPageView");
        a("core/Framework/View/LayoutInfo"), a("core/Framework/View/ProgressiveViewerGenerator");
        var e = a("core/Framework/View/PDFContinuousView"),
            f = a("core/Framework/View/PDFSinglePageView"),
            g = a("core/Framework/View/PDFFacingPageView"),
            h = a("core/Common/ServerService"),
            i = a("core/Framework/View/SinglePageViewLayout");
        a("core/Framework/Config");
        var j = WebPDF.Config,
            k = a("core/Common/Math/Rect"),
            l = WebPDF.Common;
        WebPDF.PDFPoint, WebPDF.RectUtils;
        return WebPDF.PDFView.ScrollBarType = {
            CUSTOM_SCROLL_BAR: 0,
            NATIVE_SCROLL_BAR: 1
        }, WebPDF.ZOOM_FIT_WIDTH = "FitWidth", WebPDF.ZOOM_IN = "in", WebPDF.ZOOM_OUT = "out", WebPDF.ZOOM_FIT_PAGE = "FitPage", WebPDF.ROTATE_LEFT = "left", WebPDF.ROTATE_RIGHT = "right", WebPDF.PDFView.PDFDocView = function(a, b, c, m, n) {
            function o(b) {
                switch (b) {
                    case 33:
                        ea.gotoPrevPage();
                        break;
                    case 34:
                        ea.gotoNextPage();
                        break;
                    case 35:
                        var c = ea.getPageCount() - 1,
                            d = a.getPage(c);
                        ea.gotoPage(c, 0, d.getPageHeight());
                        break;
                    case 36:
                        ea.gotoPage(0, 0, 0)
                }
            }

            function p() {
                var a = R.getOptions().defaultZoom;
                a === WebPDF.ZOOM_FIT_WIDTH ? ba = !0 : isNaN(a) || (P.scale = a)
            }

            function q() {
                var a = new Date,
                    b = a.valueOf(),
                    c = Math.floor(b / 1e3).toString();
                na = l.timestampToDateString(c, l.WaterMarkTimeFormat)
            }

            function r(a) {
                var b = ea.getPageView(Z);
                b.isDimensionUpdated() || (b.updateDimension(), b.setDimensionUpdated(!0)), a != Z && (R.collectTurnPageData(a, Z), $(R).trigger(WebPDF.EventList.DOCVIEW_PAGE_CHANGED, {
                    oldIndex: a,
                    curIndex: Z,
                    isPageLoaded: b.isPageLoaded()
                }))
            }

            function s() {
                ca.isContentCreatedPageCountUpdate = !1, aa = 0;
                for (var a = ea.getPDFDoc(), b = a.getPageCount(), c = 0; b > c; c++) {
                    var d = ea.getPageView(c);
                    if (d.isContentCreated()) {
                        var e = a.getPage(c);
                        aa += e.getPageWidth() * d.getScale() * R.getPixelsPerPoint()
                    }
                }
                return aa
            }

            function t() {
                ua && (ea.changeShowMode(WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE, !1), ua = !1)
            }

            function u() {
                P.showMode == WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE && (ua = !0, ea.changeShowMode(WebPDF.PDFView.RD_BRMODE_CONTINUOUS, !1))
            }

            function v(a) {
                var b = ea.getMaxPageViewWidth(!0),
                    c = 0;
                if (ea.getRotate() % 180 != 0) {
                    b = ea.getMaxPageViewHeight(!0);
                    var d = ca.getContentCreatedPageCount(),
                        e = 12;
                    c = s() + ea.getPageSpane() * d + .5 + e
                }
                var f = 0;
                P.showMode == WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING ? f = 2 * (b + .5) : (f = b + .5, ea.getRotate() % 180 != 0 && (c += a));
                var g = {
                    showArrows: !1,
                    animateScroll: !1,
                    contentWidth: f,
                    contentHeight: c,
                    keyDownCallback: o,
                    verticalGutter: 4,
                    scrollPagePercent: .8,
                    mouseWheelSpeed: 80
                };
                if (P.showMode == WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE) {
                    g.verticalGutter = 0, g.cancelDrag = t, g.dragMouseDown = u;
                    var h = $("#" + J),
                        i = h.height(),
                        j = ea.getPageDomElmHeight(Z);
                    j > i ? g.scrollPagePercent = .8 : g.scrollPagePercent = .1
                }
                return g
            }

            function w(a, b, c, d) {
                ea.unBindScrollEvent();
                var e = O.getPageViewOffsetDocView(Z),
                    f = ea.getScale();
                R.isOffline() && R.saveCurDocOfflineInfo(Z, f, e.y);
                var g = ea.getVisiblePageRange(),
                    h = (ca.updateAdjacentPageContent(), g.end),
                    i = g.begin;
                a && (i = 0, h = ea.getPageCount()), ca.progressiveUpdatePageDimension(Z, i, h, e.y, !0, !0), ja[P.showMode].onPageScroll(Z, b, c, d);
                var j = ea.countVisiblePageRange(),
                    k = Z;
                Z = j.current, r(k), ra && clearTimeout(ra);
                var l = ea.getVisiblePageRange();
                ea.bindScrollEvent(), ra = setTimeout(function() {
                    qa(j)
                }, 200), ea.notifyPageVisibleStatus(g, l), $(R).trigger(WebPDF.EventList.DOCVIEW_SCROLL, {})
            }

            function x(a, b, c, d) {
                R.getMainView() && w(!1, b, c, d)
            }

            function y(a, b, c) {
                var d = $("#" + ea.getDocViewContainerID()),
                    e = ea.getDocViewDimension(),
                    f = e.height,
                    g = e.width,
                    h = d.offset(),
                    i = 0,
                    j = 0;
                S && (i = S.getScrollBarWidth(), j = S.getScrollBarHeight());
                var k = 24;
                if ((a >= b.begin || a <= b.end) && !c.isPageLoaded()) {
                    var l = c.getPageViewWidth(),
                        m = c.getPageViewHeight(),
                        n = $("#" + c.getPageViewContainerID()),
                        o = g,
                        p = f;
                    S && (p -= j, o -= i);
                    var q = n.offset(),
                        r = q.top + m - (h.top + p);
                    0 > r && (r = 0);
                    var s = 0;
                    q.top < h.top && (s = h.top - q.top);
                    var t = h.left - q.left;
                    0 > t && (t = 0);
                    var u = q.left + l - (h.left + o);
                    0 > u && (u = 0);
                    var v = $("#" + c.getPageLoaderImageID());
                    v.length > 0 && (k > m - r - s && (r = 0, s = 0), v.css({
                        marginLeft: -k / 2 - (u - t) / 2,
                        marginTop: -k / 2 - (r - s) / 2
                    }))
                }
            }

            function z(a) {
                for (var b = a.begin; b <= a.end; b++) {
                    var c = ea.getPageView(b);
                    c && (y(b, a, c), Q.renderPage(c, j.defaults.requestRetryCount))
                }
            }

            function A(a) {
                var b = a.begin - Configs.Rendering.beforeVisiblePageCount;
                b = 0 > b ? 0 : b;
                for (var c = b; c < a.begin; c++) {
                    var d = ea.getPageView(c);
                    d && Q.renderPage(d, j.defaults.requestRetryCount)
                }
            }

            function B(a, b) {
                var c = a.end + Configs.Rendering.afterVisiblePageCount;
                c = c > b - 1 ? b - 1 : c;
                for (var d = a.end + 1; c >= d; d++) {
                    var e = ea.getPageView(d);
                    e && Q.renderPage(e, j.defaults.requestRetryCount)
                }
            }

            function C(a) {
                if (R.getMainView())
                    if (a.begin < 0 && (a.begin = 0), a.end > N.getPageCount() - 1 && (a.end = N.getPageCount() - 1), R.isLargeFile()) {
                        var b = a.begin - Configs.Rendering.beforeVisiblePageCount,
                            c = a.end + Configs.Rendering.afterVisiblePageCount;
                        b = Math.max(0, b), c = Math.min(c, N.getPageCount() - 1), h.parsePages(R.getLargeFileDocId(), WebPDF.ViewerInstance.getFileID(), b, c, function(b) {
                            var c = ea.getPageView(b);
                            c && (b >= a.begin && b <= a.end && y(b, a, c), Q.renderPage(c, j.defaults.requestRetryCount))
                        }).then(function() {})
                    } else z(a), B(a, N.getPageCount()), A(a)
            }

            function D(a) {
                R.getOptions().scrollBarType === WebPDF.PDFView.ScrollBarType.CUSTOM_SCROLL_BAR && a.getContentPane().css({
                    left: 0
                })
            }

            function E(a) {
                for (var b = ea.getPageCount(), c = 0; b > c; c++) {
                    var d = ea.getPageView(c);
                    d && d.isContentCreated() && (d.setDimensionUpdated(!1), WebPDF.Engine.JR && a && d.setPageLoaded(!1))
                }
            }

            function F() {}

            function G() {
                $(".fwr-annot-underline-parent.fwr-highlight-annot").each(function(a, b) {
                    parseFloat($(b).height()) < 1 && $(b).height(1)
                })
            }
            null == a && $.error("pdfDoc is null!");
            var H, I = {},
                J = c + "_ViewContainer",
                K = c + "_ViewContainer_1",
                L = c + "_ViewContainer_2",
                M = c,
                N = a,
                O = null,
                P = m,
                Q = b,
                R = n,
                S = null,
                T = 0,
                U = 0,
                V = 0,
                W = 0,
                X = 0,
                Y = 0,
                Z = 0,
                _ = -1,
                aa = 0,
                ba = !1,
                ca = null,
                da = {
                    begin: 0,
                    end: 0,
                    current: 0
                },
                ea = this,
                fa = !1,
                ga = null,
                ha = null,
                ia = null,
                ja = [],
                ka = [],
                la = !0,
                ma = [],
                na = null,
                oa = !1,
                pa = !1,
                qa = WebPDF.Common.debounce(C, 400);
            q(), $(R).trigger(WebPDF.EventList.LAYOUTSHOWMODE_CHANGED, {
                oldShowMode: null,
                newShowMode: P.showMode
            });
            var ra = null,
                sa = !1,
                ta = !1;
            p(), this.createPagesView = function(a, b, c) {
                return O.createPagesView(a, b, c)
            }, this.getDocViewContainerID = function() {
                return J
            }, this.getCurPageIndex = function() {
                return Z
            }, this.setCurPageIndex = function(a) {
                Z = a
            }, this.getCurPageView = function() {
                return this.getPageView(Z)
            }, this.isFitWidth = function() {
                return ba
            }, this.setFitWidth = function(a) {
                ba = a
            }, this.isFitPage = function() {
                return oa
            }, this.setFitPage = function(a) {
                oa = a
            }, this.getLeftDocContainerID = function() {
                return K
            }, this.getRightDocContainerID = function() {
                return L
            }, this.getPageViewContainerID = function(a) {
                return J + "_PageContainer_" + a.toString()
            }, this.getPageBackgroundImgID = function(a) {
                return J + "_BG_" + a.toString()
            }, this.getWrapPageID = function(a) {
                return J + "_Wrap_" + a.toString()
            }, this.getPageLoaderImageID = function(a) {
                return J + "_Loader_" + a.toString()
            }, this.getWatermarkID = function(a) {
                return J + "_Watermark_" + a.toString()
            }, this.getTrialWatermarkID = function(a) {
                return J + "_TrialWatermark_" + a.toString()
            }, this.getUserWatermarkID = function(a) {
                return J + "_UserWatermark_" + a.toString()
            }, this.getPDFDoc = function() {
                return N
            }, this.getPageCount = function() {
                return N.getPageCount()
            }, this.getPageView = function(a) {
                return I[a]
            }, this.getPageViewRender = function() {
                return Q
            }, this.setDocViewWidth = function(a) {
                T = a
            }, this.getDocViewWidth = function() {
                return T
            }, this.setDocViewHeight = function(a) {
                U = a
            }, this.getDocViewHeight = function() {
                return U
            }, this.setDocViewOffsetLeft = function(a) {
                Y = a
            }, this.getDocViewOffsetLeft = function() {
                return Y
            }, this.setDocViewOffsetTop = function(a) {
                X = a
            }, this.getDocViewOffsetTop = function() {
                return X
            }, this.getDocViewClientRect = function() {
                var a = $("#" + this.getDocViewContainerID()).offset(),
                    b = ea.getDocViewDimension(),
                    c = new k(0, 0, 0, 0);
                return a && (c = new k(a.left, a.top, a.left + b.width, a.top + b.height)), WebPDF.RectUtils.normalize(c), c
            }, this.getMaxPDFPageHeight = function() {
                if (-1 != _) return _;
                for (var a = ea.getPDFDoc(), b = a.getPageCount(), c = 0; b > c; c++) {
                    var d = a.getPage(c),
                        e = d.getPageHeight();
                    e > _ && (_ = e)
                }
                return _
            }, this.getMaxPageViewWidth = function(a) {
                for (var b = ea.getPDFDoc(), c = b.getPageCount(), d = 0, e = 0, f = 0; c > f; f++) {
                    var g = b.getPage(f).getPageWidth();
                    g > e && (e = g, d = f)
                }
                var h = a ? ea.getPageView(d).getScale() : 1;
                return e * R.getPixelsPerPoint() * h
            }, this.getMaxPageViewHeight = function(a) {
                for (var b = ea.getPDFDoc(), c = b.getPageCount(), d = 0, e = 0, f = 0; c > f; f++) {
                    var g = b.getPage(f).getPageHeight();
                    g > e && (e = g, d = f)
                }
                var h = a ? ea.getPageView(d).getScale() : 1;
                return e * R.getPixelsPerPoint() * h
            }, this.getPageViewTranslateX = function(a) {
                var b = 0;
                if (0 == a) return .5 * ea.getPageView(0).getPageViewTranslateX();
                for (var c = 0; a > c; c++) ea.getPageView(c).isContentCreated() && (b += ea.getPageView(c).getPageViewTranslateX());
                return b += .5 * ea.getPageView(a).getPageViewTranslateX()
            }, this.init = function() {
                ca = new WebPDF.PDFView.ProgressiveViewerGenerator(ea, J);
                var a = N.getPageCount();
                switch (P.showMode) {
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS:
                    case WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE:
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING:
                        O = new i(R, ea, P);
                        break;
                    default:
                        $.error("Unsupported layout mode.")
                }
                for (var b = 0; a > b; b++) I[b] = new d(R, N.getPage(b), ea, J);
                var c = O.createDocViewHtml(),
                    h = $("#" + M);
                h.append(c), ca.createPages(0), ea.initializeScrollBar(), ga = new e(ea, O, ca), ja[ga.getName()] = ga, ha = new f(ea, O, ca), ja[ha.getName()] = ha, ia = new g(ea, O, ca), ja[ia.getName()] = ia, ba && ea.fitWidth(!0, !1);
                for (var j = 0; a > j; j++) ma.push(j);
                ea.bindScrollEvent(), ea.bindTilesScrollEvent(), x()
            }, this.bindTilesScrollEvent = function() {
                var a;
                $(R).off(WebPDF.EventList.DOCVIEW_SCROLL + ".tiles").on(WebPDF.EventList.DOCVIEW_SCROLL + ".tiles", function() {
                    if (ea && ea.getScrollApi()) {
                        var a = ea.getScrollApi(),
                            b = a.getContentPositionY(),
                            c = a.getContentPositionX(),
                            d = ea.getRotate();
                        R.getTileConfig().enable && ea && $(".fwr-page-tiles").size() > 0 && !WebPDF.Engine.JR && $(".fwr-page-tiles").tiles("scroll", b, c, d)
                    }
                }), $(R).off(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED + ".tiles").on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED + ".tiles", function(b, c) {
                    window.clearTimeout(a), a = window.setTimeout(function() {
                        var a = c.newScale,
                            b = ea.getScrollApi(),
                            d = b.getContentPositionY(),
                            e = b.getContentPositionX(),
                            f = ea.getRotate();
                        R.getTileConfig().enable && ea && $(".fwr-page-tiles").size() > 0 && !WebPDF.Engine.JR && $(".fwr-page-tiles").tiles("zoom", a, d, e, f)
                    }, 10)
                })
            }, this.offTilesScrollEvent = function() {
                $(R).off(WebPDF.EventList.DOCVIEW_SCROLL + ".tiles"), $(R).off(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED + ".tiles")
            }, this.fitWidth = function(a, b) {
                if (!a && ea.isFitWidth()) return !1;
                var c = O.getFitWidthScale(!0);
                return ea.setFitWidth(!0), ea.onZoom(c, b)
            }, this.getFitPageScale = function() {
                return O.getFitPageScale(!0)
            }, this.getCurrentZoomList = function() {
                function a(a) {
                    for (var b, c = !1, d = 0; d < f.length; d++) {
                        var e = f[d];
                        e > a && (c || (c = !0, b = d, f.splice(b, 0, a)))
                    }
                    return c || (b = f.length, f.splice(b, 0, a)), b
                }
                var b, c, d = O.getFitWidthScale(!0),
                    e = O.getFitPageScale(!0),
                    f = [],
                    g = j.defaults.zoomList;
                return f = g.slice(), d >= e ? (b = a(e), c = a(d), f[b] = WebPDF.ZOOM_FIT_PAGE, f[c] = WebPDF.ZOOM_FIT_WIDTH) : (c = a(d), b = a(e), f[c] = WebPDF.ZOOM_FIT_WIDTH, f[b] = WebPDF.ZOOM_FIT_PAGE), f
            }, this.zoomIn = function() {
                var a = ea.getScale(),
                    b = O.getFitWidthScale(!0),
                    c = !1;
                if (R.isMobile()) return 2 * b > a ? a = 1.1 * a : (a = 2 * b, c = !0), c ? !1 : (ea.setFitWidth(!1), ea.onZoom(a));
                for (var d = ea.getCurrentZoomList(), e = -1, f = 0; f < d.length; f++) {
                    var g = d[f];
                    if (g === a || g === WebPDF.ZOOM_FIT_WIDTH && ea.isFitWidth() || g === WebPDF.ZOOM_FIT_PAGE && ea.isFitPage()) {
                        e = f + 1;
                        break
                    }
                }
                var h = null;
                if (e >= d.length || -1 === e) {
                    for (var i = new Array, f = 0; f < d.length; f++)
                        if ("FitPage" == d[f]) {
                            var j = ea.getFitPageScale();
                            i.push(j)
                        } else if ("FitWidth" == d[f]) {
                        var b = ea.getFitWidthScale();
                        i.push(b)
                    } else i.push(d[f]);
                    i.sort(function(a, b) {
                        return b - a
                    });
                    for (var f = 0; f < i.length; f++) {
                        var g = i[f];
                        if (a > g) {
                            e = f - 1;
                            break
                        }
                    }
                    if (e >= d.length || -1 === e) return !1;
                    h = i[e]
                }
                return h || (h = d[e]), h !== WebPDF.ZOOM_FIT_WIDTH && b !== h ? h === WebPDF.ZOOM_FIT_PAGE ? (H = ea.getViewMode(), ea.setFitPage(!0), ea.setFitWidth(!1), WebPDF.ViewerInstance.setLayoutShowMode(WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE), ea.onZoom(h)) : (H >= 0 && ea.changeShowMode(H, !0), ea.setFitWidth(!1), ea.setFitPage(!1), a = h, ea.onZoom(a)) : (H >= 0 && ea.changeShowMode(H, !0), ea.setFitPage(!1), ea.fitWidth(), !0)
            }, this.setCurMode = function(a) {
                H = a
            }, this.getCurMode = function() {
                return H
            }, this.zoomOut = function() {
                var a = O.getFitWidthScale(!0),
                    b = ea.getScale(),
                    c = !1;
                if (R.isMobile()) return .95 * b > .5 * a ? b = .95 * b : (b = .5 * a, c = !0), c ? !1 : (ea.setFitWidth(!1), ea.onZoom(b));
                for (var d = ea.getCurrentZoomList(), e = -1, f = 0; f < d.length; f++) {
                    var g = d[f];
                    if (g === b || g === WebPDF.ZOOM_FIT_WIDTH && ea.isFitWidth() || g === WebPDF.ZOOM_FIT_PAGE && ea.isFitPage()) {
                        e = f - 1;
                        break
                    }
                }
                var h = null;
                if (0 > e) {
                    for (var i = new Array, f = 0; f < d.length; f++)
                        if ("FitPage" == d[f]) {
                            var j = ea.getFitPageScale();
                            i.push(j)
                        } else if ("FitWidth" == d[f]) {
                        var a = ea.getFitWidthScale();
                        i.push(a)
                    } else i.push(d[f]);
                    i.sort(function(a, b) {
                        return a - b
                    });
                    for (var f = 0; f < i.length; f++) {
                        var g = i[f];
                        if (g > b) {
                            e = f - 1;
                            break
                        }
                    }
                    if (0 > e) return !1;
                    h = i[e]
                }
                return h || (h = d[e]), h !== WebPDF.ZOOM_FIT_WIDTH && a !== h ? h === WebPDF.ZOOM_FIT_PAGE ? (H = ea.getViewMode(), ea.setFitPage(!0), ea.setFitWidth(!1), WebPDF.ViewerInstance.setLayoutShowMode(WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE), ea.onZoom(h)) : (H >= 0 && ea.changeShowMode(H, !0), ea.setFitWidth(!1), ea.setFitPage(!1), b = h, ea.onZoom(b)) : (H >= 0 && ea.changeShowMode(H, !0), ea.setFitPage(!1), ea.fitWidth(), !0)
            }, this.rotateLeft = function() {
                var a = ea.getRotate();
                return a = (a - 90 + 360) % 360, ea.onRotate(a)
            }, this.rotateRight = function() {
                var a = ea.getRotate();
                return a = (a + 90 + 360) % 360, ea.onRotate(a)
            }, this.updateTwoPageContainerWidth = function() {
                var a = ea.getMaxPageViewWidth(!0),
                    b = $("#" + ea.getDocViewContainerID()).width();
                a = a > b ? a : b, $("#" + ea.getLeftDocContainerID()).css("width", a / 2), $("#" + ea.getRightDocContainerID()).css("width", a / 2).css("left", a / 2)
            }, this.bindScrollEvent = function() {
                $("#" + J).off("scroll").on("scroll", x)
            }, this.unBindScrollEvent = function() {
                $("#" + J).off("scroll")
            }, this.getViewMode = function() {
                return P.showMode
            };
            var ua = !1;
            this.initializeScrollBar = function(a) {
                if (S) return S;
                a || (a = v());
                var b = $("#" + J),
                    c = "";
                switch (R.getOptions().scrollBarType) {
                    case WebPDF.PDFView.ScrollBarType.CUSTOM_SCROLL_BAR:
                        c = b.fwrJScrollPane(a);
                        break;
                    case WebPDF.PDFView.ScrollBarType.NATIVE_SCROLL_BAR:
                        c = b.WebPDFNativeScroll(a);
                        break;
                    default:
                        $.error("Unsupported type of scroll bar.")
                }
                return S = c.data("jsp")
            }, this.reinitializeScrollBar = function(a, b) {
                b = b ? b : 0, null == S && $.error("Scroll bar has not been initialized."), $(R).trigger(WebPDF.EventList.DOCVIEW_PRE_RESIZE, {}), a ? S.reinitialise(a) : S.reinitialise(v(b)), $(R).trigger(WebPDF.EventList.DOCVIEW_RESIZE, {})
            }, this.getScrollApi = function() {
                return S
            }, this.getFitWidthScale = function() {
                return O.getFitWidthScale(!0)
            }, this.movePage = function(a, b) {
                ja[P.showMode].movePage(Z, a, b)
            }, this.notifyPageVisibleStatus = function(a, b) {
                var c, d = $("#" + ea.getDocViewContainerID()),
                    e = ea.getDocViewDimension(),
                    f = e.height,
                    g = e.width,
                    h = d.offset(),
                    i = [],
                    j = [];
                for (c = a.begin; c <= a.end; c++)(c < b.begin || c > b.end) && (i.push(c), $("#" + ea.getPageView(c).getPageViewContainerID()).parent().addClass("fwr-page-invisible"));
                for (c = b.begin; c <= b.end; c++) $("#" + ea.getPageView(c).getPageViewContainerID()).parent().removeClass("fwr-page-invisible"), j.push(c);
                i.length > 0 && $(R).trigger(WebPDF.EventList.PAGE_INVISIBLE, {
                    pages: i
                }), j.length > 0 && (ka = j, $(R).trigger(WebPDF.EventList.PAGE_VISIBLE, {
                    pages: j,
                    contentPanelWidth: g,
                    contentPaneHeight: f,
                    contentPanelOffset: h,
                    isShowAnnots: la
                }))
            }, this.loadPages = function(a) {
                qa(a)
            }, this.clearCache = function() {
                Q.clearCache()
            }, this.onSize = function(a, b, c, d) {
                ea.unBindScrollEvent(), E(!0);
                var e = $("#" + J);
                V = e.outerHeight() - e.height(), W = e.outerWidth() - e.width(), U = b - V, T = a - W, Y = c, X = d, e.css({
                    width: T,
                    height: U,
                    left: c,
                    top: d
                });
                var f = Z;
                if (S && D(S), ea.isFitWidth()) {
                    var g = O.getFitWidthScale(!0);
                    ea.onZoom(g)
                } else ea.isFitPage() ? ea.onZoom(O.getScale()) : ea.reinitializeScrollBar();
                x(), ja[P.showMode].onSize(f), ea.unBindScrollEvent();
                var h = Z;
                Z = f, r(h), ea.countVisiblePageRange(), ea.bindScrollEvent()
            }, this.onZoomByPos = function(a, b, c, d) {
                if (a > R.supportedMaxScale()) return !1;
                var e = ea.getPageView(d).getScale(),
                    f = a / e,
                    g = $("#" + ea.getPageView(d).getPageViewContainerID()),
                    h = g.position(),
                    i = g.offset(),
                    j = ea.getDocViewWidth(),
                    l = ea.getDocViewHeight(),
                    m = new k(i.left, i.top, i.left + j, i.top + l),
                    n = b - m.left,
                    o = c - m.top;
                ea.unBindScrollEvent(), O.setScale(a), E(!0), F();
                var p = Z,
                    q = ea.getRotate() % 180 != 0 ? !0 : !1;
                w(q), ea.unBindScrollEvent(), Z = p, r(p), S.scrollToElement(g, !0, !1), S.scrollBy(n * (f - 1) - h.left, o * (f - 1) - h.top), ea.bindScrollEvent(), $(R).trigger(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, {
                    oldScale: e,
                    newScale: a
                })
            }, this.onZoom = function(a, b) {
                var c = O.getScale();
                if (a === c) return !1;
                if (R.isLargeFile() && a > 2) return !1;
                isNaN(a) || (a = Math.round(100 * a) / 100), O.setScale(a), E(!0), F();
                var d = Z;
                S && D(S);
                var e = ea.getRotate() % 180 != 0 ? !0 : !1;
                w(e);
                var f = ea.countVisiblePageRange(),
                    g = S.getContentPositionY(),
                    h = S.getContentPositionX(),
                    i = ea.getRotate();
                R.getTileConfig().enable && ea && $(".fwr-page-tiles").size() > 0 && !WebPDF.Engine.JR && $(".fwr-page-tiles").tiles("zoom", a, g, h, i), ja[P.showMode].onZoom(d), ea.unBindScrollEvent();
                var j = ea.countVisiblePageRange(),
                    k = Z;
                return Z = d, r(k), qa(j), ea.notifyPageVisibleStatus(f, j), ea.bindScrollEvent(), (null == b || void 0 == b || 1 == b) && $(R).trigger(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, {
                    oldScale: c,
                    newScale: a
                }), !0
            }, this.onRotate = function(a, b) {
                var c = O.getRotate();
                if (a === c) return !1;
                ea.unBindScrollEvent(), O.setRotate(a), E(), F();
                var d = Z;
                if (S && D(S), ea.isFitWidth()) {
                    var e = O.getFitWidthScale(!0);
                    ea.onZoom(e)
                }
                ea.isFitPage() && (O.setScale(1), ea.onZoom(WebPDF.ZOOM_FIT_PAGE));
                var f = ea.getRotate() % 180 != 0 ? !0 : !1;
                w(f), ja[P.showMode].onRotate(d), ea.unBindScrollEvent();
                var g = Z;
                Z = d, r(g);
                var h = ea.countVisiblePageRange();
                return qa(h), ea.bindScrollEvent(), (null == b || void 0 == b || 1 == b) && $(R).trigger(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, {
                    oldRotate: c,
                    newRotate: a
                }), !0
            }, this.getScale = function() {
                return O.getScale()
            }, this.setScale = function(a) {
                O.setScale(a)
            }, this.getRotate = function() {
                return O.getRotate()
            }, this.setRotate = function(a) {
                O.setRotate(a)
            }, this.getPageSpane = function() {
                return ja[P.showMode].getPageSpace()
            }, this.gotoPage = function(a, b, c) {
                if (!S) return !1;
                var d = ea.getVisiblePageRange();
                c = c ? c : 0, null == b && (b = S.getContentPositionX());
                var e = ea.getPageCount();
                if (0 > a || a >= e) return !1;
                var f = Z;
                ja[P.showMode].gotoPage(a, Z, b, c), ea.unBindScrollEvent(), ea.countVisiblePageRange();
                var g = ea.getVisiblePageRange();
                return Z = g.current, r(f), R.isLargeFile() ? h.parsePages(R.getLargeFileDocId(), WebPDF.ViewerInstance.getFileID(), g.begin, g.end).then(function() {
                    qa(g), P.showMode !== WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE && (ea.notifyPageVisibleStatus(d, g), ea.reinitializeScrollBar()), ea.bindScrollEvent(), w()
                }) : (qa(g), P.showMode !== WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE && (ea.notifyPageVisibleStatus(d, g), ea.reinitializeScrollBar()), ea.bindScrollEvent(), w()), !0
            }, this.gotoNextPage = function() {
                return Z + 1 >= ea.getPageCount() ? !1 : ea.gotoPage(Z + 1)
            }, this.gotoPrevPage = function() {
                return 0 >= Z ? !1 : ea.gotoPage(Z - 1)
            }, this.gotoPageByDestination = function(a) {
                var b = ea.getPageCount();
                if (!a || a.pageIndex < 0 || a.pageIndex >= b) return !1;
                var c = R.getPixelsPerPoint();
                O.zoomToPage(a.zoomToMode, a.scale, a.width * c, a.height * c, !0);
                var d = 0,
                    e = 0;
                return -1 !== a.top && (d = a.top * P.scale * c), -1 !== a.left && (e = a.left * P.scale * c), ea.gotoPage(a.pageIndex, e, d)
            }, this.getVisiblePageRange = function() {
                return da
            }, this.countVisiblePageRange = function() {
                return da = ca.countVisiblePageRange()
            }, this.clearAllSelection = function() {}, this.isModified = function() {
                return fa
            }, this.setModified = function(a) {
                fa != a && (fa = a, $(n).trigger(WebPDF.EventList.DOC_MODIFY_STATE_CHANGED, [a]))
            }, this.getPageDomElmHeight = function(a) {
                var b = document.getElementById(ea.getPageView(a).getPageViewContainerID()),
                    c = $(b).height(),
                    d = O.getRotate();
                return (90 == d || 270 == d) && (c = $(b).width()), c
            }, this.getDocViewDimension = function() {
                return {
                    width: T + W,
                    height: U + V
                }
            }, this.changeShowMode = function(a, b) {
                if (P.showMode != a) {
                    a == WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE ? ea.setFitPage(!0) : ea.setFitPage(!1);
                    var c = P.showMode;
                    P.showMode = a, ja[P.showMode].active(Z), b && $(R).trigger(WebPDF.EventList.LAYOUTSHOWMODE_CHANGED, {
                        oldShowMode: c,
                        newShowMode: P.showMode
                    })
                }
            }, this.getPdfViewerShowMode = function() {
                return P.showMode
            }, this.getPageViewByPosition = function(a, b) {
                for (var c = ea.getVisiblePageRange(), d = null, e = null, f = c.begin; f <= c.end; f++) {
                    var g = ea.getPageView(f),
                        h = $("#" + g.getPageViewContainerID()).offset(),
                        i = g.getPageViewWidth(),
                        j = g.getPageViewHeight();
                    if (e = new WebPDF.PDFRect(h.left, h.top, h.left + i, h.top + j), WebPDF.RectUtils.normalize(e), WebPDF.RectUtils.ptInRect(e, a, b)) {
                        d = g;
                        break
                    }
                }
                return d
            }, this.getWatermarkHtmlContent = function(a, b, c) {
                return null == a ? "" : (null == b && (b = 1), Q.getWatermarkHtmlContent(a, b, c))
            }, this.showPageWatermark = function(a) {
                return null == a ? !1 : void Q.renderPageWatermark(a)
            }, this.setSigAddFlag = function(a) {
                sa = a
            }, this.isSigAdded = function(a) {
                return sa
            }, this.setInkSigAddFlag = function(a) {
                ta = a
            }, this.isInkSigAdded = function(a) {
                return ta
            }, this.showPageWatermark = function(a) {
                return null == a ? !1 : void Q.renderPageWatermark(a)
            }, this.isShowAnnots = function() {
                return la
            }, this.showAnnots = function(a) {
                la = a;
                for (var b = 0; b < ea.getPageCount(); b++) ea.getPageView(b).setPageUpdateState(!0);
                var c = $("#" + ea.getDocViewContainerID()),
                    d = ea.getDocViewDimension(),
                    e = d.height,
                    f = d.width,
                    g = c.offset();
                $(R).trigger(WebPDF.EventList.PAGE_VISIBLE, {
                    pages: ka,
                    contentPanelWidth: f,
                    contentPaneHeight: e,
                    contentPanelOffset: g,
                    isShowAnnots: a,
                    isCommentsMenuClick: !0
                })
            }, this.showForms = function(a) {
                for (var b = 0; b < ea.getPageCount(); b++) {
                    var c = "docViewer_ViewContainer_PageContainer_" + b + "_formWidgets";
                    a ? $("#" + c).show() : $("#" + c).hide()
                }
            }, this.getPageAnnotUnLoad = function() {
                return ma
            }, this.getOpenTime = function() {
                return na
            }, this.zoomPageOnPoint = function(a, b, c) {
                var d = ea.getScale(),
                    e = O.getFitWidthScale(!0);
                if (!(0 > a && R.isMobile() && 0 > d + a - e / 2)) {
                    var f = $("#" + ea.getDocViewContainerID()),
                        g = f.height(),
                        h = f.width();
                    S && (h -= S.getScrollBarWidth(), g -= S.getScrollBarHeight());
                    var i = f.offset(),
                        j = b,
                        k = c,
                        l = k - i.top,
                        m = j - i.left,
                        n = l / g,
                        o = m / h,
                        p = S.getContentPositionY(),
                        q = S.getContentPositionX();
                    ea.onZoom(d + a);
                    var r = ea.getScale();
                    r !== e ? ea.setFitWidth(!1) : ea.setFitWidth(!0);
                    var s = r / d;
                    q = h * (s - 1) * o + q * s, p = g * (s - 1) * n + p * s, G(), ea.unBindScrollEvent(), S.scrollTo(q, p), ea.bindScrollEvent()
                }
            }, this.reloadOffLinePages = function() {
                E(!0), this.showAnnots(!1), this.showForms(!1);
                var a = ea.getVisiblePageRange();
                qa(a), ea.offTilesScrollEvent(), ea && $(".fwr-page-tiles").size() > 0 && $(".fwr-page-tiles").tiles("hide")
            }, this.reloadOnLinePages = function() {
                if (E(!0), !WebPDF.Engine.JR) {
                    R.getTileConfig().enable && ea && $(".fwr-page-tiles").size() > 0 && $(".fwr-page-tiles").tiles("show"), ea.bindTilesScrollEvent();
                    var a = S.getContentPositionY(),
                        b = S.getContentPositionX(),
                        c = ea.getRotate(),
                        d = ea.getScale();
                    d = Math.round(100 * d) / 100, R.getTileConfig().enable && ea && $(".fwr-page-tiles").size() > 0 && $(".fwr-page-tiles").tiles("zoom", d, a, b, c)
                }
                this.showAnnots(!0), this.showForms(!0);
                var e = ea.getVisiblePageRange();
                qa(e)
            }, this.gotoPageByAnnot = function(a, b, c) {
                var d = this.getPageCount();
                if (0 > a || a >= d) return !1;
                var e = this.getPageView(a);
                e.isContentCreated() || this.gotoPage(a, 0, 0);
                var f = e.getPDFPage(),
                    g = f.getAnnotByName(b);
                if (!g) return !1;
                var h = g.getRect();
                if (h) {
                    var i = e.getOffsetByAnnotRect(h);
                    this.gotoPage(a, i ? i.x : 0, i ? i.y : 0)
                } else this.gotoPage(a, 0, 0);
                var j = R.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    k = null;
                j && (k = j.getAnnotHandlerMgr(), k.selectAnnotBycommentList(e, g, c))
            }, this.isShowRuler = function() {
                return pa
            }, this.setShowRuler = function(a) {
                pa = a
            }, this.getRulerOffset = function() {
                return pa ? 17 : 0
            }
        }, WebPDF.PDFView.PDFDocView
    }), define("core/Framework/View/PDFPageView", ["core/Framework/View/PDFView", "core/WebPDF", "core/Common/Math/Rect", "core/Common/Math/Point", "core/Framework/Config", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        a("core/Framework/View/PDFView");
        var d = a("core/Common/Math/Rect"),
            e = a("core/Common/Math/Point"),
            f = a("core/Framework/Config"),
            g = WebPDF.RectUtils;
        a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        return WebPDF.PDFView.PDFPageView = function(a, b, c) {
            function h(a, b) {
                for (var c = 0; c < a.attributes.length; c++) {
                    var d = a.attributes[c];
                    switch (d.nodeName) {
                        case "rotate":
                            b.r = d.nodeValue;
                            break;
                        case "name":
                            b.n = d.nodeValue;
                            break;
                        case "color":
                            (!b.it || "FreeTextTextbox" != b.it && "FreeTextCallout" != b.it) && (b.cl = d.nodeValue, "undefined" != typeof b.ikc && (b.ikc = d.nodeValue));
                            break;
                        case "date":
                            b.md = WebPDF.Common.pdfTimeStringToTimeStamp(d.nodeValue);
                            break;
                        case "flags":
                            for (var e = 0, f = d.nodeValue.split(","), g = 0; g < f.length; g++) "invisible" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_INVISIBLE : "hidden" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_HIDDEN : "print" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT : "nozoom" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_NOZOOM : "norotate" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_NOROTATE : "noview" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_NOVIEW : "readonly" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_READONLY : "locked" === f[g] ? e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_LOCKED : "togglenoview" === f[g] && (e |= WebPDF.Annot.AnnotFlag.ANNOTFLAG_TOGGLENOVIEW);
                            b.f = e;
                            break;
                        case "rect":
                            var h = d.nodeValue.split(","),
                                i = G.getPDFPage().transRectWithPageMatrix(parseFloat(h[0]), parseFloat(h[3]), parseFloat(h[2]), parseFloat(h[1]));
                            WebPDF.RectUtils.normalize(i), b.rc = [i.left, i.top, i.right, i.bottom];
                            break;
                        case "title":
                            b.tit = d.nodeValue;
                            break;
                        case "creationdate":
                            b.cd = WebPDF.Common.pdfTimeStringToTimeStamp(d.nodeValue);
                            break;
                        case "subject":
                            b.subj = d.nodeValue;
                            break;
                        case "opacity":
                            b.ca = d.nodeValue;
                            break;
                        case "coords":
                            for (var j = d.nodeValue.split(","), g = 0; g < j.length; g++) j[g] = parseFloat(j[g]);
                            b.Quad = j;
                            break;
                        case "width":
                            b.bw = parseInt(d.nodeValue), "undefined" != typeof b.ikw && (b.ikw = parseInt(d.nodeValue));
                            break;
                        case "interior-color":
                            b.fcl = d.nodeValue;
                            break;
                        case "start":
                            for (var j = new Array, k = d.nodeValue.split(","), g = 0; g < k.length; g++) j[g] = parseFloat(k[g]);
                            for (var l = a.getAttribute("end").split(","), m = k.length; m < l.length + k.length; m++) j[m] = parseFloat(l[m - k.length]);
                            for (var g = 0; g < j.length; g += 2) {
                                var n = G.getPDFPage().getPageMatrix().TransFormPoint(j[g], j[g + 1]);
                                j[g] = n[0], j[g + 1] = n[1]
                            }
                            b.l = j;
                            break;
                        case "head":
                            var o = d.nodeValue,
                                p = a.getAttribute("tail"),
                                q = new Array;
                            q[0] = o, q[1] = p, b.le = q;
                            break;
                        case "intent":
                        case "IT":
                            b.it = d.nodeValue;
                            break;
                        case "open":
                            b.op = "yes" === d.nodeValue ? 1 : 0;
                            break;
                        case "callout":
                            var r = d.nodeValue;
                            if (r) {
                                for (var s = r.split(","), g = 0; g < s.length; g += 2) {
                                    var j = G.getPDFPage().getPageMatrix().TransFormPoint(parseFloat(s[g]), parseFloat(s[g + 1]));
                                    s[g] = j[0], s[g + 1] = j[1]
                                }
                                b.ftcl = s
                            }
                            break;
                        case "fringe":
                            var h = d.nodeValue.split(",");
                            b.rd = [parseFloat(h[0]), parseFloat(h[3]), parseFloat(h[2]), parseFloat(h[1])];
                            break;
                        case "replyType":
                            b.rt = d.nodeValue;
                            break;
                        case "inreplyto":
                            b.irt = d.nodeValue;
                            break;
                        case "cap":
                            b.cap = "true" === d.nodeValue ? !0 : !1
                    }
                }
            }

            function i(a, b) {
                var c = a.nodeName;
                c = c.firstUpperCase();
                var d = 1,
                    e = {
                        c: "",
                        ca: d,
                        cd: "",
                        cl: a.getAttribute("color"),
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: "",
                        n: "",
                        pop: null,
                        tit: "",
                        r: null,
                        rc: null,
                        userId: b,
                        del: 0,
                        pdf: "false"
                    };
                switch (c) {
                    case "Text":
                        var f = {
                            subj: i18n.t("Annot.AnnotSubjNote"),
                            subty: "Text",
                            ty: "Markup",
                            Quad: [],
                            txtn: "Comment"
                        };
                        e = $.extend({}, e, f);
                        break;
                    case "Freetext":
                        var g = WebPDF.AccountInstance.getUserConfig(),
                            i = {};
                        if ("FreeTextTypewriter" === a.getAttribute("intent") || "FreeTextTypewriter" === a.getAttribute("IT")) i = {
                            q: 0,
                            subj: i18n.t("Annot.AnnotSubjTypewriter"),
                            subty: "FreeText",
                            ty: "Typewriter",
                            fs: WebPDF.Annot.TypewriteAnnotDefaultValue.FontSize,
                            fh: WebPDF.Annot.TypewriteAnnotDefaultValue.FontHeight,
                            lnh: WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight,
                            fc: g.annot.typeWriter.clr,
                            ftn: "Helvetica",
                            it: WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TYPEWRITER
                        };
                        else {
                            var j = a.getElementsByTagName("defaultappearance"),
                                k = "#FF0000";
                            if (j.length > 0 && (j = j[0].textContent, j.indexOf("rg") > -1)) {
                                DAComponent = j.split(" ");
                                for (var l = -1, m = 3; m < DAComponent.length; m++)
                                    if ("rg" == DAComponent[m].toLowerCase()) {
                                        l = m;
                                        break
                                    }
                                if (l >= 3) {
                                    var n = "rgb(" + parseInt(256 * parseFloat(DAComponent[l - 3])) + "," + parseInt(256 * parseFloat(DAComponent[l - 2])) + "," + parseInt(256 * parseFloat(DAComponent[l - 1])) + ")";
                                    k = WebPDF.Common.rgb2HexColor(n)
                                }
                            }
                            var o = a.getAttribute("style") || "s",
                                p = a.getAttribute("width") || 1,
                                q = a.getAttribute("color");
                            i = "FreeTextCallout" === a.getAttribute("intent") || "FreeTextCallout" === a.getAttribute("IT") ? {
                                q: 0,
                                cl: k,
                                bw: p,
                                subj: i18n.t("Annot.AnnotSubjCallout"),
                                subty: "FreeText",
                                le: ["OpenArrow", "None"],
                                ty: "Callout",
                                fs: WebPDF.Annot.TypewriteAnnotDefaultValue.FontSize,
                                fh: WebPDF.Annot.TypewriteAnnotDefaultValue.FontHeight,
                                lnh: WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight,
                                fc: g.annot.callout.fontColor,
                                ftn: "Helvetica",
                                it: WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT,
                                rd: null,
                                ftcl: null
                            } : {
                                q: 0,
                                subj: "Text Box",
                                subty: "FreeText",
                                ty: "Textbox",
                                fs: WebPDF.Annot.TypewriteAnnotDefaultValue.FontSize,
                                fh: WebPDF.Annot.TypewriteAnnotDefaultValue.FontHeight,
                                lnh: WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight,
                                fc: g.annot.typeWriter.clr,
                                cl: k,
                                ftn: "Helvetica",
                                it: WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TEXTBOX,
                                da: j,
                                bs: o,
                                bw: p
                            }, q && (i.fcl = q)
                        }
                        e = $.extend({}, e, i);
                        var r = a.getElementsByTagName("contents-richtext");
                        if (r.length > 0) {
                            var s = null,
                                t = null,
                                u = null,
                                v = null,
                                w = r[0].getElementsByTagName("span");
                            if (w.length > 0) {
                                var x = w[0].textContent;
                                if (x && (e.c = x), w[0].getAttribute("style"))
                                    for (var y = w[0].getAttribute("style").split(";"), m = 0; m < y.length; m++) {
                                        var o = y[m].split(":");
                                        switch (o[0].replace(/^\s*/, "")) {
                                            case "font-size":
                                                s = parseFloat(o[1]);
                                                break;
                                            case "font-family":
                                                u = o[1];
                                                break;
                                            case "color":
                                                v = o[1];
                                                break;
                                            case "line-height":
                                                t = parseFloat(o[1])
                                        }
                                    }
                            }
                            var z = r[0].getElementsByTagName("body");
                            if (z.length > 0 && z[0].getAttribute("style"))
                                for (var y = z[0].getAttribute("style").split(";"), m = 0; m < y.length; m++) {
                                    var o = y[m].split(":");
                                    switch (o[0].replace(/^\s*/, "")) {
                                        case "font-size":
                                            s || (s = parseFloat(o[1]));
                                            break;
                                        case "font-family":
                                            u || (u = o[1]);
                                            break;
                                        case "color":
                                            v || (v = o[1]);
                                            break;
                                        case "line-height":
                                            t || (t = parseFloat(o[1]))
                                    }
                                }
                            s && (e.fs = s, e.fh = e.fs), u && (e.ftn = u.replace(/'/g, "")), v && (e.fc = v), t ? e.lnh = t : e.lnh = e.fs
                        }
                        break;
                    case "Highlight":
                    case "Underline":
                    case "Strikeout":
                    case "Squiggly":
                    case "Caret":
                        "Strikeout" === c && (c = "StrikeOut");
                        var A = "";
                        c === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE ? A = i18n.t("Annot.AnnotSubjUnderline") : c == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? A = i18n.t("Annot.AnnotSubjHighlight") : c == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY ? A = i18n.t("Annot.AnnotSubjSquiggly") : c == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT ? A = i18n.t("Annot.AnnotSubjStrikeout") : c == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE ? A = i18n.t("Annot.AnnotSubjReplace") : c == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET && (A = i18n.t("Annot.AnnotSubjCaret"));
                        var B = {
                            subj: A,
                            subty: c,
                            ty: "Markup",
                            Quad: []
                        };
                        e = $.extend({}, e, B);
                        break;
                    case "Square":
                    case "Circle":
                        var A = i18n.t("Annot.AnnotSubjRectangle");
                        c === WebPDF.Annot.AnnotType.Circle && (A = i18n.t("Annot.AnnotSubjOval"));
                        var C = {
                            bw: 3,
                            subj: A,
                            subty: c,
                            ty: "Markup"
                        };
                        e = $.extend({}, e, C);
                        break;
                    case "Line":
                        var D = a.getAttribute("head") || "None",
                            E = a.getAttribute("tail") || "None",
                            F = a.getAttribute("cap") || !0,
                            H = {
                                bw: 3,
                                l: null,
                                le: [D, E],
                                subj: i18n.t("Annot.AnnotSubjLine"),
                                subty: c,
                                ty: "Markup",
                                cap: F
                            };
                        e = $.extend({}, e, H);
                        break;
                    case "Ink":
                        var I = {
                            subj: i18n.t("Annot.AnnotSubjPencil"),
                            subty: "Ink",
                            ty: "Markup",
                            ikl: null,
                            ikc: null,
                            ikw: null
                        };
                        e = $.extend({}, e, I);
                        var J = a.getElementsByTagName("inklist");
                        if (J) {
                            for (var K = new Array, m = 0; m < J[0].childNodes.length; m++) {
                                for (var L = new Array, M = J[0].childNodes[m].textContent.split(";"), N = 0; N < M.length; N++) {
                                    var O = M[N].split(",");
                                    O = G.getPDFPage().getPageMatrix().TransFormPoint(parseFloat(O[0]), O[1]);
                                    for (var P = 0; P < O.length; P++) L.push(O[P])
                                }
                                K[m] = L
                            }
                            e.ikl = K
                        }
                        break;
                    case "Polygon":
                    case "Polyline":
                        var Q = i18n.t("Annot.AnnotSubjPolygon"),
                            R = "Polygon";
                        "Polyline" === c && (Q = i18n.t("Annot.AnnotSubjPolyline"), R = "PolyLine");
                        var S = {
                            bw: 3,
                            subj: Q,
                            subty: R,
                            ty: "Markup",
                            vts: []
                        };
                        e = $.extend({}, e, S);
                        var T = a.getElementsByTagName("vertices");
                        if (T.length > 0) {
                            for (var U = new Array, L = T[0].textContent.split(";"), m = 0; m < L.length; m++)
                                for (var O = L[m].split(","), N = 0; N < O.length; N++) U.push(O[N]);
                            e.vts = U
                        }
                }
                h(a, e), "Freetext" === c && ("FreeTextCallout" === a.getAttribute("intent") || "FreeTextCallout" === a.getAttribute("IT")) && "#FFFFFF" === e.cl && (e.cl = "#FF0000");
                var x = a.getElementsByTagName("contents");
                x.length > 0 && ("undefined" == typeof x[0].innerHTML ? e.c = x[0].firstChild.data : e.c = x[0].innerHTML);
                var V = a.getElementsByTagName("popup");
                return V.length > 0 && (e.pop = {
                    f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                    md: null,
                    n: null,
                    op: 1,
                    rc: null,
                    subty: "Popup"
                }, h(V[0], e.pop)), e
            }

            function j(a, b, c) {
                var d = !1,
                    e = a.getReplyChain();
                if (e && e.length > 0)
                    for (var f = 0; f < e.length; f++) {
                        if (e[f] && e[f].getAnnotName() === b && !a.isAnnotDel() && a.getAnnotName() === c) return !0;
                        if (d = j(e[f], b, c)) break
                    }
                return d
            }
            b || $.error("PDF page can not be null to create page view!");
            var k = b,
                l = c,
                m = a,
                n = c.getScale(),
                o = k.getPageWidth() * m.getPixelsPerPoint(),
                p = k.getPageHeight() * m.getPixelsPerPoint(),
                q = !1,
                r = !1,
                s = !1,
                t = !1,
                u = k.getPageIndex(),
                v = l.getPageViewContainerID(u),
                w = l.getPageBackgroundImgID(u),
                x = l.getWrapPageID(u),
                y = l.getPageLoaderImageID(u),
                z = l.getWatermarkID(u),
                A = l.getTrialWatermarkID(u),
                B = l.getUserWatermarkID(u),
                C = !1,
                D = !1,
                E = !1,
                F = !1,
                G = this,
                H = !1,
                I = !1,
                J = !1,
                K = !0,
                L = !1;
            this.setPageUpdateState = function(a) {
                K = a
            }, this.getPageUpdateState = function() {
                return K
            }, this.getPDFPage = function() {
                return k
            }, this.getPDFPageWidth = function() {
                return k.getPageWidth()
            }, this.getPDFPageHeight = function() {
                return k.getPageHeight()
            }, this.getPageViewWidth = function() {
                return o
            }, this.setPageViewWidth = function(a) {
                isNaN(a) || (o = a)
            }, this.getPageViewHeight = function() {
                return p
            }, this.setPageViewHeight = function(a) {
                isNaN(a) || (p = a)
            }, this.getPageIndex = function() {
                return k.getPageIndex()
            }, this.getPageViewContainerID = function() {
                return v
            }, this.getPageBackgroundImgID = function() {
                return w
            }, this.getWrapPageID = function() {
                return x
            }, this.getPageLoaderImageID = function() {
                return y
            }, this.getWatermarkID = function() {
                return z
            }, this.getTrialWatermarkID = function() {
                return A
            }, this.getUserWatermarkID = function() {
                return B
            }, this.getDocView = function() {
                return l
            }, this.setContentCreatedState = function(a) {
                q = a
            }, this.isContentCreated = function() {
                return q
            }, this.isDimensionUpdated = function() {
                return C
            }, this.setDimensionUpdated = function(a) {
                C = a
            }, this.isThumb = function() {
                return !1
            }, this.setAnnotLoad = function(a) {
                F = a
            }, this.isLoadAnnot = function() {
                return F
            }, this.isThumbnailLoaded = function() {
                return E
            }, this.setThumbnailLoaded = function(a) {
                E = a
            }, this.isCommentListLoaded = function() {
                return J
            }, this.setCommentListLoaded = function(a) {
                J = a
            }, this.updateDimension = function() {
                var a = this.getScale() * m.getPixelsPerPoint(),
                    b = l.getRotate(),
                    c = Math.ceil(G.getPDFPageWidth() * a),
                    d = Math.ceil(G.getPDFPageHeight() * a),
                    e = c,
                    f = d;
                b % 180 != 0 && (e = d, f = c), G.setPageViewWidth(e), G.setPageViewHeight(f);
                var g = l.getScrollApi(),
                    h = g ? g.getScrollBarWidth() : 0,
                    i = l.getViewMode(),
                    j = 0;
                j = i == WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING ? l.getDocViewWidth() / 2 : l.getDocViewWidth();
                var k = l.getRulerOffset(),
                    n = (j - e - h) / 2;
                b % 180 !== 0 && (n -= k / 2), 0 > n && (n = 0);
                var o = 0,
                    p = 0;
                if (b % 180 !== 0) {
                    o = l.getPageViewTranslateX(G.getPageIndex());
                    var q = c - e - k;
                    270 == b ? p = .5 * -q : 90 == b && (p = .5 * q)
                }
                WebPDF.Common.addTranslateCss($("#" + G.getPageViewContainerID()), b, o, p), $("#" + G.getPageViewContainerID()).css({
                    height: d,
                    width: c,
                    "margin-left": Math.floor(n)
                });
                var r = G.getDocView();
                r && r.showPageWatermark(G)
            }, this.getPageViewTranslateX = function(a, b) {
                a = a ? a : this.getScale(), b = b ? b : l.getRotate();
                var c = G.getPDFPageWidth() * a * m.getPixelsPerPoint(),
                    d = G.getPDFPageHeight() * a * m.getPixelsPerPoint(),
                    e = c,
                    f = d;
                (90 === b || 270 === b) && (e = d, f = c);
                var g = d - f,
                    h = 0;
                return 270 == b ? h = g : 90 == b && (h = -g), h
            }, this.show = function() {
                $("#" + x).addClass("fwr-hidden"), $("#" + w).removeClass("fwr-hidden"), $("#" + y).hide()
            }, this.showErrorPage = function(a) {
                var b = $("#" + x);
                b.html(""), b.removeClass("fwr-hidden"), $("#" + w).addClass("fwr-hidden").attr("src", "#"), $("#" + y).hide();
                var c = f.defaults.errPageImgWidth / G.getPageViewWidth(),
                    d = f.defaults.errPageImgHeight / G.getPageViewHeight(),
                    e = c >= d ? c : d;
                e = e > 1 ? e : 1;
                var g = f.defaults.errPageImgWidth / e,
                    h = f.defaults.errPageImgHeight / e,
                    i = "45%",
                    j = "<div style='position:absolute;width:100%;margin-top:" + i + "'><img width:" + g + "px;height:" + h + " src='" + a + "'  style='display:block;max-width:100%;margin:0 auto;'></div>";
                b.append(j)
            }, this.isPageLoaded = function() {
                return r
            }, this.setPageLoaded = function(a) {
                r = a
            }, this.isPageLoadError = function() {
                return s
            }, this.isPageLoadLimit = function() {
                return t
            }, this.setPageLoadLimit = function(a) {
                t = a
            }, this.setPageLoadError = function(a) {
                s = a
            }, this.getScale = function() {
                return n
            }, this.setScale = function(a) {
                n = a
            }, this.getPageViewDivOffset = function() {
                var a = $("#" + G.getPageViewContainerID()),
                    b = (a.offset(), 0),
                    c = 0;
                return b += a.get(0).offsetTop, c += a.get(0).offsetLeft, {
                    left: c,
                    top: b
                }
            }, this.getPageViewHtmlOffset = function() {
                return $("#" + G.getPageViewContainerID()).offset()
            }, this.getPageViewOffsetpt = function(a, b) {
                var c = $("#" + G.getPageViewContainerID()).offset(),
                    d = new e(0, 0);
                return d.x = a - c.left, d.y = b - c.top, d
            }, this.getPageViewRect = function() {
                var a = G.getPageViewHtmlOffset(),
                    b = new WebPDF.PDFRect(a.left, a.top, a.left + G.getPageViewWidth(), a.top + G.getPageViewHeight());
                return WebPDF.RectUtils.normalize(b), b
            }, this.getAnnotAtPoint = function(a, b) {
                return null
            }, this.getFocusAnnot = function() {
                return null
            }, this.setFocusAnnot = function(a) {}, this.isModified = function() {
                return D
            }, this.setModified = function(a) {
                D = a
            }, this.isSignatureContainerAdd = function() {
                return H
            }, this.setSignatureContainerAdd = function(a) {
                H = a
            }, this.isInkSignContainerAdd = function() {
                return I
            }, this.setInkSignContainerAdd = function(a) {
                I = a
            }, this.isPageReady = function() {
                return L
            }, this.setPageReady = function() {
                L = !0
            }, this.offsetToPageRotate = function(a, b, c, d) {
                var e = G.getPageViewHeight(),
                    f = G.getPageViewWidth(),
                    g = new WebPDF.PDFPoint(a.x, a.y),
                    h = 0;
                90 == d ? (g.y = a.x, g.x = f - a.y - c, h = b, b = c, c = h) : 270 == d ? (g.x = a.y, g.y = e - a.x - b, h = b, b = c, c = h) : 180 == d && (g.x = f - a.x - b, g.y = e - a.y - c);
                var i = {
                    top: g.y,
                    left: g.x,
                    width: b,
                    height: c
                };
                return i
            }, this.pointToPDF = function(a) {
                var b = 90 * k.getPageRotate();
                0 > b && (b %= 360, b += 360);
                var c = b % 360,
                    d = m.getPixelsPerPoint(),
                    e = [];
                return 90 === c ? (e[0] = a[1] / d, e[1] = a[0] / d) : 180 === c ? (e[0] = (o - a[0]) / d, e[1] = a[1] / d) : 270 === c ? (e[0] = (p - a[1]) / d, e[1] = (o - a[0]) / d) : (e[0] = a[0] / d, e[1] = (p - a[1]) / d), e
            }, this.pdfPointToDevice = function(a) {
                var b = 90 * k.getPageRotate();
                0 > b && (b %= 360, b += 360);
                var c = b % 360,
                    d = G.getScale(),
                    e = m.getPixelsPerPoint(),
                    f = [];
                return 90 === c ? (f[0] = a[1] * e * d, f[1] = a[0] * e * d) : 180 === c ? (f[1] = a[1] * e * d, f[0] = (G.getPDFPageWidth() - a[0]) * e * d) : 270 === c ? (f[0] = (G.getPDFPageWidth() - a[1]) * e * d, f[1] = (G.getPDFPageHeight() - a[0]) * e * d) : (f[0] = a[0] * e * d, f[1] = (G.getPDFPageHeight() - a[1]) * e * d), f
            }, this.devicePtToPDF = function(a) {
                var b = G.getScale(),
                    c = m.getPixelsPerPoint(),
                    d = new e(0, 0);
                return 90 == l.getRotate() ? (d.x = a.y / (c * b), d.y = a.x / (c * b)) : 180 == l.getRotate() ? (d.x = (G.getPageViewWidth() - a.x) / (c * b), d.y = a.y / (c * b)) : 270 == l.getRotate() ? (d.x = (p - a.y) / (c * b), d.y = (G.getPageViewWidth() - a.x) / (c * b)) : (d.x = a.x / (c * b), d.y = (p - a.y) / (c * b)), d
            }, this.pdfPtToDevice = function(a) {
                var b = G.getScale(),
                    c = m.getPixelsPerPoint(),
                    d = new e(0, 0);
                return d.x = a.x * c * b, d.y = (G.getPDFPageHeight() - a.y) * c * b, d
            }, this.point2pdf = function(a) {
                var b = G.getScale(),
                    c = m.getPixelsPerPoint(),
                    d = new e(0, 0);
                return d.x = a.x / (c * b), d.y = G.getPDFPageHeight() - a.y / (c * b), d
            }, this.deviceRectToPageRotate = function(a, b) {
                var c = G.getPageViewWidth(),
                    d = G.getPageViewHeight(),
                    e = WebPDF.RectUtils.width(a),
                    f = WebPDF.RectUtils.height(a),
                    g = new WebPDF.PDFRect(a.left, a.top, a.right, a.bottom);
                return 270 == b ? (g.left = d - a.bottom, g.right = g.left + f, g.top = a.left, g.bottom = g.top + e) : 90 == b ? (g.left = a.top, g.right = g.left + f, g.top = c - a.right, g.bottom = g.top + e) : 180 == b && (g.left = c - a.right, g.right = g.left + e, g.top = d - a.bottom, g.bottom = g.top + f), g
            }, this.devicePtToPageRotate = function(a, b) {
                var c = G.getPageViewHeight(),
                    d = G.getPageViewWidth(),
                    e = new WebPDF.PDFPoint(a.x, a.y);
                return 270 == b ? (e.x = c - a.y, e.y = a.x) : 90 == b ? (e.x = a.y, e.y = d - a.x) : 180 == b && (e.x = d - a.x, e.y = c - a.y), e
            }, this.PageRotateToScreen = function(a, b) {
                var c = G.getPageViewWidth(),
                    d = G.getPageViewHeight(),
                    e = WebPDF.RectUtils.width(a),
                    f = WebPDF.RectUtils.height(a),
                    g = new WebPDF.PDFRect(a.left, a.top, a.right, a.bottom);
                return 90 == b ? (g.left = c - a.bottom, g.right = g.left + f, g.top = a.left, g.bottom = g.top + e) : 180 == b ? (g.left = c - a.right, g.right = g.left + e, g.top = d - a.bottom, g.bottom = g.top + f) : 270 == b && (g.left = a.top, g.right = g.left + f, g.top = d - a.right, g.bottom = g.top + e), g
            }, this.PtPageRotateToScreen = function(a, b) {
                var c = G.getPageViewWidth(),
                    d = G.getPageViewHeight(),
                    e = new WebPDF.PDFPoint(a.x, a.y);
                return 90 == b ? (e.x = c - a.y, e.y = a.x) : 180 == b ? (e.x = c - a.x, e.y = d - a.y) : 270 == b && (e.x = a.y, e.y = d - a.x), e
            }, this.pdfRectToDevice = function(a, b) {
                g.normalize(a);
                var c = g.width(a),
                    e = g.height(a),
                    f = new d(0, 0, 0, 0),
                    h = G.getScale(),
                    i = m.getPixelsPerPoint();
                f.left = a.left * i * h, b ? f.right = f.left + c * i * h : f.right = f.left + c * i, f.top = a.top * i * h;
                var j = 0;
                return j = 90 == l.getRotate() || 270 == l.getRotate() ? G.getPageViewWidth() : G.getPageViewHeight(), f.top = j - f.top, b ? f.bottom = f.top + e * i * h : f.bottom = f.top + e * i, f
            }, this.deviceRectToPDF = function(a, b, c) {
                var e = g.width(a),
                    f = g.height(a),
                    h = new d(0, 0, 0, 0),
                    i = G.getScale(),
                    j = 0;
                j = null != c || void 0 != c ? c : l.getRotate(), b || (i = 1);
                var k = m.getPixelsPerPoint();
                return 90 == j ? (h.left = a.top / (k * i), h.right = h.left + f / (k * i), h.top = a.right / (k * i), h.bottom = a.left / (k * i)) : 180 == j ? (h.left = G.getPDFPageWidth() - a.right / (k * i), h.right = G.getPDFPageWidth() - a.left / (k * i), h.top = a.bottom / (k * i), h.bottom = a.top / (k * i)) : 270 == j ? (h.left = G.getPDFPageWidth() - a.bottom / (k * i), h.right = G.getPDFPageWidth() - a.top / (k * i), h.top = G.getPDFPageHeight() - a.left / (k * i), h.bottom = G.getPDFPageHeight() - a.right / (k * i)) : (h.left = a.left / (k * i), h.right = h.left + e / (k * i), h.top = G.getPDFPageHeight() - a.top / (k * i), h.bottom = h.top - f / (k * i)), h
            }, this.deviceRectToPDFRect = function(a, b) {
                var c = g.width(a),
                    e = g.height(a),
                    f = m.getPixelsPerPoint(),
                    h = new d(0, 0, 0, 0),
                    i = G.getScale();
                b || (i = 1);
                var j = l.getRotate(),
                    n = 90 * k.getPageRotate();
                0 > n && (n %= 360, n += 360);
                var o = (j + n) % 360;
                return 90 == o ? (h.left = a.top / (f * i), h.right = h.left + e / (f * i), h.top = a.right / (f * i), h.bottom = a.left / (f * i)) : 180 == o ? (180 == j && 0 == n || 0 == j && 180 == n ? (h.left = G.getPDFPageWidth() - a.right / (f * i), h.right = G.getPDFPageWidth() - a.left / (f * i)) : (90 == j && 90 == n || 270 == j && 270 == n) && (h.left = G.getPDFPageHeight() - a.right / (f * i), h.right = G.getPDFPageHeight() - a.left / (f * i)), h.top = a.bottom / (f * i), h.bottom = a.top / (f * i)) : 270 == o ? 270 == j && 0 == n || 90 == j && 180 == n ? (h.left = G.getPDFPageWidth() - a.bottom / (f * i), h.right = G.getPDFPageWidth() - a.top / (f * i), h.top = G.getPDFPageHeight() - a.left / (f * i), h.bottom = G.getPDFPageHeight() - a.right / (f * i)) : (180 == j && 90 == n || 0 == j && 270 == n) && (h.left = G.getPDFPageHeight() - a.bottom / (f * i), h.right = G.getPDFPageHeight() - a.top / (f * i), h.top = G.getPDFPageWidth() - a.left / (f * i), h.bottom = G.getPDFPageWidth() - a.right / (f * i)) : (h.left = a.left / (f * i), h.right = h.left + c / (f * i), 0 == j && 0 == n || 180 == j && 180 == n ? h.top = G.getPDFPageHeight() - a.top / (f * i) : (270 == j && 90 == n || 90 == j && 270 == n) && (h.top = G.getPDFPageWidth() - a.top / (f * i)), h.bottom = h.top - e / (f * i)), h
            }, this.pdfRectToDeviceRect = function(a, b, c) {
                g.normalize(a);
                var e = (g.width(a), g.height(a), new d(0, 0, 0, 0)),
                    f = new d(0, 0, 0, 0),
                    h = G.getScale();
                b || (h = 1);
                var i = m.getPixelsPerPoint(),
                    j = l.getRotate(),
                    n = 90 * k.getPageRotate();
                0 > n && (n %= 360, n += 360);
                var o = (j + n) % 360;
                if (0 == o ? (f.left = a.left * i * h, f.right = a.right * i * h, 0 == j && 0 == n || 180 == j && 180 == n ? (f.top = (G.getPDFPageHeight() - a.top) * i * h, f.bottom = (G.getPDFPageHeight() - a.bottom) * i * h) : (270 == j && 90 == n || 90 == j && 270 == n) && (f.top = (G.getPDFPageWidth() - a.top) * i * h, f.bottom = (G.getPDFPageWidth() - a.bottom) * i * h)) : 90 == o ? (f.left = a.bottom * i * h, f.right = a.top * i * h, f.top = a.left * i * h, f.bottom = a.right * i * h) : 180 == o ? (180 == j && 0 == n || 0 == j && 180 == n ? (f.left = (G.getPDFPageWidth() - a.right) * i * h, f.right = (G.getPDFPageWidth() - a.left) * i * h) : (90 == j && 90 == n || 270 == j && 270 == n) && (f.left = (G.getPDFPageHeight() - a.right) * i * h, f.right = (G.getPDFPageHeight() - a.left) * i * h), f.top = a.bottom * i * h, f.bottom = a.top * i * h) : 270 == o && (270 == j && 0 == n || 90 == j && 180 == n ? (f.left = (G.getPDFPageHeight() - a.top) * i * h, f.right = (G.getPDFPageHeight() - a.bottom) * i * h, f.top = (G.getPDFPageWidth() - a.right) * i * h, f.bottom = (G.getPDFPageWidth() - a.left) * i * h) : (180 == j && 90 == n || 0 == j && 270 == n) && (f.left = (G.getPDFPageWidth() - a.top) * i * h, f.right = (G.getPDFPageWidth() - a.bottom) * i * h, f.top = (G.getPDFPageHeight() - a.right) * i * h, f.bottom = (G.getPDFPageHeight() - a.left) * i * h)), c) return f;
                var p = G.getPageViewHeight(),
                    q = G.getPageViewWidth();
                return 90 == j ? (e.left = f.top, e.right = f.bottom, e.top = q - f.right, e.bottom = q - f.left) : 180 == j ? (e.left = q - f.right, e.right = q - f.left, e.top = p - f.bottom, e.bottom = p - f.top) : 270 == j ? (e.left = p - f.bottom, e.right = p - f.top, e.top = f.left, e.bottom = f.right) : e = f, e
            }, this.deviceRect2Page = function(a) {
                g.normalize(a);
                var b = new d(0, 0, 0, 0),
                    c = (m.getPixelsPerPoint(), G.getPageViewHeight()),
                    e = G.getPageViewWidth(),
                    f = l.getRotate();
                switch (f) {
                    case 90:
                        b.left = a.top, b.top = e - a.right, b.right = a.bottom, b.bottom = e - a.left;
                        break;
                    case 180:
                        b.left = e - a.right, b.top = c - a.bottom, b.right = e - a.left, b.bottom = c - a.top;
                        break;
                    case 270:
                        b.left = c - a.bottom, b.top = a.left, b.right = c - a.top, b.bottom = a.right;
                        break;
                    default:
                        b = a
                }
                return b
            }, this.pdfRect2Page = function(a, b) {
                return a = G.pdfRect2Device(a, b), G.deviceRect2Page(a)
            }, this.pdfRect2Device = function(a, b) {
                g.normalize(a);
                var c = (g.width(a), g.height(a), new d(0, 0, 0, 0), new d(0, 0, 0, 0)),
                    e = G.getScale();
                b || (e = 1);
                var f = m.getPixelsPerPoint(),
                    h = l.getRotate(),
                    i = 90 * k.getPageRotate();
                0 > i && (i %= 360, i += 360);
                var j = (h + i) % 360;
                return 0 == j ? (c.left = a.left * f * e, c.right = a.right * f * e, 0 == h && 0 == i || 180 == h && 180 == i ? (c.top = (G.getPDFPageHeight() - a.top) * f * e, c.bottom = (G.getPDFPageHeight() - a.bottom) * f * e) : (270 == h && 90 == i || 90 == h && 270 == i) && (c.top = (G.getPDFPageWidth() - a.top) * f * e, c.bottom = (G.getPDFPageWidth() - a.bottom) * f * e)) : 90 == j ? (c.left = a.bottom * f * e, c.right = a.top * f * e, c.top = a.left * f * e, c.bottom = a.right * f * e) : 180 == j ? (180 == h && 0 == i || 0 == h && 180 == i ? (c.left = (G.getPDFPageWidth() - a.right) * f * e, c.right = (G.getPDFPageWidth() - a.left) * f * e) : (90 == h && 90 == i || 270 == h && 270 == i) && (c.left = (G.getPDFPageHeight() - a.right) * f * e, c.right = (G.getPDFPageHeight() - a.left) * f * e), c.top = a.bottom * f * e, c.bottom = a.top * f * e) : 270 == j && (270 == h && 0 == i || 90 == h && 180 == i ? (c.left = (G.getPDFPageHeight() - a.top) * f * e, c.right = (G.getPDFPageHeight() - a.bottom) * f * e, c.top = (G.getPDFPageWidth() - a.right) * f * e, c.bottom = (G.getPDFPageWidth() - a.left) * f * e) : (180 == h && 90 == i || 0 == h && 270 == i) && (c.left = (G.getPDFPageWidth() - a.top) * f * e, c.right = (G.getPDFPageWidth() - a.bottom) * f * e, c.top = (G.getPDFPageHeight() - a.right) * f * e, c.bottom = (G.getPDFPageHeight() - a.left) * f * e)), c
            }, this.importAnnotFromXFDF = function(a, b, c, d) {
                var e = a.getAttribute("name"),
                    f = i(a, b);
                if (!f) return null;
                var g = a.getAttribute("inreplyto");
                if (this.isAnnotExist(e, g)) return this.updateAnnot(f, e);
                var h = !1;
                if ("StrikeOutTextEdit" == f.it) {
                    var j = k.getAnnotByName(f.irt);
                    j.setGrp(f.n), g = null, h = !0
                }
                return g ? this.importReplyAnnot(f, g, d, k.isAnnotLoaded()) : this.importAnnotFromJsonData(f, c, d, k.isAnnotLoaded(), h)
            }, this.updateAnnot = function(a, b) {
                var c = WebPDF.Annot.AnnotFactory.createAnnot(a, u, !1);
                if (null == c || !k.isSupportedXFDFType(c)) return null;
                var d = m.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                return d.getAnnotHandlerMgr().updateAnnot(b, c, this)
            }, this.importReplyAnnot = function(a, b, c, d) {
                function e(a, b, c) {
                    if (!a) return !1;
                    for (var d = !1, h = 0; h < a.length; h++) {
                        if (a[h][f.name] == c) {
                            var a = g[h][f.replyChain];
                            a || (g[h][f.replyChain] = []), g[h][f.replyChain].push(b), d = !0;
                            break
                        }
                        if (d = e(a[h][f.replyChain], b, c)) break
                    }
                    return d
                }
                var f = WebPDF.Annot.AnnotDataJSONFormat;
                if (!d) {
                    for (var g = k.getAnnotJsonData(), h = 0; h < g.length; h++) {
                        var i = !1,
                            j = g[h][f.replyChain];
                        if (g[h][f.name] == b) {
                            j || (g[h][f.replyChain] = []), g[h][f.replyChain].push(a), i = !0;
                            break
                        }
                        if (!i) {
                            var i = e(j, a, b);
                            if (i) break
                        }
                    }
                    return null
                }
                var l = m.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    n = k.getAnnotByName(b);
                return n ? l.getAnnotHandlerMgr().addReplyByJson(n, a, u, c) : void 0
            }, this.importAnnotFromJsonData = function(a, b, c, d, e, f) {
                var g = null;
                if (a.del) {
                    if (a.del = 0, g = k.getAnnotByName(a.n), null == g) return null;
                    g.show()
                } else {
                    if (g = WebPDF.Annot.AnnotFactory.createAnnot(a, u, !1), null == g || !f && !k.isSupportedXFDFType(g)) return null;
                    if (k.getAnnotJsonData().push(a), k.addAnnot(g), e && g.setRT("Group"), a.grp && a.grp.length > 0) {
                        for (var h = 0; h < a.grp.length; h++) a.grp[h].irt = a.n, this.importAnnotFromJsonData(a.grp[h], b, c, d, !0);
                        g.setGrp(a.grp[0].n)
                    }
                }
                if (m.setModified(this, l, !0), !d) return g;
                var i = m.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                if (i) {
                    var j = i.getAnnotHandlerMgr(),
                        n = j.getUIManager().getPageAnnotsContainerID(G),
                        o = $("#" + n),
                        p = g.getAnnotName(),
                        q = j.getUIManager().createAAnnotHtmlContent(G, g, p, 1, !m.isMobile());
                    o.append(q);
                    var r = g.getSubType();
                    j.drawAnnot(this, g, !1, null, !0);
                    var s = $("#" + l.getDocViewContainerID()),
                        t = l.getDocViewDimension(),
                        v = t.height,
                        w = t.width,
                        x = s.offset(),
                        y = j.getAnnotVisibleRect(this, x, w, v),
                        z = j.getAnnotHandlerByAnnot(g);
                    if (null != z && z.onUpdatePosition(this, g, y), e) return g;
                    "Screen" === r && f && z && z.setRotation(this, g, g.getRotate()), j.getUIManager().rotatePopupAnnot(this, g.getAnnotName()), b && (A = c ? {
                        annotName: g.getAnnotName(),
                        pageIndex: u,
                        annotObject: g
                    } : {
                        annotName: g.getAnnotName(),
                        pageIndex: u
                    }, $(m).trigger(WebPDF.EventList.ANNOT_SELECTED, A));
                    var A = {
                        pageIndex: k.getPageIndex(),
                        annot: j.packageAnnot(g),
                        isSelect: b
                    };
                    c && (A = {
                        pageIndex: k.getPageIndex(),
                        annot: j.packageAnnot(g),
                        annotObject: g,
                        isSelect: b
                    }), $(m).trigger(WebPDF.EventList.ANNOT_ADDED, A)
                }
                return g
            }, this.deleteAnnot = function(a, b) {
                var c = k.getAnnotByName(a);
                if (!c) return !1;
                var d = m.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                return d ? c.isReply ? d.getAnnotHandlerMgr().deleteReplyAnnot(u, a, b, !0) : d.getAnnotHandlerMgr().deleteAnnot(this, a, b) : void 0
            }, this.getOffsetByAnnotRect = function(a) {
                g.normalize(a);
                var b = new d(a.left, a.top, a.right, a.bottom),
                    c = $("#" + l.getDocViewContainerID()),
                    e = c.height(),
                    f = c.width(),
                    h = (c.offset(), $("#" + this.getPageViewContainerID())),
                    i = l.getViewMode();
                switch (i) {
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING:
                        break;
                    case WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE:
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS:
                        var j = (h.offset(), this.pdfRectToDevice(b, !0)),
                            k = g.height(j),
                            m = g.width(j),
                            n = {
                                y: j.top,
                                x: j.left
                            },
                            o = l.getRotate(),
                            p = this.offsetToPageRotate(n, m, k, o);
                        j.top = p.top, j.left = p.left, k = p.height, m = p.width;
                        var q = e / 2,
                            r = f / 2,
                            s = $("div#docViewer_ViewContainer .fwrJspHorizontalBar").height();
                        0 > s && (s = 0);
                        var t = k / 2 + j.top;
                        t = q - t, t = -t;
                        var u = m / 2 + j.left;
                        return u = r - u, u = -u, {
                            x: u,
                            y: t
                        }
                }
                return null
            }, this.addAnnotRecord = function(a, b) {
                var c = "[" + a.getRect().left + " " + a.getRect().top + " " + a.getRect().right + " " + a.getRect().bottom + "]",
                    d = '{"Type":"' + a.getSubType() + '", "ActionType":"' + b + '", "PageIndex":"' + u + '", "Rect":"' + c + '"}';
                m.addRecord("Comment", "Comment", d)
            }, this.isAnnotExist = function(a, b) {
                var c = !1;
                return k.enumAnnots(function(d) {
                    return "Link" != d.getType() && (b && "Markup" === d.getType() ? c = j(d, a, b) : d.getAnnotName() !== a || d.isAnnotDel() || (c = !0)), !c
                }), c
            }
        }, WebPDF.PDFView.PDFPageView
    }), define("core/Framework/View/PDFView", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.PDFView = {}
    }), define("core/Plugins/Annot/DrawingAnnot/DrawingUtils", [], function(a, b, c) {
        function d(a, b, c, d, e) {}

        function e(a, b, c, d, e) {}

        function f(a, b, c, d, e) {
            i(a, b, c, Math.PI + d, e)
        }

        function g(a, b, c, d, e) {
            h(a, b, c, Math.PI + d, e)
        }

        function h(a, b, c, d, e) {
            var f = e.arrowLength || 14,
                g = Math.PI / 6,
                h = Math.PI - d - g,
                i = f * Math.cos(h),
                k = f * Math.sin(h),
                l = new p(b - i, c + k),
                m = g - d,
                n = f * Math.cos(m),
                o = f * Math.sin(m),
                q = new p(b + n, c - o);
            a.save(), j(a, new p(b, c), l, q, e), e.fillColor && (a.fillStyle = e.fillColor, a.fill()), a.restore()
        }

        function i(a, b, c, d, e) {
            var f = e.arrowLength || 14,
                g = Math.PI / 6,
                h = Math.PI - d - g,
                i = f * Math.cos(h),
                j = f * Math.sin(h),
                l = k(new p(b - i, c + j)),
                n = g - d,
                o = f * Math.cos(n),
                q = f * Math.sin(n),
                r = k(new p(b + o, c - q));
            b = Math.floor(b) + .5, c = Math.floor(c) + .5, a.save(), a.strokeStyle = e.borderColor, a.lineWidth = e.borderWidth, m(a, e.borderStyle, e.dashArray), a.moveTo(b, c), a.lineTo(l.x, l.y), a.moveTo(b, c), a.lineTo(r.x, r.y), a.stroke(), a.restore()
        }

        function j(a, b, c, d, e) {
            a.save(), a.strokeStyle = e.borderColor, a.lineWidth = e.borderWidth, m(a, e.borderStyle, e.dashArray), a.beginPath(), a.moveTo(b.x, b.y), a.lineTo(c.x, c.y), a.lineTo(d.x, d.y), a.closePath(), a.stroke(), e.filled && (a.fillStyle = e.fillColor || e.borderColor, a.fill()), a.restore()
        }

        function k(a) {
            return a.x = Math.floor(a.x) + .5, a.y = Math.floor(a.y) + .5, a
        }

        function l(a, b, c) {
            return b + a > c && (b = c - a), b
        }

        function m(a, b, c) {
            return $.support.setLineDash && b ? b === WebPDF.Annot.BorderStyle.BBS_SOLID ? void a.setLineDash([]) : void(b === WebPDF.Annot.BorderStyle.BBS_DASH && (c = c ? c : [], a.setLineDash(c))) : void 0
        }

        function n(a, b) {
            b && (a.fillStyle = b, a.fill())
        }
        var o = .5522847498308,
            p = WebPDF.PDFPoint,
            q = {
                getLineStyleStratety: function(a) {
                    var b = WebPDF.Annot.LineStyle,
                        c = {};
                    return c[b.OpenArrow] = i, c[b.ClosedArrow] = h, c[b.ROpenArrow] = f, c[b.RClosedArrow] = g, c[b.Circle] = d, c[b.Square] = e, c[a]
                },
                adjust: function(a, b, c) {
                    var d = c ? c : 1,
                        e = b.getBorderWidth() * a.getScale() * d,
                        f = 0;
                    return ($.isFunction(b.getStartStyle) && b.getStartStyle() != WebPDF.Annot.LineStyle.None || $.isFunction(b.getEndStyle) && b.getEndStyle() != WebPDF.Annot.LineStyle.None) && (f = 5 * a.getScale() + Math.ceil(.5 * e)), f
                },
                drawLineArrow: function(a, b, c, d, e, f) {
                    return this.drawLine(a, b, c, d, e, f), this.drawArrow(a, b, c, d, e, f)
                },
                drawLine: function(a, b, c, d, e, f) {
                    a.strokeStyle = f.borderColor, a.lineWidth = f.borderWidth, m(a, f.borderStyle, f.dashArray), a.beginPath(), a.moveTo(b, c), a.lineTo(d, e), n(a, f.fillColor), a.stroke()
                },
                drawArrow: function(a, b, c, d, e, f) {
                    var g = WebPDF.Annot.LineStyle;
                    a.strokeStyle = f.borderColor, a.lineWidth = f.borderWidth, m(a, f.borderStyle, f.dashArray);
                    var h = Math.atan2(e - c, d - b);
                    f.startStyle && f.startStyle !== g.None && this._drawArrow(a, b, c, h, f, f.startStyle), f.endStyle && f.endStyle !== g.None && this._drawArrow(a, d, e, Math.PI + h, f, f.endStyle)
                },
                _drawArrow: function(a, b, c, d, e, f) {
                    var g = this.getLineStyleStratety(f);
                    g ? (a.save(), g(a, b, c, d, e), a.restore()) : console.warn("unsupported arrow style: ", f)
                },
                drawCircle: function(a, b, c, d, e, f) {
                    a.strokeStyle = f.borderColor, a.lineWidth = f.borderWidth, m(a, f.borderStyle, f.dashArray);
                    var g = (b + d) / 2,
                        h = (c + e) / 2,
                        i = d - b,
                        j = e - c;
                    i = l(f.borderWidth, i, a.canvas.width), j = l(f.borderWidth, j, a.canvas.height);
                    var k = Math.abs(i) / 2,
                        p = Math.abs(j) / 2,
                        q = o,
                        r = k * q,
                        s = p * q;
                    a.beginPath(), a.moveTo(g - k, h), a.bezierCurveTo(g - k, h - s, g - r, h - p, g, h - p), a.bezierCurveTo(g + r, h - p, g + k, h - s, g + k, h), a.bezierCurveTo(g + k, h + s, g + r, h + p, g, h + p), a.bezierCurveTo(g - r, h + p, g - k, h + s, g - k, h), a.closePath(), n(a, f.fillColor), a.stroke()
                },
                drawSquare: function(a, b, c, d, e, f) {
                    a.strokeStyle = f.borderColor, a.lineWidth = f.borderWidth;
                    var g = a.canvas.width,
                        h = a.canvas.height,
                        i = d - b,
                        j = e - c;
                    i = l(f.borderWidth, i, g), j = l(f.borderWidth, j, h), m(a, f.borderStyle, f.dashArray), f.fillColor && (a.fillStyle = f.fillColor, a.fillRect(b, c, i, j)), a.strokeRect(b, c, i, j)
                },
                drawSquiggly: function(a, b, c, d) {
                    a.fillStyle = d.fillStyle, a.strokeStyle = d.strokeStyle, a.lineWidth = d.lineWidth, a.beginPath(), a.moveTo(0, 0);
                    var e = 1;
                    if (c = Number(c), b = Number(b), c > b)
                        for (; c >= e * b;) a.lineTo(b, e * b), e++, a.lineTo(0, e * b), e++;
                    else
                        for (; b >= e * c;) a.lineTo(e * c, c), e++, a.lineTo(e * c, 0), e++;
                    a.stroke(), a.fill(), a.closePath()
                },
                drawArc: function(a, b, c, d) {
                    a.beginPath(), a.arc(b, c, d, 0, 2 * Math.PI), a.fill(), a.stroke()
                },
                drawRect: function(a, b, c, d, e) {
                    a.beginPath(), a.fillStyle = "#55AAAA", a.rect(b, c, d, e), a.fill()
                },
                getRectPolygonList: function(a, b) {
                    var c, d, e, f;
                    b.getScale();
                    if (a.length > 0)
                        for (var g = 0; g < a.length; g++) null == c && (c = a[g][0]), c > a[g][0] && (c = a[g][0]), null == d && (d = a[g][1]), d > a[g][1] && (d = a[g][1]), null == e && (e = a[g][0]), e < a[g][0] && (e = a[g][0]), null == f && (f = a[g][1]), f < a[g][1] && (f = a[g][1]);
                    return [c, d, e, f]
                },
                copyPolygonList: function(a) {
                    var b = [];
                    if (a.length > 0)
                        for (var c = 0; c < a.length; c++) {
                            var d = [];
                            d[0] = a[c][0], d[1] = a[c][1], b.push(d)
                        }
                    return b
                },
                drawPolygonArc: function(a, b) {
                    if (b.save(), b.lineWidth = 1, b.fillStyle = "#ffff00", a.length > 0)
                        for (var c = 0; c < a.length; c++) {
                            var d = a[c];
                            q.drawArc(b, d[0], d[1], WebPDF.Config.defaults.drawingSelectSize - 1)
                        }
                    b.restore()
                },
                drawPolygonControlRect: function(a, b) {
                    if (b.save(), a.length > 0)
                        for (var c = 0; c < a.length; c++) {
                            var d = a[c];
                            q.drawRect(b, d[0] - WebPDF.Config.defaults.drawingSelectSize / 2, d[1] - WebPDF.Config.defaults.drawingSelectSize / 2, WebPDF.Config.defaults.drawingSelectSize, WebPDF.Config.defaults.drawingSelectSize)
                        }
                    b.restore()
                },
                drawPolygonListLine: function(a, b, c, d) {
                    if (a && a.length > 0) {
                        b.save(), b.strokeStyle = c.borderColor, b.lineWidth = c.borderWidth, m(b, c.borderStyle, c.dashArray), b.beginPath();
                        var e = a[0];
                        b.moveTo(e[0], e[1]), a.slice(1).forEach(function(a) {
                            b.lineTo(a[0], a[1]), d || b.stroke()
                        }), d && (b.lineTo(e[0], e[1]), b.stroke(), b.closePath(), n(b, c.fillColor)), b.restore()
                    }
                },
                deviceRotate: function(a, b, c, d) {
                    var e = new WebPDF.PDFPoint(a.x, a.y),
                        f = $(c).offset(),
                        g = $("#" + d.getPageViewContainerID()).offset(),
                        h = g.left - f.left;
                    return 270 == b ? (e.x = d.getPageViewHeight() - a.y, e.y = a.x) : 90 == b ? (e.x = a.y, e.y = d.getPageViewWidth() + 2 * h - a.x) : 180 == b && (e.x = d.getPageViewWidth() + 2 * h - a.x,
                        e.y = d.getPageViewHeight() - a.y), e
                },
                drawPolygonListCloud: function(a, b, c) {
                    b.strokeStyle = c.borderColor, b.lineWidth = c.borderWidth, c.opacity && (b.globalAlpha = c.opacity), m(b, c.borderStyle, c.dashArray), b.beginPath(), b.moveTo(a[0][0], a[0][1]);
                    for (var d = 1; d < a.length; d++) b.bezierCurveTo(a[d][0], a[d][1], a[d][2], a[d][3], a[d][4], a[d][5]);
                    b.closePath(), n(b, c.fillColor), b.stroke()
                },
                drawCloud: function(a, b, c, d, e, f) {
                    a.beginPath();
                    for (var g = Math.sqrt((b - d) * (b - d) + (c - e) * (c - e)), h = b > d ? b : d, i = c > e ? c : e, j = 0; g / 10 - 1 > j; j++) h -= Math.abs(b - d) / (g / 10 - 1), i -= Math.abs(c - e) / (g / 10 - 1), a.arc(h, i, g / (2 * (g / 10 - 1)), 0, Math.PI, 1);
                    a.strokeStyle = "red", a.lineWidth = 1, a.stroke(), a.closePath()
                },
                drawCaret: function(a, b, c) {
                    a.fillStyle = c.fillStyle, a.strokeStyle = c.strokeStyle, a.lineWidth = c.lineWidth, a.beginPath(), a.moveTo(b[0].x, b[0].y);
                    for (var d = 1; d < b.length; d++) a.lineTo(b[d].x, b[d].y);
                    a.stroke(), a.closePath()
                }
            };
        return q
    }), define("core/Framework/View/LayoutInfo", ["core/Framework/View/PDFView", "core/WebPDF"], function(a, b, c) {
        return a("core/Framework/View/PDFView"), WebPDF.PDFView.RD_ZMODE_NONE = 0, WebPDF.PDFView.RD_ZMODE_CUSTOM = 1, WebPDF.PDFView.RD_ZMODE_ACTUAL_SIZE = 2, WebPDF.PDFView.RD_ZMODE_FIT_PAGE = 3, WebPDF.PDFView.RD_ZMODE_FIT_WIDTH = 4, WebPDF.PDFView.RD_ZMODE_FIT_HEIGHT = 5, WebPDF.PDFView.RD_ZMODE_FIT_RECTANGLE = 6, WebPDF.PDFView.RD_ZMODE_FIT_VISIBLE = 7, WebPDF.PDFView.RD_BRMODE_CONTINUOUS = 0, WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING = 1, WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE = 2, WebPDF.PDFView.RD_ROTATE_POS_TOP = 0, WebPDF.PDFView.RD_ROTATE_POS_LEFT = 3, WebPDF.PDFView.RD_ROTATE_POS_BOTTOM = 2, WebPDF.PDFView.RD_ROTATE_POS_RIGHT = 1, WebPDF.PDFView.LayoutInfo = function() {
            this.rotateAngle = 0, this.zoomToMode = WebPDF.PDFView.RD_ZMODE_FIT_WIDTH, this.showMode = WebPDF.PDFView.RD_BRMODE_CONTINUOUS, this.facingCount = 1, this.isReplaceColor = !1, this.marginX = 0, this.marginY = 0, this.continuousPageSpace = 14, this.singlePageSpace = 2, this.isDispGrid = !1, this.isFacing = !1, this.isReversed = !1, this.scale = 1, this.maxScale = 2, this.minScale = .5, this.isCoverPage = !1, this.isShowAnnot = !1
        }, WebPDF.PDFView.LayoutInfo
    }), define("core/Framework/View/ProgressiveViewerGenerator", ["core/Framework/View/PDFView", "core/WebPDF"], function(a, b, c) {
        a("core/Framework/View/PDFView");
        var d = WebPDF.Config,
            e = function(a, b) {
                this.startIndex = a, this.endIndex = b
            };
        return WebPDF.PDFView.PageRange = e, WebPDF.PDFView.ProgressiveViewerGenerator = function(a, b) {
            function c(a) {
                for (var b = 0; b < k.length; b++) {
                    var c = k[b];
                    if (c.startIndex <= a && c.endIndex >= a) return !0
                }
                return !1
            }

            function f(a) {
                for (var b = -1, c = a, d = 0; d < k.length; d++) {
                    var e = k[d],
                        f = a - e.endIndex;
                    f > 0 && c > f && (c = f, b = e.endIndex)
                }
                return b
            }

            function g(a) {
                var b = d.defaults.maxNewPagesPerTime; - 1 === b && (b = i.getPageCount());
                var c = parseInt(a / b) * b;
                return new e(c, c + b - 1)
            }

            function h(a) {
                if (a) {
                    var b = i.getScale();
                    if (i.getScale() == WebPDF.ZOOM_FIT_PAGE) {
                        var c = i.getDocViewHeight(),
                            d = i.getDocViewWidth(),
                            e = a.getPDFPageWidth() * WebPDF.Common.getPixelsPerPoint(),
                            f = a.getPDFPageHeight() * WebPDF.Common.getPixelsPerPoint();
                        if (i.getRotate() % 180 != 0) {
                            var g = e;
                            e = f, f = g
                        }
                        var h = d / e,
                            j = c / f;
                        b = h > j ? j : h
                    }
                    a.setScale(b)
                }
            }
            var i = a,
                j = b,
                k = [],
                l = this;
            this.isContentCreatedPageCountUpdate = !1, this.getContentCreatedPageIndexList = function() {
                for (var a = 0, b = [], c = i.getPageCount(), d = 0; c > d; d++) i.getPageView(d).isContentCreated() && (b[a] = d, a++);
                return b
            }, this.getContentCreatedPageCount = function() {
                var a = l.getContentCreatedPageIndexList();
                return a.length
            }, this.createPages = function(a) {
                var b = i.getPageCount();
                if (0 > a || a >= b) return !1;
                if (c(a)) return !1;
                var d = g(a);
                d.startIndex < 0 && (d.startIndex = 0), d.endIndex >= b && (d.endIndex = b - 1);
                var e = f(d.startIndex);
                k.push(d);
                for (var j = i.createPagesView(d.startIndex, d.endIndex, e), m = d.startIndex; m <= d.endIndex; m++) h(i.getPageView(m));
                if (i.getRotate % 180 == 0) return j;
                l.isContentCreatedPageCountUpdate = !0;
                for (var m = 0; b > m; m++) {
                    var n = i.getPageView(m);
                    n.isContentCreated() && n.updateDimension()
                }
                return j
            }, this.updateAdjacentPageContent = function() {
                var a = !1,
                    b = i.getVisiblePageRange(),
                    c = b.end,
                    d = b.begin,
                    e = i.getPageCount(),
                    f = i.getScrollApi();
                if (f) {
                    if (d >= 1 && !i.getPageView(d - 1).isContentCreated() && (a = l.createPages(d - 1)), e - 1 > c && !i.getPageView(c + 1).isContentCreated() && (a |= l.createPages(c + 1)), a) {
                        var g = f.getContentPositionX();
                        f.scrollToX(g)
                    }
                    return a
                }
            }, this.createAdjacentPage = function(a, b) {
                var c = i.getPageCount(),
                    d = l.countVisiblePageRange(),
                    e = d.end,
                    f = d.begin,
                    g = i.getScrollApi();
                if (g) {
                    var h = !1;
                    if (f >= 1 && !i.getPageView(f - 1).isContentCreated() && (h = l.createPages(f - 1)), c - 1 > e && !i.getPageView(e + 1).isContentCreated() && (h |= l.createPages(e + 1)), h) {
                        var j = g.getContentPositionX();
                        d = l.countVisiblePageRange(), e = d.end, f = d.begin, l.progressiveUpdatePageDimension(a, f, e, b, !0, !1), i.reinitializeScrollBar();
                        var k = document.getElementById(i.getPageView(a).getPageViewContainerID()),
                            m = jQuery(k).position();
                        g.scrollToY(m.top + b), g.scrollToX(j), l.createAdjacentPage(a, b), i.reinitializeScrollBar();
                        var m = jQuery(k).position();
                        g.scrollToY(m.top + b), g.scrollToX(j)
                    }
                }
            }, this.progressiveUpdatePageDimension = function(a, b, c, e, f, g) {
                var h = i.getPageCount(),
                    j = !1,
                    k = d.defaults.maxResizePagesPerTime; - 1 === k && (k = i.getPageCount());
                var l = b - k > 0 ? b - k : 0,
                    m = c + k;
                m >= h && (m = h - 1);
                for (var n = null, o = l; m >= o; o++)
                    if (n = i.getPageView(o), n.isContentCreated() && !n.isDimensionUpdated()) {
                        var p = i.getScale();
                        if (i.getScale() == WebPDF.ZOOM_FIT_PAGE) {
                            var q = i.getDocViewHeight(),
                                r = i.getDocViewWidth(),
                                s = n.getPDFPageWidth() * WebPDF.Common.getPixelsPerPoint(),
                                t = n.getPDFPageHeight() * WebPDF.Common.getPixelsPerPoint();
                            if (i.getRotate() % 180 != 0) {
                                var u = s;
                                s = t, t = u
                            }
                            var v = r / s,
                                w = q / t;
                            p = v > w ? w : v
                        }
                        n.setScale(p), n.updateDimension(), n.setDimensionUpdated(!0), j = !0
                    }
                if (j && g) {
                    var x = i.getScrollApi();
                    if (x) {
                        var y = x.getContentPositionX();
                        n = i.getPageView(a);
                        var z = document.getElementById(n.getPageViewContainerID());
                        i.reinitializeScrollBar();
                        var A = jQuery(z).position();
                        x.scrollToY(A.top + e), f && x.scrollToX(y)
                    }
                    return !0
                }
                return !1
            }, this.countVisiblePageRange = function() {
                for (var a, b, c, d, e, f = {
                        begin: 0,
                        current: 0,
                        end: 1
                    }, g = l.getContentCreatedPageIndexList(), h = g.length, k = 0, m = h - 1, n = k + m >> 1, o = $("#" + j), p = o.height(), q = o.offset(); n > k;)
                    if (a = i.getPageView(g[n]), b = $("#" + a.getPageViewContainerID()), c = b.offset(), d = a.getPageViewHeight(), e = c.top, e <= q.top && e + d <= q.top) k = n + 1, n = k + m >> 1;
                    else {
                        if (!(e > q.top + p)) break;
                        m = n - 1, n = k + m >> 1
                    }
                f.begin = g[n], f.end = f.begin;
                var r;
                for (r = n; r >= 0; r--) {
                    if (a = i.getPageView(g[r]), b = $("#" + a.getPageViewContainerID()), c = b.offset(), d = a.getPageViewHeight(), e = c.top, !(e + d > q.top)) {
                        r == n && h - 1 > n && (n += 1, f.begin = g[n]);
                        break
                    }
                    f.begin = g[r]
                }
                for (f.current = f.begin, f.end = g[n], r = n + 1; h > r && (a = i.getPageView(g[r]), b = $("#" + a.getPageViewContainerID()), c = b.offset(), e = c.top, e < p + q.top); r++) f.end = g[r];
                for (r = f.begin; r <= f.end; r++) a = i.getPageView(r), a.isContentCreated() || (f.begin = r + 1);
                for (r = f.begin; r <= f.end; r++)
                    if (a = i.getPageView(r), a.isContentCreated() && (b = $("#" + a.getPageViewContainerID()), d = a.getPageViewHeight(), c = b.offset(), e = c.top, e >= q.top && e < q.top + p && e + d / 3 <= q.top + p || e <= q.top && e + d >= q.top + 2 * p / 3)) {
                        f.current = r;
                        break
                    }
                return f
            }
        }, WebPDF.PDFView.ProgressiveViewerGenerator
    }), define("core/Framework/View/PDFContinuousView", ["core/Framework/Config", "core/WebPDF"], function(a, b, c) {
        a("core/Framework/Config");
        var d = WebPDF.Config;
        return WebPDF.PDFView.PDFContinuousView = function(a, b, c) {
            var e = a,
                f = b,
                g = c,
                h = e.getScrollApi();
            this.getName = function() {
                return WebPDF.PDFView.RD_BRMODE_CONTINUOUS
            }, this.getPageSpace = function() {
                return f.getContinuousPageSpace()
            }, this.gotoPage = function(a, b, c, f) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof b && null != b && "undefined" != typeof e && null != e) {
                    e.unBindScrollEvent();
                    var i = e.getPageCount(),
                        j = d.defaults.maxNewPagesPerTime;
                    if (-1 === j && (j = i), (a + 1) % j === 0) g.createPages(a + 1), g.createPages(a);
                    else {
                        var k = a + 1;
                        k >= i && (k = i - 1), g.createPages(k)
                    }
                    var l = document.getElementById(e.getPageView(a).getPageViewContainerID());
                    g.progressiveUpdatePageDimension(a, b, b, f, !0, !0);
                    var m = jQuery(l).position();
                    h.scrollToY(m.top + f), h.scrollToX(c), g.createAdjacentPage(a, f), e.bindScrollEvent()
                }
            }, this.onZoom = function(a) {
                e.unBindScrollEvent();
                var b = document.getElementById(e.getPageView(a).getPageViewContainerID());
                h.scrollToElement(b, !0, !1), e.bindScrollEvent()
            }, this.onRotate = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof e && null != e) {
                    e.unBindScrollEvent();
                    var b = document.getElementById(e.getPageView(a).getPageViewContainerID());
                    h.scrollToElement(b, !0, !1), e.bindScrollEvent()
                }
            }, this.onSize = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof e && null != e) {
                    e.unBindScrollEvent();
                    var b = document.getElementById(e.getPageView(a).getPageViewContainerID());
                    h.scrollToElement(b, !0, !1), e.bindScrollEvent()
                }
            }, this.active = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof e && null != e) {
                    var b = $("#" + e.getDocViewContainerID()),
                        c = b.height(),
                        d = f.getPageViewOffsetDocView(a),
                        g = d.y,
                        h = e.getPageCount(),
                        i = document.getElementById(e.getPageView(a).getPageViewContainerID()),
                        j = e.getPageDomElmHeight(a);
                    if (f.changePagesStyle(), c > j && ($(i).css({
                            "margin-bottom": "",
                            "margin-top": ""
                        }), g = 0), a == h - 1 && a > 0) {
                        var k = document.getElementById(e.getPageView(a - 1).getPageViewContainerID());
                        $(k).css({
                            "margin-bottom": "",
                            "margin-top": ""
                        })
                    }
                    e.gotoPage(a, 0, g)
                }
            }, this.onPageScroll = function(a, b) {}, this.movePage = function(a, b, c) {
                "undefined" != typeof a && null != a && "undefined" != typeof e && null != e && null != h && h.scrollBy(b, c)
            }
        }, WebPDF.PDFView.PDFContinuousView
    }), define("core/Framework/View/PDFSinglePageView", ["core/Framework/Config", "core/WebPDF"], function(a, b, c) {
        a("core/Framework/Config");
        var d = WebPDF.Config;
        return WebPDF.PDFView.PDFSinglePageView = function(a, b, c) {
            function e(a, b) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof f && null != f) {
                    b = b ? b : f.getVisiblePageRange();
                    var c = f.getPageCount(),
                        d = g.getRotate(),
                        e = document.getElementById(f.getPageView(a).getPageViewContainerID());
                    if (null != e) {
                        f.unBindScrollEvent(), g.clearPagesSingleStyle(b);
                        var h = {
                            begin: a,
                            end: a
                        };
                        f.notifyPageVisibleStatus(b, h);
                        var j = $("#" + f.getDocViewContainerID()),
                            k = j.height(),
                            l = f.getPageDomElmHeight(a);
                        if (k > l) {
                            var m = (k - $(e).height()) / 2;
                            if ((90 == d || 270 == d) && (m = (k - $(e).width()) / 2, a == c - 1 && 0 != a)) {
                                var n = document.getElementById(f.getPageView(a - 1).getPageViewContainerID()),
                                    o = g.getPageViewOffsetDocView(a - 1),
                                    p = $(n).width(),
                                    q = p - o.y;
                                if (0 != q) {
                                    i.scrollToElement(e, !0, !1);
                                    var r = g.getPageViewOffsetDocView(a);
                                    g.setSinglePageStyle(a - 1, null, r.y)
                                }
                            }
                            g.setSinglePageStyle(a, m, m), f.reinitializeScrollBar(null, 2 * m)
                        }
                        f.reinitializeScrollBar(), f.bindScrollEvent()
                    }
                }
            }
            var f = a,
                g = b,
                h = c,
                i = f.getScrollApi();
            this.getName = function() {
                return WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE
            }, this.getPageSpace = function() {
                return g.getSinglePageSpace()
            }, this.gotoPage = function(a, b, c, g) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof b && null != b && "undefined" != typeof f && null != f) {
                    f.unBindScrollEvent();
                    var j = f.getPageCount(),
                        k = d.defaults.maxNewPagesPerTime;
                    if (-1 === k && (k = j), (a + 1) % k === 0) h.createPages(a + 1), h.createPages(a);
                    else {
                        var l = a + 1;
                        l >= j && (l = j - 1), h.createPages(l)
                    }
                    var m = document.getElementById(f.getPageView(a).getPageViewContainerID());
                    h.progressiveUpdatePageDimension(a, b, b, g, !0, !0), e(a), f.unBindScrollEvent();
                    var n = $("#" + f.getDocViewContainerID()),
                        o = n.height(),
                        p = f.getPageDomElmHeight(a);
                    o > p ? g = 0 : o > p - g ? g = p - o : 0 > g && (g = 0);
                    var q = jQuery(m).position();
                    i.scrollToY(q.top + g), i.scrollToX(c), h.createAdjacentPage(a, g), f.bindScrollEvent()
                }
            }, this.onZoom = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof f && null != f) {
                    e(a), f.unBindScrollEvent();
                    var b = document.getElementById(f.getPageView(a).getPageViewContainerID());
                    i.scrollToElement(b, !0, !1), f.bindScrollEvent()
                }
            }, this.onRotate = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof f && null != f) {
                    e(a), f.unBindScrollEvent();
                    var b = document.getElementById(f.getPageView(a).getPageViewContainerID());
                    i.scrollToElement(b, !0, !1), f.bindScrollEvent()
                }
            }, this.onSize = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof f && null != f) {
                    e(a), f.unBindScrollEvent();
                    var b = document.getElementById(f.getPageView(a).getPageViewContainerID());
                    i.scrollToElement(b, !0, !1), f.bindScrollEvent()
                }
            }, this.active = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof f && null != f) {
                    var b = $("#" + f.getDocViewContainerID()),
                        c = b.height(),
                        d = g.getPageViewOffsetDocView(a),
                        h = d.y,
                        i = f.getPageDomElmHeight(a);
                    g.changePagesStyle(), c > i && (e(a), h = 0), f.gotoPage(a, 0, h)
                }
            }, this.onPageScroll = function(a, b) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof f && null != f) {
                    f.unBindScrollEvent();
                    var c = f.getVisiblePageRange(),
                        d = f.getVisiblePageRange();
                    d.end, d.begin, f.getPageCount();
                    if (i) {
                        var g = 0,
                            h = 0,
                            j = f.countVisiblePageRange(),
                            k = $("#" + f.getDocViewContainerID()),
                            l = k.height(),
                            m = null,
                            n = 0;
                        if (j.end != j.begin)
                            if (c.begin == c.end) c.begin == j.begin ? (g = j.end, m = document.getElementById(f.getPageView(g).getPageViewContainerID())) : (g = j.begin, m = document.getElementById(f.getPageView(g).getPageViewContainerID()), n = f.getPageDomElmHeight(g), n > l && (h = n - l - 1));
                            else {
                                var o = b;
                                "undefined" == typeof b && (o = c.begin == j.end || c.end == j.end), o ? (g = j.begin, m = document.getElementById(f.getPageView(g).getPageViewContainerID()), n = f.getPageDomElmHeight(g), n > l && (h = n - l - 1)) : (g = j.end, m = document.getElementById(f.getPageView(g).getPageViewContainerID()))
                            }
                        else {
                            g = j.end;
                            var p = f.getPageDomElmHeight(g);
                            l > p && (m = document.getElementById(f.getPageView(g).getPageViewContainerID()))
                        }
                        if (null != m) {
                            e(g, c), f.unBindScrollEvent();
                            var q = jQuery(m).position();
                            i.scrollToY(q.top + h)
                        }
                    }
                    f.bindScrollEvent()
                }
            }, this.movePage = function(a, b, c) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof f && null != f) {
                    var d = !0,
                        e = f.getPageDomElmHeight(a),
                        h = $("#" + f.getDocViewContainerID()),
                        j = h.height(),
                        k = g.getPageViewOffsetDocView(a),
                        l = k.y;
                    j > e ? d = !1 : c > 0 ? l + c + j > e - 1 && (c = e - l - j, d = !1) : 0 > l + c && (d = !1), null != i && d && i.scrollBy(b, c)
                }
            }
        }, WebPDF.PDFView.PDFSinglePageView
    }), define("core/Framework/View/PDFFacingPageView", ["core/Framework/Config", "core/WebPDF"], function(a, b, c) {
        a("core/Framework/Config");
        var d = WebPDF.Config;
        return WebPDF.PDFView.PDFFacingPageView = function(a, b, c) {
            var e = a,
                f = b,
                g = c,
                h = e.getScrollApi();
            this.getName = function() {
                return WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING
            }, this.getPageSpace = function() {
                return f.getContinuousPageSpace()
            }, this.gotoPage = function(a, b, c, f) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof b && null != b && "undefined" != typeof e && null != e) {
                    e.unBindScrollEvent();
                    var i = e.getPageCount(),
                        j = d.defaults.maxNewPagesPerTime;
                    if (-1 === j && (j = i), (a + 1) % j === 0) g.createPages(a + 1), g.createPages(a);
                    else {
                        var k = a + 1;
                        k >= i && (k = i - 1), g.createPages(k)
                    }
                    var l = document.getElementById(e.getPageView(a).getPageViewContainerID());
                    g.progressiveUpdatePageDimension(a, b, b, f, !0, !0);
                    var m = jQuery(l).position();
                    h.scrollToY(m.top + f), h.scrollToX(c), g.createAdjacentPage(a, f), e.bindScrollEvent()
                }
            }, this.onZoom = function(a) {
                e.unBindScrollEvent();
                var b = document.getElementById(e.getPageView(a).getPageViewContainerID());
                h.scrollToElement(b, !0, !1), e.bindScrollEvent()
            }, this.onRotate = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof e && null != e) {
                    e.unBindScrollEvent();
                    var b = document.getElementById(e.getPageView(a).getPageViewContainerID());
                    h.scrollToElement(b, !0, !1), e.bindScrollEvent()
                }
            }, this.onSize = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof e && null != e) {
                    e.unBindScrollEvent();
                    var b = document.getElementById(e.getPageView(a).getPageViewContainerID());
                    h.scrollToElement(b, !0, !1), e.bindScrollEvent()
                }
            }, this.active = function(a) {
                if ("undefined" != typeof a && null != a && "undefined" != typeof e && null != e) {
                    var b = $("#" + e.getDocViewContainerID()),
                        c = b.height(),
                        d = f.getPageViewOffsetDocView(a),
                        g = d.y,
                        h = e.getPageCount(),
                        i = document.getElementById(e.getPageView(a).getPageViewContainerID()),
                        j = e.getPageDomElmHeight(a);
                    if (f.changePagesStyle(), c > j && ($(i).css({
                            "margin-bottom": "",
                            "margin-top": ""
                        }), g = 0), a == h - 1 && a > 0) {
                        var k = document.getElementById(e.getPageView(a - 1).getPageViewContainerID());
                        $(k).css({
                            "margin-bottom": "",
                            "margin-top": ""
                        })
                    }
                    e.gotoPage(a, 0, g)
                }
            }, this.onPageScroll = function(a, b) {}, this.movePage = function(a, b, c) {
                "undefined" != typeof a && null != a && "undefined" != typeof e && null != e && null != h && h.scrollBy(b, c)
            }
        }, WebPDF.PDFView.PDFFacingPageView
    }), define("core/Common/ServerService", ["core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters"], function(a, b, c) {
        function d() {
            z()
        }

        function e(a, b, c, d, e) {
            var f = !0,
                g = c;
            "function" != typeof e && (e = function() {});
            for (var h = c; d >= h; h++) {
                if (!E.isParsed(a, h)) {
                    f = !1;
                    break
                }
                try {
                    e(h, a, b)
                } catch (j) {
                    console.error(j)
                }
                g = h
            }
            return f ? B.resolve(!0) : i(a, b, g, d, e)
        }

        function f(a, b, c) {
            var d = {
                startpage: b,
                endpage: c + 1,
                zooms: ["-1", "100"].join(","),
                tileRender: !1,
                tileSize: 400
            };
            return x(a, d)
        }

        function g(a, b) {
            a.docid && (this.docid = a.docid, this.uuid = a.uuid), this.taskId = a.taskId, this.pageCount = b
        }

        function h() {
            this.caches = {}
        }

        function i(a, b, c, d, e) {
            var f = {
                startpage: c,
                endpage: d + 1,
                zooms: ["-1", "100"].join(","),
                tileRender: !1,
                tileSize: 400
            };
            return x(a, b, f).then(function(f) {
                var g = f.taskid;
                return j(a, b, g, c, d, e)
            })
        }

        function j(a, b, c, d, e, f) {
            return m(c).then(function(c) {
                var h = l(a, c, d, e);
                return h === !0 ? (k(d, e, f, a, b), new g(c, c.pcount)) : (k(d, h.startpage - 1, f, a, b), new B(function(d) {
                    setTimeout(function() {
                        d(j(a, b, c.taskId, h.startpage, h.endpage, f))
                    }, 5e3)
                }))
            })
        }

        function k(a, b, c, d, e) {
            for (var f = a; b >= f; f++) try {
                c(f, d, e)
            } catch (g) {
                console.error(g)
            }
        }

        function l(a, b, c, d) {
            if (b.prange) {
                var e = b.pcount,
                    f = b.prange;
                f.forEach(function(b) {
                    for (var c = b.start; c <= b.end; c++) E.setParsed(a, c)
                });
                for (var g = c, h = d, i = c; d >= i && E.isParsed(a, i); i++) g++;
                return g > h || h >= e ? !0 : {
                    startpage: g,
                    endpage: h
                }
            }
            if ("0" === b.result) {
                for (var i = c; d >= i; i++) E.setParsed(a, i);
                return !0
            }
            return {
                startpage: c,
                endpage: d
            }
        }

        function m(a) {
            return D.api(C.SERVER_TASK).request({
                pathVariables: {
                    taskId: a
                }
            }).then(function(b) {
                return "-1" === b.result ? B.reject(b) : b.ntaskid ? m(b.ntaskid) : (b.taskId = a, b)
            })
        }

        function n(a) {
            return r(a).then(function(a) {
                return {
                    docid: a.docid,
                    uuid: a.uuid,
                    taskId: a.taskId
                }
            })
        }

        function o(a) {
            return r(a)
        }

        function p(a) {
            return r(a)
        }

        function q(a) {
            return r(a)
        }

        function r(a) {
            return m(a).then(function(a) {
                return "0" === a.result ? a : new B(function(b) {
                    setTimeout(function() {
                        b(r(a.taskId))
                    }, 5e3)
                })
            })
        }

        function s(a, b) {
            return D.api(C.SERVER_PRETREAT).request({
                formdata: a,
                headers: b
            })
        }

        function t(a, b) {
            return D.api(C.SERVER_FLATTEN).request({
                formdata: a,
                headers: b
            })
        }

        function u(a, b) {
            return D.api(C.SERVER_SPLIT).request({
                formdata: a,
                headers: b
            })
        }

        function v(a, b, c) {
            return D.api(C.SERVER_UPLOAD).upload({
                files: [{
                    name: "file",
                    filename: b,
                    data: a,
                    type: "application/pdf"
                }],
                listeners: c
            })
        }

        function w(a, b, c) {
            return D.api(C.SERVER_INSERT_PAGES).request({
                pathVariables: {
                    uuid: a
                },
                formdata: b,
                headers: c
            })
        }

        function x(a, b, c) {
            return D.api(C.SERVER_PARSER_PARSE).request({
                pathVariables: {
                    docid: a
                },
                formdata: c,
                headers: {
                    uuid: b
                }
            })
        }

        function y(a) {
            return D.api(C.SERVER_GET_DOCID).request({
                pathVariables: {
                    uuid: a
                }
            }).then(function(a) {
                return a.docid
            })
        }

        function z() {
            D.configure({
                apis: C.all,
                basePath: "",
                filters: {
                    responseSuccess: [A]
                }
            })
        }

        function A(a, b) {
            return a.resultBody ? b.next(a.resultBody) : b.next(a)
        }
        var B = window.Promise,
            C = a("core/Common/apis"),
            D = a("core/Common/ajax/index"),
            E = new h;
        window.ServerService = c.exports = new d, $.extend(d, {
            FLATTENFLAG_DISPLAY: 0,
            FLATTENFLAG_PRINT: 1,
            FLATTENFLAG_NOANNOT: 2,
            FLATTENFLAG_NOFORMCONTROL: 4
        }), $.extend(d.prototype, {
            pretreat: s,
            splitDocument: u,
            flattenPages: t,
            waitingForPretreatTaskComplete: n,
            waitingForInsertPageTaskComplete: o,
            waitingForFlattenTaskComplete: p,
            waitingForSplitTaskComplete: q,
            upload: v,
            insertPages: w,
            parse: x,
            fetchDocIdByFileUUID: y,
            parsePages: e,
            requestForParsePage: f
        }), $.extend(h.prototype, {
            getDocsCache: function(a) {
                return this.caches[a] = this.caches[a] || {}
            },
            setParsed: function(a, b) {
                var c = this.getDocsCache(a);
                c[b] = !0
            },
            isParsed: function(a, b) {
                var c = this.getDocsCache(a);
                return c[b]
            }
        })
    }), define("core/Common/apis", [], function(a, b, c) {
        var d = "pretreat",
            e = "task",
            f = "flatten",
            g = "split",
            h = "upload",
            i = "insert_pages",
            j = "parser_parse",
            k = "get_docid_by_file_uuid",
            l = {
                SERVER_PRETREAT: d,
                SERVER_TASK: e,
                SERVER_FLATTEN: f,
                SERVER_SPLIT: g,
                SERVER_UPLOAD: h,
                SERVER_INSERT_PAGES: i,
                SERVER_PARSER_PARSE: j,
                SERVER_GET_DOCID: k
            };
        l.all = {}, c.exports = l, l.all[h] = {
            method: "POST",
            path: "/api/v2/doc/upload"
        }, l.all[i] = {
            method: "POST",
            path: "/spi/v2/doc/${uuid}/insertPages",
            pathVariables: [{
                name: "uuid"
            }],
            formdata: [{
                name: "annotsData",
                required: !1,
                defaultValue: ""
            }, {
                name: "formData",
                required: !1,
                defaultValue: ""
            }, {
                name: "inkData",
                required: !1,
                defaultValue: ""
            }, {
                name: "insertDocid"
            }, {
                name: "insertPassword"
            }, {
                name: "fileName",
                required: !1,
                defaultValue: ""
            }, {
                name: "pageRanges"
            }, {
                name: "pageCount"
            }, {
                name: "insertPos"
            }, {
                name: "flag"
            }],
            headers: [{
                name: "x-auth-doc",
                required: !1
            }, {
                name: "x-auth-ckey",
                required: !1
            }]
        }, l.all[d] = {
            method: "POST",
            path: "/spi/v2/doc/pretreat",
            formdata: [{
                name: "filetype"
            }, {
                name: "fileuri"
            }, {
                name: "pdfcache",
                defaultValue: "true"
            }, {
                name: "tileRender",
                defaultValue: "false"
            }, {
                name: "zooms",
                defaultValue: "-1,100"
            }, {
                name: "callback",
                required: !1,
                defaultValue: ""
            }],
            headers: [{
                name: "x-auth-doc",
                required: !1
            }, {
                name: "x-auth-ckey",
                required: !1
            }]
        }, l.all[e] = {
            method: "GET",
            path: "/api/v2/task/${taskId}/query",
            pathVariables: [{
                name: "taskId"
            }],
            filters: {
                responseSuccess: function(a, b) {
                    function c(a) {
                        var b = a.indexOf("/"),
                            c = a.substring(0, b);
                        return c.split(",").map(function(a) {
                            var b = a.split("-");
                            return {
                                start: parseInt(b[0], 10),
                                end: parseInt(b[1], 10)
                            }
                        })
                    }
                    var d = a && a.resultBody;
                    if (d) {
                        var e = d.prange;
                        !e && d.record && (e = JSON.parse(d.record).prange), e && (d.prange = c(e))
                    }
                    return b.next(a)
                }
            }
        }, l.all[f] = {
            method: "POST",
            path: "/spi/v2/doc/flatten",
            formdata: [{
                name: "uuid"
            }, {
                name: "pageRanges"
            }, {
                name: "flag"
            }, {
                name: "annotsData",
                required: !1,
                defaultValue: ""
            }, {
                name: "inkSignData",
                required: !1,
                defaultValue: ""
            }, {
                name: "formData",
                required: !1,
                defaultValue: ""
            }],
            headers: [{
                name: "x-auth-doc",
                required: !1
            }, {
                name: "x-auth-ckey",
                required: !1
            }]
        }, l.all[g] = {
            method: "POST",
            path: "/spi/v2/doc/split",
            formdata: [{
                name: "uuid"
            }, {
                name: "pageRanges"
            }, {
                name: "annotsData",
                required: !1,
                defaultValue: ""
            }, {
                name: "inkSignData",
                required: !1,
                defaultValue: ""
            }, {
                name: "formData",
                required: !1,
                defaultValue: ""
            }],
            headers: [{
                name: "x-auth-doc",
                required: !1
            }, {
                name: "x-auth-ckey",
                required: !1
            }]
        }, l.all[j] = {
            method: "POST",
            path: "/api/v2/parser/${docid}/parse",
            pathVariables: [{
                name: "docid"
            }],
            formdata: [{
                name: "startpage"
            }, {
                name: "endpage"
            }, {
                name: "zooms"
            }, {
                name: "tileRender",
                defaultValue: "false"
            }, {
                name: "tileSize",
                defaultValue: 400
            }],
            headers: [{
                name: "uuid",
                required: !1
            }, {
                name: "x-auth-doc",
                required: !1
            }, {
                name: "x-auth-ckey",
                required: !1
            }]
        }, l.all[k] = {
            path: "/api/users/${uuid}/info",
            pathVariables: [{
                name: "uuid"
            }]
        }
    }), define("core/Common/ajax/index", ["core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters"], function(a, b, c) {
        function d(a, b) {
            var c = j[a];
            return c || (c = j[a] = new f(b)), c
        }

        function e(a, b, c) {
            this.endpoint(a, b).configure(c)
        }
        var f = a("core/Common/ajax/AjaxEndpoint"),
            g = a("core/Common/ajax/commonAjaxFilters"),
            h = location.protocol + "//" + location.host,
            i = new f(h),
            j = {
                "": i
            };
        i.configure({
            filters: g
        }), c.exports = i, $.extend(i, {
            endpoint: d,
            registerEndpoint: e
        })
    }), define("core/Common/ajax/AjaxEndpoint", ["core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors"], function(a, b, c) {
        function d(a, b) {
            this._server = a.replace(/(\/|\\)+$/, ""), this._basePath = b || "", this._requestFilters = [r, s], this._responseSuccessFilters = [], this._responseErrorFilters = [], this._apis = {}
        }

        function e() {
            var a = new d(this._server, this._basePath);
            return a._requestFilters = this._requestFilters.slice(0), a._responseSuccessFilters = this._responseSuccessFilters.slice(0), a._responseErrorFilters = this._responseErrorFilters.slice(0), a._apis = $.extend({}, this._apis), a
        }

        function f() {
            return this._requestFilters = w.concatArray(arguments, this._requestFilters), this
        }

        function g() {
            return this._responseSuccessFilters = w.concatArray(arguments, this._responseSuccessFilters), this
        }

        function h() {
            return this._responseErrorFilters = w.concatArray(arguments, this._responseErrorFilters), this
        }

        function i(a) {
            return a.request && this.appendRequestFilter.apply(this, a.request), a.responseError && this.appendResponseErrorFilter.apply(this, a.responseError), a.responseSuccess && this.appendResponseSuccessFilter.apply(this, a.responseSuccess), this
        }

        function j(a, b) {
            if (this._apis[a]) throw new Error("Duplicate api key: " + a);
            var c = o(b),
                d = b.path,
                e = b.url;
            if (!e && !d) throw new Error("path is " + e);
            e || (e = w.joinUrl(this._server, this._basePath, d));
            var f = b.method || "GET";
            return b.url = e, b.method = f, this._apis[a] = {
                url: e,
                method: f,
                filters: c,
                config: b
            }, this
        }

        function k(a) {
            a.basePath && (this._basePath = a.basePath);
            var b = a.filters;
            b && this.appendFilters(b);
            var c = a.apis;
            if (c)
                for (var d in c) this.register(d, c[d]);
            return this
        }

        function l(a) {
            var b = this._apis[a];
            if (!b) throw new Error('api "' + a + '" not been registered!');
            b.filters || (b.filters = {});
            var c = {
                request: w.concatArray([], b.filters.request),
                responseSuccess: w.concatArray([], b.filters.responseSuccess),
                responseError: w.concatArray([], b.filters.responseError)
            };
            return new v({
                url: b.url,
                filters: c,
                endpoint: this,
                config: b,
                method: b.method
            })
        }

        function m(a) {
            "string" == typeof a && (a = {
                url: a,
                method: "GET"
            });
            var b = $.extend({}, a),
                c = this.clone(),
                d = "uniq_" + Date.now().toString();
            return c.register(d, {
                url: b.url,
                path: b.path,
                method: b.method,
                filters: b.filters
            }), delete b.url, delete b.path, delete b.method, delete b.filters, c.api(d).request(b)
        }

        function n(a) {
            var b = this.clone(),
                c = "uniq_" + Date.now().toString();
            return b.register(c, {
                url: a.url,
                path: a.path,
                method: a.method,
                filters: a.filters
            }), b.api(c).upload({
                queries: a.queries,
                headers: a.headers,
                files: a.files,
                listeners: a.listeners
            })
        }

        function o(a) {
            var b = ["pathVariables", "queries", "headers", "formdata"],
                c = [],
                d = [],
                e = b.map(function(b) {
                    var c = a[b];
                    if (c instanceof Array) {
                        var d = c.map(function(a) {
                                return p(a, b)
                            }),
                            e = c.map(function(a) {
                                return q(a, b)
                            });
                        return w.concatArray(d, e)
                    }
                    return []
                }).reduce(function(a, b) {
                    return a.concat(b)
                }, []).filter(function(a) {
                    return null !== a
                });
            a.formdata && e.unshift(t);
            var f = a.filters;
            return f && (f.request && (e = w.concatArray(f.request, e)), f.responseError && (d = w.concatArray(f.request, d)), f.responseSuccess && (c = w.concatArray(f.responseSuccess, c))), {
                request: e,
                responseSuccess: c,
                responseError: d
            }
        }

        function p(a, b) {
            return function(c, d) {
                var e = c[b];
                e || (e = c[b] = {});
                var f, g = a.name;
                if (f = e instanceof window.FormData ? e.get(g) : e[g], a.required !== !1 && void 0 === f && void 0 === a.defaultValue) {
                    var h = "Required parameter '" + g + "' of " + b + " is missing and 'defaultValue' of ajax config is not defined.\nurl: " + c.ajaxConfig.url;
                    return d.error(new z(g, b, h))
                }
                return void 0 === f && (f = a.defaultValue), e instanceof window.FormData ? e.set(g, f) : e[g] = f, d.next(c)
            }
        }

        function q(a, b) {
            var c = a.valdiator;
            return "function" != typeof c ? null : function(d, e) {
                var f = d[b];
                f || (f = d[b] = {});
                var g, h = a.name;
                if (g = f instanceof window.FormData ? f.get(h) : f[h], !c.call(a, g, d)) {
                    var i = "Parameter '" + b + "." + h + "' validation failed: " + g + " \nurl: " + d.ajaxConfig.url;
                    throw new y(h, g, i)
                }
                return e.next(d)
            }
        }

        function r(a, b) {
            var c = a.pathVariables || {},
                d = a.ajaxConfig.pathVariables;
            d && d.forEach(function(a) {
                void 0 !== a.defaultValue && (c[a.name] = a.defaultValue)
            });
            var e = {};
            for (var f in c) {
                var g = c[f];
                try {
                    g = decodeURI(g)
                } catch (h) {}
                e[f] = encodeURI(g)
            }
            return a.pathVariables = e, a.url = u.parse(a.url)(e), b.next(a)
        }

        function s(a, b) {
            var c = a.queries || {},
                d = a.ajaxConfig.queries;
            return d && d.forEach(function(a) {
                var b = a.name;
                void 0 !== a.defaultValue && void 0 === c[b] && (c[b] = a.defaultValue)
            }), a.url = w.joinQueriesToUrl(a.url, c), b.next(a)
        }

        function t(a, b) {
            var c = a.json || a.payload;
            return c && ("string" == typeof c ? a.formdata = JSON.parse(c) : a.formdata = c, a.contentType = "application/json", delete a.json, delete a.payload), b.next(a)
        }
        a("core/Common/ajax/polyfill");
        var u = a("core/Common/ajax/template"),
            v = a("core/Common/ajax/Ajax"),
            w = a("core/Common/ajax/utils"),
            x = a("core/Common/ajax/errors"),
            y = x.ValidationError,
            z = x.RequiredParameterError;
        c.exports = d, $.extend(d.prototype, {
            clone: e,
            appendRequestFilter: f,
            appendResponseSuccessFilter: g,
            appendResponseErrorFilter: h,
            appendFilters: i,
            register: j,
            configure: k,
            api: l,
            request: m,
            upload: n
        })
    }), define("core/Common/ajax/polyfill", [], function() {
        function a(a) {
            a = a.slice(0);
            var b = 0;
            this.next = function() {
                var c = a[b],
                    d = b > a.length - 1;
                return b++, d && (b = 0), {
                    done: d,
                    value: c
                }
            }
        }
        if (window.FormData && !window.FormData.prototype.set) {
            var b = FormData.prototype.append;
            FormData.prototype.append = function(a, c, d) {
                var e = this._values || {};
                this._values = e;
                var f = {
                    value: c,
                    filename: d
                };
                return e[a] ? e[a].push(f) : e[a] = [f], b.apply(this, arguments)
            }, FormData.prototype.set = function(a, b, c) {
                var d = this._values || {};
                this._values = d;
                var e = {
                    value: b,
                    filename: c
                };
                d[a] = [e]
            }, FormData.prototype.get = function(a) {
                if (this._values) {
                    var b = this._values[a];
                    if (b) return b[0].value
                }
            }, FormData.prototype.getAll = function(a) {
                if (this._values) {
                    var b = this._values[a];
                    if (b) return b.map(function(a) {
                        return a.value
                    })
                }
                return []
            }, FormData.prototype.has = function(a) {
                return !(!this._values || !this._values[a])
            }, FormData.prototype.keys = function() {
                return new a(Object.keys(this._values || {}))
            }, FormData.prototype.entries = function() {
                if (this._values) {
                    var b = [];
                    for (var c in this._values) this._values[c].reduce(function(a, b) {
                        a.push([c, b.value])
                    }, b);
                    return new a(b)
                }
                return new a([])
            }, FormData.prototype["delete"] = function(a) {
                this._values && delete this._values[a]
            }, FormData.prototype.optimize = function() {
                var a = this._values,
                    b = new FormData;
                for (var c in a) {
                    var d = a[c];
                    for (var e in d) b.append(c, d[e].value, d[e].filename)
                }
                return b
            }
        } else FormData.prototype.optimize = function() {
            return this
        }
    }), define("core/Common/ajax/template", [], function(a, b) {
        "use strict";

        function c(a) {
            if ("string" != typeof a) return f.bind(null, []);
            var b = h[a];
            if (b) return f.bind(null, b);
            for (var c = [], i = 0;;) {
                var j = g.exec(a);
                if (null === j) break;
                var k = j[0],
                    l = j[1],
                    m = j.index;
                c.push(d.bind(null, a.slice(i, m))), c.push(e.bind(null, l)), i = m + k.length
            }
            return c.push(d.bind(null, a.slice(i))), h[a] = c, f.bind(null, c)
        }

        function d(a) {
            return a
        }

        function e(a, b) {
            return b[a]
        }

        function f(a, b) {
            return b || (b = {}), a.map(function(a) {
                return a(b)
            }).join("")
        }
        var g = /\$\{([^\}]+)\}/g;
        b.parse = c;
        var h = {}
    }), define("core/Common/ajax/Ajax", ["core/Common/ajax/polyfill", "core/Common/ajax/FilterChain", "core/Common/ajax/utils"], function(a, b, c) {
        function d(a) {
            this.url = a.url, this.filters = a.filters, this.endpoint = a.endpoint, this.method = a.method, this.config = a.config
        }

        function e() {
            var a = {
                request: p.concatArray([], this.filters.request),
                responseError: p.concatArray([], this.filters.responseError),
                responseSuccess: p.concatArray([], this.filters.responseSuccess)
            };
            return new d({
                url: this.url,
                filters: a,
                method: this.method,
                endpoint: this.endpoint,
                config: this.config
            })
        }

        function f(a) {
            function b(a, b) {
                return j(a, b)
            }
            a || (a = {});
            var c = g(this, a, b);
            return new o(c.filters.request, 0).start(c)
        }

        function g(a, b, c) {
            var d = $.extend({}, b),
                e = b.filters || {},
                f = p.concatArray(e.request, a.filters.request, a.endpoint._requestFilters, c),
                g = p.concatArray(e.responseError, a.filters.responseError, a.endpoint._responseErrorFilters),
                h = p.concatArray(e.responseSuccess, a.filters.responseSuccess, a.endpoint._responseSuccessFilters),
                i = {
                    request: f,
                    responseError: g,
                    responseSuccess: h
                };
            return $.extend(d, {
                ajaxConfig: a.config,
                url: a.url,
                filters: i,
                method: b.method || a.method,
                listeners: b.listeners || {}
            })
        }

        function h(a) {
            function b(a, b) {
                return b.finish(l(a))
            }
            a || (a = {});
            var c = g(this, a, [n, b]);
            $.extend(c, {
                method: a.method || this.method || "POST",
                processData: !1,
                contentType: !1
            });
            var d = c.filters.request;
            return new o(d, 0).start(c)
        }

        function i(a) {
            var b = this.clone();
            return b.filters.request = p.concatArray(a.request, b.filters.request), b.filters.responseSuccess = p.concatArray(a.responseSuccess, b.filters.responseSuccess), b.filters.responseError = p.concatArray(a.responseError, b.filters.responseError), b
        }

        function j(a) {
            switch (a.method) {
                case "POST":
                case "PUT":
                    return l(a);
                default:
                    return k(a)
            }
        }

        function k(a) {
            var b = a.filters,
                c = {
                    url: a.url,
                    type: a.method,
                    headers: a.headers,
                    contentType: a.contentType
                };
            return m(c, b)
        }

        function l(a) {
            function b(a, b) {
                return a.push(b), this
            }

            function c(a, b) {
                a.upload.addEventListener(b, function(a) {
                    var c = h[b];
                    c.forEach(function(c) {
                        c.call(k, a, b)
                    })
                })
            }
            var d, e, f = a.contentType,
                g = a.processData;
            a.formdata && (d = a.formdata, "string" == typeof f && f.toLowerCase().indexOf("json") > -1 && (d = JSON.stringify(d))), d instanceof window.FormData && (g = !1, d = d.optimize());
            var h = {
                    progress: [],
                    abort: [],
                    load: [],
                    error: [],
                    loadstart: [],
                    loadend: []
                },
                i = a.filters,
                j = {
                    url: a.url,
                    type: a.method,
                    xhr: function() {
                        var a = new window.XMLHttpRequest;
                        for (var b in h) c(a, b);
                        return a
                    },
                    headers: a.headers,
                    data: d,
                    dataType: e,
                    processData: g,
                    contentType: f
                },
                k = m(j, i);
            for (var l in h) k[l] = b.bind(k, h[l]), h[l] = p.concatArray(h[l], a.listeners[l]);
            return k
        }

        function m(a, b) {
            return new Promise(function(c, d) {
                function e(a) {
                    var e = b.responseError,
                        f = new o(e, 0).next(a);
                    f instanceof Promise ? c(f) : d(f)
                }
                $.ajax(a).then(function(a) {
                    var d = b.responseSuccess,
                        f = new o(d, 0).next(a);
                    f instanceof Promise ? f.then(null, e) : c(f)
                }, e)
            })
        }

        function n(a, b) {
            var c = new FormData;
            return a.files && a.files.forEach(function(a) {
                if (a instanceof window.File) c.append(a.filename, a);
                else {
                    var b = a.data,
                        d = a.filename || a.name;
                    "string" == typeof b && (b = new Blob([b], {
                        type: a.type || "text/plain"
                    })), p.isTypedArray(b) ? b = new Blob([b], {
                        type: a.type
                    }) : b instanceof window.ArrayBuffer ? b = new Blob([b], {
                        type: a.type
                    }) : b instanceof Blob || (b = new Blob([JSON.stringify(b)], {
                        type: a.type || "application/json"
                    })), c.append(a.name || b.name || d, b, d)
                }
            }, this), a.formdata = c, b.next(a)
        }
        a("core/Common/ajax/polyfill");
        var o = a("core/Common/ajax/FilterChain"),
            p = a("core/Common/ajax/utils");
        c.exports = d, $.extend(d.prototype, {
            clone: e,
            request: f,
            upload: h,
            filter: i
        })
    }), define("core/Common/ajax/FilterChain", [], function(a, b, c) {
        function d(a, b) {
            this.filters = a.slice(0), this.index = b
        }

        function e(a) {
            if (this.index >= this.filters.length) return this.finish(a);
            var b = this.filters[this.index],
                c = new d(this.filters, this.index + 1);
            return b(a, c)
        }

        function f(a) {
            return new d(this.filters, 0).start(a)
        }

        function g(a) {
            return this.next(a)
        }

        function h(a) {
            return Promise.reject(a)
        }

        function i(a) {
            return a
        }

        function j() {
            return d.TERMINAL_RESULT
        }
        c.exports = d, d.TERMINAL_RESULT = new Promise(function() {}), $.extend(d, {
            FINISH_FILTER: function(a, b) {
                return b.finish(a)
            }
        }), $.extend(d.prototype, {
            start: g,
            next: e,
            retry: f,
            error: h,
            finish: i,
            terminal: j
        })
    }), define("core/Common/ajax/utils", [], function(a, b) {
        "use strict";

        function c(a) {
            if (!a) return !1;
            switch (a.constructor) {
                case Uint8Array:
                case Uint16Array:
                case Uint32Array:
                case window.Uint8ClampedArray:
                case Int8Array:
                case Int16Array:
                case Int32Array:
                case Float32Array:
                case Float64Array:
                    return !0
            }
            return !1
        }

        function d() {
            return e(arguments).map(function(a) {
                return a + "" == "[object Arguments]" ? e(a) : a instanceof Array ? a : a ? [a] : []
            }).reduce(function(a, b) {
                return a.concat(b)
            }, [])
        }

        function e(a) {
            return Array.prototype.slice.call(a)
        }

        function f() {
            var a = e(arguments);
            return a.filter(function(a) {
                return !!a
            }).map(function(a) {
                return "string" != typeof a ? a.toString() : a
            }).map(function(a) {
                return a.match(/^https?:\/\/.*/) ? a : a.replace(h, "$1").replace(j, "/").replace(i, "")
            }).join("/")
        }

        function g(a, b) {
            var c = [];
            for (var d in b) {
                var e, f = b[d];
                try {
                    e = decodeURIComponent(f)
                } catch (g) {
                    e = f
                }
                var h = encodeURIComponent(e);
                c.push(d + "=" + h)
            }
            var i = c.join("&");
            if (-1 !== a.indexOf("?")) {
                var j = a[a.length - 1];
                a += -1 !== a.indexOf("&") && "&" === j ? i : "&" + i
            } else a += "?" + i;
            return a
        }
        var h = /^[\/\\]+(.*)/,
            i = /\/$/,
            j = /[\/\\]+/g;
        b.concatArray = d, b.joinUrl = f, b.joinQueriesToUrl = g, b.isTypedArray = c
    }), define("core/Common/ajax/errors", [], function(a, b, c) {
        function d(a, b, c) {
            return this.name = a, this.value = b, Error.call(this, c)
        }

        function e(a, b, c) {
            return this.name = a, this.type = b, Error.call(this, c)
        }

        function f(a) {
            this.constructor = a
        }
        c.exports = {
            ValidationError: d,
            RequiredParameterError: e
        }, f.prototype = Error.prototype, d.prototype = new f(d), e.prototype = new f(e)
    }), define("core/Common/ajax/commonAjaxFilters", ["core/Common/ajax/errors"], function(a, b, c) {
        function d(a) {
            WebPDF.Tool.readerApp ? WebPDF.alert(WebPDF.Tool.readerApp, "", a) : WebPDF.onReady(function() {
                d(a)
            })
        }
        a("core/Common/ajax/errors");
        c.exports = {
            request: [function(a, b) {
                return a.queries = $.extend(a.queries, {
                    r: Date.now()
                }), b.next(a)
            }, function(a, b) {
                var c = a.ajaxConfig;
                if (c.queries) {
                    var d = c.queries.find(function(a) {
                        return "language" === a.name
                    });
                    d && (a.queries.language || (a.queries.language = WebPDF.ViewerInstance.getLanguage()))
                }
                return b.next(a)
            }],
            responseError: [function(a, b) {
                if (!a.status || a.status < 400) return b.next(a);
                switch (a.status) {
                    case 401:
                        d(i18n.t("Common.UnauthorizedError"));
                        break;
                    case 403:
                        d(i18n.t("Common.ForbiddenError"));
                        break;
                    case 404:
                        d("程序错误！请检查URL配置。");
                        break;
                    case 0:
                    case -1:
                        d(i18n.t("Common.ConnectionError"));
                        break;
                    case 500:
                        d(i18n.t("Common.ServerError"));
                        break;
                    default:
                        d(i18n.t("Common.ServerError"))
                }
                return b.terminal()
            }]
        }
    }), define("core/Framework/View/SinglePageViewLayout", ["core/Framework/View/PDFView", "core/WebPDF", "core/Framework/View/LayoutInfo", "core/Common/Common", "core/Framework/Config"], function(a, b, c) {
        a("core/Framework/View/PDFView");
        var d = (a("core/Framework/View/LayoutInfo"), a("core/Common/Common"));
        a("core/Framework/Config");
        return WebPDF.PDFView.CSinglePageViewLayout = function(a, b, c) {
            function e() {
                var a = 1,
                    b = m.getPageCount();
                return o.isFacing && (a = o.facingCount <= b ? o.facingCount : b), a
            }

            function f() {
                var a = m.getMaxPageViewHeight(),
                    b = m.getMaxPageViewWidth();
                return h(b, a)
            }

            function g(a, b, c, d) {
                var e = m.getScrollApi(),
                    f = m.getDocViewWidth() - e.getScrollBarWidth() - 2 * a - c * (d - 1),
                    g = f / b;
                return g
            }

            function h(a, b) {
                var c = e();
                return k(o.marginX, o.marginY, a, b, m.getPageSpane(), c)
            }

            function i(a, b, c, d) {
                var e = b;
                switch (a) {
                    case WebPDF.PDFView.RD_ZMODE_CUSTOM:
                        e = b;
                        break;
                    case WebPDF.PDFView.RD_ZMODE_ACTUAL_SIZE:
                        e = 1;
                        break;
                    case WebPDF.PDFView.RD_ZMODE_FIT_PAGE:
                        e = f();
                        break;
                    case WebPDF.PDFView.RD_ZMODE_FIT_WIDTH:
                        e = p.getFitWidthScale();
                        break;
                    case WebPDF.PDFView.RD_ZMODE_FIT_HEIGHT:
                        e = p.getFitHeightScale();
                        break;
                    case WebPDF.PDFView.RD_ZMODE_FIT_RECTANGLE:
                        e = -1 >= d && -1 >= c ? b : h(d, c);
                        break;
                    case WebPDF.PDFView.RD_ZMODE_NONE:
                }
                return e = j(e), (0 == e || "NaN" == e) && (e = b), e
            }

            function j(a) {
                return a = .5 * parseInt((a + .2) / .5), a < o.minScale ? o.minScale : a > o.maxScale ? o.maxScale : a
            }

            function k(a, b, c, d, e, f) {
                var g = m.getDocViewWidth() - 2 * a - e * (f - 1),
                    h = g / c,
                    i = m.getDocViewHeight() - 2 * b,
                    j = i / d;
                return j > h ? h : j
            }

            function l(a) {
                o.dbScale = a, m.onZoom(o.dbScale)
            }
            var m = b,
                n = a,
                o = c,
                p = this;
            WebPDF.Environment.mobile ? o.marginX = 3 : o.marginX = 15;
            var q = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
            this.getFitWidthScale = function(a) {
                var b = e(),
                    c = m.getRotate() % 180 == 0 ? m.getMaxPageViewWidth(!a) : m.getMaxPageViewHeight(!a);
                return g(o.marginX, c, m.getPageSpane(), b)
            }, this.getFitPageScale = function(a) {
                var b = m.getRotate() % 180 == 0 ? m.getMaxPageViewHeight(!a) : m.getMaxPageViewWidth(!a),
                    c = m.getDocViewHeight() / b;
                return c
            }, this.calcFitPageScale = function(a) {
                var b = Math.ceil(m.getDocViewHeight()),
                    c = Math.ceil(m.getDocViewWidth()),
                    d = Math.ceil(pageView.getPDFPageWidth() * WebPDF.Common.getPixelsPerPoint()),
                    e = Math.ceil(pageView.getPDFPageHeight() * WebPDF.Common.getPixelsPerPoint()),
                    f = c / d,
                    g = b / e;
                scale = f > g ? g : f
            }, this.getFitHeightScale = function() {
                return 1
            }, this.setLayoutZoomToMode = function(a) {
                o.iZoomMode = a
            }, this.getLayoutZoomToMode = function() {
                return o.iZoomMode
            }, this.createDocViewHtml = function() {
                var a = "";
                switch (o.showMode) {
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS:
                    case WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE:
                        a = "<div id='" + m.getDocViewContainerID() + "' tabIndex='9999' class='fwr-pages scroll-pane' style='position:relative;width:" + m.getDocViewWidth() + "px;height:" + m.getDocViewHeight() + "px; overflow-y: auto;overflow-x: auto;'></div>";
                        break;
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING:
                        a = "<div id='" + m.getDocViewContainerID() + "'  tabIndex='9999' style='height:100%;' class='scroll-pane'><div id='" + m.getLeftDocContainerID() + "' class='' style='position:relative;top:0px;overflow:hidden;padding-top: 14px;float:left;margin-left: 5px;margin-right: 5px'></div><div id='" + m.getRightDocContainerID() + "' class='' style='margin-left:10px;position:relative;top:0px;overflow:hidden;padding-top: 14px;';margin-left: 5px></div></div>"
                }
                return a
            }, this.createPageViewHtml = function(a) {
                var b = m.getPageView(a);
                if (!b) return "";
                var c = p.getScale(),
                    d = n.getPixelsPerPoint(),
                    e = b.getPDFPageWidth() * c * d,
                    f = b.getPDFPageHeight() * c * d,
                    g = b.getPDFPageWidth() * d,
                    h = b.getPDFPageHeight() * d;
                b.setPageViewWidth(e), b.setPageViewHeight(f);
                var i = m.getScrollApi(),
                    j = i ? i.getScrollBarWidth() : 0,
                    k = 0;
                k = o.showMode == WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING ? m.getDocViewWidth() / 2 : m.getDocViewWidth();
                var l = (k - j - e) / 2,
                    r = "height:" + f + "px;width:" + e + "px;margin-left:" + l + "px;",
                    s = "border  fwr-hidden fwr-page-bg-image",
                    t = "fwr-page-loading",
                    u = "fwr-watermark",
                    v = "fwr-trial-watermark",
                    w = "";
                switch (o.showMode) {
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS:
                        w = "<div class='fwr-page'  data-width='" + g + "' data-height='" + h + "'id='" + b.getPageViewContainerID() + "' style='position:relative;" + r + "'><div id='" + b.getWrapPageID() + "' class='fwr-page border ' style='width:100%;height:100%' ></div><img alt='' src='" + q + "' id='" + b.getPageBackgroundImgID() + "' class='" + s + "' style='width:100%;height:100%;background-size:cover' /><div id='" + b.getPageLoaderImageID() + "' class='" + t + "' /> <p class='fwr-page-loadinfo'></p></div><div id='" + b.getTrialWatermarkID() + "' class='" + v + "'></div><div id='" + b.getWatermarkID() + "' class='" + u + "'></div><div id='" + b.getUserWatermarkID() + "'></div>", w += "</div>";
                        break;
                    case WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE:
                        w = "<div class='fwr-single-page' id='" + b.getPageViewContainerID() + "' style='position:relative;" + r + "'><div id='" + b.getWrapPageID() + "' class='fwr-page border ' style='width:100%;height:100%' ></div><img alt='' src='" + q + "' id='" + b.getPageBackgroundImgID() + "' class='" + s + "' style='width:100%;height:100%;background-size:cover' /><div id='" + b.getPageLoaderImageID() + "' class='" + t + "' /> <p class='fwr-page-loadinfo'></p></div><div id='" + b.getTrialWatermarkID() + "' class='" + v + "'></div><div id='" + b.getWatermarkID() + "' class='" + u + "'></div><div id='" + b.getUserWatermarkID() + "'></div>", w += "</div>";
                        break;
                    case WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING:
                        w = "<div class='fwr-page' id='" + b.getPageViewContainerID() + "' style='position:relative;" + r + "'><div id='" + b.getWrapPageID() + "' class='fwr-page border ' style='width:100%;height:100%' ></div><img alt='' src='" + q + "' id='" + b.getPageBackgroundImgID() + "' class='" + s + "' style='width:100%;height:100%;background-size:cover' /><div id='" + b.getPageLoaderImageID() + "' class='" + t + "' /> <p class='fwr-page-loadinfo' ></p></div><div id='" + b.getTrialWatermarkID() + "' class='" + v + "'></div><div id='" + b.getWatermarkID() + "' class='" + u + "'></div><div id='" + b.getUserWatermarkID() + "'></div>", w += "</div>"
                }
                return w
            }, this.createPagesView = function(a, b, c) {
                var e = document.createDocumentFragment(),
                    f = null;
                o.showMode == WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING && (f = document.createDocumentFragment());
                for (var g = a; b >= g; g++) {
                    var h = p.createPageViewHtml(g),
                        i = document.createElement("div");
                    i.innerHTML = h, $(i).css({
                        width: "100%"
                    }).addClass("fwr-page-invisible"), o.showMode == WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING && g % 2 != 0 ? f.appendChild(i) : e.appendChild(i), m.getPageView(g).setContentCreatedState(!0)
                }
                var j = m.getPageViewContainerID(c);
                return -1 === c ? o.showMode == WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING ? ($("#" + m.getLeftDocContainerID())[0].appendChild(e), $("#" + m.getRightDocContainerID())[0].appendChild(f)) : $("#" + m.getDocViewContainerID())[0].appendChild(e) : d.insertAfter(e, document.getElementById(j).parentNode), !0
            }, this.getPageViewOffsetDocView = function(a) {
                var b = m.getPageView(a);
                if (!b.isContentCreated()) return {
                    x: 0,
                    y: 0
                };
                var c = $("#" + b.getPageViewContainerID()).offset(),
                    d = $("#" + m.getDocViewContainerID()).offset();
                return {
                    x: d.left - c.left,
                    y: d.top - c.top
                }
            }, this.zoomToPage = function(a, b, c, d, e) {
                if (!(a <= WebPDF.PDFView.RD_ZMODE_CUSTOM || a > WebPDF.PDFView.RD_ZMODE_FIT_VISIBLE)) {
                    a == WebPDF.PDFView.RD_ZMODE_CUSTOM && (b = j(b)), this.setLayoutZoomToMode(a);
                    var f = i(a, b, d, c, e);
                    l(f)
                }
            }, this.getScale = function() {
                return o.scale
            }, this.setScale = function(a) {
                o.scale = a
            }, this.getRotate = function() {
                return o.rotateAngle
            }, this.setRotate = function(a) {
                o.rotateAngle = a
            }, this.getContinuousPageSpace = function() {
                return o.continuousPageSpace
            }, this.getSinglePageSpace = function() {
                return o.singlePageSpace
            }, this.changePagesStyle = function() {
                for (var a = m.getPageCount(), b = 0; a > b; b++) {
                    var c = m.getPageView(b);
                    c.isContentCreated() && (o.showMode == WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE ? $("#" + m.getPageView(b).getPageViewContainerID()).removeClass("fwr-page").addClass("fwr-single-page") : $("#" + m.getPageView(b).getPageViewContainerID()).removeClass("fwr-single-page").addClass("fwr-page"))
                }
            }, this.clearPagesSingleStyle = function(a) {
                for (var b = m.getPageCount(), c = a.begin; c < a.end + 1; c++) p.setSinglePageStyle(c, null, null), c == b - 1 && c > 0 && p.setSinglePageStyle(c - 1, null, null)
            }, this.setSinglePageStyle = function(a, b, c) {
                var d = document.getElementById(m.getPageView(a).getPageViewContainerID()),
                    e = "",
                    f = "";
                null != b && (e = b + "px"), null != c && (f = c + "px"), $(d).css({
                    "margin-bottom": e,
                    "margin-top": f
                })
            }
        }, WebPDF.PDFView.CSinglePageViewLayout
    }), define("core/Common/Common", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF"),
            e = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
            f = [-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, -1, -1, -1, -1, -1];
        return String.prototype.format = function(a) {
            var b = this;
            if (arguments.length <= 0) return b;
            if (1 == arguments.length && "object" == typeof a) {
                for (var c in a)
                    if (void 0 != a[c]) {
                        var d = new RegExp("({" + c + "})", "g");
                        b = b.replace(d, a[c])
                    }
                return b
            }
            for (var e = 0; e < arguments.length; e++)
                if (void 0 != arguments[e]) {
                    var d = new RegExp("({)" + e + "(})", "g");
                    b = b.replace(d, arguments[e])
                }
            return b
        }, String.Format = function() {
            for (var a = arguments[0], b = 0; b < arguments.length - 1; b++) a = a.replace(RegExp("\\{" + b + "\\}", "gm"), arguments[b + 1]);
            return a
        }, String.utf8ArrayToString = function(a) {
            var b, c, d, e, f, g;
            for (b = "", d = a.length, c = 0; d > c;) switch (e = a[c++], (e + 256) % 256 >> 4) {
                case 0:
                case 1:
                case 2:
                case 3:
                case 4:
                case 5:
                case 6:
                case 7:
                    b += String.fromCharCode(e);
                    break;
                case 12:
                case 13:
                    f = a[c++], b += String.fromCharCode((31 & e) << 6 | 63 & f);
                    break;
                case 14:
                    f = a[c++], g = a[c++], b += String.fromCharCode((15 & e) << 12 | (63 & f) << 6 | (63 & g) << 0)
            }
            return b
        }, String.prototype.firstUpperCase = function() {
            return this.replace(/^\S/, function(a) {
                return a.toUpperCase()
            })
        }, Object.equals = function(a, b) {
            if (!a || !b) return !1;
            var c;
            for (c in b)
                if ("undefined" == typeof a[c]) return !1;
            for (c in b)
                if (b[c]) switch (typeof b[c]) {
                    case "object":
                        if (!Object.equals(b[c], a[c])) return !1;
                        break;
                    case "function":
                        if ("undefined" == typeof a[c] || "equals" != c && b[c].toString() != a[c].toString()) return !1;
                        break;
                    default:
                        if (b[c] != a[c]) return !1
                } else if (a[c]) return !1;
            for (c in a)
                if ("undefined" == typeof b[c]) return !1;
            return !0
        }, Object.keys = "function" == typeof Object.keys ? Object.keys : function(a) {
            var b = [],
                c = Object.prototype.hasOwnProperty;
            for (var d in a) c.call(a, d) && b.push(d);
            return b
        }, d.Common = {
            Unit: {
                POINT: "point",
                INCH: "inch",
                CM: "cm",
                PICA: "pica"
            },
            Direc: {
                LEFT_TOP: 0,
                RIGHT_TOP: 1,
                RIGHT_BOTTOM: 3,
                LEFT_BOTTOM: 2,
                LEFT: 4,
                TOP: 5,
                RIGHT: 6,
                BOTTOM: 7,
                MOVE_START: 8,
                MOVE_END: 9
            },
            preventDefaults: function(a, b) {
                if (!d.Environment.mobile) {
                    a || (a = window.event), a.preventDefault && a.preventDefault();
                    try {
                        b && document.selection && document.selection.empty()
                    } catch (c) {
                        console.error(c)
                    }
                }
            },
            getHiddenParamValue: function(a) {
                var b = document.getElementById(a);
                return b ? b.value : null
            },
            queryString: function(a) {
                return (document.location.search.match(new RegExp("(?:^\\?|&)" + a + "=(.*?)(?=&|$)")) || ["", null])[1]
            },
            isStringNullorEmpty: function(a) {
                return void 0 == a || null == a || "" == a ? !0 : !1
            },
            insertAfter: function(a, b) {
                var c = b.parentNode,
                    d = null;
                return d = c.lastChild == b ? c.appendChild(a) : c.insertBefore(a, b.nextSibling)
            },
            timestamp2Date: function(a) {
                return new Date(1e3 * a)
            },
            timestampToDateString: function(a, b) {
                var c = (new Date, new Date(1e3 * a));
                return this.formatDate(c, b)
            },
            AnnotTimeFormat: "M/d/yyyy hh:mm:ss",
            CollectTimeFormat: "yyyy-MM-dd hh:mm:ss",
            StampTimeFormat: "hh:mm:ss d/M/yyyy",
            WaterMarkTimeFormat: "yyyy-M-d hh:mm:ss",
            timestampToPDFTimeString: function(a) {
                var b = new Date(1e3 * a),
                    c = String.Format("D:{0}{1}{2}{3}{4}{5}", b.getFullYear(), this.fixNumber(b.getMonth() + 1, 2), this.fixNumber(b.getDate(), 2), this.fixNumber(b.getHours(), 2), this.fixNumber(b.getMinutes(), 2), this.fixNumber(b.getSeconds(), 2)),
                    d = b.getTimezoneOffset(),
                    e = -1 * d / 60,
                    f = -1 * d % 60;
                e = this.fixNumber(e, 2), f = this.fixNumber(f, 2);
                var g = "+";
                return 0 > e && (g = "-"), t2 = String.Format("{0}'{1}'", e, f), c + g + t2
            },
            pdfTimeStringToTimeStamp: function(a) {
                var b = parseInt(a.substr(2, 4)),
                    c = parseInt(a.substr(6, 2)) - 1,
                    d = parseInt(a.substr(8, 2)),
                    e = parseInt(a.substr(10, 2)),
                    f = parseInt(a.substr(12, 2)),
                    g = parseInt(a.substr(14, 2)),
                    h = a.substr(16, 1),
                    i = parseInt(a.substr(17, 2));
                return "+" === h && (i *= -1), e += i, Date.UTC(b, c, d, e, f, g, 0) / 1e3
            },
            isColorBlack: function(a) {
                var b = a.toLowerCase();
                if (b) {
                    for (var c = 0, d = 1; 7 > d; d += 2) c += parseInt("0x" + b.slice(d, d + 2));
                    return 765 > 2 * c
                }
                return !0
            },
            htmlEncode: function(a) {
                return a = a.replace(/&/g, "&amp;"), a = a.replace(/</g, "&lt;"), a = a.replace(/>/g, "&gt;"), a = a.replace(/"/g, "&quot;"), a = a.replace(/'/g, "&#039;")
            },
            htmlDecode: function(a) {
                return a = a.replace(/&amp;/g, "&"), a = a.replace(/&lt;/g, "<"), a = a.replace(/&gt;/g, ">"), a = a.replace(/&quot;/g, '"'), a = a.replace(/&#039;/g, "'"), a = a.replace(/&nbsp;/g, " ")
            },
            htmlEncodeEx: function(a) {
                if (!a) return "";
                a = a.replace(/\r\n/g, "\n");
                var b = "";
                if (0 == a.length) return "";
                for (var c = 0; c < a.length; c++) switch (a.substr(c, 1)) {
                    case "<":
                        b += "&lt;";
                        break;
                    case ">":
                        b += "&gt;";
                        break;
                    case "&":
                        b += "&amp;";
                        break;
                    case " ":
                        " " == a.substr(c + 1, 1) ? (b += " &nbsp;", c++) : b += " ";
                        break;
                    case '"':
                        b += "&quot;";
                        break;
                    case "\n":
                        b += "<br>";
                        break;
                    default:
                        b += a.substr(c, 1)
                }
                return b
            },
            formatDate: function(a, b, c) {
                var d, e = null;
                c ? (d = {
                    "M+": a.getUTCMonth() + 1,
                    "d+": a.getUTCDate(),
                    "h+": a.getUTCHours(),
                    "m+": a.getUTCMinutes(),
                    "s+": a.getUTCSeconds(),
                    "q+": Math.floor((a.getUTCMonth() + 3) / 3),
                    S: a.getUTCMilliseconds()
                }, e = a.getUTCFullYear()) : (d = {
                    "M+": a.getMonth() + 1,
                    "d+": a.getDate(),
                    "h+": a.getHours(),
                    "m+": a.getMinutes(),
                    "s+": a.getSeconds(),
                    "q+": Math.floor((a.getMonth() + 3) / 3),
                    S: a.getMilliseconds()
                }, e = a.getFullYear()), /(y+)/.test(b) && (b = b.replace(RegExp.$1, (e + "").substr(4 - RegExp.$1.length)));
                for (var f in d) new RegExp("(" + f + ")").test(b) && (b = b.replace(RegExp.$1, 1 == RegExp.$1.length ? d[f] : ("00" + d[f]).substr(("" + d[f]).length)));
                return b
            },
            hexColor2Rgba: function(a, b) {
                var c = 0,
                    d = 0,
                    e = 0;
                if (/rgb/.test(a)) {
                    var f = a.match(/\d+/g);
                    c = parseInt(f[0]), d = parseInt(f[1]), e = parseInt(f[2])
                } else {
                    if (!/#/.test(a)) return a;
                    var g = a.length;
                    7 === g ? (c = parseInt(a.slice(1, 3), 16), d = parseInt(a.slice(3, 5), 16), e = parseInt(a.slice(5), 16)) : 4 === g && (c = parseInt(a.charAt(1) + a.charAt(1), 16), d = parseInt(a.charAt(2) + a.charAt(2), 16), e = parseInt(a.charAt(3) + a.charAt(3), 16))
                }
                return "rgba(" + c + "," + d + "," + e + "," + b + ")"
            },
            hexColor2Rgba_noAlpha: function(a) {
                var b = 0,
                    c = 0,
                    d = 0;
                if (/rgb/.test(a)) {
                    var e = a.match(/\d+/g);
                    b = parseInt(e[0]), c = parseInt(e[1]), d = parseInt(e[2])
                } else {
                    if (!/#/.test(a)) return a;
                    var f = a.length;
                    7 === f ? (b = parseInt(a.slice(1, 3), 16), c = parseInt(a.slice(3, 5), 16), d = parseInt(a.slice(5), 16)) : 4 === f && (b = parseInt(a.charAt(1) + a.charAt(1), 16), c = parseInt(a.charAt(2) + a.charAt(2), 16), d = parseInt(a.charAt(3) + a.charAt(3), 16))
                }
                return "rgb(" + b + "," + c + "," + d + ")"
            },
            restRgbaAlpha: function(a, b) {
                var c = 0,
                    d = 0,
                    e = 0;
                if (/rgb/.test(a) || /rgba/.test(a)) {
                    var f = a.match(/\d+/g);
                    c = parseInt(f[0]), d = parseInt(f[1]), e = parseInt(f[2])
                }
                return "rgba(" + c + "," + d + "," + e + "," + b + ")"
            },
            rgb2HexColor: function(a) {
                if ("#" === a.charAt(0)) return a;
                for (var b = /[0-9]{0,3}/g, c = a.match(b), d = "#", e = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"], f = 0; f < c.length; f++) {
                    for (var g = null, h = c[f], i = h, j = []; h > 16;) g = h % 16, h = h / 16 >> 0, j.push(e[g]);
                    j.push(e[h]), 16 > i && "" != i && j.push(0), d += j.reverse().join("")
                }
                return d
            },
            arrayRemove: function(a, b) {
                for (var c, d = 0; d < a.length; d++)
                    if (a[d] === b) {
                        c = d;
                        break
                    }
                return void 0 !== c && a.splice(c, 1), a
            },
            updateBtnState: function(a, b, c, d) {
                d ? $("#" + a).removeClass(c).addClass(b).addClass("fwr_toolbar_btn") : $("#" + a).removeClass(b).addClass(c).removeClass("fwr_toolbar_btn")
            },
            changeUnit: function(a, b, c) {
                var e = 0,
                    f = d.Common.Unit;
                switch (b) {
                    case f.POINT:
                        e = a / 72;
                        break;
                    case f.INCH:
                        e = a;
                        break;
                    case f.CM:
                        e = a / 2.54;
                        break;
                    case f.PICA:
                        e = a / 6
                }
                switch (c) {
                    case f.POINT:
                        e *= 72;
                        break;
                    case f.INCH:
                        break;
                    case f.CM:
                        e *= 2.54;
                        break;
                    case f.PICA:
                        e *= 6
                }
                return e
            },
            parseValueToDecimal: function(a) {
                if (!a) return !1;
                var b = Math.round(100 * a) / 100,
                    c = b.toString(),
                    d = c.indexOf(".");
                for (0 > d && (d = c.length, c += "."); c.length <= d + 2;) c += "0";
                return c
            },
            getUnicodeStringLength: function(a) {
                var b = 0,
                    c = a.length;
                if (a) {
                    for (var d = 0; c > d; d++) str.charCodeAt(d) > 255 ? b += 2 : b++;
                    return b
                }
                return 0
            },
            isNeedRetry: function(a) {
                return a == d.ConversionState.IN_PROGRESS || a == d.ConversionState.INITIALIZE
            },
            containsNode: function(a, b, c) {
                return c && a === b ? !0 : $.contains(a, b)
            },
            encodeArrayBufferAsBase64: function(a) {
                if (!a) return null;
                for (var b, c, d, e, f, g = "", h = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", i = new Uint8Array(a), j = i.byteLength, k = j % 3, l = j - k, m = 0; l > m; m += 3) f = i[m] << 16 | i[m + 1] << 8 | i[m + 2], b = (16515072 & f) >> 18, c = (258048 & f) >> 12, d = (4032 & f) >> 6, e = 63 & f, g += h[b] + h[c] + h[d] + h[e];
                return 1 == k ? (f = i[l], b = (252 & f) >> 2, c = (3 & f) << 4, g += h[b] + h[c] + "==") : 2 == k && (f = i[l] << 8 | i[l + 1], b = (64512 & f) >> 10, c = (1008 & f) >> 4, d = (15 & f) << 2, g += h[b] + h[c] + h[d] + "="), g
            },
            base64encodeArray: function(a, b) {
                var c, d, f, g, h, i;
                for (f = b, d = 0, c = ""; b > d;) {
                    if (g = 255 & a[d++], d == f) {
                        c += e.charAt(g >> 2), c += e.charAt((3 & g) << 4), c += "==";
                        break
                    }
                    if (h = a[d++], d == f) {
                        c += e.charAt(g >> 2), c += e.charAt((3 & g) << 4 | (240 & h) >> 4), c += e.charAt((15 & h) << 2), c += "=";
                        break
                    }
                    i = a[d++], c += e.charAt(g >> 2), c += e.charAt((3 & g) << 4 | (240 & h) >> 4), c += e.charAt((15 & h) << 2 | (192 & i) >> 6), c += e.charAt(63 & i)
                }
                return c
            },
            base64encode: function(a) {
                var b, c, d, f, g, h;
                for (d = a.length, c = 0, b = ""; d > c;) {
                    if (f = 255 & a.charCodeAt(c++), c == d) {
                        b += e.charAt(f >> 2), b += e.charAt((3 & f) << 4), b += "==";
                        break
                    }
                    if (g = a.charCodeAt(c++), c == d) {
                        b += e.charAt(f >> 2), b += e.charAt((3 & f) << 4 | (240 & g) >> 4), b += e.charAt((15 & g) << 2), b += "=";
                        break
                    }
                    h = a.charCodeAt(c++), b += e.charAt(f >> 2), b += e.charAt((3 & f) << 4 | (240 & g) >> 4), b += e.charAt((15 & g) << 2 | (192 & h) >> 6), b += e.charAt(63 & h)
                }
                return b
            },
            sha256: function(a) {
                var b = CryptoJS.lib.WordArray.create(a),
                    c = CryptoJS.SHA256(b).toString(CryptoJS.enc.Hex);
                return c
            },
            base64decode: function(a) {
                var b, c, d, e, g, h, i;
                for (h = a.length, g = 0, i = ""; h > g;) {
                    do b = f[255 & a.charCodeAt(g++)]; while (h > g && -1 == b);
                    if (-1 == b) break;
                    do c = f[255 & a.charCodeAt(g++)]; while (h > g && -1 == c);
                    if (-1 == c) break;
                    i += String.fromCharCode(b << 2 | (48 & c) >> 4);
                    do {
                        if (d = 255 & a.charCodeAt(g++), 61 == d) return i;
                        d = f[d]
                    } while (h > g && -1 == d);
                    if (-1 == d) break;
                    i += String.fromCharCode((15 & c) << 4 | (60 & d) >> 2);
                    do {
                        if (e = 255 & a.charCodeAt(g++), 61 == e) return i;
                        e = f[e]
                    } while (h > g && -1 == e);
                    if (-1 == e) break;
                    i += String.fromCharCode((3 & d) << 6 | e)
                }
                return i
            },
            slideToggle: function(a, b) {
                var c = $(a),
                    d = c.data("originalHeight"),
                    e = c.is(":visible");
                return 1 == arguments.length && (b = !e), b == e ? !1 : (d || (d = c.show().height(), c.data("originalHeight", d), e || c.hide().css({
                    height: 0
                })), void(b ? c.show().animate({
                    height: d
                }, {
                    duration: 250
                }) : c.animate({
                    height: 0
                }, {
                    duration: 250,
                    complete: function() {
                        c.hide()
                    }
                })))
            },
            isElemInteractive: function(a, b) {
                var c = $(b),
                    d = c.attr("type");
                d = d ? d.toLowerCase() : "";
                var e = b.nodeName.toLowerCase();
                if ("text" === d || "textarea" === d || "select-one" === d || "option" === b.tagName.toLowerCase() || "select" === e || b.isContentEditable) return !0;
                var f = a.getIgnoreMouseEventClasses(),
                    g = !1;
                if ($.each(f, function(a, b) {
                        return c.hasClass(b) || c.parents("." + b).length > 0 ? (g = !0, !0) : void 0
                    }), g) return !0;
                var h = $.data(b, "events");
                return !h || 1 == Object.keys(h).length && h.contextmenu ? /.*fieldObjNum_\d*_controlObjNum_\d*/.test(b.id) ? !0 : !1 : !0
            },
            createUniqueId: function() {
                return (65536 * (1 + Math.random()) | 0).toString(16).substring(1)
            },
            vectorLength: function(a) {
                return Math.sqrt(a.x * a.x + a.y * a.y)
            },
            slopeAngle: function(a) {
                return d.Common.arcCosine(a, new d.PDFPoint(1, 0))
            },
            arcCosine: function(a, b) {
                return Math.acos(d.Common.cosine(a, b))
            },
            cosine: function(a, b) {
                var c = d.Common.dotProduct(a, b);
                return c / (d.Common.vectorLength(a) * d.Common.vectorLength(b))
            },
            dotProduct: function(a, b) {
                return a.x * b.x + a.y * b.y
            },
            getSign: function(a) {
                return a > 0 ? 1 : 0 > a ? -1 : 0
            },
            clone: function(a) {
                var b;
                if (a && a instanceof Array) {
                    b = [];
                    for (var c = 0; c < a.length; c++) b[c] = this.clone(a[c]);
                    return b
                }
                if (null === a || "object" != typeof a || a instanceof String || a instanceof Number || a instanceof Boolean || a instanceof Date || a instanceof RegExp) return a;
                b = new a.constructor;
                for (var d in a) {
                    var e = a[d];
                    b[d] = this.clone(e)
                }
                return b
            },
            addTranslateCss: function(a, b, c, e, f, g, h) {
                if (null == a) return !1;
                var i = "";
                if (null != b && 0 != b && (i = "rotate(" + b + "deg) "), null != c && 0 != c && (i += "translateX(" + Math.round(c) + "px)"), null != e && 0 != e && (i += "translateY(" + Math.round(e) + "px)"), null != h && 0 != h && (i += " scale(" + h + "," + h + ")"), a.css({
                        "-webkit-transform": i,
                        "-moz-transform": i,
                        "-o-transform": i,
                        "-ms-transform": i,
                        transform: i
                    }), null != f && null != g) {
                    var j = f + " " + g + ";";
                    a.css({
                        "-webkit-transform-origin": j,
                        "-moz-transform-origin": j,
                        "-o-transform-origin": j,
                        "-ms-transform-origin": j,
                        "transform-origin": j
                    })
                }
                d.Environment.ie8OrLower && a.css({
                    filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=" + b / 90 + ");"
                })
            },
            getTransformCssString: function(a, b, c, e, f, g) {
                var h = "";
                null != a && 0 != a && (h = "rotate(" + a + "deg)"), null != b && 0 != b && (h += "translateX(" + b + "px)"), null != c && 0 != c && (h += "translateY(" + c + "px)"), null != g && 0 != g && (h += " scale(" + g + "," + g + ")");
                var i = "";
                return null != e && null != f ? (i += "-webkit-transform:" + h + ";-webkit-transform-origin:" + e + " " + f + ";", i += "-moz-transform:" + h + ";-moz-transform-origin:" + e + " " + f + ";", i += "-o-transform: " + h + ";-o-transform-origin:" + e + " " + f + ";", i += "-ms-transform:" + h + ";-ms-transform-origin:" + e + " " + f + ";", i += "transform:" + h + ";transform-origin:" + e + " " + f + ";") : (i += "-webkit-transform:" + h + ";", i += "-moz-transform:" + h + ";", i += "-o-transform: " + h + ";", i += "-ms-transform:" + h + ";", i += "transform:" + h + ";"), d.Environment.ie8OrLower && (i += "filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=" + a / 90 + ");"), i
            },
            openFilebyJR: function(a, b, c, e, f, g, h) {
                function i(c) {
                    null == c && d.Tool.getReaderApp().setCurFile({
                        md5: a,
                        lastModifyTime: b,
                        fileName: e,
                        url: g
                    });
                    var h = j + "asserts/" + c;
                    let dd = new Date();
                    window.openFileBufStartTime = dd.getTime();
                    d.ViewerInstance.openFileByBuffer(f, e, h)
                }
                var j = d.optionParameters.serverBaseUrl;
                return d.Tool.getReaderApp().isOffline() ? void i(null) : void d.Common.getFileId(a, b, c, e, f, g, h, i)
            },
            getFileId: function(a, b, c, e, f, g, h, i) {
                var j = d.optionParameters.serverBaseUrl,
                    k = null,
                    l = null;
                d.AccountInstance && (k = d.AccountInstance.getUserAccount(), l = d.AccountInstance.getUserId());
                var m = "http";
                h && (m = "local");
                var n = {
                    plugin: m,
                    fileUri: g,
                    fileName: e,
                    version: b,
                    fileSize: c,
                    md5: a,
                    userId: l,
                    userName: k,
                    fileMd5: ""
                };
                let isfileIDPresent = false;
                let fileID;
                for(let ii=0;ii<window.fileIdsList.length;ii++) {
                    let assetObj = window.fileIdsList[ii];
                    if(assetObj[g] === undefined) {
                        isfileIDPresent = false;
                    } else {
                        isfileIDPresent = true;
                        fileID = assetObj[g];
                        break;
                    }
                }
                if(!isfileIDPresent){
                    let tt2 = new Date();
                    let fileIdCallStartTime = tt2.getTime();
                    $.ajax({
                    type: "GET",
                    url: j + "api/file/id",
                    data: n,
                    success: function(a) {
                        let tt3 = new Date();
                        let fileIdCallEndTime = tt3.getTime() - fileIdCallStartTime;
                        console.log("Time taken for file id service call is "+(fileIdCallEndTime/1000)+" secs");
                        var b = a.id;
                        if ("" == b && h) {
                            var c = new SparkMD5.ArrayBuffer;
                            c.append(f);
                            var d = c.end();
                            n.fileMd5 = d, $.ajax({
                                type: "GET",
                                url: j + "api/file/id",
                                data: n,
                                success: function(a) {
                                    b = a.id, i(b);
                                    var fileIdObj = {};
                                    fileIdObj[g] = b
                                    window.fileIdsList.push(fileIdObj);
                                },
                                error: function(a, b, c) {}
                            })
                        } else {
                            var fileIdObj = {};
                            fileIdObj[g] = b
                            window.fileIdsList.push(fileIdObj);
                            i(b);
                        }
                    },
                    error: function(a, b, c) {}
                    })
                }else{
                    i(fileID);
                }
                
            },
            openFileUrlByJR: function(a, b) {
                function c() {
                    if (console.log(e.readyState), 4 == e.readyState) {
                        var c, g, h = e.response,
                            i = e.getResponseHeader("Content-Length"),
                            j = e.getResponseHeader("Last-Modified"),
                            k = new Uint8Array(h);
                        1048576 > i ? c = h : (g = new Uint8Array(k.subarray(0, 1024)), c = g.buffer), f.append(c);
                        var l = f.end();
                        d.Common.openFilebyJR(l, j, i, b, k, a, !1)
                    }
                }
                if (d.Engine.JR) {
                    var e = new XMLHttpRequest;
                    e.open("get", a, !0), e.responseType = "arraybuffer", e.onreadystatechange = c, e.setRequestHeader("Cache-Control", "public"), e.send();
                    var f = new SparkMD5.ArrayBuffer
                }
            },
            xhFile: function(a, b, c) {
                var e = new XMLHttpRequest,
                    f = a.indexOf("blob") ? "blob" : "arraybuffer";
                e.open("GET", a, !0), e.responseType = f;
                var g = new SparkMD5.ArrayBuffer;
                var tt = new Date();
                var pdfFetchStartTime = tt.getTime();
                e.addEventListener("load", function(e) {
                    let tt1 = new Date();
                    let pdfLoadTime = tt1.getTime() - pdfFetchStartTime;
                    console.log("Time taken to download the pdf is "+(pdfLoadTime/1000)+" secs");
                    var f = this.getResponseHeader("Last-Modified"),
                        h = this.response,
                        i = h.size,
                        j = new FileReader;
                    j.readAsArrayBuffer(h), j.onload = function(e) {
                        var h, j, k = new Uint8Array(e.target.result);
                        1048576 > i ? h = k.buffer : (j = new Uint8Array(k.subarray(0, 1024)), h = j.buffer), g.append(h);
                        var l = g.end();
                        j = null, d.Common.openFilebyJR(l, f, i, b, k.buffer, a, !1), $.isFunction(c) && c()
                    }
                }, !1), e.addEventListener("error", function() {}, !1), e.send()
            },
            // For poc
            getEngine: function(a, b) {
                if (d.Tool.getReaderApp().isOffline() || !0) return d.Engine || (d.Engine = {}), d.Engine.JR = !0, void b();
                var c = a + "api/config/engine?" + Math.random();
                $.ajax({
                    url: c,
                    dataType: "json",
                    success: function(a) {
                        if (d.Engine = {}, d.Engine.JR = "JR" === a.result ? !0 : !1, d.Engine.JR) {
                            if (null == window.Worker) {
                                var c = i18n.t("CommonDialog.NotSupportBrowserForJR");
                                return void d.notSupportBrowser(c, d.Engine.JR)
                            }
                        } else if (d.Environment.ie8OrLower) {
                            var c = i18n.t("CommonDialog.NotSupportBrowserForSR");
                            d.notSupportBrowser(c, d.Engine.JR)
                        }
                        b(d.Engine.JR)
                    },
                    error: function() {}
                })
            },
            joinFromXML: function(a, b) {
                if (null == a) return b;
                for (var c = $.parseXML(a), b = $.parseXML(b), d = $(c).find("fields").children(), e = $(b).find("fields").children(), f = 0; f < d.length; f++)
                    for (var g = d[f], h = 0; h < e.length; h++) {
                        var i = e[h];
                        i.getAttribute("xfdf:original") === g.getAttribute("name") && (i.textContent = g.textContent)
                    }
                var j = "";
                return j = b.xml ? b.xml : (new XMLSerializer).serializeToString(b)
            },
            getReaderApp: function() {
                return d.Tool.getReaderApp()
            },
            generateUUID: function() {
                var a = (new Date).getTime(),
                    b = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(b) {
                        var c = (a + 16 * Math.random()) % 16 | 0;
                        return a = Math.floor(a / 16), ("x" == b ? c : 3 & c | 8).toString(16)
                    });
                return b
            },
            fixNumber: function(a, b) {
                return ("" + a).length < b ? (new Array(b + 1).join("0") + a).slice(-b) : "" + a
            },
            checkAnnotaFlag: function(a, b) {
                return 0 != (a & b) ? !0 : !1
            },
            getReadableParams: function() {
                var a;
                return apiConfig && apiConfig.document && "object" == typeof apiConfig.document.getReadablePages ? a = apiConfig.document.getReadablePages : apiConfig && apiConfig.document && "function" == typeof apiConfig.document.getReadablePages ? a = apiConfig.document.getReadablePages() : console.error("apiConfig.document.getDocument format error,mush object or function"), a = a ? a : {}, a = JSON.stringify(a)
            },
            getPixelsPerPoint: function() {
                return 96 / 72
            },
            uploadFileByBuffer: function(a, b, c, d, e, f, g, h) {
                $.ajax({
                    type: "GET",
                    url: a + "api/file/exist?fileMd5=" + c + "&version=" + d + "&fileSize=" + e + "&fileUrl=" + encodeURIComponent(f),
                    success: function(h) {
                        var i = JSON.parse(h);
                        if (0 == i.resultCode) g(i.docId);
                        else {
                            var j = a + "api/file/uploadFromBuffer?fileMd5=" + c + "&version=" + d + "&fileSize=" + e + "&fileUrl=" + encodeURIComponent(f),
                                k = new XMLHttpRequest;
                            k.open("POST", j, !0), k.setRequestHeader("Content-type", "application/octet-stream"), k.onload = function(a) {
                                var b = $.parseJSON(this.response);
                                g(b.docId)
                            }, k.onerror = function(a, b, c) {}, k.send(b)
                        }
                    }
                })
            },
            generateDocId: function(a, b, c, d, e) {
                $.ajax({
                    url: a + "api/file/add",
                    type: "POST",
                    data: c,
                    success: function(a) {
                        return null != a && "" != a ? void(d && "function" == typeof d && d(a)) : void(e && "function" == typeof e && e())
                    },
                    error: function() {
                        e && "function" == typeof e && e()
                    }
                })
            },
            getDocumentBuffer: function(a, b, c, d) {
                var e = a + "api/file/" + b + "/getDocumentbuffer",
                    f = new XMLHttpRequest,
                    g = "arraybuffer";
                f.open("GET", e, !0), f.responseType = g, f.addEventListener("load", function(a) {
                    var b = this.response;
                    c(b)
                }, !1), f.addEventListener("error", function() {
                    d()
                }, !1), f.send()
            },
            isValidPageNum: function(a) {
                a = a.replace(/ /g, "");
                var b = /^\d+(\-\d+)?(,\d+(\-\d+)?)*$/;
                return b.test(a)
            },
            joinUrl: function(a) {
                function b(a) {
                    var b = a.filter(function(a) {
                        return "string" == typeof a
                    }).join("/").replace(/[\/\\]+/g, "/");
                    return "/" === b[0] ? b.slice(1) : b
                }
                var c = "",
                    d = a,
                    e = d.indexOf("://");
                return -1 !== e && (c = d.slice(0, e + 3), d = d.slice(c.length)), paths = Array.prototype.slice.call(arguments, 1), paths.unshift(d), c + b(paths)
            },
            getDeviceDPI: function() {
                function a() {
                    if (document.body) {
                        document.body.appendChild(b);
                        var a = {
                            xDPI: b.offsetWidth,
                            yDPI: b.offsetHeight
                        };
                        return document.body.removeChild(b), a
                    }
                }
                var b = document.createElement("div");
                $.extend(b.style, {
                    width: "1in",
                    height: "1in",
                    visibility: "hidden",
                    position: "absolute",
                    left: "-100%",
                    top: "-100%"
                });
                var c = a();
                return function() {
                    return c || (c = a()), c
                }
            }(),
            debounce: function(a, b, c) {
                var d;
                "number" != typeof b && (b = 100);
                var e = [];
                return function() {
                    clearTimeout(d);
                    var f = arguments,
                        g = this;
                    return new Promise(function(h) {
                        e.push(h), d = setTimeout(function() {
                            var b = a.apply(g, f);
                            c ? e.forEach(function(a) {
                                a(b)
                            }) : h(b), e = []
                        }, b)
                    })
                }
            }
        }, d.Common
    }), define("core/Interface/IMainFrmEventHandler", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.Event = {}, d.Event.IReaderMainFrmEventHandler = function() {}, d.Event.IReaderMainFrmEventHandler.prototype = {
            getType: function() {
                return "Interface"
            },
            onLButtonDown: function(a) {
                return !1
            },
            onLButtonUp: function(a) {
                return !1
            },
            onMouseMove: function(a) {
                return !1
            },
            onMouseLeave: function(a) {
                return !1
            },
            onMouseOut: function(a) {
                return !1
            }
        }, d.Event.IReaderMainFrmEventHandler
    }), define("core/Interface/IMousePtHander", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.Event = {}, d.Event.IReaderMousePtHandler = function() {}, d.Event.IReaderMousePtHandler.prototype = {
            getType: function() {
                return "Interface"
            },
            onLButtonDown: function(a) {
                return !1
            },
            onLButtonUp: function(a) {
                return !1
            },
            onLButtonDblClk: function(a) {
                return !1
            },
            onMouseMove: function(a) {
                return !1
            },
            onRButtonDown: function(a) {
                return !1
            },
            onRButtonUp: function(a) {
                return !1
            },
            onRButtonDblClk: function(a) {
                return !1
            },
            onMouseWheel: function(a) {
                return !1
            },
            onMouseOver: function(a) {
                return !1
            },
            onMouseOut: function(a) {
                return !1
            },
            onMouseLeave: function(a) {
                return !1
            },
            onMouseEnter: function(a) {
                return !1
            },
            onDoubleTap: function(a) {},
            onPinchIn: function(a) {},
            onPinchOut: function(a) {},
            onHold: function(a) {}
        }, d.Event.IReaderMousePtHandler
    }), define("core/Tools/HandToolHandler", ["core/Tools/Tools", "core/WebPDF"], function(a, b, c) {
        return a("core/Tools/Tools"), WebPDF.Tools.TOOL_NAME_HAND = "Hand", WebPDF.Tools.HandToolHandler = function() {
            function a() {
                var b = g.getMainView();
                if (null !== b) {
                    if (!f) {
                        var c = b.getDocView(),
                            d = $("#" + c.getDocViewContainerID());
                        WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (d.addClass("fwr-hand-cursor-ie"), d.css("cursor", "url(" + g.getBaseUrl() + "images/reader/cursor/hand.cur), auto")) : d.addClass("fwr-hand-cursor"), f = !0
                    }
                } else setTimeout(a, 100)
            }

            function b(a) {
                var b = $(a).attr("id");
                return Number(b.substr(b.lastIndexOf("_") + 1))
            }
            var c = !1,
                d = 0,
                e = 0,
                f = !1,
                g = null,
                h = 0,
                i = null;
            this.onInit = function(a) {
                g = a
            }, this.onDestroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_HAND
            }, this.onActivate = function() {
                a()
            }, this.onDeactivate = function() {
                var a = g.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-hand-cursor-ie") : b.removeClass("fwr-hand-cursor"), f = !1
            }, this.isEnabled = function() {
                return !0
            }, this.isProcessing = function() {
                return c
            }, this.onLButtonDown = function(a) {
                var b = g.getMainView().getDocView(),
                    f = b.getDocViewClientRect();
                if (!WebPDF.RectUtils.ptInRect(f, a.pageX, a.pageY)) return !0;
                var h = $("#" + b.getDocViewContainerID());
                return WebPDF.Common.containsNode(h.get(0), a.target, !0) ? (WebPDF.Environment.ieAtLeast11 && WebPDF.Common.preventDefaults(a, !0), c = !0, d = a.pageY, e = a.pageX, WebPDF.Environment.mobile ? $("#fwrm-menu-rotate").hide() : WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (h.removeClass("fwr-hand-cursor-ie"), h.addClass("fwr-catch-cursor-ie"), h.css("cursor", "url(" + g.getBaseUrl() + "images/reader/cursor/catch.cur), auto")) : (h.removeClass("fwr-hand-cursor"), h.addClass("fwr-catch-cursor")), !0) : !1
            }, this.onLButtonUp = function(a) {
                if (c) {
                    c = !1;
                    var b = g.getMainView().getDocView(),
                        d = $("#" + b.getDocViewContainerID());
                    WebPDF.Environment.mobile || (WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (d.removeClass("fwr-catch-cursor-ie"), d.addClass("fwr-hand-cursor-ie"), d.css("cursor", "url(" + g.getBaseUrl() + "images/reader/cursor/hand.cur), auto")) : (d.removeClass("fwr-catch-cursor"), d.addClass("fwr-hand-cursor")))
                }
                return !0
            }, this.onLButtonDblClk = function(a) {
                if (g.isMobile()) {
                    a.preventDefault();
                    var b = g.getMainView().getDocView(),
                        c = $("#" + b.getDocViewContainerID()),
                        d = c.height(),
                        e = c.width(),
                        f = b.getScrollApi();
                    f && (e -= f.getScrollBarWidth(), d -= f.getScrollBarHeight());
                    var h = c.offset(),
                        i = a.srcEvent.pageX,
                        j = a.srcEvent.pageY;
                    a.srcEvent.changedTouches && (i = a.srcEvent.changedTouches[0].pageX, j = a.srcEvent.changedTouches[0].pageY);
                    var k, l, m, n = j - h.top,
                        o = i - h.left,
                        p = n / d,
                        q = o / e,
                        r = f.getContentPositionY(),
                        s = 0,
                        t = WebPDF.ViewerInstance.getCurZoomLevel();
                    WebPDF.ViewerInstance.isFitWidth() ? (k = 1.5 * t, m = 1.5) : (k = WebPDF.ZOOM_FIT_WIDTH, l = b.getFitWidthScale(!0), m = l / t), WebPDF.ViewerInstance.zoomTo(k), s = e * (m - 1) * q, r = d * (m - 1) * p + r * m, f.scrollTo(s, r)
                }
                return !1
            }, this.onMouseMove = function(a) {
                return c ? (WebPDF.Common.preventDefaults(a, !0), g.getMainView().getDocView().movePage(e - a.pageX, d - a.pageY), d = a.pageY, e = a.pageX, !0) : !0
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return c && (c = !1), !0
            }, this.onDoubleTap = function(a) {
                var c = g.getMainView().getDocView(),
                    d = c.getScale(),
                    e = c.getFitWidthScale(!0);
                return d > e ? (d = e, c.setFitWidth(!0), c.onZoomByPos(e, a.gesture.center.pageX, a.gesture.center.pageY, b(a.srcElement))) : (d = 2 * e, c.setFitWidth(!1), c.onZoomByPos(d, a.gesture.center.pageX, a.gesture.center.pageY, b(a.srcElement))), !0
            }, this.onPinchIn = function(a) {
                var c = a.gesture.scale,
                    d = g.getMainView().getDocView();
                i != Hammer.detection.current && (h = 0), i = Hammer.detection.current;
                var e = d.getFitWidthScale(!0),
                    f = d.getScale();
                0 === h ? h = f : f = h;
                var j = e;
                if (!(j >= f)) {
                    var k = f,
                        l = k * c;
                    if (Math.abs(l - k) > .01) {
                        var m = a.gesture.center.pageX,
                            n = a.gesture.center.pageY,
                            o = a.gesture.startEvent.center.pageX,
                            p = a.gesture.startEvent.center.pageY,
                            q = (m + o) / 2,
                            r = (n + p) / 2;
                        e >= l ? (d.setFitWidth(!0), d.onZoomByPos(e, q, r, b(a.srcElement))) : d.onZoomByPos(l, q, r, b(a.srcElement))
                    }
                }
            }, this.onPinchOut = function(a) {
                var c = a.gesture.scale,
                    d = g.getMainView().getDocView();
                i != Hammer.detection.current && (h = 0), i = Hammer.detection.current;
                var e = d.getFitWidthScale(!0),
                    f = d.getScale();
                0 === h ? h = f : f = h;
                var j = e > WebPDF.Config.defaults.maxZoomSize ? e : WebPDF.Config.defaults.maxZoomSize;
                if (!(f >= j)) {
                    var k = f,
                        l = k * c;
                    if (l - f > .01) {
                        l > e && d.setFitWidth(!1);
                        var m = a.gesture.center.pageX,
                            n = a.gesture.center.pageY,
                            o = a.gesture.startEvent.center.pageX,
                            p = a.gesture.startEvent.center.pageY,
                            q = (m + o) / 2,
                            r = (n + p) / 2;
                        d.onZoomByPos(l, q, r, b(a.srcElement))
                    }
                    return !0
                }
            }, this.onHold = function(a) {
                var b = g.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                return b ? b.onHold(a) : !1
            }
        }, WebPDF.Tools.HandToolHandler
    }), define("core/Plugins/Menu/MenuItem", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.CMenuItem = function(a) {
            this.name = a.name, this.onShowFunc = a.onShow, this.onSelectFunc = a.onSelect, this.createHtmlContentFunc = a.createHtml;
            var b = this;
            this.createHtml = function() {
                return b.createHtmlContentFunc.call(this)
            }, this.onShow = function() {
                null != this.onShowFunc && b.onShowFunc.call(this)
            }, this.onSelect = function(a) {
                null != this.onSelectFunc && b.onSelectFunc.call(this, a)
            }
        }, d.CMenuItem
    }), define("core/Plugins/Text/TextManager", ["core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect", "core/Plugins/Text/PDFTextPage"], function(a, b, c) {
        var d = (a("core/Plugins/Text/PDFTextObject"), a("core/Plugins/Text/PDFTextPage"));
        return WebPDF.Text.TextManager = function(a) {
            var b = {},
                c = {},
                e = this,
                f = a;
            this.ajaxGetTextPage = function(e) {
                function g(a) {
                    var e = 0;
                    if (null != a.response && (e = a.error), 0 !== e) return void(c[a.pageIndex] = !1);
                    if (null === a.response) return console.warn("Get page text returns null."), !1;
                    try {
                        var g = $.parseJSON(a.textPageData);
                        if (null != g) {
                            var i = new d;
                            i.init(g), b[a.pageIndex] = i
                        }
                        $(f).trigger(WebPDF.EventList.PAGE_TEXT_LOADED)
                    } catch (j) {
                        h(a)
                    }
                }

                function h(a) {
                    if (null != a && null != a.pageIndex) {
                        console.error("Get page{" + a.pageIndex + "} text from server failed.");
                        var e = new d;
                        e.init(""), b[a.pageIndex] = e, c[a.pageIndex] = !1
                    }
                    return !1
                }
                if (!c[e]) {
                    var i = a.getOptions().url + "text/" + e;
                    a.isFormMode() && (i += "?formMode=true"), c[e] = !0;
                    var j = f.getDataControl(),
                        k = {
                            pageIndex: e
                        },
                        l = {
                            url: i,
                            password: a.getPDFPassword(),
                            requestData: k
                        },
                        m = {
                            type: "getPageText",
                            data: l,
                            success: g,
                            error: h
                        };
                    j.getPageText(m)
                }
            }, this.ajaxSearchText = function(b, c) {
                if ("" !== b) {
                    var d = a.getOptions().url + "searchtext/" + b + "/" + c;
                    $.ajax({
                        url: d,
                        dataType: "json",
                        headers: {
                            "x-auth-doc": a.getPDFPassword()
                        },
                        async: !0,
                        success: function(a) {
                            var b = a.error;
                            if (0 != b) return null;
                            try {
                                var c = $.parseJSON(a.searchResult);
                                return c
                            } catch (d) {
                                return null
                            }
                        },
                        error: function() {
                            return null
                        }
                    })
                }
            }, this.getTextPage = function(a, c) {
                var d = b[a];
                return d || c ? d ? d : null : (e.ajaxGetTextPage(a), b[a] ? b[a] : {
                    text: null,
                    blocking: !0
                })
            }, this.setTextPage = function(a, e) {
                var f = b[a];
                f || (textPage = new d, textPage.init(e), b[a] = textPage, c[a] = !0)
            }
        }, WebPDF.Text.TextManager
    }), define("core/Plugins/Text/PDFTextObject", ["core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect"], function(a, b, c) {
        a("core/Common/Math/Point"), a("core/Common/Math/Rect");
        var d = (WebPDF.PDFPoint, WebPDF.PDFRect),
            e = (WebPDF.Common, WebPDF.RectUtils);
        WebPDF.Text = {};
        var f = function() {
            this.charRect = new d(0, 0, 0, 0), this.charCode = -1
        };
        WebPDF.Text.CharInfo = f;
        var g = function() {
            this.index = -1, this.bLeft = !0
        };
        return WebPDF.Text.WritingMode = {
            TEXT_WRITING_MODE_LRTB: 0,
            TEXT_WRITING_MODE_RLTB: 1,
            TEXT_WRITING_MODE_LRBT: 2,
            TEXT_WRITING_MODE_RLBT: 3
        }, WebPDF.Text.CaretInfo = g, WebPDF.Text.PDFTextObject = function() {
            this.objIndex = 0, this.charIndex = 0, this.lineIndex = 0, this.charInfoArray = [], this.objText = "", this.strSize = 0, this.bTrueText = !1, this.textPageMatrix = null, this.writingMode = WebPDF.Text.WritingMode.TEXT_WRITING_MODE_LRBT;
            var a = null;
            this.init = function() {
                this.objText = this.getAllCharCodeText(), this.strSize = this.objText.length, this.bTrueText = !0
            }, this.getSize = function() {
                return this.charInfoArray.length
            }, this.getStrSize = function() {
                return this.strSize
            }, this.getObjectIndex = function(a) {
                var b = this.charInfoArray.length;
                if (0 > a || a >= this.strSize || 0 === b) return 0;
                for (var c = 0, d = 0; b > d; d++) {
                    var e = this.getCharCodeText(d, 1);
                    if (c += e.length, c >= a + 1) return d
                }
                return 0
            }, this.getObjectAllTextRect = function() {
                return this.getObjectTextRect(0, this.charInfoArray.length)
            }, this.getObjectTextRect = function(a, b) {
                var c = this.charInfoArray.length,
                    f = null;
                if (0 >= b || 0 === c || 0 > a + b - 1 || a + b - 1 >= c) return f = new d(0, 0, 0, 0);
                f = e.clone(this.charInfoArray[a].charRect);
                for (var g = a + 1; a + b > g; g++) {
                    var h = this.charInfoArray[g].charRect;
                    e.union(f, h)
                }
                return f
            }, this.getAllObjectPDFRect = function(b) {
                return a || (a = this.getObjectPDFRect(0, this.charInfoArray.length)), b ? e.clone(a) : a
            }, this.getObjectPDFRect = function(a, b) {
                var c = this.charInfoArray.length;
                if (0 > a || a >= c || 0 === c) return new d(0, 0, 0, 0);
                if ((a + b - 1 >= c || -1 === b) && (b = c - a), 0 > a + b - 1 || a + b - 1 >= c) return new d(0, 0, 0, 0);
                var e = this.getObjectTextRect(a, b);
                return e
            }, this.getAllCharCodeText = function() {
                return this.getCharCodeText(0, this.charInfoArray.length)
            }, this.getCharCodeText = function(a, b) {
                var c = this.charInfoArray.length;
                if (0 > a || a >= c) return "";
                if (this.bTrueText && 0 === a && b >= c) return this.objText;
                (a + b - 1 >= c || -1 === b) && (b = c - a);
                for (var d = "", e = a + b - 1, f = a; e >= f; f++) {
                    var g = this.charInfoArray[f],
                        h = String.fromCharCode(g.charCode);
                    d += h
                }
                return d
            }, this.getTextCaretInfo = function(a, b) {
                var c = this.charInfoArray.length;
                if (0 >= c) return !1;
                b.index = -1;
                var d = this.getObjectAllTextRect();
                if (!e.ptInRect(d, a)) return !1;
                for (var f = 0; c > f; f++) {
                    var g = this.getObjectTextRect(f, 1);
                    if (e.ptInRect(g, a)) {
                        var h = Math.abs(a.x - g.left),
                            i = Math.abs(g.right - g.left);
                        h > i / 2 ? b.bLeft = !1 : b.bLeft = !0, b.index = f;
                        break
                    }
                }
                return -1 !== b.index
            }, this.getTextCaretInfoByIndex = function(a, b, c) {
                var d = this.charInfoArray.length;
                return 0 >= d ? !1 : 0 > a || a >= d ? !1 : (b.bLeft = c, b.index = a, !0)
            }
        }, WebPDF.Text.PDFTextObject
    }), define("core/Plugins/Text/PDFTextPage", ["core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect"], function(a, b, c) {
        var d = a("core/Plugins/Text/PDFTextObject"),
            e = (WebPDF.PDFPoint, WebPDF.PDFRect),
            f = (WebPDF.Common, WebPDF.RectUtils),
            g = function(a, b) {
                this.startIndex = a, this.endIndex = b
            };
        WebPDF.Text.TextBoundInfo = g;
        var h = WebPDF.Text.CharInfo;
        return WebPDF.Text.PDFTextPage = function() {
            function a() {
                var a = l.textObjectList.length;
                return 0 === a ? 0 : l.textObjectList[a - 1].lineIndex + 1
            }

            function b(a) {
                var b = /^[0-9a-zA-Z]*$/;
                return !(a > 255 || !b.test(a) && "." != a && "-" != a)
            }

            function c(a, b, c, d) {
                if (b > c) return !1;
                var e, g, h, i, j = -1,
                    k = -1;
                for (e = b; c >= e; e++) {
                    if (i = l.textObjectList[e].getAllObjectPDFRect(!0), f.intersect(i, a), !f.isEmpty(i))
                        for (h = l.textObjectList[e].getSize(), g = 0; h > g; g++)
                            if (i = l.textObjectList[e].getObjectPDFRect(g, 1), f.intersect(i, a), !f.isEmpty(i)) {
                                j = l.textObjectList[e].objIndex + g;
                                break
                            }
                    if (-1 !== j) break
                }
                if (-1 === j) return !1;
                for (e = c; e >= b; e--) {
                    if (i = l.textObjectList[e].getAllObjectPDFRect(!0), f.intersect(i, a), !f.isEmpty(i))
                        for (h = l.textObjectList[e].getSize(), g = h - 1; g >= 0; g--)
                            if (i = l.textObjectList[e].getObjectPDFRect(g, 1), f.intersect(i, a), !f.isEmpty(i)) {
                                k = l.textObjectList[e].objIndex + g;
                                break
                            }
                    if (-1 !== k) break
                }
                return d.startIndex = j, d.endIndex = k, !0
            }

            function i(a) {
                if (0 > a || a >= l.getSize()) return -1;
                var c = l.getPageText(a, 1),
                    d = c.length;
                if (0 === d) return a;
                var e;
                for (e = d - 1; e >= 0; e--)
                    if (!b(c.charAt(e))) return e === d - 1 ? -1 : a;
                var f = l.getLineIndexByIndex(a),
                    h = new g(-1, -1),
                    j = l.getLineRange(f, h);
                if (!j) return -1;
                var k = h.startIndex,
                    m = h.endIndex;
                k = l.textObjectList[k].objIndex, m = l.textObjectList[m].objIndex + l.textObjectList[m].getSize() - 1;
                var n = !1,
                    o = 0;
                for (e = a - 1; e >= k; e--) {
                    c = l.getPageText(e, 1), d = c.length;
                    for (var p = d - 1; p >= 0; p--)
                        if (!b(c.charAt(p))) {
                            o = p === d - 1 ? e + 1 : e, n = !0;
                            break
                        }
                    if (n) break
                }
                if (n || (o = k), o !== k) return o;
                if (0 === f) return o;
                if (h.startIndex = -1, h.endIndex = -1, j = l.getLineRange(f - 1, h), !j) return -1;
                k = h.startIndex, m = h.endIndex, m = l.textObjectList[m].objIndex + l.textObjectList[m].getSize() - 1, c = l.getPageText(m, 1), d = c.length;
                var q = l.getPageText(o, 1);
                if ("-" != q.charAt(0) && "-" != c.charAt(d - 1)) return o;
                var r = i(m);
                return -1 != r && (o = r), o
            }

            function j(a) {
                if (0 > a || a >= l.getSize()) return -1;
                var c = l.getPageText(a, 1),
                    d = c.length;
                if (0 === d) return a;
                var e;
                for (e = 0; d > e; e++)
                    if (!b(c.charAt(e))) return 0 === e ? -1 : a;
                var f = l.getLineIndexByIndex(a),
                    h = new g(-1, -1),
                    i = l.getLineRange(f, h);
                if (!i) return -1;
                var k = h.startIndex,
                    m = h.endIndex;
                m = l.textObjectList[m].objIndex + l.textObjectList[m].getSize() - 1;
                var n = !1,
                    o = 0;
                for (e = a + 1; m >= e; e++) {
                    c = l.getPageText(e, 1), d = c.length;
                    for (var p = 0; d > p; p++)
                        if (!b(c.charAt(p))) {
                            o = 0 === p ? e - 1 : e, n = !0;
                            break
                        }
                    if (n) break
                }
                if (n || (o = m), o !== m) return o;
                if (f === l.lineCount - 1) return o;
                if (h.startIndex = -1, h.endIndex = -1, i = l.getLineRange(f + 1, h), !i) return -1;
                k = h.startIndex, m = h.endIndex, k = l.textObjectList[k].objIndex, m = l.textObjectList[m].objIndex + l.textObjectList[m].getSize() - 1, c = l.getPageText(m, 1);
                var q = l.getPageText(o, 1);
                if ("-" != q.charAt(q.length - 1) && "-" != c.charAt(0)) return o;
                var r = j(k);
                return -1 != r && (o = r), o
            }

            function k(a) {
                for (var b = l.textObjectList.length, c = 0; b > c; c++)
                    if (a <= l.textObjectList[c].objIndex + l.textObjectList[c].getSize() - 1) return a < l.textObjectList[c].objIndex ? -1 : c;
                return -1
            }
            this.textObjectList = [], this.strSize = 0, this.pageIndex = -1, this.lineCount = 0;
            var l = this;
            this.init = function(b) {
                try {
                    if (!b) return !1;
                    if (null == b.pagenum) return console.warn("Page index of text data is null."), !1;
                    if (this.pageIndex = parseInt(b.pagenum), null == b.texts) return console.warn("Parse text object data failed."), !1;
                    for (var c = b.texts, g = 0; g < c.length; g++) {
                        var i = c[g];
                        if (null == i.li || null == i.ci || null == i.oi || null == i.cs) return console.warn("Parse text object data failed."), !1;
                        var j = new d;
                        j.lineIndex = parseInt(i.li), j.objIndex = parseInt(i.oi), j.charIndex = parseInt(i.ci);
                        for (var k = i.cs, l = 0; l < k.length; l++) {
                            var m = k[l];
                            if (5 !== m.length) return !1;
                            var n = new h,
                                o = parseFloat(m[0]),
                                p = parseFloat(m[1]),
                                q = parseFloat(m[2]),
                                r = parseFloat(m[3]);
                            n.charRect = new e(o, p, o + q, p + r), f.normalize(n.charRect), n.charCode = parseInt(m[4]), j.charInfoArray.push(n)
                        }
                        if (j.textPageMatrix = new WebPDF.PDFMatrix, "undefined" != typeof i.mt && null != i.mt) {
                            var s = i.mt;
                            j.textPageMatrix.Set(s[0], s[1], s[2], s[3], s[4], s[5])
                        } else j.textPageMatrix.Set(1, 0, 0, 1, 0, 0);
                        "undefined" != typeof i.wm && null != i.wm && (j.writingMode = i.wm), j.init(), this.textObjectList.push(j)
                    }
                    var t = this.textObjectList[this.textObjectList.length - 1];
                    t ? this.strSize = t.charIndex + t.getStrSize() + 1 : this.strSize = 0, this.lineCount = a()
                } catch (u) {
                    return console.error(u), !1
                }
                return !0
            }, this.getObjTextIndexByPoint = function(a) {
                for (var b = this.textObjectList.length, c = 0; b > c; c++) {
                    var d = this.textObjectList[c].getAllObjectPDFRect(!1);
                    if (f.ptInRect(d, a.x, a.y)) return c
                }
                return -1
            }, this.getCharIndexByPoint = function(a) {
                var b = this.getObjTextIndexByPoint(a);
                if (-1 === b) return -1;
                for (var c = this.textObjectList[b].getSize(), d = -1, e = 0; c > e; e++) {
                    var g = this.textObjectList[b].getObjectPDFRect(e, 1);
                    if (f.ptInRect(g, a.x, a.y)) {
                        d = e;
                        break
                    }
                }
                return -1 === d ? -1 : this.textObjectList[b].objIndex + d
            }, this.getPDFRect = function(a, b, c, d) {
                var e = [],
                    f = this.getSize();
                if (0 > a || a >= f || 0 >= b) return e;
                a + b > f && (b = f - a);
                for (var g = -1, h = -1, i = this.textObjectList.length, j = 0; i > j; j++) {
                    var k = this.textObjectList[j],
                        l = k.objIndex + k.getSize() - 1;
                    if (l >= a) {
                        g = j, h = a - k.objIndex, 0 > h && (h = 0, b--);
                        break
                    }
                }
                for (var m = g, n = h, o = 0; b > 0;) {
                    if (m >= i) return 0;
                    var p = this.textObjectList[m],
                        q = p.getSize(),
                        r = q - n,
                        s = p.getObjectPDFRect(n, b);
                    if (e.push(s), "undefined" != typeof c && null != c && c.push(p.textPageMatrix), "undefined" != typeof d && null != d && d.push(p.writingMode), o++, b -= r, b > 0 && i - 1 > m) {
                        var t = p.objIndex + q - 1,
                            u = this.textObjectList[m + 1].objIndex;
                        u - t !== 1 && b--
                    }
                    m++, n = 0
                }
                return e
            }, this.getObjIndexByCharIndex = function(a) {
                if (a >= this.strSize) return -1;
                for (var b = this.textObjectList.length, c = 0; b > c; c++) {
                    var d = this.textObjectList[c];
                    if (a <= d.charIndex + d.getStrSize() - 1) {
                        if (a < d.charIndex) return c > 0 && d.lineIndex !== this.textObjectList[c - 1].lineIndex ? d.objIndex : d.objIndex - 1;
                        var e = a - d.charIndex;
                        return d.objIndex + d.getObjectIndex(e)
                    }
                }
                return 0
            }, this.getStrSize = function() {
                return this.strSize
            }, this.getSize = function() {
                var a = this.textObjectList.length;
                return 0 === a ? 0 : this.textObjectList[a - 1].objIndex + this.textObjectList[a - 1].getSize()
            }, this.getPageAllText = function() {
                var a = this.textObjectList.length;
                return 0 === a ? "" : this.getPageText(0, this.getSize())
            }, this.getPageText = function(a, b) {
                var c = this.getSize();
                if (0 > a || a >= c || 0 >= b) return "";
                a + b > c && (b = c - a);
                for (var d = -1, e = -1, f = this.textObjectList.length, g = "", h = 0; f > h; h++) {
                    var i = this.textObjectList[h],
                        j = i.objIndex + i.getSize() - 1;
                    if (j >= a) {
                        d = h, e = a - i.objIndex, 0 > e && (e = 0, g = " ", b--);
                        break
                    }
                }
                for (var k = d, l = e; b > 0;) {
                    if (k >= f) return "";
                    var m = this.textObjectList[k],
                        n = m.getSize(),
                        o = n - l;
                    if (g += m.getCharCodeText(l, b), b -= o, b > 0 && k !== f - 1) {
                        var p = this.textObjectList[k + 1],
                            q = p.objIndex,
                            r = m.objIndex + m.getSize() - 1,
                            s = p.lineIndex,
                            t = m.lineIndex;
                        if (s != t) {
                            var u = p.charIndex,
                                v = m.charIndex + m.getStrSize() - 1;
                            u - v !== 1 && (g += "\r\n")
                        } else q - r !== 1 && (g += " ", b--)
                    }
                    k++, l = 0
                }
                return g
            }, this.getBoundPageInfo = function(a, b) {
                for (var d = 0; d < this.lineCount; d++) {
                    var e = new g(-1, -2);
                    this.getLineRange(d, e);
                    var f = new g(-1, -1);
                    c(a, e.startIndex, e.endIndex, f) && b.push(f)
                }
                return 0 !== b.length
            }, this.getWordRange = function(a, b) {
                return 0 > a || a >= this.getSize() ? !1 : (b.startIndex = i(a), -1 === b.startIndex && (b.startIndex = b.endIndex = a), b.endIndex = j(a), -1 === b.endIndex && (b.startIndex = b.endIndex = a), !0)
            }, this.getLineRange = function(a, b) {
                var c = this.binarySearch(a);
                if (-1 === c) return !1;
                b.startIndex = b.endIndex = c;
                for (var d = c - 1; d >= 0 && this.textObjectList[d].lineIndex === a; d--) b.startIndex = d;
                for (var e = this.textObjectList.length, f = c + 1; e > f && this.textObjectList[f].lineIndex === a; f++) b.endIndex = f;
                return !0
            }, this.binarySearch = function(a) {
                for (var b, c = 0, d = this.textObjectList.length - 1; d >= c;) {
                    if (b = parseInt((c + d) / 2), this.textObjectList[b].lineIndex === a) return b;
                    this.textObjectList[b].lineIndex > a ? d = b - 1 : c = b + 1
                }
                return -1
            }, this.getLineIndexByIndex = function(a) {
                for (var b = this.textObjectList.length, c = 0; b > c; c++)
                    if (a <= this.textObjectList[c].objIndex + this.textObjectList[c].getSize() - 1) return this.textObjectList[c].lineIndex;
                return -1
            }, this.getCaretByIndex = function(a, b, c) {
                if (0 > a || a >= this.getSize()) return !1;
                var d = k(a);
                if (-1 === d) return !1;
                var e = a - this.textObjectList[d].objIndex;
                return this.textObjectList[d].getTextCaretInfoByIndex(e, b, c), b.index += this.textObjectList[d].objIndex, !0
            }, this.getCaretAtPoint = function(a, b) {
                var c = this.getObjTextIndexByPoint(a);
                if (-1 === c) return !1;
                var d = this.textObjectList[c].getTextCaretInfo(a, b);
                return d ? (b.index += this.textObjectList[c].objIndex, !0) : !1
            }
        }, WebPDF.Text.PDFTextPage
    }), define("core/Plugins/Offline/OfflineFileCache", ["core/WebStorage"], function(a, b, c) {
        a("core/WebStorage");
        var d = new RegExp(/http(s)?:\/\/.*?/),
            e = null,
            f = function() {
                function a(a, b) {
                    for (var c in a)
                        if (a[c].data.fileName == b) return !0;
                    return !1
                }
                return this.init = function() {
                    return e || (e = new Promise(function(a, b) {
                        var c = WebPDF.initIndexedDB("offlineFiles"),
                            d = WebPDF.initIndexedDB("offlineList", null, null);
                        Promise.all([c, d]).then(function() {
                            WebPDF.getDBList("offlineList").then(function(c) {
                                var d = [];
                                for (var e in c) {
                                    var g = c[e].state;
                                    "loading" == g && d.push(f.failCache(c[e].type))
                                }
                                Promise.all(d).then(a)["catch"](b)
                            })
                        })["catch"](function() {
                            b()
                        })
                    })), e
                }, this.render = function(a) {
                    var b = '<div><div id="fwr-offlinepanel-toolbar"></div><div class="fwr-offlinepanel-split"></div><div id="fwr-offlinepanel-filelist"></div></div>';
                    $("#" + a).html(b);
                    var c = $('<input type="checkbox" title="' + i18n.t("OffLine.CheckAll") + '"/>');
                    c.change(function() {
                        $(this).is(":checked") ? $('#fwr-offlinepanel-filelist input[name="offline-chx"]').attr("checked", "true") : $('#fwr-offlinepanel-filelist input[name="offline-chx"]').removeAttr("checked")
                    }), $("#fwr-offlinepanel-toolbar").append(c);
                    var d = $('<div class="fwr-offlinepanel-btndel" title="' + i18n.t("OffLine.DelCache") + '"/>');
                    d.click(function() {
                        var a = $('#fwr-offlinepanel-filelist input[name="offline-chx"]:checked');
                        if (a.length > 0) {
                            var b = i18n.t("OffLine.CacheRemoveDialogMsg"),
                                c = i18n.t("CommonDialog.DefaultOKBtnTitle"),
                                d = i18n.t("CommonDialog.DefaultCancelBtnTitle");
                            WebPDF.confirm(WebPDF.Tool.getReaderApp(), null, b, c, d, function(b) {
                                if (b) {
                                    var c = [];
                                    a.each(function(a) {
                                        var b = $(this).attr("ref");
                                        c.push(f.removeCache(b))
                                    }), Promise.all(c).then(f.refreshPanel)["catch"](f.refreshPanel), $('#fwr-offlinepanel-filelist input[name="offline-chx"]').size() === a.length && $('#fwr-offlinepanel-toolbar input[type="checkbox"]:first').removeAttr("checked")
                                }
                            })
                        }
                    }), $("#fwr-offlinepanel-toolbar").append(d);
                    var e = $('<div class="fwr-offlinepanel-btninadd" title="' + i18n.t("OffLine.AddCache") + '"/>');
                    $("#fwr-offlinepanel-toolbar").append(e);
                    var h = $('<div class="fwr-offlinepanel-btnadd" title="' + i18n.t("OffLine.AddCache") + '"/>');
                    h.click(function() {
                        g.inited() || g.create(), g.show()
                    }), $("#fwr-offlinepanel-toolbar").append(h), $("#fwr-offlinepanel-filelist").click(function(a) {
                        var b = a.target.getAttribute("data");
                        return b ? void f.openOfflineFile(b) : (b = a.target.getAttribute("faildata"), b ? void f.reStartCache(b) : void 0)
                    }), f.init().then(function() {
                        f.refreshPanel()
                    })
                }, this.refreshPanel = function() {
                    function a() {
                        $('#fwr-offlinepanel-filelist input[name="offline-chx"]').change(function() {
                            $(this).is(":checked") && $('#fwr-offlinepanel-filelist input[name="offline-chx"]').size() === $('#fwr-offlinepanel-filelist input[name="offline-chx"]:checked').size() ? $('#fwr-offlinepanel-toolbar input[type="checkbox"]:first').attr("checked", "true") : $('#fwr-offlinepanel-toolbar input[type="checkbox"]:first').removeAttr("checked")
                        })
                    }
                    WebPDF.getDBList("offlineList").then(function(b) {
                        $("#fwr-offlinepanel-filelist").empty(), $('#fwr-offlinepanel-toolbar input[type="checkbox"]:first').removeAttr("checked");
                        var c = 0;
                        for (var d in b) {
                            c++;
                            var e = b[d].state;
                            if ("loading" == e) $("#fwr-offlinepanel-filelist").append('<span class="fwr-offlinepanel-list"><input type="checkbox" ref="' + d + '" name="offline-chx"/><div class="fwr-offlinepanel-file"/><div class="fwr-offlinepanel-loadingtxt">' + b[d].data.fileName + '</div><div class="fwr-offlinepanel-loading"/></span>');
                            else if ("fail" == e) {
                                var f = i18n.t("OffLine.FailItemTip");
                                $("#fwr-offlinepanel-filelist").append('<span class="fwr-offlinepanel-list"><input type="checkbox" ref="' + d + '" name="offline-chx"/><div class="fwr-offlinepanel-failfile" title="' + f + '"/><div class="fwr-offlinepanel-failfiletext" title="' + f + '">' + b[d].data.fileName + '</div><div class="fwr-offlinepanel-restart" faildata="' + d + '" title="' + i18n.t("OffLine.RetryCache") + '"/></span>')
                            } else $("#fwr-offlinepanel-filelist").append('<span class="fwr-offlinepanel-list"><input type="checkbox" ref="' + d + '" name="offline-chx"/><div class="fwr-offlinepanel-file"/><div data="' + d + '" title="' + b[d].data.fileName + '" class="fwr-offlinepanel-txt">' + b[d].data.fileName + "</div></span>")
                        }
                        10 > c ? ($(".fwr-offlinepanel-btninadd").hide(), $(".fwr-offlinepanel-btnadd").show()) : ($(".fwr-offlinepanel-btnadd").hide(), $(".fwr-offlinepanel-btninadd").show()), a()
                    })
                }, this.addCache = function(b, c) {
                    var d = b.substring(b.lastIndexOf("/") + 1);
                    c || (c = "" + Math.floor(1e5 * Math.random())), WebPDF.getDBList("offlineList").then(function(e) {
                        for (var g = a(e, d), h = 0; g;) {
                            h++;
                            var i = d.substr(0, d.length - 4) + "(" + h.toString() + ").pdf";
                            g = a(e, i), g || (d = i)
                        }
                        WebPDF.putData("offlineList", {
                            type: c,
                            state: "loading",
                            data: {
                                offlineID: c,
                                url: b,
                                fileName: d
                            }
                        }).then(function() {
                            f.refreshPanel();
                            var a = new XMLHttpRequest,
                                e = b.indexOf("blob") ? "blob" : "arraybuffer";
                            a.open("GET", b, !0), a.responseType = e, a.addEventListener("load", function(a) {
                                if (200 == this.status || 304 == this.status) {
                                    var e = this.response,
                                        g = e.size;
                                    if (g > 31457280) return f.failCache(c).then(f.refreshPanel), void WebPDF.alert(WebPDF.Tool.getReaderApp(), null, i18n.t("OffLine.FailToCacheLargeFile"), null, null, !1, 0);
                                    var h = this.getResponseHeader("Last-Modified"),
                                        i = new SparkMD5.ArrayBuffer,
                                        j = new FileReader;
                                    j.readAsArrayBuffer(e), j.onload = function(a) {
                                        var e = new Uint8Array(a.target.result);
                                        1048576 > g ? i.append(e.buffer) : i.append(new Uint8Array(e.subarray(0, 1024)).buffer);
                                        var j = i.end();
                                        f.putCacheFromStream(c, e.buffer, {
                                            offlineID: c,
                                            md5: j,
                                            url: b,
                                            fileName: d,
                                            lastModifyTime: h
                                        }).then(function() {
                                            f.refreshPanel()
                                        })["catch"](function() {
                                            f.failCache(c).then(f.refreshPanel)
                                        })
                                    }
                                } else f.failCache(c).then(f.refreshPanel)
                            }, !1), a.addEventListener("error", function() {
                                f.failCache(c).then(f.refreshPanel)
                            }, !1), a.send()
                        })
                    })
                }, this.failCache = function(a) {
                    return new Promise(function(b, c) {
                        WebPDF.getDataByKey("offlineList", a).then(function(d) {
                            WebPDF.putData("offlineList", {
                                type: a,
                                state: "fail",
                                data: d.data
                            }).then(b)["catch"](c)
                        })["catch"](c)
                    })
                }, this.reStartCache = function(a) {
                    WebPDF.getDataByKey("offlineList", a).then(function(b) {
                        var c = b.data.url;
                        c && f.addCache(c, a)
                    })
                }, this.addCacheFromStream = function(b, c, d) {
                    return new Promise(function(e, g) {
                        c.byteLength > 31457280 ? (WebPDF.alert(WebPDF.Tool.getReaderApp(), null, i18n.t("OffLine.FailToCacheLargeFile"), null, null, !1, 0), g()) : WebPDF.getDataByKey("offlineList", b).then(function(h) {
                            h ? e() : WebPDF.getDBList("offlineList").then(function(h) {
                                for (var i = a(h, d.fileName), j = 0; i;) {
                                    j++;
                                    var k = d.fileName.substr(0, d.fileName.length - 4) + "(" + j.toString() + ").pdf";
                                    i = a(h, k), i || (d.fileName = k)
                                }
                                putCacheFromStream(b, c, d).then(function() {
                                    f.refreshPanel(), e()
                                })["catch"](g)
                            })
                        })
                    })
                }, this.putCacheFromStream = function(a, b, c) {
                    return new Promise(function(d, e) {
                        b.byteLength > 31457280 && e();
                        var f = WebPDF.putData("offlineList", {
                                type: a,
                                data: c
                            }),
                            g = WebPDF.putData("offlineFiles", {
                                type: a,
                                data: b
                            });
                        Promise.all([f, g]).then(function() {
                            d()
                        })["catch"](function() {
                            e()
                        })
                    })
                }, this.removeCache = function(a) {
                    return new Promise(function(b, c) {
                        var d = WebPDF.delData("offlineList", a);
                        WebPDF.delData("offlineFiles", a);
                        Promise.all([d, d]).then(b)["catch"](c)
                    })
                }, this.openOfflineFile = function(a) {
                    this.init().then(function() {
                        WebPDF.getDataByKey("offlineList", a).then(function(b) {
                            WebPDF.getDataByKey("offlineFiles", a).then(function(c) {
                                if (c) {
                                    WebPDF.Tool.getReaderApp().openOfflineFile(c.data, b.data);
                                    var d = JSON.stringify({
                                        uuid: a,
                                        pageIndex: 0,
                                        offsetTop: 0,
                                        zoom: 1
                                    });
                                    WebPDF.Tool.getReaderApp().setCurOfflineFile(d)
                                } else {
                                    var e = i18n.t("OffLine.FailToOpen");
                                    WebPDF.alert(WebPDF.Tool.getReaderApp(), null, e, null, null, !1, 0)
                                }
                            })
                        })
                    })
                }, this
            }(),
            g = function() {
                return this.create = function() {
                    var a = i18n.t("ReaderName"),
                        b = i18n.t("CommonLng.Create.OnlineUrl"),
                        c = i18n.t("CommonLng.Create.CacheIt"),
                        e = i18n.t("CommonLng.Create.Cancel"),
                        h = i18n.t("OffLine.InvalidURL"),
                        i = "<div id='offlineInputDlg' class='fwr-print-dlg fwr-modal fwr-hide fwr-fade fwr-in ' style='display: none; z-index: 1004; top: 30%; outline: 0px; position: absolute; height: auto; width: 350px;'><div class='fwr-modal-header' ><a class='close' webpdf-data-dismiss='modal'></a><h4 >" + a + "</h4></div><div id='offlineInputContent' class='fwr-modal-body fwr-dialog-padding ui-dialog-content ui-widget-content'><div>" + b + "</div><input type='text' id='offlineInput' style='width:100%;margin-top:20px;background: white;height: 29px;border: 1px #C0C0C0 solid;' ><div class='errmsg'>" + h + "</div></div><div class='fwr-modal-footer'><a href='#' id='offlineInputokId' class='btn btn-success' >" + c + "</a><a href='#' id='offlineInputCancelId' class='btn' webpdf-data-dismiss='modal'>" + e + "</a></div></div>";
                    $("#" + WebPDF.Tool.getReaderApp().getMainFrameId()).append(i), $("#offlineInputokId").click(function() {
                        var a = $("#offlineInput").val();
                        d.test(a) ? (f.addCache(a), g.hide()) : $("#offlineInputDlg .errmsg").show()
                    }), $("#offlineInputCancelId,#offlineInputDlg .close").click(function() {
                        g.hide()
                    })
                }, this.show = function() {
                    $("#offlineInputDlg").show(), $("#offlineInputDlg .errmsg").hide()
                }, this.inited = function() {
                    var a = $("#offlineInputDlg");
                    return a.length > 0
                }, this.hide = function() {
                    $("#offlineInputDlg").hide()
                }, this
            }();
        return f
    }),
    function() {
        window.WebPDF || (window.WebPDF = {}), window.WebPDF.webDB = {
            name: "webpdf",
            version: 1,
            db: {}
        }, window.WebPDF.indexedDB = window.indexedDB || window.webkitIndexedDB || window.mozIndexedDB || window.msIndexedDB, window.WebPDF.isSupportOffline = function() {
            return window.WebPDF.indexedDB ? !0 : !1
        }, window.WebPDF.initIndexedDB = function(a, b, c) {
            return new Promise(function(d, e) {
                if (a ? window.WebPDF.webDB.name = a : a = window.WebPDF.webDB.name, b ? window.WebPDF.webDB.version = b : b = window.WebPDF.webDB.version, !window.WebPDF.indexedDB) return console.log("indexedDB is not support"), void e();
                var f = window.WebPDF.indexedDB.open(a);
                f.onerror = function(b) {
                    console.log("Open webDB" + a + "Error!"), e()
                }, f.onsuccess = function(b) {
                    if (WebPDF.webDB.db[a] = b.target.result, c) {
                        var e = b.target.result.transaction(a, "readwrite"),
                            f = e.objectStore(a);
                        f.put(c)
                    }
                    d()
                }, f.onupgradeneeded = function(b) {
                    window.WebPDF.openStorage(b.target.result, a)
                }
            })
        }, window.WebPDF.openStorage = function(a, b) {
            a.objectStoreNames.contains(b) || a.createObjectStore(b, {
                keyPath: "type"
            })
        }, window.WebPDF.closeDB = function() {
            null != window.WebPDF.webDB.db && window.WebPDF.webDB.db.close()
        }, window.WebPDF.deleteDB = function(a) {
            window.WebPDF.indexedDB || window.WebPDF.indexedDB.deleteDatabase(a)
        }, window.WebPDF.putData = function(a, b, c) {
            return new Promise(function(c, d) {
                var e = WebPDF.webDB.db[a];
                if (e) {
                    var f = e.transaction(a, "readwrite"),
                        g = f.objectStore(a);
                    g.put(b), c()
                } else window.WebPDF.initIndexedDB(a, null, b).then(function() {
                    c()
                })
            })
        }, window.WebPDF.delData = function(a, b) {
            return new Promise(function(c, d) {
                var e = WebPDF.webDB.db[a];
                if (e) {
                    var f = e.transaction(a, "readwrite").objectStore(a);
                    f["delete"](b), c()
                } else window.WebPDF.initIndexedDB(a, null, data).then(function() {
                    var e = WebPDF.webDB.db[a];
                    if (e) {
                        var f = e.transaction(a, "readwrite").objectStore(a);
                        f["delete"](b), c()
                    } else d()
                })["catch"](d)
            })
        }, window.WebPDF.getDataByKey = function(a, b) {
            return new Promise(function(c, d) {
                var e = WebPDF.webDB.db[a].transaction(a, "readwrite"),
                    f = e.objectStore(a),
                    g = f.get(b);
                g.onsuccess = function(a) {
                    c(a.target.result)
                }, g.onerror = function(a) {
                    console.error(a), d()
                }
            })
        }, window.WebPDF.getDBList = function(a) {
            return new Promise(function(b, c) {
                var d = WebPDF.webDB.db[a].transaction(a, "readwrite"),
                    e = d.objectStore(a),
                    f = {};
                e.openCursor().onsuccess = function(a) {
                    var c = a.target.result;
                    c ? (f[c.key] = c.value, c["continue"]()) : b(f)
                }, e.openCursor().onerror = function(a) {
                    console.error("openCursor error!"), c()
                }
            })
        }
    }(), define("core/WebStorage", [], function(a, b, c) {
        return window.WebPDF
    }), define("core/Framework/DataControls", ["core/Framework/JSDataControls", "core/Framework/ServerDataControls", "core/ImageEngine/ImageLazyLoad", "core/WebPDF"], function(a, b, c) {
        function d(b, c) {
            b && c ? a("core/Framework/JSDataControls").JSDataControls.call(this, c) : a("core/Framework/ServerDataControls").ServerDataControls.call(this), this.init()
        }
        var e;
        b.createDataControls = function(a, b) {
            return e = new d(a, b)
        }
    }), define("core/Framework/JSDataControls", [], function(a, b, c) {
        function d(a) {
            this.worker = a;
            var b = [],
                c = null;
            this.init = function() {
                this.worker.onmessage = function(a) {
                    return "getUserFormXml" == a.data.type ? void(c = a.data.originalXML) : void b.forEach(function(c, d) {
                        a.data.type === b[d].fnName && b[d].fnHandle(h(a.data))
                    })
                }
            }, this.getPageImg = function(a) {
                if (a) {
                    var c = WebPDF.Tool.readerApp.getOptions().plugins,
                        d = c & WebPDF.Config.Plugins.flag.Comments ? !1 : !0,
                        f = c & WebPDF.Config.Plugins.flag.Form ? !1 : !0;
                    e(a, b), this.worker.postMessage({
                        type: a.type,
                        pageIndex: a.data.pageIndex,
                        scale: a.data.scale,
                        withAnnots: d,
                        withForm: f,
                        docPermission: a.data.docPermission
                    })
                }
            }, this.getZoomImg = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    pageIndex: a.data.pageIndex,
                    scale: a.data.scale
                }))
            }, this.loadPDF = function(a, c) {
                if (a)
                    if (e(a, b, c), null == a.data.buf || 0 == a.data.buf.byteLength) this.worker.postMessage({
                        type: a.type,
                        ACT: WebPDF.AccountInstance.getAccessToken(),
                        buf: null,
                        password: a.data.pdfPassword
                    });
                    else try {
                        this.worker.postMessage({
                            type: a.type,
                            ACT: WebPDF.AccountInstance.getAccessToken(),
                            buf: a.data.buf,
                            password: a.data.pdfPassword
                        }, [a.data.buf])
                    } catch (d) {
                        this.worker.postMessage({
                            type: a.type,
                            ACT: WebPDF.AccountInstance.getAccessToken(),
                            buf: a.data.buf,
                            password: a.data.pdfPassword
                        })
                    }
            }, this.destroy = function() {}, this.getCommentList = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    unLoadPageStr: a.data.requestData.unLoadPageStr,
                    count: a.data.requestData.count
                }))
            }, this.getAnnots = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    password: a.data.password,
                    pageIndex: a.data.requestData.pageIndex,
                    docPermission: a.data.docPermission
                }))
            }, this.getPageText = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    pageIndex: a.data.requestData.pageIndex,
                    password: a.data.password
                }))
            }, this.seachAllText = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    findtext: a.data.requestData.findtext,
                    pageIndex: a.data.requestData.pageIndex,
                    flags: a.data.requestData.flags,
                    count: a.data.requestData.count,
                    password: a.data.password
                }))
            }, this.searchTextPageIndex = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    startpageindex: a.data.requestData.startpageindex,
                    endpageindex: a.data.requestData.endpageindex,
                    findtext: a.data.requestData.findtext,
                    flags: a.data.requestData.flags,
                    searchDown: a.data.requestData.searchDown
                }))
            }, this.getThumbImg = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    pageIndex: a.data.pageIndex,
                    scale: -1,
                    imageId: a.data.imageId
                }))
            }, this.getPrintImg = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    pageIndex: a.data.pageIndex,
                    scale: 1
                }))
            }, this.exportDocument = function(a) {
                if (a) {
                    WebPDF.downloading();
                    var c = WebPDF.Tool.readerApp.getPDFPassword();
                    c = window.atob(c), e(a, b), this.worker.postMessage({
                        type: a.type,
                        annotData: a.data.annotData,
                        formData: a.data.formData,
                        inkSignData: a.data.inkSignData,
                        wmInfo: a.data.wmInfo,
                        fileName: a.data.fileName,
                        password: c
                    })
                }
            }, this.getBmkInfo = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type
                }))
            }, this.getForm = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type,
                    pageIndex: a.data.pageIndex
                }))
            }, this.exportFormXML = function(a) {
                a && (WebPDF.downloading(), e(a, b), this.worker.postMessage({
                    type: a.type,
                    fileName: a.data.fileName
                }))
            }, this.initLoad = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type
                }))
            }, this.exportFDF = function(a) {
                a && (WebPDF.downloading(), e(a, b), this.worker.postMessage({
                    type: a.type,
                    fileName: a.data.fileName,
                    annotData: a.data.annotData
                }))
            }, this.getUserFormXML = function(a) {
                a && (e(a, b), this.worker.postMessage({
                    type: a.type
                }))
            }, this.loadFontInfo = function(a) {
                a && e(a, b)
            }, this.terminate = function(a) {
                this.worker.postMessage({
                    type: a.type
                }), b = []
            }, this.getFileds = function(a) {
                e(a, b), this.worker.postMessage({
                    type: a.type
                })
            }, this.getPageControlsAP = function(a) {
                e(a, b), this.worker.postMessage({
                    type: a.type,
                    pageIndex: a.data.pageIndex
                })
            }, this.getAnnotsDataFromFDF = function(a) {
                e(a, b), this.worker.postMessage({
                    type: a.type,
                    fileBuffer: a.fileBuffer
                })
            }, this.getPdfBuffer = function(a) {
                e(a, b, !0), this.worker.postMessage({
                    type: a.type
                })
            }, this.flattenPages = function(a) {
                return new Promise(function(a, b) {
                    b("not support")
                })
            }, this.splitDocByRange = function(a) {
                return new Promise(function(a, b) {
                    b("not support")
                })
            }
        }

        function e(a, b, c) {
            if (a) {
                var d = {
                    fnName: a.type,
                    fnHandle: a.success
                };
                g(b, d.fnName) ? c && f(b, d) : b.push(d)
            }
        }

        function f(a, b) {
            a.forEach(function(c, d) {
                b.fnName === a[d].fnName && (a[d] = b)
            })
        }

        function g(a, b) {
            var c = !1;
            return a.forEach(function(d, e) {
                return b === a[e].fnName ? (c = !0, !1) : void 0
            }), c
        }

        function h(a) {
            var b = {};
            for (var c in a) b[c] = a[c];
            return b
        }
        b.JSDataControls = d
    }), define("core/Framework/ServerDataControls", ["core/ImageEngine/ImageLazyLoad", "core/WebPDF"], function(a, b, c) {
        function d() {
            this.init = function() {}, this.getPageImg = function(b) {
                var c = a("core/ImageEngine/ImageLazyLoad");
                new c(b.data.url, b.data.readApp, b.data.pageView, b.success, b.error)
            }, this.getZoomImg = function(a) {}, this.loadPDF = function(a) {
                $.ajax({
                    url: a.data.url,
                    dataType: "json",
                    headers: {
                        "x-auth-doc": a.data.pdfPassword ? a.data.pdfPassword : ""
                    },
                    data: a.data.requestData,
                    success: function(b, c, d) {
                        var e = {
                            response: b,
                            trail: b.trail,
                            xhr: d,
                            error: b.error,
                            docInfo: b.docinfo
                        };
                        "function" == typeof a.success && a.success(e)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.getCommentList = function(a) {
                a.data.requestData.extenParams = WebPDF.Common.getReadableParams(), $.ajax({
                    type: "POST",
                    url: a.data.url,
                    dataType: "json",
                    async: !0,
                    data: a.data.requestData,
                    success: function(b) {
                        var c = {
                            response: b,
                            status: b.status,
                            error: b.error,
                            data: b.data
                        };
                        "function" == typeof a.success && a.success(c)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.getAnnots = function(a) {
                a.data.requestData.extenParams = WebPDF.Common.getReadableParams(), $.ajax({
                    url: a.data.url,
                    dataType: "json",
                    async: a.data.isAsync,
                    data: a.data.requestData,
                    success: function(b) {
                        if (b) {
                            var c = {
                                response: b,
                                status: b.status,
                                error: b.error,
                                data: b.data,
                                pageIndex: a.data.requestData.pageIndex
                            };
                            "function" == typeof a.success && a.success(c)
                        }
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.getPageText = function(a) {
                a.data.requestData.extenParams = WebPDF.Common.getReadableParams(), $.ajax({
                    url: a.data.url,
                    dataType: "json",
                    headers: {
                        "x-auth-doc": a.data.password ? a.data.password : ""
                    },
                    data: a.data.requestData,
                    success: function(b) {
                        var c = {
                            response: b,
                            status: b.status,
                            error: b.error,
                            textPageData: b.TextPageData,
                            pageIndex: a.data.requestData.pageIndex
                        };
                        "function" == typeof a.success && a.success(c)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.seachAllText = function(a) {
                a.data.requestData.extenParams = WebPDF.Common.getReadableParams(), $.ajax({
                    url: a.data.url,
                    type: "POST",
                    dataType: "json",
                    headers: {
                        "x-auth-doc": a.data.password ? a.data.password : ""
                    },
                    data: a.data.requestData,
                    success: function(b) {
                        var c = {
                            response: b,
                            status: b.status,
                            error: b.error,
                            searchResult: b.searchResult
                        };
                        "function" == typeof a.success && a.success(c)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.searchTextPageIndex = function(a) {
                a.data.requestData.extenParams = WebPDF.Common.getReadableParams(), $.ajax({
                    url: a.data.url,
                    type: "POST",
                    dataType: "json",
                    data: a.data.requestData,
                    success: function(b) {
                        "function" == typeof a.success && a.success(b)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.getThumbImg = function(b) {
                var c = a("core/ImageEngine/ImageLazyLoad");
                new c(b.data.url, b.data.readerApp, b.data.pageView, b.success)
            }, this.getPrintImg = function(a) {
                $.ajax({
                    url: a.data.url,
                    ifModified: !0,
                    success: function(b, c, d) {
                        var e = {
                            textStatus: c,
                            ct: d.getResponseHeader("content-type"),
                            data: b,
                            isrc: a.data.url,
                            pageIndex: a.data.pageIndex
                        };
                        "function" == typeof a.success && a.success(e)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.exportDocument = function(a) {
                a.data.pDFDocument.exportPdf(a.data.url, "post", a.data.fileName, a.data.annotData, a.data.formData, a.data.inkSignData, a.data.wmInfo, a.data.language, a.success, a.data.heads, a.data.params)
            }, this.exportFormXML = function(a) {
                a.data.isExportRomete ? a.data.pDFDocument.exportFormXmlToRemote(a.data.url, "post", a.data.fileName, a.data.params, a.data.xmlData, a.success) : a.data.pDFDocument.exportFormXml(a.data.url, "post", a.data.fileName, a.data.xmlData)
            }, this.exportFDF = function(a) {
                a.data.pDFDocument.downloadAnnotFDFbyForm(a.data.exportFDFURL, "post", a.data.fileName, a.data.annotData, function(b) {
                    var c = "{}";
                    a.data.readerApp.addRecord("Share", "ExportComments", c)
                })
            }, this.getUserFormXML = function(a) {
                return !1
            }, this.getBmkInfo = function(a) {
                $.ajax({
                    url: a.data.url,
                    dataType: "json",
                    headers: {
                        "x-auth-doc": a.data.password
                    },
                    success: function(b) {
                        var c = {
                            response: b,
                            status: b.status,
                            error: b.error,
                            bmkInfo: b.BookmarkInfo
                        };
                        "function" == typeof a.success && a.success(c)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.getForm = function(a) {
                $.ajax({
                    url: a.data.url + "?number=" + Math.random(),
                    dataType: "xml",
                    async: a.data.isAsync,
                    success: function(b) {
                        var c = {
                            xmlData: b
                        };
                        "function" == typeof a.success && a.success(c)
                    },
                    error: function() {
                        "function" == typeof a.error && a.error(null)
                    }
                })
            }, this.initLoad = function(a) {
                a.success()
            }, this.terminate = function(a) {
                return !0
            }, this.getPageControlsAP = function(a) {
                var b = {};
                b.extenParams = WebPDF.Common.getReadableParams(), $.ajax({
                    url: a.url,
                    data: b,
                    type: a.type,
                    success: function(b) {
                        null !== b && "function" == typeof a.success && a.success(b)
                    },
                    error: function() {
                        console.log("failed to load form")
                    }
                })
            }, this.getAnnotsDataFromFDF = function(a) {
                var b = null,
                    c = "";
                if ("fileUrl" == a.paramType) b = "fileUrl=" + a.fileUrl, c = "application/x-www-form-urlencoded";
                else {
                    if ("fileBuffer" != a.paramType) return;
                    b = a.fileBuffer, c = "application/octet-stream"
                }
                var d = new XMLHttpRequest;
                d.open("POST", a.url, !0), d.setRequestHeader("Content-type", c), d.responseType = "json", d.onload = function(b) {
                    a.success(this.response)
                }, d.send(b)
            }, this.isFileExist = function(a) {
                var b = WebPDF.optionParameters.serverBaseUrl;
                $.ajax({
                    type: "GET",
                    url: b + "api/file/exist?fileMd5=" + a.fileMd5 + "&version=" + a.version + "&fileSize=" + a.fileSize + "&fileUrl=" + a.fileUrl,
                    success: function(b) {
                        a.success(b)
                    },
                    beforeSend: function() {
                        WebPDF.uploading(null, 0)
                    },
                    uploadProgress: function(a, b, c, d) {
                        WebPDF.uploading(null, d)
                    },
                    error: function(a) {
                        WebPDF.closeUploading(), WebPDF.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                    }
                })
            }, this.uploadFile = function(a) {
                var b = WebPDF.optionParameters.serverBaseUrl,
                    c = b + "api/file/uploadFromBuffer?fileMd5=" + a.fileMd5 + "&version=" + a.version + "&fileSize=" + a.fileSize + "&fileUrl=" + a.fileName,
                    d = new XMLHttpRequest;
                d.open("POST", c, !0), d.setRequestHeader("Content-type", "application/octet-stream"), d.onload = function(b) {
                    a.success(this.response)
                }, d.onerror = function(a, b, c) {
                    WebPDF.closeUploading(), WebPDF.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                }, d.upload.onloadstart = function() {
                    WebPDF.uploading(null, 0)
                }, d.upload.onprogress = function(a, b, c, d) {
                    WebPDF.uploading(null, parseInt(a.loaded / a.total))
                }, d.send(a.fileBuffer)
            }, this.flattenPages = function(a) {
                return new Promise(function(b, c) {
                    var d = WebPDF.optionParameters.serverBaseUrl,
                        e = d + "spi/v2/doc/flatten";
                    $.ajax({
                        url: e,
                        type: "POST",
                        headers: {
                            "x-auth-doc": a.password
                        },
                        data: a,
                        success: function(a) {
                            function e(a) {
                                setTimeout(function() {
                                    f(a).then(function(c) {
                                        return resultCode = c.resultCode, 0 == resultCode ? (b(c.resultBody.uuid), !0) : void e(a)
                                    }, function() {
                                        console.info("flatten task still working!")
                                    })
                                }, 2e3)
                            }

                            function f(a) {
                                return new Promise(function(b, c) {
                                    var e = d + "api/v2/task/" + a + "/query";
                                    $.ajax({
                                        url: e,
                                        success: function(a) {
                                            b(a)
                                        },
                                        error: function() {
                                            console.error("flatten task request error!"), c()
                                        }
                                    })
                                })
                            }
                            if (-1 != a.resultCode) {
                                var g = a.resultBody.taskid;
                                if (!g) return c("task id value invalid!"), !1;
                                e(g)
                            } else console.error("get flatten task id error!"), c()
                        },
                        error: function() {
                            console.error("get flatten task id request error!"), c()
                        }
                    })
                })
            }, this.splitDocByRange = function(a) {
                return new Promise(function(b, c) {
                    var d = WebPDF.optionParameters.serverBaseUrl,
                        e = d + "spi/v2/doc/split";
                    $.ajax({
                        url: e,
                        type: "POST",
                        headers: {
                            "x-auth-doc": a.password
                        },
                        data: a,
                        success: function(a) {
                            function e(a) {
                                setTimeout(function() {
                                    f(a).then(function(c) {
                                        return resultCode = c.resultCode, 0 == resultCode ? (b(c.resultBody.files), !0) : void e(a)
                                    }, function() {
                                        console.info("split task still working!")
                                    })
                                }, 2e3)
                            }

                            function f(a) {
                                return new Promise(function(b, c) {
                                    var e = d + "api/v2/task/" + a + "/query";
                                    $.ajax({
                                        url: e,
                                        success: function(a) {
                                            b(a)
                                        },
                                        error: function() {
                                            console.error("split task request error!"), c()
                                        }
                                    })
                                })
                            }
                            if (-1 != a.resultCode) {
                                var g = a.resultBody.taskid;
                                if (!g) return c("task id value invalid!"), !1;
                                e(g)
                            } else console.error("get split task id error!"), c()
                        },
                        error: function() {
                            console.error("get flatten task id request error!"), c()
                        }
                    })
                })
            }
        }
        b.ServerDataControls = d
    }), define("core/ImageEngine/ImageLazyLoad", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.ImgLazyLoad = function(a, b, c, e, f) {
            var g = {};
            g.extenParams = d.Common.getReadableParams(), $.ajax({
                url: a,
                crossDomain: !0,
                ifModified: !0,
                data: g,
                error: function(a, b, d) {
                    $.isFunction(f) && f(c)
                },
                success: function(a, b, f) {
                    var g, h = f.getResponseHeader("content-type") || "";
                    h.indexOf("application/json") > -1 ? (g = a.status.toString() || a, g != d.ImageEngine.GetImageErrorCode.ERROR_SUCCESS.toString() && g != d.ImageEngine.GetImageErrorCode.ERROR_PAGE_DISPLAY_LIMIT.toString() && g != d.ImageEngine.GetImageErrorCode.ERROR_CREATE_IMG_FAILED.toString() && g != d.ImageEngine.GetImageErrorCode.ERROR_INPROGRESS.toString() || "success" != b || e(c, g)) : (1 === a.length && (g = a), e(c, g))
                }
            })
        }, d.ImgLazyLoad
    }), define("core/Plugins/PDFJS/pdfjs", ["core/Plugins/PDFJS/app", "core/Plugins/PDFJS/color", "core/Plugins/PDFJS/field", "core/Plugins/Form/service/PDFFormConstants", "core/Plugins/PDFJS/doc", "core/Plugins/PDFJS/utils"], function(a, b, c) {
        function d() {
            function b(a) {
                return a = a.replace(/\bthis([^\w])?/g, "thisWebPDFDoc$1"), a = a.replace(/([^\w])this([^\w])/g, "$1thisWebPDFDoc$2"), a = a.replace(/([^\w])event([^\w])/g, "$1webPDFjsEvent$2")
            }
            app = a("core/Plugins/PDFJS/app").App(), color = a("core/Plugins/PDFJS/color").color, Field = a("core/Plugins/PDFJS/field").Field, Doc = a("core/Plugins/PDFJS/doc").Doc, thisWebPDFDoc = new Doc(WebPDF.Tool.readerApp);
            var c = !0,
                d = !1;
            webPDFjsEvent = {
                change: "",
                Example: "",
                changeEx: "",
                commitKey: "",
                fieldFull: "",
                keyDown: "",
                modifier: "",
                name: "",
                rc: "",
                richChange: "",
                richChangeEx: "",
                richValue: "",
                selEnd: "",
                selStart: "",
                shift: "",
                source: "",
                target: "",
                targetName: "",
                type: "",
                value: null,
                willCommit: "",
                bExtractDenpends: !1,
                depends: [],
                isLoading: !1
            }, this.getName = function() {
                return "WebPDFJS"
            }, this.onRegister = function() {}, this.unload = function() {}, this.init = function() {
                $(WebPDF.Tool.readerApp).on(WebPDF.EventList.DOCUMENT_LOADED, function() {
                    thisWebPDFDoc = new Doc(WebPDF.Tool.readerApp)
                })
            }, this.setEnvParams = function(a) {
                for (var b in a) webPDFjsEvent[b] = a[b];
                webPDFjsEvent.source = new Field(a.source), webPDFjsEvent.target = new Field(a.target)
            }, this.getEvent = function() {
                return webPDFjsEvent
            }, window.runPDFJS = function(a) {
                return a = b(a), thisWebPDFDoc.runJs(a)
            }, this.runJs = function(a) {
                a = b(a);
                var c;
                try {
                    c = thisWebPDFDoc.runJs(a)
                } catch (d) {
                    return console.log(d.message), console.log(a), webPDFjsEvent.rc = !1, 0
                }
                return c
            }, this.extractDependencies = function(a) {
                a = b(a), webPDFjsEvent.bExtractDenpends = !0;
                try {
                    thisWebPDFDoc.runJs(a)
                } catch (c) {
                    console.log(c), console.log(a), webPDFjsEvent.rc = !1
                }
                return webPDFjsEvent.bExtractDenpends = !1, webPDFjsEvent.depends
            }, this.clearEnv = function() {
                webPDFjsEvent.depends = [], webPDFjsEvent.isLoading = !1, webPDFjsEvent.value = null
            }, Object.defineProperties(this, {
                enable: {
                    get: function() {
                        return c
                    },
                    set: function(a) {
                        return c = a
                    }
                },
                enableSafeMode: {
                    get: function() {
                        return d
                    },
                    set: function(a) {
                        return d = a
                    }
                }
            })
        }
        b.createPlugin = function() {
            return WebPDF.JSEngine || (WebPDF.JSEngine = new d), WebPDF.JSEngine
        }
    }), define("core/Plugins/PDFJS/app", [], function(a, b, c) {
        function d(a) {
            Object.defineProperties(this, {
                activeDocs: {
                    get: function() {
                        return WebPDF.JSEngine.enableSafeMode ? void 0 : [thisWebPDFDoc]
                    }
                },
                calculate: {
                    get: function() {},
                    set: function() {}
                },
                runtimeHighlight: {
                    get: function() {
                        return WebPDF.FormPlugin.isHighlight()
                    },
                    set: function(a) {
                        return WebPDF.FormPlugin.setHighlight(a)
                    }
                },
                runtimeHighlightColor: {
                    get: function() {
                        return WebPDF.FormPlugin.highlightColor()
                    },
                    set: function(a) {
                        WebPDF.FormPlugin.setHighlightColor(a)
                    }
                }
            });
            this.alert = function(a) {
                var b, c, d = WebPDF.JSEngine.getEvent(),
                    e = a && a.nType && a.nType < 2 ? "OK" : "Yes";
                return a && a.nType ? b = a.nType : (e = "OK", b = 0), c = a && a.cMsg ? a.cMsg : "", c = "undefined" == typeof a ? "undefined" : "string" == typeof a ? a : a.toString(), d.isLoading ? void 0 : b ? confirm(c) ? 1 : 2 : alert(c)
            }, this.launchURL = function(a) {
                function b(b) {
                    1 === b && window.open(a)
                }
                WebPDF.JSEngine.enableSafeMode || ("http://" !== a.substr(0, 7) && "https://" !== a.substr(0, 8) && (a = "http://" + a), WebPDF.alert(null, "Trying to open url:", a, "Yes", b, !1, 1))
            }
        }
        b.App = function(a) {
            return new d(a)
        }
    }), define("core/Plugins/PDFJS/color", [], function(a, b, c) {
        var d = JSON.parse('{"yellow":["CMYK",0,0,1,0],"white":["G",1],"transparent":["T"],"red":["RGB",1,0,0],"magenta":["CMYK",0,1,0,0],"ltGray":["G",0.75],"green":["RGB",0,1,0],"gray":["G",0.5],"dkGray":["G",0.25],"cyan":["CMYK",1,0,0,0],"blue":["RGB",0,0,1],"black":["G",0]}');
        d.equal = function() {}, d.convert = function() {}, b.color = d
    }), define("core/Plugins/PDFJS/field", ["core/Plugins/Form/service/PDFFormConstants"], function(a, b, c) {
        function d(a) {
            var b = this,
                c = a;
            Object.defineProperties(b, {
                charLimit: {
                    get: function() {
                        return c ? c.getMaxLen() : 0
                    }
                },
                comb: {
                    get: function() {
                        return c ? !!c.isComb() : !1
                    }
                },
                exportValues: {
                    get: function() {
                        if (!c) return "";
                        var a = [],
                            b = c;
                        if (b.getType() === e.RadioButton || b.getType() === e.CheckBox)
                            for (var d = b.hasKids() ? b.getKidsCount() : 1, f = 0; d > f; f++) {
                                var g = b.getControl(f);
                                a.push(g.getExportValue())
                            }
                        return a
                    },
                    set: function() {}
                },
                fillColor: {
                    get: function() {
                        if (!c.fieldData.MK || !c.fieldData.MK.BG) return ["T"];
                        var a = c.fieldData.MK.BG,
                            b = parseInt(a.substr(0, 2), 16) / 255,
                            d = parseInt(a.substr(2, 2), 16) / 255,
                            e = parseInt(a.substr(4, 2), 16) / 255;
                        return ["RGB", b, d, e]
                    },
                    set: function(a) {
                        if (c) {
                            var b;
                            return b = WebPDF.FormPlugin.convertColor(a, "HTML"), c.setBGColor(b), a
                        }
                    }
                },
                hidden: {
                    get: function() {
                        return c ? !!c.isHidden() : ""
                    },
                    set: function(a) {
                        return c && c.setHidden(a), a
                    }
                },
                multiline: {
                    get: function() {
                        return c ? !!c.isTextMultiLine() : !1
                    },
                    set: function(a) {
                        var b = c;
                        return b.getType() !== e.Text ? a : (c && c.setTextMultiLine(a), a)
                    }
                },
                name: {
                    get: function() {
                        return c ? c.getTitle() : ""
                    }
                },
                readonly: {
                    get: function() {
                        return c ? !!c.isReadOnly() : !1
                    },
                    set: function(a) {
                        return c && c.setReadOnly(a), a
                    }
                },
                required: {
                    get: function() {
                        return c ? !!c.isRequired() : !1
                    },
                    set: function(a) {
                        return c && c.setRequired(a), a
                    }
                },
                value: {
                    get: function() {
                        return c ? c.getValue() : ""
                    },
                    set: function(a) {
                        return c && c.setValue(a, null, !0), a
                    }
                }
            }), this.checkThisBox = function(a, b) {
                "undefined" == typeof b && (b = !0);
                var d = c;
                if (d.getType() === e.RadioButton || d.getType() === e.CheckBox) {
                    var f = d.getControl(a);
                    b ? d.setValue(f.getExportValue(), null, !0) : d.getValue() === f.getExportValue() && d.setValue("Off", null, !0)
                }
            }, this.clearItems = function() {}, this.defaultIsChecked = function(a, b) {
                "undefined" == typeof b && (b = !0);
                var d = c;
                if (d.getType() === e.RadioButton || d.getType() === e.CheckBox) {
                    var f = d.getControl(a);
                    b ? d.setDefaultValue(f.getExportValue()) : d.setDefaultValue("Off")
                }
            }, this.deleteItemAt = function() {}, this.getArray = function() {}, this.getItenmAt = function(a, b) {
                var d = c;
                if (d.getType() === e.ListBox || d.getType() === e.ComboBox) {
                    var f = d.getOptions(); - 1 === a && (a = f.length - 1);
                    var g = f[a];
                    return "object" == typeof g ? b ? g[0] : g[1] : g
                }
                return ""
            }, this.insertItemAt = function() {}, this.isBoxChecked = function(a) {
                var b = c;
                if (b.getType() === e.RadioButton || b.getType() === e.CheckBox) {
                    var d = b.getControl(a);
                    return b.getValue() === d.getExportValue() ? !0 : !1
                }
                return !1
            }, this.isDefaultChecked = function(a) {
                var b = c;
                if (b.getType() === e.RadioButton || b.getType() === e.CheckBox) {
                    var d = b.getControl(a);
                    return b.getDefaultValue() === d.getExportValue() ? !0 : !1
                }
                return !1
            }, this.setFocus = function() {
                c && c.focus()
            }
        }
        var e = a("core/Plugins/Form/service/PDFFormConstants").fieldType;
        b.Field = d
    }), define("core/Plugins/Form/service/PDFFormConstants", [], function(a, b, c) {
        b.fieldType = {
            Unknown: 0,
            PushButton: 1,
            RadioButton: 2,
            CheckBox: 3,
            Text: 4,
            RichText: 5,
            File: 6,
            ListBox: 7,
            ComboBox: 8,
            Sign: 9
        }, b.fieldFlag = {
            ReadOnly: 1,
            Required: 2,
            NoExport: 4,
            MultiLine: 4096,
            Password: 8192,
            Radio: 32768,
            Button: 65536,
            Combo: 1 << 17,
            Edit: 1 << 18,
            FileSelect: 1 << 20,
            NoSpellCheck: 1 << 22,
            NoScroll: 1 << 23,
            Comb: 1 << 24,
            InUnison: 1 << 25
        }, b.actionFlag = {
            IncludeOrExclude: 1,
            IncludeNoValueFields: 2,
            ExportFormat: 4,
            GetMethod: 8,
            SubmitCoordinates: 16,
            XFDF: 32,
            IncludeAppendSaves: 64,
            IncludeAnnotations: 128,
            SubmitPDF: 256,
            CanonicalFormat: 512,
            ExclNonUserAnnots: 1024,
            ExclFKey: 2048,
            EmbedForm: 8192
        }
    }), define("core/Plugins/PDFJS/doc", ["core/Plugins/PDFJS/field", "core/Plugins/Form/service/PDFFormConstants", "core/Plugins/PDFJS/utils"], function(a, b, c) {
        function d(a) {
            f = a, Object.defineProperties(this, {
                author: {
                    get: function() {
                        var a = f.getDocView().getPDFDoc();
                        return a.getDocProperties().getAuthor()
                    },
                    set: function() {}
                },
                calculate: {
                    get: function() {},
                    set: function() {}
                },
                creationDate: {
                    get: function() {
                        var a = f.getDocView().getPDFDoc();
                        return a.getDocProperties().getCreationDate()
                    }
                },
                creator: {
                    get: function() {
                        var a = f.getDocView().getPDFDoc();
                        return a.getDocProperties().getCreator()
                    }
                },
                dirty: {
                    get: function() {
                        return f.getDocView().isModified()
                    },
                    set: function(a) {
                        return f.getDocView().setModified(a), a
                    }
                },
                documentFileName: {
                    get: function() {
                        return f.getFileName()
                    }
                },
                filesize: {
                    get: function() {}
                },
                info: {
                    get: function() {
                        var a = f.getDocView().getPDFDoc(),
                            b = a.getDocProperties();
                        return {
                            Title: b.getTitle(),
                            Author: b.getAuthor(),
                            Subject: b.getSubject(),
                            Keywords: b.getKeywords(),
                            Creator: b.getCreator(),
                            Producer: b.getProducer(),
                            CreationDate: b.getCreationDate(),
                            ModDate: b.getModifyDate(),
                            Trapped: ""
                        }
                    }
                },
                keywords: {
                    get: function() {
                        var a = f.getDocView().getPDFDoc();
                        return a.getDocProperties().getKeywords()
                    }
                },
                layout: {
                    get: function() {
                        var a = f.getDocView().getPdfViewerShowMode();
                        switch (a) {
                            case 0:
                                return "OneColumn";
                            case 2:
                                return "SinglePage"
                        }
                    }
                },
                modDate: {
                    get: function() {
                        var a = f.getDocView().getPDFDoc();
                        return a.getDocProperties().getModifyDate()
                    }
                },
                numFields: {
                    get: function() {
                        return WebPDF.FormPlugin.form.numFields()
                    }
                },
                numPages: {
                    get: function() {
                        var a = f.getDocView().getPDFDoc();
                        return a.getPageCount()
                    }
                },
                path: {
                    get: function() {
                        return ""
                    }
                },
                pageNum: {
                    get: function() {
                        return f.getDocView().getCurPageIndex()
                    },
                    set: function(a) {
                        var b = f.getDocView().getPageCount() <= a ? f.getDocView().getPageCount() - 1 : a;
                        return f.getDocView().gotoPage(b), a
                    }
                }
            }), this.calculateNow = function() {}, this.closeDoc = function() {}, this.getField = function(a) {
                var b = WebPDF.FormPlugin.form.getFieldByName(a),
                    c = WebPDF.JSEngine.getEvent();
                return c.bExtractDenpends && c.depends.push(a), new e(b)
            }, this.getNthFieldname = function(a) {
                return WebPDF.FormPlugin.form.getNthFieldName(a)
            }, this.getPageBox = function(a, b) {
                a = "Crop", "undefined" == typeof b && (b = 0)
            }, this.getPageRotation = function() {
                return f.getDocView().getRotate()
            }, this.print = function(a, b, c, d, e, f, g, h, i) {
                WebPDF.ViewerInstance.print()
            }, this.resetForm = function(a) {
                var b, c, d;
                if (a)
                    for (b = 0; b < a.length; b++) c = WebPDF.FormPlugin.form.getFieldByName(a[b]), c && (d = c.getDefaultValue(), c.setValue(d, null, !0));
                else
                    for (b = 0; b < WebPDF.FormPlugin.form.numFields(); b++) {
                        var e = WebPDF.FormPlugin.form.getNthFieldName(b);
                        c = WebPDF.FormPlugin.form.getFieldByName(e), d = c.getDefaultValue(), c.setValue(d, null, !0)
                    }
            }, this.submitForm = function(a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x) {
                var y, z, A;
                1 === arguments.length && "object" == typeof arguments[0] ? (y = arguments[0].cURL, A = arguments[0].bGet, z = arguments[0].bHTMLForm) : (y = a, A = e, z = x);
                var B = {};
                if (z)
                    for (var C = WebPDF.FormPlugin.form.numFields(), D = 0; C > D; D++) {
                        var E = WebPDF.FormPlugin.form.getNthFieldName(D),
                            F = WebPDF.FormPlugin.form.getFieldByName(E);
                        B[F.getTitle()] = F.getValue()
                    } else B = {
                        formData: WebPDF.FormPlugin.form.exportFDF()
                    };
                $.ajax({
                    url: y,
                    type: A ? "GET" : "POST",
                    data: B,
                    async: !1,
                    success: function(a) {
                        console.log("submit form success."), console.log(a)
                    },
                    error: function(a) {
                        console.log("submit form failed."), console.log(a)
                    }
                })
            }, this.runJs = function(a) {
                return window.eval("with(thisWebPDFDoc){" + a + "}")
            }
        }
        var e = a("core/Plugins/PDFJS/field").Field;
        jsRoot = a("core/Plugins/PDFJS/utils").createRoot(this), AFNumber_Format = jsRoot.AFNumber_Format, AFSimple_Calculate = jsRoot.AFSimple_Calculate, AFRange_Validate = jsRoot.AFRange_Validate, AFPercent_Format = jsRoot.AFPercent_Format, AFDate_Format = jsRoot.AFDate_Format, AFDate_FormatEx = jsRoot.AFDate_FormatEx, AFTime_Format = jsRoot.AFTime_Format, AFTime_FormatEx = jsRoot.AFTime_FormatEx, AFParseDateEx = jsRoot.AFParseDateEx, AFMakeNumber = jsRoot.AFMakeNumber;
        var f;
        b.Doc = d
    }), define("core/Plugins/PDFJS/utils", [], function(a, b, c) {
        function d() {
            function a(a, b, c, d) {
                var e = ".",
                    f = ",",
                    g = "";
                switch (c) {
                    case 0:
                        break;
                    case 1:
                        f = "";
                        break;
                    case 2:
                        e = ",", f = ".";
                        break;
                    case 3:
                        e = ",", f = ""
                }
                var h = a.length % 3;
                g = a.substr(0, h);
                for (var i = h; i < a.length; i += 3) 0 !== g.length && (g += f), g += a.substr(i, 3);
                if (d > 0) {
                    for (b = b.substring(0, d); b.length < d;) b += "0";
                    g = g + e + b
                }
                return g
            }

            function b(a) {
                var b = WebPDF.FormPlugin.form.getFieldByName(a);
                if (b) {
                    var c = WebPDF.JSEngine.getEvent();
                    return c.bExtractDenpends && c.depends.push(a), b.getValue()
                }
                return ""
            }

            function c(a) {
                var b = a.toString(),
                    c = b.split(".", 2);
                return null == c || c.length < 2 ? (c = null, 0) : c[1].length
            }

            function d(a) {
                var b = new RegExp("(\\w+)\\[" + a + "\\]"),
                    c = b.exec(p);
                return c ? c[1] : null
            }

            function e(a) {
                var b = new RegExp("(\\w+)\\[" + a + "\\]"),
                    c = b.exec(q);
                return c ? c[1] : null
            }

            function f(a) {
                return a > 11 ? "PM" : "AM"
            }

            function g(a, b) {
                a = a.replace(/%/g, "%69");
                var c = [],
                    g = b.getFullYear().toString();
                return g = "0000" + g, a = a.replace(/([^y])y{4}(?!y)|(^)y{4}(?!y)/g, "$1" + g.substr(g.length - 4, 4)), a = a.replace(/([^y])y{2}(?!y)|(^)y{2}(?!y)/g, "$1" + g.substr(g.length - 2, 2)), g = d(b.getMonth() + 1), c["%mmmm"] = g, a = a.replace(/([^m])m{4}(?!m)|(^)m{4}(?!m)/g, "$1%mmmm"), c["%mmm"] = g.substr(0, 3), a = a.replace(/([^m])m{3}(?!m)|(^)m{3}(?!m)/g, "$1%mmm"), a = a.replace(/([^m])m{1}(?!m)|(^)m{1}(?!m)/g, "$1" + (b.getMonth() + 1)), g = (b.getMonth() + 1).toString(), 1 === g.length && (g = "0" + g), a = a.replace(/([^m])m{2}(?!m)|(^)m{2}(?!m)/g, "$1" + g), g = e(b.getDay()), c["%dddd"] = g, a = a.replace(/([^d])d{4}(?!d)|(^)d{4}(?!d)/g, "$1%dddd"), c["%ddd"] = g.substr(0, 3), a = a.replace(/([^d])d{3}(?!d)|(^)d{3}(?!d)/g, "$1%ddd"), a = a.replace(/([^d])d{1}(?!d)|(^)d{1}(?!d)/g, "$1" + b.getDate()), g = b.getDate().toString(), 1 === g.length && (g = "0" + g), a = a.replace(/([^d])d{2}(?!d)|(^)d{2}(?!d)/g, "$1" + g), a = a.replace(/([^H])H{1}(?!H)|(^)H{1}(?!H)/g, "$1" + b.getHours()), g = b.getHours().toString(), 1 === g.length && (g = "0" + g), a = a.replace(/([^H])H{2}(?!H)|(^)H{2}(?!H)/g, "$1" + g), a = a.replace(/([^h])h{1}(?!h)|(^)h{1}(?!h)/g, "$1" + (b.getHours() > 12 ? b.getHours() - 12 : b.getHours())), g = (b.getHours() > 12 ? b.getHours() - 12 : b.getHours()).toString(), 1 === g.length && (g = "0" + g), a = a.replace(/([^h])h{2}(?!h)|(^)h{2}(?!h)/g, "$1" + g), a = a.replace(/([^M])M{1}(?!M)|(^)M{1}(?!M)/g, "$1" + b.getMinutes()), g = b.getMinutes().toString(), 1 === g.length && (g = "0" + g), a = a.replace(/([^M])M{2}(?!M)|(^)M{2}(?!M)/g, "$1" + g), a = a.replace(/([^s])s{1}(?!s)|(^)s{1}(?!s)/g, "$1" + b.getSeconds()), g = b.getSeconds().toString(), 1 === g.length && (g = "0" + g), a = a.replace(/([^s])s{2}(?!s)|(^)s{2}(?!s)/g, "$1" + g), g = f(b.getHours()), a = a.replace(/([^t])t{2}(?!t)|(^)t{2}(?!t)/g, "$1" + g), 1 === g.length && (g = g.charAt(0)), a = a.replace(/([^t])t{1}(?!t)|(^)t{1}(?!t)/g, "$1" + g), a = a.replace(/%mmmm/g, c["%mmmm"]), a = a.replace(/%mmm/g, c["%mmm"]), a = a.replace(/%dddd/g, c["%dddd"]), a = a.replace(/%ddd/g, c["%ddd"]), a = a.replace(/%69/g, "%"), c = null, a
            }

            function h(a, b) {
                var c = i(a, b);
                return null == c && (c = o(a)), c
            }

            function i(a, b) {
                for (var c = new Date, e = c.getFullYear(), f = c.getMonth() + 1, g = c.getDate(), h = c.getHours(), i = c.getMinutes(), j = c.getSeconds(), m = 99, n = !1, o = !1, p = !1, q = 0, r = 0; q < b.length && !o;) {
                    var s = b.charAt(q);
                    switch (s) {
                        case "y":
                        case "m":
                        case "d":
                        case "H":
                        case "h":
                        case "M":
                        case "s":
                        case "t":
                            var t = r,
                                u = 0,
                                v = null;
                            if (b.charAt(q + 1) !== s) switch (s) {
                                case "y":
                                    q++, r++;
                                    break;
                                case "m":
                                    v = k(a, r, 2), f = v.nRet, u = v.nSkip, q++, r += u;
                                    break;
                                case "d":
                                    v = k(a, r, 2), g = v.nRet, u = v.nSkip, q++, r += u;
                                    break;
                                case "H":
                                    v = k(a, r, 2), h = v.nRet, u = v.nSkip, q++, r += u;
                                    break;
                                case "h":
                                    v = k(a, r, 2), h = v.nRet, u = v.nSkip, q++, r += u;
                                    break;
                                case "M":
                                    v = k(a, r, 2), i = v.nRet, u = v.nSkip, q++, r += u;
                                    break;
                                case "s":
                                    v = k(a, r, 2), j = v.nRet, u = v.nSkip, q++, r += u;
                                    break;
                                case "t":
                                    n = "p" === a.charAt(q), q++, r++
                            } else if (b.charAt(q + 1) === s && b.charAt(q + 2) !== s) switch (s) {
                                case "y":
                                    v = k(a, r, 4), e = v.nRet, u = v.nSkip, q += 2, r += u;
                                    break;
                                case "m":
                                    v = k(a, r, 2), f = v.nRet, u = v.nSkip, q += 2, r += u;
                                    break;
                                case "d":
                                    v = k(a, r, 2), g = v.nRet, u = v.nSkip, q += 2, r += u;
                                    break;
                                case "H":
                                    v = k(a, r, 2), h = v.nRet, u = v.nSkip, q += 2, r += u;
                                    break;
                                case "h":
                                    v = k(a, r, 2), h = v.nRet, u = v.nSkip, q += 2, r += u;
                                    break;
                                case "M":
                                    v = k(a, r, 2), i = v.nRet, u = v.nSkip, q += 2, r += u;
                                    break;
                                case "s":
                                    v = k(a, r, 2), j = v.nRet, u = v.nSkip, q += 2, r += u;
                                    break;
                                case "t":
                                    n = "p" === a.charAt(r) && "m" === a.charAt(r + 1), q += 2, r += 2
                            } else if (b.charAt(q + 1) === s && b.charAt(q + 2) === s && b.charAt(q + 3) !== s) switch (s) {
                                case "m":
                                    v = l(a, r), u = v.nSkip;
                                    for (var w = v.swRet, x = !1, y = 0; 12 > y; y++)
                                        if (w.toLowerCase() === d(y + 1).substr(0, 3).toLowerCase()) {
                                            f = y + 1, q += 3, r += u, x = !0;
                                            break
                                        }
                                    x || (v = k(a, r, 3), f = v.nRet, u = v.nSkip, q += 3, r += u);
                                    break;
                                case "y":
                                    break;
                                default:
                                    q += 3, r += 3
                            } else if (b.charAt(q + 1) === s && b.charAt(q + 2) === s && b.charAt(q + 3) === s && b.charAt(q + 4) !== s) switch (s) {
                                case "y":
                                    v = k(a, r, 4), e = v.nRet, u = v.nSkip, r += u, q += 4;
                                    break;
                                case "m":
                                    var x = !1;
                                    v = l(a, r), u = v.nSkip;
                                    var w = v.swRet;
                                    w = w.toLowerCase();
                                    for (var y = 0; 12 > y; y++) {
                                        var z = d(y + 1);
                                        if (z = z.toLowerCase(), z.indexOf(w, 0) >= 0) {
                                            f = y + 1, q += 4, r += u, x = !0;
                                            break
                                        }
                                    }
                                    x || (v = k(a, r, 4), f = v.nRet, u = v.nSkip, q += 4, r += u);
                                    break;
                                default:
                                    q += 4, r += 4
                            } else b.charAt(q) !== a.charAt(r) && (p = !0, o = !0), q++, r++;
                            t === r && (p = !0, o = !0);
                            break;
                        default:
                            a.length <= r ? o = !0 : b.charAt(q) !== a.charAt(r) && (p = !0, o = !0), q++, r++
                    }
                }
                return n && (h += 12), e >= 0 && m >= e && (e += 2e3), (1 > f || f > 12) && (p = !0), (1 > g || g > 31) && (p = !0), (0 > h || h > 24) && (p = !0), (0 > i || i > 60) && (p = !0), (0 > j || j > 60) && (p = !0), p ? null : new Date(e, f - 1, g, h, i, j)
            }

            function j(a) {
                return a >= "0" && "9" >= a
            }

            function k(a, b, c) {
                var d = [];
                d.nRet = 0, d.nSkip = 0;
                for (var e = b, f = a.length; f > e && !(e - b > 10); e++) {
                    var g = a.charAt(e);
                    if (!j(g)) break;
                    if (d.nRet = 10 * d.nRet + (g - "0"), d.nSkip = e - b + 1, d.nSkip >= c) break
                }
                return d
            }

            function l(a, b) {
                var c = [];
                c.swRet = "", c.nSkip = 0;
                for (var d = b, e = a.length; e > d; d++) {
                    var f = a.charAt(d);
                    if (!(f >= "a" && "z" >= f || f >= "A" && "Z" >= f)) break;
                    c.swRet += f, c.nSkip = d - b + 1
                }
                return c
            }

            function m(a, b, c, d, e, f, g) {
                var h = [];
                if (h.y = e, h.m = f, h.d = g, 2 === a) {
                    if (b >= 1 && 12 >= b && c >= 1 && 31 >= c) return h.m = b, h.d = c, h;
                    if (b >= 1 && 31 >= b && c >= 1 && 12 >= c) return h.m = c, h.d = b, h
                } else if (a >= 3) {
                    if (b > 12 && c >= 1 && 12 >= c && d >= 1 && 31 >= d) return h.y = b, h.m = c, h.d = d, h;
                    if (b >= 1 && 12 >= b && c >= 1 && 31 >= c && d > 31) return h.y = d, h.m = b, h.d = c, h;
                    if (b >= 1 && 31 >= b && c >= 1 && 12 >= c && d > 31) return h.y = d, h.m = c, h.d = b, h
                }
                return null
            }

            function n(a, b, c, d, e, f, g) {
                var h = [];
                if (h.h = e, h.M = f, h.s = g, 2 === a) {
                    if (b >= 0 && 23 >= b && c >= 0 && 59 >= c) return h.h = b, h.M = c, h.s = 0, h
                } else if (3 === a && b >= 0 && 23 >= b && c >= 0 && 59 >= c && d >= 0 && 59 >= d) return h.h = b, h.M = c, h.s = d, h;
                return null
            }

            function o(a) {
                for (var b = new Date, c = b.getFullYear(), d = b.getMonth() + 1, e = b.getDate(), f = b.getHours(), g = b.getMinutes(), h = b.getSeconds(), i = [], l = 0; 6 > l; l++) i[l] = 0;
                for (var o = !1, p = 0, q = 0, r = a.length; r > q && !(p > 5);) {
                    var s = a.charAt(q);
                    if (j(s)) {
                        var t = 0,
                            u = k(a, q, 4);
                        i[p++] = u.nRet, t = u.nSkip, q += t
                    } else ":" === s && (o = !0), q++
                }
                var v = !0;
                if (o)
                    if (3 >= p) {
                        var w = n(p, i[0], i[1], i[2], f, g, h);
                        w && (f = w.h, g = w.M, h = w.s, v = !1)
                    } else if (4 === p) {
                    var w = m(2, i[0], i[1], 0, c, d, e);
                    w && (c = w.y, d = w.m, e = w.d, w = n(2, i[2], i[3], 0, f, g, h), w && (f = w.h, g = w.M, h = w.s, v = !1))
                } else if (5 === p) {
                    var w = m(3, i[0], i[1], i[2], c, d, e);
                    if (w && (c = w.y, d = w.m, e = w.d, w = n(2, i[3], i[4], 0, f, g, h), w && (f = w.h, g = w.M, h = w.s, v = !1)), v) {
                        var w = m(2, i[0], i[1], 0, c, d, e);
                        w && (c = w.y, d = w.m, e = w.d, w = n(3, i[2], i[3], i[4], f, g, h), w && (f = w.h, g = w.M, h = w.s, v = !1))
                    }
                } else if (6 === p) {
                    var w = m(3, i[0], i[1], i[2], c, d, e);
                    w && (c = w.y, d = w.m, e = w.d, w = n(3, i[3], i[4], i[5], f, g, h), w && (f = w.h, g = w.M, h = w.s, v = !1))
                }
                if (v) {
                    var w = m(p, i[0], i[1], i[2], c, d, e);
                    w && (c = w.y, d = w.m, e = w.d, v = p > 3)
                }
                return v ? null : new Date(c, d - 1, e, f, g, h)
            }
            this.AFSimple_Calculate = function(a, d) {
                var e = WebPDF.JSEngine.getEvent(),
                    f = (e.target, ""),
                    g = 0,
                    h = NaN;
                switch (a) {
                    case "AVG":
                        for (var i = 0; i < d.length; i++) {
                            var j = parseFloat(b(d[i]));
                            if (!isNaN(j)) {
                                var k = c(j);
                                g = g > k ? g : k, isNaN(h) && (h = 0), h += j
                            }
                        }
                        f = isNaN(h) ? "" : h / d.length;
                        break;
                    case "SUM":
                        for (var l = 0; l < d.length; l++) {
                            var m = parseFloat(b(d[l]));
                            if (!isNaN(m)) {
                                var n = c(m);
                                g = g > n ? g : n, isNaN(h) && (h = 0), h += m
                            }
                        }
                        f = isNaN(h) ? "0" : h;
                        break;
                    case "PRD":
                        for (var o = NaN, p = 0; p < d.length; p++) {
                            var q = parseFloat(b(d[p]));
                            if (!isNaN(q)) {
                                var r = c(q);
                                g = g > r ? g : r, isNaN(o) && (o = 1), o *= q
                            }
                        }
                        f = isNaN(o) ? "" : o;
                        break;
                    case "MIN":
                        for (var s = NaN, t = 0; t < d.length; t++) {
                            var u = parseFloat(b(d[t]));
                            if (!isNaN(u)) {
                                var v = c(u);
                                g = g > v ? g : v, isNaN(s) && (s = u), s > u && (s = u)
                            }
                        }
                        f = isNaN(s) ? "" : s;
                        break;
                    case "MAX":
                        for (var w = NaN, x = 0; x < d.length; x++) {
                            var y = parseFloat(b(d[x]));
                            if (!isNaN(y)) {
                                var z = c(y);
                                g = g > z ? g : z, isNaN(w) && (w = y), y > w && (w = y)
                            }
                        }
                        f = isNaN(w) ? "" : w
                }
                e.bExtractDenpends || (e.value = f), e.rc = !0
            }, this.AFRange_Validate = function(a, b, c, d) {
                var e = WebPDF.JSEngine.getEvent(),
                    f = e.target,
                    g = "",
                    h = e.value,
                    i = NaN;
                return i = parseFloat(h), isNaN(i) ? void(e.value = f.value) : (a && c ? (b > i || i > d) && (g = i18n.t("Form.IDS_FX_GTET") + b + i18n.t("Form.IDS_FX_AND_LTET") + d + ".") : a ? b > i && (g = i18n.t("Form.IDS_FX_GTET") + b + ".") : c && i > d && (g = i18n.t("Form.IDS_FX_AND_LTET") + d + "."), void("" !== g ? (WebPDF.alert(null, null, g), e.value = f.value, e.rc = !1) : e.rc = !0))
            }, this.AFNumber_Format = function(b, c, d, e, f, g) {
                var h = WebPDF.JSEngine.getEvent(),
                    i = h.target;
                if ("undefined" != typeof i) {
                    var j = h.value;
                    if ("undefined" == typeof Object.__defineGetter__ && (j = i.modle.getValue()), "" === j) return void(h.value = "");
                    if (!$.isNumeric(j)) return void(h.value = "0");
                    j = parseFloat(j);
                    var k = 0 > j ? -1 : 1;
                    if (isNaN(j)) return void(h.value = j);
                    var l = "";
                    l = (2 === d || 3 === d) && 0 > k ? "(" : "", g && (l += f), j *= k;
                    var m = j.toString().split(".", 2),
                        n = m[0],
                        o = "";
                    m.length > 1 && (o = m[1]), l += a(n, o, c, b), g || (l += f), (2 === d || 3 === d) && 0 > k && (l += ")"), (0 !== d || g) && (j = Math.abs(j)), 0 > k && g && 0 === d && (l = "-" + l), h.value = l, h.rc = !0
                }
            }, this.AFTime_Format = function(a) {
                var b = new Array("HH:MM", "h:MM tt", "HH:MM:ss", "h:MM:ss tt");
                this.AFTime_FormatEx(b[a])
            }, this.AFTime_FormatEx = function(a) {
                var b = WebPDF.JSEngine.getEvent(),
                    c = b.target.value;
                if ("undefined" == typeof Object.__defineGetter__ && (c = b.target.modle.getValue()), !c) return void(b.rc = !1);
                var d = this.AFParseDateEx(c, a);
                d || (d = new Date), b.value = g(a, d), b.rc = !0
            }, this.AFDate_FormatEx = function(a) {
                var b = WebPDF.JSEngine.getEvent(),
                    c = b.target.value;
                if ("undefined" == typeof Object.__defineGetter__ && (c = b.target.modle.getValue()), !c) return void(b.rc = !1);
                var d = this.AFParseDateEx(c, a);
                d || (d = new Date), b.value = g(a, d), b.rc = !0
            }, this.AFPercent_Format = function(b, c) {
                var d = WebPDF.JSEngine.getEvent(),
                    e = d.target.value;
                if ("undefined" == typeof Object.__defineGetter__ && (e = d.target.modle.getValue()), e = parseFloat(100 * e), isNaN(e)) return d.value = e, void(d.rc = !0);
                e += .005;
                var f = e.toString().split(".", 2),
                    g = f[0],
                    h = "";
                f.length > 1 && (h = f[1]);
                var i = a(g, h, c, b) + "%";
                d.value = i, d.rc = !0
            };
            var p = "January[1]February[2]March[3]April[4]May[5]June[6]July[7]August[8]September[9]October[10]Movember[11]December[12]Jan[1]Feb[2]Mar[3]Apr[4]Jun[6]Jul[7]Aug[8]Sep[9]Oct[10]Mov[11]Dec[12]",
                q = "Sunday[0]Monday[1]Tuesday[2]Wednesday[3]Thursday[4]Friday[5]Saturday[6]";
            this.AFParseDateEx = function(a, b) {
                return h(a, b)
            }, this.AFMakeNumber = function(a) {
                return parseFloat(a)
            }
        }
        b.createRoot = function() {
            return new d
        }
    }), define("core/Plugins/Loupe/LoupePlugin", ["core/Plugins/Loupe/LoupeToolHandler", "core/Plugins/Loupe/LoupeView", "core/Plugins/Loupe/LoupeDlg", "core/ImageEngine/ImageTitlesLazyLoad", "core/WebPDF"], function(a, b, c) {
        var d = a("core/Plugins/Loupe/LoupeToolHandler");
        WebPDF.LoupePluginName = "Loupe Plugin", WebPDF.LoupePlugin = function(a) {
            function b() {
                $(c).on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
                    f.onClean()
                }), $(c).on(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, function(a, b) {
                    f.onRotate()
                }), $(c).on(WebPDF.EventList.DOCVIEW_SCROLL + ".tiles", function() {
                    f.onScroll()
                }), $(c).on(WebPDF.EventList.ANNOT_DELETED, function(a, b) {
                    f.onUpdateAnnot(b.pageIndex)
                }).on(WebPDF.EventList.ANNOT_ADDED, function(a, b) {
                    f.onUpdateAnnot(b.pageIndex)
                }).on(WebPDF.EventList.ANNOT_ADDED_NOFilter, function(a, b) {
                    f.onUpdateAnnot(b.pageIndex)
                }).on(WebPDF.EventList.ANNOT_UPDATED, function(a, b) {
                    f.onUpdateAnnot(b.pageIndex)
                }).on(WebPDF.EventList.ANNOTS_LOADED_SUCCESS, function(a, b) {
                    f.onUpdateAnnot(b.pageIndex)
                })
            }
            var c = a,
                e = !1,
                f = null;
            this.getName = function() {
                return WebPDF.LoupePluginName
            }, this.onRegister = function() {
                return e ? !0 : !1
            }, this.init = function() {
                f = new d(c), c.registerToolHandler(f), b(), e = !0
            }, this.unload = function() {}
        }, b.createPlugin = function(a) {
            return new WebPDF.LoupePlugin(a)
        }
    }), define("core/Plugins/Loupe/LoupeToolHandler", ["core/Plugins/Loupe/LoupeView", "core/Plugins/Loupe/LoupeDlg", "core/ImageEngine/ImageTitlesLazyLoad", "core/WebPDF"], function(a, b, c) {
        var d = a("core/Plugins/Loupe/LoupeView"),
            e = a("core/Plugins/Loupe/LoupeDlg");
        return WebPDF.Tools.TOOL_NAME_LOUPE = "Loupe Tool", WebPDF.Event.LoupeToolHandler = function() {
            var a = null,
                b = !1;
            this.toolType = WebPDF.Tools.TOOL_NAME_LOUPE;
            var c = new d,
                f = e.getInstance();
            this._mousePosition = {
                x: 0,
                y: 0
            }, this.onInit = function(b) {
                a = b
            }, this.destroy = function() {}, this.getName = function() {
                return this.toolType
            }, this.onActivate = function() {
                b = !0;
                var d = a.getMainView().getDocView(),
                    e = d.getPageView(d.getCurPageIndex());
                f.doModal(e), c.addCursor()
            }, this.onDeactivate = function() {
                b = !1, f.hide(), c.removeCursor()
            }, this.isEnabled = function() {
                var b = a.getMainView().getDocView().getPDFDoc();
                return b && b.getDocType() !== WebPDF.Annot.DocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return b
            }, this.onLButtonDown = function(a) {
                return b = !0, !1
            }, this.onLButtonUp = function(a) {}, this.createAnnot = function(a, b, c) {}, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = b.getVisiblePageRange(),
                    d = null,
                    e = null;
                this._mousePosition = {
                    x: a.pageX,
                    y: a.pageY
                };
                for (var g = c.begin; g <= c.end; g++) {
                    var h = b.getPageView(g),
                        i = $("#" + h.getPageViewContainerID()).offset(),
                        j = h.getPageViewWidth(),
                        k = h.getPageViewHeight();
                    if (e = new WebPDF.PDFRect(i.left, i.top, i.left + j, i.top + k), WebPDF.RectUtils.normalize(e), WebPDF.RectUtils.ptInRect(e, a.pageX, a.pageY)) {
                        d = h;
                        break
                    }
                }
                if (!d) return !1;
                var l = (a.pageX - e.left) / d.getScale(),
                    m = (a.pageY - e.bottom) / d.getScale();
                return f.move(d, l, m), !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return a.stopPropagation(), a.preventDefault(), !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }, this.getIsOnDraw = function() {}, this.onRotate = function() {
                f.rotate()
            }, this.onScroll = function() {
                this.onMouseMove({
                    pageX: this._mousePosition.x,
                    pageY: this._mousePosition.y
                })
            }, this.onUpdateAnnot = function(a) {
                f.updateAnnot(a)
            }, this.onClean = function() {
                f.clean()
            }
        }, WebPDF.Event.LoupeToolHandler
    }), define("core/Plugins/Loupe/LoupeView", [], function(a, b, c) {
        function d(a) {}
        var e = WebPDF.Tool.getReaderApp();
        return d.prototype = {
            addCursor: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                b.addClass("fwr-zoomin-cursor")
            },
            removeCursor: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                b.removeClass("fwr-zoomin-cursor")
            }
        }, d
    }), define("core/Plugins/Loupe/LoupeDlg", ["core/ImageEngine/ImageTitlesLazyLoad", "core/WebPDF"], function(a, b, c) {
        var d = a("core/ImageEngine/ImageTitlesLazyLoad"),
            e = function() {
                var a = this;
                this.id = "fwrLoupeDlg", this._curZoom = 1, this._viewWidth = 400, this._viewHeight = 350, this._zooms = [.5, .75, 1, 1.25, 1.5, 2, 2.5, 3, 4, 5, 6, 7, 8, 9, 10], this._norZooms = [.5, .75, 1, 1.25, 1.5, 2, 2.5, 3, 4, 5, 6, 7, 8, 9, 10], this._largeZooms = [.5, .75, 1, 1.25, 1.5, 2], this.position = {
                    left: 0,
                    top: 0
                }, this._curPageView = null, this._annotMap = {}, a._dragProgress = null, this.readerApp = WebPDF.Tool.getReaderApp(), this._getDisplayPosition = function(a, b) {
                    return {
                        left: a - this._viewWidth / 2,
                        top: b - this._viewHeight / 2
                    }
                }, this._setCurPosition = function(a, b) {
                    return this.position = {
                        left: a * this._curZoom,
                        top: b * this._curZoom
                    }, this.position
                }, this._loadImage = function(a, b, c, d) {
                    function e(e, f) {
                        var g = 3 == f;
                        return g ? void setTimeout(function() {
                            l._loadImage(a, b, c, --d)
                        }, 2e3) : void $("#" + c).attr("src", h)
                    }

                    function f() {}
                    var g = this._curZoom ? 1 * this._curZoom : 1;
                    g = 100 * this._getNearZoom(g, this._zooms), this.readerApp.isLargeFile() && (g = 100);
                    var h = _readerApp.getOptions().url + "image/" + b + "/" + g;
                    if (h += "?accessToken=" + WebPDF.AccountInstance.getAccessToken(), 0 >= d) return console.warn("Maximum number of retries exceeded for render thumb page: " + b), h;
                    var i = _readerApp.getDataControl(),
                        j = {
                            url: h,
                            readApp: _readerApp,
                            pageView: a
                        },
                        k = {
                            data: j,
                            success: e,
                            error: f
                        };
                    i.getPageImg(k);
                    var l = this;
                    return h
                }, this._imgTitlesLazyLoad = function(a) {
                    if (a) {
                        var b = WebPDF.Common.getReaderApp();
                        if (!b.getTileConfig().enable) return $("#loupe-docViewer-viewContainer .fwr-page").append('<image id="fwr-loup-page-img" style="width:100%;height:100%"/>'), void this._loadImage(a, a.getPageIndex(), "fwr-loup-page-img", 30);
                        var c = {
                            url: b.getOptions().url + "image/" + a.getPageIndex() + "/",
                            readerApp: b,
                            curPageView: a,
                            viewId: "loupe_ViewContainer_PageContainer_" + a.getPageIndex(),
                            containerId: "loupe-docViewer-viewContainer",
                            left: 0,
                            top: 0,
                            zooms: [1, 2, 3, 4, 6, 8, 10],
                            zoom: this._curZoom,
                            loading: ".fwr-loupe-loading"
                        };
                        new d(c)
                    }
                }, this._changePage = function(a, b, c) {
                    this._curPageView = a;
                    var d = this._getPageDiv(a),
                        e = $("#loupe-docViewer-viewContainer .fwrJspPane");
                    e.empty(), e.append(d), this._imgTitlesLazyLoad(a), this.rotate(), this._loadAnnot(a)
                }, this._getPageViewSize = function(a) {
                    var b = WebPDF.Common.getReaderApp(),
                        c = b.getMainView().getDocView(),
                        d = c.getRotate(),
                        e = this._curZoom,
                        f = Math.ceil(a.getPDFPageWidth() * e * b.getPixelsPerPoint()),
                        g = Math.ceil(a.getPDFPageHeight() * e * b.getPixelsPerPoint()),
                        h = f,
                        i = g;
                    return d % 180 != 0 && (h = g, i = f), {
                        width: h,
                        height: i
                    }
                }, this._getPageDiv = function(a) {
                    var b = WebPDF.Common.getReaderApp(),
                        c = {
                            index: a.getPageIndex(),
                            orignWidth: a.getPDFPageWidth() * b.getPixelsPerPoint(),
                            orignHeight: a.getPDFPageHeight() * b.getPixelsPerPoint(),
                            pageWidth: a.getPDFPageWidth() * b.getPixelsPerPoint() * this._curZoom,
                            pageHeight: a.getPDFPageHeight() * b.getPixelsPerPoint() * this._curZoom,
                            pageTile: b.getTileConfig().enable ? "fwr-page-tiles" : ""
                        },
                        d = '<div class="fwr-page {pageTile} " id="loupe_ViewContainer_PageContainer_{index}" data-width="{orignWidth}" data-height="{orignHeight}"     style="position: relative; height: {pageHeight}px; width: {pageWidth}px; "/>';
                    return d = d.format(c)
                }, this._bindEvent = function() {
                    $("#" + this.id + " .close").on("click", function() {
                        a.hide(), WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND)
                    }), $("#" + this.id + " select").change(function() {
                        var b = $(this).children("option:selected").val();
                        a.zoom(b / 100), a._dragProgress.setVal(b)
                    }), $("#btnLoupeZoomOut").on("click", function() {
                        var b = a._getPreZoom(a._curZoom, a._zooms);
                        a.zoom(b), a._dragProgress.setVal(100 * b), $("#" + a.id + " select").val(100 * b)
                    }), $("#btnLoupeZoomIn").on("click", function() {
                        var b = a._getNextZoom(a._curZoom, a._zooms);
                        a.zoom(b), a._dragProgress.setVal(100 * b), $("#" + a.id + " select").val(100 * b)
                    }), $("#" + this.id).on("resize", function(b, c) {
                        a._viewWidth = c.size.width, a._viewHeight = c.size.height - 68, $("#loupe-docViewer-viewContainer").css({
                            width: c.size.width,
                            height: c.size.height - 68
                        }), $("#fwrLoupeDlg .fwr-drag-progress").css({
                            width: c.size.width - 157
                        }), a._dragProgress.setVal(100 * a._curZoom), console.log(c)
                    })
                }, this._renderDlg = function(a) {
                    if ($("#" + this.id).length) return void $("#" + this.id).show();
                    this._curPageView = a;
                    var b = WebPDF.Common.getReaderApp(),
                        c = {
                            id: this.id,
                            title: i18n.t("PCLng.ToolBar.LoupeTool"),
                            viewWidth: this._viewWidth,
                            viewHeight: this._viewHeight,
                            orignWidth: a.getPDFPageWidth() * b.getPixelsPerPoint(),
                            orignHeight: a.getPDFPageHeight() * b.getPixelsPerPoint(),
                            pageWidth: a.getPDFPageWidth() * b.getPixelsPerPoint() * this._curZoom,
                            pageHeight: a.getPDFPageHeight() * b.getPixelsPerPoint() * this._curZoom,
                            pageTile: b.getTileConfig().enable ? "fwr-page-tiles" : "",
                            pageIndex: a.getPageIndex()
                        },
                        d = '<ul class="fwr-drag-progress opacity-progress " style="float:left; width:253px;margin:0px;"><li style="height:25px;line-height:25px"><div class="scale_panel" style="width:100%;left:0px;top:8px"><div class="scale" id="bar_op" style="width:100%"><div></div><span id="btn_op"></span></div></div></li></ul>',
                        e = '<div id="{id}" class="ui-widget-content fwr-modal fwr-hide fwr-fade fwr-in " style="overflow:hidden;top: {top}px;left:{left}px" ><div class="fwr-modal-header"><a class="close" webpdf-data-dismiss="modal"></a><h4 class="fwr-property-title" >{title}</h4></div><div class="fwr-modal-body" style="-moz-opacity:1;opacity:1;padding: 0px;max-height:600px"><div class="" style="margin: 0px;"><div id="loupe-docViewer-viewContainer" class="tiles-container" style="position:relative;height:{viewHeight}px;width:{viewWidth}px;overflow:hidden"><div class="fwr-loupe-loading fwr-page-loading" style="top:50%; position:relative;z-index:2;left:50%;display:none"/><div class="fwrJspPane" style="padding:0px; top:0px;left:0px;width:{pageWidth}px,height:{pageHeight}px"><div class="fwr-page {pageTile} " id="loupe_ViewContainer_PageContainer_{pageIndex}" data-width="{orignWidth}" data-height="{orignHeight}"     style="position: relative; height: {pageHeight}px; width: {pageWidth}px; "/></div></div></div></div><div class="fwr-modal-footer" style="padding:1px 5px 1px 1px;"><select style="float:left;width:80px;height:25px"></select><span style="float:left;text-align:center;display:inline-block;line-height:25px;width:15px">%</span><ul  class="fwr-select-zoom1" style="margin-top:2px"><li class="fwr-select-zoom-out"><a id="btnLoupeZoomOut" class="fwr-select-zoom-out fwr-select-zoom-icons"></a><span class="fwr-toolbar-tip"><strong data-i18n="[html]PCLng.ToolBar.ZoomOut">Zoom Out</strong><br /><div data-i18n="[html]PCLng.ToolBar.ZoomOutTip">Zoom Out</div></span></li>' + d + '<li class="fwr-select-zoom-in" style="float: right;"><a id="btnLoupeZoomIn" class="fwr-select-zoom-in fwr-select-zoom-icons "></a><span class="fwr-toolbar-tip disabled"><strong data-i18n="[html]PCLng.ToolBar.ZoomIn">Zoom In</strong><br /><div data-i18n="[html]PCLng.ToolBar.ZoomInTip">Zoom In</div></span></li></ul></div>';
                    e = e.format(c), $("body").append(e);
                    var f = "";
                    for (var g in this._zooms) {
                        var h = 100 * this._zooms[g],
                            i = 100 == h ? "selected" : "";
                        f += '<option value ="' + h + '"' + i + ">" + h + "</option>"
                    }
                    $("#" + this.id + " select").append(f), this._bindEvent(), $("#" + this.id).draggable({
                        handle: ".fwr-modal-header"
                    }), $("#" + this.id).resizable({
                        handles: "n, e, s, w, ne, se, sw, nw ",
                        autoHide: !0,
                        minHeight: 300,
                        maxHeight: 600,
                        minWidth: 300,
                        maxWidth: 800
                    });
                    var j = $(window).width() - this._viewWidth + 248;
                    j = 315 > j ? 315 : j, $("#" + this.id).css({
                        left: j + "px",
                        top: "40px"
                    }), $("#" + this.id).show(), this._imgTitlesLazyLoad(a), this._loadAnnot(a)
                }, this._getNearZoom = function(a, b) {
                    if (b.indexOf(a) < 0) {
                        a = a > b[b.length - 1] ? b[b.length - 1] : a, a = a < b[0] ? b[0] : a;
                        for (var c = 0; c < b.length; c++)
                            if ("number" == typeof b[c] && a <= b[c]) {
                                a = b[c];
                                break
                            }
                    }
                    return a
                }, this._getPreZoom = function(a, b) {
                    if (a = this._getNearZoom(a, b), a == b[0]) return a;
                    for (var c in b)
                        if (b[c] == a) return b[--c]
                }, this._getNextZoom = function(a, b) {
                    if (a = this._getNearZoom(a, b), a == b[b.length - 1]) return a;
                    for (var c in b)
                        if (b[c] == a) return b[++c]
                }, this._loadAnnot = function(a) {
                    if (a) {
                        $("#loupe-docViewer-viewContainer .fwr-loupe-annot").remove(), $("#loupe-docViewer-viewContainer .fwr-loupe-forms").remove();
                        var b = a.getPageIndex(),
                            c = b + "_" + this._curZoom,
                            d = this._annotMap[c] ? this._annotMap[c].annots : null;
                        d || (d = this._getAnnots(a), this._annotMap[c] = {
                            annots: d
                        });
                        var e = this._annotMap[c] ? this._annotMap[c].forms : null;
                        e || (e = this._getForm(a), this._annotMap[c], e = e), $("#loupe-docViewer-viewContainer .fwr-page").append(d).append(e)
                    }
                }, this._getForm = function(a) {
                    var b = this._curZoom / a.getScale(),
                        c = _readerApp.getPluginByName(WebPDF.FormPluginName);
                    if (!c) return "";
                    var d = c.getFormHtmlContent(a, b);
                    return "<div class='fwr-loupe-forms' >" + d + "</div>"
                }, this._getAnnots = function(a) {
                    var b = a.getPDFPage().getAnnotJsonData();
                    if (0 != b.length) {
                        var c = WebPDF.Common.getReaderApp(),
                            d = c.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                            e = d.getUIManager(),
                            f = (c.getDocView(), this._getPageViewSize(a), this._curZoom / a.getScale()),
                            g = e.createAnnotsHtmlContent(a, f, !0, !0);
                        g = g.replace(/id=([\s\S]+?')/g, "pazTarget=$1"), g = '<div class="fwr-loupe-annot">' + g + "</div>";
                        var h = $(g),
                            i = h.find(".vml"),
                            j = d.isPageAnnotCreated(a.getPageIndex()),
                            k = a.getPDFPage().getAnnotsMap();
                        return this._enumAnnotsCanvasToImageSrc(a, k, d, i, f, j), h
                    }
                }, this._clearFormsMap = function(a) {
                    if (!(-1 > !a)) {
                        var b = a + "_";
                        for (var c in this._annotMap) c.indexOf(b) > -1 && this._annotMap[c] && (this._annotMap[c].forms = null)
                    }
                }, this._enumAnnotsCanvasToImageSrc = function(a, b, c, d, e, f) {
                    for (var g in b) {
                        var h = b[g];
                        if (null != h && !("Markup" != h.getType() && h.getType() != WebPDF.Annot.AnnotType.Callout || "Ink" != h.getSubType() && h.getSubType() != WebPDF.Annot.AnnotType.Circle && h.getSubType() != WebPDF.Annot.AnnotType.Polygon && h.getSubType() != WebPDF.Annot.AnnotType.PolyLine && h.getSubType() != WebPDF.Annot.AnnotType.Square && h.getSubType() != WebPDF.Annot.AnnotType.Line && h.getType() != WebPDF.Annot.AnnotType.Callout && h.getSubType() != WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY && h.getSubType() != WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET)) {
                            c.getAnnotCavansDivID(a, h.getAnnotName());
                            d.each(function() {
                                var b = document.getElementById($(this).attr("pazTarget")),
                                    d = "";
                                b ? (d = this.outerHTML, f ? d = d.replace("<canvas", "<img src=" + b.toDataURL()).replace("</canvas>", "</img>") : (c.showAInkAnnot(a, h, !1, this, e), d = d.replace("<canvas", "<img src=" + b.toDataURL()).replace("</canvas>", "</img>"))) : $(this).parent().remove(), $(this).parent().append(d)
                            })
                        }
                    }
                }, this._changeZoomLimit = function() {
                    var a = WebPDF.Common.getReaderApp(),
                        b = a.isLargeFile() ? this._largeZooms : this._norZooms;
                    if (b.length != this._zooms.length && (this._zooms = b, this._dragProgress)) {
                        var c = "";
                        $("#" + this.id + " select").empty();
                        for (var d in this._zooms) {
                            var e = 100 * this._zooms[d],
                                f = 100 == e ? "selected" : "";
                            c += '<option value ="' + e + '"' + f + ">" + e + "</option>"
                        }
                        $("#" + this.id + " select").append(c), this._dragProgress.setMinMaxVal(50, 100 * this._zooms[this._zooms.length - 1] - 50)
                    }
                }, this._initDragProgress = function() {
                    if (!a._dragProgress) {
                        var b = new f("btn_op", "bar_op", "op", self, 50, 100 * this._zooms[this._zooms.length - 1] - 50, function(b) {
                            a.zoom(b / 100), $("#" + a.id + " select").val(100 * a._getNearZoom(b / 100, a._zooms))
                        });
                        a._dragProgress = b, b.setVal(100)
                    }
                }
            };
        e.prototype = {
            doModal: function(a) {
                if (a)
                    if (this._renderDlg(a), this._initDragProgress(), this._clearFormsMap(a.getPageIndex()), this._curPageView == a) {
                        this.rotate();
                        var b = a.getPageIndex() + "_" + this._curZoom;
                        (null == this._annotMap[b] || null == this._annotMap[b].forms) && this._loadAnnot(a)
                    } else this._changePage(a, 0, 0)
            },
            hide: function() {
                $("#" + this.id).hide()
            },
            move: function(a, b, c) {
                if (!a) return !1;
                this._curPageView && this._curPageView != a && this._changePage(a, b, c);
                var d = a.getDocView().getRotate();
                this._setCurPosition(b, c);
                var e = this._getDisplayPosition(this.position.left, this.position.top);
                b = e.left, c = e.top, $("#loupe-docViewer-viewContainer .fwrJspPane").css({
                    left: -b + "px",
                    top: -c + "px"
                });
                var f = WebPDF.Common.getReaderApp();
                f.getTileConfig().enable && $("#loupe-docViewer-viewContainer .fwr-page").tiles("scroll", this.position.top, this.position.left, d)
            },
            rotate: function() {
                if (this._curPageView) {
                    var a = WebPDF.Common.getReaderApp(),
                        b = a.getMainView().getDocView(),
                        c = this._curPageView,
                        d = b.getRotate(),
                        e = this._curZoom,
                        f = Math.ceil(c.getPDFPageWidth() * e * a.getPixelsPerPoint()),
                        g = (Math.ceil(c.getPDFPageHeight() * e * a.getPixelsPerPoint()), this._getPageViewSize(c)),
                        h = g.width,
                        i = g.height,
                        j = 0,
                        k = 0;
                    if (d % 180 != 0) {
                        j = .5 * c.getPageViewTranslateX(e, d);
                        var l = f - h;
                        270 == d ? k = .5 * -l : 90 == d && (k = .5 * l)
                    }
                    var m = this._getDisplayPosition(this.position.left, this.position.top);
                    WebPDF.Common.addTranslateCss($("#loupe-docViewer-viewContainer .fwr-page"), d, j, k), $("#loupe-docViewer-viewContainer .fwrJspPane").css({
                        left: -m.left + "px",
                        top: -m.top + "px"
                    }), $("#loupe-docViewer-viewContainer .fwrJspPane").css({
                        width: h + "px",
                        height: i + "px"
                    }), a.getTileConfig().enable && $("#loupe-docViewer-viewContainer .fwr-page").tiles("zoom", e, this.position.top, this.position.left, d)
                }
            },
            zoom: function(a) {
                if (this._curPageView && this._curZoom != a) {
                    this.position.left = this.position.left / this._curZoom * a, this.position.top = this.position.top / this._curZoom * a, this._curZoom = a;
                    var b = this._getDisplayPosition(this.position.left, this.position.top),
                        c = WebPDF.Common.getReaderApp(),
                        d = c.getMainView().getDocView(),
                        e = this._curPageView,
                        f = a,
                        g = Math.ceil(e.getPDFPageWidth() * f * c.getPixelsPerPoint()),
                        h = Math.ceil(e.getPDFPageHeight() * f * c.getPixelsPerPoint()),
                        i = this._getPageViewSize(e),
                        j = i.width,
                        k = (i.height, d.getRotate()),
                        l = 0,
                        m = 0;
                    if (k % 180 != 0) {
                        l = .5 * e.getPageViewTranslateX(f, k);
                        var n = g - j;
                        270 == k ? m = .5 * -n : 90 == k && (m = .5 * n)
                    }
                    WebPDF.Common.addTranslateCss($("#loupe-docViewer-viewContainer .fwr-page"), k, l, m), $("#loupe-docViewer-viewContainer .fwrJspPane").css({
                        width: i.width + "px",
                        height: i.height + "px"
                    }), $("#loupe-docViewer-viewContainer .fwrJspPane").css({
                        left: -b.left + "px",
                        top: -b.top + "px"
                    }), c.getTileConfig().enable ? ($("#loupe-docViewer-viewContainer .fwr-page").css({
                        width: g + "px",
                        height: h + "px"
                    }), $("#loupe-docViewer-viewContainer .fwr-page").tiles("zoom", a, b.top, b.left, d.getRotate())) : ($("#loupe-docViewer-viewContainer .fwr-page").css({
                        width: g + "px",
                        height: h + "px"
                    }), this._loadImage(this._curPageView, this._curPageView.getPageIndex(), "fwr-loup-page-img", 30)), this._loadAnnot(this._curPageView)
                }
            },
            clean: function() {
                var a = $("#loupe-docViewer-viewContainer .fwrJspPane");
                a.empty(), this._annotMap = {}, this._changeZoomLimit(), this._curPageView = null
            },
            updateAnnot: function(a) {
                var b = a + "_";
                for (var c in this._annotMap) c.indexOf(b) > -1 && (this._annotMap[c] = null)
            }
        };
        var f = function(a, b, c, d, e, f, g) {
            this.btn = document.getElementById(a), this.bar = document.getElementById(b), this.title = document.getElementById(c), this.step = this.bar.getElementsByTagName("div")[0], this.init(), this.historyVal = 3, this.commentPropertyDlg = d, this.minVal = null == e ? 1 : e, this.maxVal = f || 11, this.callback = g
        };
        f.prototype = {
            init: function() {
                var a = this,
                    b = "onmousedown",
                    c = "onmousemove",
                    d = "onmouseup";
                WebPDF.Tool.getReaderApp().isMobile() && (b = "ontouchstart", c = "ontouchmove", d = "ontouchend"), a.btn[b] = function(b) {
                    function e(b, c, d, e, f) {
                        var g = (b || window.event).clientX || b.changedTouches[0].clientX,
                            h = Math.min(e, Math.max(-2, d + (g - c)));
                        a.btn.style.left = h + "px", a.ondrag(Math.round(100 * Math.max(0, h / e)), h, f), window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty(), preventDefaults(b)
                    }
                    var f = !0,
                        g = (b || window.event).clientX || b.touches[0].clientX,
                        h = this.offsetLeft,
                        i = a.bar.offsetWidth - this.offsetWidth;
                    document[c] = function(a) {
                        e(a, g, h, i, !0)
                    }, "onmouseup" === d ? document.onmouseup = function(a) {
                        f && (e(a, g, h, i), this.onmousemove = null, f = !1)
                    } : document.ontouchend = new Function("this.ontouchmove=null"), preventDefaults(b)
                }
            },
            ondrag: function(a, b, c) {
                var d = this.minVal + parseInt(Math.floor(a / 100 * this.maxVal));
                c && d === this.historyVal || ($.isFunction(this.callback) && this.callback(d), this.historyVal = d)
            },
            setVal: function(a) {
                var b = (this.minVal + this.maxVal, $(this.bar).outerWidth() - $(this.btn).outerWidth()),
                    c = parseFloat((a - this.minVal) / this.maxVal * b).toFixed(2);
                this.setPosInBar(c)
            },
            setPosInBar: function(a) {
                var b = $(this.bar).outerWidth() - $(this.btn).outerWidth();
                a > b && (a = b), 0 >= a && (a = -2), this.btn.style.left = a + "px"
            },
            setMinMaxVal: function(a, b) {
                this.minVal = a, this.maxVal = b
            }
        };
        var g = null;
        b.getInstance = function() {
            return g || (g = new e), g
        }
    }), define("core/ImageEngine/ImageTitlesLazyLoad", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.ImgTitlesLazyLoad = function(a) {
            var b = a.curPageView,
                c = a.viewId ? $("#" + a.viewId) : $("#" + b.getPageViewContainerID()),
                e = a.containerId ? a.containerId : "docViewer_ViewContainer",
                f = a.readerApp,
                g = a.zooms ? a.zooms : Configs.Rendering.tileZoomList;
            if (!(c.find(".tiles-layer").length > 0)) {
                c.addClass("fwr-page-tiles");
                var h = b.getPDFPageWidth() * f.getPixelsPerPoint(),
                    i = b.getPDFPageHeight() * f.getPixelsPerPoint(),
                    j = b.getDocView().getScrollApi();
                c.tiles({
                    original: {
                        width: h,
                        height: i
                    },
                    containerId: e,
                    tileSize: Configs.tile.size,
                    checkStatusPath: f.getOptions().url + "imagestatus/" + b.getPageIndex(),
                    checkStatusPathSuffix: "?accessToken=" + d.AccountInstance.getAccessToken(),
                    basePath: a.url,
                    basePathSuffix: "?accessToken=" + d.AccountInstance.getAccessToken(),
                    zooms: g,
                    no0zoom: !0,
                    top: a.top ? a.top : j.getContentPositionY(),
                    left: a.left ? a.left : j.getContentPositionX(),
                    rotate: b.getDocView().getRotate(),
                    zoom: a.zoom ? a.zoom : null,
                    beforeVisiblePageCount: Configs.Rendering.beforeVisiblePageCount,
                    afterVisiblePageCount: Configs.Rendering.afterVisiblePageCount,
                    loading: a.loading
                })
            }
        }, d.ImgTitlesLazyLoad
    }), define("core/Plugins/MarqueeTool/MarqueeToolPlugin", ["core/Plugins/MarqueeTool/MarqueeToolHandler", "core/Plugins/MarqueeTool/MarqueeToolService", "core/Plugins/MarqueeTool/MarqueeToolView", "core/Plugins/TextSelection/PDFTextSelectTool", "core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect", "core/Plugins/Text/PDFTextPage", "core/Plugins/TextSelection/PDFTextPageSelect"], function(a, b, c) {
        var d = a("core/Plugins/MarqueeTool/MarqueeToolHandler");
        a("core/Plugins/TextSelection/PDFTextSelectTool"), WebPDF.MarqueePluginName = "Marquee Plugin", WebPDF.MarqueePlugin = function(a) {
            function b() {}
            var c = a,
                e = !1,
                f = null;
            this.getName = function() {
                return WebPDF.MarqueePluginName
            }, this.onRegister = function() {
                return e ? !0 : !1
            }, this.init = function() {
                f = new d(c), c.registerToolHandler(f), b(), e = !0
            }, this.unload = function() {}
        }, b.createPlugin = function(a) {
            return new WebPDF.MarqueePlugin(a)
        }
    }), define("core/Plugins/MarqueeTool/MarqueeToolHandler", ["core/Plugins/MarqueeTool/MarqueeToolService", "core/Plugins/MarqueeTool/MarqueeToolView"], function(a, b, c) {
        WebPDF.Tools.TOOL_NAME_MARQUEE = "Marquee Tool";
        var d = a("core/Plugins/MarqueeTool/MarqueeToolService"),
            e = a("core/Plugins/MarqueeTool/MarqueeToolView");
        return WebPDF.Cursor = {
            ZOOMOUT: "zoomout",
            ZOOMIN: "zoomin"
        }, WebPDF.Event.MarqueeToolHandler = function() {
            var a = null,
                b = !1,
                c = !1,
                f = !1,
                g = null,
                h = {
                    x: 0,
                    y: 0
                };
            _marqueeToolView = null, this.toolType = WebPDF.Tools.TOOL_NAME_MARQUEE, this.onInit = function(b) {
                a = b, g = new d(a), _marqueeToolView = new e(a)
            }, this.destroy = function() {}, this.getName = function() {
                return this.toolType
            }, this.onActivate = function() {
                b = !0, _marqueeToolView.setCursor(WebPDF.Cursor.ZOOMIN)
            }, this.onDeactivate = function() {
                b = !1, _marqueeToolView.delCursor()
            }, this.isEnabled = function() {
                var a = _pReaderApp.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() !== WebPDF.Annot.DocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return b
            }, this.onLButtonDown = function(b) {
                var d = null,
                    e = a.getMainView().getDocView(),
                    f = $("#" + e.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(f.get(0), b.target, !0)) return !1;
                if (null == d) {
                    var i = new WebPDF.PDFPoint(0, 0);
                    if (d = WebPDF.TextSelection && WebPDF.TextSelection.PDFTextSelectTool ? WebPDF.TextSelection.PDFTextSelectTool.getPageViewInfoByMouseEvent(a, b, i, !0, !1) : e.getCurPageView(), null == d) return !1
                }
                var j = d.getPageViewRect();
                if (!WebPDF.RectUtils.ptInRect(j, b.pageX, b.pageY)) return !1;
                var k = d.getFocusAnnot();
                return k && d.setFocusAnnot(null), d.getDocView().clearAllSelection(), g.onLButtonDown(b), c = !0, h.x = b.pageX, h.y = b.pageY, !1
            }, this.onLButtonUp = function(a) {
                if (c = !1, f) {
                    _marqueeToolView.clearMarqueeSelect(), g.clearSelection();
                    var b = {
                        left: h.x,
                        top: h.y,
                        right: a.pageX,
                        bottom: a.pageY
                    };
                    _marqueeToolView.zoomByArea(b)
                } else _marqueeToolView.zoomByPoint(a)
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(b) {
                if (c) {
                    f = !0, g.onMouseMove(b);
                    var d = g.getSelectionArray();
                    if (d.length > 0) {
                        var e = a.getMainView().getDocView().getPageView(g.getStartPageIndex());
                        _marqueeToolView.marqueeBoxSelectedRect(e, d)
                    }
                } else f = !1;
                return !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                var b = a.ctrlKey;
                return b && _marqueeToolView.setCursor(WebPDF.Cursor.ZOOMOUT), !1
            }, this.onKeyUp = function(a) {
                return _marqueeToolView.setCursor(WebPDF.Cursor.ZOOMIN), !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Event.MarqueeToolHandler
    }), define("core/Plugins/MarqueeTool/MarqueeToolService", [], function(a, b, c) {
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect,
            f = WebPDF.RectUtils;
        return WebPDF.MarqueeToolService = function(a) {
            var b = a,
                c = new d(0, 0),
                g = new d(0, 0),
                h = WebPDF.TextSelection.PDFTextSelectTool,
                i = [];
            this.getStartPageIndex = function() {
                return _startPageIndex
            }, this.clearSelection = function() {
                c = new d(0, 0), g = new d(0, 0), i = [], _startPageIndex = -1
            }, this.onLButtonDown = function(a) {
                var d = new WebPDF.PDFPoint(0, 0),
                    e = h.getPageViewInfoByMouseEvent(b, a, d, !0, !1);
                _startPageIndex = e.getPageIndex(), c = d
            }, this.onMouseMove = function(a) {
                function j(a, c, g) {
                    if (i = [], a.equal(c)) return !1;
                    var h = b.getMainView().getDocView().getPageView(g);
                    if (!h) return !1;
                    var j = new d(0, 0),
                        k = new d(0, 0);
                    j = h.devicePtToPDF(a), k = h.devicePtToPDF(c);
                    var l = new e(j.x, j.y, k.x, k.y);
                    return f.normalize(l), f.isEmpty(l) ? !1 : (i.push(l), !0)
                }
                var k = new WebPDF.PDFPoint(0, 0);
                k.x = a.pageX, k.y = a.pageY;
                var l = b.getMainView().getDocView().getPageView(_startPageIndex).getPageViewRect();
                return f.ptInRect(l, k) ? (h.getPageViewInfoByMouseEvent(b, a, k, !0, !1), g = k, void j(c, g, _startPageIndex)) : !1
            }, this.getSelectionArray = function() {
                return i
            }
        }, WebPDF.MarqueeToolService
    }), define("core/Plugins/MarqueeTool/MarqueeToolView", [], function(a, b, c) {
        var d = WebPDF.RectUtils;
        WebPDF.PDFRect;
        return WebPDF.MarqueeToolView = function(a) {
            var b = a,
                c = "",
                e = {};
            this.setCursor = function(a) {
                if (a == c) return !1;
                c = a;
                var d = b.getMainView().getDocView(),
                    e = $("#" + d.getDocViewContainerID()),
                    f = "fwr-zoomin-cursor",
                    g = "fwr-zoomout-cursor";
                a == WebPDF.Cursor.ZOOMIN && (f = "fwr-zoomout-cursor", g = "fwr-zoomin-cursor"), e.removeClass(f).addClass(g)
            }, this.delCursor = function() {
                var a = b.getMainView().getDocView(),
                    d = $("#" + a.getDocViewContainerID());
                d.removeClass("fwr-zoomout-cursor"), d.removeClass("fwr-zoomin-cursor"), c = ""
            }, this.clearMarqueeSelect = function(a) {
                function c(a) {
                    var b = d.getMarqueeBoxSelectDivId(a),
                        c = $("#" + b);
                    c.length > 0 && c.empty()
                }
                var d = this,
                    e = b.getMainView().getDocView();
                if (a && a >= 0) {
                    var f = e.getPageView(a);
                    if (!f) return;
                    return void c(f)
                }
                for (var g = e.getPageCount(), h = 0; g > h; h++) {
                    var f = e.getPageView(h);
                    if (!f) break;
                    c(f)
                }
            }, this.marqueeBoxSelectedRect = function(a, b) {
                var c = this.getMarqueeBoxSelectDivId(a),
                    f = a.getPageIndex();
                if (!e[f]) {
                    var g = "<div id='" + c + "' style='z-index:7;'></div>",
                        h = $("#" + a.getPageViewContainerID());
                    h.append(g), e[f] = !0
                }
                var i = "",
                    j = $("#" + c);
                j.empty();
                for (var k = 0; k < b.length; k++) {
                    var l = b[k];
                    d.normalize(l), l = a.pdfRectToDevice(l, !0), i += "<div id='marquee_select_" + f + "_" + k + "'class='fwr-text-highlight' style='left:" + l.left + "px;top:" + l.top + "px;width:" + d.width(l) + "px;height:" + d.height(l) + "px' ></div>"
                }
                j.append(i)
            }, this.getMarqueeBoxSelectDivId = function(a) {
                return a.getPageViewContainerID() + "_marqueeBoxSelect"
            }, this.zoomByArea = function(a) {
                var d = b.getMainView().getDocView(),
                    e = d.getPageView(d.getCurPageIndex()),
                    f = e.getPageViewOffsetpt(a.left, a.top),
                    g = e.getPageViewOffsetpt(a.right, a.bottom),
                    h = {
                        x: (f.x + (g.x - f.x) / 2) / e.getPageViewWidth(),
                        y: (f.y + (g.y - f.y) / 2) / e.getPageViewHeight()
                    },
                    i = $("#" + d.getDocViewContainerID()),
                    j = i.width(),
                    k = i.height(),
                    l = d.getScrollApi();
                if (l && (j -= l.getScrollBarWidth(), k -= l.getScrollBarHeight()), a.top > a.bottom) {
                    var m = a.top;
                    a.top = a.bottom, a.bottom = m
                }
                if (a.left > a.right) {
                    var m = a.left;
                    a.left = a.right, a.right = m
                }
                a.left = a.left > 0 ? a.left : 0, a.top = a.top > 0 ? a.top : 0;
                var n = (l.getContentPositionY(), l.getContentPositionX(), WebPDF.ViewerInstance.getCurZoomLevel());
                "FitPage" == n && (n = d.getFitPageScale());
                var o, p;
                p = j / (a.right - a.left) < k / (a.bottom - a.top) ? j / (a.right - a.left) : k / (a.bottom - a.top);
                var q = 10;
                if (b.isLargeFile() && (q = 2), c == WebPDF.Cursor.ZOOMIN) {
                    if (n >= q) return;
                    o = n * p, o > q && (o = q)
                } else {
                    if (.5 >= n) return;
                    o = n / p, .5 > o && (o = .5)
                }
                WebPDF.ViewerInstance.zoomTo(o), l.scrollBy(h.x * e.getPageViewWidth() - j / 2, h.y * e.getPageViewHeight() - k / 2)
            }, this.zoomByPoint = function(a) {
                var d = b.getMainView().getDocView(),
                    e = $("#" + d.getDocViewContainerID()),
                    f = e.height(),
                    g = e.width(),
                    h = d.getScrollApi();
                h && (g -= h.getScrollBarWidth(), f -= h.getScrollBarHeight());
                var i = e.offset(),
                    j = a.pageX,
                    k = a.pageY,
                    l = k - i.top,
                    m = j - i.left,
                    n = l / f,
                    o = m / g,
                    p = h.getContentPositionY(),
                    q = h.getContentPositionX(),
                    r = WebPDF.ViewerInstance.getCurZoomLevel();
                "FitPage" == r && (r = d.getFitPageScale());
                var s, t, u = 10;
                if (b.isLargeFile() && (u = 2), c == WebPDF.Cursor.ZOOMIN) {
                    if (r >= u) return;
                    s = r + .25, s > u && (s = u), t = s / r
                } else {
                    if (.5 >= r) return;
                    s = r - .25, .5 > s && (s = .5), t = s / r
                }
                WebPDF.ViewerInstance.zoomTo(s), q = g * (t - 1) * o + q * t, p = f * (t - 1) * n + p * t, h.scrollTo(q, p)
            }
        }, WebPDF.MarqueeToolView
    }), define("core/Plugins/TextSelection/PDFTextSelectTool", ["core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect", "core/Plugins/Text/PDFTextPage", "core/Plugins/TextSelection/PDFTextPageSelect"], function(a, b, c) {
        var d = (a("core/Plugins/Text/PDFTextObject"), a("core/Plugins/Text/PDFTextPage"), a("core/Plugins/TextSelection/PDFTextPageSelect")),
            e = WebPDF.PDFPoint,
            f = WebPDF.PDFRect,
            g = WebPDF.RectUtils,
            h = WebPDF.Common,
            i = WebPDF.Text.CaretInfo,
            j = WebPDF.Text.TextBoundInfo,
            k = {
                SELECT_MODE_NORMAL: 0,
                SELECT_MODE_IN_SELECTED: 1,
                SELECT_MODE_SELECTING: 2,
                SELECT_MODE_BOUND: 3
            };
        WebPDF.TextSelection.SELECT_STATE = k;
        var l = {
            CURSOR_NORMAL: 0,
            CURSOR_SELECT: 1,
            CURSOR_ARROW: 2,
            CURSOR_BOUND: 3,
            CURSOR_QKSCH: 4
        };
        WebPDF.TextSelection.CURSOR_STATE = l, WebPDF.TextSelection.TextPage = function() {
            this.textPage = null, this.pageSelectInfo = new d
        };
        var m = WebPDF.TextSelection.TextPage;
        WebPDF.TextSelection.TextSelectedInfo = function() {
            this.pageIndex = -1, this.selectedRectArray = []
        };
        var n = function(a) {
            function b() {
                try {
                    P || (P = document.createElement("iFrame"), P.id = A.getAppId() + "-copy-frame", P.className = "fwr-copy-frame", $("body").append(P), $("#" + P.id).off("load").on("load", function() {
                        P.contentWindow.title = "Reading View.", Q = !0
                    }))
                } catch (a) {
                    console.error(a)
                }
            }

            function c() {
                if (!P.contentWindow) return void console.warn("Cannot focus the copy frame's window, because it's null. Copy frame load status = " + Q + ".");
                $(P.contentWindow.document.body).empty().append("<p>" + S.getSelectedText() + "</p>");
                try {
                    if (P.contentWindow.focus(), "undefined" != typeof window.getSelection) {
                        var a = P.contentWindow.getSelection();
                        a.removeAllRanges(), a.selectAllChildren(P.contentWindow.document.body)
                    } else "undefined" != typeof document.execCommand && P.contentWindow.document.execCommand("SelectAll")
                } catch (b) {
                    console.error(b)
                }
            }

            function d() {
                if (!M) {
                    var a = A.getMainView().getDocView(),
                        b = a.getPageView(0),
                        c = $("#" + a.getDocViewContainerID()),
                        d = a.getDocViewContainerID() + "_text_bound_select",
                        e = "<div class='fwr-text-bound-selection fwr-hidden' id='" + d + "'></div>";
                    null != b && b.isContentCreated() ? $("#" + b.getPageViewContainerID()).parent().parent().append(e) : c.append(e), M = $("#" + d)
                }
                return M
            }

            function o() {
                if (!N) {
                    var a = A.getMainView().getDocView(),
                        b = a.getPageView(0),
                        c = $("#" + a.getDocViewContainerID()),
                        d = a.getDocViewContainerID() + "_selection_operation_bar";
                    R = a.getDocViewContainerID() + "_selection_operation_copy";
                    var e = "<div class='fwr-text-selection-operation-bar fwr-hidden' id='" + d + "'><ul><li ><a id='" + R + "' href='javascript:void(0);'>Copy</a></li></ul><div class='fwr-text-selection-operation-bar-right'/></div>";
                    null != b && b.isContentCreated() ? $("#" + b.getPageViewContainerID()).parent().parent().append(e) : c.append(e), N = $("#" + d), $("#" + R).off("click").on("click", function() {
                        WebPDF.copyText(A, S.getSelectedText()) && S.hideSelectionOperationDiv()
                    })
                }
                return N
            }

            function p(a) {
                if (!WebPDF.Environment.mobile) {
                    J = a;
                    var b = A.getMainView().getDocView(),
                        c = $("#" + b.getDocViewContainerID());
                    switch (a) {
                        case l.CURSOR_ARROW:
                            c.removeClass(O).css({
                                cursor: "default"
                            });
                            break;
                        case l.CURSOR_SELECT:
                        case l.CURSOR_NORMAL:
                            c.removeClass(O).css({
                                cursor: "text"
                            });
                            break;
                        case l.CURSOR_BOUND:
                            c.addClass("fwr-bound-cursor"), O = "fwr-bound-cursor"
                    }
                }
            }

            function q(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    if (!g.isEmpty(d) && g.ptInRect(d, a.x, a.y)) return !0
                }
                return !1
            }

            function r(a, b, c, d) {
                if (0 > c || 0 > d || -1 == a.index || -1 == b.index) return !1;
                var e, f, g, i, j;
                c > d && (e = c, c = d, d = e, j = !0);
                var k = h.clone(a),
                    l = h.clone(b);
                (j || c === d && k.index > l.index) && (e = k.index, k.index = l.index, l.index = e, e = k.bLeft, k.bLeft = l.bLeft, l.bLeft = e);
                var m = h.clone(D);
                D.length = 0;
                var n = m.length;
                for (i = 0; n > i; i++)
                    if (f = m[i], f > d || c > f) {
                        if (g = S.getTextPage(f), !g) return !1;
                        g.pageSelectInfo.clearSelectRect(), D.push(f)
                    }
                if (c != d) {
                    var o = S.getTextPage(c),
                        p = S.getTextPage(d);
                    if (!o || !p) return !1;
                    for (o.pageSelectInfo.addSelectedRectByIndex(k.bLeft ? k.index : k.index + 1, o.textPage.getSize() - 1), D.push(c), i = c + 1; d > i; i++) {
                        if (g = S.getTextPage(i), !g) return !1;
                        g.pageSelectInfo.selectAll(), g.pageSelectInfo.isSelected() && D.push(i)
                    }
                    return p.pageSelectInfo.addSelectedRectByIndex(0, l.bLeft ? l.index - 1 : l.index), D.push(d), D.length > 0
                }
                var q = k.index,
                    r = l.index;
                return k.index != l.index ? (0 == k.bLeft && q++, 1 == l.bLeft && r--, (g = S.getTextPage(c)) ? (g.pageSelectInfo.addSelectedRectByIndex(q, r), D.push(c), !0) : !1) : k.bLeft != l.bLeft ? (g = S.getTextPage(c)) ? (g.pageSelectInfo.addSelectedRectByIndex(k.index, l.index), D.push(c), !0) : !1 : 0 == m.length ? !1 : (g = S.getTextPage(c)) ? (g.pageSelectInfo.clearSelectRect(), D.push(c), !0) : !1
            }

            function s(a, b, c) {
                if (a.equal(b)) return 0 == D.length ? !1 : (S.clearSelection(), WebPDF.Environment.mobile && !ba && A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), !1);
                var d = new e(0, 0),
                    g = new e(0, 0);
                d = B.devicePtToPDF(a), g = B.devicePtToPDF(b);
                var h = new f(d.x, d.y, g.x, g.y),
                    i = S.getTextPage(c);
                return i ? (i.pageSelectInfo.addSelectedRect(h), D.length = 0, D.push(c), !0) : !1
            }

            function t(a) {
                return a.getPageViewContainerID() + "_TextHighLights"
            }

            function u(a) {
                if (null != a && a.isContentCreated()) {
                    $("#textMenu").css({
                        visibility: "hidden"
                    });
                    var b = t(a),
                        c = $("#" + b);
                    null != c && c.empty()
                }
            }

            function v() {
                for (var a = A.getMainView().getDocView(), b = 0; b < D.length; b++) {
                    var c = D[b],
                        d = S.getTextPage(c);
                    d && (d.pageSelectInfo.clearSelectRect(), u(a.getPageView(c)))
                }
            }

            function w(a, b) {
                if (!a || !a.isContentCreated() || !b) return !1;
                var c = t(a),
                    d = a.getPageIndex();
                if (!L[d]) {
                    var e = "<div id='" + c + "' style='z-index:7;'></div>",
                        h = $("#" + a.getPageViewContainerID());
                    h.append(e), L[d] = !0
                }
                var i = $("#" + c);
                i.empty();
                for (var j = "", k = null, l = null, m = 0; m < b.length; m++) {
                    var n = b[m];
                    g.normalize(n), n = a.pdfRectToDevice(n, !0), WebPDF.Environment.mobile && !ba && (0 == m && (k = n), m == b.length - 1 && (l = n)), j += "<div id='text_highlight_" + d + "_" + m + "'class='fwr-text-highlight' style='left:" + n.left + "px;top:" + n.top + "px;width:" + g.width(n) + "px;height:" + g.height(n) + "px' ></div>"
                }
                if (WebPDF.Environment.mobile && !ba && null != k && null != l) {
                    var o = new f(k.left - 30, k.top - 30, k.right + 3, k.bottom + 3);
                    g.normalize(o), Z = [], Z.push(o);
                    var p = new f(l.left - 3, l.top - 3, l.right + 30, l.bottom + 30);
                    g.normalize(p), _ = [], _.push(p), j += "<div id='text_highlight_mobile_left" + d + "_" + m + "'class='fwr-text-highlight-mobile' style='left:" + k.left + "px;top:" + (k.top - 5) + "px;width:2px;height:" + (g.height(k) + 5) + "px' ></div>", j += "<div id='text-select-start' class='text-select' style='position: absolute; left:" + (k.left - 7) + "px;top:" + (k.top - 5 - 15) + "px;'><svg><use xlink:href='#icon-text-select'></use></svg></div>", j += "<div id='text_highlight_mobile_right" + d + "_" + m + "'class='fwr-text-highlight-mobile' style='left:" + l.right + "px;top:" + l.top + "px;width:2px;height:" + (g.height(l) + 5) + "px' ></div>", j += "<div id='text-select-end' class='text-select' style='position: absolute; left:" + (l.right - 7) + "px;top:" + (l.bottom + 4) + "px;'><svg><use xlink:href='#icon-text-select'></use></svg></div>", ca = k, Y = !0
                }
                if (i.append(j), "" != j) {
                    var q = "fwr-textSelect-context-menu";
                    if (WebPDF.Environment.mobile && !ba) return !1;
                    $(".fwr-text-highlight").fwrContextMenu(q, {
                        onSelect: function(a, b) {
                            return S.onContextMenu($(this))
                        }
                    }, document.getElementById(A.getMainFrameId()))
                }
            }

            function x() {
                var a = d(),
                    b = Math.abs(X.x - W.x),
                    c = Math.abs(X.y - W.y),
                    e = null,
                    f = null;
                X.x < W.x && X.y < W.y && (e = X.x, f = X.y), X.x > W.x && X.y < W.y && (e = W.x, f = X.y), X.x < W.x && X.y > W.y && (e = X.x, f = W.y), X.x > W.x && X.y > W.y && (e = W.x, f = W.y);
                var g = A.getMainView().getDocView(),
                    h = g.getDocViewClientRect(),
                    i = g.getScrollApi(),
                    j = 0,
                    k = 0;
                i && (j = i.getContentPositionX(), k = i.getContentPositionY()), e = e - h.left + j, f = f - h.bottom + k, a.css({
                    left: e,
                    top: f,
                    width: b,
                    height: c
                }).removeClass("fwr-hidden")
            }

            function y() {
                var a = d();
                a.addClass("fwr-hidden")
            }

            function z(a) {
                if (!B) return !1;
                var b = A.getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID()),
                    d = c.height(),
                    e = c.width() - 16,
                    h = c.offset(),
                    i = b.getScrollApi();
                i && (e -= i.getScrollBarWidth(), d -= i.getScrollBarHeight());
                var j = new f(h.left, h.top, h.left + e, h.top + d);
                if (g.normalize(j), g.ptInRect(j, a)) return !1;
                var k = 0,
                    l = 0,
                    m = 20;
                return a.x < j.left && (k = -m), a.y < j.bottom && (l = -m), a.x > j.right && (k = m), a.y > j.top && (l = m), b.movePage(k, l), !0
            }
            WebPDF.TextSelection.PDFTextSelectTool.Instance = null, WebPDF.TextSelection.PDFTextSelectTool.CreateTextSelectTool = function(a, b) {
                return null == WebPDF.TextSelection.PDFTextSelectTool.Instance && (WebPDF.TextSelection.PDFTextSelectTool.Instance = new WebPDF.TextSelection.PDFTextSelectTool(a, b)), WebPDF.TextSelection.PDFTextSelectTool.Instance
            };
            var A = a,
                B = null,
                C = [],
                D = [],
                E = !1,
                F = new e(0, 0),
                G = new e(0, 0),
                H = -1,
                I = k.SELECT_MODE_NORMAL,
                J = l.CURSOR_SELECT,
                K = !1,
                L = {},
                M = null,
                N = null,
                O = null,
                P = null,
                Q = !1,
                R = null,
                S = this,
                T = null,
                U = new i,
                V = new i,
                W = new e(0, 0),
                X = new e(0, 0),
                Y = !1,
                Z = [],
                _ = [],
                aa = !1,
                ba = !1;
            b(), this.getTextPage = function(a) {
                var b = C[a];
                if (!b) {
                    var c = A.getTextManager().getTextPage(a, !1);
                    if (null != c) {
                        if (c.blocking) return null;
                        b = new m, b.textPage = c, b.pageSelectInfo.setTextPage(c), C[a] = b
                    }
                }
                return b
            }, this.hideSelectionOperationDiv = function() {
                var a = o();
                a.addClass("fwr-hidden")
            }, this.onLButtonDown = function(a) {
                if (a.target.id === R) return !1;
                if (ba = !1, WebPDF.Environment.mobile) {
                    var b = A.getCurToolHandler().getName();
                    ba = b == WebPDF.Tools.TOOL_NAME_COMMENT_HIGHTLIGHT || b == WebPDF.Tools.TOOL_NAME_COMMENT_UNDERLINE
                }
                W.x = a.pageX, W.y = a.pageY;
                var c, d = new e(0, 0);
                if (c = n.getPageViewInfoByMouseEvent(A, a, d, !0, !1), !c) {
                    T = c;
                    var f = A.getMainView().getDocView(),
                        j = new e(a.pageX, a.pageY),
                        m = f.getDocViewClientRect();
                    return void(g.ptInRect(m, j) && (this.clearSelection(), WebPDF.Environment.mobile && !ba && A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND)))
                }
                if (c.isPageLoaded()) {
                    h.preventDefaults(a, !0), K = !0;
                    var o = new e(0, 0);
                    o = c.devicePtToPDF(d);
                    var s = [],
                        t = c.getPageIndex(),
                        u = S.getTextPage(t);
                    if (u) {
                        u.pageSelectInfo.getSelectPDFRect(s);
                        var v = q(d, Z);
                        if (v ? aa = !0 : v = q(d, _), Y && v) return I = k.SELECT_MODE_SELECTING, aa && V.index < U.index ? V = U : !aa && V.index > U.index && (V = U), H = B.getPageIndex(), !1;
                        if (WebPDF.Environment.mobile && !ba) return this.clearSelection(), A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), !1;
                        if (q(o, s)) return I = k.SELECT_MODE_IN_SELECTED, void p(l.CURSOR_ARROW);
                        var w, x = u.textPage.getCharIndexByPoint(o); - 1 != x && (w = new i, u.textPage.getCaretAtPoint(o, w), -1 == w.index && (x = -1));
                        var y = a.altKey;
                        if (E && (this.clearSelection(), WebPDF.Environment.mobile && !ba && A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), E = !1, U.index = -1), x >= 0 && !y) {
                            var z = a.shiftKey;
                            if (I = k.SELECT_MODE_SELECTING, p(l.CURSOR_SELECT), V.index < 0) {
                                if (B != c && (B = c), u.textPage.getCaretAtPoint(o, U), V = h.clone(U), H = B.getPageIndex(), U.index < 0) return
                            } else if (z) {
                                if (z) {
                                    if (-1 == V.index) return;
                                    w = new i, u.textPage.getCaretAtPoint(o, w), B != c && (B = c), U = w, r(V, U, H, B.getPageIndex())
                                }
                            } else {
                                if (V.index < 0) return;
                                this.clearSelection(), WebPDF.Environment.mobile && !ba && A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), w = new i, u.textPage.getCaretAtPoint(o, w), B != c && (B = c), U = w, V = h.clone(U), H = B.getPageIndex()
                            }
                        } else this.clearSelection(), WebPDF.Environment.mobile && !ba && A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), B = c, x >= 0 && (u.textPage.getCaretAtPoint(o, V), H = B.getPageIndex()), U.index = -1, F = G = d, I = k.SELECT_MODE_BOUND, p(l.CURSOR_BOUND)
                    }
                }
            }, this.onRButtonUp = function(a) {
                var b, c = new e(0, 0);
                if (b = n.getPageViewInfoByMouseEvent(A, a, c, !0, !1), !b) return !1;
                if (b.isPageLoaded()) {
                    var d = new e(0, 0);
                    d = b.devicePtToPDF(c);
                    var f = b.getPageIndex(),
                        g = S.getTextPage(f);
                    if (!g) return !1;
                    var h = [];
                    return g.pageSelectInfo.getSelectPDFRect(h), q(d, h)
                }
            };
            var ca = null;
            this.onLButtonUp = function(a, b) {
                K = !1, y();
                var c, d = new e(0, 0);
                if (c = n.getPageViewInfoByMouseEvent(A, a, d, !0, !1), (c || (c = T)) && c.isPageLoaded()) {
                    if (WebPDF.Environment.mobile && !ba) {
                        if (aa = !1, A.isCopyText()) {
                            var f = A.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                            if (f && Y) {
                                var g = a.pageX - 100,
                                    h = a.pageY - 70;
                                g + $("#textMenu").width() + 5 > $("#docViewer").width() && (g = $("#docViewer").width() - $("#textMenu").width() - 5), $("#textMenu").css({
                                    visibility: "visible",
                                    left: g > 0 ? g : 0,
                                    top: h > 0 ? h : 0
                                })
                            }
                        }
                        return !1
                    }
                    var i = new e(0, 0);
                    i = c.devicePtToPDF(d);
                    var j = c.getPageIndex(),
                        m = S.getTextPage(j);
                    if (!m) return !1;
                    var o = [];
                    m.pageSelectInfo.getSelectPDFRect(o);
                    var r = !1;
                    return r = Y ? !(Y && (q(d, Z) || q(d, _))) : q(i, o), I == k.SELECT_MODE_IN_SELECTED && r && (ba || !WebPDF.Environment.mobile) && this.clearSelection(), r && J != l.CURSOR_ARROW ? p(l.CURSOR_ARROW) : r || J == l.CURSOR_SELECT || p(l.CURSOR_SELECT), I = 0 == r && Y ? k.SELECT_MODE_SELECTING : k.SELECT_MODE_NORMAL, S.highLightAllSelectedText(), ba = !1, !0
                }
            }, this.getSelectedText = function() {
                for (var b = "", c = D.length, d = 0; c > d; d++) {
                    var e = D[d],
                        f = S.getTextPage(e);
                    f && f.textPage && (b += f.pageSelectInfo.getSelectedText(), d != c - 1 && (b += WebPDF.TEXT_RETURN_LINEFEED))
                }
                var g = '{"PageIndex":"' + D[c - 1] + '","Type":"text"}';
                return a.addRecord("Copy", "Copy", g), b
            }, this.getSelectedTextRectInfo = function() {
                for (var a = [], b = 0; b < D.length; b++) {
                    var c = D[b],
                        d = S.getTextPage(c);
                    if (d && d.pageSelectInfo.isSelected()) {
                        var e = [];
                        d.pageSelectInfo.getSelectPDFRect(e);
                        var f = new WebPDF.TextSelection.TextSelectedInfo;
                        f.pageIndex = c, f.selectedRectArray = e, a.push(f)
                    }
                }
                return a
            }, this.clearSelection = function() {
                v(), S.hideSelectionOperationDiv(), Y = !1, Z = [], _ = [], aa = !1;
                var a = A.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                a && WebPDF.Environment.mobile && $("#textMenu").hide()
            }, this.highLightAllSelectedText = function() {
                for (var a = D.length, b = 0; a > b; b++) {
                    var c = D[b],
                        d = S.getTextPage(c);
                    if (d) {
                        var e = [];
                        d.pageSelectInfo.getSelectPDFRect(e), w(A.getMainView().getDocView().getPageView(c), e)
                    }
                }
            }, this.highLightTextArea = function(a) {
                for (var b = a.length, c = 0; b > c; c++) {
                    var d = a[c],
                        e = S.getTextPage(d.pageIndex);
                    if (e) {
                        var f = [];
                        f = d.selectedRectArray, w(A.getMainView().getDocView().getPageView(d.pageIndex), f)
                    }
                }
            }, this.onContextMenu = function(a) {
                if (null != a) try {
                    var b = a.attr("menuname");
                    if ("Copy" == b) WebPDF.copyText(A, S.getSelectedText());
                    else if ("Highlight" == b) {
                        var c = A.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_HIGHTLIGHT);
                        c.createAnnot(), A.getMainView().getDocView().setModified(!0)
                    } else if ("Underline" == b) {
                        var d = A.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_UNDERLINE);
                        d.createAnnot(), A.getMainView().getDocView().setModified(!0)
                    }
                    S.clearSelection(), this.onActivate()
                } catch (e) {}
            }, this.onActivate = function() {
                var a = A.getMainView();
                if (a) {
                    var b = a.getDocView(),
                        c = $("#" + b.getDocViewContainerID());
                    c.css({
                        cursor: "text"
                    })
                }
            }, this.onLButtonDblClk = function(a, b) {
                if (a && I !== k.SELECT_MODE_BOUND && !ba) {
                    var d = null,
                        f = new e(0, 0);
                    if (d = n.getPageViewInfoByMouseEvent(A, a, f, !0, !1), d && d.isPageLoaded()) {
                        B = d;
                        var g = d.getPageIndex(),
                            l = S.getTextPage(g);
                        if (l) {
                            var m = new e(0, 0);
                            m = d.devicePtToPDF(f);
                            var o = l.textPage.getCharIndexByPoint(m);
                            if (-1 != o) {
                                var p = new i;
                                l.textPage.getCaretAtPoint(m, p), -1 == p.index && (o = -1)
                            }
                            if (-1 != o) {
                                var q = new j(-1, -1);
                                if (l.textPage.getWordRange(o, q)) {
                                    if (-1 === q.startIndex || -1 === q.endIndex) return;
                                    if (WebPDF.Environment.mobile) {
                                        var p = new i;
                                        l.textPage.getCaretByIndex(q.startIndex, p, !0), V = h.clone(p), l.textPage.getCaretByIndex(q.endIndex, p, !0), U = h.clone(p)
                                    }
                                    if (l.pageSelectInfo.addSelectedRectByIndex(q.startIndex, q.endIndex), D.length = 0, D.push(g), $.isFunction(b)) b(a);
                                    else {
                                        WebPDF.Environment.mobile && A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                                        var r = [];
                                        l.pageSelectInfo.getSelectPDFRect(r), c(), S.highLightAllSelectedText()
                                    }
                                }
                            } else WebPDF.Environment.mobile && (this.clearSelection(), A.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND))
                        }
                    }
                }
            }, this.onMouseMove = function(a) {
                if (K && (!WebPDF.Environment.mobile || ba || Y)) {
                    var b, c = new e(0, 0);
                    if (b = n.getPageViewInfoByMouseEvent(A, a, c, !0, !0), null != b && b.isPageLoaded()) {
                        T = b, K && WebPDF.Common.preventDefaults(a, !0);
                        var d = new e(0, 0);
                        d = b.devicePtToPDF(c);
                        var f = b.getPageIndex(),
                            g = S.getTextPage(f);
                        if (g) {
                            var h = [];
                            g.pageSelectInfo.getSelectPDFRect(h);
                            var j = !1;
                            j = Y ? !1 : q(d, h);
                            var m, o = g.textPage.getCharIndexByPoint(d); - 1 != o && (m = new i, g.textPage.getCaretAtPoint(d, m), -1 == m.index && (o = -1));
                            var t = a.altKey;
                            if (I == k.SELECT_MODE_NORMAL) return void p(j ? l.CURSOR_ARROW : o >= 0 && !t ? l.CURSOR_SELECT : o >= 0 && t ? l.CURSOR_BOUND : l.CURSOR_NORMAL);
                            if (I == k.SELECT_MODE_BOUND) {
                                if (!ba && J != l.CURSOR_BOUND) return;
                                E = !0, G = c;
                                var u = B.getPageIndex();
                                f != u && (u > f ? G.y = 0 : G.y = B.getPageViewHeight()), s(F, G, u, f) && (S.highLightAllSelectedText(), g.pageSelectInfo.getFirstCaretInfo(U)), X.x = a.pageX, X.y = a.pageY, x()
                            } else if (I == k.SELECT_MODE_SELECTING) {
                                if (!WebPDF.Environment.mobile && J != l.CURSOR_SELECT) return;
                                if (!B || U.index < 0) return;
                                B != b && (B = b), m = new i, g.textPage.getCaretAtPoint(d, m) && (U = m, r(V, U, H, B.getPageIndex()) && S.highLightAllSelectedText()), z(new e(a.pageX, a.pageY))
                            }
                        }
                    }
                }
            }, this.onHold = function(a) {
                S.onLButtonDblClk(a)
            }, this.isSelected = function() {
                for (var a = D.length, b = 0; a > b; b++) {
                    var c = S.getTextPage(D[b]);
                    if (c) {
                        var d = [];
                        if (c.pageSelectInfo.getSelectPDFRect(d) > 0) return !0
                    }
                }
                return !1
            }, this.getSelectedPageRange = function() {
                for (var a = A.getMainView().getDocView().getPageCount(), b = -1, c = 0; c < D.length; c++) D[c] < a && (a = D[c]), D[c] > b && (b = D[c]);
                return {
                    start: a,
                    end: b
                }
            }
        };
        return n.ToolInstances = {}, n.getTextSelectTool = function(a) {
            var b = n.ToolInstances[a.getAppId()];
            return b || (b = new n(a), n.ToolInstances[a.getAppId()] = b), b
        }, n.getPtOffsetPageView = function(a, b, c) {
            if (!a) return !1;
            var d = $("#" + a.getPageViewContainerID()).offset(),
                e = a.getPageViewHeight() + 14,
                h = new f(0, d.top, a.getDocView().getDocViewWidth(), d.top + e);
            return g.normalize(h), c.x = b.pageX - d.left, c.y = b.pageY - d.top, g.ptInRect(h, b.pageX, b.pageY)
        }, n.getPageViewInfoByMouseEvent = function(a, b, c, d, f) {
            var h = a.getMainView().getDocView(),
                i = h.getVisiblePageRange(),
                j = null,
                k = new e(b.pageX, b.pageY),
                l = h.getDocViewClientRect();
            if (!f && !g.ptInRect(l, k)) return j;
            for (var m, o = i.begin; o <= i.end; o++)
                if (m = h.getPageView(o), null != m && n.getPtOffsetPageView(m, b, c)) {
                    j = m;
                    break
                }
            return !j && d && (m = h.getPageView(h.getCurPageIndex()), n.getPtOffsetPageView(m, b, c), j = m), j
        }, WebPDF.TextSelection.PDFTextSelectTool = n, WebPDF.TextSelection.PDFTextSelectTool
    }), define("core/Plugins/TextSelection/PDFTextPageSelect", ["core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect", "core/Plugins/Text/PDFTextPage"], function(a, b, c) {
        var d = (a("core/Plugins/Text/PDFTextObject"), a("core/Plugins/Text/PDFTextPage"), WebPDF.PDFPoint, WebPDF.PDFRect, WebPDF.RectUtils),
            e = WebPDF.Common,
            f = WebPDF.CMap;
        WebPDF.TextSelection = {};
        var g = function(a, b) {
            this.startIndex = a, this.endIndex = b
        };
        return WebPDF.TextSelection.TextSelectRange = g, WebPDF.TEXT_RETURN_LINEFEED = "\r\n", WebPDF.TextSelection.PDFTextPageSelect = function() {
            function a(a, c, d) {
                if (!(null == b || c > d)) {
                    var e = new g(-1, -1);
                    c > a.startIndex && (c <= a.endIndex ? (e.startIndex = a.startIndex, e.endIndex = c - 1, i.push(e)) : i.push(a)), d < a.endIndex && (d >= a.startIndex ? (e.startIndex = d + 1, e.endIndex = a.endIndex, i.push(e)) : i.push(a)), a.startIndex > c && (a.startIndex <= d ? (e.startIndex = c, e.endIndex = a.startIndex - 1, h.push(e)) : (e.startIndex = c, e.endIndex = d, h.push(e))), a.endIndex < d && (a.endIndex >= c ? (e.startIndex = a.endIndex + 1, e.endIndex = d, h.push(e)) : (e.startIndex = c, e.endIndex = d, h.push(e)))
                }
            }
            var b = null,
                c = [],
                h = [],
                i = [],
                j = !0;
            this.setTextPage = function(a) {
                var c = b;
                return b = a, c
            }, this.addSelectedRect = function(j) {
                if (b) {
                    d.normalize(j);
                    var k = [];
                    if (h = [], i = [], !b.getBoundPageInfo(j, k)) return i.length = 0, i = e.clone(c), c.length = 0, void(h.length = 0);
                    var l, m = c.length;
                    if (0 == m) {
                        l = k.length;
                        for (var n = 0; l > n; n++) c.push(new g(k[n].startIndex, k[n].endIndex));
                        return h = [], void(h = e.clone(c))
                    }
                    var o = new f,
                        p = new f,
                        q = new f;
                    l = k.length;
                    for (var n = 0; l > n; n++) {
                        var r = b.getLineIndexByIndex(k[n].startIndex);
                        o.put(r, n), p.put(n, r)
                    }
                    for (var s = 0; m > s; s++) {
                        var r = b.getLineIndexByIndex(c[s].startIndex);
                        q.put(r, s);
                        var t = o.get(r);
                        null != t ? a(c[s], k[t].startIndex, k[t].endIndex) : i.push(e.clone(c[s]))
                    }
                    for (var u = 0; l > u; u++) {
                        var r = p.get(u);
                        if (null == r) return;
                        var t = q.get(r);
                        null == t && h.push(new g(k[u].startIndex, k[u].endIndex))
                    }
                    c = [];
                    for (var v = 0; l > v; v++) c.push(new g(k[v].startIndex, k[v].endIndex))
                }
            }, this.addSelectedRectByIndex = function(d, f, k) {
                if (b) {
                    if (j = k, d > f || 0 > d || f > b.getSize()) return void this.clearSelectRect();
                    if (0 == c.length) h = [], i = [], c.push(new g(d, f)), h = e.clone(c);
                    else {
                        var l = c[0];
                        h = [], i = [], a(l, d, f), c = [], c.push(new g(d, f))
                    }
                }
            }, this.clearSelectRect = function() {
                b && (h.length = 0, i.length = 0, i = e.clone(c), c.length = 0)
            }, this.selectAll = function() {
                if (b) {
                    h.length = 0, i.length = 0, i = e.clone(c);
                    var a = new g(0, b.getSize() - 1);
                    c.length = 0, c.push(a), h.push(a)
                }
            }, this.isSelected = function() {
                return c.length > 0
            }, this.getSelectPDFRect = function(a) {
                a.length = 0;
                for (var d = c.length, e = 0; d > e; e++) {
                    var f = c[e].startIndex,
                        g = c[e].endIndex - c[e].startIndex + 1;
                    if (!(0 >= g))
                        for (var h = b.getPDFRect(f, g), i = 0; i < h.length; i++) a.push(h[i])
                }
                return a.length
            }, this.getSelectPDFRectAndMatrix = function(a, d, e) {
                a.length = 0, d.length = 0;
                for (var f = c.length, g = 0; f > g; g++) {
                    var h = c[g].startIndex,
                        i = c[g].endIndex - c[g].startIndex + 1;
                    if (!(0 >= i))
                        for (var j = b.getPDFRect(h, i, d, e), k = 0; k < j.length; k++) a.push(j[k])
                }
                return a.length
            }, this.getEndCartPDFPoint = function(a, d) {
                for (var e = c.length, f = {}, g = 0; e > g; g++) {
                    var h = c[g].endIndex;
                    j || d || (h = c[g].startIndex);
                    var i = b.getPDFRect(h, 1, [], []);
                    if (i.length <= 0) return null;
                    switch (a = (90 * a % 360 + 360) % 360) {
                        case 0:
                            j ? f.x = i[0].right : f.x = i[0].left, f.y = i[0].bottom, f.height = i[0].bottom - i[0].top, f.width = (i[0].right - i[0].left) / Math.abs(i[0].right - i[0].left) * Math.abs(i[0].bottom - i[0].top) / 2;
                            break;
                        case 90:
                            j ? f.y = i[0].bottom : f.y = i[0].top, f.x = i[0].left, f.width = i[0].right - i[0].left, f.height = (i[0].bottom - i[0].top) / Math.abs(i[0].bottom - i[0].top) * Math.abs(i[0].right - i[0].left) / 2;
                            break;
                        case 180:
                            j ? f.x = i[0].left : f.x = i[0].right, f.y = i[0].top, f.height = i[0].bottom - i[0].top, f.width = (i[0].right - i[0].left) / Math.abs(i[0].right - i[0].left) * Math.abs(i[0].bottom - i[0].top) / 2;
                            break;
                        case 270:
                            j ? f.y = i[0].top : f.y = i[0].bottom, f.x = i[0].right, f.width = i[0].right - i[0].left, f.height = (i[0].bottom - i[0].top) / Math.abs(i[0].bottom - i[0].top) * Math.abs(i[0].right - i[0].left) / 2
                    }
                }
                return f
            }, this.getCaretDirection = function() {
                for (var a = c.length, b = 0; a > b; b++) {
                    if (c[b].endIndex > c[b].startIndex) return !0;
                    if (c[b].endIndex < c[b].startIndex) return !1
                }
                return !1
            }, this.getNeedDrawPDFRect = function(a) {
                a.length = 0;
                for (var c = h.length, d = 0; c > d; d++) {
                    var e = h[d].startIndex,
                        f = h[d].endIndex - h[d].startIndex + 1;
                    if (!(0 >= f))
                        for (var g = b.getPDFRect(e, f), i = 0; i < g.length; i++) a.push(g[i])
                }
                return a.length
            }, this.getNeedClearPDFRect = function(a) {
                a.length = 0;
                for (var c = i.length, d = 0; c > d; d++) {
                    var e = i[d].startIndex,
                        f = i[d].endIndex - i[d].startIndex + 1;
                    0 >= f || (a = b.getPDFRect(e, f))
                }
                return a.length
            }, this.getSelectedText = function() {
                for (var a = "", d = c.length, e = 0; d > e; e++) {
                    var f = c[e].startIndex,
                        g = c[e].endIndex - c[e].startIndex + 1;
                    0 >= g || (a += b.getPageText(f, g), d - 1 > e && (a += WebPDF.TEXT_RETURN_LINEFEED))
                }
                return a
            }, this.getFirstCaretInfo = function(a) {
                a.index = -1, 0 != c.length && b.getCaretByIndex(c[0].startIndex, a, !0)
            }
        }, WebPDF.TextSelection.PDFTextPageSelect
    }), define("core/Plugins/Print/PrintConfig", [], function(a, b, c) {
        var d = WebPDF.Config;
        WebPDF.printPlugin = function(a) {
            function b(a) {
                a ? a : i18n.t("Print.PrintImageError"), jQuery("#continueButtonProgress").attr("style", "display:''"), jQuery("#progressDialogLableInfo").css("display", "block"), jQuery("#progressDialogLableInfo").html("<lable>" + a + "</lable>")
            }

            function c(a) {
                var b = 1 / r,
                    c = a.getDocView().getWatermarkHtmlContent(a, b, R % 180 == 0 ? 0 : R);
                return "<div class='watermark'>" + c + "</div>"
            }

            function e(a) {
                var b = 1 / (r * a.getScale()),
                    c = l.getPluginByName(WebPDF.InkSignPluginName);
                if (!c) return "";
                var d = a.getPDFPage().getInkSignMap();
                if (!d || 0 == d.length) return "";
                var e = c.getInkSignView(),
                    g = e.getInkSignsHtmlContent(a, b);
                if (!g) return "";
                var h = $(g),
                    i = h.find(".vml"),
                    j = c.getSignService(),
                    k = j.isPageInkSignCreated(a.getPageIndex());
                return f(a, d, e, j, i, b, k), g = h.html(), "<div class='inksign' >" + g + "</div>"
            }

            function f(a, b, c, d, e, f, g) {
                for (var h in b) {
                    var i = b[h];
                    if (null != i) {
                        var j = c.getPageSigCanvansID(a, i.getSigName());
                        e.each(function() {
                            if (jQuery(this).attr("id") == j) {
                                var b = "";
                                if (!s)
                                    if (b = this.outerHTML, g) {
                                        if (!document.getElementById(j)) return void console.warn("print inksign canvas id:" + j + " fail");
                                        b = b.replace("<canvas", "<img src=" + document.getElementById(j).toDataURL()).replace("</canvas>", "</img>")
                                    } else d.drawInkSign(a, i, this, f), b = b.replace("<canvas", "<img src=" + this.toDataURL()).replace("</canvas>", "</img>");
                                $(this).parent().html(b)
                            }
                        })
                    }
                }
            }

            function g(a, b, c, d, e, f) {
                for (var g in b) {
                    var h = b[g];
                    if (null != h && !("Markup" != h.getType() && h.getType() != WebPDF.Annot.AnnotType.Callout || "Ink" != h.getSubType() && h.getSubType() != WebPDF.Annot.AnnotType.Circle && h.getSubType() != WebPDF.Annot.AnnotType.Polygon && h.getSubType() != WebPDF.Annot.AnnotType.PolyLine && h.getSubType() != WebPDF.Annot.AnnotType.Square && h.getSubType() != WebPDF.Annot.AnnotType.Line && h.getType() != WebPDF.Annot.AnnotType.Callout && h.getSubType() != WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY && h.getSubType() != WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET)) {
                        var i = c.getAnnotCavansDivID(a, h.getAnnotName());
                        d.each(function() {
                            if (jQuery(this).attr("id") == i || h.getSubType() == WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY || h.getType() === WebPDF.Annot.AnnotType.Callout) {
                                i = jQuery(this).attr("id");
                                var b = "";
                                if (s) $(this).parent().remove();
                                else if (b = this.outerHTML, f) {
                                    if (!document.getElementById(i)) return void console.warn("print annot canvas id:" + i + " fail");
                                    b = b.replace("<canvas", "<img src=" + document.getElementById(i).toDataURL()).replace("</canvas>", "</img>")
                                } else c.showAInkAnnot(a, h, !1, this, e), b = b.replace("<canvas", "<img src=" + this.toDataURL()).replace("</canvas>", "</img>");
                                $(this).parent().append(b)
                            }
                        })
                    }
                }
            }

            function h(a) {
                var b = 1 / (r * a.getScale()),
                    c = "",
                    d = l.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                if (!d) return c;
                var e = d.getAnnotHandlerMgr();
                c = e.getAnnotsHtmlContent(a, b, !0);
                var f = $(c),
                    h = a.getPDFPage().getAnnotsMap(),
                    i = f.find(".vml"),
                    j = e.isPageAnnotCreated(a.getPageIndex());
                return g(a, h, e, i, b, j), c = f.html(), "<div class='annot' >" + c + "</div>"
            }

            function i(a) {
                var b = 1 / r,
                    c = l.getPluginByName(WebPDF.FormPluginName);
                if (!c) return "";
                var d = c.getFormHtmlContent(a, b);
                return "<div class='form' >" + d + "</div>"
            }
            var j, k, l = a,
                m = this,
                n = !1,
                o = null,
                p = null,
                q = null,
                r = null,
                s = !1,
                t = 0,
                u = 0,
                v = 0,
                w = "",
                x = !1,
                y = "fwrprintdlg",
                z = "fwrPrintProgressDlg",
                A = "",
                B = "",
                C = 4.2,
                D = null,
                E = "",
                F = 21.5 / 2.54,
                G = 11,
                H = 96 * Number(F) * .9,
                I = 96 * Number(G) * .9,
                J = "",
                K = "",
                L = !1,
                M = "",
                N = !1,
                O = !1,
                P = !1,
                Q = !1,
                R = !1;
            WebPDF.PrintPluginName = "Print Plugin", this.getName = function() {
                return WebPDF.PrintPluginName
            }, this.onRegister = function() {}, this.init = function() {
                m._browser()
            }, this.unload = function() {}, this.getReaderApp = function() {
                return l
            }, this.onBeforeUnload = function() {
                return n ? (n = !1, jQuery("#continueButtonProgress").attr("style", ""), i18n.t("Print.BrowserClosePrintingPrompt")) : void 0
            }, this._browser = function() {
                WebPDF.Environment.ie && (WebPDF.Environment.ie8 || WebPDF.Environment.ie8Compact || WebPDF.Environment.ie7Compact || WebPDF.Environment.ie6Compact) && (s = !0), WebPDF.Environment.safari && Number(WebPDF.Environment.version) > Number(C) && (D = !0)
            }, this.showPrintDlg = function() {
                function a(a) {
                    var c = a.split(",").map(function(a) {
                            return a.split("-").map(function(a) {
                                return parseInt(a)
                            })
                        }).map(function(a) {
                            var b = a[0],
                                c = a[1];
                            return {
                                start: b,
                                end: c || b
                            }
                        }),
                        d = l.getLargeFileDocId(),
                        e = WebPDF.ViewerInstance.getFileID(),
                        f = c.map(function(a) {
                            return ServerService.parsePages(d, e, a.start - 1, a.end - 1)
                        });
                    WebPDF.waiting(null, null, i18n.t("Load.Processing")), Promise.all(f).then(function() {
                        WebPDF.closeWaiting(), b(a)
                    }, function() {
                        WebPDF.alert(null, null, i18n.t("Print.PrintImageFailed")), WebPDF.closeWaiting()
                    })
                }

                function b(a) {
                    function b() {
                        return m.closePrintDlg(), m.showProgressDlg(B), 0 == u ? void(x = !1) : void m.requestImage(t - 1, c, d.defaults.requestRetryCount)
                    }
                    var e = {};
                    if (apiConfig && apiConfig.print && "object" == typeof apiConfig.print.getPrintCount) e = apiConfig.print.getPrintCount;
                    else {
                        if (!apiConfig || !apiConfig.print || "function" != typeof apiConfig.print.getPrintCount) return void b();
                        e = apiConfig.print.getPrintCount()
                    }
                    if (!e || "restful" != e.type) return void b();
                    var f = l.getFileID(),
                        g = WebPDF.AccountInstance.getUserId(),
                        h = l.getOptions().baseUrl + "/rest",
                        i = e.params;
                    i.fileId = f, i.userId = g, i.printRange = a, e.params = i;
                    var j = {
                        params: JSON.stringify(e)
                    };
                    $.ajax({
                        url: h,
                        type: "GET",
                        dataType: "json",
                        data: j,
                        success: function(c) {
                            var d = c.data;
                            if (0 !== c.ret || !d || !d.printRange) return d.printRange = null, d.remainingPrintCount = 0, void $(l).trigger(WebPDF.EventList.PAGES_PREPARE_PRINT, d);
                            $(l).trigger(WebPDF.EventList.PAGES_PREPARE_PRINT, d);
                            var e = d.printRange;
                            if (a !== e) {
                                e = e.split(",");
                                for (var f = 0; f < e.length; f++) e[f] = e[f].split("-");
                                x = !0, w = new Array;
                                for (var f = 0; f < e.length; f++)
                                    if (1 === e[f].length) w.push(parseInt(e[f]));
                                    else
                                        for (var g = e[f][0]; g <= e[f][1]; g++) w.push(parseInt(g));
                                u = w.length, B = w.length, t = 1
                            }
                            b()
                        }
                    })
                }
                var c = l.getMainView().getDocView(),
                    e = c.getPageCount(),
                    f = "fwr-print-title",
                    g = null,
                    h = "printButton",
                    i = null,
                    k = "cancelButton",
                    o = null,
                    p = "all-radio",
                    q = null,
                    r = "current-page-radio",
                    s = null,
                    z = "page-from-radio",
                    C = null,
                    F = "page-from-start",
                    G = null,
                    H = "page-from-end",
                    I = null,
                    M = "pages-texts",
                    N = null,
                    O = "pages-radio",
                    R = null,
                    S = "printCommentsCheck",
                    T = null,
                    U = "printPopupsCheck";
                if (L || (K = "<div id='" + y + "' class='fwr-print-dlg fwr-modal fwr-hide fwr-fade fwr-in ' style='display: none; z-index: 1004; outline: 0px; position: absolute; height: auto; width: 350px;'><div class='fwr-modal-header' ><a class='close' webpdf-data-dismiss='modal'></a><h4 id='" + f + "'> " + i18n.t("Print.PrintSettingsDlgTitle") + "</h4></div><div id='printDialog'  class='fwr-modal-body fwr-dialog-padding ui-dialog-content ui-widget-content'><div class='title-line top-line'><h5>" + i18n.t("Print.PrintRangeLabel") + "</h5></div><div class='content-line'><input style='margin-left:50px;margin-right: 7px;' checked='checked' id='" + p + "' value='all' name='check-print-model' type='radio'>" + i18n.t("Print.PrintDlgItemAll") + "</div><div class='content-line'><input id='" + r + "' style='margin-left:50px;margin-right: 7px;' value='currentpage' name='check-print-model' type='radio'>" + i18n.t("Print.PrintDlgItemCurPage") + "</div><div class='content-line'><input style='margin-left:50px;margin-right: 7px;' id='" + z + "' value='page_from' name='check-print-model' type='radio'><span style='display: inline-block;width:70px'>" + i18n.t("Print.PrintDlgItemPageFrom") + "</span><select style='width:106px;margin-left:10px;height:26px' disabled='disabled' id='" + F + "'></select><span style='margin-left:8px;margin-right:8px;'>" + i18n.t("Print.PrintDlgItemPageTo") + "</span><select style='width:106px;height:26px' disabled='disabled' id='" + H + "'></select></div><div class='content-line'><input style='margin-left:50px;margin-right: 7px;' id='" + O + "' value='pages' name='check-print-model' type='radio'><span style='display: inline-block;width:70px'>" + i18n.t("Print.PrintDlgItemPages") + "</span><input type='text' style='width:240px;margin-right:8px;margin-left:10px;background: white;height: 26px;border: 1px #C0C0C0 solid;' id='" + M + "' disabled='disabled' value='1-1'><span>1,2,5-8</span></div><div class='content-line'><lable style=\"margin-top:40px;margin-left:150px;\" >" + i18n.t("Print.MaxPrintPageMessage") + "</lable></div><div class='title-line'><h5>" + i18n.t("Print.PrintCommentsLabel") + "</h5></div><div class='content-line'><input id='" + S + "'style='margin-left:50px;margin-right: 7px;' value='printcomments' type='checkbox' name='check-print-comments'>" + i18n.t("Print.PrintComments") + "</div><div class='content-line' style='display: none'><input id='" + U + "'style='margin-left:80px;margin-right: 7px;' value='printpopups' type='checkbox' name='check-print-popups'>" + i18n.t("Print.PrintPopups") + "</div><div id='lablePrintInfo' style='margin-top:10px;margin-left:25px;color:red;text-align:left;'></div></div><div class='fwr-modal-footer'><a href='#' id='" + h + "' class='btn btn-success'  data-i18n='[value]Print.Next'>" + i18n.t("Print.Next") + "</a><a href='#' id='" + k + "' class='btn' webpdf-data-dismiss='modal' data-i18n='[value]Print.Cancel'>" + i18n.t("Print.Cancel") + "</a></div>", $("#" + l.getMainFrameId()).append(K), j = $("#" + y), L = !0), !j) return !1;
                if ((WebPDF.Environment.mobile || WebPDF.Environment.iOS) && !D) return m.showErrorDlg(), jQuery("#browserPrintInfo").html('<lable style="font-size: 13px">' + i18n.t("Print.PrintBrowserSupport") + "</lable>"), !1;
                if (!L) return !1;
                g = $("#" + h), i = $("#" + k), o = $("#" + p), q = $("#" + r), s = $("#" + z), C = $("#" + F), G = $("#" + H), I = $("#" + M), N = $("#" + O), R = $("#" + S), T = $("#" + U), j.i18n(), i.off("click").on("click", function() {
                    m.closePrintDlg()
                });
                var V = $("#lablePrintInfo");
                V.html(""), V.empty(), g.off("click").on("click", function() {
                    n = !0, t = 0, u = 0, v = 0, P && (Q = T.is(":checked")), A = "<div id='" + y + "'>", E = "", J = new Array;
                    var d = jQuery("input[name='check-print-model']:checked").val(),
                        f = !0;
                    switch (d) {
                        case "all":
                            t = 1, u = e, f = !0, x = !1, w = "";
                            break;
                        case "currentpage":
                            t = c.getCurPageIndex() + 1, u = t, f = !0, x = !1, w = "";
                            break;
                        case "page_from":
                            t = jQuery("#page-from-start").val(), u = jQuery("#page-from-end").val(), f = !0, x = !1, w = "";
                            break;
                        case "pages":
                            var g = /^[1-9][0-9]*([,-][1-9][0-9]*)*$/,
                                h = I.val();
                            if (g.test(h)) {
                                x = !0, t = 1, f = !0, w = new Array;
                                for (var i = h.split(","), j = i.length, k = 0; j > k; k++) {
                                    var m = i[k],
                                        o = m.split("-");
                                    if (1 == o.length) {
                                        if (!(Number(o) <= e)) return V.html("<lable>" + i18n.t("Print.PrintPageNumberError") + "</lable>"), f = !1, x = !1, void(w = "");
                                        w.push(Number(o))
                                    } else if (2 == o.length) {
                                        var p = Number(o[0]),
                                            q = Number(o[1]);
                                        if (p > q || q > e) return V.html("<lable>" + i18n.t("Print.PrintPageOutError") + "</lable>"), f = !1, x = !1, void(w = "");
                                        for (var r = p; q >= r; r++) w.push(r)
                                    }
                                }
                            } else V.html("<lable>" + i18n.t("Print.PrintPageNumberError") + "</lable>"), f = !1, x = !1, w = ""
                    }
                    if (f) {
                        if (x ? (B = w.length, u = B) : B = u - t + 1, B > 100) return void $("#lablePrintInfo").html(i18n.t("Print.OutOfRangeMessage"));
                        var s = "";
                        s = "pages" == d ? I.val() : 1 === B ? t.toString() : t.toString() + "-" + u.toString();
                        var z = {
                            Copies: "",
                            PrinterName: "",
                            PrintRange: s
                        };
                        z = JSON.stringify(z), l.addRecord("Print", "Print", z), l.isLargeFile() ? a(s) : b(s)
                    }
                }), o.click(function() {
                    C.prop("disabled", !0), G.prop("disabled", !0), I.prop("disabled", !0), V.html(""), V.empty()
                }), q.click(function() {
                    C.prop("disabled", !0), G.prop("disabled", !0), I.prop("disabled", !0), V.html(""), V.empty()
                }), s.click(function() {
                    C.prop("disabled", !1), G.prop("disabled", !1), I.prop("disabled", !0), V.html(""), V.empty()
                }), N.click(function() {
                    C.prop("disabled", !0), G.prop("disabled", !0), I.prop("disabled", !1), V.html(""), V.empty()
                }), C.change(function() {
                    for (var a = C.val(), b = G.val(), c = [], d = a; e >= d; d++) c.push(d);
                    G.fxUISelect({
                        data: c
                    }).val(b)
                }), R.click(function() {
                    P = R.is(":checked"), P ? document.getElementById(U).parentNode.style.display = "" : document.getElementById(U).parentNode.style.display = "none"
                }), j.webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    manager: "#" + l.getMainFrameId()
                });
                for (var W = [], X = 1; e >= X; X++) W.push(X);
                return C.fxUISelect({
                    data: W,
                    disabled: !s.prop("checked")
                }).parent().css({
                    width: 105,
                    marginLeft: 11
                }), G.fxUISelect({
                    data: W,
                    disabled: !s.prop("checked")
                }).parent().css({
                    width: 105
                }), !0
            }, this.requestImage = function(a, b, c) {
                if (a >= u) {
                    A += "</div>";
                    var d = {};
                    return d = WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 || WebPDF.Environment.edge ? {
                        mode: "popup",
                        popClose: "true",
                        currentStep: t,
                        nImageToLoad: u,
                        arrayUrl: J,
                        printPageSizeWidth: H,
                        printPageSizeHeight: I,
                        baseUrl: WebPDF.optionParameters.baseUrl,
                        printPopUps: Q
                    } : {
                        currentStep: t,
                        nImageToLoad: u,
                        arrayUrl: J,
                        printPageSizeWidth: H,
                        printPageSizeHeight: I,
                        baseUrl: WebPDF.optionParameters.baseUrl,
                        printPopUps: Q
                    }, void jQuery(A).printArea(d)
                }
                if (n) {
                    var e = new WebPDF.ImageEngine.ImagePageViewRender;
                    e.setReaderApp(l), x && (a = w[a] - 1);
                    var f = b.getPageView(a),
                        g = e.getPageImgUrl(a, 1, !1);
                    m.preLoadingImg(g, f, c)
                }
            }, this.showProgressDlg = function(a) {
                var b, c, d, e, f = "fwr-print-title";
                N || (M = "<div id='" + z + "'class='fwr-print-dlg fwr-modal fwr-hide fwr-fade fwr-in ' style='display: block; z-index: 1006; outline: 0px; height: auto; width: 350px;'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 id='" + f + "'> " + i18n.t("Print.PrintPrintProgressDlgTitle") + "</h4></div><div id='progressDialog'  class='fwr-modal-body fwr-dialog-padding'><p>" + i18n.t("Print.PrintPrintProgressDlgTitle") + "</p><div id='progress_number' align='left' style='margin-top:10px;'><font  size='3' >1/" + a + "</font></div><div id='fwr-print-progress' style='width:100%;margin-top:10px;' class = 'fwr-print-progress'><div id='prpos'></div></div><div id='progressDialogLableInfo' style='color:red;margin-top:10px;height:18px;'></div></div><div class='fwr-modal-footer'><a style='display:none' href='#' id=' continueButtonProgress ' class='btn' webpdf-data-dismiss='modal' data-i18n='CommonDialog.DefaultContinueTile'>" + i18n.t("CommonDialog.DefaultContinueTile") + "</a><a href='#' id='cancelButtonProgress' class='btn' webpdf-data-dismiss='modal' data-i18n='CommonDialog.DefaultCancelBtnTitle'>" + i18n.t("CommonDialog.DefaultCancelBtnTitle") + "</a></div>",
                    $("#" + l.getMainFrameId()).append(M), k = $("#" + z), N = !0), k && (b = $("#progress_number"), b && b.html('<font " size="3" >1/' + B + "</font>"), c = $("#cancelButtonProgress"), c.click(function() {
                    n = !1, m.closeProgressDlg(), m.updateProgressbar(0, 0)
                }), e = $("#progressDialogLableInfo"), e.empty(), d = $("#continueButtonProgress"), d.click(function() {
                    e.html(""), e.empty(), n = !0, e.css("display", "none");
                    var a = l.getMainView().getDocView();
                    m.requestImage(v, a)
                }), k.webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    manager: "#" + l.getMainFrameId()
                }))
            }, this.showErrorDlg = function() {
                if (!O) {
                    var a = "printErrorDialog",
                        b = "printErrorTitle",
                        c = "<div id='" + a + "' class='fwr-print-dlg fwr-modal fwr-hide fwr-fade fwr-in' style='HEIGHT: auto; WIDTH: auto; PADDING-LEFT: 8px; DISPLAY: block; PADDING-RIGHT: 8px'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 id='" + b + "'> " + i18n.t("Print.PrintErrorDlgTitle") + "</h4></div><table style='BORDER-COLLAPSE: collapse; TABLE-LAYOUT: fixed; BORDER-SPACING: 0'><tbody><tr><td style='WIDTH: 36px;margin-top:10px;height:18px;'><div class='fwr-print-error-icon' id='fxalert_icon'></div></td><td><p id='browserPrintInfo'></P></td></tr></tbody></table></div>";
                    $("#" + l.getMainFrameId()).append(c), o = $("#" + a), O = !0
                }
                o && m.openErrordlg()
            }, this.callback_fun = function(a, f, g) {
                var j = a.getDocView(),
                    k = !1,
                    l = f == WebPDF.ImageEngine.GetImageErrorCode.ERROR_CREATE_IMG_FAILED,
                    n = f == WebPDF.ImageEngine.GetImageErrorCode.ERROR_PAGE_DISPLAY_LIMIT,
                    o = f == WebPDF.ImageEngine.GetImageErrorCode.ERROR_INPROGRESS;
                if (l || n) k = !0;
                else if (o) {
                    var p = -1;
                    return p = x ? v : a.getPageIndex(), void setTimeout(function() {
                        m.requestImage(p, j, g - 1)
                    }, 2e3)
                }
                if (k) return void b(i18n.t("Print.PrintImageFailed"));
                A += c(a), WebPDF.Environment.ie8OrLower || (A += e(a)), P && (A += h(a)), A += i(a), A += "</div>", A += "</div>", m.updateProgress();
                var p = -1;
                p = x ? v : a.getPageIndex() + 1, m.requestImage(p, j, d.defaults.requestRetryCount)
            }, this.preLoadingImg = function(a, c, d) {
                function e(a) {
                    var b = a.ct ? a.ct : "",
                        c = l.getMainView().getDocView(),
                        e = c.getPageView(a.pageIndex);
                    if (b.indexOf("application/json") > -1) {
                        var f = a.data.status.toString();
                        f !== WebPDF.ImageEngine.GetImageErrorCode.ERROR_PAGE_DISPLAY_LIMIT.toString() && f !== WebPDF.ImageEngine.GetImageErrorCode.ERROR_CREATE_IMG_FAILED.toString() && f !== WebPDF.ImageEngine.GetImageErrorCode.ERROR_INPROGRESS.toString() || "success" !== a.textStatus || m.callback_fun(e, f, d)
                    } else {
                        var g = a.isrc;
                        if (a.JR)
                            if (WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 || WebPDF.Environment.edge) {
                                var h = new Uint8Array(a.imageData);
                                g = "data:image/bmp;base64," + WebPDF.Common.base64encodeArray(h, a.imageData.byteLength)
                            } else {
                                var i = new Blob([a.imageData], {
                                        type: "image/png"
                                    }),
                                    j = URL.createObjectURL(i);
                                g = j
                            }
                        J[v] = g, m.resizeImage(a.pageIndex, g, l.getPixelsPerPoint()), m.callback_fun(e)
                    }
                }
                var f = l.getDataControl(),
                    g = {
                        url: a,
                        pageIndex: c.getPageIndex()
                    },
                    h = {
                        type: "getPrintImg",
                        data: g,
                        success: e,
                        error: b
                    };
                f.getPrintImg(h)
            }, this.resizeImage = function(a, b, c) {
                var d = (l.getPDFDoc().getPage(a).getPageRotate() % 4 + 4) % 4,
                    e = l.getPDFDoc().getPage(a).getPageWidth() * c,
                    f = l.getPDFDoc().getPage(a).getPageHeight() * c;
                d = 0 == d || 2 == d ? e > f ? 1 : 0 : e > f ? 1 : 0;
                var g = 0,
                    h = 0;
                0 == d || 2 == d ? (g = e / H, h = f / I) : (g = e / I, h = f / H), r = g >= h ? g : h, p = f / r, q = e / r;
                var i = (I - p) / 2 - 1,
                    j = (H - q) / 2;
                E = "";
                var k = "";
                if (1 == d || 3 == d) {
                    i = (I - q) / 2 - 1, j = (H - p) / 2;
                    var m = (q - p) / 2;
                    k = 1 == d ? WebPDF.Common.getTransformCssString(90 * -d, -m, -m) : WebPDF.Common.getTransformCssString(90 * -d, m, m)
                }
                R = 90 * d;
                var n = "";
                n = WebPDF.Environment.ie9Compact ? 0 === a ? "position: relative; width:" + H + "px; height:" + I + "px;margin: auto;display:inline;" : "position: relative; width:" + H + "px; height:" + I + "px;margin: auto;display:inline-block;" : WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? "position: relative; width:" + H + "px; height:" + I + "px;margin: auto;display:inline-block;" : WebPDF.Environment.opera || WebPDF.Environment.webkit ? "position: relative; width:" + H + "px; height:" + I + "px;margin: auto;display:inline;" : "position: relative; width:" + H + "px; height:" + I + "px;margin: auto;display:inline-block;float:left;", A += "<div class='page' style='" + n + "'>", WebPDF.Environment.opera || WebPDF.Environment.webkit ? (A += "<div  style='position: inherit;overflow: hidden;float: left;width:" + q + "px;height:" + p + "px;margin-left:" + j + "px;margin-top:" + (i - 1) + "px;" + k + "' class='subpage'>", A += "<img style='display:inline;' width='" + (q - 1) + "px' height='" + (p - 1) + "px' src='" + b + "'></img>") : (A += "<div  style='position: inherit;width:" + q + "px;height:" + p + "px;margin-left:" + j + "px;margin-top:" + i + "px;" + k + "' class='subpage'>", A += "<img width='" + q + "px' height='" + (p - 1) + "px' src='" + b + "'></img>")
            }, this.updateProgress = function() {
                v += 1, jQuery("#progress_number").html('<font " size="3" >' + v + "/" + B + "</font>"), m.updateProgressbar(v, B), v == B && (n = !1, k.webPDFModal("hide"), m.updateProgressbar(0, 0))
            }, this.openPrintDlg = function() {
                j.webPDFModal("show")
            }, this.closePrintDlg = function() {
                j.webPDFModal("hide")
            }, this.openProgressDlg = function() {
                k.webPDFModal("show")
            }, this.closeProgressDlg = function() {
                k.webPDFModal("hide")
            }, this.openErrordlg = function() {
                o.webPDFModal("show")
            }, this.closeErrordlg = function() {
                o.webPDFModal("hide")
            }, this.updateProgressbar = function(a, b) {
                var c = document.getElementById("prpos");
                iPerc = a > 0 ? a / b * 100 : 0, c.style.width = iPerc + "%"
            }
        }, b.createPlugin = function(a) {
            var b = new WebPDF.printPlugin(a);
            return b
        }
    }), define("core/Plugins/Navigation/NavigationComponent", ["core/Plugins/Navigation/MobileNavigationView", "core/Plugins/Navigation/PCNavigationView", "core/Plugins/Offline/OfflineFileCache", "core/WebStorage"], function(a, b, c) {
        function d() {
            navigator.userAgent.match(/mobile|Android|iPhone|ios|iPod/i) ? (f = a("core/Plugins/Navigation/MobileNavigationView"), e = new f) : (f = a("core/Plugins/Navigation/PCNavigationView"), e = new f), this.init = function() {
                e.isInit || (e.init(), e.isInit = !0)
            }, this.registerItem = function(a) {
                "function" == typeof e.registerItem && e.registerItem(a)
            }, this.expand = function(a) {
                "function" == typeof e.expand && e.expand(a)
            }, this.getPanel = function(a) {
                return e.getPanel(a)
            }, this.show = function(a) {
                e.show(a)
            }, this.registerPanel = function(a) {
                e.registerPanel(a)
            }, this.setUrl = function(a) {
                e.setUrl(a)
            }
        }
        var e, f;
        WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
            e.resetView(b.plugins, b.docPermission, b.securityType)
        }), WebPDF.ViewerInstance.on(WebPDF.EventList.OFFLINEMODE_CHANGED, function(a, b) {
            e.resetView(b.plugins, b.docPermission)
        }), WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_CLOSED, function(a, b) {
            e.resetView()
        }), b.createNavigationComponent = function() {
            return WebPDF.NavigationComponent || (WebPDF.NavigationComponent = new d), WebPDF.NavigationComponent
        }
    }), define("core/Plugins/Navigation/MobileNavigationView", [], function(a, b, c) {
        function d() {
            this.getPanel = function(a) {
                for (var b = 0; b < o.length; b++) {
                    var c = o[b];
                    if (c.name == a) return $.extend(this, c)
                }
                return null
            }, this.expand = function(a) {
                var b = this.name;
                if (a) switch (b) {
                    case "bookmark":
                        f();
                        break;
                    case "thumbnail":
                        g();
                        break;
                    case "commentlist":
                        h();
                        break;
                    default:
                        $.each(o, function(a, c) {
                            if (b == c.name)
                                if (c.listeners && "function" == typeof c.listeners.activate) {
                                    var e = (new d).getPanel(c.name);
                                    c.listeners.activate(null, e), $("#fwrm-panel-content > div").hide(), $("#fwrm-panel-" + c.name).show(), $("#" + k).attr("data-i18n", c.dataI18), $("#" + k).i18n(), console.info($("#fwrm-panel-tab li")), $("#fwrm-panel-tab li").css("background", "0"), $("#fwrm_btn_" + e.name).css("background", "rgb(214, 214, 214)")
                                } else $("#fwrm-panel-tab li").children("ul").find("li").removeClass("selected"), $(this).addClass("selected"), setCookie("fwrm-panel-select", c.name, "/", 720)
                        })
                } else $("#fwrm-panel-" + b).hide()
            }, this.show = function(a) {
                var b = this.name;
                if (a) {
                    $("#fwrm_btn_" + b).show();
                    var c = this;
                    $.each(o, function(a, d) {
                        if (b == d.name) {
                            var e = $.extend(c, d);
                            return e.expand(!0), $("#" + k).attr("data-i18n", i18n.t(e.dataI18)), $("#" + k).i18n(), o[a].isShow = !0, $("#fwrm-panel-btnNav").show(), !1
                        }
                    })
                } else {
                    $("#fwrm_btn_" + b).hide(), $("#fwrm-panel-" + this.name).hide();
                    var c = this;
                    $.each(o, function(a, d) {
                        if (b != d.name && o[a].isShow) {
                            var e = $.extend(c, d);
                            return e.expand(!0), $("#" + k).attr("data-i18n", i18n.t(e.dataI18)), $("#" + k).i18n(), !1
                        }
                        o[a].isShow = !1, o.length == a + 1 && ($("#" + k).html(""), $("#fwrm-panel-btnNav").hide())
                    })
                }
            }, this.registerPanel = function(a) {
                void 0 != a.index && a.index >= 0 && a.index < o.length - 1 ? o.splice(a.index, 0, a) : o.splice(o.length, 0, a);
                var b, c = '<div id="fwrm-panel-' + a.name + '" style="display:none;"></div>',
                    e = '<li id="fwrm_btn_' + a.name + '"><a class="ui-link" href="#" data-i18n="' + a.dataI18 + '">' + a.titleDefault + "</a></li>";
                void 0 != a.index && a.index >= 0 && a.index < o.length - 1 ? ($("#fwrm-panel-tab li").eq(a.index).before(e), b = $("#fwrm-panel-tab li").eq(a.index)) : ($("#fwrm-panel-tab li").eq(o.length - 2).after(e), b = $("#fwrm-panel-tab li").eq(o.length - 1)), b.on("tap", function(b) {
                    $.each(o, function(c, e) {
                        if (a.name == e.name) {
                            if (e.listeners && "function" == typeof e.listeners.activate) {
                                var f = (new d).getPanel(e.name);
                                e.listeners.activate(null, f), $("#fwrm-panel-content > div").hide(), $("#fwrm-panel-" + a.name).show(), $("#" + k).attr("data-i18n", e.dataI18), $("#" + k).i18n(), $("#fwrm-panel-tab li").css("background", "0"), $("#fwrm_btn_" + f.name).css("background", "rgb(214, 214, 214)"), setCookie("fwrm-panel-select", e.name, "/", 720)
                            }
                            $("#fwrm-panel-tab").hide()
                        }
                        b.preventDefault()
                    })
                }), $("#fwrm-panel-content").append(c), $("#fwrm-panel-tab").i18n()
            }, this.setUrl = function(a) {
                var b = "fwrm-panel-" + this.name;
                $("#" + b).load(a)
            }
        }

        function e() {
            if (0 != $(".fwrm-panel-commentlist").length) {
                var a = $(".fwrm-panel-commentlist").offset().top,
                    b = $(window).height();
                $(".fwrm-panel-commentlist").height(b - a)
            }
        }

        function f() {
            "selected" == $(this).attr("class") ? $(this).removeClass("selected") : ($("#tools").children("ul").find("li").removeClass("selected"), $(this).addClass("selected"));
            var a = document.getElementById(k);
            a.innerHTML = i18n.t("MobileLng.BookmarkPanel.Bookmark"), $("#fwrm-panel-tab li").css("background", "0"), p.css("background", "#d6d6d6"), $("#fwrm-panel-content > div").hide(), $("#" + l).show(), $(".fwrm-annot-menu").hide(), $("#fwrm-menu-rotate").hide();
            var b = WebPDF.Bookmark.BookmarkInstance;
            b.buildUpView(), WebPDF.ThumbnailContoroller.showPanel()
        }

        function g() {
            var a = document.getElementById(k);
            a.innerHTML = i18n.t("MobileLng.BookmarkPanel.Thumbnail"), $("#fwrm-panel-tab li").css("background", "0"), r.css("background", "#d6d6d6"), $(".fwrm-annot-menu").hide(), $("#fwrm-panel-content > div").hide(), $("#" + m).show(), $(".fwrm-annot-menu").hide(), WebPDF.ThumbnailContoroller.showPanel(), window.onresize()
        }

        function h() {
            var a = document.getElementById(k);
            a.innerHTML = i18n.t("MobileLng.BookmarkPanel.CommentList"), $("#fwrm-panel-tab li").css("background", "0"), q.css("background", "#d6d6d6"), $("#fwrm-panel-content > div").hide(), $("#" + n).show();
            var b = WebPDF.ViewerInstance.getPluginByName(WebPDF.CommentListPluginName);
            b && b.loadAnnot(), e(), $(".fwrm-annot-menu").hide(), window.onresize()
        }

        function i() {
            var a = "",
                b = "",
                c = "",
                d = getCookie("fwrm-panel-select");
            $.each(o, function(e, f) {
                f.isShow && (f.name == d || f.isDefault ? (a = '<h1 id="fwrm-panel-title" class="fwrm-panel-title fwrm-panel-btnNav" data-i18n="' + f.dataI18 + '">' + f.titleDefault + "</h1>", c += '<div id="fwrm-panel-' + f.name + '"></div>') : c += '<div id="fwrm-panel-' + f.name + '" style="display:none;"></div>', b += '<li id="fwrm_btn_' + f.name + '"><a class="ui-link" href="#" data-i18n="' + f.dataI18 + '">' + f.titleDefault + "</a></li>")
            });
            var e = '<div id="fwrm-panel" style="display:none;"><div class="fwrm-panel-header"><div class="left">    <svg id="fwrm-panel-btnClose"><use xlink:href="#icon-panel-close"></use></svg></div>' + a + '<div class="right"><div id="fwrm-panel-btnNav" class="fwrm-panel-btnNav fwrm-triangle menu-down" style="left: 40px;"></div></div><div id="fwrm-panel-tab" class="fwrm-panel-tab" style="display:none;"><ul>' + b + '</ul><div class="fwrm-triangle menu" style="left: 40px;"></div></div></div><div id="fwrm-panel-content">' + c + "</div></div>";
            $("#readerPage").prepend(e);
            var f = $(window).height();
            $("#fwrm-panel-content").css("height", f - 50).css("overflow", "auto")
        }

        function j() {
            p = $("#fwrm_btn_bookmark"), q = $("#fwrm_btn_commentlist"), r = $("#fwrm_btn_thumbnail"), p.off("tap").on("tap", function(a) {
                f(), setCookie("fwrm-panel-select", "bookmark", "/", 720), $(this).parent().parent().hide(), a.preventDefault()
            }), r.off("tap").on("tap", function(a) {
                g(), setCookie("fwrm-panel-select", "thumbnail", "/", 720), $(this).parent().parent().hide(), a.preventDefault()
            }), q.off("tap").on("tap", function(a) {
                h(), setCookie("fwrm-panel-select", "commentlist", "/", 720), $(this).parent().parent().hide(), a.preventDefault()
            }), $("#fwrm-panel-btnClose").off("tap").on("tap", function(a) {
                "block" == document.getElementById("fwrm-panel").style.display && $("#fwrm-panel").css("display", "none")
            }), $(".fwrm-panel-btnNav").off("tap").on("tap", function(a) {
                $("#fwrm-panel-tab").toggle();
                var b = $("#fwrm-panel-btnNav").offset().top,
                    c = $("#fwrm-panel-btnNav").offset().left;
                $("#fwrm-panel-tab").css("left", c - 41), $("#fwrm-panel-tab").css("top", b + 28)
            })
        }
        var k = "fwrm-panel-title",
            l = "fwrm-panel-bookmark",
            m = "fwrm-panel-thumbnail",
            n = "fwrm-panel-commentlist",
            o = [{
                dataI18: "[html]MobileLng.BookmarkPanel.Bookmark",
                titleDefault: "Bookmark",
                name: "bookmark",
                isDefault: !0,
                isShow: !0
            }, {
                dataI18: "[html]MobileLng.BookmarkPanel.Thumbnail",
                titleDefault: "Thumbnail",
                name: "thumbnail",
                isDefault: !1,
                isShow: !0
            }, {
                dataI18: "[html]MobileLng.BookmarkPanel.CommentList",
                titleDefault: "CommentList",
                name: "commentlist",
                isDefault: !1,
                isShow: !0
            }];
        d.prototype = {
            init: function() {
                i(), j()
            },
            resetView: function(a, b) {
                var c = $("#tab-btnCommentList");
                a & WebPDF.Config.Plugins.flag.Comments && b.isAnnot ? (c.show(), q.show()) : (c.hide(), q.hide())
            }
        };
        var p, q, r;
        return d
    }), define("core/Plugins/Navigation/PCNavigationView", ["core/Plugins/Offline/OfflineFileCache", "core/WebStorage"], function(a, b, c) {
        function d(a) {
            var b = document.createElement("style");
            if (b.setAttribute("type", "text/css"), b.styleSheet) b.styleSheet.cssText = a;
            else {
                var c = document.createTextNode(a);
                b.appendChild(c)
            }
            document.getElementsByTagName("head");
            document.documentElement.appendChild(b)
        }

        function e() {
            this.registerItem = function(a) {
                var b = "#" + a.buttonId + "{background: url(" + a.icon + ");}#" + a.buttonId + ".selected, #" + a.buttonId + ":hover{background: url(" + a.acticon + ");}";
                d(b), a.title = "", k.push({
                    panelId: a.panelId,
                    buttonId: a.buttonId,
                    name: a.name,
                    title: a.title,
                    tip: a.tip,
                    listeners: a.listeners
                })
            }, this.getPanel = function(a) {
                for (var b = 0; b < k.length; b++) {
                    var c = k[b];
                    if (c.name == a) return $.extend(this, c)
                }
                return null
            }, this.expand = function(a) {
                var b = this.name;
                if (a) {
                    $("#tabs-" + b).removeClass("fwr-Nav-panel-selected"), $("#tabs-" + b).children("p").addClass("selected");
                    var c = $("#navigationPanel"),
                        d = $("#tabs-" + b).data("id");
                    c.show(), h($("#tabs-" + b).data("lang")), $("#tabs-" + b).addClass("fwr-Nav-panel-selected"), $("#tabs-" + b).children("p").addClass("selected"), $("#" + d).show().siblings().not("#navigationPanelTitle, #navigationPanelClose").hide(), i(d), $(window).resize()
                } else {
                    var c = $("#navigationPanel");
                    $("#tabs-" + b).removeClass("fwr-Nav-panel-selected"), $("#tabs-" + b).children("p").removeClass("selected"), c.hide(), $(window).resize()
                }
            }, this.show = function(a) {
                for (var b = this.name, c = 0; c < k.length; c++) k[c].name == b && (a ? ($("#tabs-" + b).show(), k[c].isShow = !0) : ($("#tabs-" + b).hide(), $("#navigationPanel").hide(), k[c].isShow = !1))
            }, this.registerPanel = function(a) {
                void 0 != a.index && a.index >= 0 && a.index < k.length - 1 ? k.splice(a.index, 0, a) : k.splice(k.length, 0, a);
                var b = '<li id="tabs-' + a.name + '" style="display: list-item;" data-lang="' + a.title + '" data-id="docViewer_' + a.name + '"><p id="' + a.buttonId + '" class="' + a.buttonClass + ' fwr-Nav-icons"></p><span class="fwr-navigation-tip"> <strong data-i18n="' + a.dataI18 + '">' + a.dataI18Default + '</strong><br /><div data-i18n="' + a.tip + '"></div></span></li>',
                    c = '<div id="docViewer_' + a.name + '" style="height:100%;width:100%;display:none;"></div>';
                if (void 0 != a.index && a.index >= 0 && a.index < k.length - 1 ? $("#navigation li").eq(a.index).before(b) : $("#navigation li").eq(k.length - 2).after(b), $("#navigationPanel").append(c), j(), $("#navigation").i18n(), !$("#docViewer_" + a.name).html()) {
                    var d = $.extend(this, a);
                    d.listeners.activate(null, d)
                }
            }, this.setUrl = function(a) {
                var b = this.name;
                $("#docViewer_" + b).load(a)
            }
        }

        function f() {
            $.each(k, function(a, b) {
                b.inited && b.inited()
            })
        }

        function g() {
            var a = "",
                b = "";
            $.each(k, function(c, d) {
                if (d.isShow) {
                    var e = d.panelid ? "docViewer_" + d.name : d.panelId;
                    a += '<li id="tabs-' + d.name + '" style="display: list-item;" data-lang="' + d.title + '" data-id="' + e + '"><p id="' + d.buttonId + '" class="' + d.buttonClass + ' fwr-Nav-icons"></p><span class="fwr-navigation-tip"> <strong data-i18n="' + d.dataI18 + '">' + d.dataI18Default + '</strong><br /><div data-i18n="' + d.tip + '"></div></span></li>', d.src ? b = '<div id="' + e + '" style="height:100%;outline: none; display:none;"><iframe src="" style="height:100%; width: 100%;"></iframe></div>' : (void 0 == d.isExterior || d.isExterior) && (b = '<div id="' + e + '" style="height:100%; display:none;"></div>')
                }
            });
            var c = '<div id="navigation" class="fwr-navigation"><ul>' + a + '</ul></div><div id="navigationPanel" class="fwr-Nav-panel" style="display: none"><div class="fwr-drag-box" id="fwr_drag_box"></div><div class="fwr-drag-mask" id="fwr_drag_box"></div><div id="navigationPanelTitle" class="fwr-Nav-panel-title" style="width: 80%;overflow: hidden;text-overflow: ellipsis;"></div><div id="navigationPanelClose" class="fwr-Nav-panel-close"></div><div id="searchPanel" class="fwr-search-panel" style="display: none"></div>' + b + "</div>",
                d = WebPDF.Tool.getReaderApp().getMainFrameId();
            $("#" + d).before(c), $("#navigation").i18n()
        }

        function h(a) {
            var b = "";
            if (a) var b = i18n.t(a);
            $("#navigationPanelTitle").html(b)
        }

        function i(a) {
            switch (a) {
                case "docViewer_fxThumbpanel":
                    WebPDF.ThumbnailContoroller.showPanel();
                    break;
                case "docViewer_fxCommentListPanel":
                    var b = WebPDF.ViewerInstance.getPluginByName(WebPDF.CommentListPluginName);
                    b && b.loadAnnot();
                    break;
                case "docViewer_fxBookmarkPanel":
                    var c = WebPDF.Bookmark.BookmarkInstance;
                    c.showBookmarkPanel(), c.buildUpView(), c.resize();
                    break;
                case "searchPanel":
                    var d = WebPDF.searchComponent;
                    d.resetResultView();
                    break;
                case "navigation-offline-panel":
                    break;
                default:
                    $.each(k, function(b, c) {
                        if (a == "docViewer_" + c.name && c.listeners && "function" == typeof c.listeners.activate) {
                            var d = (new e).getPanel(c.name);
                            c.listeners.activate(null, d)
                        }
                    })
            }
        }

        function j() {
            function a(a) {
                var c = document.getElementById(a),
                    d = $("#navigationPanel"),
                    e = $(".fwr-drag-mask"),
                    f = $("#navigationPanelClose"),
                    g = !1,
                    h = 0,
                    i = 0,
                    j = 0,
                    k = 60;
                c.onmousedown = function(a) {
                    a = a || window.event, h = a.clientX, i = h, g = !0, e.show()
                }, document.onmousemove = function(a) {
                    if (a = a || window.event, g) {
                        var c = a.clientX - h,
                            e = parseFloat(d.width()) + c;
                        k > e && (e = k, d.hide(), f.trigger("click"), g = !1), d.css("width", e), b(e - 20), h = a.clientX, Math.abs(e - i) > 5 && (i = e, $(window).resize())
                    }
                }, document.onmouseup = function() {
                    g && (g = !1, $(window).resize(), j = parseFloat(d.width()), e.hide(), setCookie("default_navigation_width", j, "/", 720))
                }
            }

            function b(a) {
                $.each(k, function(b, c) {
                    $("#" + c.panelId + " iframe").css("width", a)
                })
            }
            var c = $("#navigationPanel");
            $("#navigation li").off("click").on("click", function(a) {
                if ($(this).hasClass("disabled")) return !1;
                if ($(a.target).hasClass("fwr-Nav-icons")) {
                    var b = $(this).attr("data-id");
                    $("#navigation li").removeClass("fwr-Nav-panel-selected"), $("#navigation li>p").removeClass("selected"), $("#" + b + ":visible").size() > 0 ? c.hide() : (c.show(), h($(this).data("lang")), $(this).addClass("fwr-Nav-panel-selected"), $(this).children("p").addClass("selected"), $("#" + b).show().siblings().not("#navigationPanelTitle, #navigationPanelClose").hide(), i(b)), $(window).resize()
                }
            });
            var d;
            $("#navigation li").hover(function() {
                var a = this;
                clearTimeout(d), d = setTimeout(function() {
                    $(a).children("span").show(), setTimeout(function() {
                        $(a).children("span").hide()
                    }, 3e3)
                }, 1e3)
            }, function() {
                clearTimeout(d), $(this).children("span").hide()
            }), $("#navigationPanelClose").off("click").click(function() {
                c.hide(), $("#navigation li").removeClass("fwr-Nav-panel-selected"), $("#navigation li>p").removeClass("selected"), $(window).resize()
            });
            var e = getCookie("default_navigation_width");
            e ? (c.width(e), b(e - 20)) : (c.width(270), b(250)), a("fwr_drag_box")
        }
        var k = [{
            title: "PCLng.Panel.Bookmark",
            panelId: "docViewer_fxBookmarkPanel",
            buttonId: "bookmarkBtn",
            buttonClass: "fwr-Nav-bookmark",
            tip: "[html]PCLng.Panel.BookmarkTip",
            dataI18: "[html]PCLng.Panel.Bookmark",
            dataI18Default: "Bookmark",
            name: "bookmark",
            isExterior: !1,
            isShow: !0
        }, {
            title: "PCLng.Panel.Thumbnails",
            panelId: "docViewer_fxThumbpanel",
            buttonId: "thumbnailBtn",
            buttonClass: "fwr-Nav-thumbnail",
            tip: "[html]PCLng.Panel.ThumbnailsTip",
            dataI18: "[html]PCLng.Panel.Thumbnails",
            dataI18Default: "Thumbnails",
            name: "thumb",
            isExterior: !1,
            isShow: !0
        }, {
            title: "PCLng.Panel.CommentList",
            panelId: "docViewer_fxCommentListPanel",
            buttonId: "commentListBtn",
            buttonClass: "fwr-Nav-commentlist ",
            tip: "[html]PCLng.Panel.CommentListTip",
            dataI18: "[html]PCLng.Panel.CommentList",
            dataI18Default: "Commentlist",
            name: "comment-list",
            isExterior: !1,
            isShow: !0
        }, {
            title: "PCLng.Panel.Search",
            panelId: "searchPanel",
            buttonId: "searchBtn",
            buttonClass: "fwr-Nav-search",
            tip: "[html]PCLng.Panel.SearchTip",
            dataI18: "[html]PCLng.Panel.Search",
            dataI18Default: "Search",
            name: "search",
            isExterior: !1,
            isShow: !0
        }];
        if (!WebPDF.ConnectPdf && 1 != WebPDF.Environment.ie8OrLower && 1 != WebPDF.Environment.ie9Compact) {
            var l = a("core/Plugins/Offline/OfflineFileCache"),
                m = {
                    title: i18n.t("OffLine.PanelTitle"),
                    panelId: "navigation-offline-panel",
                    buttonId: "navigation-offline-button",
                    buttonClass: "fwr-Nav-offline",
                    tip: i18n.t("OffLine.PanelDescription"),
                    dataI18Default: i18n.t("OffLine.PanelTip"),
                    name: "offline",
                    isShow: !0,
                    inited: function() {
                        l.render(m.panelId)
                    }
                };
            k.push(m)
        }
        return e.prototype = {
            init: function() {
                g(), j(), f()
            },
            resetView: function(a, b) {
                $("#navigation li").removeClass("fwr-Nav-panel-selected"), $("#navigation li>p").removeClass("selected"), $("#navigationPanel").hide();
                var c = $("#navigation li[data-id=docViewer_fxCommentListPanel]");
                if (a && b)
                    if (a & WebPDF.Config.Plugins.flag.Comments)
                        if (b.isAnnot) {
                            c.removeClass("disabled");
                            for (var d = 0; d < k.length; d++) {
                                var e = k[d];
                                e.isShow && "comment-list" == e.name && c.show()
                            }
                        } else c.addClass("disabled");
                else c.hide();
                $(window).resize()
            }
        }, e
    }), define("core/Plugins/Thumbnail/thumbnailController", ["core/Plugins/Thumbnail/thumbnailView_mobile", "core/Plugins/Thumbnail/thumbnailView_pc", "core/Common/ServerService", "core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters"], function(a, b, c) {
        function d(b) {
            e = b.isMobile() ? a("core/Plugins/Thumbnail/thumbnailView_mobile").createView(b) : a("core/Plugins/Thumbnail/thumbnailView_pc").createView(b), this.initView = function() {
                e.init()
            }, this.showPanel = function() {
                b.isMobile() ? e.setThumbFocus(-1) : (e.resizeScrollbar(), e.setThumbFocus(e.getFocusPageIndex(), !0))
            }, this.bindAppEvent = function(a) {
                WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
                    e.openDoc()
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_CLOSED, function(a, b) {
                    e.closeDoc()
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.DOCVIEW_PAGE_CHANGED, function(a, b) {
                    e.setThumbFocus(b.curIndex)
                })
            }, this.bindAppEvent(b)
        }
        var e = null;
        b.createThumbnailController = function(a) {
            return WebPDF.ThumbnailContoroller || (WebPDF.ThumbnailContoroller = new d(a), WebPDF.ThumbnailContoroller.initView()), WebPDF.ThumbnailContoroller
        }
    }), define("core/Plugins/Thumbnail/thumbnailView_mobile", [], function(a, b, c) {
        function d() {
            function a(a) {
                return "docViewer_fxThumbView_ThumbsViewContainer_ThumbContainer_" + a
            }

            function b(a) {
                return "docViewer_fxThumbView_ThumbsViewContainer_BG_" + a
            }

            function c(a) {
                var b = "docViewer_fxThumbView_ThumbsViewContainer_BG_";
                return b + a.toString()
            }

            function d() {
                $("#fwrm-panel-thumbnail").scroll(function() {
                    var a = $(this).scrollTop(),
                        b = a / f;
                    if (!(1 >= b)) {
                        var c = Math.ceil(b);
                        n.setThumbFocus(4 * c)
                    }
                })
            }

            function k() {
                e.off("tap", ".thumbnail-item").on("tap", ".thumbnail-item", function(a) {
                    try {
                        var b = parseInt(a.target.getAttribute("page-index"));
                        $("#fwrm-panel").css("display", "none"), WebPDF.ViewerInstance.gotoPage(b, 0, 0)
                    } catch (c) {
                        return console.error(c), !1
                    }
                })
            }

            function c(a) {
                var b = "docViewer_fxThumbView_ThumbsViewContainer_BG_";
                return b + a.toString()
            }
            var l = !1,
                m = 0,
                n = this;
            this.getPagesHTML = function() {
                i = WebPDF.ViewerInstance.getPageCount();
                for (var c = "", d = 0; i > d; d++) c += "<div class='thumbnail-item' id='" + a(d) + "'<a href='#'><img src=''  id='" + b(d) + "'page-index='" + d + "'><p>" + (d + 1) + "</p></a></div>";
                return c
            }, this.init = function() {
                d(), k(), l = !0
            }, this.setThumbFocus = function(b) {
                if (e.is(":hidden")) return void(m = b); - 1 == b && (b = m);
                var d = WebPDF.ViewerInstance.getPageCount(),
                    i = $("#" + a(0));
                h = $(".fwrm-panel-header").get(0).offsetHeight + parseInt($(".fwrm-panel-header").css("marginBottom")) + parseInt($(".fwrm-panel-header").css("marginTop"));
                var k = parseInt($(window).height()) - h - 5;
                $("#fwrm-panel-thumbnail").height(k), f = i.outerHeight() + parseInt(i.css("marginTop")) + parseInt(i.css("marginBottom"));
                var l = document.body.clientHeight,
                    n = (l - h) / f;
                g = Math.ceil(n);
                var o = document.body.scrollHeight,
                    p = Math.ceil(d * f / 4) + h;
                j = p / o;
                for (var q = 0, r = WebPDF.Tool.readerApp.getBaseUrl(), s = 4 * g * 2, t = q; s > t; t++) {
                    var u = b + t;
                    if (u + 1 > d) break;
                    var v = c(u),
                        w = $("#" + v).attr("src");
                    if (null == w || void 0 == w || "" == w) {
                        var x = WebPDF.Common.joinUrl(r, "images/reader/loading.gif");
                        $("#" + v).attr("src", x), WebPDF.ViewerInstance.getThumbnail(u, v)
                    }
                }
            }, this.closeDoc = function() {
                e.children().remove()
            }, this.openDoc = function() {
                if (l) {
                    e.append(this.getPagesHTML());
                    var b = a(0);
                    $("#" + b).addClass("selected"), this.setThumbFocus(0)
                }
            }
        }
        $("#fwrm-panel-thumbnail").append('<div id="fwrm-thumbnail-box" class="thumbnail-box"/>');
        var e = $("#fwrm-thumbnail-box"),
            f = 0,
            g = 0,
            h = 0,
            i = 0,
            j = 0;
        b.createView = function(a) {
            return WebPDF.ThumbnailView || (WebPDF.ThumbnailView = new d(a)), WebPDF.ThumbnailView
        }
    }), define("core/Plugins/Thumbnail/thumbnailView_pc", ["core/Common/ServerService", "core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters"], function(a, b, c) {
        function d(a) {
            function b(a) {
                if (null == t) {
                    var b = {
                            showArrows: !1,
                            animateScroll: !1
                        },
                        c = "";
                    switch (u.getOptions().scrollBarType) {
                        case WebPDF.PDFView.ScrollBarType.CUSTOM_SCROLL_BAR:
                            c = $fxThumViewContainer.fwrJScrollPane(b);
                            break;
                        case WebPDF.PDFView.ScrollBarType.NATIVE_SCROLL_BAR:
                            c = $fxThumViewContainer.WebPDFNativeScroll(b);
                            break;
                        default:
                            $.error("Unsupported type of scroll bar.")
                    }
                    return t = c.data("jsp")
                }
            }

            function c() {
                var a = d();
                q.children().each(function(b, c) {
                    var d = $(c),
                        e = f(d),
                        g = Math.floor(e / a),
                        h = e - g * a,
                        i = 179 * g,
                        j = 138 * h;
                    d.css({
                        left: j,
                        top: i
                    })
                })
            }

            function d() {
                var a = $fxThumViewContainer.width();
                return Math.max(1, Math.floor(a / 138))
            }

            function f(a) {
                return parseInt(a.find("[page-index]").attr("page-index"), 10)
            }

            function g(a, b, c, d) {
                var f = u.getLargeFileDocId();
                e.parsePages(f, WebPDF.ViewerInstance.getFileID(), c, d, function(a) {
                    var b = h(a);
                    o(a, b)
                })
            }

            function h(a) {
                return "docViewer_fxThumbView_ThumbsViewContainer_BG_" + a.toString()
            }

            function i(a) {
                return "docViewer_fxThumbView_ThumbsViewContainer_PageNum_" + a
            }

            function j(a) {
                var b = h(a),
                    c = i(a);
                $("#" + b).removeClass("fwr-thumb-image").addClass("fwr-thumb-image-emphasized"), $("#" + c).addClass("fwr-page-number-focus")
            }

            function k() {
                q.find(".fwr-thumb-image-emphasized").removeClass("fwr-thumb-image-emphasized").addClass("fwr-thumb-image"), q.find(".fwr-page-number-focus").removeClass("fwr-page-number-focus").addClass("fwr-page-number")
            }

            function l() {
                $fxThumViewContainer.scroll(m)
            }

            function m() {}

            function n(a) {
                var b = $("<div>").attr({
                        role: "thumb-container",
                        id: "docViewer_fxThumbView_ThumbsViewContainer_ThumbContainer_" + a,
                        style: "position:absolute;display:inline-block;margin-left:10px;height:179px;width:138px;float:left;"
                    }).addClass("fwr-display-inline-block fwr-thumb-page"),
                    c = $("<img>").attr({
                        id: "docViewer_fxThumbView_ThumbsViewContainer_BG_" + a,
                        "page-index": a,
                        style: "height:149px;width:105.29097387173397px;left:50%;position:absolute;margin-left:-52.645486935866984px;top:50%;margin-top:-84.5px;;background-size:cover;",
                        src: WebPDF.Common.joinUrl(u.getBaseUrl(), "images/reader/loading.gif")
                    }).addClass("thumbimage border fwr-thumb-image"),
                    d = $("<div>").addClass("fwr-page-number").attr("style", "width:20px;position:absolute;bottom:1px;left:50%;text-align:center;margin-left:-10px"),
                    e = $("<span>").attr({
                        id: i(a)
                    }).text(a + 1);
                return d.append(e), b.append(c, d), b
            }

            function o(a, b) {
                var c = WebPDF.ViewerInstance.getFileID(),
                    d = r[c] = r[c] || {};
                d[a] ? $("#" + b).attr("src", d[a]) : (WebPDF.ViewerInstance.getThumbnailPrivate(a, b), $("#" + b).on("load", function() {
                    var b = $(this).attr("src");
                    b && -1 == b.indexOf("loading.gif") && (d[a] = b)
                }))
            }
            var p = $("#navigationPanel");
            window.$navigationPanel = p;
            var q;
            $("#thumbnailBtn");
            $fxThumViewContainer = null, _thumbPanelScrollTimer = null;
            var r = {},
                s = -1,
                t = null,
                u = a,
                v = this,
                w = WebPDF.Common.debounce(g);
            this.getFocusPageIndex = function() {
                return s
            }, this.bindEvents = function() {
                var b = this;
                $fxThumViewContainer.off("mousedown", ".thumbimage").on("mousedown", ".thumbimage", function(a) {
                    if (0 == a.button || 1 == a.button) try {
                        var b = parseInt(a.target.getAttribute("page-index"));
                        WebPDF.ViewerInstance.gotoPage(b, 0, 0)
                    } catch (c) {
                        return console.error(c), !1
                    }
                }), $fxThumViewContainer.off("jsp-scroll-y").on("jsp-scroll-y", function(a, c) {
                    var e = d(),
                        f = Math.ceil(c / 179 * e);
                    b._generateNearbyThumbs(f, !0)
                }), $(window).on("resize.thumbnail", function() {
                    a.isMobile() || v.resizeScrollbar()
                })
            }, this.setThumbFocus = function(a, b) {
                if (!$fxThumViewContainer.is(":visible")) return void(s = a);
                try {
                    var c = WebPDF.ViewerInstance.getPageCount();
                    if (!b && (0 > a || a >= c || s === a)) return;
                    this._generateNearbyThumbs(a), k(), j(a), s = a;
                    var e = $(window).height(),
                        f = 179,
                        g = d(),
                        h = f * Math.max(0, Math.floor(e / f) - 1),
                        i = Math.floor(a / g) * f,
                        l = q.offset().top + i,
                        m = $fxThumViewContainer.data("jsp");
                    l > h ? m.scrollToY(i - h + 56) : f / 2 > l && m.scrollToY(i - 36), v.resizeScrollbar()
                } catch (n) {
                    return console.error(n), !1
                }
            }, this.loadThumbImage = function(a) {
                for (var b = u.getBaseUrl(), c = 0; c < a.length; c++) {
                    var d = h(a[c]),
                        e = $("#" + d).attr("src");
                    (null == e || void 0 == e || "" == e) && (loadingImgUrl = WebPDF.Common.joinUrl(b, "images/reader/loading.gif"), $("#" + d).attr("src", loadingImgUrl), o(a[c], d))
                }
            }, this._generateNearbyThumbs = function(a) {
                var b = d(),
                    e = Math.floor($(window).height() / 179),
                    g = Math.ceil(b * e * 2),
                    l = WebPDF.ViewerInstance.getPageCount(),
                    m = Math.max(0, a - g),
                    p = Math.min(a + g, l - 1),
                    s = [];
                q.children().each(function(a, b) {
                    var c = $(b),
                        d = f(c);
                    m > d || d > p ? c.remove() : s.push(c)
                });
                for (var t = m; p >= t; t++) {
                    var u = $("#" + i(t));
                    if (0 == u.length) {
                        var v = n(t);
                        s.push(v)
                    }
                }
                var x = !0;
                s.forEach(function(a) {
                    q.append(a);
                    var b = f(a),
                        c = WebPDF.ViewerInstance.getFileID(),
                        d = r[c] = r[c] || {},
                        e = h(b);
                    d[b] ? $("#" + e).attr("src", d[b]) : x = !1
                }), c(), s.sort(function(a, b) {
                    var c = f(a),
                        d = f(b);
                    return c > d ? 1 : -1
                });
                var y = WebPDF.Tool.getReaderApp();
                x || (y.isLargeFile() ? w(s, a, m, p) : s.forEach(function(a) {
                    q.append(a);
                    var b = f(a),
                        c = h(b);
                    o(b, c)
                })), k(), j(y.getDocView().getCurPageIndex()), q.css({
                    height: Math.floor(179 * WebPDF.ViewerInstance.getPageCount() / b + 89.5),
                    position: "relative"
                })
            }, this.resizeScrollbar = function() {
                var a = $("#navigationPanel").outerWidth(),
                    b = $("#navigation").outerHeight();
                $("#docViewer_fxThumbpanel").css({
                    width: a + "px",
                    height: b - 28 + "px"
                }), c(), t && t.reinitialise(), l()
            }, this.init = function() {
                var a = "<div id='docViewer_fxThumbpanel' class='fwr-thumb-panel' style='display:none'></div>";
                p.append(a), $fxThumViewContainer = $("#docViewer_fxThumbpanel"), q = $("<div>"), $fxThumViewContainer.append(q), b(this), this.bindEvents()
            }, this.closeDoc = function() {
                q.empty()
            }, this.openDoc = function() {
                var a = d();
                q.empty(), q.css({
                    height: 179 * WebPDF.ViewerInstance.getPageCount() / a,
                    position: "relative"
                }), this.setThumbFocus(0)
            }
        }
        var e = a("core/Common/ServerService");
        b.createView = function(a) {
            var b = new d(a);
            return b
        }
    }), define("core/Plugins/Bookmark/BookmarkController", ["core/Plugins/Bookmark/Bookmarkns", "core/WebPDF", "core/Plugins/Bookmark/BookmarkListView", "core/Plugins/Bookmark/BookmarkTreeView", "core/Plugins/Bookmark/BookmarkService", "core/Plugins/Bookmark/PDFBookmark", "core/Plugins/Bookmark/PDFBookmarkInfo", "core/Plugins/Bookmark/BookmarkLoader", "core/Plugins/Action/PDFGoToAction"], function(a, b, c) {
        function d(b) {
            if (navigator.userAgent.match(/mobile|Android|iPhone|ios|iPod/i)) {
                var c = a("core/Plugins/Bookmark/BookmarkListView");
                h = new c(b)
            } else {
                var d = a("core/Plugins/Bookmark/BookmarkTreeView");
                h = new d(b)
            }
            g = a("core/Plugins/Bookmark/BookmarkService").createBookmarkService(b), e()
        }

        function e() {
            WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
                g.moveToRoot();
            }), WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_CLOSED, function(a, b) {
                h.clear()
            })
        }

        function f(a, b) {
            if (g) {
                var c = g.moveToFirstChild();
                c && g.moveToParent(), h.appendNode(g.getNodeID(), g.getParentNodeID(), WebPDF.Common.htmlEncode(g.getTitle()), b, c)
            }
            for (a || g.moveToFirstChild() && (f(a, b + 1), g.moveToParent()); g.moveToNextSibling();) f(a, b)
        }
        a("core/Plugins/Bookmark/Bookmarkns");
        var g = null,
            h = null;
        WebPDF.Bookmark.BookmarkController = d, d.prototype = {
            init: function() {
                g && g.init(), h && h.initView()
            },
            doAction: function(a) {
                var b = g.getNode(a);
                if (b) {
                    h.setCurNode(a);
                    for (var c = g.countActions(), d = 0; c > d; d++) {
                        var e = g.getAction(d),
                            f = e.getDestination();
                        WebPDF.ViewerInstance.gotoPageByDestination(f)
                    }
                }
            },
            expandChildNodes: function(a, b) {
                var c = g.getNode(a);
                c && h.expandChildrenNode(a, b)
            },
            enumChildNodes: function(a, b) {
                0 == b && g.moveToRoot();
                var c = g.moveToFirstChild();
                c && f(a, b)
            },
            buildUpView: function() {
                h.buildUpView()
            },
            resize: function() {
                h.resize()
            },
            showBookmarkPanel: function() {
                h.showPanel()
            },
            getBookmarkService: function() {
                return g
            }
        }, b.createBookmarkController = function(a) {
            return WebPDF.Bookmark.BookmarkInstance || (WebPDF.Bookmark.BookmarkInstance = new WebPDF.Bookmark.BookmarkController(a)), WebPDF.Bookmark.BookmarkInstance
        }
    }), define("core/Plugins/Bookmark/Bookmarkns", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.Bookmark = d.Bookmark || {}
    }), define("core/Plugins/Bookmark/BookmarkListView", [], function(a, b, c) {
        function d(a) {
            this._readerApp = a
        }

        function e(a) {
            var b = document.getElementById(i + "" + a);
            (null === b || void 0 === b) && (b = document.createElement("div"), b.id = i + "" + a, b.setAttribute("class", "fwrm-panel-bmContainer"), b.style.display = "block", h.append(b));
            var c = b.getElementsByTagName("ul"),
                d = null;
            if (null === c || void 0 === c || 0 == c.length) {
                if (d = document.createElement("ul"), b.appendChild(d), a > 0) {
                    var e = document.createElement("li");
                    e.setAttribute("levelid", a), e.innerHTML = "<p class='fwrm-panel-bookmark-parent'><svg><use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='#icon-panel-bookmark-parent'></use></svg></p>", d.appendChild(e)
                }
            } else d = c.item(0);
            return d
        }

        function f() {
            var a = WebPDF.Bookmark.BookmarkInstance;
            h.off("tap", "li").on("tap", "li", function(b) {
                var c = parseInt(b.target.getAttribute("nodeid"));
                return a.doAction(c), "block" == document.getElementById("fwrm-panel").style.display && $("#fwrm-panel").css("display", "none"), !1
            }), h.off("tap", "." + l).on("tap", "." + l, function(b) {
                for (var c = b.target, d = c.localName;
                    "p" != d;) c = c.parentNode, d = c.localName;
                var e = parseInt(c.getAttribute("nodeid"));
                if (!isNaN(e)) {
                    var f = parseInt(c.getAttribute("levelid")) + 1;
                    return a.expandChildNodes(e, f), !1
                }
            }), h.off("tap", ".fwrm-panel-bookmark-parent").on("tap", ".fwrm-panel-bookmark-parent", function(a) {
                for (var b = a.target, c = b.localName;
                    "li" != c;) b = b.parentNode, c = b.localName;
                var d = parseInt(b.getAttribute("levelId"));
                if (!isNaN(d)) {
                    var e = d - 1;
                    e = i + e;
                    var f = document.getElementById(e);
                    if (null != f && void 0 != typeof f) {
                        var g = i + d,
                            h = document.getElementById(g);
                        if (null != h && void 0 != typeof h) return "block" == h.style.display && (h.style.display = "none"), "none" == f.style.display && (f.style.display = "block"), !1
                    }
                }
            })
        }

        function g(a) {
            var b = a.childNodes[0];
            if (b && "ul" == b.localName) {
                var c = b.childNodes[1];
                if (c && "li" == c.localName) return parseInt(c.getAttribute("nodeid"))
            }
        }
        var h = null,
            i = "fwrm-panel-bm-level-",
            j = "fwrm-bm-node-",
            k = "fwrm-bm-node",
            l = "fwrm-bm-node-btnexpand";
        return d.prototype = {
            initView: function() {
                h = $("#fwrm-panel-bookmark")
            },
            clear: function() {
                null != h && h.children().remove(), h = null
            },
            buildUpView: function() {
                this.showPanel(), f()
            },
            expandChildrenNode: function(a, b) {
                var c = b - 1;
                c = i + c;
                var d = document.getElementById(c);
                if (null != d && "undefined" != typeof d) {
                    "block" == d.style.display && (d.style.display = "none");
                    var e = document.getElementById(i + "" + b),
                        f = WebPDF.Bookmark.BookmarkInstance;
                    if (e) {
                        var h = g(e);
                        if (h != a) {
                            for (; e.hasChildNodes();) e.removeChild(e.firstChild);
                            f.enumChildNodes(!0, b)
                        }
                        return void("none" == e.style.display && (e.style.display = "block"))
                    }
                    f.enumChildNodes(!0, b)
                }
            },
            appendNode: function(a, b, c, d, f) {
                var g = e(d),
                    h = document.createElement("li");
                if (h.id = j + "" + a, h.innerText = c, h.setAttribute("class", k), h.setAttribute("nodeid", a), h.setAttribute("levelid", d), g.appendChild(h), f) {
                    var i = document.createElement("p");
                    i.setAttribute("class", l), i.setAttribute("nodeid", a), i.setAttribute("levelid", d), i.innerHTML = "<svg><use xmlns:xlink='http://www.w3.org/1999/xlink' xlink:href='#icon-panel-bookmark-child'></use></svg>", h.appendChild(i)
                }
            },
            setCurNode: function(a) {},
            resize: function() {},
            showPanel: function() {
                var a = h.children().length;
                if (0 >= a) {
                    var b = WebPDF.Bookmark.BookmarkInstance;
                    b.enumChildNodes(!0, 0)
                }
            }
        }, d
    }), define("core/Plugins/Bookmark/BookmarkTreeView", [], function(a, b, c) {
        function d(a) {
            this._readerApp = a, this._options = a.getOptions()
        }

        function e(a) {
            if (null == k) {
                var b = a.getBaseUrl(),
                    c = b + "images/reader/dtree/",
                    d = {
                        root: "",
                        folder: c + "bookmark_ui.png",
                        folderOpen: c + "bookmark_ui.png",
                        node: c + "bookmark_ui.png",
                        nodehot: c + "bk1_ui.png",
                        empty: c + "empty.gif",
                        line: c + "line_pc_ui.png",
                        join: c + "join_pc_ui.png",
                        joinBottom: c + "joinbottom_pc_ui.png",
                        joinTop: c + "jointop_pc_ui.png",
                        joinonly: c + "joinonly_pc.png",
                        plus: c + "plug_pc_ui.png",
                        plusBottom: c + "plugbottom_pc.png",
                        plusTop: c + "plugtop_pc.png",
                        plusOnly: c + "plugonly_pc.png",
                        minus: c + "minus_pc_ui.png",
                        minusBottom: c + "minusbottom_pc.png",
                        minusTop: c + "minustop_pc.png",
                        minusOnly: c + "minusonly_pc.png",
                        nlPlus: c + "nolines_plus.gif",
                        nlMinus: c + "nolines_minus.gif"
                    };
                try {
                    i = new WebPDFTools.dTree("bookmark_", l, m, d), i.add(0, -1, "");
                    var e = WebPDF.Bookmark.BookmarkInstance;
                    e.enumChildNodes(!1, 0);
                    var f = i.toString();
                    j.append(f);
                    var g = $("#navigationPanel").outerWidth(),
                        h = $("#navigation").outerHeight();
                    j.css({
                        width: g + "px",
                        height: h - 28 + "px"
                    })
                } catch (n) {
                    return console.error(n), !1
                }
            }
        }

        function f() {
            var a = WebPDF.Bookmark.BookmarkInstance;
            j.off("click", "." + l).on("click", "." + l, function(b) {
                try {
                    var c = parseInt(b.target.getAttribute("nodeid"));
                    return a.doAction(c), !1
                } catch (d) {
                    console.error(d)
                }
            }), j.off("click", "." + m).on("click", "." + m, function(b) {
                try {
                    var c = parseInt(b.target.getAttribute("nodeid"));
                    return a.expandChildNodes(c), !1
                } catch (d) {
                    console.error(d)
                }
            })
        }

        function g(a) {
            if (null == k) {
                var b = {
                        showArrows: !1,
                        animateScroll: !1
                    },
                    c = "";
                switch (a.scrollBarType) {
                    case WebPDF.PDFView.ScrollBarType.CUSTOM_SCROLL_BAR:
                        c = j.fwrJScrollPane(b);
                        break;
                    case WebPDF.PDFView.ScrollBarType.NATIVE_SCROLL_BAR:
                        c = j.WebPDFNativeScroll(b);
                        break;
                    default:
                        $.error("Unsupported type of scroll bar.")
                }
                k = c.data("jsp")
            }
        }

        function h() {
            var a = $("#navigationPanel").outerWidth(),
                b = $("#navigation").outerHeight();
            if ("undefined" != typeof WebPDF.Bookmark) {
                WebPDF.Bookmark.BookmarkInstance;
                $("#docViewer_fxBookmarkPanel").css({
                    width: a + "px",
                    height: b - 28 + "px"
                }), k && k.reinitialise()
            }
        }
        var i = null,
            j = null,
            k = null,
            l = "bookmarkNode",
            m = "bookmarkPlusItem";
        return d.prototype = {
            initView: function() {
                var a = "<div id='docViewer_fxBookmarkPanel' class='fwr-bookmark-panel'style='display:none; height:100%; overflow: hidden; outline: none;'></div>";
                $("#navigationPanel").append(a), j = $("#docViewer_fxBookmarkPanel")
            },
            clear: function() {
                null != j && j.remove(), j = null, i = null, k = null
            },
            buildUpView: function() {
                e(this._readerApp), g(this._options), f()
            },
            expandChildrenNode: function(a, b) {
                i && i.o(a), null != k && k.reinitialise()
            },
            setCurNode: function(a) {
                i && i.setCurNode(a)
            },
            appendNode: function(a, b, c, d, e) {
                i.add(a, b, c)
            },
            resize: function() {
                k && h()
            },
            showPanel: function() {
                j && j.show()
            }
        }, $(window).resize(function() {
            h()
        }), d
    }), define("core/Plugins/Bookmark/BookmarkService", ["core/Plugins/Bookmark/PDFBookmark", "core/Plugins/Bookmark/PDFBookmarkInfo", "core/Plugins/Bookmark/Bookmarkns", "core/WebPDF", "core/Plugins/Bookmark/BookmarkLoader", "core/Plugins/Action/PDFGoToAction"], function(a, b, c) {
        function d(a, b, c, d) {
            this.parentNode = a, this.curIndex = d, this.curNodeId = b, this.pdfBookmark = c, this.childNodeList = [], this.addChildNode = function(a) {
                this.childNodeList.push(a)
            }
        }
        var e = a("core/Plugins/Bookmark/PDFBookmark");
        a("core/Plugins/Bookmark/BookmarkLoader"), a("core/Plugins/Action/PDFGoToAction");
        var f = a("core/Plugins/Bookmark/PDFBookmarkInfo"),
            g = {
                bookmarks: "bmks",
                parentIndex: "parent",
                curIndex: "cur",
                childs: "childs",
                title: "ttl",
                destInfo: "dest"
            };
        WebPDF.Bookmark.BookmarkJSONDataFormat = g, WebPDF.Bookmark.BookmarkNode = d, WebPDF.PDFOutline = function(a) {
            function b(a) {
                return a ? (o = new e(null), c(a), m = new d(null, 0, o, 0), j(m, o), void(p = m)) : void console.warn("Bookmark data is null.")
            }

            function c(a) {
                var b = a[g.bookmarks];
                if (b)
                    for (var c = 0; c < b.length; c++) {
                        var d = b[c];
                        if (0 === d[g.parentIndex]) {
                            var e = i(o, d, c),
                                f = d[g.childs];
                            if (f)
                                for (var j = f.length, k = 0; j > k; k++) {
                                    var l = f[k] - 1,
                                        m = i(e, b[l], l + 1);
                                    h(m, l, b)
                                }
                        }
                    }
            }

            function h(a, b, c) {
                var d = c[b];
                if (d) {
                    var e = d[g.childs];
                    if (e)
                        for (var f = e.length, j = 0; f > j; j++) {
                            var b = e[j] - 1,
                                k = i(a, c[b], b + 1);
                            h(k, b, c)
                        }
                }
            }

            function i(a, b, c) {
                var d = new WebPDF.PDFDestination(b[g.destInfo]),
                    h = new f(b[g.parentIndex], b[g.curIndex], b[g.title], d),
                    i = new e(h);
                return a.addChildBookmark(i), i
            }

            function j(a, b) {
                for (var c = b.getChildCount(), d = 0; c > d; d++) {
                    var e = b.getChild(d),
                        f = k(a, e, d);
                    j(f, e)
                }
            }

            function k(a, b, c) {
                var e = b.getBookmarkInfo(),
                    f = new d(a, e.currentIndex, b, c);
                a.addChildNode(f);
                WebPDF.Common.htmlEncodeEx(e.title);
                return f
            }

            function l(a, b) {
                if (!a) return !1;
                if (a.curNodeId == b) return p = a, !0;
                for (var c = 0; c < a.childNodeList.length; c++)
                    if (l(a.childNodeList[c], b)) return !0;
                return !1
            }
            var m = null,
                n = a,
                o = null,
                p = null;
            this.moveToRoot = function() {
                return p = m, !0
            }, this.isRoot = function() {
                return p ? null == p.parentNode : !1
            }, this.getParentNodeID = function() {
                return p.parentNode.curNodeId
            }, this.isFirstChild = function() {
                return 0 == p.curIndex
            }, this.isLastChild = function() {
                return p.curIndex == p.parentNode.childNodeList.length - 1
            }, this.moveToParent = function() {
                return p.parentNode ? (p = p.parentNode, !0) : !1
            }, this.getNodeID = function() {
                return p.curNodeId
            }, this.getNode = function(a) {
                return l(m, a)
            }, this.moveToNextSibling = function() {
                return null == p.childNodeList || null == p.parentNode ? !1 : p.curIndex > p.parentNode.childNodeList.length - 2 ? !1 : (p = p.parentNode.childNodeList[p.curIndex + 1], !0)
            }, this.moveToFirstChild = function() {
                return p.childNodeList && 0 != p.childNodeList.length ? (p = p.childNodeList[0], !0) : !1
            }, this.countActions = function(a) {
                var b = p.pdfBookmark._bookmarkInfo;
                return !b || b.destinationInfo.pageIndex < 0 || b.destinationInfo.pageIndex >= n.getDocView().getPageCount() ? 0 : 1
            }, this.getAction = function(a, b) {
                if (!this.isRoot() && p.pdfBookmark._bookmarkInfo) {
                    var c = new WebPDF.PDFGotoAction;
                    return c.initWithBookmark(p), c
                }
            }, this.getTitle = function() {
                return this.isRoot() ? void 0 : p.pdfBookmark._bookmarkInfo.title
            }, this.init = function() {
                var a = new WebPDF.Bookmark.BookmarkLoader;
                a.asyncLoadPDFBookmark(n, n.getPDFDoc(), b, $.noop)
            }
        }, b.createBookmarkService = function(a) {
            return new WebPDF.PDFOutline(a)
        }
    }), define("core/Plugins/Bookmark/PDFBookmark", ["core/Plugins/Bookmark/PDFBookmarkInfo", "core/Plugins/Bookmark/Bookmarkns", "core/WebPDF"], function(a, b, c) {
        a("core/Plugins/Bookmark/PDFBookmarkInfo");
        var d = function(a) {
            this._bookmarkInfo = a, this._childNodeList = []
        };
        return d.prototype = {
            addChildBookmark: function(a) {
                this._childNodeList.push(a)
            },
            getChildCount: function() {
                return this._childNodeList.length
            },
            getChild: function(a) {
                return this._childNodeList[a]
            },
            getBookmarkInfo: function() {
                return this._bookmarkInfo
            }
        }, WebPDF.Bookmark.PDFBookmark = d, WebPDF.Bookmark.PDFBookmark
    }), define("core/Plugins/Bookmark/PDFBookmarkInfo", ["core/Plugins/Bookmark/Bookmarkns", "core/WebPDF"], function(a, b, c) {
        function d(a, b, c, d) {
            this._nParentID = a, this.currentIndex = b, this.destinationInfo = d, this.title = c
        }
        return a("core/Plugins/Bookmark/Bookmarkns"), WebPDF.Bookmark.PDFBookmarkInfo = d, WebPDF.Bookmark.PDFBookmarkInfo
    }), define("core/Plugins/Bookmark/BookmarkLoader", ["core/Plugins/Bookmark/Bookmarkns", "core/WebPDF"], function(a, b, c) {
        a("core/Plugins/Bookmark/Bookmarkns"), WebPDF.Bookmark.BookmarkLoader = function() {
            var a = WebPDF.Config.defaults.requestRetryCount,
                b = this;
            this.asyncLoadPDFBookmark = function(c, d, e, f) {
                function g(g) {
                    if (null == g.response) return console.warn("Getting bookmark date returns null"), void f(g.response);
                    var h = g.error;
                    if (0 !== h) {
                        if (WebPDF.Common.isNeedRetry(g.status)) {
                            var i = WebPDF.AjaxRetryManager.getNextBookmarkDataRequestInterval(c.getMainView().getDocView().getPageCount());
                            return a--, void setTimeout(function() {
                                b.asyncLoadPDFBookmark(c, d, e, f)
                            }, i)
                        }
                        return console.error("Get bookmark data error:" + h), void f(g.response)
                    }
                    try {
                        e($.parseJSON(g.bmkInfo))
                    } catch (j) {
                        return console.error(j), f(g.response), !1
                    }
                }

                function h() {
                    f(null)
                }
                if ($.isFunction(e) && $.isFunction(f) || $.error("both 'doneHandler' and 'failedHandler' must be function."), 0 >= a) return console.error("Maximum number of retries exceeded for getBookmarkData request."), void f(null);
                var i = c.getOptions().url + "bookmarks";
                c.isFormMode() && (i += "?formMode=true");
                var j = {
                        url: i,
                        password: c.getPDFPassword()
                    },
                    k = c.getDataControl(),
                    l = {
                        type: "getBmkInfo",
                        data: j,
                        success: g,
                        error: h
                    };
                k.getBmkInfo(l)
            }
        }
    }), define("core/Plugins/Action/PDFGoToAction", ["core/WebPDF"], function(a, b, c) {
        a("core/WebPDF"), WebPDF.PDFGotoAction = function() {
            var a = null;
            this.initWithBookmark = function(b) {
                a = b
            }, this.getPageIndex = function() {
                return a && a.pdfBookmark && a.pdfBookmark._bookmarkInfo ? a.pdfBookmark._bookmarkInfo.destinationInfo.pageIndex : void 0
            }, this.getDestination = function() {
                return a && a.pdfBookmark && a.pdfBookmark._bookmarkInfo ? a.pdfBookmark._bookmarkInfo.destinationInfo : void 0
            }
        }
    }), define("core/Plugins/DocProperties/DocPropertiesPlugin", [], function(a, b, c) {
        WebPDF.DocProperties.PDFDocPropertiesPlugin = function(a) {
            function b(a, b) {
                var c = WebPDF.Common.changeUnit(b, "point", a);
                return WebPDF.Common.parseValueToDecimal(c, 2)
            }

            function c() {
                var b = g.getPDFDoc().getDocProperties();
                if (b) {
                    var c = g.getAppId(),
                        e = c + "-fwr-doc-properties-dlg";
                    if (0 == $("#" + e).length && (f = "<div id='" + e + "' style='display:none' class='fwr-modal fwr-hide fwr-fade fwr-in fwr-doc-properties-dlg'><div class='fwr-modal-header'><a class='close' webpdf-data-dismiss='modal'></a><h4 data-i18n='DocProperties.Title'>Foxit Web PDF</h4></div><div class='fwr-modal-body'><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.PDFTitle'></span><span id='" + k.title + "' class='txtspan' title=''></span></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.Subject'></span><span id='" + k.subject + "' class='txtspan'></span></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.Author'></span><span id='" + k.author + "' class='txtspan'></span></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.Creator'></span><span id='" + k.creator + "' class='txtspan'></span></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.Producer'></span><span id='" + k.producer + "' class='txtspan'></span></div><div class='sp'><span class='left' style='float:left' data-i18n='DocProperties.Keywords'></span><textarea id='" + k.keywords + "' style='width:272px;max-width:272px;height:55px; resize:none;' class='fwr-doc-properties-dlg-keyword' disabled='disabled'></textarea></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.CreateDate'></span><span  id='" + k.creationDate + "' class='txtspan'></span></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.ModifyDate'></span><span  id='" + k.modifyDate + "' class='txtspan'></span></div><div class='separator'></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.PDFVersion'></span><span id='" + k.version + "'></span></div><div class='sp defaultHeight'><span class='left' data-i18n='DocProperties.PageSize'></span><span id='" + k.pageSize + "'></span><select id='" + k.unit + "' style='width:53px;margin-left:4px'><option value='inch' data-i18n='DocProperties.Inch'></option><option value='cm' data-i18n='DocProperties.Centimeter'></option><option value='point' data-i18n='DocProperties.Point'></option><option value='pica' data-i18n='DocProperties.Pica'></option></select></div><div class='sp'><span class='left' data-i18n='DocProperties.NumOfPages'></span><span id='" + k.pageCount + "'></span></div></div><div class='fwr-modal-footer' ><a href='#' id='" + k.closeBtn + "' class='btn' webpdf-data-dismiss='modal' data-i18n='DocProperties.OKBtnTitle'>Close</a>", $("#" + a.getMainFrameId()).append(f), i = $("#" + e), $("#" + k.unit).off("change").on("change", function() {
                            d()
                        }), h = !0), i) {
                        i.i18n();
                        var j = b.getAuthor();
                        j && $("#" + k.author).text(j).attr("title", j);
                        var l = b.getCreator();
                        l && $("#" + k.creator).text(l).attr("title", l);
                        var m = b.getProducer();
                        m && $("#" + k.producer).text(m).attr("title", m);
                        var n = b.getTitle();
                        n && $("#" + k.title).text(n).attr("title", n);
                        var o = b.getSubject();
                        o && $("#" + k.subject).text(o).attr("title", o);
                        var p = b.getKeywords();
                        p && $("#" + k.keywords).val(p);
                        var q = b.getCreationDate();
                        q && $("#" + k.creationDate).text(q).attr("title", q);
                        var r = b.getModifyDate();
                        r && $("#" + k.modifyDate).text(r).attr("title", r);
                        var s = b.getVersion();
                        s && $("#" + k.version).text(s).attr("title", s);
                        var t = g.getMainView().getDocView().getPageCount();
                        $("#" + k.pageCount).text(t).attr("title", t), d(), i.webPDFModal({
                            keyboard: !1,
                            backdrop: "static"
                        })
                    }
                }
            }

            function d() {
                var a = $("#" + k.unit).val(),
                    c = g.getMainView().getDocView().getCurPageIndex(),
                    d = g.getPDFDoc().getPage(c),
                    e = b(a, d.getPageWidth()),
                    f = b(a, d.getPageHeight()),
                    h = e + " * " + f;
                $("#" + k.pageSize).text(h).attr("title", h)
            }

            function e() {
                var a = j + "contextMenuDocProperties";
                g.addMenuItem({
                    name: "MenuDocProperties",
                    createHtml: function() {
                        return "<li  id='" + a + "' class='icon' menuname='MenuDocProperties'><span class='icon icon1'></span><label data-i18n='DocProperties.Title'></label></li>"
                    },
                    onShow: function() {},
                    onSelect: function(a) {
                        if (a) {
                            if (a.hasClass("disabled")) return !1;
                            c()
                        }
                    }
                })
            }
            var f = "",
                g = a,
                h = !1,
                i = null,
                j = g.getAppId(),
                k = {
                    author: j + "_docPropertiesAuthor",
                    creator: j + "_docPropertiesCreator",
                    producer: j + "_docPropertiesProducer",
                    title: j + "_docPropertiesTitle",
                    subject: j + "_docPropertiesSubject",
                    keywords: j + "_docPropertiesKeywords",
                    creationDate: j + "_docPropertiesCreationDate",
                    modifyDate: j + "_docPropertiesModifyDate",
                    version: j + "_docPropertiesVersion",
                    name: j + "_docPropertiesName",
                    pageCount: j + "_docPropertiesPageCount",
                    pageSize: j + "_docPropertiesPageSize",
                    unit: j + "_docPropertiesUnit",
                    closeBtn: j + "_btnCloseDocPropertiesDlg"
                };
            this.getName = function() {
                return "DocProperties Plugin"
            }, this.onRegister = function() {}, this.init = function() {
                e()
            }, this.unload = function() {
                i && i.webPDFModal("hide")
            }
        }, b.createPlugin = function(a) {
            return new WebPDF.DocProperties.PDFDocPropertiesPlugin(a)
        }
    }), define("core/Plugins/Form/FormPlugin", ["core/Plugins/Form/service/PDFForm", "core/Plugins/Form/service/PDFFormField", "core/Plugins/Form/service/PDFFormConstants", "core/Plugins/Form/service/PDFFormControl", "core/Plugins/Form/view/formViewer", "core/Plugins/Form/view/baseControlView", "core/Common/Math/Rect", "core/WebPDF"], function(a, b, c) {
        var d, e, f = a("core/Plugins/Form/service/PDFForm"),
            g = a("core/Plugins/Form/view/formViewer").createFormViewer(f),
            h = function(a) {
                function b(a) {
                    if (!document.getElementById("fields_highlight")) {
                        var b, c;
                        if (a.isMobile()) b = '<div id="fields_highlight" class="fwr_fields_highlight_div" style="display:none;"><span class="leftPanel">This file contains interactive form fields.</span><div class="rightPanel"><button class="butClose" id="btnHighlightClose" type="button"></button><button class="fwr_button butHighlight" id="btnHighlightFormField" type="button">Highlight Fields</button></div></div>', c = $("#" + a.getMainFrameId()), c.parent().before(b), $("#btnHighlightClose").off("tap").on("tap", function() {
                            var a = document.getElementById("fields_highlight");
                            a.style.display = "none", window.onresize()
                        }), $("#fields_highlight").off("tap").on("tap", function() {
                            var a = WebPDF.ViewerInstance.getPluginByName(WebPDF.FormPluginName);
                            a && a.highlight()
                        });
                        else {
                            b = '<div id="fields_highlight" class="fwr_fields_highlight_div" style="display:none;"><span class="leftPanel">This file contains interactive form fields.</span><div class="rightPanel"><button class="butClose" id="btnHighlightClose" type="button"></button><button class="fwr_button butHighlight" id="btnHighlightFormField" type="button">Highlight Fields</button></div></div>', c = $("#" + a.getMainFrameId()), c.parent().prepend(b);
                            var d = $("#btnHighlightFormField"),
                                e = $("#btnHighlightClose");
                            d.off("click").on("click", function() {
                                var a = WebPDF.ViewerInstance.getPluginByName(WebPDF.FormPluginName);
                                a && a.highlight()
                            }), e.off("click").on("click", function() {
                                var a = document.getElementById("fields_highlight");
                                a.style.display = "none", $(window).resize()
                            })
                        }
                    }
                }

                function c(a) {
                    for (var b = 0, c = 0; c < a.length; ++c) {
                        var d = a.charCodeAt(c);
                        d >= 55296 && 57343 >= d && (d = 65536 + ((1023 & d) << 10) | 1023 & a.charCodeAt(++c)), 127 >= d ? ++b : b += 2047 >= d ? 2 : 65535 >= d ? 3 : 2097151 >= d ? 4 : 67108863 >= d ? 5 : 6
                    }
                    return b
                }

                function h(a, b, c, d) {
                    if (!d) return 0;
                    for (var e = c, f = c + d - 1, g = 0; g < a.length; ++g) {
                        var h = a.charCodeAt(g);
                        if (h >= 55296 && 57343 >= h && (h = 65536 + ((1023 & h) << 10) | 1023 & a.charCodeAt(++g)), 127 >= h) {
                            if (c > f) break;
                            b[c++] = h
                        } else if (2047 >= h) {
                            if (c + 1 >= f) break;
                            b[c++] = 192 | h >> 6, b[c++] = 128 | 63 & h
                        } else if (65535 >= h) {
                            if (c + 2 > f) break;
                            b[c++] = 224 | h >> 12, b[c++] = 128 | h >> 6 & 63, b[c++] = 128 | 63 & h
                        } else if (2097151 >= h) {
                            if (c + 3 > f) break;
                            b[c++] = 240 | h >> 18, b[c++] = 128 | h >> 12 & 63, b[c++] = 128 | h >> 6 & 63, b[c++] = 128 | 63 & h
                        } else if (67108863 >= h) {
                            if (c + 4 > f) break;
                            b[c++] = 248 | h >> 24, b[c++] = 128 | h >> 18 & 63, b[c++] = 128 | h >> 12 & 63, b[c++] = 128 | h >> 6 & 63, b[c++] = 128 | 63 & h
                        } else {
                            if (c + 5 > f) break;
                            b[c++] = 252 | h >> 30, b[c++] = 128 | h >> 24 & 63, b[c++] = 128 | h >> 18 & 63, b[c++] = 128 | h >> 12 & 63, b[c++] = 128 | h >> 6 & 63, b[c++] = 128 | 63 & h
                        }
                    }
                    return b[c] = 0, c - e
                }

                function i(a) {
                    var b = c(a),
                        d = new Uint8Array(b);
                    return h(a, d, 0, b + 1), d
                }

                function j() {
                    var b = f.getData();
                    if (b) {
                        b.isUser = "1";
                        var c = {
                                data: JSON.stringify(b)
                            },
                            e = a.getOptions().url + "form/save?" + Math.random();
                        $.ajax({
                            type: "post",
                            url: e,
                            data: c,
                            dataType: "json",
                            success: function(a) {
                                d.getDocView().setModified(!1), a && 0 === a.error || alert("save form error!")
                            },
                            error: function() {}
                        })
                    }
                }
                d = a, e = this;
                var k, l = !0,
                    m = !0,
                    n = ["RGB", 0, 0, 1],
                    o = null,
                    p = !1,
                    q = 1;
                this.getName = function() {
                    return "WebPDFForm"
                }, this.onRegister = function() {}, this.unload = function() {}, this.init = function() {
                    p || (f.init(d, g.updateControl), b(d), this.bindAppEvent(), p = !0, q = 1)
                }, this.isReadOnly = function() {
                    if ("undefined" == typeof k) {
                        var a = d.getOptions().plugins;
                        k = 32 & a || 256 & a
                    }
                    return !k
                }, this.getFormHtmlContent = function(a, b) {
                    var c = a.getPageIndex(),
                        e = f.getPageControls(c);
                    if (!e) return "";
                    var h = d.getBaseUrl() + "asserts/" + d.getFileID() + "/controlsImage/" + c;
                    return g.getControlsHTML(a, e, h, null, {
                        scale: b
                    })
                }, this.setFocusControl = function(a) {
                    o = a
                }, this.blurFocusedControl = function() {
                    o && o.blur()
                }, this.renderPageWidget = function(a, b) {
                    var c = d.getDocView().getPageView(a);
                    null != b && (q += g.renderControls(c, b, b.bgUrl, q))
                }, this.bindAppEvent = function() {
                    $(d).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function(a, b) {
                        g.zoomEvent(d, b)
                    }).on(WebPDF.EventList.PAGE_VISIBLE, function(a, b) {
                        for (var c in b.pages) {
                            var e = b.pages[c];
                            if (d.getMainView()) {
                                var f = d.getDocView().getScale();
                                g.adjustContorlPosition(e, f)
                            }
                        }
                    }).on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
                        b.docPermission.isForm && (q = 1, f.loadForm())
                    }).on(WebPDF.EventList.OFFLINEMODE_CHANGED, function(a, b) {
                        0 == b.isOffline && b.docPermission.isForm && (WebPDF.FormPlugin.form.hasData() || (q = 1, f.loadForm()))
                    }).on(WebPDF.EventList.PAGE_SHOW_COMPLETE, function(a, b) {
                        var c = b.pageView.getPageIndex();
                        f.LoadPageControlsAP(c, e.renderPageWidget)
                    }).on(WebPDF.EventList.DOCUMENT_CLOSED, function() {
                        f.release(), g.clearData()
                    }), $("#btnExportForm").on("click", function() {
                        console.log("export click")
                    })
                }, this.disableAction = function() {
                    l = !1
                }, this.enableAction = function() {
                    l = !0
                }, this.doAction = function(a, b, c, d) {
                    if (l) {
                        var f;
                        switch (a) {
                            case "focus":
                                f = "Fo";
                                break;
                            case "mousedown":
                                f = "D";
                                break;
                            case "mouseup":
                                f = "U";
                                break;
                            case "blur":
                                f = "Bl";
                                break;
                            case "mouseout":
                                f = "X";
                                break;
                            case "mouseover":
                                f = "E";
                                break;
                            case "change":
                                f = "K";
                                break;
                            case "validate":
                                f = "V";
                                break;
                            case "calculate":
                                f = "C"
                        }
                        if ("U" === f && (c && c.getAction() || b && b.getAction())) {
                            var g = c.getAction();
                            "URI" === g.S || (g && "JS" === g.S ? (WebPDF.JSEngine.setEnvParams({
                                target: b,
                                name: name,
                                isLoading: !1
                            }), WebPDF.JSEngine.enable && WebPDF.JSEngine.runJs(g.JS)) : this.form.doFormAction(g))
                        }
                        return d = d || {}, d.hasAction = !0, e.runJSAction(b, c, f, !1, d)
                    }
                }, this.runFormatJS = function(a, b, c) {
                    var d, f = a.getValue();
                    if (!f) return "";
                    var g = {
                        hasAction: !0
                    };
                    return d = e.runJSAction(a, b, "F", c, g), g.hasAction ? d : a.getValue()
                }, this.runJSAction = function(a, b, c, d, e) {
                    if (!WebPDF.JSEngine || !WebPDF.JSEngine.enable) return void(e.hasAction = !1);
                    var f = b ? b.getAAction(c) : a.getAAction(c);
                    if (!f || "JS" !== f.S) return void(e.hasAction = !1);
                    var g = e && e.value ? e.value : a.getValue();
                    "K" !== c && "C" !== c ? WebPDF.JSEngine.setEnvParams({
                        target: a,
                        name: c,
                        isLoading: d,
                        willCommit: !0,
                        value: g
                    }) : WebPDF.JSEngine.setEnvParams({
                        target: a,
                        name: c,
                        isLoading: d,
                        willCommit: !1
                    });
                    var h = WebPDF.JSEngine.runJs(f.JS);
                    if ("C" === c && !d) {
                        var g = WebPDF.JSEngine.getEvent().value;
                        null === g && (g = h), a.setValue(g, null, !0, !0)
                    }
                    return WebPDF.JSEngine.getEvent().value
                }, this.getJSResult = function() {
                    return WebPDF.JSEngine.getEvent().value
                }, this.highlight = function() {
                    m = !m, g.highlightForm(m)
                }, this.isHighlight = function() {
                    return m
                }, this.setHighlight = function(a) {
                    m = a, g.highlightForm(m)
                }, this.highlightColor = function() {
                    return n
                }, this.setHighlightColor = function(a) {
                    n = a, g.switchHighlightColor(n)
                }, this.getFormXML = function(a) {
                    return f.exportXML(a)
                }, this.exportToXML = function(b) {
                    b || (b = a.getFileName(), b = b.substring(0, b.lastIndexOf(".")) + ".xml");
                    var c, d;
                    if ("undefined" != typeof Blob) c = f.exportXML(!1), d = new Blob([c], {
                        type: "text/xml"
                    }), webpdfsaveAs(d, b);
                    else {
                        var e = a.getPDFDoc();
                        e && e.exportFormXML(b)
                    }
                }, this.exportToXMLStream = function(a) {
                    var b = i(f.exportXML(!1));
                    setTimeout(function() {
                        a(b)
                    }, 0)
                }, this.exportXMLToUrl = function(a, b, c, e) {
                    if (WebPDF.Engine.JR) return void console.log("function exportXMLToUrl is not spported with JR.");
                    var f = d.getDocPermission();
                    if (!f.isForm) return void($.isFunction(e) && e("permission deny!"));
                    if (!WebPDF.ViewerInstance.hasForm()) return $.isFunction(e) && e("the document isn't form file!"), void console.info("the document isn't form file!");
                    b || (apiConfig && apiConfig.form && "object" == typeof apiConfig.form.exportForm ? b = apiConfig.form.exportForm : apiConfig && apiConfig.form && "function" == typeof apiConfig.form.exportForm ? b = apiConfig.form.exportForm() : console.error("apiConfig.form.exportForm format error,mush object or function"), b = b ? b : {});
                    var g = d.getPDFDoc();
                    g && g.exportFormXML(a, !0, JSON.stringify(b), c, e)
                }, this.importFromXML = function(a) {
                    f.importXML(a, g.updateFieldDOM)
                }, this.importXMLFromUrl = function(a, b, c) {
                    if (WebPDF.Engine.JR) return void console.log("function importXMLFromUrl is not spported with JR.");
                    var f = d.getDocPermission();
                    if (!f.isForm) return void($.isFunction(c) && c("permission deny!"));
                    if (!WebPDF.ViewerInstance.hasForm()) return $.isFunction(c) && c('the document isn"t form file!'), void console.info('the document isn"t form file!');
                    a || (apiConfig && apiConfig.form && "object" == typeof apiConfig.form.importForm ? a = apiConfig.form.importForm : apiConfig && apiConfig.form && "function" == typeof apiConfig.form.importForm ? a = apiConfig.form.importForm() : console.error("apiConfig.form.importForm format error,mush object or function"), a = a ? a : {});
                    var g = {
                        params: JSON.stringify(a)
                    };
                    $.ajax({
                        url: d.getOptions().url + "form/xml/remote/importXml",
                        type: "POST",
                        data: g,
                        success: function(a) {
                            a ? (e.importFromXML(a), null != b && "function" == typeof b && b()) : null != c && "function" == typeof c && c()
                        },
                        error: function() {
                            null != c && "function" == typeof c && c()
                        }
                    })
                }, this.importFromXMLStream = function(a) {
                    this.importFromXML($.parseXML(String.utf8ArrayToString(a)))
                }, this.showHighlightBar = function(a) {
                    var b = document.getElementById("fields_highlight");
                    b && (a ? b.style.display = "block" : b.style.display = "none")
                }, this.save = function() {
                    var a = d.getDocPermission();
                    a.isForm && j()
                }, this.isHighlightBarVisible = function() {
                    var a = document.getElementById("fields_highlight");
                    return a && $(a).is(":visible") ? !0 : !1
                }, this.convertColor = function(a, b) {
                    var c, d, e, f;
                    switch (a[0]) {
                        case "T":
                            d = -1, e = -1, f = -1;
                            break;
                        case "G":
                            d = e = f = 255 * a[1];
                            break;
                        case "RGB":
                            d = 255 * a[1], e = 255 * a[2], f = 255 * a[3];
                            break;
                        case "CMYK":
                            d = (1 - a[4]) * (1 - a[1]) * 255, e = (1 - a[4]) * (1 - a[2]) * 255, f = (1 - a[4]) * (1 - a[3]) * 255
                    }
                    return "HTML" === b && (c = d === e && e === f && -1 === f ? "transparent" : "rgb(" + parseInt(d) + "," + parseInt(e) + "," + parseInt(f) + ")"), c
                }, this.getUIManager = function() {
                    return g
                }, this.getFormService = function() {
                    return f
                }
            };
        b.createPlugin = function(a) {
            return WebPDF.FormPlugin || (WebPDF.FormPlugin = new h(a), WebPDF.FormPluginName = WebPDF.FormPlugin.getName()), WebPDF.FormPlugin
        }
    }), define("core/Plugins/Form/service/PDFForm", ["core/Plugins/Form/service/PDFFormField", "core/Plugins/Form/service/PDFFormConstants", "core/Plugins/Form/service/PDFFormControl"], function(a, b, c) {
        function d(a) {
            function b(a) {
                var b = a;
                return b = b.replace(/&amp;/g, "&"), b = b.replace(/&lt;/g, "<"), b = b.replace(/&gt;/g, ">"), b = b.replace(/&apos;/g, "'"), b = b.replace(/&quot;/g, '"'), b = b.replace(/\r/g, ""), b = b.replace(/\n/g, " ")
            }

            function c(a) {
                if (!a) return "";
                var b = a;
                return b = b.replace(/&/g, "&amp;"), b = b.replace(/</g, "&lt;"), b = b.replace(/>/g, "&gt;"), b = b.replace(/\'/g, "&apos;"), b = b.replace(/\"/g, "&quot;")
            }

            function d(a, c) {
                var d = "";
                return a && "undefined" != typeof a.attr(c) && (d = b(a.attr(c))), d
            }
            var k = null,
                l = [],
                m = {},
                n = {},
                o = [],
                p = {},
                q = {},
                r = !1,
                s = this;
            s.notifier = a, this.load = function(a) {
                k = a;
                for (var b = 0; b < k.Fields.length; b++) {
                    var c = k.Fields[b];
                    if (o[b] = new g.Field(s, c, b), n[c.T] = o[b], "Kids" in c)
                        for (var d = c.Kids.length - 1; d >= 0; d--) {
                            var e = parseInt(c.Kids[d]);
                            k[e].ci = d, k[e].on = e, m[e] = k[e]
                        } else {
                            var f = c.on;
                            m[f] = c
                        }
                }
                if (k.Names && WebPDF.JSEngine.enable)
                    for (var h in k.Names) WebPDF.JSEngine.runJs(k.Names[h]);
                if (k.CO)
                    for (var i = 0; i < k.CO.length; i++) {
                        var j = s.getFieldByObjNum(parseInt(k.CO[i]));
                        if (!j) return;
                        var l = j.getDepends();
                        if (j) {
                            for (var p = 0; p < l.length; p++) l[p] in q || (q[l[p]] = []), -1 === q[l[p]].indexOf(j) && q[l[p]].push(j);
                            q[j.getTitle()] = [j]
                        }
                    }
            }, this.getDirect = function(a) {
                return k[parseInt(a)]
            }, this.numFields = function() {
                return k.Fields.length
            }, this.hasData = function() {
                return !!k
            }, this.getData = function() {
                return k
            }, this.release = function() {
                m = {}, k = null, l = [], o = [], n = {}, p = {}, q = {}
            }, this.exportXML = function(a) {
                for (var b = '<?xml version="1.0" encoding="UTF-8"?>\r<fields xmlns:xfdf="http://ns.adobe.com/xfdf-transition/">\r', d = o.length - 1; d >= 0; d--) {
                    var e = o[d],
                        f = e.getTitle(),
                        g = f,
                        h = "";
                    if ($.isNumeric(f) ? (g = "fxTag", h = ' xfdf:original="' + f + '"') : f.match(/[^0-9][a-zA-Z0-9:\-_\.]*/)[0].length !== f.length && (g = f.replace(/[^a-zA-Z0-9:\-_\.]/g, ""), h = ' xfdf:original="' + f + '"'), e.getType() !== i.PushButton && e.getType() !== i.Sign && (!e.notExport() || a)) {
                        var j = a ? WebPDF.FormPlugin.runFormatJS(e, null, !0) : c("" + e.getValue());
                        (e.getType() === i.CheckBox || e.getType() === i.RadioButton) && (j = e.getButtonValue(), j = j || "Off"), j && (b += "<" + g + h + ">" + j + "</" + g + ">\r")
                    }
                }
                return b + "</fields>"
            }, this.exportFDF = function() {
                var a = "%FDF-1.2\n1 0 obj<</FDF<</F({filePath})/UF({filePath})/Fields[";
                a = a.format({
                    filePath: e.getFileName()
                });
                for (var b = "<</T({title})/V{value}>>", c = o.length - 1; c >= 0; c--) {
                    var d = o[c];
                    d.getType() === i.PushButton || d.getType() === i.Sign || d.notExport() || (a += b.format({
                        title: d.getTitle(),
                        value: d.getType() === i.CheckBox || d.getType() === i.RadioButton ? "/" + d.getValue() : "(" + d.getValue() + ")"
                    }))
                }
                return a + "]>>>>endobj\ntrailer<</Root 1 0 R>>%%EOF"
            }, this.importXML = function(a) {
                var b = $(a).children();
                b.children().each(function() {
                    var a = d($(this), "xfdf:original");
                    a && "" !== a && 0 !== a.length || (a = this.tagName);
                    var b = $(this).text(),
                        c = s.getFieldByName(a);
                    c && b !== c.getValue() && (c.getType() === i.CheckBox || c.getType() === i.RadioButton ? c.setValue(c.getButtonValue(b), null, !0) : c.setValue(b, null, !0))
                }), s.notifier("IMPORT")
            }, this.getCO = function() {
                return k.CO
            }, this.addPageControls = function(a, b) {
                var c = [],
                    d = 0;
                for (var e in b)
                    if ("w" !== e && "h" !== e && null != m[e]) {
                        var f = s.getFieldFromControl(m[e]);
                        if (f) {
                            m[e].P || (m[e].P = a, m[e].AP = b[e]), (f.getType() === i.CheckBox || f.getType() === i.RadioButton) && (m[e].AS = f.getValue() in m[e].AP.N ? f.getValue() : "Off");
                            var g = new h.Control(s, f, m[e]);
                            c[d++] = g, p[e] = g
                        }
                    }
                return l[a] = {
                    w: b.w,
                    h: b.h,
                    Controls: c
                }, l[a]
            }, this.isPagaControlsLoaded = function(a) {
                return a in l
            }, this.getControlByObjNum = function(a) {
                return p[a]
            }, this.getFieldFromControl = function(a) {
                var b;
                b = "PF" in a ? parseInt(a.PF) : a.on;
                var c = this.getFieldByObjNum(b);
                return c || (c = this.getFieldByObjNum(a.on)), c
            }, this.getFieldByObjNum = function(a) {
                for (var b = 0; b < o.length; b++) {
                    var c = o[b];
                    if (c.getObjNum() === a) return c
                }
                return null
            }, this.getFieldByName = function(a) {
                return n[a]
            }, this.getNthFieldName = function(a) {
                return k.Fields[a].T
            }, this.getPageControls = function(a) {
                return l[a]
            }, this.clearCalculating = function() {
                r = !1
            }, this.updateFieldsValue = function(a, b, c) {
                var d = e.getMainView().getDocView();
                e.setModified(null, d, !0);
                var f = [a],
                    g = a.getTitle();
                if (!c && !r && g in q) {
                    r = !0;
                    for (var h = 0; h < k.CO.length; h++) {
                        var j = s.getFieldByObjNum(parseInt(k.CO[h]));
                        WebPDF.FormPlugin.doAction("calculate", j, null, null);
                    }
                }
                for (var l = 0; l < f.length; l++) {
                    var m = f[l],
                        n = m.getType(),
                        o = m.getValue(),
                        p = null;
                    if (m.hasKids())
                        for (var t = m.getKidsCount(), u = 0; t > u; u++) {
                            var v = m.getControl(u);
                            if (v) {
                                var w = v.getAP("N");
                                null != w ? n === i.CheckBox ? (o in w ? v.setAS(o) : v.setAS("Off"), p = w[v.getAS()]) : n === i.RadioButton && (m.InUnison() ? o in w ? v.setAS(o) : v.setAS("Off") : o in w ? v.setAS(o) : v.setAS("Off"), p = w[v.getAS()]) : v.setAS(null);
                                var x = null != p ? p : WebPDF.FormPlugin.runFormatJS(m, v, o);
                                b && s.notifier("VC", m, v, x)
                            }
                        } else {
                            var y = m.getControl(0);
                            (n === i.CheckBox || n === i.RadioButton) && y && (p = y.getAP("N")[o], y.setAS(o)), o = null != p ? p : WebPDF.FormPlugin.runFormatJS(m, y, !1), b && y && s.notifier("VC", m, y, o)
                        }
                }
            }, this.doFormAction = function(a) {
                var b, c, d, e;
                if ("ResetForm" === a.S)
                    if (e = parseInt(a.F, 16), e & j.IncludeOrExclude)
                        for (b = 0; b < o.length; b++) c = o[b], d = c.getTitle(), d in a.fields || c.setValue(c.getDefaultValue(), null, !0);
                    else {
                        var f = a.fields;
                        for (f && 0 !== f.length || (f = o), b = 0; b < f.length; b++) {
                            c = f[b], "string" == typeof c && (c = this.getFieldByName(c));
                            var g = c.getDefaultValue();
                            (c.getType() === i.RadioButton || c.getType() === i.CheckBox) && (g || (g = "Off")), c.setValue(g, null, !0)
                        }
                    }
                else "SubmitForm" === a.S
            }, this.getDocAction = function(a) {
                return f.hasData() && "AA" in k && a in k.AA ? k.AA[a] : ""
            }
        }
        var e, f, g = a("core/Plugins/Form/service/PDFFormField"),
            h = a("core/Plugins/Form/service/PDFFormControl"),
            i = a("core/Plugins/Form/service/PDFFormConstants").fieldType,
            j = a("core/Plugins/Form/service/PDFFormConstants").actionFlag;
        b.init = function(a, b) {
            e = a, f = new d(b), WebPDF.FormPlugin.form = f
        }, b.loadForm = function() {/*
            if (!e.isOffline()) try {
                $.ajax({
                    url: e.getBaseUrl() + "asserts/" + e.getFileID() + "/form/fields?" + Math.random(),
                    type: "GET",
                    async: !1,
                    success: function(a) {
                        if ((!a || "isUser" in a && "1" !== a.isUser) && WebPDF.Engine.JR) {
                            var b = WebPDF.ViewerInstance.getDataControl(),
                                c = {
                                    type: "getFields",
                                    success: function(a) {
                                        a.fields && f.load(JSON.parse(a.fields))
                                    }
                                };
                            return void b.getFileds(c)
                        }
                        a && f.load(a)
                    },
                    error: function() {
                        console.log("form load failed")
                    }
                })
            } catch (a) {
                console.error(a)
            }*/
        }, b.getData = function() {
            return f.getData()
        }, b.exportXML = function(a) {
            return f.hasData() ? f.exportXML(a) : ""
        }, b.importXML = function(a) {
            return f.hasData() ? void f.importXML(a) : ""
        }, b.LoadPageControlsAP = function(a, b) {
            if (!f.hasData() || f.isPagaControlsLoaded(a)) return !0;
            var c;
            c = WebPDF.Engine.JR ? {
                type: "getPageControlsAP",
                data: {
                    pageIndex: a
                },
                success: function(a) {
                    var c = f.addPageControls(a.pageIndex, JSON.parse(a.contorlsAP)),
                        d = new Blob([a.imageUrl], {
                            type: "image/png"
                        });
                    c.bgUrl = URL.createObjectURL(d), b(a.pageIndex, c)
                }
            } : {
                url: e.getBaseUrl() + "asserts/" + e.getFileID() + "/controlsAP/" + a + "?" + Math.random(),
                type: "GET",
                success: function(c) {
                    var d = f.addPageControls(a, c);
                    d.bgUrl = e.getBaseUrl() + "asserts/" + e.getFileID() + "/controlsImage/" + a, b(a, d)
                },
                error: function() {
                    console.log("form failed")
                }
            };
            var d = WebPDF.ViewerInstance.getDataControl();
            return d.getPageControlsAP(c), !1
        }, b.getPageControls = function(a) {
            return f.getPageControls(a)
        }, b.release = function() {
            f.release()
        }
    }), define("core/Plugins/Form/service/PDFFormField", ["core/Plugins/Form/service/PDFFormConstants"], function(a, b, c) {
        function d(a, b, c) {
            _form = a, this.index = parseInt(c);
            var d = b;
            this.getObjNum = function() {
                return parseInt(d.on)
            }, this.getControl = function(a) {
                if ("Kids" in d) {
                    var b = parseInt(d.Kids[a]);
                    return _form.getControlByObjNum(b)
                }
                return _form.getControlByObjNum(this.getObjNum())
            }, this.hasKids = function() {
                return "Kids" in d
            }, this.getKidsCount = function() {
                return d.Kids ? d.Kids.length : 1
            }, this.getButtonValue = function(a) {
                if ("undefined" == typeof a) {
                    if (d.Opt)
                        for (var b = 0; b < d.Opt.length; b++)
                            if (d.onNames[b] === d.V) return d.Opt[b];
                    return d.V
                }
                if (!d.Opt) return a;
                var c = d.Opt.indexOf(a);
                return d.onNames[c] ? d.onNames[c] : a
            }, this.getDefaultValue = function() {
                return d.DV
            }, this.setDefaultValue = function(a) {
                d.DV = a
            }, this.getValue = function() {
                if ("V" in d) return d.V;
                if ("DV" in d) return d.V;
                var a = this.getType();
                return a === f.RadioButton || a === f.CheckBox ? "Off" : ""
            }, this.setValue = function(a, b, c) {
                var e = this.getType();
                if (e === f.Text) {
                    var g = d.V ? d.V : "";
                    if (d.V = a, g === d.V) return _form.updateFieldsValue(this, c, !0), !1
                } else if (e === f.RadioButton || e === f.CheckBox)
                    if (b) {
                        var h = b.getAS();
                        if (e === f.RadioButton && "Off" !== h) return !1;
                        for (var i in b.getAP("N"))
                            if (h !== i) {
                                b.setAS(i);
                                break
                            }
                        d.V = b.getAS()
                    } else {
                        if (e === f.RadioButton && "Off" === a) return !1;
                        d.V = a ? a : "Off"
                    }
                else(e === f.ComboBox || e === f.ListBox) && (d.V = a);
                return _form.updateFieldsValue(this, c), _form.clearCalculating(), !0
            }, this.getType = function() {
                return d.FT
            }, this.getAlign = function() {
                return d.Q
            }, this.getFontSize = function() {
                return d.FS
            }, this.getFontColor = function() {
                var a = parseInt(d.FRG).toString(16);
                for (a.length > 6 && (a = a.substr(2)); a.length < 6;) a += "0";
                return d.FRG ? "#" + a : "#000000"
            }, this.getAction = function() {
                return d.A
            }, this.getAAction = function(a) {
                return "AA" in d && d.AA && a in d.AA ? d.AA[a] : null
            }, this.getDepends = function() {
                var a = this.getAAction("C");
                return a && "JS" === a.S ? (WebPDF.JSEngine.clearEnv(), WebPDF.JSEngine.extractDependencies(a.JS)) : []
            }, this.getTitle = function() {
                return d.T
            }, this.getOptions = function() {
                return d.Opt
            }, this.setBGColor = function(a) {
                if (d.MK = d.MK || {}, "transparent" !== a) {
                    var b = a.match(/rgb\((\d*),(\d*),(\d*)\)/);
                    d.MK.BG = parseInt(b[1]).toString(16) + parseInt(b[2]).toString(16) + parseInt(b[3]).toString(16)
                } else delete d.MK.BG;
                _form.notifier("CC", this, null, {
                    BG: a
                })
            }, this.getMaxLen = function() {
                return d.MaxLen || -1
            }, this.focus = function() {
                var a = this.getControl(this.getKidsCount() - 1);
                _form.notifier("FO", this, a)
            }, this.isReadOnly = function() {
                return WebPDF.FormPlugin.isReadOnly() ? !0 : d.Ff & g.ReadOnly
            }, this.setReadOnly = function(a) {
                this.isReadOnly() !== a && (a ? d.Ff = d.Ff | g.ReadOnly : d.Ff = d.Ff & ~g.ReadOnly, _form.notifier("FC", this, null, {
                    readOnly: a
                }))
            }, this.isRequired = function() {
                return d.Ff & g.Required
            }, this.setRequired = function(a) {
                this.isRequired() !== a && (a ? d.Ff = d.Ff | g.Required : d.Ff = d.Ff & ~g.Required, _form.notifier("FC", this, null, {
                    required: a
                }))
            }, this.isTextMultiLine = function() {
                return d.Ff & g.MultiLine
            }, this.setTextMultiLine = function(a) {
                this.isTextMultiLine() !== a && (a ? d.Ff = d.Ff | g.MultiLine : d.Ff = d.Ff & ~g.MultiLine, _form.notifier("FC", this, null, {
                    multiline: a
                }))
            }, this.isComb = function() {
                return d.Ff & g.Comb || 1 === d.comb
            }, this.InUnison = function() {
                return d.Ff & g.InUnison
            }, this.isPassword = function() {
                return d.Ff & g.Password
            }, this.notExport = function() {
                return d.Ff & g.NoExport
            }, this.isCombEditable = function() {
                return d.Ff & g.Edit
            }, this.isHidden = function() {
                return 2 & d.F || 1 & d.F
            }, this.setHidden = function(a) {
                "Off" === a && (a = !0), a ? (d.F = -2 & d.F, d.F = -33 & d.F, d.F = 6 | d.F) : (d.F = -2 & d.F, d.F = -3 & d.F, d.F = -33 & d.F, d.F = 4 | d.F), _form.notifier("FC", this, null, {
                    hidden: a
                })
            }
        }
        var e = a("core/Plugins/Form/service/PDFFormConstants"),
            f = e.fieldType,
            g = e.fieldFlag;
        b.Field = d
    }), define("core/Plugins/Form/service/PDFFormControl", [], function(a, b, c) {
        function d(a, b, c) {
            var d = a,
                e = b,
                f = c;
            this.getAction = function() {
                return f.A ? f.A : e.A ? e.A : null
            }, this.getField = function() {
                return e
            }, this.getObjNum = function() {
                return f.on
            }, this.getAlign = function() {
                var a;
                return a = f.Q ? parseInt(f.Q) : parseInt(e.getAlign()), 2 === a ? "right" : 1 === a ? "center" : "left"
            }, this.getRect = function() {
                return f.Rect
            }, this.getAS = function() {
                return f.AS
            }, this.setAS = function(a) {
                f.AS = a
            }, this.getAP = function(a) {
                switch (a) {
                    case "N":
                        return f.AP.N;
                    case "D":
                        return f.AP.D;
                    case "R":
                        return f.AP.R
                }
                return null
            }, this.getExportValue = function() {
                for (var a in f.AP.N)
                    if ("off" !== a) return a
            }, this.getRotate = function() {
                return f.MK && f.MK.R ? f.MK.R / 90 : 0
            }, this.getBorderWidth = function() {
                var a = 1;
                return "BS" in f && "W" in f.BS && (a = f.BS.W), a
            }, this.getBorderStyle = function() {
                var a = "solid";
                return "BS" in f && "S" in f.BS && ("D" === f.BS.S && (a = "dashed"), "C" === f.BS.S && (a = "cloudy")), a
            }, this.getBorderColor = function() {
                var a = "transparent";
                if ("MK" in f && null != f.MK)
                    if ("object" == typeof f.MK) a = "#" + f.MK.BC;
                    else {
                        var b = d.getDirect(f.MK);
                        b && (a = "#" + b.BC)
                    }
                return a
            }, this.getBGColor = function() {
                return f.MK && "transparent" === f.MK.BG ? "transparent" : f.MK && f.MK.BG ? "#" + f.MK.BG : "transparent"
            }, this.getAAction = function(a) {
                var b;
                return "AA" in f && f.AA && a in f.AA ? (b = f.AA[a], b ? b : e.getAAction(a)) : null
            }, this.getPage = function() {
                return f.P
            }, this.getExportValue = function() {
                for (var a in f.AP.N)
                    if ("Off" !== a) return a;
                return "Yes"
            }, this.invisible = function() {
                return 1 & f.F
            }, this.isPrinted = function() {
                return 4 & f.F
            }, this.isHidden = function() {
                return 2 & f.F
            }, this.noView = function() {
                return 32 & f.F
            }
        }
        b.Control = d
    }), define("core/Plugins/Form/view/formViewer", ["core/Plugins/Form/view/baseControlView", "core/Common/Math/Rect", "core/WebPDF", "core/Plugins/Form/service/PDFFormConstants"], function(a, b, c) {
        var d, e, f, g = a("core/Plugins/Form/view/baseControlView"),
            h = a("core/Plugins/Form/service/PDFFormConstants").fieldType,
            i = function(a) {
                function b(a) {
                    f = a
                }
                d = a, e = this, this.focusControlID = "", this.tabIndex = 1, this.getControlsHTML = function(a, b, c, d, e) {
                    for (var f = "", h = b.Controls.length - 1; h >= 0; h--) {
                        var i = b.Controls[h],
                            j = i.getField();
                        if (!j.isHidden()) {
                            if (e) {
                                if (e && !i.isPrinted()) continue
                            } else {
                                if (i.invisible()) continue;
                                if (i.noView()) continue
                            }
                            var k = g.createFieldview(j, i, this.tabIndex);
                            f += k.getHTML(a, c, b.w, b.h, e), d && d.push(k), this.tabIndex++
                        }
                    }
                    return b.scale = a.getScale(), f
                }, this.renderControls = function(a, c, d) {
                    var e = [],
                        f = this.getControlsHTML(a, c, d, e, null),
                        g = a.getPageIndex(),
                        h = "docViewer_ViewContainer_PageContainer_" + g + "_formWidgets";
                    $("#" + h).remove();
                    var i = $("#docViewer_ViewContainer_PageContainer_" + g);
                    i.append("<div id = " + h + ">" + f + "</div>");
                    for (var j = e.length - 1; j >= 0; j--) {
                        var k = e[j];
                        k.bindEvent(WebPDF.FormPlugin.isHighlight, b), k.bindForegroundEvent(WebPDF.FormPlugin.isHighlight, b)
                    }
                    return WebPDF.Tool.getReaderApp().isOffline() && $("#" + h).hide(), c.Controls.length
                }, this.regenerateHTML = function(a, c) {
                    var d = g.createFieldview(a, c, this.tabIndex++),
                        e = c.getPage(),
                        f = WebPDF.Tool.readerApp.getDocView().getPageView(e),
                        h = d.getHTML(f, null, 0, 0, null),
                        i = "docViewer_ViewContainer_PageContainer_" + e + "_formWidgets";
                    $("#" + i).append(h), d.bindEvent(WebPDF.FormPlugin.isHighlight, b), d.bindForegroundEvent(WebPDF.FormPlugin.isHighlight, b)
                }, this.updateControl = function(a, b, c, d) {
                    var i, j, k = g.genDomID(b, c),
                        l = "WebPDFSelector",
                        m = b ? b.getType() : 0,
                        n = 1;
                    if ("VC" === a) {
                        var o = WebPDF.Tool.readerApp.getDocView().getPageView(c.getPage()).getScale(),
                            p = d;
                        switch (m) {
                            case h.Text:
                                if (b.isComb() && -1 != b.getMaxLen()) {
                                    for (var q = p; q.length < b.getMaxLen();) q += " ";
                                    for (var r = 0; r < q.length; r++) $($("#container_" + k + " .fwr-field-comb")[r]).html(q[r]);
                                    $("#container_" + k + " .fwr-field-comb").css("display", "block"), $("#" + k).css("display", "none")
                                }
                                $("#" + k).val(p);
                                break;
                            case h.RadioButton:
                            case h.CheckBox:
                                $("#" + k).css("left", "-" + o * p + "px"), WebPDF.Environment.safari && 1 === b.getKidsCount() && (WebPDF.FormPlugin.disableAction(), $("#" + k).blur(), $("#" + k).focus(), WebPDF.FormPlugin.enableAction());
                                break;
                            case h.ComboBox:
                                l = "#input_" + k + " .comboOption", $("#" + k).val(p);
                            case h.ListBox:
                                "WebPDFSelector" === l && (l = "#" + k + " .listOption");
                                var s = $(l);
                                s.removeClass("fwr-form-listitem-selected");
                                for (var t = s.length - 1; t >= 0; t--) {
                                    var u = $(s[t]);
                                    if (u.attr("realvalue") === p) {
                                        u.addClass("fwr-form-listitem-selected");
                                        break
                                    }
                                }
                        }
                    } else if ("FC" === a)
                        for (b.hasKids() && (n = b.getKidsCount()), i = 0; n > i; i++) c = b.getControl(i), k = g.genDomID(c.getField(), c), 0 === $("#" + k).length && e.regenerateHTML(b, c), "hidden" in d && (d.hidden ? ($("#fg_" + k).hide(), $("#" + k).hide()) : ($("#fg_" + k).show(), $("#" + k).show())), "multiline" in d && ($("#" + k).parent().remove(), e.regenerateHTML(b, c)), "readOnly" in d && (d.readOnly ? ($("#fg_" + k).css("display", "none").removeClass("fwr-field-RW").addClass("fwr-field-RO"), b.getType() === h.Text ? document.getElementById(k).readOnly = !0 : b.getType() === h.ListBox && $("#" + k).css("overflow-y", "hidden")) : ($("#fg_" + k).css("display", "block").removeClass("fwr-field-RO").addClass("fwr-field-RW"), b.getType() === h.Text ? document.getElementById(k).readOnly = !1 : b.getType() === h.ListBox && $("#" + k).css("overflow-y", "auto"))), "required" in d && (j = d.required ? "rgb(255,0,0)" : WebPDF.FormPlugin.convertColor(WebPDF.FormPlugin.highlightColor(), "HTML"), $("#fg_" + k).css("background-color", j), $("#fg_" + k).removeClass("fwr-form-field-highlight").addClass("fwr-form-require-field-highlight"));
                    else if ("CC" === a)
                        for (n = 1, b.hasKids() && (n = b.getKidsCount()), i = 0; n > i; i++) c = b.getControl(i), k = g.genDomID(b, c), 0 !== $("#" + k).length && (j = d.BG, d.BG && $("#" + k).css("background-color", j), d.BC && $("#" + k).css("color", j));
                    else if ("IMPORT" === a)
                        for (var v = 0; v < $(".fwr-field-list").length; v++) {
                            var w = $($(".fwr-field-list").get(v)),
                                x = w.children(".fwr-form-listitem-selected");
                            if (x.length) {
                                var y = x.position().top;
                                w.parent().scrollTop(y)
                            }
                        } else "FO" === a && (f && (f.blur(), f = null), $("#" + k).focus())
                }, this.pageToScale = {}, this.zoomEvent = function(a, b) {
                    var c = a.getDocView(),
                        d = c.getPageCount();
                    this.pageToScale = {};
                    for (var e = 0; d > e; e++) $("#" + c.getPageViewContainerID(e)).parent().hasClass("fwr-page-invisible") ? this.pageToScale[e] = e : this.scalePageControls(e, b.newScale)
                }, this.scalePageControls = function(b, c) {
                    var d = WebPDF.Tool.readerApp.getDocView(),
                        e = d.getPageView(b),
                        f = "FitPage" === c ? e.getScale() : c,
                        h = a.getPageControls(b);
                    if (h) {
                        for (var i = {
                                oldScale: h.scale,
                                newScale: f
                            }, j = 0; j < h.Controls.length; j++) {
                            var k = h.Controls[j],
                                l = k.getField();
                            g.createFieldview(l, k, this.tabIndex).zoom(e, i, h.w, h.h)
                        }
                        h.scale = f
                    }
                }, this.adjustContorlPosition = function(a, b) {
                    a in this.pageToScale && (this.scalePageControls(a, b), delete this.pageToScale[a])
                }, this.clearData = function() {
                    this.pageToScale = {}
                }, this.highlightForm = function(a) {
                    a ? ($(".fwr-form-field-highlight.fwr-field-RW").css("display", "block"), $(".fwr-form-require-field-highlight.fwr-field-RW").css("display", "block")) : ($(".fwr-form-field-highlight.fwr-field-RW").css("display", "none"), $(".fwr-form-require-field-highlight.fwr-field-RW").css("display", "none"))
                }, this.switchHighlightColor = function(a) {
                    var b = WebPDF.FormPlugin.convertColor(a, "HTML");
                    $(".fwr-form-field-highlight").css("background-color", b)
                }
            };
        b.createFormViewer = function(a) {
            var b = new i(a);
            return b
        }
    }), define("core/Plugins/Form/view/baseControlView", ["core/Common/Math/Rect", "core/WebPDF", "core/Plugins/Form/service/PDFFormConstants"], function(a, b, c) {
        function d(a, b) {
            return a && b ? "fieldObjNum_" + a.getObjNum() + "_controlObjNum_" + b.getObjNum() : ""
        }

        function e(a, b, c) {
            this.bSupported = !0, this.field = a, this.control = b, this.domID = d(a, b), l = this, this.tabIndex = c, this.getBorder = function(a) {
                var b = this.control.getBorderStyle(),
                    c = this.control.getBorderWidth() * a,
                    d = this.control.getBorderColor(),
                    e = "none; ";
                return 0 === c && d && (c = a), d && (e = parseInt(1.333 * c + .5) + "px " + b + " " + d), e
            }, this.getDisplayFontSize = function(b, c) {
                var d, e = 1.333 * this.field.getFontSize();
                return d = 0 === e ? b - 4 : e * c + .5, a.getType() === n.Text && a.isTextMultiLine() && (d = 0 === e ? 16 * c : e * c), a.getType() === n.ListBox && (d = 0 === e ? 16 * c : e * c * 1.3333), parseInt(d)
            }, this.getHTML = function(b, c, d, e, f) {
                if (!this.bSupported) return "";
                var g = this.control.getRect(),
                    h = f ? f.scale : b.getScale(),
                    i = new m(g[0], g[1], g[2], g[3]),
                    j = b.pdfRectToDeviceRect(i, !f);
                f && (j.left *= h, j.right *= h, j.top *= h, j.bottom *= h);
                var k = "";
                null != this.field.getValue() && (k = WebPDF.FormPlugin.runFormatJS(this.field, this.control, !0));
                var l = parseInt(j.bottom - j.top + .5),
                    o = parseInt(j.right - j.left + .5),
                    p = '<div id="container_{id}" style="left:{left}px;top:{top}px;width:{width}px;height:{height}px;position:absolute;background-image:none;overflow:hidden;background-color:#0;">';
                p = p.format({
                    id: this.domID,
                    left: j.left,
                    top: j.top,
                    width: o,
                    height: l
                });
                var q = b.getPDFPage().getPageRotate() - this.control.getRotate();
                q = 0 > q ? q + 4 : q;
                var r = o,
                    s = l;
                q % 2 !== 0 && (r = l, s = o);
                var t = this.getInputHTML(h, j.left, j.top, r, s, q, k),
                    u = '<div id="fg_{id}" class="{hightlightClass}" style="z-index:4;position:absolute;width:{width}px;height:{height}px; padding: 0px;cursor:{cursor};background-color:{bg};display:{display}"></div>';
                if (a.getType() === n.PushButton) u = "";
                else {
                    var v = this.field.isRequired(a.Ff) ? "fwr-form-require-field-highlight" : "fwr-form-field-highlight",
                        w = this.field.getType() === n.Text ? "text" : "pointer",
                        x = this.field.isReadOnly() || this.control.isHidden() || f ? "none" : "block";
                    v += this.field.isReadOnly() ? " fwr-field-RO" : " fwr-field-RW", u = u.format({
                        id: this.domID,
                        hightlightClass: v,
                        width: o,
                        height: l,
                        cursor: w,
                        display: x,
                        bg: this.field.isRequired(a.Ff) ? "rgb(255,0,0)" : WebPDF.FormPlugin.convertColor(WebPDF.FormPlugin.highlightColor(), "HTML")
                    })
                }
                return p + this.getBGHtml(c, d, e, h, k) + u + t + "</div>"
            }, this.getImagePos = function() {
                return 0
            }, this.getInputHTML = function() {
                return ""
            }, this.getBGHtml = function() {
                return ""
            }, this.bindForegroundEvent = function(a) {
                $("#fg_" + this.domID).on("click touchend", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    var b = a.target.id.substring(3);
                    a.data.field.getType() === n.Text && a.data.field.isComb() && $("#" + b).css("display", "block"), $("#" + b).focus();
                    var c = "mousedown",
                        d = "mouseup",
                        e = a.clientX,
                        f = a.clientY;
                    WebPDF.Tool.getReaderApp().isMobile() && (c = "touchstart", d = "touchend", a.originalEvent.changedTouches && (e = a.originalEvent.changedTouches[0].clientX, f = a.originalEvent.changedTouches[0].clientY)), $("#" + b).trigger(c, {
                        X: e,
                        Y: f
                    }), $("#" + b).trigger(d, {
                        X: e,
                        Y: f
                    })
                }), this.field.getType() !== n.Text && this.field.getType() !== n.ComboBox && $("#" + this.domID).off("focus").on("focus", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    if (!a.data.field.isReadOnly()) {
                        var b = d(a.data.field, a.data.control);
                        $("#fg_" + b).css("display", "none"), WebPDF.FormPlugin.doAction("focus", a.data.field, a.data.control)
                    }
                }).off("blur").on("blur", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    b.data.field.isReadOnly() || (a() && $("#fg_" + d(b.data.field, b.data.control)).css("display", "block"), WebPDF.FormPlugin.doAction("blur", b.data.field, b.data.control))
                })
            }, this.bindEvent = function() {}, this.zoom = function(a, b, c, d) {
                var e = this.control.getRect(),
                    f = 90 * (a.getPDFPage().getPageRotate() - this.control.getRotate());
                f = 0 > f ? f + 360 : f;
                var g = new m(e[0], e[1], e[2], e[3]),
                    h = a.pdfRectToDeviceRect(g, !0),
                    i = parseInt(h.bottom - h.top + .5),
                    j = parseInt(h.right - h.left + .5);
                $("#container_" + this.domID).css({
                    left: h.left,
                    top: h.top,
                    width: j,
                    height: i
                }), $("#fg_" + this.domID).css({
                    width: j,
                    height: i
                }), this.scaleInput({
                    bgWidth: c,
                    bgHeight: d,
                    width: j,
                    height: i,
                    left: h.left,
                    top: h.top,
                    pdfRotate: f
                }, b)
            }, this.scaleInput = function(a, b) {
                $("#" + this.domID).css({
                    width: a.bgWidth * b.newScale,
                    height: a.bgHeight * b.newScale,
                    left: -this.getImagePos(b.newScale)
                })
            }
        }

        function f() {
            this.getImagePos = function(a) {
                return this.control.getAP("N") * a
            }, this.getBGHtml = function(a, b, c, d) {
                b *= d, c *= d;
                var e = this.field.isReadOnly() ? "" : "cursor:pointer;",
                    f = '<img class="fwr-form-image fwr-form-widget" src="{src}" id="{id}" name="{name}" style="left:-{left}px;top:0px;position:absolute;padding:0;width:{width}px;height:{height}px;{cursor}{zindex}display:{display};" ondragstart="return false" tabindex="{tabOrder}"/>';
                return f.format({
                    name: this.field.getTitle(),
                    src: a,
                    id: this.domID,
                    left: this.getImagePos(d),
                    width: b,
                    height: c,
                    cursor: e,
                    tabOrder: this.tabIndex,
                    zindex: this.field.isReadOnly() ? "z-index:2;" : "",
                    display: this.control.isHidden() ? "none" : "block"
                })
            }, this.bindEvent = function() {
                function a(a, b) {
                    if (null != a.control.getAP(b)) {
                        var c = WebPDF.Tool.readerApp.getDocView().getScale(),
                            e = "-" + a.control.getAP(b) * c + "px";
                        $("#" + d(a.field, a.control)).css("left", e)
                    }
                }
                $("#" + this.domID).off("mousedown").on("mousedown", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    b.data.field.isReadOnly() || (a(b.data, "D"), WebPDF.FormPlugin.doAction("mousedown", b.data.field, b.data.control))
                }).off("mouseover").on("mouseover", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    b.data.field.isReadOnly() || (a(b.data, "R"), WebPDF.FormPlugin.doAction("mouseover", b.data.field, b.data.control))
                }).off("mouseup").on("mouseup", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    b.data.field.isReadOnly() || (a(b.data, "N"), WebPDF.FormPlugin.doAction("mouseup", b.data.field, b.data.control))
                }).off("mouseout").on("mouseout", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    b.data.field.isReadOnly() || (a(b.data, "N"), WebPDF.FormPlugin.doAction("mouseout", b.data.field, b.data.control))
                })
            }
        }

        function g() {
            this.getImagePos = function(a) {
                var b = this.control.getAS(),
                    c = this.control.getAP("N")[b] * a;
                return c
            }, this.getBGHtml = function(a, b, c, d) {
                b *= d, c *= d;
                var e = this.field.isReadOnly() ? "" : "cursor:pointer;",
                    f = '<img class="fwr-form-image fwr-form-widget" src="{src}" id="{id}" name="{name}" style="left:-{left}px;top:0px;position:absolute;padding:0;width:{width}px;height:{height}px;{cursor}{zindex}display:{display};background-color:{bg}" ondragstart="return false" tabindex="{tabOrder}"/>';
                return f.format({
                    name: this.field.getTitle(),
                    src: a,
                    id: this.domID,
                    left: this.getImagePos(d),
                    width: b,
                    height: c,
                    cursor: e,
                    bg: this.control.getBGColor(),
                    tabOrder: this.tabIndex,
                    zindex: this.field.isReadOnly() ? "z-index:2;" : "",
                    display: this.control.isHidden() ? "none" : "block"
                })
            }, this.bindEvent = function(a, b) {
                $("#" + this.domID).off("mousedown").on("mousedown", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    a.data.field.isReadOnly() || WebPDF.FormPlugin.doAction("mousedown", a.data.field, a.data.control)
                }).off("mouseup").on("mouseup", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    a.data.field.isReadOnly() || (a.data.field.setValue("", a.data.control, !0), WebPDF.FormPlugin.doAction("mouseup", a.data.field, a.data.control))
                }).off("focus").on("focus", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    if (!a.data.field.isReadOnly()) {
                        var c = d(a.data.field, a.data.control);
                        $("#fg_" + c).css("display", "none"), b($("#" + c)), WebPDF.FormPlugin.doAction("focus", a.data.field, a.data.control)
                    }
                }).off("blur").on("blur", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    a.data.field.isReadOnly() || ($("#fg_" + d(a.data.field, a.data.control)).css("display", "block"), WebPDF.FormPlugin.doAction("blur", a.data.field, a.data.control))
                })
            }
        }

        function h() {
            this.getImagePos = function(a) {
                var b = this.control.getAS(),
                    c = this.control.getAP("N")[b] * a;
                return c
            }, this.getBGHtml = function(a, b, c, d) {
                b *= d, c *= d;
                var e = this.field.isReadOnly() ? "" : "cursor:pointer;",
                    f = '<img class="fwr-form-image fwr-form-widget" src="{src}" id="{id}" name="{name}" style="left:-{left}px;top:0px;position:absolute;padding:0;width:{width}px;height:{height}px;{cursor}{zindex}display:{display};background-color:{bg}" ondragstart="return false" tabindex="{tabindex}"/>';
                return f.format({
                    name: this.field.getTitle(),
                    src: a,
                    id: this.domID,
                    left: this.getImagePos(d),
                    width: b,
                    height: c,
                    cursor: e,
                    bg: this.control.getBGColor(),
                    tabindex: this.tabIndex,
                    zindex: this.field.isReadOnly() ? "z-index:2;" : "",
                    display: this.control.isHidden() ? "none" : "block"
                })
            }, this.bindEvent = function() {
                $("#" + this.domID).off("mousedown").on("mousedown", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    a.data.field.isReadOnly() || WebPDF.FormPlugin.doAction("mousedown", a.data.field, a.data.control)
                }).off("mouseup").on("mouseup", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    a.data.field.isReadOnly() || (a.data.field.setValue("", a.data.control, !0), WebPDF.FormPlugin.doAction("mouseup", a.data.field, a.data.control))
                })
            }
        }

        function i() {
            function a(a, b, c) {
                return $("#fontsizeCalculator").css("font-size", a - 1), $("#fontsizeCalculator").width() < b && $("#fontsizeCalculator").height() < c ? !0 : ($("#fontsizeCalculator").css("font-size", a), !1)
            }
            this.getInputHTML = function(a, b, c, d, e, f, g) {
                d = parseInt(d), e = parseInt(e);
                var h = this.field.isReadOnly() ? 'readonly="1"' : "",
                    i = this.field.isPassword() ? "password" : "text",
                    j = "";
                1 === f ? j = "left:" + e + "px;" : 3 === f ? j = "top:" + d + "px;" : 2 === f && (j = "top:" + e + "px;left:" + d + "px;");
                var k;
                if (this.field.isTextMultiLine()) k = '<textarea class="fwr_form_textarea_none_border fwr-form-text fwr-form-widget" id="{id}" name="{name}" style="box-sizing:border-box;resize:none;overflow-y:auto;{rotatePos};width:{width}px;max-width:{width}px;height:{height}px;max-height:{height}px;font-size:{fontSize}px;color:{color};background-color:{bgColor};padding:0;text-align:{align}; -webkit-user-select: auto;position:absolute;transform:rotate({rotate}deg);transform-origin:0 0;border:{border};box-sizing:border-box;{zindex}display:{display};" {readOnly} tabindex="{tabindex}" multiline="1">{value}</textarea>', k = k.format({
                    id: this.domID,
                    name: this.field.getTitle(),
                    rotatePos: j,
                    width: d,
                    height: e,
                    fontSize: this.getDisplayFontSize(e, a),
                    color: this.field.getFontColor(),
                    bgColor: this.control.getBGColor(),
                    align: this.control.getAlign(),
                    value: g,
                    tabindex: this.tabIndex,
                    readOnly: h,
                    rotate: 90 * f,
                    border: this.getBorder(a),
                    zindex: this.field.isReadOnly() ? "z-index:2;" : "",
                    display: this.control.isHidden() ? "none" : "block"
                });
                else {
                    var l = this.field.getMaxLen(),
                        m = e;
                    if (this.field.isComb() && g && 0 !== g.length && (m = e / g.length), k = '<input type="{type}" class="fwr-form-widget" id="{id}" name="{name}" style="{rotatePos};width:{width}px;max-width:{width}px;height:{height}px;max-height:{height}px;line-height:{height}px;font-size:{fontSize}px;color:{color};background-color:{bgColor};padding:0;text-align:{align}; -webkit-user-select: auto;position:absolute;transform:rotate({rotate}deg);transform-origin:0 0;border:{border};box-sizing:border-box;display:{display};{zindex}" {maxLength} tabindex="{tabindex}"  {readOnly} value="{value}" >', k = k.format({
                            type: i,
                            rotatePos: j,
                            id: this.domID,
                            name: this.field.getTitle(),
                            width: d,
                            height: e,
                            fontSize: this.getDisplayFontSize(m, a),
                            color: this.field.getFontColor(),
                            align: this.control.getAlign(),
                            value: g,
                            tabindex: this.tabIndex,
                            readOnly: h,
                            rotate: 90 * f,
                            border: this.getBorder(a),
                            zindex: this.field.isReadOnly() ? "z-index:2;" : "",
                            maxLength: -1 === l ? "" : 'maxlength="' + this.field.getMaxLen() + '"'
                        }), this.field.isComb() && -1 !== this.field.getMaxLen()) {
                        for (var n = this.field.getMaxLen(), o = e, p = d / n, q = '<input type="text" class="fwr-field-comb" style="width:{width}px;font-size:{fontSize}px;height:{height}px;border:{border};box-sizing: border-box;position: absolute;{combRotatePos};cursor:text;z-index: 3;background-color:{bgColor};color:{color};transform-origin:0 0;transform:rotate({rotate}deg);text-align:center;display:{display};" readonly="1" value={value}></input>'; g.length < n;) g += " ";
                        for (var r = 0; n > r; r++) {
                            var s = "left:" + r * p + "px";
                            1 === f ? s = "left:" + e + "px;top:" + p * r + "px;" : 3 === f ? s = "top:" + d * (n - r) / n + "px;" : 2 === f && (s = "left:" + d * (n - r) / n + "px;top:" + e + "px;"), k += q.format({
                                width: p,
                                height: o,
                                bgColor: this.control.getBGColor(),
                                border: this.getBorder(a),
                                fontSize: this.getDisplayFontSize(o, a),
                                value: g[r],
                                color: this.field.getFontColor(),
                                combRotatePos: s,
                                rotate: 90 * f,
                                display: this.control.isHidden() ? "none" : "block"
                            })
                        }
                        k = k.format({
                            display: "none",
                            bgColor: "rgb(255,255,255)"
                        })
                    } else k = k.format({
                        display: this.control.isHidden() ? "none" : "block",
                        bgColor: this.control.getBGColor()
                    });
                    k += "</input>"
                }
                return k
            }, this.bindEvent = function(a) {
                $("#container_" + this.domID + " .fwr-field-comb").on("click touchend", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    if (!a.data.field.isReadOnly()) {
                        var b = d(a.data.field, a.data.control);
                        a.data.field.getType() === n.Text && a.data.field.isComb() && $("#" + b).css("display", "block"), $("#" + b).focus(), $("#" + b).trigger("mousedown", {
                            X: a.clientX,
                            Y: a.clientY
                        }), $("#" + b).trigger("mouseup", {
                            X: a.clientX,
                            Y: a.clientY
                        })
                    }
                }), $("#" + this.domID).off("focus").on("focus", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    if (!a.data.field.isReadOnly()) {
                        var b = d(a.data.field, a.data.control);
                        WebPDF.FormPlugin.doAction("focus", a.data.field, a.data.control), a.data.field.isComb() && $("#container_" + b + " .fwr-field-comb").css("display", "none"), $("#fg_" + b).css("display", "none"), $("#" + b).css("z-index", "999"), $("#" + b).val(a.data.field.getValue()), a.data.setFocusField && a.data.setFocusField($("#" + b))
                    }
                }).off("blur").on("blur", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    if (!b.data.field.isReadOnly()) {
                        var c = d(b.data.field, b.data.control);
                        a() && $("#fg_" + c).css("display", "block");
                        var e = {
                            value: $("#" + c).val()
                        };
                        if (WebPDF.FormPlugin.doAction("validate", b.data.field, b.data.control, e), e.hasAction ? b.data.field.setValue(WebPDF.FormPlugin.getJSResult(), b.data.control, !0) : b.data.field.setValue($("#" + c).val(), b.data.control, !0), WebPDF.FormPlugin.doAction("blur", b.data.field, b.data.control), $("#" + c).css("z-index", "3"), b.data.field.isComb() && -1 != b.data.field.getMaxLen()) {
                            for (var f = $("#" + c).val(), g = 0; g < f.length; g++) $($("#container_" + c + " .fwr-field-comb")[g]).val(f[g]);
                            $("#container_" + c + " .fwr-field-comb").css("display", "block"), $("#" + c).css("display", "none")
                        }
                    }
                }).off("change").on("change", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    return WebPDF.FormPlugin.doAction("change", a.data.field, a.data.control), !0
                })
            }, this.scaleInput = function(a, b) {
                var c = a.width,
                    d = a.height,
                    e = 0,
                    f = 0,
                    g = b.newScale,
                    h = a.width,
                    i = a.height,
                    j = this.field.getMaxLen(),
                    k = this.getBorder(g),
                    l = i,
                    m = !1;
                switch (a.pdfRotate % 360) {
                    case 90:
                        f = c, m = !0;
                        break;
                    case 180:
                        e = d, f = c;
                        break;
                    case 270:
                        e = d, m = !0
                }
                if (m && (h = a.height, i = a.width), this.field.isComb()) {
                    for (var n = h / j, o = 0; j > o; o++) {
                        var p = 0,
                            q = n * o;
                        switch (a.pdfRotate % 360) {
                            case 90:
                                p = n * o, q = i;
                                break;
                            case 180:
                                p = i, q = n * (j - o);
                                break;
                            case 270:
                                q = 0, p = n * (j - o)
                        }
                        var r = $($("#container_" + this.domID + " .fwr-field-comb")[o]),
                            s = parseInt(r.css("font-size")),
                            t = b.newScale / b.oldScale;
                        r.css({
                            width: n,
                            height: i,
                            "font-size": s * t + "px",
                            border: k,
                            top: p,
                            left: q
                        })
                    }
                    l = i / $("#" + this.domID).val().length
                }
                $("#" + this.domID).css({
                    width: h,
                    height: i,
                    "max-height": i,
                    "max-width": h,
                    "font-size": this.getDisplayFontSize(l, g),
                    border: k,
                    top: e,
                    left: f
                })
            }, this.adjustFontSize = function() {
                var b = $("#" + this.domID).width(),
                    c = $("#" + this.domID).height(),
                    d = 2 * parseInt($("#" + this.domID).css("font-size")),
                    e = 0;
                if ($("#fontsizeCalculator").html($("#" + this.domID).val()), $("#fontsizeCalculator").css("font-size", d), !($("#fontsizeCalculator").width() < b && $("#fontsizeCalculator").height() < c))
                    for (;;)
                        if ($("#fontsizeCalculator").width() > b || $("#fontsizeCalculator").height() > c) {
                            if (d = (d + e) / 2, $("#fontsizeCalculator").css("font-size", d), a(d, b, c)) return void $("#" + this.domID).css("font-size", d - 1)
                        } else if (e = (d + e) / 2, $("#fontsizeCalculator").css("font-size", e), a(e, b, c)) return void $("#" + this.domID).css("font-size", e - 1)
            }
        }

        function j() {
            this.getInputHTML = function(a, b, c, d, e, f, g) {
                d = parseInt(d), e = parseInt(e);
                var h = "",
                    i = "left:{left}px;top:{top}px;transform-origin:0 0;".format({
                        left: b,
                        top: c + e
                    }),
                    j = .9 * (d - 10),
                    k = .5 * (e - 10),
                    l = 10 * a;
                1 === f ? (h = "left:" + e + "px;transform-origin:0 0;", i = "left:{left}px;top:{top}px;transform-origin:0 0;".format({
                    left: b,
                    top: c
                }), j = .7 * (e - l), k = .9 * (d - l)) : 2 === f ? (h = "", i = "left:{left}px;top:{top}px;transform-origin:0 0;".format({
                    left: b + d,
                    top: c
                }), j = .2 * (d - l), k = .5 * (e - l)) : 3 === f && (h = "top:" + d + "px;transform-origin:0 0;", i = "left:{left}px;top:{top}px;transform-origin:0 0;".format({
                    left: b + e,
                    top: c + d
                }), j = .6 * (e - l), k = .2 * (d - l));
                var m = '</div><div id="input_{id}" style="{rotatePos};width:{width}px;background-color: rgb(255, 255, 255); overflow: auto; display: none;cursor: pointer;border: 1px solid rgb(110, 163, 196);box-sizing:border-box;position:absolute;max-height:300px;font-size:16px;z-index:4;transform: rotate({rotate}deg);z-index:5;overflow-y:auto;">';
                m = m.format({
                    id: this.domID,
                    left: b,
                    rotatePos: i,
                    width: d,
                    rotate: 90 * f
                });
                var n = '<div id="opt_{i}{id}" style="overflow: hidden;display: block;width:100%;" class="comboOption fwr_form_combobox_item {selectedClass}" {selected} tabindex="{tabIndex}" realvalue="{realValue}">{displayValue}</div>',
                    o = g,
                    p = this.field.getOptions();
                if (p)
                    for (var q = !1, r = 0; r < p.length; r++) {
                        var s, t, u = "",
                            v = "";
                        "string" == typeof p[r] ? (s = t = p[r], p[r] !== this.field.getValue() || q || (u = 'selected="1"', v = " fwr-form-listitem-selected", q = !0, o = t)) : "object" == typeof p[r] && (s = p[r][0], t = p[r][1], p[r][0] !== this.field.getValue() || q || (u = 'selected="1"', v = " fwr-form-listitem-selected", q = !0, o = t)), m += n.format({
                            i: r,
                            id: this.domID,
                            selectedClass: v,
                            selected: u,
                            realValue: s,
                            displayValue: t,
                            tabindex: this.tabIndex
                        })
                    }
                var w = this.field.isReadOnly() ? "" : "cursor:pointer",
                    x = '<input class="fwr-form-widget" type="text" id="{id}" name="{name}" style="position:absolute;{rotatePos};width:{width}px;height:{height}px;line-height:{height}px;background-image:url(about:blank);font-size:{fontsize}px;color:{color};background-color:{background-color};padding:0;border:{border};box-sizing:border-box;{cursor};transform:rotate({rotate}deg);" tabindex="{tabindex}" value="{value}" {readOnly} /><div id="drop_{id}" style="position:absolute;left:{dropleft}px;top:{dropTop}px;float:right;transform: rotate({rotate}deg);transform-origin:0 0;width:0px;height: 0px;border-top:10px solid black;border-bottom:10px solid rgba(0, 0, 0, 0);border-left: 5px solid rgba(0, 0, 0, 0);border-right:5px solid rgba(0, 0, 0, 0);display:{display};{zindex}"></div>';
                return x = x.format({
                    name: this.field.getTitle(),
                    id: this.domID,
                    fontsize: this.getDisplayFontSize(e, a),
                    color: this.field.getFontColor(),
                    "background-color": this.control.getBGColor(),
                    dropleft: j,
                    rotatePos: h,
                    dropTop: k,
                    width: d,
                    height: e,
                    value: o,
                    readOnly: this.field.isCombEditable() ? "" : 'readonly="readonly"',
                    tabindex: this.tabIndex,
                    cursor: w,
                    border: this.getBorder(a),
                    rotate: 90 * f,
                    zindex: this.field.isReadOnly() ? "z-index:2;" : "z-index:3;",
                    display: this.control.isHidden() ? "none" : "block"
                }), x + m
            }, this.bindEvent = function(a) {
                $("#" + this.domID).off("focus").on("focus", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    if (!a.data.field.isReadOnly()) {
                        var b = d(a.data.field, a.data.control);
                        $("#fg_" + b).css("display", "none"), a.data.setFocusField && a.data.setFocusField($("#" + b)), WebPDF.FormPlugin.doAction("focus", a.data.field, a.data.control)
                    }
                }).off("mouseup touchend").on("mouseup touchend", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    if (!a.data.field.isReadOnly()) {
                        var b = d(a.data.field, a.data.control);
                        a.data.field.isReadOnly() || $("#input_" + b).css("display", "block"), WebPDF.FormPlugin.doAction("mouseup", a.data.field, a.data.control), o = 0
                    }
                }).off("mousedown touchstart").on("mousedown touchstart", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    a.data.field.isReadOnly() || (WebPDF.FormPlugin.doAction("mousedown", a.data.field, a.data.control), o = 1)
                }).off("blur").on("blur", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    if (!b.data.field.isReadOnly()) {
                        var c = d(b.data.field, b.data.control);
                        b.data.field.setValue($("#" + c).val(), b.data.control, !0), $("#input_" + c).css("display", "none"), a() && $("#fg_" + c).css("display", "block"), WebPDF.FormPlugin.doAction("blur", b.data.field, b.data.control)
                    }
                }), $("#input_" + this.domID).off("click").on("click", function() {
                    return !1
                }).off("mousedown touchstart").on("mousedown touchstart", function() {
                    return !1
                }).off("mouseup touchend").on("mouseup touchend", function() {
                    return !1
                }), $("#input_" + this.domID + " .comboOption").off("click touchend").on("click touchend", {
                    control: this.control,
                    field: this.field
                }, function(b) {
                    if (o && WebPDF.Tool.getReaderApp().isMobile()) return void(o = 0);
                    if (!b.data.field.isReadOnly()) {
                        var c = d(b.data.field, b.data.control);
                        b.data.field.setValue($("#" + b.target.id).attr("realvalue"), b.data.control, !1), $("#" + c).val(WebPDF.Common.htmlDecode($("#" + b.target.id).html()));
                        var e = "#input_" + c + " .comboOption",
                            f = $(e);
                        f.removeClass("fwr-form-listitem-selected"), $("#" + b.target.id).addClass("fwr-form-listitem-selected"), $("#input_" + c).hide(), a() && $("#fg_" + c).show()
                    }
                }).off("mousedown").on("mousedown", function() {
                    return !1
                })
            }, this.scaleInput = function(a, b) {
                var c = a.width,
                    d = a.height,
                    e = 0,
                    f = 0,
                    g = b.newScale,
                    h = a.width,
                    i = a.height,
                    j = !1,
                    k = 0,
                    l = 0;
                switch (a.pdfRotate % 360) {
                    case 90:
                        f = c, j = !0;
                        break;
                    case 180:
                        l = h;
                        break;
                    case 270:
                        e = d, k = h, l = i, j = !0;
                        break;
                    case 0:
                        k = i
                }
                j && (h = a.height, i = a.width);
                var m = this.getBorder(g),
                    n = this.domID;
                $("#" + n).css({
                    width: h,
                    height: i,
                    "max-height": i,
                    "max-width": h,
                    "font-size": this.getDisplayFontSize(i, g),
                    border: m,
                    left: f,
                    top: e
                });
                var o = 10 * g + "px",
                    p = 5 * g + "px",
                    q = $("#drop_" + n).css(["left", "top"]);
                $("#drop_" + n).css({
                    left: parseFloat(q.left) * b.newScale / b.oldScale + "px",
                    top: parseFloat(q.top) * b.newScale / b.oldScale + "px",
                    "border-top": o + " solid black",
                    "border-bottom": o + " solid rgba(0, 0, 0, 0)",
                    "border-left": p + " solid rgba(0, 0, 0, 0)",
                    "border-right": p + " solid rgba(0, 0, 0, 0)"
                }), $("#input_" + n).css({
                    left: a.left,
                    top: a.top,
                    "margin-top": k,
                    "margin-left": l,
                    width: h,
                    "font-size": 16 * g
                })
            }
        }

        function k() {
            this.getInputHTML = function(a, b, c, d, e, f) {
                d = parseInt(d), e = parseInt(e);
                var g = $("#opt_0_" + this.domID).height(),
                    h = this.control.getBorderWidth() * a;
                0 !== $("#" + this.domID).length && 0 !== $("#opt_0_" + this.domID).length;
                var i = "";
                1 === f ? i = "left:" + e + "px;transform-origin:0 0;" : 3 === f && (i = "top:" + d + "px;transform-origin:0 0;");
                var j = this.field.isReadOnly() ? "" : "cursor:pointer",
                    k = '<div id="{id}" name="{name}" style="{rotatePos};height:{height}px;width:{width}px;background-color:rgb(255, 255, 255);overflow-x:hidden;overflow-y: {overflow};display:block;position:absolute;font-size:{fontsize}px;color:{color};display:{display};border:{border};box-sizing:border-box;{cursor};transform:rotate({rotate}deg);{zindex}" class="fwr-form-widget" tabindex="{tabindex}"><div id="opts_{id}" style="position:absolute;top:{offset}px;width:100%;" class="fwr-field-list">';
                k = k.format({
                    name: this.field.getTitle(),
                    fontsize: this.getDisplayFontSize(e, a),
                    rotate: 90 * f,
                    rotatePos: i,
                    color: this.field.getFontColor(),
                    height: e,
                    width: d,
                    overflow: "auto",
                    id: this.domID,
                    tabindex: this.tabIndex,
                    cursor: j,
                    border: this.getBorder(a),
                    zindex: this.field.isReadOnly() ? "z-index:2;" : "",
                    display: this.control.isHidden() ? "none" : "block"
                });
                var l = this.field.getOptions(),
                    m = this.field.getValue();
                if (l)
                    for (var n = 0; n < l.length; n++) {
                        var o, p, q = "",
                            r = "";
                        "string" == typeof l[n] ? (o = p = l[n], l[n] === m && (q = 'selected="1"', r = " fwr-form-listitem-selected")) : "object" == typeof l[n] && (o = l[n][0], p = l[n][1], l[n][0] === m && (q = 'selected="1"', r = " fwr-form-listitem-selected"));
                        var s = '<div id="opt_{index}_{id}" style="overflow: hidden;display: block;width:100%;z-index:33;" class="listOption {selectedClass}" {selected} realvalue="{realValue}">{displayValue}</div>';
                        k += s.format({
                            index: n,
                            id: this.domID,
                            selectedClass: r,
                            selected: q,
                            realValue: o,
                            displayValue: p
                        })
                    }
                var t = null != g ? e - 2 * h - (l.indexOf(m) + 1) * g * a : 0;
                return t > 0 && (t = 0), k = k.format({
                    offset: t
                }), k += "</div></div>"
            }, this.scrollToSelected = function() {
                $("#" + this.domID).css("overflow-y", this.field.isReadOnly() ? "hidden" : "auto");
                var a = $("#opts_" + this.domID).children(".fwr-form-listitem-selected");
                if (a.length) {
                    var b = a.position().top;
                    $("#" + this.domID).scrollTop(b)
                }
            }, this.bindEvent = function() {
                this.scrollToSelected(), $("#" + this.domID).off("mousedown touchstart").on("mousedown touchstart", {
                    control: this.control,
                    field: this.field
                }, function(a) {
                    return a.data.field.isReadOnly() ? void 0 : (WebPDF.FormPlugin.doAction("mousedown", a.data.field, a.data.control), !1)
                }).off("mouseup touchend").on("mouseup touchend", {
                    control: this.control,
                    field: this.field
                }, function(a, b) {
                    if (!a.data.field.isReadOnly()) {
                        WebPDF.FormPlugin.doAction("mouseup", a.data.field, a.data.control);
                        var c = d(a.data.field, a.data.control);
                        b || (b = WebPDF.Tool.getReaderApp().isMobile() ? {
                            X: a.originalEvent.changedTouches ? a.originalEvent.changedTouches[0].clientX : 0,
                            Y: a.originalEvent.changedTouches ? a.originalEvent.changedTouches[0].clientY : 0
                        } : {
                            X: a.clientX,
                            Y: a.clientY
                        });
                        for (var e = WebPDF.Tool.readerApp.getDocView(), f = 90 * e.getPageView(0).getPDFPage().getPageRotate() + e.getRotate(), g = $("#" + c + " .listOption"), h = g.length - 1; h >= 0; h--) {
                            var i = $(g[h]),
                                j = i.offset(),
                                k = f % 180 !== 0 ? i.height() : i.width(),
                                l = f % 180 !== 0 ? i.width() : i.height();
                            if (j.left <= b.X && b.X <= j.left + k && j.top <= b.Y && b.Y <= j.top + l) {
                                a.data.field.setValue(i.attr("realvalue"), a.data.control, !0);
                                break
                            }
                        }
                        return !1
                    }
                })
            }, this.scaleInput = function(a, b) {
                var c = 0,
                    d = 0,
                    e = b.newScale,
                    f = a.width,
                    g = a.height;
                switch (a.pdfRotate % 360) {
                    case 90:
                        f = a.height, g = a.width, d = g;
                        break;
                    case 270:
                        f = a.height, g = a.width, c = f
                }
                var h = this.getBorder(e),
                    i = this.domID;
                $("#" + i).css({
                    width: f,
                    height: g,
                    "max-height": g,
                    "max-width": f,
                    "font-size": this.getDisplayFontSize(g, e),
                    border: h,
                    left: d,
                    top: c
                }), $("#input_" + i).css({
                    left: a.left,
                    top: a.top,
                    "margin-top": a.height,
                    width: a.width,
                    "font-size": this.getDisplayFontSize(a.height, e)
                }), this.scrollToSelected()
            }
        }
        var l, m = a("core/Common/Math/Rect"),
            n = a("core/Plugins/Form/service/PDFFormConstants").fieldType,
            o = 0;
        b.genDomID = d, b.createFieldview = function(a, b, c) {
            var d = new e(a, b, c),
                l = a.getType();
            return l === n.ComboBox ? j.call(d) : l === n.ListBox ? k.call(d) : l === n.Text || l === n.File ? i.call(d) : l === n.RadioButton ? g.call(d) : l === n.CheckBox ? h.call(d) : l === n.PushButton ? f.call(d) : d.bSupported = !1, d
        }
    }), define("core/Plugins/TextSelection/TextSelectComponent", ["core/Plugins/TextSelection/TextSelectToolHandler", "core/Plugins/TextSelection/TextSelectView", "core/Plugins/TextSelection/TextSelectService", "core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect", "core/Plugins/Text/PDFTextPage", "core/Plugins/TextSelection/PDFTextPageSelect"], function(a, b, c) {
        function d(b) {
            a("core/Plugins/TextSelection/TextSelectToolHandler");
            var c, d = a("core/Plugins/TextSelection/TextSelectView").createTextSelectView(b),
                e = a("core/Plugins/TextSelection/TextSelectService").createTextSelectService(b),
                f = WebPDF.Tools.TextSelectToolHandler;
            d.initView(), $(b).on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
                c.init(), d.clearData()
            }).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function() {
                b.getMainView() && (e.highLightAllSelectedText(d.highlightSelectedText()), d.hideSelectionOperationDiv())
            }).on(WebPDF.EventList.DOCVIEW_PRE_RESIZE, function() {
                b.getMainView() && (e.highLightAllSelectedText(d.highlightSelectedText()), d.hideSelectionOperationDiv())
            }).on(WebPDF.EventList.PAGE_SHOW_COMPLETE, function(a, b) {
                if (null != b.pageView) {
                    var c = this.getTextManager();
                    null != c && c.ajaxGetTextPage(b.pageView.getPageIndex(), !0)
                }
            }).on(WebPDF.EventList.OFFLINEMODE_CHANGED, function(a, b) {
                var c = this.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                c && c.reloadSelectMenu()
            }), this.getTextSelectView = function() {
                return d
            }, this.createTextSelectToolHandler = function() {
                return c = new f(b, d, e), b.registerToolHandler(c), c
            }
        }
        var e = null;
        b.createTextSelectComponent = function(a) {
            return e || (e = new d(a), a.setTextSelectCompoment(e)), e
        }
    }), define("core/Plugins/TextSelection/TextSelectToolHandler", [], function(a, b, c) {
        return WebPDF.TextSelectMenu = {
            COPY: 1,
            HIGHLIGHT: 2,
            UNDERLINE: 4,
            STRIKEOUT: 8,
            SQUIGGLY: 16,
            REPLACE: 32,
            INSERT: 64
        }, WebPDF.Tools.TextSelectToolHandler = function(a, b, c) {
            function d(b) {
                if ("Copy" == b) {
                    var d = h.getSelectedText(),
                        e = j.get(b),
                        i = {};
                    if (apiConfig && apiConfig.text && "object" == typeof apiConfig.text.getCopyCount ? i = apiConfig.text.getCopyCount : apiConfig && apiConfig.text && "function" == typeof apiConfig.text.getCopyCount ? i = apiConfig.text.getCopyCount() : console.error("apiConfig.text.getCopyCount format error,mush object or function"), i = i ? i : {}, i.url && "" != i.url) {
                        var l = "";
                        WebPDF.AccountInstance && (l = WebPDF.AccountInstance.getUserId()), $.extend(!0, i, {
                            params: {
                                userId: l,
                                fileId: f.getFileID(),
                                copyCount: d.length
                            }
                        });
                        var m = {
                                params: JSON.stringify(i)
                            },
                            n = a.getBaseUrl() + "rest";
                        $.ajax({
                            url: n,
                            dadaType: "json",
                            headers: {},
                            data: m,
                            success: function(a) {
                                if (!a || !a.data) return console.error("failed to get copy count!"), !1;
                                var b = a.data.copyCount ? a.data.copyCount : 0,
                                    c = a.data.remainingCount ? a.data.remainingCount : 0,
                                    f = d.substr(0, b);
                                return $.isFunction(e) && e(f, c), !0
                            },
                            error: function() {
                                return console.error("failed to get copy count!"), !1
                            }
                        })
                    } else $.isFunction(e) ? e(d) : WebPDF.TextSelectMenu.COPY & k && WebPDF.copyText(f, c.getSelectedText())
                } else if ("Highlight" == b) {
                    if (WebPDF.TextSelectMenu.HIGHLIGHT & k) {
                        var o = f.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_HIGHTLIGHT);
                        o.createAnnot(), f.getMainView().getDocView().setModified(!0)
                    }
                } else if ("Underline" == b) {
                    if (WebPDF.TextSelectMenu.UNDERLINE & k) {
                        var p = f.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_UNDERLINE);
                        p.createAnnot(), f.getMainView().getDocView().setModified(!0)
                    }
                } else if ("Strikeout" == b) {
                    if (WebPDF.TextSelectMenu.STRIKEOUT & k) {
                        var p = f.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_STRIKEOUT);
                        p.createAnnot(), f.getMainView().getDocView().setModified(!0)
                    }
                } else if ("Squiggly" == b) {
                    if (WebPDF.TextSelectMenu.SQUIGGLY & k) {
                        var p = f.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY);
                        p.createAnnot(), f.getMainView().getDocView().setModified(!0)
                    }
                } else if ("Replace" == b) {
                    if (WebPDF.TextSelectMenu.REPLACE & k) {
                        var q = f.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_REPLACE);
                        q.createAnnot(), f.getMainView().getDocView().setModified(!0)
                    }
                } else if ("Insert" == b && WebPDF.TextSelectMenu.INSERT & k) {
                    var q = f.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_COMMENT_CARET);
                    q.createAnnot(), f.getMainView().getDocView().setModified(!0)
                }
                h.clearSelection(), g.setTextCursor()
            }
            WebPDF.Tools.TOOL_NAME_SELECTTEXT = "Select Text";
            var e = WebPDF.CMap,
                f = a,
                g = b,
                h = c,
                i = !1,
                j = new e,
                k = g.getTextSelectMenuState();
            this.onInit = function() {
                g.setViewCallback(h.setViewCallback)
            }, this.init = function() {
                this.clearData(), g.createTextSelectMenu()
            }, this.onDestroy = function() {
                this.clearData()
            }, this.reloadSelectMenu = function(a) {
                g.reloadTextSelectMenu()
            }, this.clearData = function() {
                g.removeTextSelectMenu(), h.clearData()
            }, this.getTextSelectService = function() {
                return h
            }, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_SELECTTEXT
            }, this.onActivate = function() {
                g.setTextCursor(), $(".fwr_link_annot").removeClass("fwr-annot")
            }, this.onDeactivate = function() {
                h.clearSelection(), $(".fwr_link_annot").addClass("fwr-annot")
            }, this.isProcessing = function() {
                return i
            }, this.onLButtonDown = function(a) {
                return i = !0, g.processLButtonDown(a, h.onLButtonDown)
            }, this.onLButtonUp = function(a) {
                return i = !1, g.processLButtonUp(a, h.onLButtonUp)
            }, this.onLButtonDblClk = function(a) {
                return g.processLButtonDblClk(a, h.onLButtonDblClk)
            }, this.onMouseMove = function(a) {
                return g.processMouseMove(a, h.onMouseMove)
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return h.isSelected() ? g.processRButtonUp(a, h.onRButtonUp) : !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onDoubleTap = function(a) {
                return !1
            }, this.onPinchIn = function(a) {
                return !1
            }, this.onPinchOut = function(a) {
                return !1
            }, this.onContextMenu = function(a) {
                g.processContextMenu(a, d)
            }, this.onHold = function(a) {
                return g.processHold(a, h.onHold)
            }, this.addListener = function(a, b) {
                j.put(a, b)
            }, this.setMenuState = function(a, b) {
                b ? k |= a : k &= ~a, g.setTextSelectMenuState(k)
            }
        }, WebPDF.Event.TextSelectToolHandler
    }), define("core/Plugins/TextSelection/TextSelectView", [], function(a, b, c) {
        function d(a, b) {
            D = a, C = this, _menuItems = 127
        }

        function e() {
            try {
                x || (x = document.createElement("iFrame"), x.id = D.getAppId() + "-copy-frame", x.className = "fwr-copy-frame", $("body").append(x), $("#" + x.id).off("load").on("load", function() {
                    x.contentWindow.title = "Reading View.", y = !0
                }))
            } catch (a) {
                console.error(a)
            }
        }

        function f(a) {
            if (!x.contentWindow) return void console.warn("Cannot focus the copy frame's window, because it's null. Copy frame load status = " + y + ".");
            $(x.contentWindow.document.body).empty().append("<p>" + a + "</p>");
            try {
                if (x.contentWindow.focus(), "undefined" != typeof window.getSelection) {
                    var b = x.contentWindow.getSelection();
                    b.removeAllRanges(), b.selectAllChildren(x.contentWindow.document.body)
                } else "undefined" != typeof document.execCommand && x.contentWindow.document.execCommand("SelectAll")
            } catch (c) {
                console.error(c)
            }
        }

        function g(a, b) {
            if (null != a) try {
                var c = a.attr("menuname");
                b(c)
            } catch (d) {}
        }

        function h(a, b) {
            if (!b) return !1;
            var c = D.getMainView().getDocView(),
                d = $("#" + c.getDocViewContainerID()),
                e = d.height(),
                f = d.width() - 16,
                g = d.offset(),
                h = c.getScrollApi();
            h && (f -= h.getScrollBarWidth(), e -= h.getScrollBarHeight());
            var i = new F(g.left, g.top, g.left + f, g.top + e);
            if (E.normalize(i), E.ptInRect(i, a)) return !1;
            var j = 0,
                k = 0,
                l = 20;
            return a.x < i.left && (j = -l), a.y < i.bottom && (k = -l), a.x > i.right && (j = l), a.y > i.top && (k = l), c.movePage(j, k), !0
        }

        function i() {
            var a = D.getMainView();
            if (a) {
                var b = a.getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                c.css({
                    cursor: "text"
                })
            }
        }

        function j(a, b, c) {
            var d = $("#fwr-textSelect-context-menu");
            d.css("visibility", "visible");
            var e = 0;
            d.css({
                left: a,
                top: b
            });
            var f = $(window).height(),
                g = $(window).width(),
                h = $("#" + p(c)).find(".fwr-text-highlight"),
                i = h.height(),
                j = h.width(),
                k = h.offset().top,
                l = h.offset().left,
                m = d.width(),
                n = d.height(),
                o = l + j / 2 - m / 2;
            d.css({
                left: o
            }), 0 > o && d.css({
                left: 0
            }), o + m > g && (e = g - m, d.css({
                left: e
            }));
            var q = !1;
            n > k && (e = k + i + 20, d.css({
                top: e
            }), d.addClass("triangle-up").removeClass("triangle-down"), q = !0), !q && k + i + n > f && (e = k - n - 20, d.css({
                top: e
            }), d.addClass("triangle-down").removeClass("triangle-up"), q = !0), !q && k > n && f > k + i + n && (e = k - n, d.css({
                top: e
            }), d.addClass("triangle-down").removeClass("triangle-up"), q = !0);
            var r = d.offset().top,
                s = parseFloat(d.css("top"));
            if (0 > r || r + n > f) {
                var t = n - (f - s),
                    u = c.getDocView().getScrollApi(),
                    v = u.getContentPositionY();
                u.scrollTo(0, v), v = t + v, u.scrollTo(0, v), s -= t, d.css({
                    top: s
                })
            }
        }

        function k() {
            if (!A) {
                var a = D.getMainView().getDocView(),
                    b = a.getPageView(0),
                    c = $("#" + a.getDocViewContainerID()),
                    d = a.getDocViewContainerID() + "_text_bound_select",
                    e = "<div class='fwr-text-bound-selection fwr-hidden' id='" + d + "'></div>";
                null != b && b.isContentCreated() ? $("#" + b.getPageViewContainerID()).parent().parent().append(e) : c.append(e), A = $("#" + d)
            }
            return A
        }

        function l() {
            if (!z) {
                var a = D.getMainView().getDocView(),
                    b = a.getPageView(0),
                    c = $("#" + a.getDocViewContainerID()),
                    d = a.getDocViewContainerID() + "_selection_operation_bar";
                _copyBtnID = a.getDocViewContainerID() + "_selection_operation_copy";
                var e = "<div class='fwr-text-selection-operation-bar fwr-hidden' id='" + d + "'><ul><li ><a id='" + _copyBtnID + "' href='javascript:void(0);'>Copy</a></li></ul><div class='fwr-text-selection-operation-bar-right'/></div>";
                null != b && b.isContentCreated() ? $("#" + b.getPageViewContainerID()).parent().parent().append(e) : c.append(e), z = $("#" + d), $("#" + _copyBtnID).off("click").on("click", function() {
                    WebPDF.copyText(D, C.getSelectedText()) && C.hideSelectionOperationDiv()
                })
            }
            return z
        }

        function m() {
            var a = k();
            a.addClass("fwr-hidden")
        }

        function n(a, b) {
            var c = k(),
                d = Math.abs(b.x - a.x),
                e = Math.abs(b.y - a.y),
                f = null,
                g = null;
            if (0 !== d || 0 !== e) {
                b.x < a.x && b.y < a.y && (f = b.x, g = b.y), b.x > a.x && b.y < a.y && (f = a.x, g = b.y), b.x < a.x && b.y > a.y && (f = b.x, g = a.y), b.x > a.x && b.y > a.y && (f = a.x, g = a.y);
                var h = D.getMainView().getDocView(),
                    i = h.getDocViewClientRect(),
                    j = h.getScrollApi(),
                    l = 0,
                    m = 0;
                j && (l = j.getContentPositionX(), m = j.getContentPositionY()), f = f - i.left + l, g = g - i.bottom + m, c.css({
                    left: f,
                    top: g,
                    width: d,
                    height: e
                }).removeClass("fwr-hidden")
            }
        }

        function o(a, b) {
            if (!WebPDF.Environment.mobile) {
                var c = D.getMainView().getDocView(),
                    d = $("#" + c.getDocViewContainerID());
                switch (a) {
                    case WebPDF.TextSelection.CURSOR_STATE.CURSOR_ARROW:
                        d.removeClass(b).css({
                            cursor: "default"
                        });
                        break;
                    case WebPDF.TextSelection.CURSOR_STATE.CURSOR_SELECT:
                    case WebPDF.TextSelection.CURSOR_STATE.CURSOR_NORMAL:
                        d.removeClass(b).css({
                            cursor: "text"
                        });
                        break;
                    case WebPDF.TextSelection.CURSOR_STATE.CURSOR_BOUND:
                        d.addClass("fwr-bound-cursor"), b = "fwr-bound-cursor"
                }
                return b
            }
        }

        function p(a) {
            return a.getPageViewContainerID() + "_TextHighLights"
        }

        function q(a) {
            if (null != a && a.isContentCreated()) {
                WebPDF.Environment.mobile && $("#fwr-textSelect-context-menu").css({
                    visibility: "hidden"
                });
                var b = p(a),
                    c = $("#" + b);
                null != c && c.empty()
            }
        }

        function r() {
            C.hideSelectionOperationDiv();
            D.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT)
        }

        function s(a, b, c, d, e, f) {
            if (!a || !a.isContentCreated() || !b) return !1;
            var g = p(a),
                h = a.getPageIndex();
            if (!B[h]) {
                var i = "<div id='" + g + "' style='z-index:7;'></div>",
                    j = $("#" + a.getPageViewContainerID());
                j.append(i), B[h] = !0
            }
            var k = $("#" + g);
            k.empty();
            for (var l = "", m = null, n = null, o = 0; o < b.length; o++) {
                var q = b[o];
                E.normalize(q), q = a.pdfRectToDevice(q, !0), WebPDF.Environment.mobile && !c && (0 == o && (m = q), o == b.length - 1 && (n = q)), l += "<div id='text_highlight_" + h + "_" + o + "'class='fwr-text-highlight' style='left:" + q.left + "px;top:" + q.top + "px;width:" + E.width(q) + "px;height:" + E.height(q) + "px' ></div>"
            }
            if (WebPDF.Environment.mobile && !c && null != m && null != n) {
                var r = new F(m.left - 30, m.top - 30, m.right + 3, m.bottom + 3);
                E.normalize(r);
                var s = [];
                s.push(r);
                var t = new F(n.left - 3, n.top - 3, n.right + 30, n.bottom + 30);
                E.normalize(t);
                var u = [];
                u.push(t), l += "<div id='text_highlight_mobile_left" + h + "_" + o + "'class='fwr-text-highlight-mobile' style='left:" + m.left + "px;top:" + (m.top - 5) + "px;width:2px;height:" + (E.height(m) + 5) + "px' ></div>", l += "<div id='text-select-start' class='text-select' style='position: absolute; left:" + (m.left - 7) + "px;top:" + (m.top - 5 - 15) + "px;'><svg><use xlink:href='#icon-text-select'></use></svg></div>", l += "<div id='text_highlight_mobile_right" + h + "_" + o + "'class='fwr-text-highlight-mobile' style='left:" + n.right + "px;top:" + n.top + "px;width:2px;height:" + (E.height(n) + 5) + "px' ></div>", l += "<div id='text-select-end' class='text-select' style='position: absolute; left:" + (n.right - 7) + "px;top:" + (n.bottom + 4) + "px;'><svg><use xlink:href='#icon-text-select'></use></svg></div>", e(s, u), d(!0)
            }
            k.append(l), "" != l && $(".fwr-text-highlight").fwrContextMenu(w, {
                onSelect: function(a, b) {
                    var c = D.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                    return c ? c.onContextMenu($(this)) : void 0
                }
            }, document.getElementById(D.getMainFrameId()))
        }

        function t(a, b, c) {
            if (!a) return !1;
            var d = $("#" + a.getPageViewContainerID()).offset(),
                e = a.getPageViewHeight() + 14,
                f = new F(0, d.top, a.getDocView().getDocViewWidth(), d.top + e);
            return E.normalize(f), c.x = b.pageX - d.left, c.y = b.pageY - d.top, E.ptInRect(f, b.pageX, b.pageY)
        }
        var u, v = "fwr-textSelect-context-menu-container",
            w = "fwr-textSelect-context-menu",
            x = null,
            y = !1,
            z = null,
            A = null,
            B = {},
            C = null,
            D = null,
            E = WebPDF.RectUtils,
            F = WebPDF.PDFRect;
        d.prototype = {
            initView: function() {
                e()
            },
            setViewCallback: function(a) {
                a(o, s, n, m, f, r, q, h, j, i, t, g)
            },
            clearData: function() {
                WebPDF.Environment.mobile && $("#fwr-textSelect-context-menu").css({
                    visibility: "hidden"
                })
            },
            setTextCursor: function() {
                i()
            },
            removeTextSelectMenu: function() {
                $("#" + v).remove(), B = {}, A = null
            },
            getTextSelectMenuState: function() {
                return _menuItems
            },
            setTextSelectMenuState: function(a) {
                _menuItems = a, WebPDF.TextSelectMenu.COPY & _menuItems ? $("#copy_text").removeAttr("style") : $("#copy_text").css("color", "rgba(145,145,145,1)"), WebPDF.TextSelectMenu.HIGHLIGHT & _menuItems ? $("#highlight_annot").removeAttr("style") : $("#highlight_annot").css("color", "rgba(145,145,145,1)"), WebPDF.TextSelectMenu.UNDERLINE & _menuItems ? $("#underline_annot").removeAttr("style") : $("#underline_annot").css("color", "rgba(145,145,145,1)"), WebPDF.TextSelectMenu.STRIKEOUT & _menuItems ? $("#strikeout_annot").removeAttr("style") : $("#strikeout_annot").css("color", "rgba(145,145,145,1)"), WebPDF.TextSelectMenu.SQUIGGLY & _menuItems ? $("#squiggly_annot").removeAttr("style") : $("#squiggly_annot").css("color", "rgba(145,145,145,1)")
            },
            createTextSelectMenu: function() {
                var a = WebPDF.Config.Plugins.flag,
                    b = "fwr-cm-default",
                    c = "<li  class='separator'></li>",
                    d = "";
                WebPDF.Environment.mobile ? (b = "", c = "", d = "<div id='" + v + "' class='text-operation'><ul id='" + w + "'class='fwrContextMenu " + b + " text-operation triangle-down' style='visibility: hidden;position: absolute;z-index:9999;'></div>") : d = "<div id='" + v + "'><ul id='" + w + "'class='fwrContextMenu " + b + " fwr-text-selection-operation-bar' style='left: 341px; top: 167px; display: none;'></div>", $(document.body).append(d);
                var e = "";
                D.isCopyText() && (e += "<li id='copy_text'   style='' menuname='Copy'>" + i18n.t("CommandUI.Copy") + "</li>");
                var f = D.getOptions();
                f.plugins & a.Comments && !D.isReadOnly() && D.isAnnot() && (e = e + c + "<li id='highlight_annot'   style='' menuname='Highlight'>" + i18n.t("Annot.AnnotSubjHighlight") + "</li><li id='underline_annot'   style='' menuname='Underline'>" + i18n.t("Annot.AnnotSubjUnderline") + "</li><li id='strikeout_annot'   style='' menuname='Strikeout'>" + i18n.t("Annot.AnnotSubjStrikeout") + "</li><li id='squiggly_annot'   style='' menuname='Squiggly'>" + i18n.t("Annot.AnnotSubjSquiggly") + "</li>", WebPDF.Environment.mobile || (e += "<li id='replace_annot'   style='' menuname='Replace'>" + i18n.t("Annot.AnnotSubjReplace") + "</li><li id='insert_annot'   style='' menuname='Insert'>" + i18n.t("Annot.AnnotSubjCaret") + "</li>")), $("#" + w).append(e), this.setTextSelectMenuState(_menuItems)
            },
            reloadTextSelectMenu: function() {
                $("#" + w).empty();
                var a = "<li  class='separator'></li>",
                    b = WebPDF.Config.Plugins.flag,
                    c = "";
                D.isCopyText() && (c += "<li id='copy_text'   style='' menuname='Copy'>" + i18n.t("CommandUI.Copy") + "</li>");
                var d = D.getOptions();
                d.plugins & b.Comments && !D.isReadOnly() && D.isAnnot() && (c = c + a + "<li id='highlight_annot'   style='' menuname='Highlight'>" + i18n.t("Annot.AnnotSubjHighlight") + "</li><li id='underline_annot'   style='' menuname='Underline'>" + i18n.t("Annot.AnnotSubjUnderline") + "</li><li id='strikeout_annot'   style='' menuname='Strikeout'>" + i18n.t("Annot.AnnotSubjStrikeout") + "</li><li id='squiggly_annot'   style='' menuname='Squiggly'>" + i18n.t("Annot.AnnotSubjSquiggly") + "</li><li id='replace_annot'   style='' menuname='Replace'>" + i18n.t("Annot.AnnotSubjReplace") + "</li><li id='insert_annot'   style='' menuname='Insert'>" + i18n.t("Annot.AnnotSubjCaret") + "</li>"), $("#" + w).append(c), this.setTextSelectMenuState(_menuItems), $(".fwr-text-highlight").fwrContextMenu(w, {
                    onSelect: function(a, b) {
                        var c = D.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                        return c ? c.onContextMenu($(this)) : void 0
                    }
                }, document.getElementById(D.getMainFrameId()))
            },
            processLButtonDown: function(a, b) {
                var c = D.getMainView().getDocView(),
                    d = $("#" + c.getDocViewContainerID());
                return WebPDF.Common.containsNode(d.get(0), a.target, !0) ? (WebPDF.Environment.mobile && $("#fwr-textSelect-context-menu").css("display", "none"), b(a), !0) : !1
            },
            processLButtonUp: function(a, b) {
                return WebPDF.Environment.mobile && $("#fwr-textSelect-context-menu").css("display", "block"), b(a), !0
            },
            processLButtonDblClk: function(a, b) {
                var c = D.getMainView().getDocView(),
                    d = $("#" + c.getDocViewContainerID());
                return WebPDF.Common.containsNode(d.get(0), a.target, !0) ? (b(a), !0) : !1
            },
            processMouseMove: function(a, b) {
                return b(a), !0
            },
            processRButtonUp: function(a, b) {
                return b(a), !1
            },
            processContextMenu: function(a, b) {
                g(a, b)
            },
            processHold: function(a, b) {
                var c = D.getMainView().getDocView(),
                    d = $("#" + c.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(d.get(0), a.target, !0)) return !1;
                var e = a.srcEvent;
                a.srcEvent.touches && (e = a.srcEvent.touches[0]);
                var f = [$("#text-select-end"), $("#text-select-start")];
                for (var g in f) {
                    var h = f[g],
                        i = h.offset();
                    if (i && i.left < e.pageX && e.pageX < i.left + h.width() && i.top < e.pageY && e.pageY < i.top + h.height()) return !1
                }
                return b(e), !1
            },
            hideSelectionOperationDiv: function() {
                var a = l();
                a.addClass("fwr-hidden")
            },
            highlightSelectedText: function() {
                s()
            },
            setCursor: function(a) {
                o(a)
            },
            copyTextToFrame: function() {
                f()
            }
        }, b.createTextSelectView = function(a) {
            return null == u && (u = new d(a)), u
        }
    }), define("core/Plugins/TextSelection/TextSelectService", ["core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect", "core/Plugins/Text/PDFTextPage", "core/Plugins/TextSelection/PDFTextPageSelect"], function(a, b, c) {
        function d(a) {
            function b(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    if (!i.isEmpty(d) && i.ptInRect(d, a.x, a.y)) return !0
                }
                return !1
            }

            function c(a, b, c, d) {
                if (0 > c || 0 > d || -1 == a.index || -1 == b.index) return !1;
                var e, f, g, h, i, k = a.index < b.index ? !0 : !1;
                c > d && (e = c, c = d, d = e, i = !0);
                var l = j.clone(a),
                    m = j.clone(b);
                (i || c === d && l.index > m.index) && (e = l.index, l.index = m.index, m.index = e, e = l.bLeft, l.bLeft = m.bLeft, m.bLeft = e);
                var n = j.clone(u);
                u.length = 0;
                var o = n.length;
                for (h = 0; o > h; h++)
                    if (f = n[h], f > d || c > f) {
                        if (g = F.getTextPage(f), !g) return !1;
                        g.pageSelectInfo.clearSelectRect(), u.push(f)
                    }
                if (c != d) {
                    var p = F.getTextPage(c),
                        q = F.getTextPage(d);
                    if (!p || !q) return !1;
                    for (p.pageSelectInfo.addSelectedRectByIndex(l.bLeft ? l.index : l.index + 1, p.textPage.getSize() - 1), u.push(c), h = c + 1; d > h; h++) {
                        if (g = F.getTextPage(h), !g) return !1;
                        g.pageSelectInfo.selectAll(), g.pageSelectInfo.isSelected() && u.push(h)
                    }
                    return q.pageSelectInfo.addSelectedRectByIndex(0, m.bLeft ? m.index - 1 : m.index), u.push(d), u.length > 0
                }
                var r = l.index,
                    s = m.index;
                return l.index != m.index ? (0 == l.bLeft && r++, 1 == m.bLeft && s--, (g = F.getTextPage(c)) ? (g.pageSelectInfo.addSelectedRectByIndex(r, s, k), u.push(c), !0) : !1) : l.bLeft != m.bLeft ? (g = F.getTextPage(c)) ? (g.pageSelectInfo.addSelectedRectByIndex(l.index, m.index), u.push(c), !0) : !1 : 0 == n.length ? !1 : (g = F.getTextPage(c)) ? (g.pageSelectInfo.clearSelectRect(), u.push(c), !0) : !1
            }

            function d(a, b, c) {
                if (a.equal(b)) return 0 == u.length ? !1 : (e(), WebPDF.Environment.mobile && !P && r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), !1);
                var d = new g(0, 0),
                    f = new g(0, 0);
                d = s.devicePtToPDF(a), f = s.devicePtToPDF(b);
                var i = new h(d.x, d.y, f.x, f.y),
                    j = F.getTextPage(c);
                return j ? (j.pageSelectInfo.addSelectedRect(i), u.length = 0, u.push(c), !0) : !1
            }

            function e() {
                f(), V(), L = !1, M = [], N = [], O = !1, u = []
            }

            function f() {
                for (var a = r.getMainView().getDocView(), b = 0; b < u.length; b++) {
                    var c = u[b],
                        d = F.getTextPage(c);
                    d && (d.pageSelectInfo.clearSelectRect(), W(a.getPageView(c)))
                }
            }

            function p(a) {
                var b = Q(a, D);
                b && (D = b), A = a
            }

            function q(a, b, c, d, e) {
                var f = a.getMainView().getDocView(),
                    h = f.getVisiblePageRange(),
                    j = null,
                    k = new g(b.pageX, b.pageY),
                    l = f.getDocViewClientRect();
                if (!e && !i.ptInRect(l, k)) return j;
                for (var m, n = h.begin; n <= h.end; n++)
                    if (m = f.getPageView(n), null != m && _(m, b, c)) {
                        j = m;
                        break
                    }
                return !j && d && (m = f.getPageView(f.getCurPageIndex()), _(m, b, c), j = m), j
            }
            var r = a,
                s = null,
                t = [],
                u = [],
                v = !1,
                w = new g(0, 0),
                x = new g(0, 0),
                y = -1,
                z = m.SELECT_MODE_NORMAL,
                A = n.CURSOR_SELECT,
                B = !1,
                C = {},
                D = null,
                E = null,
                F = this,
                G = null,
                H = new k,
                I = new k,
                J = new g(0, 0),
                K = new g(0, 0),
                L = !1,
                M = [],
                N = [],
                O = !1,
                P = !1,
                Q = null,
                R = null,
                S = null,
                T = null,
                U = null,
                V = null,
                W = null,
                X = null,
                Y = null,
                Z = null,
                _ = null,
                aa = null;
            this.setViewCallback = function(a, b, c, d, e, f, g, h, i, j, k, l) {
                Q = a, R = b, S = c, T = d, U = e, V = f, W = g, X = h, Y = i, Z = j, _ = k, aa = l
            }, this.getTextPage = function(a) {
                var b = t[a];
                if (!b) {
                    var c = r.getTextManager().getTextPage(a, !1);
                    if (null != c) {
                        if (c.blocking) return null;
                        b = new o, b.textPage = c, b.pageSelectInfo.setTextPage(c), t[a] = b
                    }
                }
                return b
            }, this.clearData = function() {
                s = null, t = [], u = [], v = !1, w = new g(0, 0), x = new g(0, 0), y = -1, z = m.SELECT_MODE_NORMAL, A = n.CURSOR_SELECT, B = !1, C = {}, D = null, E = null, F = this, G = null, H = new k, I = new k, J = new g(0, 0), K = new g(0, 0), L = !1, M = [], N = [], O = !1, P = !1
            }, this.setMobileSelect = function(a) {
                L = a
            }, this.setMobileSelectRectArray = function(a, b) {
                M = a, N = b
            }, this.onLButtonDown = function(a) {
                if (a.target.id === E) return !1;
                if (P = !1, WebPDF.Environment.mobile) {
                    var d = r.getCurToolHandler().getName();
                    P = d == WebPDF.Tools.TOOL_NAME_COMMENT_HIGHTLIGHT || d == WebPDF.Tools.TOOL_NAME_COMMENT_UNDERLINE || d == WebPDF.Tools.TOOL_NAME_COMMENT_STRIKEOUT || d == WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY || d == WebPDF.Tools.TOOL_NAME_COMMENT_REPLACE
                }
                J.x = a.pageX, J.y = a.pageY;
                var f, h = new g(0, 0);
                if (f = q(r, a, h, !0, !1), !f) {
                    G = f;
                    var l = r.getMainView().getDocView(),
                        o = new g(a.pageX, a.pageY),
                        t = l.getDocViewClientRect();
                    return void(i.ptInRect(t, o) && (e(), WebPDF.Environment.mobile && !P && r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND)))
                }
                if (f.isPageLoaded()) {
                    j.preventDefaults(a, !0), B = !0;
                    var u = new g(0, 0);
                    u = f.devicePtToPDF(h);
                    var A = [],
                        C = f.getPageIndex(),
                        D = F.getTextPage(C);
                    if (D) {
                        D.pageSelectInfo.getSelectPDFRect(A);
                        var K = b(h, M);
                        if (K ? O = !0 : K = b(h, N), L && K) return z = m.SELECT_MODE_SELECTING, O && I.index < H.index ? I = H : !O && I.index > H.index && (I = H), y = s.getPageIndex(), !1;
                        if (WebPDF.Environment.mobile && !P) return e(), r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), !1;
                        if (b(u, A)) return z = m.SELECT_MODE_IN_SELECTED, void p(n.CURSOR_ARROW);
                        var Q, R = D.textPage.getCharIndexByPoint(u); - 1 != R && (Q = new k, D.textPage.getCaretAtPoint(u, Q), -1 == Q.index && (R = -1));
                        var S = a.altKey;
                        if (v && (e(), WebPDF.Environment.mobile && !P && r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), v = !1, H.index = -1), R >= 0 && !S) {
                            var T = a.shiftKey;
                            if (z = m.SELECT_MODE_SELECTING, p(n.CURSOR_SELECT), I.index < 0) {
                                if (s != f && (s = f), D.textPage.getCaretAtPoint(u, H), I = j.clone(H), y = s.getPageIndex(), H.index < 0) return
                            } else if (T) {
                                if (T) {
                                    if (-1 == I.index) return;
                                    Q = new k, D.textPage.getCaretAtPoint(u, Q), s != f && (s = f), H = Q, c(I, H, y, s.getPageIndex())
                                }
                            } else {
                                if (I.index < 0) return;
                                e(), WebPDF.Environment.mobile && !P && r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), Q = new k, D.textPage.getCaretAtPoint(u, Q), s != f && (s = f), H = Q, I = j.clone(H), y = s.getPageIndex()
                            }
                        } else e(), WebPDF.Environment.mobile && !P && r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), s = f, R >= 0 && (D.textPage.getCaretAtPoint(u, I), y = s.getPageIndex()), H.index = -1, w = x = h, z = m.SELECT_MODE_BOUND, p(n.CURSOR_BOUND)
                    }
                }
            }, this.onRButtonUp = function(a) {
                var c, d = new g(0, 0);
                if (c = q(r, a, d, !0, !1), !c) return !1;
                if (c.isPageLoaded()) {
                    var e = new g(0, 0);
                    e = c.devicePtToPDF(d);
                    var f = c.getPageIndex(),
                        h = F.getTextPage(f);
                    if (!h) return !1;
                    var i = [];
                    return h.pageSelectInfo.getSelectPDFRect(i), b(e, i)
                }
            }, this.onLButtonUp = function(a, c) {
                B = !1, T();
                var d, f = new g(0, 0);
                if (d = q(r, a, f, !0, !1), (d || (d = G)) && d.isPageLoaded()) {
                    if (WebPDF.Environment.mobile && !P) {
                        if (O = !1, r.isCopyText()) {
                            var h = r.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                            if (h && L) {
                                var i = a.pageX,
                                    j = a.pageY;
                                Y(i, j, d)
                            }
                        }
                        return !1
                    }
                    var k = new g(0, 0);
                    k = d.devicePtToPDF(f);
                    var l = d.getPageIndex(),
                        o = F.getTextPage(l);
                    if (!o) return !1;
                    var s = [];
                    o.pageSelectInfo.getSelectPDFRect(s);
                    var t = !1;
                    return t = L ? !(L && (b(f, M) || b(f, N))) : b(k, s), z == m.SELECT_MODE_IN_SELECTED && t && (P || !WebPDF.Environment.mobile) && e(), t && A != n.CURSOR_ARROW ? (p(n.CURSOR_ARROW), A = n.CURSOR_ARROW) : t || A == n.CURSOR_SELECT || p(n.CURSOR_SELECT), z = 0 == t && L ? m.SELECT_MODE_SELECTING : m.SELECT_MODE_NORMAL, F.highLightAllSelectedText(), P = !1, !0
                }
            }, this.getSelectedText = function() {
                for (var b = "", c = u.length, d = 0; c > d; d++) {
                    var e = u[d],
                        f = F.getTextPage(e);
                    f && f.textPage && (b += f.pageSelectInfo.getSelectedText(), d != c - 1 && (b += WebPDF.TEXT_RETURN_LINEFEED))
                }
                var g = '{"PageIndex":"' + u[c - 1] + '","Type":"text"}';
                return a.addRecord("Copy", "Copy", g), b
            }, this.getSelectedTextRectInfo = function() {
                for (var a = [], b = 0; b < u.length; b++) {
                    var c = u[b],
                        d = F.getTextPage(c);
                    if (d && d.pageSelectInfo.isSelected()) {
                        var e = [];
                        d.pageSelectInfo.getSelectPDFRect(e);
                        var f = new WebPDF.TextSelection.TextSelectedInfo;
                        f.pageIndex = c, f.selectedRectArray = e, a.push(f)
                    }
                }
                return a
            }, this.clearSelection = function() {
                e()
            }, this.highLightAllSelectedText = function() {
                for (var a = u.length, b = 0; a > b; b++) {
                    var c = u[b],
                        d = F.getTextPage(c);
                    if (d) {
                        var e = [];
                        d.pageSelectInfo.getSelectPDFRect(e), R(r.getMainView().getDocView().getPageView(c), e, P, this.setMobileSelect, this.setMobileSelectRectArray, this.onContextMenu)
                    }
                }
            }, this.highLightTextArea = function(a) {
                for (var b = a.length, c = 0; b > c; c++) {
                    var d = a[c],
                        e = F.getTextPage(d.pageIndex);
                    if (e) {
                        var f = [];
                        f = d.selectedRectArray, R(r.getMainView().getDocView().getPageView(d.pageIndex), f)
                    }
                }
            }, this.onActivate = function() {
                Z()
            }, this.onLButtonDblClk = function(a, b) {
                if (a && z !== m.SELECT_MODE_BOUND && !P) {
                    var c = null,
                        d = new g(0, 0);
                    if (c = q(r, a, d, !0, !1), c && c.isPageLoaded()) {
                        s = c;
                        var f = c.getPageIndex(),
                            h = F.getTextPage(f);
                        if (h) {
                            var i = new g(0, 0);
                            i = c.devicePtToPDF(d);
                            var n = h.textPage.getCharIndexByPoint(i);
                            if (-1 != n) {
                                var o = new k;
                                h.textPage.getCaretAtPoint(i, o), -1 == o.index && (n = -1)
                            }
                            if (-1 != n) {
                                var p = new l(-1, -1);
                                if (h.textPage.getWordRange(n, p)) {
                                    if (-1 === p.startIndex || -1 === p.endIndex) return;
                                    if (WebPDF.Environment.mobile) {
                                        var o = new k;
                                        h.textPage.getCaretByIndex(p.startIndex, o, !0), I = j.clone(o), h.textPage.getCaretByIndex(p.endIndex, o, !0), H = j.clone(o)
                                    }
                                    if (h.pageSelectInfo.addSelectedRectByIndex(p.startIndex, p.endIndex), u.length = 0, u.push(f), $.isFunction(b)) b(a);
                                    else {
                                        WebPDF.Environment.mobile && r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                                        var t = [];
                                        h.pageSelectInfo.getSelectPDFRect(t), U(F.getSelectedText()), F.highLightAllSelectedText()
                                    }
                                }
                            } else WebPDF.Environment.mobile && (e(), r.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND))
                        }
                    }
                }
            }, this.onMouseMove = function(a) {
                if (B && (!WebPDF.Environment.mobile || P || L)) {
                    var e, f = new g(0, 0);
                    if (e = q(r, a, f, !0, !0), null != e && e.isPageLoaded()) {
                        G = e, B && WebPDF.Common.preventDefaults(a, !0);
                        var h = new g(0, 0);
                        h = e.devicePtToPDF(f);
                        var i = e.getPageIndex(),
                            j = F.getTextPage(i);
                        if (j) {
                            var l = [];
                            j.pageSelectInfo.getSelectPDFRect(l);
                            var o = !1;
                            o = L ? !1 : b(h, l);
                            var t, u = j.textPage.getCharIndexByPoint(h); - 1 != u && (t = new k, j.textPage.getCaretAtPoint(h, t), -1 == t.index && (u = -1));
                            var C = a.altKey;
                            if (z == m.SELECT_MODE_NORMAL) return void p(o ? n.CURSOR_ARROW : u >= 0 && !C ? n.CURSOR_SELECT : u >= 0 && C ? n.CURSOR_BOUND : n.CURSOR_NORMAL);
                            if (Configs.RectangularTextSelection && z == m.SELECT_MODE_BOUND) {
                                if (!P && A != n.CURSOR_BOUND) return;
                                v = !0, x = f;
                                var D = s.getPageIndex();
                                i != D && (D > i ? x.y = 0 : x.y = s.getPageViewHeight()), d(w, x, D, i) && (F.highLightAllSelectedText(), j.pageSelectInfo.getFirstCaretInfo(H)), K.x = a.pageX, K.y = a.pageY, S(J, K)
                            } else if (z == m.SELECT_MODE_SELECTING) {
                                if (!WebPDF.Environment.mobile && A != n.CURSOR_SELECT) return;
                                if (!s || H.index < 0) return;
                                s != e && (s = e), t = new k, j.textPage.getCaretAtPoint(h, t) && (H = t, c(I, H, y, s.getPageIndex()) && F.highLightAllSelectedText()), X(new g(a.pageX, a.pageY), s)
                            }
                        }
                    }
                }
            }, this.onHold = function(a) {
                F.onLButtonDblClk(a)
            }, this.isSelected = function() {
                for (var a = u.length, b = 0; a > b; b++) {
                    var c = F.getTextPage(u[b]);
                    if (c) {
                        var d = [];
                        if (c.pageSelectInfo.getSelectPDFRect(d) > 0) return !0
                    }
                }
                return !1
            }, this.getSelectedPageRange = function() {
                for (var a = r.getMainView().getDocView().getPageCount(), b = -1, c = 0; c < u.length; c++) u[c] < a && (a = u[c]), u[c] > b && (b = u[c]);
                return {
                    start: a,
                    end: b
                }
            }, this.getPageViewInfoByMouseEvent = function(a, b, c, d, e) {
                return q(a, b, c, d, e)
            }
        }
        var e, f = (a("core/Plugins/Text/PDFTextObject"), a("core/Plugins/Text/PDFTextPage"), a("core/Plugins/TextSelection/PDFTextPageSelect")),
            g = WebPDF.PDFPoint,
            h = WebPDF.PDFRect,
            i = WebPDF.RectUtils,
            j = WebPDF.Common,
            k = WebPDF.Text.CaretInfo,
            l = WebPDF.Text.TextBoundInfo,
            m = {
                SELECT_MODE_NORMAL: 0,
                SELECT_MODE_IN_SELECTED: 1,
                SELECT_MODE_SELECTING: 2,
                SELECT_MODE_BOUND: 3
            };
        WebPDF.TextSelection.SELECT_STATE = m;
        var n = {
            CURSOR_NORMAL: 0,
            CURSOR_SELECT: 1,
            CURSOR_ARROW: 2,
            CURSOR_BOUND: 3,
            CURSOR_QKSCH: 4
        };
        WebPDF.TextSelection.CURSOR_STATE = n, WebPDF.TextSelection.TextPage = function() {
            this.textPage = null, this.pageSelectInfo = new f
        };
        var o = WebPDF.TextSelection.TextPage;
        WebPDF.TextSelection.TextSelectedInfo = function() {
            this.pageIndex = -1, this.selectedRectArray = []
        }, b.createTextSelectService = function(a) {
            return null == e && (e = new d(a)), e
        }
    }), define("core/Plugins/Menu/MenuPlugin", [], function(a, b, c) {
        WebPDF.ContextMenuPlugin = function(a) {
            function b(a) {
                var c = "";
                if (!a) return a;
                var d = k.getMenuItem(a.item);
                if (null == d) return "";
                if (c += d.createHtml(), "" === c) return c;
                var e = $(c),
                    f = !1,
                    g = "";
                if (a.subitems && a.subitems.length > 0)
                    for (var h = 0; h < a.subitems.length; h++) {
                        var i = a.subitems[h],
                            j = b(i);
                        "" != j && (f = !0, g += j)
                    }
                return f && e.append("<ul>" + g + "</ul>"), c = e.get(0).outerHTML
            }

            function c(a, b, c) {
                var d = a.getScale(),
                    e = $("#" + c);
                e.find(".ok").remove();
                var f = !1;
                d === b && (f = !0), b === WebPDF.ZOOM_FIT_WIDTH && a.isFitWidth() && (f = !0), b === WebPDF.ZOOM_FIT_PAGE && a.isFitPage() && (f = !0), f ? (e.addClass("icon").prepend('<span class="icon ok"></span>'), e.addClass("icon-selected")) : (e.removeClass("icon").find(".ok").remove(), e.removeClass("icon-selected"))
            }

            function d(a, b, c) {
                return c ? c.hasClass("disabled") ? !1 : (b === WebPDF.ZOOM_FIT_WIDTH ? (a.fitWidth(), a.setFitPage(!1)) : b === WebPDF.ZOOM_FIT_PAGE ? (j = a.getViewMode(), a.setFitPage(!0), a.setFitWidth(!1), WebPDF.ViewerInstance.showFullPage()) : (j >= 0 && a.changeShowMode(j, !0), a.setFitWidth(!1), a.setFitPage(!1), a.onZoom(b)), !0) : !1
            }

            function e() {
                var a = k.getAppId(),
                    b = a + "_cmz50",
                    e = a + "_cmz75",
                    f = a + "_cmz100",
                    g = a + "_cmz125",
                    h = a + "_cmz150",
                    i = a + "_cmz200",
                    j = a + "_fitPage",
                    l = a + "_fitWidth",
                    m = a + "_previousPage",
                    n = a + "_nextPage",
                    o = k.getMainView().getDocView();
                k.addMenuItem({
                    name: "MenuSeparator",
                    createHtml: function() {
                        return "<li class='separator'></li>"
                    }
                }), k.addMenuItem({
                    name: "MenuZoom50",
                    createHtml: function() {
                        return "<li id='" + b + "' class='icon' menuname='MenuZoom50'><span class='ok icon'></span>50%</li>"
                    },
                    onShow: function() {
                        c(o, .5, b)
                    },
                    onSelect: function(a) {
                        return d(o, .5, a)
                    }
                }), k.addMenuItem({
                    name: "MenuZoom75",
                    createHtml: function() {
                        return "<li id='" + e + "' class='icon' menuname='MenuZoom75'><span class='ok icon'></span>75%</li>"
                    },
                    onShow: function() {
                        c(o, .75, e)
                    },
                    onSelect: function(a) {
                        return d(o, .75, a)
                    }
                }), k.addMenuItem({
                    name: "MenuZoom100",
                    createHtml: function() {
                        return "<li id='" + f + "' class='icon' menuname='MenuZoom100'><span class='ok icon'></span>100%</li>"
                    },
                    onShow: function() {
                        c(o, 1, f)
                    },
                    onSelect: function(a) {
                        return d(o, 1, a)
                    }
                }), k.addMenuItem({
                    name: "MenuZoom125",
                    createHtml: function() {
                        return "<li id='" + g + "' class='icon' menuname='MenuZoom125'><span class='ok icon'></span>125%</li>"
                    },
                    onShow: function() {
                        c(o, 1.25, g)
                    },
                    onSelect: function(a) {
                        return d(o, 1.25, a)
                    }
                }), k.addMenuItem({
                    name: "MenuZoom150",
                    createHtml: function() {
                        return "<li id='" + h + "' class='icon' menuname='MenuZoom150'><span class='ok icon'></span>150%</li>"
                    },
                    onShow: function() {
                        c(o, 1.5, h)
                    },
                    onSelect: function(a) {
                        return d(o, 1.5, a)
                    }
                }), k.addMenuItem({
                    name: "MenuZoom200",
                    createHtml: function() {
                        return "<li id='" + i + "' class='icon' menuname='MenuZoom200'><span class='ok icon'></span>200%</li>"
                    },
                    onShow: function() {
                        c(o, 2, i)
                    },
                    onSelect: function(a) {
                        return d(o, 2, a)
                    }
                }), k.addMenuItem({
                    name: "FitPage",
                    createHtml: function() {
                        return "<li id='" + j + "' class='icon' menuname='FitPage'><span class='ok icon'></span><label data-i18n='CommandUI.FitPage'></label></li>"
                    },
                    onShow: function() {
                        c(o, WebPDF.ZOOM_FIT_PAGE, j)
                    },
                    onSelect: function(a) {
                        return d(o, WebPDF.ZOOM_FIT_PAGE, a)
                    }
                }), k.addMenuItem({
                    name: "FitWidth",
                    createHtml: function() {
                        return "<li id='" + l + "' class='icon' menuname='FitWidth'><span class='ok icon'></span><label data-i18n='CommandUI.FitWidth'></label></li>"
                    },
                    onShow: function() {
                        c(o, WebPDF.ZOOM_FIT_WIDTH, l)
                    },
                    onSelect: function(a) {
                        return d(o, WebPDF.ZOOM_FIT_WIDTH, a)
                    }
                }), k.addMenuItem({
                    name: "MenuPrevPage",
                    createHtml: function() {
                        return "<li  id='" + m + "' class='icon' menuname='MenuPrevPage'><span class='icon icon1'></span><label data-i18n='Menu.PrevPage'></label></li>"
                    },
                    onShow: function() {
                        var a = $("#" + m);
                        0 === o.getCurPageIndex() ? a.addClass("disabled") : a.removeClass("disabled")
                    },
                    onSelect: function(a) {
                        if (a) {
                            if (a.hasClass("disabled")) return !1;
                            o.gotoPrevPage()
                        }
                    }
                }), k.addMenuItem({
                    name: "MenuNextPage",
                    createHtml: function() {
                        return "<li  id='" + n + "' class='icon' menuname='MenuNextPage'><span class='icon icon1'></span><label data-i18n='Menu.NextPage'></label></li>"
                    },
                    onShow: function() {
                        var a = $("#" + n);
                        o.getCurPageIndex() === o.getPageCount() - 1 ? a.addClass("disabled") : a.removeClass("disabled")
                    },
                    onSelect: function(a) {
                        if (a) {
                            if (a.hasClass("disabled")) return !1;
                            o.gotoNextPage()
                        }
                    }
                })
            }

            function f() {
                n = !1
            }

            function g(a) {
                if (!a) return a;
                var b = k.getMenuItem(a.item);
                if (b && (b.onShow(), a.subitems && a.subitems.length > 0))
                    for (var c = 0; c < a.subitems.length; c++) {
                        var d = a.subitems[c];
                        g(d)
                    }
            }

            function h() {
                n = !0;
                for (var a = WebPDF.Config.MenuBar, b = 0; b < a.length; b++) {
                    var c = a[b].plugin,
                        d = WebPDF.Config.Plugins.load[c];
                    if (null == d || 0 != d)
                        for (var e = a[b].items, f = 0; f < e.length; f++) g(e[f])
                }
            }

            function i(a) {
                if (null != a) try {
                    var b = a.attr("menuname"),
                        c = k.getMenuItem(b);
                    c && c.onSelect(a)
                } catch (d) {
                    console.error(d)
                }
            }
            var j, k = a,
                l = k.getAppId() + "FxMenuContainer",
                m = k.getAppId() + "FxMenu",
                n = !1;
            this.getName = function() {
                return "ContextMenu Plugin"
            }, this.onRegister = function() {}, this.init = function() {/*
                var a = "<div id='" + l + "'><ul id='" + m + "' class='fwrContextMenu fwr-cm-default' style='left: 341px; top: 167px; display: none;'></div>",
                    c = k.getMainView();
                $(document.body).append(a), e();
                for (var d = "", g = WebPDF.Config.MenuBar, j = 0; j < g.length; j++) {
                    var n = g[j].plugin,
                        o = WebPDF.Config.Plugins.load[n];
                    if (null == o || o !== !1)
                        for (var p = g[j].items, q = 0; q < p.length; q++) d += b(p[q])
                }
                $("#" + m).append(d), $("#" + c.getDocView().getDocViewContainerID()).fwrContextMenu(m, {
                    onSelect: function(a, b) {
                        return i($(this))
                    },
                    onShow: function(a, b) {
                        return $("#" + m).i18n(), h()
                    },
                    onHide: function(a, b) {
                        return f()
                    },
                    onHover: function(a, b) {
                        return !0
                    }
                }, document.getElementById(c.getMainFrameID()))*/
            }, this.hideMenu = function() {
                if (n) {
                    var a = $("#" + m);
                    a.css({
                        display: "none"
                    })
                }
            }, this.unload = function() {
                $("#" + l).remove()
            }, this.getReaderApp = function() {
                return k
            }
        }, b.createPlugin = function(a) {
            return new WebPDF.ContextMenuPlugin(a)
        }
    }), define("core/Plugins/FindTool/SearchComponent", ["core/Plugins/FindTool/MobileSearchView", "core/Common/Interface", "core/WebPDF", "core/Plugins/FindTool/SearchView", "core/Plugins/FindTool/PCSearchView", "core/Plugins/FindTool/SearchService", "core/Plugins/FindTool/SearchResult"], function(a, b, c) {
        function d(b) {
            if (b.isMobile()) {
                var c = a("core/Plugins/FindTool/MobileSearchView");
                f = new c(b)
            } else {
                var d = a("core/Plugins/FindTool/PCSearchView");
                f = new d(b)
            }
            g = a("core/Plugins/FindTool/SearchService").createSearchServie(b), WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_LOADED, function(a, c) {
                g.init(), f.init(), f.changedSearchingDivState(!1), e(b)
            }), WebPDF.ViewerInstance.on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function(a, c) {
                var d = b.getMainView().getDocView().getCurPageIndex(),
                    e = g.getSeacrchedPageIndex(),
                    h = !1;
                d != e && (h = !0);
                var i = b.getMainView().getDocView().getPageView(e),
                    j = g.getHighlightRects();
                i && j && f.highlightSearchedText(i.getPageIndex(), j, h)
            })
        }

        function e(a) {
            function b(a, b, c) {
                a ? setTimeout(function() {
                    f.highlightSearchedText(b, c)
                }, 50) : f.highlightSearchedText(b, c), c && c.length > 0 && f.delHighlightSearchResult(c, !0) && f.setHighlightRects([])
            }
            f.searchAll(function(a) {
                return "" === a ? !1 : (f.changedSearchingDivState(!0), void g.searchAllText(a, 200, 0, 0, function(a) {
                    f.changedSearchingDivState(!1), f.resultView(a)
                }))
            }), f.searchNext(function(a) {
                return "" === a ? !1 : (f.changedSearchingDivState(!0), g.searchTextDown(a, b, f.resetHighLightText), void f.changedSearchingDivState(!1))
            }), f.searchPrevious(function(a) {
                return "" === a ? !1 : (f.changedSearchingDivState(!0), g.searchTextUp(a, b, f.resetHighLightText), f.changedSearchingDivState(!1), !1)
            }), f.goActionSearchText(function(a, b) {
                try {
                    if (null != b && null != a) {
                        g.goActionHightSearchedText(b, a, f.resetHighLightText), f.highlightSearchedText(b, a);
                        var c = g.getHighlightRects();
                        c && c.length > 0 && f.delHighlightSearchResult(c, !0) && f.setHighlightRects([])
                    }
                    return !1
                } catch (d) {
                    console.error(d)
                }
                return !1
            }), f.closeResultView(function() {}), f.showMobileMore(function(a, b, c, d, e) {
                if (f.changedSearchingDivState(!0), c >= e) return !1;
                if (c + 1 >= e) {
                    var h = WebPDF.ViewerInstance.getPageCount();
                    h > d ? g.searchAllText(b, 200, 0, d, function(a) {
                        f.resultView(a)
                    }) : f.isShowMore(!1)
                } else f.isShowMore(!0);
                return f.resetResultView(a, c), f.changedSearchingDivState(!1), !1
            }), f.showPCMore(function(a, b) {
                f.changedSearchingDivState(!0);
                try {
                    g.searchAllText(a, 200, 0, b, function(a) {
                        f.changedSearchingDivState(!1), f.resultView(a)
                    })
                } catch (c) {
                    f.changedSearchingDivState(!1)
                }
            })
        }
        var f, g;
        d.prototype = {
            resetResultView: function() {
                f.resetResultView()
            },
            clearHighlight: function() {
                g.clearHighlightRects()
            }
        }, b.createSearchComponent = function(a) {
            return WebPDF.searchComponent || (WebPDF.searchComponent = new d(a)), WebPDF.searchComponent
        }
    }), define("core/Plugins/FindTool/MobileSearchView", ["core/Common/Interface", "core/WebPDF", "core/Plugins/FindTool/SearchView"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b), this.defOpt = {
                scrollBarType: 0
            }, this.readerApp = a, this.searchAllTree = null, this.searchResultMsg = i18n.t("PCLng.Panel.SearchResultMsg"), b && $.extend(this.defOpt, b)
        }

        function e() {
            $("#closeSearchPannel").off("tap").on("tap", function(a) {
                return $("#readerPageSearch").attr("value", ""), $("#search").hide(), $("#header-toolbar").show(), $("#bottomControl").hide(), $("#fwrm-advsearchpanel").hide(), $("#tools").children("ul").find("li").removeClass("selected"), !1
            })
        }

        function f() {
            $("#btnClearText").off("tap").on("tap", function(a) {
                $("#readerPageSearch").attr("value", ""), $("#readerPageSearch").focus()
            })
        }

        function g() {
            var a = $("#result-container"),
                b = "item-" + parseInt((u - 1) * t),
                c = $("#" + b),
                d = c.offset().top - a.offset().top + a.scrollTop();
            a.scrollTop(d), w.push(d)
        }

        function h(a, b) {
            for (var c = $("#result-list"), d = s + b, e = s; d > e && !(e > a.count() - 1); e++) {
                for (var f = a.getContent(e), g = a.getPageIndex(e), h = a.getRects(e), i = new Array, j = 0; j < h.length; j++) i.push([h[j].left, h[j].top, h[j].right, h[j].bottom]);
                var k = JSON.stringify(i),
                    l = $("<li id='item-" + e + "'>" + f + "</li>").appendTo(c);
                l.attr("nodeid", e), l.attr("pageIndex", g), l.attr("rects", k)
            }
            s += b
        }

        function i(a, b) {
            $("#result-page").html("Screen " + a), $("#page-count").html("Count: " + b)
        }

        function j() {
            var a = $(window).height(),
                b = $("#search"),
                c = $("#bottomControl"),
                d = a - b.outerHeight() - c.outerHeight();
            B.height(d);
            var e = $("#result-count"),
                f = e.height(),
                g = $("#result-more"),
                h = g.height(),
                i = d - f - h - 44,
                j = $("#result-container");
            j.height(i)
        }

        function k(a, b) {
            s = 0, u = 1, w = [];
            var c = a.count(),
                d = $("#result-count");
            z += c, d.html(z + i18n.t("MobileLng.Search.Result"));
            var e = d.outerHeight(!0),
                f = $("#result-more"),
                g = f.height(),
                h = $("#result-list"),
                i = l(h);
            y = parseFloat(h.css("padding-top").replace("px", ""));
            var j = b - e - g - 24,
                k = $("#result-container");
            k.height(j), t = j / i, t = parseInt(t);
            var m = j % i;
            if (m > 0) {
                m /= 2;
                var n = parseFloat(h.css("padding-top").replace("px", ""));
                n += m, h.css("padding-top", n);
                var o = parseFloat(h.css("padding-bottom").replace("px", ""));
                h.css("padding-bottom", o + m)
            }
            r = c / t, c % t && (r = parseInt(r) + 1), r > 1 ? $("#result-more").show() : $("#result-more").hide()
        }

        function l(a) {
            var b = $("<li>test li element</li>").appendTo(a),
                c = b.outerHeight(!0);
            return b.remove(), c
        }

        function m() {
            var a = $("#readerPageSearch").val();
            return a = a.replace(/(^\s*)|(\s*$)/g, "")
        }

        function n() {
            var a = $("#result-list");
            a.find("li").length && (a.find("li").remove(), a.css("padding-top", y), a.css("padding-bottom", y))
        }

        function o() {
            q = null, r = 0, s = 0, t = 0, u = 1, v = 0, w = new Array, x = null, y = 0, z = 0, A = 0
        }
        var p, q = null,
            r = 0,
            s = 0,
            t = 0,
            u = 1,
            v = 0,
            w = new Array,
            x = null,
            y = 0,
            z = 0,
            A = 0,
            B = $("#fwrm-advsearchpanel"),
            C = a("core/Common/Interface"),
            D = a("core/Plugins/FindTool/SearchView");
        return d.prototype = {
            initView: function() {
                $("#readerPage").html(), o();
                var a = '<div id="search" class="header-subtool" style="display:none"><div class="zoom"><svg><use xlink:href="#icon-zoom"></use></svg></div><div class="reset" id="btnClearText"><svg><use xlink:href="#icon-reset"></use></svg></div><input data-role="none" type="text" id="readerPageSearch" class="keyword" placeholder="Search" data-i18n="[placeholder]MobileLng.Search.Hint"/><span class="close-search-pannel" id="closeSearchPannel" data-i18n="[html]MobileLng.Search.Cancel"></span></div><div id="bottomControl" class="fwrm-search-footer" style="display:none; z-index:999;"><div id="searchProgressbar" style="display:none">    <img src="../images/mobile/progress.gif"></div><ul>    <li id="btnSearchPrevious"><svg class="default"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-prev-page"></use></svg></li>    <li id="btnSearchNext"><svg class="default"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-next-page"></use></svg></li>   <li id="btnAdvSearch"><svg class="default"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-search-adv"></use></svg></li></ul></div>';
                $("#search")[0] ? $(".fwr-search-text-highlight").remove() : $("#readerPage").append(a), e();
                var b = '<div id="result-close" class="result-close"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-result-close"></use></svg></div><h3 id="result-count">共有432个结果</h3><div id="result-container" class="result-container"><ul id="result-list"></ul></div><div id="result-more" class="more"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-result-more"></use></svg></div>';
                $("#fwrm-advsearchpanel").html("").append(b), $("#readerPage").i18n(), f()
            },
            searchAll: function(a) {
                return $("#btnAdvSearch").off("tap").tap(function() {
                    return x === m() ? ($("#fwrm-advsearchpanel").show(), j(), !1) : void($.isFunction(a) && a(m()))
                }), !1
            },
            searchNext: function(a) {
                $("#btnSearchNext").tap(function() {
                    $.isFunction(a) && a(m())
                }), $("#readerPageSearch").off("keyup").on("keyup", function(b) {
                    if ($.isFunction(a)) {
                        var c = b || window.event,
                            d = c.keyCode || c.which || c.charCode;
                        13 === d && a(m())
                    }
                })
            },
            searchPrevious: function(a) {
                $("#btnSearchPrevious").tap(function() {
                    $.isFunction(a) && a(m())
                })
            },
            changedSearchingDivState: function(a) {
                a ? $("#searchProgressbar").show() : $("#searchProgressbar").hide()
            },
            goActionSearchText: function(a) {
                $("#fwrm-advsearchpanel").delegate("li", "tap", function(b) {
                    if ($.isFunction(a)) {
                        for (var c = parseInt(b.target.getAttribute("pageIndex")), d = b.target.getAttribute("rects"), e = $.parseJSON(d), f = new Array, g = 0; g < e.length; g++) f.push(new WebPDF.PDFRect(e[g][0], e[g][1], e[g][2], e[g][3]));
                        return a(f, c), $("#fwrm-advsearchpanel").hide(), !1
                    }
                })
            },
            closeResultView: function(a) {
                $("#result-close").off("tap").on("tap", function(b) {
                    return $.isFunction(a) && ($("#fwrm-advsearchpanel").hide(), a()), !1
                })
            },
            showPCMore: function(a) {},
            showMobileMore: function(a) {
                $("#result-more").off("tap").on("tap", function(b) {
                    ! function(b, c, d) {
                        if ($.isFunction(a)) {
                            var e = m();
                            a(p, e, b, d, c)
                        }
                    }(u, r, A)
                })
            },
            resultView: function(a) {
                p = a;
                var b = $("#fwrm-advsearchpanel");
                if (A = a.pageIndex, v = a.searchResult.count(), x != m() && (n(), z = 0), x = m(), a.searchResult.count() <= 0) {
                    var c = $("#fwrm-search-notfound");
                    c.html(i18n.t("MobileLng.Search.NotFound") + '"' + x + '"'), $("#fwrm-advsearchpanel").hide();
                    var d = $(window).width(),
                        e = $(window).height(),
                        f = c.width();
                    c.css({
                        left: "" + (d / 2 - f / 2) - 20 + "px"
                    }), c.css({
                        top: "" + (e - 120) + "px"
                    }), c.show(), q && clearTimeout(q), q = setTimeout(function() {
                        c.hide()
                    }, 3e3), n(), i(0, 0);
                    var g = $("#result-count");
                    g.html(0 + i18n.t("MobileLng.Search.Result")), $("#readerPageSearch").attr("value", ""), x = null
                } else {
                    var e = $(window).height(),
                        j = $("#search"),
                        l = $("#bottomControl"),
                        o = e - j.height() - l.height() - 9;
                    b.height(o), k(a.searchResult, o), h(a.searchResult, t), b.show(), w.push(0)
                }
            },
            isShowMore: function(a) {
                a ? $("#result-more").show() : $("#result-more").hide()
            },
            resetResultView: function(a, b) {
                var c = t;
                b += 1, u = b, u == r && (c = v - (r - 1) * t), i(u, c), h(a.searchResult, c), g()
            }
        }, C.extend(d, D), $(window).resize(function() {
            j()
        }), $("#result-container").scroll(function() {
            for (var a = $("#result-container").scrollTop(), b = 0; b < w.length - 1; b++) {
                var c = w[b],
                    d = w[b + 1];
                if (a > c && d > a)
                    if (d - a > a - c) i(b + 1, t);
                    else {
                        var e = t;
                        b == r - 2 && (e = v - (r - 1) * t), i(b + 2, e), u >= r ? $("#result-more").hide() : $("#result-more").show()
                    }
            }
        }), d
    }), define("core/Common/Interface", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.Interface = function() {
            return function(a, b) {
                if (2 != arguments.length) throw new Error("Interface constructor called with " + arguments.length + "arguments, but expected exactly 2.");
                this.name = a, this.methods = [];
                for (var c = 0, d = b.length; d > c; c++) {
                    if ("string" != typeof b[c]) throw new Error("Interface constructor expects method names to be passed in as a string.");
                    this.methods.push(b[c])
                }
            }
        }(), d.Interface.ensureImplements = function(a) {
            return
        }, d.Interface.extend = function(a, b) {
            var c = function() {};
            c.prototype = b.prototype;
            var d = new c;
            $.extend(d, a.prototype), a.prototype = d, a.prototype.constructor = a, a.superclass = b.prototype, b.prototype.constructor == Object.prototype.constructor && (b.prototype.constructor = b)
        }, d.Interface
    }), define("core/Plugins/FindTool/SearchView", [], function(a, b, c) {
        function d(a) {
            return a.getPageViewContainerID() + "_HighLights"
        }

        function e(a, b, c) {
            if (c.length <= 0) return null;
            var d = c[0];
            h.normalize(d);
            for (var e = new i(d.left, d.top, d.right, d.bottom), f = 1; f < c.length; f++) {
                var g = c[f];
                h.normalize(g), h.union(e, g)
            }
            var j = a.getMainView().getDocView(),
                k = $("#" + j.getDocViewContainerID()),
                l = k.height(),
                m = k.width(),
                n = k.offset();
            if (WebPDF.Environment.mobile) {
                var o = $("#search"),
                    p = $("#bottomControl");
                o && (n.top += 1.5 * o.height(), l -= 1.5 * o.height()), p && (l -= 1.5 * p.height())
            }
            var q = $("#" + b.getPageViewContainerID()),
                r = b.getDocView().getViewMode();
            switch (r) {
                case WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING:
                    break;
                case WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE:
                case WebPDF.PDFView.RD_BRMODE_CONTINUOUS:
                    var s = q.offset(),
                        t = b.pdfRectToDevice(e, !0),
                        u = h.height(t),
                        v = h.width(t),
                        w = l / 2,
                        x = m / 2,
                        y = $("div#docViewer_ViewContainer.fwrJspHorizontalBar").height();
                    0 > y && (y = 0);
                    var z = s.top + t.top >= n.top && s.top + t.bottom <= n.top + l - y;
                    if (z &= s.left + t.left >= n.left && s.left + t.left <= n.left + m || s.left + t.left <= n.left && s.left + t.left + v >= n.left) return null;
                    var A = u / 2 + t.top;
                    A = w - A, A = -A;
                    var B = v / 2 + t.left;
                    return B = x - B, B = -B, {
                        x: B,
                        y: A
                    }
            }
            return null
        }
        var f = {},
            g = "",
            h = WebPDF.RectUtils,
            i = WebPDF.PDFRect,
            j = null,
            k = function(a, b) {
                j = a
            };
        return k.prototype.init = function() {
            this.initView()
        }, k.prototype.highlightSearchedText = function(a, b, c) {
            var i = j.getMainView().getDocView(),
                k = i.getPageCount();
            if (0 > a || a >= k) return !1;
            var l = i.getPageView(a);
            if (l.isContentCreated() || i.gotoPage(a, 0, 0), !c) {
                var m = e(j, l, b);
                //m && i.gotoPage(a, m.x, m.y)
            }
            if (!l || !l.isContentCreated() || !b) return !1;
            var n = d(l);
            if (g = n, null == f[a] || !$("#" + n).length) {
                var o = "<div id='" + n + "' style='z-index:7;'></div>",
                    p = $("#" + l.getPageViewContainerID());
                p.append(o), f[a] = !0
            }
            var q = $("#" + n);
            q.empty();
            for (var r = "", s = 0; s < b.length; s++) {
                var t = b[s];
                h.normalize(t), t = l.pdfRectToDevice(t, !0), r += "<div id='highlight_" + a + "_" + s + "'class='fwr-search-text-highlight' style='left:" + t.left + "px;top:" + t.top + "px;width:" + h.width(t) + "px;height:" + h.height(t) + "px' ></div>"
            }
            q.append(r)
        }, k.prototype.delHighlightSearchResult = function(a) {
            var b = $("#" + j.getMainView().getMainFrameID()),
                c = this;
            b.on("click.highlightSearchResult", function(b) {
                var d = $("div#docViewer_ViewContainer .fwrJspVerticalBar");
                if (d.length > 0) {
                    var e = d.offset();
                    if (b.clientX >= e.left) return
                }
                var f = $("div#docViewer_ViewContainer .fwrJspHorizontalBar");
                if (f.length > 0) {
                    var g = f.offset();
                    if (b.clientY >= g.top) return
                }
                c.resetHighLightText(a, !0)
            })
        }, k.prototype.resetHighLightText = function(a, b) {
            if (null !== a && 0 !== a.length) {
                if (b && (WebPDF.searchComponent && WebPDF.searchComponent.clearHighlight(), a = []), g) {
                    var c = $("#" + g);
                    c.length > 0 && c.empty()
                }
                var d = $("#" + j.getMainView().getMainFrameID());
                return d.off("click.highlightSearchResult"), b
            }
        }, k
    }), define("core/Plugins/FindTool/PCSearchView", ["core/Common/Interface", "core/WebPDF", "core/Plugins/FindTool/SearchView"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b), this.defOpt = {
                scrollBarType: 0
            }, this.readerApp = a, this.searchResultMsg = i18n.t("PCLng.Panel.SearchResultMsg"), b && $.extend(this.defOpt, b)
        }

        function e(a) {
            var b = $("#docViewer_fxfindPanel");
            if (null == this.searchViewScroll) {
                var c = {
                        showArrows: !1,
                        animateScroll: !1
                    },
                    d = "";
                switch (a) {
                    case WebPDF.PDFView.ScrollBarType.CUSTOM_SCROLL_BAR:
                        d = b.fwrJScrollPane(c);
                        break;
                    case WebPDF.PDFView.ScrollBarType.NATIVE_SCROLL_BAR:
                        d = b.WebPDFNativeScroll(c);
                        break;
                    default:
                        $.error("Unsupported type of scroll bar.")
                }
                var e = d.data("jsp");
                return e
            }
        }

        function f(a) {
            var b = $("#navigationPanel").width(),
                c = $("#navigation").height() - $("#searchArea").height();
            $("#searchPanel").css({
                width: b + "px",
                height: c - 38 + "px"
            }), a && a.reinitialise()
        }

        function g() {
            var a = $("#searchTextInput").val();
            return a = a.replace(/(^\s*)|(\s*$)/g, "")
        }

        function h(a, b) {
            var c = a.getBaseUrl() + "images/reader/line.png",
                d = "<div id='btnSearchTextMore' style='margin-top: 14px;text-align: center;margin-bottom: 8px;margin-right: 16px;'><img style='display: block; width: 100%;height: 1px; margin-bottom: 6px;' src='" + c + "'alt=''/><font color=blue><u>" + n + "</u></font></div>";
            $("#ddocViewer_searchText_0").append(d), l = b
        }

        function i() {
            $("#searchResultTip").html("")
        }
        var j, k = "",
            l = 0,
            m = null,
            n = i18n.t("PCLng.Panel.ShowMore"),
            o = null,
            p = null,
            q = !1,
            r = a("core/Common/Interface"),
            s = a("core/Plugins/FindTool/SearchView");
        return d.prototype = {
            initView: function() {
                $("#searchPanel").html(""), k = "", l = 0, o = null, p = null, m = null;
                var a = '<div id="searchArea"><div class="fwr-search-tip" data-i18n="[html]PCLng.Panel.SearchFor">What Word or phrase would you like to search for?</div> <div id="fwr_search_box_buttom_frame" class="fwr_search_box_buttom_frame fwr-search-tip">  <input id="searchTextInput" class="fwr_search_box" type="text" autocomplete="off" title="" maxlength="255"> <span class="fwr_search_split_button" title="" tabindex="0" id="FindSplitButton-Small"> <a tabindex="-1" style="float: left; height: 100%;" title=""> <span style="float: left; margin-top: 2px;" id="searchBtnIcon" class="fwr-search-icon"></span></a></span></div> <div id="searchResultTip" style="margin-left: 10px; display: inline-block;"></div> <div style="display: inline-block; width: 100%;"> <div class="fwr-search-next fwr-icons-lastnext" id="btnSearchNext" ></div> <div class="fwr-search-last fwr-icons-lastnext" id="btnSearchPrevious" ></div> <div class="fwr-icons-searching"></div></div>';
                $("#searchPanel").append(a), $("#searchPanel").i18n(), j = $(".fwr-icons-searching")
            },
            searchAll: function(a) {
                $("#searchBtnIcon").off("click").click(function() {
                    var b = g();
                    k !== b && (k = b, o = null, i(), $.isFunction(a) && a(g()))
                })
            },
            searchNext: function(a) {
                $("#btnSearchNext").off("click").click(function() {
                    return $.isFunction(a) && a(g()), !1
                }), $("#searchTextInput").off("keypress").on("keypress", function(b) {
                    13 === b.keyCode && $.isFunction(a) && a(g())
                }), $.hotkeys.add("f3", function() {
                    $.isFunction(a) && a(g())
                })
            },
            changedSearchingDivState: function(a) {
                a ? j.show() : j.hide()
            },
            searchPrevious: function(a) {
                $("#btnSearchPrevious").off("click").click(function() {
                    $.isFunction(a) && a(g())
                }), $.hotkeys.add("Shift+f3", function() {
                    $.isFunction(a) && a(g())
                })
            },
            goActionSearchText: function(a) {
                var b = this;
                $("#searchPanel").off("click", "a.searchTextNode").on("click", "a.searchTextNode", function(c) {
                    if ($.isFunction(a)) {
                        var d = parseInt(c.target.getAttribute("nodeid"));
                        b.renderResultViewByNodeID(d);
                        var e = o.getPageIndex(d),
                            f = o.getRect(d);
                        a(f, e)
                    }
                })
            },
            closeResultView: function(a) {
                $.isFunction(a) && a()
            },
            showPCMore: function(a) {
                $("#searchPanel").off("click", "#btnSearchTextMore").on("click", "#btnSearchTextMore", function() {
                    ! function(b) {
                        if ($.isFunction(a)) {
                            if (1 == q) return !1;
                            q = !0, a(g(), b)
                        }
                    }(l)
                })
            },
            showMobileMore: function() {},
            resultView: function(a) {
                p = null;
                var b = "searchTextPlusItem",
                    c = this.readerApp.getBaseUrl();
                if (null == o) {
                    var d = c + "images/reader/dtree/",
                        g = {
                            root: "",
                            folder: d + "bookmark_ui.png",
                            folderOpen: d + "bookmark_ui.png",
                            node: d + "bookmark_ui.png",
                            nodehot: d + "bk1_ui.png",
                            empty: d + "empty.gif",
                            line: d + "line_pc_ui.png",
                            join: d + "join_pc_ui.png",
                            joinBottom: d + "joinbottom_pc_ui.png",
                            joinTop: d + "jointop_pc_ui.png",
                            joinonly: d + "joinonly_pc.png",
                            plus: d + "plug_pc_ui.png",
                            plusBottom: d + "plugbottom_pc.png",
                            plusTop: d + "plugtop_pc.png",
                            plusOnly: d + "plugonly_pc.png",
                            minus: d + "minus_pc_ui.png",
                            minusBottom: d + "minusbottom_pc.png",
                            minusTop: d + "minustop_pc.png",
                            minusOnly: d + "minusonly_pc.png",
                            nlPlus: d + "nolines_plus.gif",
                            nlMinus: d + "nolines_minus.gif"
                        };
                    o = new WebPDFTools.dTree("docViewer_searchText_", "searchTextNode", b, g), o.add(0, -1, "")
                }
                o.resetFlag();
                var i = a.searchResult.count(),
                    j = o.aNodes.length;
                if (0 == i || "undefined" == i) return m && (m.remove(), m = null), void $("#searchResultTip").html(i18n.t("PCLng.Panel.SearchResultTip"));
                var k = this.searchResultMsg.replace("n", 1).replace("m", i + j - 1);
                $("#searchResultTip").html(k);
                for (var l = 0; i > l; l++) {
                    var n = WebPDF.Common.htmlEncode(a.searchResult.getContent(l));
                    o.add(j + l, 0, n);
                    var r = a.searchResult.getPageIndex(l);
                    o.setPageIndex(j + l, r);
                    var s = a.searchResult.getRects(l);
                    o.setRect(j + l, s)
                }
                var t, u = o.toString();
                m && !p && (t = m.find(".fwr-dTreeNode:last"), m.remove(), m = null);
                var v = '<div id="docViewer_fxfindPanel" class="fwr-search-result"></div>';
                $("#searchPanel").append(v), m = $("#docViewer_fxfindPanel"), m.append(u);
                var w = WebPDF.ViewerInstance.getPageCount();
                if (a.pageIndex < w && h(this.readerApp, a.pageIndex), p = e(this.defOpt.scrollBarType), f(p), t) {
                    var x = t.children("a").attr("nodeid");
                    t = m.find(".fwr-dTreeNode>a[nodeid=" + x + "]").parent(), p.scrollToElement(t[0])
                }
                q = !1
            },
            renderResultViewByNodeID: function(a) {
                var b = o.aNodes.length - 1,
                    c = this.searchResultMsg.replace("n", a).replace("m", b);
                $("#searchResultTip").html(c), o.setCurNode(a)
            },
            isShowMore: function() {},
            resetResultView: function() {
                f(p)
            }
        }, r.extend(d, s), $(window).resize(function() {
            ! function(a) {
                f(a)
            }(p)
        }), d
    }), define("core/Plugins/FindTool/SearchService", ["core/Plugins/FindTool/SearchResult"], function(a, b, c) {
        function d(a) {
            function b(a, b) {
                return b ? !(F === a) : !(E === a)
            }

            function c(a) {
                E = "", a(O, !0), H = -1, G = -1, I = -1;
                for (var b = 0; R > b; b++) J[b].clearResult();
                W = !1, Q = !1
            }

            function d(a) {
                for (var b = [], c = a.length, d = 0; c > d; d++) {
                    var e = new i,
                        g = a[d],
                        j = g.context;
                    if (null != g.number && (e.pageIndex = parseInt(g.number)), e.isSearched = !0, 0 === j.length) e.isHasResult = !1;
                    else {
                        e.isHasResult = !0, W = !0;
                        for (var k = j.length, l = 0; k > l; l++) {
                            var m = new h,
                                n = j[l];
                            m.relateText = n.text.toString();
                            for (var o = n.rc, p = [], q = 0; q < o.length; q++) {
                                var r = o[q],
                                    s = parseFloat(r[0]),
                                    t = parseFloat(r[1]),
                                    u = parseFloat(r[2]),
                                    v = parseFloat(r[3]),
                                    w = new f(s, t, u, v);
                                p.push(w)
                            }
                            m.rects = p, e.resultList.push(m)
                        }
                    }
                    b[e.pageIndex] = e
                }
                return b
            }

            function e(a, d, e, f, g, h, i) {
                if (B) return !1;
                if (!a || 0 > e) return !1;
                S = !1;
                var j = !1,
                    k = !0,
                    l = b(a, !1);
                return l ? (c(i), E = a) : Q && (k = !1), k && (j = d == WebPDF.SearchDirection.Down ? n(e, f, g, d, h, i) : n(e, f, g, d, h, i)), S ? (S = !1, !1) : (j || (Q = !0, U ? U() : WebPDF.alert(A, "", i18n.t("Search.NoFound"), null, null, !0)), j)
            }

            function n(a, b, c, d, f, g) {
                var h, i = !1;
                if (d == WebPDF.SearchDirection.Down) {
                    for (h = a; b >= h; h++) {
                        if (S) return !1;
                        var j = J[h];
                        if (!j || !j.isSearched || j.isHasResult) {
                            var k = null;
                            if (!(j && j.isSearched || (k = q(h, !0)))) break;
                            if (i = o(h, k, c, d, f, g)) return !0;
                            if (h === R - 1 && 0 !== a) return e(E, d, 0, a - 1, -1, f, g)
                        }
                    }
                    return h > b ? W ? b === R - 1 ? e(E, d, 0, a - 1, -1, f, g) : e(E, d, b + 1, R - 1, -1, f, g) : !1 : (y(h, b, E, 0, !0, f, g), !0)
                }
                for (h = b; h >= a; h--) {
                    if (S) return !1;
                    var j = J[h];
                    if (!j || !j.isSearched || j.isHasResult) {
                        var k = null;
                        if (!(j && j.isSearched || (k = q(h, !0)))) break;
                        if (i = o(h, k, c, d, f, g)) return !0;
                        if (0 === h && b !== R - 1) return e(E, d, b + 1, R - 1, -1, f, g)
                    }
                }
                return a > h ? W ? 0 === a ? e(E, d, b + 1, R - 1, -1, f, g) : e(E, d, 0, a - 1, -1, f, g) : !1 : (y(a, h, E, 0, !1, f, g), !0)
            }

            function o(a, b, c, d, e, f) {
                var g, j = J[a];
                if (!j || !j.isSearched) {
                    j = new i, j.pageIndex = a, j.totalCharCnt = b.getStrSize();
                    for (var l = r(), m = !1;;) {
                        g = new k;
                        var n = s(l, g, b);
                        if (!n) break;
                        var o = g.startIndex >= 0;
                        if (o) {
                            m = !0;
                            var q = new h;
                            q.startCharIndex = g.resultCharStartPos, q.rects = l.resultRectArray, j.resultList.push(q)
                        }
                    }
                    if (j.isSearched = !0, !m) return J[a] = j, !1;
                    j.isHasResult = !0, W = !0, J[a] = j
                }
                var q = p(j, c, d);
                if (q) {
                    f(O, !0), g = q.ret;
                    var t = H === g.startCharIndex && I == q.index && G === a;
                    G = a, V.setHighlightRects(g.rects), H = g.startCharIndex, I = q.index, e(t, G, O)
                }
                return null != q
            }

            function p(a, b, c) {
                if (!a || !a.isSearched) return null;
                if (c == WebPDF.SearchDirection.Down)
                    for (var d = 0; d < a.resultList.length; d++) {
                        var e = a.resultList[d];
                        if (-1 === b || e.startCharIndex >= b) return {
                            ret: e,
                            index: d
                        }
                    } else
                        for (var d = a.resultList.length - 1; d >= 0; d--) {
                            var e = a.resultList[d];
                            if (-1 === b || e.startCharIndex <= b) return {
                                ret: e,
                                index: d
                            }
                        }
                return null
            }

            function q(a, b) {
                var c = L.getTextPage(a, b);
                return c && c.blocking ? null : c
            }

            function r() {
                var a = new j;
                return a.isMatchCase = C, a.isMatchWholeWord = D, a.resultRectArray = [], a.findWhat = E, a.searchPos = 0, a.resultCharStartPos = -1, a.resultItemStartPos = -1, a.resultItemEndPos = -1, a.searchPos = 0, a.isFound = !1, a.searchPos = 0, a
            }

            function s(a, b, c) {
                return a.resultRectArray = [], a.resultItemEndPos = -1, a.resultItemStartPos = -1, -1 != a.resultCharStartPos && (a.searchPos = a.resultCharStartPos + 1), t(a, c) ? (b.startIndex = a.resultItemStartPos, b.endIndex = a.resultItemEndPos, b.resultCharStartPos = a.resultCharStartPos, a.isFound = !0, !0) : (a.isFound = !1, !1)
            }

            function t(a, b) {
                a.resultCharStartPos = -1, a.resultItemStartPos = -1, a.resultItemEndPos = -1;
                var c = b.getPageAllText();
                if (!c) return !1;
                a.isMatchCase || (c = c.toLowerCase());
                var d = a.findWhat;
                d = d.replace(/(^\s*)|(\s*$)/g, ""),
                    a.isMatchCase || (d = d.toLowerCase()), d.replace("  ", " "), a.isMatchWholeWord && (d = " " + d + " ", d = " " + d + " ");
                var e = new l,
                    f = u(c, d, a.searchPos, e);
                if (!f) return !1;
                var g = e.startCharIndex,
                    h = e.endCharIndex;
                a.isMatchWholeWord && (h -= 2);
                var i = b.getObjIndexByCharIndex(g),
                    j = b.getObjIndexByCharIndex(h);
                if (a.resultCharStartPos = g, a.resultItemStartPos = i, a.resultItemEndPos = j, -1 === j || -1 === i) return !1;
                var k = b.getPDFRect(i, j - i + 1);
                return 0 === k.length ? !1 : (a.resultRectArray = k, !0)
            }

            function u(a, b, c, d) {
                var e = d.startCharIndex,
                    f = d.endCharIndex,
                    g = c,
                    h = 0,
                    i = a.length,
                    j = b.length;
                for (e = g; i > g && j > h;) a.charAt(g) == b.charAt(h) || "\r" == a.charAt(g) && i - 1 > g && "\n" == a.charAt(g + 1) && " " == b.charAt(h) || "\n" == a.charAt(g) && g > 0 && "\r" == a.charAt(g - 1) && " " == b.charAt(h) || (0 == h || h == j - 1) && " " == b.charAt(h) && !(a.charAt(g) >= "a" && a.charAt(g) <= "z" || a.charAt(g) >= "A" && a.charAt(g) <= "Z") ? (0 == h && (e = g), ++g, ++h) : 0 != h && "-" == a.charAt(g) && "-" != a.charAt(g - 1) ? ++g : 0 != h && 173 == a.charCodeAt(g) ? ++g : 0 != h && "\r" == a.charAt(g) && i - 1 > g && "\n" == a.charAt(g + 1) && (h - 1 != 0 || " " != b.charAt(h - 1)) ? ++g : 0 != h && "\n" == a.charAt(g) && g > 0 && "\r" == a.charAt(g - 1) && (h - 1 != 0 || " " != b.charAt(h - 1)) ? ++g : " " == a.charAt(g) && h > 1 && " " == b.charAt(h - 1) ? ++g : (e += 1, g = e, h = 0);
                return h >= j ? (f = g - 1, d.startCharIndex = e, d.endCharIndex = f, !0) : !1
            }

            function v(a) {
                if (b(a, !1)) return null;
                if (Q) return null;
                var c = J[G];
                if (c.isLastResult(I)) {
                    var d = G >= J.length - 1 ? 0 : G + 1,
                        e = 0;
                    return new m(d, e)
                }
                return new m(G, c.getNextCharIndex(I))
            }

            function w(a) {
                if (b(a, !1)) return null;
                if (Q) return null;
                var c = J[G];
                if (c.isFirstResult(I)) {
                    var d = 0;
                    return d = G >= 1 ? G - 1 : J.length - 1, new m(d, -1)
                }
                return new m(G, c.getPrevCharIndex(I))
            }

            function x(a, b, c, d, e) {
                return a ? B ? !1 : void z(a, b, c, d, e) : (console.warn("Search text cannot be null or empty"), !1)
            }

            function y(b, c, d, f, g, h, i) {
                function j(a) {
                    var f = a.error;
                    if (0 == f) {
                        a.findWhat && (d = a.findWhat);
                        try {
                            var j = -1;
                            j = $.parseJSON(a.pageIndex);
                            var k = $.parseJSON(a.pageTextInfo);
                            if (-1 != j && L.setTextPage(j, k), g) {
                                if (-1 == j) {
                                    for (var l = b; c >= l; l++) {
                                        var m = J[l];
                                        m.isSearched || (m.isSearched = !0, m.isHasResult = !1, J[l] = m)
                                    }
                                    return b > 0 ? (c = b - 1, b = 0) : (b = 0, c = R - 1), void e(d, WebPDF.SearchDirection.Down, 0, b, -1, h, i)
                                }
                                for (var l = b; j > l; l++) {
                                    var m = J[l];
                                    m.isSearched || (m.isSearched = !0, m.isHasResult = !1, J[l] = m)
                                }
                                return void e(d, WebPDF.SearchDirection.Down, j, c, -1, h, i)
                            }
                            if (-1 == j) {
                                for (var l = c; l >= b; l--) {
                                    var m = J[l];
                                    m.isSearched || (m.isSearched = !0, m.isHasResult = !1, J[l] = m)
                                }
                                return b > 0 ? (c = b - 1, b = 0) : (b = c + 1, c = R - 1), void e(d, WebPDF.SearchDirection.Up, b, c, -1, h, i)
                            }
                            for (var l = c; l > j; l--) {
                                var m = J[l];
                                m.isSearched || (m.isSearched = !0, m.isHasResult = !1, J[l] = m)
                            }
                            return void e(d, WebPDF.SearchDirection.Up, b, j, -1, h, i)
                        } catch (n) {
                            return
                        }
                    }
                }

                function k() {
                    return null
                }
                var l = {
                        startpageindex: b,
                        endpageindex: c,
                        findtext: d,
                        flags: f,
                        searchDown: g,
                        password: a.getPDFPassword()
                    },
                    m = a.getOptions().url + "searchtext/pageindex",
                    n = {
                        url: m,
                        requestData: l
                    },
                    o = a.getDataControl(),
                    p = {
                        type: "searchTextPageIndex",
                        data: n,
                        success: j,
                        error: k
                    };
                o.searchTextPageIndex(p)
            }

            function z(b, c, e, f, h) {
                function i(a) {
                    var c = a.error;
                    if (0 !== c) return null;
                    try {
                        var e = $.parseJSON(a.searchResult);
                        "" === a.searchResult && $.isFunction(h) && h({
                            searchResult: "",
                            pageIndex: i
                        }), F = b;
                        var f = d(e.searchResult),
                            i = e.pageIndex,
                            j = new g(f);
                        $.isFunction(h) && h({
                            searchResult: j,
                            pageIndex: i
                        }), WebPDF.Environment.mobile
                    } catch (k) {
                        return null
                    }
                }

                function j() {
                    return null
                }
                if ("" != b) {
                    var k = a.getOptions().url + "searchtext",
                        l = A.getDataControl(),
                        m = {
                            findtext: b,
                            flags: e,
                            pageIndex: f,
                            count: c
                        },
                        n = {
                            url: k,
                            requestData: m,
                            password: a.getPDFPassword()
                        },
                        o = {
                            type: "seachAllText",
                            data: n,
                            success: i,
                            error: j
                        };
                    l.seachAllText(o)
                }
            }
            var A = a,
                B = !1,
                C = !1,
                D = !1,
                E = "",
                F = "",
                G = -1,
                H = -1,
                I = -1,
                J = [],
                K = [],
                L = A.getTextManager(),
                M = null,
                N = A.getAppId() + "_searchLoadingText",
                O = null,
                P = {},
                Q = !1,
                R = -1,
                S = !1,
                T = null,
                U = null,
                V = this,
                W = !1,
                X = null;
            this.setHighlightRects = function(a) {
                return O = [], O = a.concat()
            }, this.getHighlightRects = function() {
                return O
            }, this.clearHighlightRects = function() {
                O = []
            }, this.searchAllText = function(a, b, c, d, e) {
                x(a, b, c, d, e)
            }, this.cancelSearching = function() {
                B && (S = !0)
            }, this.setSearchLoadingCallback = function(a) {
                T = a
            }, this.setNotFoundCallback = function(a) {
                U = a
            }, this.searchTextDown = function(a, b, c) {
                if (!a) return console.warn("Search text cannot be null or empty"), !1;
                var d = v(a),
                    f = A.getMainView().getDocView().getCurPageIndex();
                return d ? e(a, WebPDF.SearchDirection.Down, d.pageIndex, R - 1, d.charIndex, b, c) : e(a, WebPDF.SearchDirection.Down, f, R - 1, -1, b, c)
            }, this.searchTextUp = function(a, b, c) {
                if (!a) return console.warn("Search text cannot be null or empty"), !1;
                var d = w(a),
                    f = A.getMainView().getDocView().getCurPageIndex();
                return d ? e(a, WebPDF.SearchDirection.Up, 0, d.pageIndex, d.charIndex, b, c) : e(a, WebPDF.SearchDirection.Up, 0, f, -1, b, c)
            }, this.setSeacrchedPageIndex = function(a) {
                G = a
            }, this.getSeacrchedPageIndex = function() {
                return G
            }, this.goActionHightSearchedText = function(a, b, c) {
                c(O, !0), this.curPageIndex = a, this.setHighlightRects(b), this.setSeacrchedPageIndex(a)
            }, this.init = function() {
                V.resetVar();
                var a = A.getMainView();
                if (a) {
                    var b = a.getDocView();
                    R = b.getPageCount();
                    for (var c = 0; R > c; c++) J[c] = new i;
                    A.isFindToolEventInit() || A.setFindToolEventInit(!0)
                }
            }, this.resetVar = function() {
                A = a, B = !1, C = !1, D = !1, E = "", F = "", G = -1, H = -1, I = -1, J = [], K = [], L = A.getTextManager(), M = null, N = A.getAppId() + "_searchLoadingText", O = null, P = {}, Q = !1, R = -1, S = !1, T = null, U = null, V = this, W = !1, X = null
            }
        }
        var e, f = WebPDF.PDFRect,
            g = a("core/Plugins/FindTool/SearchResult");
        WebPDF.SearchDirection = {
            Up: 0,
            Down: 1
        };
        var h = function() {
                this.startCharIndex = -1, this.relateText = "", this.rects = []
            },
            i = function() {
                this.pageIndex = -1, this.totalCharCnt = -1, this.curResultIndex = -1, this.resultList = [], this.isSearched = !1, this.isHasResult = !1, this.clearResult = function() {
                    this.pageIndex = -1, this.totalCharCnt = -1, this.curResultIndex = -1, this.resultList = [], this.isSearched = !1, this.isHasResult = !1
                }, this.isLastResult = function(a) {
                    return a === this.resultList.length - 1
                }, this.isFirstResult = function(a) {
                    return 0 === a
                }, this.getNextCharIndex = function(a) {
                    return null == this.resultList[a + 1] || void 0 == this.resultList[a + 1] ? 0 : this.resultList[a + 1].startCharIndex
                }, this.getPrevCharIndex = function(a) {
                    return null == this.resultList[a - 1] || void 0 == this.resultList[a - 1] ? 0 : this.resultList[a - 1].startCharIndex
                }, this.getLastCharIndex = function() {
                    var a = this.resultList.length - 1;
                    0 > a && (a = 0);
                    var b = this.resultList[a];
                    return b ? b.startCharIndex : 0
                }
            },
            j = function() {
                this.findWhat = "", this.resultRectArray = [], this.searchPos = -1, this.resultCharStartPos = -1, this.resultItemStartPos = -1, this.resultItemEndPos = -1, this.isMatchCase = !1, this.isMatchWholeWord = !1, this.isFound = !1
            },
            k = function() {
                this.startIndex = -1, this.endIndex = -1, this.resultCharStartPos = -1
            },
            l = function() {
                this.startCharIndex = -1, this.endCharIndex = -1
            },
            m = function(a, b) {
                this.pageIndex = a, this.charIndex = b
            };
        b.createSearchServie = function(a) {
            return null == e && (e = new d(a)), e
        }
    }), define("core/Plugins/FindTool/SearchResult", [], function(a, b, c) {
        return WebPDF.SearchResult = function(a) {
            for (var b = function(a, b) {
                    this.pageIndex = a, this.result = b, this.getPageIndex = function() {
                        return a
                    }, this.getResult = function() {
                        return b
                    }
                }, c = [], d = -1, e = a.length, f = 0; e > f; f++) {
                var g = a[f];
                if (g)
                    for (var h = g.resultList, i = 0; i < h.length; i++) {
                        var j = h[i];
                        d += 1;
                        var k = new b(f, j);
                        c[d] = k
                    }
            }
            this.count = function() {
                return c.length
            }, this.getContent = function(a) {
                if (a > c.length - 1) return null;
                for (var b = c[a], d = b.getResult(), e = d.relateText, f = e.search("\n", ""); - 1 !== f;) e = e.replace("\n", ""), f = e.search("\n", "");
                return e
            }, this.getPageIndex = function(a) {
                return a > c.length - 1 ? null : c[a].getPageIndex()
            }, this.getRects = function(a) {
                if (a > c.length - 1) return null;
                var b = c[a].getResult().rects,
                    d = [],
                    e = b.length;
                for (f = 0; e > f; f++) {
                    var g = b[f];
                    WebPDF.RectUtils.normalize(g), d.push(g)
                }
                return d
            }
        }, WebPDF.SearchResult
    }), define("core/Plugins/Annot/BaseAnnotPlugin", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Plugins/Annot/AnnotHandleManager", "core/Plugins/Annot/AnnotUIManager", "core/Common/CanvasUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/PDFAnnotationLoader", "core/Plugins/Annot/MarkupAnnotHandler", "core/Plugins/Annot/PopupMousePtHandler", "core/Plugins/Annot/PDFTypewriter", "core/Common/Interface", "core/Plugins/Annot/CommentAnnot/CommentAnnotHandler", "core/Plugins/Annot/CommentAnnot/CommentAnnotService", "core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", "core/Plugins/Annot/DrawingPropertyDlg", "core/Plugins/Annot/LinkAnnotHandler", "core/Plugins/Annot/TextAnnotHandler", "core/Plugins/Annot/TextAnnotView", "core/Plugins/Annot/TextAnnotService", "core/Plugins/Annot/TypewriterAnnotHandler", "core/Plugins/Annot/TypewriterAnnotView", "core/Plugins/Annot/TypewriterAnnotService", "core/Plugins/Annot/CalloutAnnotHandler", "core/Plugins/Annot/CalloutAnnotView", "core/Plugins/Annot/CalloutAnnotService", "core/Plugins/Annot/TextboxAnnotHandler", "core/Plugins/Annot/TextboxAnnotView", "core/Plugins/Annot/TextboxAnnotService", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService", "core/Plugins/Annot/DrawingAnnot/InkAnnotHandler", "core/Plugins/Annot/DrawingAnnot/InkAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotHandler", "core/Plugins/Annot/DrawingAnnot/CircleAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Plugins/Annot/DrawingAnnot/SquareAnnotView", "core/Plugins/Annot/DrawingAnnot/LineAnnotView", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotView", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DrawingAnnot/LineAnnotHandler", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotHandler", "core/Plugins/Annot/CommonMarkupAnnotHandler", "core/Plugins/Annot/StampAnnotHandler", "core/Plugins/Annot/ImageAnnot/ImageAnnotHandler", "core/Plugins/Annot/Undo/AnnotUndo", "core/Plugins/Annot/AnnotMousePtHandler", "core/Plugins/Annot/AnnotSelectionTool", "core/Plugins/TextSelection/PDFTextSelectTool", "core/Plugins/Text/PDFTextObject", "core/Plugins/Text/PDFTextPage", "core/Plugins/TextSelection/PDFTextPageSelect", "core/Plugins/Annot/TextAnnotToolHandler", "core/Plugins/Annot/AnnotFactory", "core/Plugins/Annot/PDFMarkup", "core/Plugins/Annot/CommentAnnot/CommentAnnot", "core/Plugins/Annot/PDFLink", "core/Plugins/Action/Action", "core/Plugins/Action/PDFDestination", "core/Plugins/Annot/PDFInk", "core/Plugins/Annot/PDFCallout", "core/Plugins/Annot/PDFTextBox", "core/Plugins/Annot/ImageAnnot/PDFImage", "core/Plugins/Signature/PDFSignature", "core/Plugins/InkSign/PDFInkSign", "core/Plugins/Annot/DrawingAnnot/PDFCircle", "core/Plugins/Annot/DrawingAnnot/PDFSquare", "core/Plugins/Annot/DrawingAnnot/PDFPolygon", "core/Plugins/Annot/DrawingAnnot/PDFLine", "core/Plugins/Annot/AnnotCommonView", "core/Plugins/Annot/TypewriterAnnotToolHandler", "core/Plugins/Annot/TextboxAnnotToolHandler", "core/Plugins/Annot/CalloutAnnotToolHandler", "core/Plugins/Annot/ImageAnnot/ImageAnnotToolHandler", "core/Plugins/Annot/StampAnnotToolHandler", "core/Plugins/Annot/PDFStamp", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/CircleTools", "core/Plugins/Annot/DrawingAnnot/SquareTools", "core/Plugins/Annot/DrawingAnnot/LineTools", "core/Plugins/Annot/DistanceAnnot/DistanceLineTool", "core/Plugins/Annot/DrawingAnnot/PolygonTools", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotToolHandler", "core/Plugins/Annot/DistanceAnnot/DistanceRulerView", "core/Plugins/Annot/DistanceAnnot/RulerView", "core/Plugins/Annot/DistanceAnnot/Ruler", "core/Plugins/Annot/DistanceAnnot/DistanceToolPopup", "core/Plugins/Annot/CommentAnnot/CommentAnnotToolHandler", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/InkAnnotToolHandler", "core/Plugins/Annot/DrawingAnnot/InkTools"], function(a, b, c) {
        a("core/Plugins/Annot/PDFAnnot"), WebPDF.Annot.MKA_POPUPWIDTH = 180, WebPDF.Annot.MKA_POPUPHEIGHT = 120, a("core/Plugins/Annot/AnnotHandleManager");
        WebPDF.Annot.AnnotFactory, a("core/Plugins/Annot/AnnotMousePtHandler");
        a("core/Plugins/Annot/AnnotSelectionTool");
        var d = WebPDF.Tools.AnnotSelectionToolHandler;
        a("core/Plugins/Annot/TextAnnotToolHandler");
        var e = WebPDF.Tools.TextAnnotToolHandler,
            f = a("core/Plugins/Annot/TypewriterAnnotToolHandler"),
            g = a("core/Plugins/Annot/TextboxAnnotToolHandler"),
            h = a("core/Plugins/Annot/CalloutAnnotToolHandler"),
            i = a("core/Plugins/Annot/ImageAnnot/ImageAnnotToolHandler"),
            j = a("core/Plugins/Annot/StampAnnotToolHandler"),
            k = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotToolHandler");
        a("core/Plugins/Annot/CommentAnnot/CommentAnnotToolHandler"), a("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotToolHandler"), a("core/Plugins/Annot/DrawingAnnot/InkAnnotToolHandler"), a("core/Plugins/Annot/PDFAnnotationLoader"), a("core/Plugins/Annot/AnnotFactory"), WebPDF.BASEANNOT_PLUGIN_NAME = "BaseAnnotPlugin";
        WebPDF.BaseAnnotPlugin = function(a) {
            function b() {
                l.getPDFDoc();
                o = !0, m.init();
                var a = new WebPDF.Event.AnnotMousePtHandler(n);
                l.registerMousePtHandler(a), p = new d(l, m), l.registerToolHandler(p), q = new e(n), l.registerToolHandler(q);
                var b = new f(WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TYPEWRITER, n);
                l.registerToolHandler(b);
                var c = new g(WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TEXTBOX, n);
                l.registerToolHandler(c);
                var r = new h(WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT, n);
                l.registerToolHandler(r);
                var s = new WebPDF.Event.CommentAnnotToolHandler(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT);
                l.registerToolHandler(s);
                var t = new WebPDF.Event.CommentAnnotToolHandler(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE);
                l.registerToolHandler(t);
                var u = new WebPDF.Event.CommentAnnotToolHandler(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY);
                l.registerToolHandler(u);
                var v = new WebPDF.Event.CommentAnnotToolHandler(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT);
                l.registerToolHandler(v);
                var w = new WebPDF.Event.CommentAnnotToolHandler(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE);
                l.registerToolHandler(w);
                var x = new WebPDF.Event.CommentAnnotToolHandler(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET);
                l.registerToolHandler(x);
                var y = new WebPDF.Event.AreaHighlightAnnotToolHandler(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT_AREA);
                l.registerToolHandler(y);
                var z = new WebPDF.Event.InkAnnotToolHandler;
                l.registerToolHandler(z);
                var A = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_CIRCLE);
                l.registerToolHandler(A);
                var B = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_POLYGON);
                l.registerToolHandler(B);
                var C = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE);
                l.registerToolHandler(C);
                var D = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_SQUARE);
                l.registerToolHandler(D);
                var E = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_LINE);
                l.registerToolHandler(E);
                var F = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_LINEARROW);
                l.registerToolHandler(F);
                var G = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_DISTANCE);
                l.registerToolHandler(G);
                var H = k.createDrawingAnnotToolHandle(WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD);
                l.registerToolHandler(H);
                var I = new i(n);
                l.registerToolHandler(I);
                var J = new j(n);
                l.registerToolHandler(J);
                for (var K = l.getMainView().getDocView(), L = K.getVisiblePageRange(), M = $("#" + K.getDocViewContainerID()), N = K.getDocViewDimension(), O = N.height, P = N.width, Q = M.offset(), R = L.begin; R <= L.end; R++) {
                    var S = K.getPageView(R);
                    S.isPageLoaded() && m.onPageVisible(S, P, O, Q, !0)
                }
                M.on("keydown", function(a) {
                    var b = a.keyCode || a.which;
                    46 == b && m.deleteSelection()
                })
            }

            function c() {
                $(l).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function(a, b) {
                    var c = l.getMainView();
                    if (c) {
                        var d = (c.getDocView(), this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME)),
                            e = null;
                        d && (e = d.getAnnotHandlerMgr()), e && e.onDocViewZoom(b.newScale)
                    }
                }).on(WebPDF.EventList.DOCVIEW_RESIZE, function() {
                    var a = l.getMainView();
                    if (a) {
                        var b = (a.getDocView(), this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME)),
                            c = null;
                        b && (c = b.getAnnotHandlerMgr()), c && c.onDocViewResize()
                    }
                }).on(WebPDF.EventList.DOCVIEW_PRE_RESIZE, function() {
                    var a = l.getMainView();
                    if (a) {
                        var b = (a.getDocView(), this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME)),
                            c = null;
                        b && (c = b.getAnnotHandlerMgr()), c && c.onPreDocViewResize()
                    }
                }).on(WebPDF.EventList.DOCVIEW_SCROLL, function() {
                    var a = l.getMainView();
                    if (a) {
                        var b = (a.getDocView(), this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME)),
                            c = null;
                        b && (c = b.getAnnotHandlerMgr()), c && c.onDocViewScroll()
                    }
                }).on(WebPDF.EventList.PAGE_INVISIBLE, function(a, b) {
                    var c = l.getMainView();
                    if (c) {
                        var d = c.getDocView(),
                            e = this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                            f = null;
                        if (e && (f = e.getAnnotHandlerMgr()), f)
                            for (var g = 0; g < b.pages.length; g++) f.onPageInvisible(d.getPageView(b.pages[g]))
                    }
                }).on(WebPDF.EventList.PAGE_SHOW_COMPLETE, function(a, b) {
                    var c = l.getMainView();
                    if (c) {
                        var d = (c.getDocView(), this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME)),
                            e = null;
                        d && (e = d.getAnnotHandlerMgr()), e && e.onPageShowComplete(b.pageView)
                    }
                }).on(WebPDF.EventList.PAGE_VISIBLE, function(a, b) {
                    var c = l.getMainView();
                    if (c) {
                        var d = c.getDocView(),
                            e = this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                            f = null;
                        if (e && (f = e.getAnnotHandlerMgr()), f) {
                            var g = !1;
                            b.isCommentsMenuClick && 1 == b.isCommentsMenuClick && (g = !0);
                            for (var h = 0; h < b.pages.length; h++) f.onPageVisible(d.getPageView(b.pages[h]), b.contentPanelWidth, b.contentPaneHeight, b.contentPanelOffset, b.isShowAnnots, g)
                        }
                    }
                }).on(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, function(a, b) {
                    var c = (l.getMainView().getDocView(), this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME)),
                        d = null;
                    c && (d = c.getAnnotHandlerMgr()), d && d.onRotate()
                })
            }
            var l = a,
                m = null,
                n = this,
                o = !1,
                p = null,
                q = null;
            this.getName = function() {
                return WebPDF.BASEANNOT_PLUGIN_NAME
            }, this.init = function() {
                m = new WebPDF.AnnotHandleManager(l, n), l.isAnnotEventInit() || (c(), l.setAnnotEventInit(!0));
                var a = new WebPDF.Annot.PDFAnnotationLoader;
                a.asyncLoadUserAnnotation(l, l.getPDFDoc(), b, $.noop)
            }, this.getAnnotationDataToSave = function() {
                for (var a = WebPDF.Tool.getReaderApp().getMainView().getDocView(), b = a.getPDFDoc(), c = b.getPageCount(), d = [], e = 0; c > e; e++) {
                    var f = a.getPageView(e);
                    if (f.isModified()) {
                        var g = {};
                        g.number = e;
                        var h = f.getPDFPage().getAnnotJsonData();
                        g.annots = h, d.push(g)
                    }
                }
                return d
            }, this.saveAnnots = function(b, c, d, e, f, g, h, i, j) {
                var k = WebPDF.Tool.getReaderApp().getMainView().getDocView();
                if (!k.isModified() && d) return e && e(0), void($.isFunction(h) && h());
                var m = l.getDocPermission();
                if (!m.isAnnot && !m.isForm && !m.isSignature) return f ? f(-1) : WebPDF.alert(l, "", i18n.t("CheckInOut.SaveCommentsFailedMsg")), void($.isFunction(h) && h());
                var o = i18n.t("CommonDialog.WaitMsgSave"),
                    p = n.getAnnotationDataToSave();
                j && WebPDF.waiting(null, null, o);
                var q = {
                    filePath: WebPDF.Tool.getReaderApp().getFileID(),
                    data: JSON.stringify(p),
                    checkin: !b,
                    v: WebPDF.Tool.getReaderApp().getDocVersion(),
                    cm: c,
                    modifyed: k.isModified()
                };
                $.ajax({
                    type: "post",
                    url: a.getOptions().url + "save",
                    headers: {
                        "x-auth-doc": a.getPDFPassword()
                    },
                    data: q,
                    dataType: "json",
                    success: function(b) {
                        if (j && WebPDF.closeWaiting({}), null == b) return WebPDF.alert(l, "", i18n.t("CommonDialog.SaveCommentsFailedMsg")), f && f(-1), void($.isFunction(i) && i());
                        var c = "",
                            d = b.error;
                        if (0 != d) {
                            var g = !1;
                            c = i18n.t("Error.UnknownError") + d, f && f(d), WebPDF.alert(l, "", c, FXREADER.DialogType.MB_ICONERROR, null, null, g), $.isFunction(i) && i()
                        } else {
                            for (var m = p.length, n = {}, o = 0; m > o; o++) {
                                var q = p[o],
                                    r = q.number,
                                    s = k.getPageView(r).getPDFPage(),
                                    t = s.getAnnotsMap();
                                for (var u in t) {
                                    var v = t[u];
                                    v.isVisible() || v.isAnnotSource() || (n[u] = 1)
                                }
                                s.deleteAnnots(n), WebPDF.Engine.SR && k.getPageView(r).setModified(!1)
                            }
                            a.updateVersion(b.version), k.setModified(!1), null != e && e(d), $.isFunction(h) && h()
                        }
                    },
                    error: function() {
                        f && f(WebPDF.CheckInOutErrorCode.ERROR_CHECK_INOUT_EXCEPTION), WebPDF.closeWaiting({}), d ? $.isFunction(i) && i(i18n.t("CheckInOut.SaveCommentsFailedMsg")) : $.isFunction(i) && i(i18n.t("CheckInOut.CheckInFailedMsg"))
                    }
                })
            }, this.onAnnotLButtonDown = function(a, b, c) {
                return m.onAnnotLButtonDown(a, b, c)
            }, this.onAnnotLButtonUp = function(a, b, c) {
                return m.onAnnotLButtonUp(a, b, c)
            }, this.onAnnotLButtonDblClk = function(a, b, c) {
                return m.onAnnotLButtonDblClk(a, b, c)
            }, this.onAnnotMouseMove = function(a, b, c) {
                return m.onAnnotMouseMove(a, b, c)
            }, this.onAnnotMouseOver = function(a, b, c) {
                return m.onAnnotMouseOver(a, b, c)
            }, this.onAnnotMouseLeave = function(a, b, c) {
                return m.onAnnotMouseLeave(a, b, c)
            }, this.onAnnotRButtonDown = function(a, b, c) {
                return m.onAnnotRButtonDown(a, b, c)
            }, this.onAnnotHold = function(a, b, c) {
                return m.onAnnotHold(a, b, c)
            }, this.onAnnotChangeRectClick = function(a, b, c) {
                return m.onAnnotChangeRectClick(a, b, c)
            }, this.onAnnotChangeRectFinish = function(a, b, c) {
                return m.onAnnotChangeFinish(a, b, c)
            }, this.onAnnotChangePointFinish = function(a, b, c) {
                return m.onAnnotChangePointFinish(a, b, c)
            }, this.onAnnotChangeRectMove = function(a, b, c, d) {
                return m.onAnnotChangeRectMove(a, b, c, d)
            }, this.onAnnotChangePointMove = function(a, b, c, d, e, f) {
                return m.onAnnotChangePointMove(a, b, c, d, e, f)
            }, this.onAnnotChangePointFinish = function(a, b, c) {
                return m.onAnnotChangePointFinish(a, b, c)
            }, this.onRegister = function() {}, this.unload = function() {
                m && (m.clear(), delete m), m = null
            }, this.getReaderApp = function() {
                return l
            }, this.registerAnnotHandler = function(a) {
                m.registerAnnotHandler(a)
            }, this.getAnnotHandlerMgr = function() {
                return m
            }
        }, b.createPlugin = function(a) {
            return new WebPDF.BaseAnnotPlugin(a)
        }
    }), define("core/Plugins/Annot/PDFAnnot", ["core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        function d(a, b) {
            return WebPDF.Tool.getReaderApp().getAnnotEditCallback()({
                fileId: WebPDF.ViewerInstance.getFileID(),
                annotName: a.getAnnotName(),
                pageIndex: a.pageIndex,
                userId: WebPDF.AccountInstance.getUserAccount(),
                action: b
            })
        }
        a("core/Plugins/Annot/Annot"), a("core/Common/Math/Point");
        var e = a("core/Common/Math/Rect");
        WebPDF.Annot.AnnotType = {
            MarkUp: "Markup",
            Link: "Link",
            Widget: "Widget",
            TypeWriter: "Typewriter",
            Callout: "Callout",
            Text: "Text",
            Ink: "Ink",
            Stamp: "Stamp",
            Circle: "Circle",
            Polygon: "Polygon",
            PolyLine: "PolyLine",
            Cloud: "Cloud",
            Square: "Square",
            Line: "Line",
            Distance: "Distance",
            FreeText: "FreeText",
            Textbox: "Textbox",
            Image: "Screen"
        };
        var f = {
            ANNOTFLAG_INVISIBLE: 1,
            ANNOTFLAG_HIDDEN: 2,
            ANNOTFLAG_PRINT: 4,
            ANNOTFLAG_NOZOOM: 8,
            ANNOTFLAG_NOROTATE: 16,
            ANNOTFLAG_NOVIEW: 32,
            ANNOTFLAG_READONLY: 64,
            ANNOTFLAG_LOCKED: 128,
            ANNOTFLAG_TOGGLENOVIEW: 256
        };
        WebPDF.Annot.AnnotFlag = f, WebPDF.Annot.BorderStyle = {
            BBS_SOLID: 0,
            BBS_DASH: 1,
            BBS_BEVELED: 2,
            BBS_INSET: 3,
            BBS_UNDERLINE: 4
        }, WebPDF.Annot.AnnotDataJSONFormat = {
            type: "ty",
            flag: "f",
            rect: "rc",
            content: "c",
            name: "n",
            borderWidth: "bw",
            borderStyle: "bs",
            color: "cl",
            fillColor: "fcl",
            dash: "d",
            highlight: "hl",
            quadPoints: "Quad",
            destinationInfo: "ds",
            openState: "op",
            modifyDate: "md",
            state: "st",
            stateModel: "stm",
            opacity: "ca",
            creationDate: "cd",
            subject: "subj",
            title: "tit",
            popup: "pop",
            replyChain: "rpy",
            stateList: "stat",
            action: "act",
            group: "grp",
            subType: "subty",
            textAnnotName: "txtn",
            ft: "ft",
            fontSize: "fs",
            fontColor: "fc",
            fontName: "ftn",
            lineHeight: "lnh",
            fontHeight: "fh",
            textAlign: "q",
            it: "it",
            inkList: "ikl",
            inkColor: "ikc",
            inkBorderWidth: "ikw",
            vts: "vts",
            lineRect: "l",
            lineStyle: "le",
            rotate: "r",
            pdf: "pdf",
            del: "del",
            icon: "stamp_ic",
            dynamic: "dyna",
            dyflag: "df",
            dyContents: "dc",
            rectDiffer: "rd",
            freeCoordinatesLine: "ftcl",
            cpdfUserId: "userId",
            imageStream: "stream",
            areahi: "areahi",
            replyType: "rt",
            inreplyto: "irt",
            grp: "grp",
            cap: "cap"
        };
        var g = WebPDF.Annot.AnnotDataJSONFormat;
        return WebPDF.Annot.PDFAnnot = function(a, b) {
            this.annotJSONData = a, this.actionList = {}, this.isSourceAnnot = !0, this.pageIndex = b, this._isShowInViewer = !0
        }, WebPDF.Annot.PDFAnnot.prototype = {
            getType: function() {
                return this.annotJSONData[g.type]
            },
            getSubType: function() {
                return this.annotJSONData[g.subType]
            },
            getFlags: function() {
                return this.annotJSONData[g.flag]
            },
            getRotate: function() {
                return "undefined" != typeof this.annotJSONData[g.rotate] && null != this.annotJSONData[g.rotate] ? this.annotJSONData[g.rotate] : 0
            },
            setFlags: function(a) {
                this.annotJSONData[g.flag] = a
            },
            isVisible: function() {
                var a = this.getFlags();
                return !(a & f.ANNOTFLAG_HIDDEN || a & f.ANNOTFLAG_NOVIEW)
            },
            canBePrint: function() {
                var a = this.getFlags();
                return 0 != (a & f.ANNOTFLAG_PRINT)
            },
            hide: function() {
                this.setFlags(this.getFlags() | f.ANNOTFLAG_HIDDEN)
            },
            show: function() {
                this.setFlags(this.getFlags() & ~f.ANNOTFLAG_HIDDEN)
            },
            showInViewer: function() {
                this._isShowInViewer = !0
            },
            hideInViewer: function() {
                this._isShowInViewer = !1
            },
            isShowInViewer: function() {
                return this._isShowInViewer
            },
            getRect: function() {
                var a = this.annotJSONData[g.rect];
                if (!a) return a;
                var b = new e(a[0], a[1], a[2], a[3]);
                return b
            },
            getSubject: function() {
                return "undefined" == typeof this.annotJSONData[g.subject] ? "" : this.annotJSONData[g.subject]
            },
            setRect: function(a) {
                var b = this.annotJSONData[g.rect];
                b[0] = a.left, b[1] = a.top, b[2] = a.right, b[3] = a.bottom
            },
            setRectDiffer: function(a) {
                var b = this.annotJSONData[g.rectDiffer];
                b[0] = a.left, b[1] = a.top, b[2] = a.right, b[3] = a.bottom
            },
            getRectDiffer: function() {
                var a = this.annotJSONData[g.rectDiffer];
                if (!a) return a;
                var b = new e(a[0], a[1], a[2], a[3]);
                return b
            },
            getContents: function() {
                return this.annotJSONData[g.content]
            },
            setContents: function(a) {
                this.annotJSONData[g.content] = a
            },
            getAnnotName: function() {
                return this.annotJSONData[g.name]
            },
            setAnnotName: function(a) {
                this.annotJSONData[g.name] = a
            },
            setBorderWidth: function(a) {
                this.annotJSONData[g.borderWidth] = a
            },
            getBorderWidth: function() {
                return this.annotJSONData[g.borderWidth]
            },
            setBorderStyle: function(a) {
                this.annotJSONData[g.borderStyle] = a
            },
            getBorderStyle: function() {
                return this.annotJSONData[g.borderStyle]
            },
            setColor: function(a) {
                this.annotJSONData[g.color] = a
            },
            getColor: function() {
                return this.annotJSONData[g.color]
            },
            getFillColor: function() {
                return this.annotJSONData[g.fillColor]
            },
            getDashArray: function() {
                return this.annotJSONData[g.dash]
            },
            getOpacity: function() {
                return this.annotJSONData[g.opacity]
            },
            setOpacity: function(a) {
                this.annotJSONData[g.opacity] = a
            },
            getTitle: function() {
                return this.annotJSONData[g.title]
            },
            getQuadPoints: function() {
                return this.annotJSONData[g.quadPoints]
            },
            setQuadPoints: function(a) {
                this.annotJSONData[g.quadPoints] = a
            },
            getModifyDate: function() {
                return this.annotJSONData[g.modifyDate]
            },
            setModifyDate: function(a) {
                this.annotJSONData[g.modifyDate] = a
            },
            getCreationDate: function() {
                return this.annotJSONData[g.creationDate]
            },
            setCreationDate: function(a) {
                this.annotJSONData[g.creationDate] = a
            },
            getIntent: function() {
                return this.annotJSONData[g.it]
            },
            getState: function() {
                return this.annotJSONData[g.state]
            },
            getTextAlign: function() {
                return this.annotJSONData[g.textAlign]
            },
            isAnnotSource: function() {
                return this.isSourceAnnot
            },
            setSourceAnnot: function(a) {
                this.isSourceAnnot = a
            },
            getAnnotJSONData: function() {
                return this.annotJSONData
            },
            isAnnotDel: function() {
                return this.annotJSONData[g.del]
            },
            setDel: function(a) {
                this.annotJSONData[g.del] = a
            },
            exportPropertyToXFDF: function(a, b) {
                if ("FreeText" === this.getSubType()) {
                    var c = this.getFillColor();
                    c && b.setAttribute("color", c)
                } else {
                    var c = this.getColor();
                    c && b.setAttribute("color", c)
                }
                var d = this.getModifyDate();
                d && (d = WebPDF.Common.timestampToPDFTimeString(d), b.setAttribute("date", d));
                var e = "",
                    f = this.getFlags();
                0 != f && (f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_INVISIBLE && (e += "invisible"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_HIDDEN && (e += ",hidden"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT && (e += ",print"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_NOZOOM && (e += ",nozoom"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_NOROTATE && (e += ",norotate"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_NOVIEW && (e += ",noview"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_READONLY && (e += ",readonly"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_LOCKED && (e += ",locked"), f & WebPDF.Annot.AnnotFlag.ANNOTFLAG_TOGGLENOVIEW && (e += ",togglenoview"), "" != e && ("," === e.substr(0, 1) && (e = e.substr(1, e.length)), b.setAttribute("flags", e)));
                var g = this.getAnnotName();
                g && b.setAttribute("name", g);
                var h = this.getRect();
                if (h) {
                    h = WebPDF.Tool.getReaderApp().getPDFDoc().getPage(this.pageIndex).transRectToPDF(h), WebPDF.RectUtils.normalize(h);
                    var i = String.Format("{0},{1},{2},{3}", h.left, h.bottom, h.right, h.top);
                    b.setAttribute("rect", i)
                }
                var j = this.getTitle();
                j && b.setAttribute("title", j);
                var k = this.getRotate();
                k && b.setAttribute("rotate", k);
                var l = this.getContents();
                if (l) {
                    var m = a.createElement("contents"),
                        n = a.createTextNode(l);
                    m.appendChild(n), b.appendChild(m)
                }
            },
            setBorderStyleToNode: function(a, b) {
                b === WebPDF.Annot.BorderStyle.BBS_SOLID ? a.setAttribute("style", "solid") : b === WebPDF.Annot.BorderStyle.BBS_DASH ? a.setAttribute("style", "dash") : b === WebPDF.Annot.BorderStyle.BBS_BEVELED ? a.setAttribute("style", "bevelled") : b === WebPDF.Annot.BorderStyle.BBS_INSET ? a.setAttribute("style", "inset") : b === WebPDF.Annot.BorderStyle.BBS_UNDERLINE && a.setAttribute("style", "underline")
            },
            canReplay: function() {
                if (WebPDF.Common.checkAnnotaFlag(this.annotJSONData.f, WebPDF.Annot.AnnotFlag.ANNOTFLAG_READONLY)) return !1;
                if (WebPDF.ConnectPdf && WebPDF.Tool.getReaderApp().getPDFDoc().isCReview() && this.getUserId()) {
                    var a = WebPDF.AccountInstance.getUserId();
                    return this.getUserId() === a ? !0 : !1
                }
                return $.isFunction(WebPDF.Tool.getReaderApp().getAnnotEditCallback()) ? d(this, "replay") : !0
            },
            isReadOnly: function() {
                if (WebPDF.Common.checkAnnotaFlag(this.annotJSONData.f, WebPDF.Annot.AnnotFlag.ANNOTFLAG_READONLY)) return !0;
                if (WebPDF.ConnectPdf && WebPDF.Tool.getReaderApp().getPDFDoc().isCReview() && this.getUserId()) {
                    var a = WebPDF.AccountInstance.getUserId();
                    return this.getUserId() === a ? !1 : !0
                }
                return $.isFunction(WebPDF.Tool.getReaderApp().getAnnotEditCallback()) ? !d(this, "edit") : !1
            },
            setUserId: function(a) {
                this.annotJSONData[g.cpdfUserId] = a
            },
            getUserId: function() {
                return this.annotJSONData[g.cpdfUserId]
            },
            isDifferentFrom: function(a) {
                if (null === a || void 0 === a) throw new Error("unexpected argument error: otherAnnot == null");
                var b = this,
                    c = b._compareFields();
                if (void 0 === c || null === c || c.length < 1) return !1;
                var d = b.annotJSONData,
                    e = a.annotJSONData;
                for (var f in c) {
                    var g = c[f],
                        h = d[g],
                        i = e[g],
                        j = "function" == typeof h.isDifferentFrom && h.isDifferentFrom(i) || h !== i;
                    if (j) return !0
                }
                return !1
            },
            _compareFields: function() {
                return [g.rotate, g.flag, g.title, g.subject, g.borderWidth, g.borderStyle, g.color, g.fillColor, g.opacity, g.dash, g.textAlign]
            }
        }, WebPDF.Annot.PDFAnnot
    }), define("core/Plugins/Annot/Annot", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.Annot = {}, d.Annot
    }), define("core/Plugins/Annot/AnnotHandleManager", ["core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/PDFAnnotationLoader", "core/Plugins/Annot/MarkupAnnotHandler", "core/Plugins/Annot/PopupMousePtHandler", "core/Plugins/Annot/PDFTypewriter", "core/Plugins/Annot/PDFAnnot", "core/Common/Math/Point", "core/Common/Interface", "core/Plugins/Annot/CommentAnnot/CommentAnnotHandler", "core/Plugins/Annot/CommentAnnot/CommentAnnotService", "core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", "core/Plugins/Annot/DrawingPropertyDlg", "core/Plugins/Annot/LinkAnnotHandler", "core/Plugins/Annot/TextAnnotHandler", "core/Plugins/Annot/TextAnnotView", "core/Plugins/Annot/TextAnnotService", "core/Plugins/Annot/TypewriterAnnotHandler", "core/Plugins/Annot/TypewriterAnnotView", "core/Plugins/Annot/TypewriterAnnotService", "core/Plugins/Annot/CalloutAnnotHandler", "core/Plugins/Annot/CalloutAnnotView", "core/Plugins/Annot/CalloutAnnotService", "core/Plugins/Annot/TextboxAnnotHandler", "core/Plugins/Annot/TextboxAnnotView", "core/Plugins/Annot/TextboxAnnotService", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService", "core/Plugins/Annot/DrawingAnnot/InkAnnotHandler", "core/Plugins/Annot/DrawingAnnot/InkAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotHandler", "core/Plugins/Annot/DrawingAnnot/CircleAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Plugins/Annot/DrawingAnnot/SquareAnnotView", "core/Plugins/Annot/DrawingAnnot/LineAnnotView", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotView", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DrawingAnnot/LineAnnotHandler", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotHandler", "core/Plugins/Annot/CommonMarkupAnnotHandler", "core/Plugins/Annot/StampAnnotHandler", "core/Plugins/Annot/ImageAnnot/ImageAnnotHandler", "core/Plugins/Annot/Undo/AnnotUndo"], function(a, b, c) {
        a("core/Plugins/Annot/AnnotUIManager"), a("core/Plugins/Annot/PDFAnnotationLoader");
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect,
            f = WebPDF.RectUtils,
            g = WebPDF.Common.Direc;
        a("core/Plugins/Annot/MarkupAnnotHandler"), a("core/Plugins/Annot/PDFTypewriter");
        var h = a("core/Common/CanvasUtils"),
            i = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            j = a("core/Plugins/Annot/CommentAnnot/CommentAnnotHandler"),
            k = a("core/Plugins/Annot/LinkAnnotHandler"),
            l = a("core/Plugins/Annot/TextAnnotHandler"),
            m = a("core/Plugins/Annot/TypewriterAnnotHandler"),
            n = a("core/Plugins/Annot/CalloutAnnotHandler"),
            o = a("core/Plugins/Annot/TextboxAnnotHandler"),
            p = a("core/Plugins/Annot/DrawingAnnot/InkAnnotHandler"),
            q = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotHandler"),
            i = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            r = a("core/Plugins/Annot/CommonMarkupAnnotHandler"),
            s = a("core/Plugins/Annot/StampAnnotHandler"),
            t = a("core/Plugins/Annot/ImageAnnot/ImageAnnotHandler"),
            u = a("core/Plugins/Annot/Undo/AnnotUndo");
        return WebPDF.AnnotHandleManager = function(a, b) {
            function c() {
                if (E.isAnnot()) {
                    var a = "<div id='" + J + "'><ul id='" + K + "' class='fwrContextMenu fwr-cm-default' style='left: 341px; top: 167px; display: none;'></div>";
                    $(document.body).append(a);
                    var b = '<li class="icon" style="width: 120px;display: none" id="open_property" menuname="property">' + i18n.t("AnnotProperties.Title") + '</li><li id="reply_annot" class="icon" style="width: 120px;" menuname="ReplyAnnot">' + i18n.t("Annot.Reply") + '</li><li id="delete_annot" class="icon" style="width: 120px;" menuname="DeleteAnnot">' + i18n.t("Annot.DeleteAnnotMenuItem") + "</li>";
                    $("#" + K).append(b);
                    var c = '<span id="pupup-replyannot-span" style="display: none;"> <strong></strong></span>';
                    $("body").append(c)
                }
            }

            function v() {
                var b = null;
                b = j.createCommentAnnotHandle(E, M, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE), M.registerAnnotHandler(b), b = j.createCommentAnnotHandle(E, M, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT), M.registerAnnotHandler(b), b = j.createCommentAnnotHandle(E, M, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY), M.registerAnnotHandler(b), b = j.createCommentAnnotHandle(E, M, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT), M.registerAnnotHandler(b), b = j.createCommentAnnotHandle(E, M, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE), M.registerAnnotHandler(b), b = j.createCommentAnnotHandle(a, M, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET), M.registerAnnotHandler(b), b = j.createCommentAnnotHandle(E, M, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT_AREA), M.registerAnnotHandler(b), b = new k(E, M), M.registerAnnotHandler(b), b = new l(E, M), M.registerAnnotHandler(b), b = new m(E, WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TYPEWRITER, M), M.registerAnnotHandler(b), b = new n(E, WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT, M), M.registerAnnotHandler(b), b = new o(E, WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TEXTBOX, M), M.registerAnnotHandler(b), b = new p(E, M), M.registerAnnotHandler(b), b = q.createDrawingAnnotHandle(E, M, WebPDF.Annot.AnnotType.Circle), M.registerAnnotHandler(b), b = q.createDrawingAnnotHandle(E, M, WebPDF.Annot.AnnotType.Square), M.registerAnnotHandler(b), b = q.createDrawingAnnotHandle(E, M, WebPDF.Annot.AnnotType.Polygon), M.registerAnnotHandler(b), b = q.createDrawingAnnotHandle(E, M, WebPDF.Annot.AnnotType.PolyLine), M.registerAnnotHandler(b), b = q.createDrawingAnnotHandle(E, M, WebPDF.Annot.AnnotType.Cloud), M.registerAnnotHandler(b), b = q.createDrawingAnnotHandle(E, M, WebPDF.Annot.AnnotType.Line), M.registerAnnotHandler(b), b = q.createDrawingAnnotHandle(E, M, WebPDF.Annot.AnnotType.Distance), M.registerAnnotHandler(b), b = new s(E, M), M.registerAnnotHandler(b), M.registerAnnotHandler(new t(E, M)), b = new r(E, M, WebPDF.CommonMarkupHandler), M.registerAnnotHandler(b)
            }

            function w() {
                for (var a = E.getMainView().getDocView().getPDFDoc().getPageCount(), b = 0; a > b; b++) Y[b] = !1
            }

            function x(a) {
                if (!E.isMobile())
                    for (var b = $(a), c = b.length - 1; c >= 0; c--) {
                        var d = $(b[c]);
                        if (0 != d.children().length) {
                            var e = $(d.children()[0]),
                                f = $(e.children()[0]),
                                g = $(e.children()[1]);
                            (f.width() || g.width() || $(d.children()).width()) && f.width() + g.width() + 15 >= $(d.children()).width() && (g.css({
                                "float": "none",
                                "white-space": "nowrap",
                                "text-overflow": "ellipsis",
                                overflow: "hidden",
                                "padding-left": "15px"
                            }), f.width() >= $(d.children()).width() && f.css({
                                "float": "none",
                                "white-space": "nowrap",
                                "text-overflow": "ellipsis",
                                overflow: "hidden"
                            }), e.off("mouseover").on("mouseover", function(a) {
                                if ($("#pupup-replyannot-span").is(":visible")) return !0;
                                var b = $(a.target).parent().children(),
                                    c = $(b[0]),
                                    d = $(b[1]);
                                $("#pupup-replyannot-span").html(c.html() + "<br>" + d.html()), $("#pupup-replyannot-span").css({
                                    left: a.pageX + 10,
                                    top: a.pageY + 18
                                }), $("#pupup-replyannot-span").show()
                            }), e.off("mouseleave").on("mouseleave", function() {
                                $("#pupup-replyannot-span").hide()
                            }))
                        }
                    }
            }

            function y(a) {
                var b = a.annotJSONData.subty;
                b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE || b == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET || "Screen" === b || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY || "Ink" === b || "FreeText" === b || "TextBox" === b ? a.isReadOnly() || $("#" + J).find("#open_property").show() : $("#" + J).find("#open_property").hide(), a.canReplay() && "FreeText" !== b && "TextBox" !== b && "Screen" !== b ? $("#" + J).find("#reply_annot").show() : $("#" + J).find("#reply_annot").hide(), a.isReadOnly() ? $("#" + J).find("#delete_annot").hide() : $("#" + J).find("#delete_annot").show()
            }

            function z(a, b, c) {
                var d, g, h, i, j = a.getPageViewWidth(),
                    k = a.getPageViewHeight(),
                    l = a.getDocView().getRotate(),
                    m = b - Q,
                    n = c - R,
                    o = new e,
                    p = !0,
                    q = new e;
                for (var r in G) {
                    if (g = G[r], i = aa.getAnnotMoveDivID(a, r), d = document.getElementById(i)) {
                        var s = $(d);
                        q.top = parseFloat(s.css("top")), q.left = parseFloat(s.css("left")), q.bottom = q.top + parseFloat(s.css("height")), q.right = q.left + parseFloat(s.css("width"))
                    } else h = g.getRect(), q = a.pdfRectToDevice(h, !0);
                    p ? f.copy(q, o) : f.union(o, q), p = !1
                }
                if (m > 0) {
                    var t = 0;
                    90 == l ? (m = -m, t = o.top + m, 0 > t && (m = -o.top)) : 180 == l ? (m = -m, t = o.left + m, 0 > t && (m = -o.left)) : 270 == l ? (t = o.bottom + m, t > j && (m = j - o.bottom)) : (t = o.right + m, t > j && (m = j - o.right))
                } else {
                    var u = 0;
                    90 == l ? (m = -m, u = o.bottom + m, u > j && (m = j - o.bottom)) : 180 == l ? (m = -m, u = o.right + m, u > j && (m = j - o.right)) : 270 == l ? (u = o.top + m, 0 > u && (m = -o.top)) : (u = o.left + m, 0 > u && (m = 0 - o.left))
                }
                if (n > 0) {
                    var v = 0;
                    90 == l ? (v = o.right + n, v > k && (n = k - o.right)) : 180 == l ? (n = -n, v = o.top + n, 0 > v && (n = -o.top)) : 270 == l ? (n = -n, v = o.left + n, 0 > v && (n = -o.left)) : (v = o.bottom + n, v > k && (n = k - o.bottom))
                } else {
                    var w = 0;
                    90 == l ? (w = o.left + n, 0 > w && (n = -o.left)) : 180 == l ? (n = -n, w = o.bottom + n, w > k && (n = k - o.bottom)) : 270 == l ? (n = -n, w = o.right + n, w > k && (n = k - o.right)) : (w = o.top + n, 0 > w && (n = 0 - o.top))
                }
                return {
                    x: m,
                    y: n
                }
            }

            function A(a) {
                return Math.sqrt(a.x * a.x + a.y * a.y)
            }

            function B(a) {
                var b = a,
                    c = new d(1, 0),
                    e = b.x * c.x + b.y * c.y,
                    f = e / (A(b) * A(c));
                return Math.acos(f)
            }

            function C(a) {
                return WebPDF.Environment.safari && 1 > a ? 1 : a
            }

            function D(a, b, c) {
                for (var d in G) {
                    var e = G[d];
                    if (!e || "Polygon" !== e.getSubType() && "PolyLine" !== e.getSubType()) {
                        if (e && "Callout" === e.getType()) {
                            var f = M.canAnswer(e);
                            if (f) {
                                var g = f.getCurPointIndex(I, e, c);
                                f.addCursor(I, e, g)
                            }
                        }
                    } else {
                        var f = M.canAnswer(e);
                        if (f) {
                            var h = -1;
                            h = f.isInPolygonPoint(I, e, c), f.addCursor(I, e, h)
                        }
                    }
                }
                var i = E.getCurToolHandler();
                if (b && "Link" === b.getSubType() && i && i.getName() === WebPDF.Tools.TOOL_NAME_HAND) {
                    var f = M.canAnswer(b);
                    if (!f) return;
                    "mousemove" === c.type ? f.addCursor(aa, a, b) : f.removeCursor(aa, a, b)
                }
            }
            var E = a,
                F = {},
                G = {},
                H = null,
                I = null,
                J = "fwr-annots-context-menu-container",
                K = "fwr-annots-context-menu",
                L = null,
                M = this,
                N = !1,
                O = new WebPDF.Annot.PDFAnnotationLoader,
                P = !1,
                Q = 0,
                R = 0,
                S = 0,
                T = 0,
                U = null,
                V = !0,
                W = !1,
                X = {},
                Y = [],
                Z = [],
                _ = WebPDF.Tool.getReaderApp().getMainView().getDocView().getDocViewContainerID() + "_AnnotCanvas",
                aa = new WebPDF.Annot.AnnotUIManager(this, E);
            this.init = function() {
                w(), aa.init(), v(), L = new WebPDF.MarkupAnnotHandler(E, M), L.init(), M.bindAnnotEvents(), c();
                var a = WebPDF.Tool.getReaderApp().getMainView().getDocView();
                a.getVisiblePageRange(), $("#" + a.getDocViewContainerID()), a.getPageView(0)
            }, this.clear = function() {
                $("#" + J).remove(), $("#fwrCommentPropertyDlg").remove(), L && L.clear()
            }, this.getMarkupAnnotHandler = function() {
                return L
            }, this.getContextMenuId = function() {
                return K
            }, this.isPageAnnotCreated = function(a) {
                return X[a]
            }, this.onDocViewZoom = function(a) {
                w();
                for (var b = E.getMainView().getDocView(), c = b.getVisiblePageRange(), d = $("#" + b.getDocViewContainerID()), e = b.getDocViewDimension(), f = e.height, g = e.width, h = d.offset(), i = c.begin; i <= c.end; i++) M.onPageVisible(b.getPageView(i), g, f, h, V);
                for (var j in Z) {
                    var k = Z[j];
                    Y[k] === !1 && M.onPageVisible(b.getPageView(k), g, f, h, V)
                }
                if (Z.length = 0, $("#" + K).get(0)) {
                    var l = $("#" + K),
                        m = l.attr("page-index"),
                        n = b.getPageView(m),
                        o = l.data("pdfRect");
                    if (n) {
                        var p = n.pdfRectToDevice(o, !0);
                        l.css({
                            top: p.top,
                            left: p.left
                        })
                    }
                }
            }, this.onRotate = function() {
                for (var a = E.getMainView().getDocView(), b = a.getVisiblePageRange(), c = b.begin; c <= b.end; c++) {
                    var d = a.getPageView(c),
                        e = d.getPDFPage();
                    e.enumAnnots(function(a) {
                        var b = M.getAnnotHandler(a.getSubType());
                        b && $.isFunction(b.onRotate) && b.onRotate(d, a)
                    })
                }
            }, this.onPageVisible = function(a, b, c, d, e, f) {
                if (V = e, !a || a.isPageLoadError()) return !1;
                var g = a.getPageIndex();
                if (!X[g]) return !1;
                if (a.getPageUpdateState() && (M.showAnnots(a, e, f), a.setPageUpdateState(!1)), Y[g]) return M.rotatePopupAnnots(a), !1;
                var h = M.getAnnotVisibleRect(a, d, b, c);
                return M.updateAnnotsPosition(a, h), Y[g] = !0, M.rotatePopupAnnots(a), !0
            }, this.onPageShowComplete = function(b) {
                function c(a, c) {
                    if (!X[c]) {
                        var d = M.createAnnotsHtmlContent(b);
                        $("#" + b.getPageViewContainerID()).append(d), x(".popup_child.fwr-annot-reply"), M.drawAnnots(b, !1), X[c] = !0, E.isReadOnly() && $(".fwr-popup-annot").hide();
                        var e = E.getPluginByName(WebPDF.SignaturePluginName);
                        e && e.createPageSignatureSignHtml(a, b)
                    }
                    var f = E.getMainView().getDocView(),
                        g = $("#" + f.getDocViewContainerID()),
                        h = f.getDocViewDimension(),
                        i = h.height,
                        j = h.width,
                        k = g.offset();
                    M.onPageVisible(b, j, i, k, V)
                }
                if (!b || b.isPageLoadError()) return !1;
                var d = b.getPageIndex();
                return b.isLoadAnnot() && (b.isCommentListLoaded() ? c(!0, d) : O.asyncLoadPDFAnnotation(E, E.getPDFDoc(), d, function(d) {
                    var e = a.getMainView().getDocView();
                    b = e.getPageView(d), c(!1, d);
                    var f = b.getPDFPage(),
                        g = f.getAnnotJsonData(),
                        h = e.getPageAnnotUnLoad();
                    if (WebPDF.Common.arrayRemove(h, d), g) {
                        for (var i = [], j = 0; j < g.length; j++) {
                            var k = f.getAnnotByName(g[j].n);
                            k && M.needShowComment(k.getSubType()) && (k.getInreplyto && k.getInreplyto() || i.push(M.packageAnnot(k)))
                        }
                        0 != i.length && $(E).trigger(WebPDF.EventList.ANNOT_ADDED, {
                            pageIndex: d,
                            annotsArr: i,
                            pageAnnotUnload: h,
                            isShow: V
                        });
                        for (var j = 0; j < g.length; j++) {
                            var k = f.getAnnotByName(g[j].n),
                                l = aa.getCommentAnnotDivID(b, g[j].n),
                                m = $("#" + l);
                            M.getCanvasDrawSquiggly(m, k)
                        }
                    }
                }, $.noop)), !0
            }, this.onPageInvisible = function(a) {
                return !0
            }, this.registerAnnotHandler = function(a) {
                if (null != a) {
                    var b = a.getType();
                    try {
                        null != F[b] && $.error("The annotation handler '" + b + "' has already been registered!"), F[b] = a
                    } catch (c) {
                        console.error(c)
                    }
                }
            }, this.getAnnotHandler = function(a) {
                var b = F[a];
                if (null != b) return b;
                for (var c in F)
                    if (c.toUpperCase() == a.toUpperCase()) return F[c]
            }, this.getAnnotHandlerByAnnot = function(a) {
                var b = a.getType();
                switch (b) {
                    case WebPDF.Annot.AnnotType.MarkUp:
                        var c = a.getHeadAnnot();
                        return null != c ? M.getAnnotHandler(c.getSubType()) : a.getIntent && "LineDimension" === a.getIntent() ? M.getAnnotHandler(WebPDF.Annot.AnnotType.Distance) : $.isFunction(a.getIT) && a.getIT() && "PolygonCloud" == a.getIT() ? M.getAnnotHandler("Cloud") : $.isFunction(a.getIT) && a.getIT() && "StrikeOutTextEdit" == a.getIT() ? M.getAnnotHandler("Replace") : M.getAnnotHandler(a.getSubType());
                    case WebPDF.Annot.AnnotType.TypeWriter:
                    case WebPDF.Annot.AnnotType.Callout:
                    case WebPDF.Annot.AnnotType.Textbox:
                        return M.getAnnotHandler(a.getIT());
                    default:
                        return null
                }
            }, this.canAnswer = function(a, b, c) {
                if (null == a || "undefine" == a) return null;
                var d = a.getType();
                switch (d) {
                    case WebPDF.Annot.AnnotType.MarkUp:
                        if (a.isVisible()) {
                            var e = a.getHeadAnnot();
                            if (null != e) {
                                var f = M.getAnnotHandler(e.getSubType());
                                return $.isFunction(a.getIT) && a.getIT() && "PolygonCloud" == a.getIT() && (f = M.getAnnotHandler("Cloud")), null == f && (f = M.getAnnotHandler(WebPDF.CommonMarkupHandler)), null != f ? N || c ? f : f.canAnswer(e, b) ? f : null : null
                            }
                            var g;
                            return g = "LineDimension" === a.getIntent() ? M.getAnnotHandlerByAnnot(a) : M.getAnnotHandler(a.getSubType()), $.isFunction(a.getIT) && a.getIT() && "PolygonCloud" == a.getIT() && (g = M.getAnnotHandler("Cloud")), null == g && (g = M.getAnnotHandler(WebPDF.CommonMarkupHandler)), null != g ? N || c ? g : g.canAnswer(a, b) ? g : null : null
                        }
                        break;
                    case WebPDF.Annot.AnnotType.TypeWriter:
                    case WebPDF.Annot.AnnotType.Callout:
                    case WebPDF.Annot.AnnotType.Textbox:
                        var g = M.getAnnotHandler(a.getIT());
                        return null != g ? N || c ? g : g.canAnswer(a, b) ? g : null : null;
                    case WebPDF.Annot.AnnotType.Link:
                        var g = M.getAnnotHandler("Link");
                        return null != g ? N || c ? g : g.canAnswer(a, b) ? g : null : null;
                    default:
                        return null
                }
            }, this.clearSelection = function() {
                for (var a in G) {
                    var b = G[a],
                        c = M.getAnnotHandlerByAnnot(b);
                    c && c.onDeSelected(I, b)
                }
                G = {}, H = null, I = null, $("#" + K).hide(), $(E).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                    deAnnotName: null,
                    pageIndex: null
                })
            }, this.setFocusAnnot = function(a, b) {
                H = b, I = a, b.getType() === WebPDF.Annot.AnnotType.MarkUp && null != b.getHeadAnnot() && (H = b.getHeadAnnot());
                var c = M.getAnnotHandlerByAnnot(H);
                c && c.onFocus(a, b)
            }, this.setPopupFocus = function(a, b) {
                var c = b.getAnnotName(),
                    d = aa.getAnnotPopupDivID(a, c),
                    e = $("#" + d),
                    f = e[0];
                L.setFocusAnnotByTarget(f, !0), I = a, M.addSelection(b)
            }, this.updateAnnotContent = function(a, b, c, d, e) {
                if ("undefined" != typeof c) {
                    var f = c;
                    f = f.replace(/<\/p>$ /, ""), f = f.replace(/(<p><br><\/p>)|(<div><br><\/div>)/g, "\n"), f = f.replace(/(<p>)|(<div>)/g, ""), f = WebPDF.Common.htmlDecode(f), f = f.replace(/<br>/g, "\n"), f = f.replace(/(<\/p>)|(<\/div>)/g, "\n"), f = f.replace(/<[^<>]*>/g, "");
                    var g = E.getDocView(),
                        h = g.getPageView(a),
                        i = h.getPDFPage(),
                        j = i.getAnnotByName(b);
                    if (j) {
                        if (d || j.setContents(f), j.isReply) {
                            var k = $("#" + b).find(".fwr_popup_content")[0];
                            k && ("undefined" != typeof k.innerText ? k.innerText = f : k.textContent = f)
                        } else if (j.getType() == WebPDF.Annot.AnnotType.TypeWriter) {
                            var l = $("#" + aa.getTypewriterAnnotRectDivID(h, b));
                            if (l[0].value = f, l.data("before", l.val()), !e) {
                                var m = $("#" + g.getDocViewContainerID()),
                                    n = m.height(),
                                    o = m.width(),
                                    p = m.offset(),
                                    q = this.getAnnotVisibleRect(h, p, o, n);
                                this.updateAnnotsPosition(h, q, j)
                            }
                        } else if (j.getType() === WebPDF.Annot.AnnotType.Callout) {
                            var l = $("#" + aa.getCalloutAnnotRectDivID(h, b));
                            if (l[0].value = f, l.data("before", l.val()), !e) {
                                var m = $("#" + g.getDocViewContainerID()),
                                    n = m.height(),
                                    o = m.width(),
                                    p = m.offset(),
                                    q = this.getAnnotVisibleRect(h, p, o, n);
                                this.updateAnnotsPosition(h, q, j)
                            }
                        } else if (j.getType() === WebPDF.Annot.AnnotType.Textbox) {
                            var l = $("#" + aa.getTextboxAnnotRectDivID(h, b));
                            l[0].value = f, l.data("before", l.val());
                            var r = this.getAnnotHandlerByAnnot(j);
                            if (r.updateAnnotContent(h, j), !e) {
                                var m = $("#" + g.getDocViewContainerID()),
                                    n = m.height(),
                                    o = m.width(),
                                    p = m.offset(),
                                    q = this.getAnnotVisibleRect(h, p, o, n);
                                this.updateAnnotsPosition(h, q, j)
                            }
                        } else if (j.getType() === WebPDF.Annot.AnnotType.MarkUp) {
                            var k = $("#" + aa.getAnnotPopupDivID(h, b)).find(".fwr_popup_content")[0];
                            k && ("undefined" != typeof k.innerText ? k.innerText = f : k.textContent = f)
                        }
                        E.setModified(h, g, !0)
                    }
                }
            }, _deleteAnnot = function(a, b, c, d, e) {
                var f = a.getPDFPage(),
                    g = f.getAnnotByName(b),
                    h = g.getReplyAnnotByName(c);
                if (g.isReply && 1 == $("#" + c).parent().children("li").length) {
                    var i = $("#" + c).parent().parent(),
                        j = $(i).find(".fwr-replys-state")[0];
                    $(j).children().hide()
                }
                $("#" + c).remove();
                h.getReplyAnnotByName(c);
                if (h.isSourceAnnot ? h.setDel(1) : g.delReplyAnnotByName(c), !e) {
                    var k = [],
                        l = {
                            isReply: !0,
                            parentAnnotName: b,
                            annotJSONData: h.annotJSONData
                        };
                    k.push(l);
                    var m = new u(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_DELETE, k);
                    E.addAnnotUndo(m)
                }
                var n = {
                    annotName: c,
                    pageIndex: a.getPageIndex(),
                    isReply: h.isReply
                };
                d && (n = {
                    annotName: c,
                    pageIndex: a.getPageIndex(),
                    isReply: h.isReply,
                    annotObject: h
                }), $(E).trigger(WebPDF.EventList.ANNOT_DELETED, n)
            }, this.deleteReplyAnnot = function(a, b, c, d) {
                var e = M.getMarkupAnnotHandler();
                if (e && e.popupMousePtHandler) {
                    var f = E.getDocView(),
                        g = f.getPageView(a);
                    return E.isMobile() ? (parentAnnotName = $("#" + b).parent().parent().attr("id"), parentAnnotName.match(/[0-9a-fA-F]*/)[0] !== parentAnnotName && (parentAnnotName = $("#" + b).closest(".fwr-popup-annot").attr("annot-name"))) : (parentAnnotName = $($("#" + b).siblings()[0]).attr("annot-name"), parentAnnotName || (parentAnnotName = $("#" + b).closest(".fwr-popup-annot").attr("annot-name"))), _deleteAnnot(g, parentAnnotName, b, c, d), E.setModified(g, f, !0), $("#" + K).hide(), !0
                }
                return !1
            }, _addReply = function(a, b, c, d) {
                var e = a.addReplyAnnot(),
                    f = [],
                    g = {
                        isReply: !0,
                        parentAnnotName: a.getAnnotName(),
                        annotJSONData: e.annotJSONData
                    };
                f.push(g);
                var h = new u(d, WebPDF.Annot.UndoType.ANNOT_CREATE, f);
                E.addAnnotUndo(h);
                var i = M.getUIManager().genReplyAnnotHTML(e, 10, d, a.getTitle());
                $(b).append(i);
                var j = ".fwr-annot-reply[annot-name='" + e.getAnnotName() + "']";
                if (x(j), !c) {
                    var k = $($(b).find("#" + e.getAnnotName())).find(".fwr_popup_content");
                    $(k).focus()
                }
                var l = M.packageAnnot(e);
                l.parent = a.getAnnotName(), l.isParentReply = a.isReply, c && (l.from = "cmt"), e.parent = a.getAnnotName(), $(E).trigger(WebPDF.EventList.ANNOT_ADDED, {
                    pageIndex: d,
                    annot: l,
                    annotObject: e
                })
            }, _getReplyParentDOM = function(a, b, c) {
                var d, e;
                if (E.isMobile()) {
                    if (a.isReply) {
                        d = $("#" + a.getAnnotName()), e = d.children("ul");
                        var f = $("#" + a.getAnnotName()).find(".fwr-replys-state")[0];
                        "none" != $($(f).children()[1]).css("display") && $(f).trigger("tap"), $($(f).children()[0]).show()
                    } else {
                        var g = "#docViewer_ViewContainer_PageContainer_" + b + "_Popup_" + a.getAnnotName();
                        if (d = $($(g).children().children()[1]), e = d.children("ul"), c && !$(g).is(":visible")) {
                            var h = M.canAnswer(a),
                                i = E.getDocView().getPageView(b);
                            h.onLButtonDblClk(i, a, event)
                        }
                    }
                    0 == e.length && (ulEle = "<ul></ul>", d.append(ulEle), e = d.children("ul"))
                } else {
                    var j, k;
                    if (a.isReply) {
                        d = $("#" + a.getAnnotName()), e = $(d).children()[1];
                        var j = d.closest(".fwr-popup-annot"),
                            l = E.getDocView(),
                            i = l.getPageView(b),
                            m = i.getPDFPage();
                        k = m.getAnnotByName($(j).attr("annot-name")).getPopup()
                    } else {
                        var n = "#docViewer_ViewContainer_PageContainer_" + b + "_Popup_" + a.getAnnotName();
                        e = $($(n).children()[2]), j = $(n), k = a.getPopup()
                    }
                    c ? ($(j).show(), k.setOpenState(1)) : ($(j).hide(), k.setOpenState(0))
                }
                return e
            }, this.addReplyByJson = function(a, b, c, d) {
                if (a) {
                    var e = a.addReplyAnnotByJson(b, c),
                        f = _getReplyParentDOM(a, c, !0),
                        g = M.getUIManager().genReplyAnnotHTML(e, 10, c, a.getTitle());
                    $(f).append(g);
                    var h = ".fwr-annot-reply[annot-name='" + e.getAnnotName() + "']";
                    x(h);
                    var i = M.packageAnnot(e);
                    i.parent = a.getAnnotName(), i.isParentReply = a.isReply;
                    var j = {
                        pageIndex: c,
                        annot: i
                    };
                    return d && (j = {
                        pageIndex: c,
                        annot: i,
                        annotObject: e
                    }), $(E).trigger(WebPDF.EventList.ANNOT_ADDED, j), e
                }
                return null
            }, this.replyAnnot = function(a, b, c) {
                var d = M.getMarkupAnnotHandler();
                if (d && d.popupMousePtHandler) {
                    var e = E.getDocView(),
                        f = e.getPageView(a),
                        g = f.getPDFPage(),
                        h = g.getAnnotByName(b),
                        i = _getReplyParentDOM(h, a, c);
                    _addReply(h, $(i), !c, a), E.setModified(f, e, !0), $("#" + K).hide()
                }
            }, this.isFreeText = function(a, b) {
                var c = E.getDocView().getPageView(b).getPDFPage().getAnnotByName(a);
                return "getSubType" in c && "FreeText" == c.getSubType() ? !0 : !1
            }, this.onAnnotMenuSelect = function(a, b) {
                if (null != a) try {
                    var c = a.attr("menuname");
                    if ("DeleteAnnot" == c) {
                        var d = $(b.target).parent().attr("annot-name"),
                            e = $(b.target).parent().attr("page-index");
                        d && e && E.getDocView().getPageView(e).getPDFPage().getAnnotByName(d).isReply ? this.deleteReplyAnnot(e, d, !0) : M.deleteSelection()
                    } else if ("property" === c) $("#" + K).hide(), M.setSelectionProperty(b);
                    else if ("ReplyAnnot" === c) {
                        if (parentAnnotName = $(b.target).parent().attr("annot-name"), e = $(b.target).parent().attr("page-index"), !parentAnnotName && !e) {
                            var f = H;
                            if (!f) return;
                            parentAnnotName = f.getAnnotName(), f.getInreplyto && f.getInreplyto() && (parentAnnotName = f.getInreplyto()), e = parseInt($($("[annot-name='" + parentAnnotName + "']")[0]).attr("page-index"))
                        }
                        this.replyAnnot(e, parentAnnotName, !0)
                    }
                } catch (g) {}
            }, this.addSelection = function(a, b) {
                var c = a.getAnnotName();
                G[c] = a;
                var d = M.getAnnotHandlerByAnnot(a);
                if (y(a), d && d.onSelected(I, a)) {
                    if (WebPDF.Environment.mobile) return;
                    $(".fwr-annot-selected, .fwr-annot-comment-selected").fwrContextMenu(K, {
                        onSelect: function(a, b) {
                            return M.onAnnotMenuSelect($(this), a)
                        }
                    }, document.getElementById(E.getMainFrameId()))
                }
                if (!b) {
                    if (a.getInreplyto && a.getInreplyto()) {
                        var e = I.getPDFPage().getAnnotByName(a.getInreplyto());
                        M.addSelection(e, !0)
                    }
                    if (a.getGrp && a.getGrp()) {
                        var f = I.getPDFPage().getAnnotByName(a.getGrp());
                        M.addSelection(f, !0)
                    }
                }
            }, this.selectAnnot = function(a, b, c) {
                if (b.getType() === WebPDF.Annot.AnnotType.MarkUp) {
                    var d = b.getHeadAnnot();
                    if (null != d) {
                        M.addSelection(d);
                        var e = d.getGroupAnnotMap();
                        for (var f in e) {
                            var g = e[f];
                            M.addSelection(g)
                        }
                    } else M.addSelection(b)
                } else M.addSelection(b);
                var h = null;
                h = c ? {
                    annotName: b.getAnnotName(),
                    pageIndex: a.getPageIndex(),
                    annotObject: b
                } : {
                    annotName: b.getAnnotName(),
                    pageIndex: a.getPageIndex()
                }, b.getInreplyto && b.getInreplyto() && (h.annotName = b.getInreplyto()), $(E).trigger(WebPDF.EventList.ANNOT_SELECTED, h)
            }, this.selectAnnotsByRect = function(a, b) {
                var c = !0,
                    d = a.getPDFPage();
                d.enumAnnots(function(d) {
                    if (!d._isShowInViewer) return !0;
                    var e = M.canAnswer(d);
                    if (null != e) {
                        var g = d.getRect();
                        f.normalize(g), f.intersect(g, b), f.isEmpty(g) || (c && (M.setFocusAnnot(a, d), c = !1), M.selectAnnot(a, d))
                    }
                    return !0
                })
            }, this.selectAnnotBycommentList = function(a, b, c) {
                if (a && a.isLoadAnnot())
                    if (M.clearSelection(), b.isReply) {
                        var d = $($("#" + b.getAnnotName()).children()[1]).children()[0];
                        $(".fwr-popup-annot-focus").removeClass("fwr-popup-annot-focus");
                        var e = $("#" + b.getAnnotName()).closest(".fwr-popup-annot");
                        $(e).addClass("fwr-popup-annot-focus"), b.isReadOnly() || ($(d).attr("contenteditable", "true"), $(d).addClass("annot-content-editing"), aa.placeCaretAtEnd(d));
                        var f = null;
                        f = c ? {
                            annotName: b.getAnnotName(),
                            pageIndex: a.getPageIndex(),
                            annotObject: b
                        } : {
                            annotName: b.getAnnotName(),
                            pageIndex: a.getPageIndex()
                        }, $(E).trigger(WebPDF.EventList.ANNOT_SELECTED, f)
                    } else M.setFocusAnnot(a, b), M.selectAnnot(a, b, c);
                else setTimeout(function() {
                    M.selectAnnotBycommentList(a, b)
                }, 500)
            }, this.clickOnAnnot = function(a, b, c) {
                if (b != I && M.clearSelection(), document.getElementById(b.getDocView().getDocViewContainerID()).focus(), H) {
                    if (null != G[a.getAnnotName()]) return;
                    c ? M.addSelection(a) : (M.clearSelection(), M.setFocusAnnot(b, a), M.selectAnnot(b, a))
                } else M.setFocusAnnot(b, a), M.selectAnnot(b, a)
            }, this.onAnnotLButtonDown = function(a, b, c) {
                P = !1;
                var d = E.getCurToolHandler();
                if (!(null == b || $.isFunction(d.getIsOnDraw) && d.getIsOnDraw())) {
                    var e = M.canAnswer(b);
                    if (!e) return !1;
                    if (e.onLButtonDown(a, b, c)) {
                        if (c) {
                            var f = c.shiftKey,
                                g = c.ctrlKey,
                                h = !0;
                            f || g || (h = !1)
                        }
                        M.clickOnAnnot(b, a, h);
                        var i = $("#fwrCommentPropertyDlg");
                        i && 1 === i.length && !i.is(":hidden") && M.setSelectionProperty(c)
                    }
                    return b.isReadOnly() || !e.canMove(b.getSubType()) && "Link" != b.getSubType() ? !0 : ($(".fwr-annot-move-div").remove(), P = !0, R = c.pageY, Q = c.pageX, T = R, S = Q, "Link" != b.getSubType() ? (U = null, WebPDF.Common.preventDefaults(c, !0)) : U = "Link", !0)
                }
                if (null != c.target.getAttribute("menuname")) return !1;
                var j = E.getCurToolHandler();
                return j.getName() !== WebPDF.Tools.TOOL_NAME_STAMP && M.clearSelection(), !1
            }, this.isProcessing = function() {
                return P || W
            }, this._isSelectionCanMove = function() {
                if (!E.isEditable()) return !1;
                var a;
                for (var b in G) {
                    var c = G[b];
                    if (a = M.canAnswer(c), !a) return !1;
                    if (!a.canMove(c.getSubType())) return !1
                }
                return !0
            }, this.onAnnotMouseMove = function(a, b, c) {
                D(a, b, c);
                var d = !1;
                if (P) {
                    if ("Link" == U) d = !0;
                    else if (M._isSelectionCanMove()) {
                        var f = z(I, c.pageX, c.pageY);
                        if (0 === f.x && 0 === f.y) return !0;
                        var g, h, i, j = I.getDocView().getRotate();
                        new e;
                        for (var k in G) {
                            h = G[k];
                            var l = !1;
                            if (h && "Callout" === h.getType()) {
                                var m = M.canAnswer(h);
                                m && (l = m.onMouseMove(I, h, c))
                            } else if (h && ("Polygon" === h.getSubType() || "PolyLine" === h.getSubType())) {
                                var m = M.canAnswer(h);
                                m && (l = M.onAnnotChangePointMove(I, h, c))
                            }
                            if (!l) {
                                var n = $("#" + aa.getAnnotDivID(I, k));
                                if (i = aa.getAnnotMoveDivID(I, k), g = document.getElementById(i)) {
                                    var o = $(g);
                                    90 == j || 270 == j ? o.css("left", parseFloat(o.css("left")) + f.y + "px").css("top", parseFloat(o.css("top")) + f.x + "px") : o.css("left", parseFloat(o.css("left")) + f.x + "px").css("top", parseFloat(o.css("top")) + f.y + "px")
                                } else {
                                    var p = "",
                                        q = "";
                                    90 == j || 270 == j ? (p = "left:" + (parseFloat(n.css("left")) + f.y) + "px;top:" + (parseFloat(n.css("top")) + f.x) + "px;", p += "width:" + n.css("width") + ";height:" + n.css("height") + ";", q = "<div id='" + i + "' style='" + p + "' class='fwr-annot-move-div'/>") : (p = "left:" + (parseFloat(n.css("left")) + f.x) + "px;top:" + (parseFloat(n.css("top")) + f.y) + "px;", p += "width:" + n.css("width") + ";height:" + n.css("height") + ";", q = "<div id='" + i + "' style='" + p + "' class='fwr-annot-move-div'/>"), n.after(q)
                                }
                            }
                        }
                    } else d = !0;
                    R = c.pageY, Q = c.pageX
                }
                return d
            }, this.onAnnotRButtonDown = function(a, b, c) {
                if (null == a && null == b) return $("#" + K).hide(), !1;
                var d = (M.getAnnotHandlerByAnnot(b), E.getCurToolHandler());
                if ($.isFunction(d.getIsOnDraw) && d.getIsOnDraw()) return $("#" + K).hide(), !1;
                var e = 0;
                for (var f in G) {
                    var g = G[f];
                    g && e++
                }
                return e >= 1 && M.clearSelection(), $(document).trigger("click.fwrContextMenu"), M.setFocusAnnot(a, b), M.selectAnnot(a, b), $(E).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                    annotName: b.getAnnotName(),
                    pageIndex: a.getPageIndex()
                }), !0
            }, this.onAnnotLButtonUp = function(a, b, c) {
                if (P)
                    if (b && "Link" == b.getSubType()) {
                        var d = c.pageX,
                            e = c.pageY;
                        if (!d || !e) {
                            var f = c.originalEvent.changedTouches[0];
                            d = f.pageX, e = f.pageY
                        }
                        if (d == S && e == T) {
                            var g = M.canAnswer(b);
                            g.onLButtonUp(a, b, c)
                        }
                    } else if (I) {
                    var h, i, j, k, l, m, n, o, g, p, q, r = I.getDocView(),
                        s = E.getPixelsPerPoint(),
                        t = (I.getScale() * s, new Date),
                        v = t.valueOf(),
                        w = Math.floor(v / 1e3).toString(),
                        x = [];
                    for (var y in G)
                        if (h = G[y], g = M.getAnnotHandlerByAnnot(h), g && (i = aa.getAnnotMoveDivID(I, y), j = document.getElementById(i))) {
                            o = $(j), k = h.getRect();
                            var z, A, B, C, D, F, H = k;
                            "Line" === h.getSubType() ? (z = h.getStartPoint(), A = h.getEndPoint()) : "Ink" === h.getSubType() ? C = WebPDF.Common.clone(h.getInkList()) : "Callout" === h.getType() && (D = h.getRectDiffer(), F = h.getFreeCoordinatesLine()), l = I.pdfRectToDevice(k, !0, 0), p = parseFloat(o.css("left")), q = parseFloat(o.css("top")), "Polygon" === h.getSubType() || "PolyLine" === h.getSubType() ? (m = p - l.left, n = q - l.top, B = h.getVts()) : (m = 0 === p ? p - l.left + 6 : p - l.left, n = 0 === q ? q - l.top + 6 : q - l.top), l.left = p, l.top = q, l.right = l.right + m, l.bottom = l.bottom + n, k = I.deviceRectToPDF(l, !0, 0), h.setRect(k), g.moveAnnot(I, h, m, n, p, q), h.setModifyDate(w), E.setModified(I, r, !0);
                            var J = {
                                name: h.getAnnotName(),
                                newRect: k,
                                oldRect: H
                            };
                            "Line" === h.getSubType() ? (J.newStartPoint = h.getStartPoint(), J.oldStartPoint = z, J.newEndPoint = h.getEndPoint(), J.oldEndPoint = A) : "Polygon" === h.getSubType() || "PolyLine" === h.getSubType() ? (J.newVts = h.getVts(), J.oldVts = B) : "Ink" === h.getSubType() ? (J.oldInkList = C, J.newInkList = WebPDF.Common.clone(h.getInkList())) : "Callout" === h.getType() && (J.oldRectDiffer = D, J.newRectDiffer = h.getRectDiffer(), J.oldFreeCoordLine = F, J.newFreeCoordLine = h.getFreeCoordinatesLine()), x.push(J);
                            var K = {
                                annot: this.packageAnnot(h),
                                pageIndex: I.getPageIndex(),
                                annotObject: h
                            };
                            $(E).trigger(WebPDF.EventList.ANNOT_UPDATED, K)
                        }
                    if (x.length > 0) {
                        var L = new u(I.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_MOVE, x);
                        E.addAnnotUndo(L)
                    }
                    aa.removeAnnotMoveDiv()
                }
                if (b && "Callout" === b.getType()) {
                    var g = M.canAnswer(b);
                    g && g.onAnnotLButtonUp(I, b, c)
                } else if (b && ("Polygon" === b.getSubType() || "PolyLine" === b.getSubType())) {
                    var g = M.canAnswer(b);
                    g && I && g.onAnnotLButtonUp(I, b, c)
                }
                return P = !1, W = !1, !1
            }, this.onAnnotHold = function(a, b, c) {
                function d(a, b) {
                    var c, d = $("#" + K).width(),
                        e = a.getPageViewWidth();
                    return c = b.pageX + d > e ? e - d : b.pageX, {
                        left: c
                    }
                }
                if (null == b) return !1;
                var e = $("#" + K),
                    f = M.getAnnotHandlerByAnnot(b);
                if (!f || !f.onSelected(I, b)) return void e.hide();
                e.show();
                var g = c.srcEvent;
                c.srcEvent.touches && (g = c.srcEvent.touches[0]);
                var h = d(a, g);
                e.attr("annot-name", b.getAnnotName()), e.attr("page-index", a.getPageIndex());
                var i = g.pageY;
                i + e.height() > $(window).height() && (i -= e.height());
                var j = h.left;
                j + e.width() > $(window).width() && (j -= e.width()), e.css({
                    left: j,
                    top: i,
                    display: "block",
                    zIndex: 1e3
                });
                var k = e.width(),
                    l = e.height(),
                    m = ($("#docViewer_ViewContainer").offset(), {
                        top: i,
                        left: j,
                        bottom: i + l,
                        right: j + k
                    }),
                    n = a.getDocView(),
                    o = n.getRotate(),
                    p = a.deviceRectToPDF(m, !0, o);
                e.data("pdfRect", p);
                var q = $("#delete_annot,#open_property,#reply_annot");
                return q.off("tap").tap(function(a) {
                    return M.onAnnotMenuSelect($(this), a), !1
                }), !0
            }, this.onAnnotChangeRectClick = function(a, b, c) {
                if (b.isReadOnly()) return !0;
                W = !1;
                var d = {
                    x: 0,
                    y: 0
                };
                return aa.resetCanvens(a), aa.createAnnotMoveDiv(a, b, d), R = c.pageY, Q = c.pageX, !0
            }, this.onAnnotChangePointFinish = function(a, b, c) {
                if (aa.removeCanvans(), b.isReadOnly()) return !0;
                W = !1;
                var d = a.getDocView(),
                    e = new Date,
                    f = e.valueOf() + 6e4 * e.getTimezoneOffset(),
                    g = Math.floor(f / 1e3).toString();
                return b.setModifyDate(g), E.setModified(a, d, !0), !0
            }, this.onAnnotChangeFinish = function(a, b, c) {
                if (aa.removeCanvans(), b.isReadOnly()) return !0;
                W = !1;
                var d, e, f, g, h, j = a.getDocView(),
                    k = E.getPixelsPerPoint();
                a.getScale() * k;
                if (h = M.getAnnotHandlerByAnnot(b), null === h) return !1;
                var l = !0;
                if ($.isFunction(h.onAnnotChangeFinish)) l = h.onAnnotChangeFinish(a, b);
                else {
                    var m = b.getAnnotName();
                    d = aa.getAnnotMoveDivID(a, m), e = document.getElementById(d), g = aa.getElemRect(e);
                    var n = i.adjust(a, b);
                    WebPDF.RectUtils.deflateEx(g, n), f = a.deviceRectToPDF(g, !0, 0);
                    var o = b.getRect();
                    b.setRect(f), h.changeRect(a, b, g);
                    var p = {
                            name: b.getAnnotName(),
                            newRect: b.getRect(),
                            oldRect: o
                        },
                        q = [];
                    q.push(p);
                    var r = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_MOVE, q);
                    E.addAnnotUndo(r)
                }
                if (!l) return aa.removeAnnotMoveDiv(), !0;
                var s = Date.now(),
                    t = Math.floor(s / 1e3).toString();
                b.setModifyDate(t), E.setModified(a, j, !0), aa.removeAnnotMoveDiv();
                var u = {
                    annot: this.packageAnnot(b),
                    pageIndex: a.getPageIndex(),
                    annotObject: b
                };
                return $(E).trigger(WebPDF.EventList.ANNOT_UPDATED, u), !0
            }, this.onAnnotChangeRectMove = function(a, b, c, d) {
                if (b.isReadOnly()) return !0;
                var e = a.getPageViewRect();
                if (!f.ptInRect(e, c.pageX, c.pageY)) return !1;
                var g = M.getAnnotHandlerByAnnot(b);
                if (null === g) return !1;
                if (Q != c.pageX && c.pageY != R) {
                    if (W = !0, $.isFunction(g.onAnnotChangeRectMove)) return g.onAnnotChangeRectMove(a, b, c, d, Q, R), !0;
                    var h = b.getAnnotName(),
                        i = aa.getAnnotMoveDivID(a, h),
                        j = (document.getElementById(i), b.getRect()),
                        k = null;
                    k = a.pdfRectToDevice(j, !0), this.geometricScalingRect(a, b, k, c.pageX, c.pageY, Q, R, d) && aa.changeAnnotRectMove(a, b, k)
                }
                return !0
            }, this.onAnnotChangePointMove = function(a, b, c) {
                if (b.isReadOnly()) return !0;
                var d = !1,
                    e = a.getPageViewRect();
                if (!f.ptInRect(e, c.pageX, c.pageY)) return !1;
                var g = M.getAnnotHandlerByAnnot(b);
                return null === g ? !1 : ($.isFunction(g.onAnnotChangePointMove) && (W = !0, d = g.onAnnotChangePointMove(a, b, c)), d)
            }, this.geometricScalingRect = function(a, b, c, d, e, f, g, h) {
                var i = $.extend(!0, {}, c),
                    j = this.getGeometricScalingOffset(a, b, i, d, e, f, g, h);
                return 0 != j.x && 0 != j.y ? (this.calculateRectBydirec(a, c, h, j), !0) : !1
            }, this.calculateRectBydirec = function(a, b, c, d) {
                var e = 60 * E.getPixelsPerPoint(),
                    f = WebPDF.RectUtils.width(b),
                    h = WebPDF.RectUtils.height(b);
                switch (c) {
                    case g.LEFT_TOP:
                        d.y > 0 && d.x < 0 ? d.x = -d.x : d.y < 0 && d.x > 0 && (d.y = -d.y);
                        var i = b.top + d.y,
                            j = b.left + d.x;
                        f > h ? b.right - j < e && (j = b.right - e, i = b.bottom - h * e / f) : b.bottom - i < e && (i = b.bottom - e, j = b.right - f * e / h), b.top = i, b.left = j;
                        break;
                    case g.RIGHT_TOP:
                        d.y < 0 && d.x < 0 ? d.y = -d.y : d.y > 0 && d.x > 0 && (d.x = -d.x);
                        var i = b.top + d.y,
                            k = b.right + d.x;
                        f > h ? k - b.left < e && (k = b.left + e, i = b.bottom - h * e / f) : b.bottom - i < e && (i = b.bottom - e, k = b.left + f * e / h), b.top = i, b.right = k;
                        break;
                    case g.LEFT_BOTTOM:
                        d.y < 0 && d.x < 0 ? d.x = -d.x : d.y > 0 && d.x > 0 && (d.y = -d.y);
                        var j = b.left + d.x,
                            l = b.bottom + d.y;
                        f > h ? b.right - j < e && (j = b.right - e, l = b.top + h * e / f) : l - b.top < e && (l = b.top + e, j = b.right - f * e / h), b.left = j, b.bottom = l;
                        break;
                    case g.RIGHT_BOTTOM:
                        d.y > 0 && d.x < 0 ? d.y = -d.y : d.y < 0 && d.x > 0 && (d.x = -d.x);
                        var k = b.right + d.x,
                            l = b.bottom + d.y;
                        f > h ? k - b.left < e && (k = b.left + e, l = b.top + h * e / f) : l - b.top < e && (l = b.top + e, k = b.left + f * e / h), b.right = k, b.bottom = l;
                        break;
                    case g.LEFT:
                        var m = a.PageRotateToScreen(b, a.getDocView().getRotate());
                        m.left = m.left + d.x, WebPDF.RectUtils.normalizeEx(m), m = a.deviceRectToPageRotate(m, a.getDocView().getRotate()), WebPDF.RectUtils.copy(m, b);
                        break;
                    case g.RIGHT:
                        var m = a.PageRotateToScreen(b, a.getDocView().getRotate());
                        m.right = m.right + d.x, WebPDF.RectUtils.normalizeEx(m), m = a.deviceRectToPageRotate(m, a.getDocView().getRotate()), WebPDF.RectUtils.copy(m, b);
                        break;
                    case g.TOP:
                        var m = a.PageRotateToScreen(b, a.getDocView().getRotate());
                        m.top = m.top + d.y, WebPDF.RectUtils.normalizeEx(m), m = a.deviceRectToPageRotate(m, a.getDocView().getRotate()), WebPDF.RectUtils.copy(m, b);
                        break;
                    case g.BOTTOM:
                        var m = a.PageRotateToScreen(b, a.getDocView().getRotate());
                        m.bottom = m.bottom + d.y, WebPDF.RectUtils.normalizeEx(m), m = a.deviceRectToPageRotate(m, a.getDocView().getRotate()), WebPDF.RectUtils.copy(m, b)
                }
                b.bottom < b.top && (b.top = b.bottom), b.right < b.left && (b.left = b.right)
            }, this.getGeometricScalingOffset = function(a, b, c, d, e, f, h, i) {
                var j = a.getPageViewHeight(),
                    k = a.getPageViewWidth(),
                    l = d - f,
                    m = e - h,
                    n = b.getRect(),
                    o = Math.abs(n.top - n.bottom),
                    p = Math.abs(n.right - n.left),
                    q = a.getDocView().getRotate(),
                    r = 0,
                    s = 0;
                r = p / o, s = o / p, 0 === l ? l = -1 * m * r : 0 === m ? m = l * s : i != g.LEFT && i != g.RIGHT && i != g.TOP && i != g.BOTTOM && (r > s ? m = m / Math.abs(m) * Math.abs(l) * s : l = l / Math.abs(l) * Math.abs(m) * r);
                var t = !1;
                switch (q) {
                    case 0:
                    case 180:
                        if (180 == q && (l = -l, m = -m), i == g.LEFT_TOP) {
                            var u = c.left + l,
                                v = c.top + m;
                            (0 > u || 0 > v) && (t = !0)
                        } else if (i == g.RIGHT_TOP) {
                            var w = c.right + l,
                                v = c.top + m;
                            (w > k || 0 > v) && (t = !0)
                        } else if (i == g.LEFT_BOTTOM) {
                            var u = c.left + l,
                                x = c.bottom + m;
                            (0 > u || x > j) && (t = !0)
                        } else if (i == g.RIGHT_BOTTOM) {
                            var w = c.right + l,
                                x = c.bottom + m;
                            (w > k || x > j) && (t = !0)
                        }
                        break;
                    case 90:
                    case 270:
                        if (i == g.LEFT_TOP) {
                            90 == q ? (l = -l, m = m) : (l = l, m = -m);
                            var u = c.left + l,
                                v = c.top + m;
                            (0 > u || 0 > v) && (t = !0)
                        } else if (i == g.RIGHT_TOP) {
                            90 == q ? (l = l, m = -m) : (l = -l, m = m);
                            var w = c.right + l,
                                v = c.top + m;
                            (w > k || 0 > v) && (t = !0)
                        } else if (i == g.LEFT_BOTTOM) {
                            90 == q ? (l = l, m = -m) : (l = -l, m = m);
                            var u = c.left + l,
                                x = c.bottom + m;
                            (0 > u || x > k) && (t = !0)
                        } else if (i == g.RIGHT_BOTTOM) {
                            90 == q ? (l = -l, m = m) : (l = l, m = -m);
                            var w = c.right + l,
                                x = c.bottom + m;
                            (w > j || x > k) && (t = !0)
                        }
                }
                return t ? {
                    x: 0,
                    y: 0
                } : {
                    x: l,
                    y: m
                }
            }, this.deleteSelection = function() {
                if (E.isAnnot()) {
                    var a, b = !1,
                        c = {},
                        d = [],
                        e = [];
                    for (var f in G) {
                        var g = G[f];
                        if (!g.isReadOnly() && g && ($("#docViewer_ViewContainer_PageContainer_" + g.pageIndex + "_Annots_" + g.getAnnotName()).hide(), $("#docViewer_ViewContainer_PageContainer_" + g.pageIndex + "_Text_Annots_" + g.getAnnotName()).hide(), a = M.getAnnotHandlerByAnnot(g))) {
                            if (g.isSourceAnnot ? (g.hide(), g.setDel(1)) : c[f] = 1, a.deleteAnnot(I, g, aa), !g.getInreplyto || !g.getInreplyto()) {
                                var h = {
                                    annotName: g.getAnnotName(),
                                    pageIndex: I.getPageIndex(),
                                    isReply: g.isReply,
                                    annotObject: g
                                };
                                $(E).trigger(WebPDF.EventList.ANNOT_DELETED, h)
                            }
                            b = !0;
                            var h = null,
                                i = "" + I.getPageIndex(),
                                j = g.getRect(),
                                k = "[" + j.left + " " + j.top + " " + j.right + " " + j.bottom + "]",
                                l = {
                                    Type: g.getSubType(),
                                    ActionType: "Delete",
                                    PageIndex: i,
                                    Rect: k
                                };
                            if (l = JSON.stringify(l), E.addRecord("Comment", "Comment", l), g.getInreplyto && g.getInreplyto()) e.push(g.annotJSONData);
                            else if ("Replace" === g.annotJSONData.it) {
                                e.push(g.annotJSONData);
                                for (var m = e.length - 1; m >= 0; m--) d.push(e[m]);
                                e = []
                            } else d.push(g.annotJSONData)
                        }
                    }
                    if (b) {
                        var n = new u(i, WebPDF.Annot.UndoType.ANNOT_DELETE, d);
                        E.addAnnotUndo(n), I.getPDFPage().deleteAnnots(c), E.setModified(I, I.getDocView(), !0), M.clearSelection(), M.onDraw()
                    }
                }
            }, this.deleteAnnot = function(a, b, c, d) {
                var e = !1,
                    f = a.getPDFPage().getAnnotByName(b);
                if (!f || !d && !a.getPDFPage().isSupportedXFDFType(f)) return !1;
                var g = M.getAnnotHandlerByAnnot(f);
                if (g) {
                    var h = {};
                    if (f.isSourceAnnot ? (f.hide(), f.setDel(1)) : h[b] = 1, a.getPDFPage().deleteAnnots(h), g.deleteAnnot(a, f, aa), e = !0, !f.getInreplyto || !f.getInreplyto()) {
                        var i = {
                            annotName: f.getAnnotName(),
                            pageIndex: a.getPageIndex(),
                            isReply: f.isReply
                        };
                        c && (i = {
                            annotName: f.getAnnotName(),
                            pageIndex: a.getPageIndex(),
                            isReply: f.isReply,
                            annotObject: f
                        }), $(E).trigger(WebPDF.EventList.ANNOT_DELETED, i);
                        var j = "" + a.getPageIndex(),
                            k = f.getRect(),
                            l = "[" + k.left + " " + k.top + " " + k.right + " " + k.bottom + "]",
                            m = {
                                Type: f.getSubType(),
                                ActionType: "Delete",
                                PageIndex: j,
                                Rect: l
                            };
                        m = JSON.stringify(m), E.addRecord("Comment", "Comment", m)
                    }
                }
                return e ? (E.setModified(a, a.getDocView(), !0), M.clearSelection(), M.onDraw(), !0) : !1
            }, this.setSelectionProperty = function(a) {
                var b, c = !1,
                    d = Object.keys(G);
                d.length > 1 && (c = !0), 2 == d.length && ("StrikeOut" === G[d[0]].getSubType() && "Caret" === G[d[1]].getSubType() || "Caret" === G[d[0]].getSubType() && "StrikeOut" === G[d[1]].getSubType()) && (c = !1);
                for (var e in G)
                    if (G.hasOwnProperty(e)) {
                        var f = G[e];
                        if (f && (b = M.getAnnotHandlerByAnnot(f))) {
                            b.setAnnotProperty(I, f, a, c);
                            break
                        }
                    }
            }, this.setSelectionRotate = function(a) {
                var b = [];
                for (var c in G)
                    if (G.hasOwnProperty(c)) {
                        var d = G[c];
                        if (d && (annotHandler = M.getAnnotHandlerByAnnot(d))) {
                            var e = d.getRotate();
                            annotHandler.setRotation(I, d, a);
                            var f = {
                                type: WebPDF.Annot.PropertyType.ANNOT_ROTATE,
                                name: d.getAnnotName(),
                                oldData: e,
                                newData: d.getRotate()
                            };
                            b.push(f);
                            break
                        }
                    }
                if (b.length > 0) {
                    var g = new WebPDF.Annot.Undo(I.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_PROPERTY, b);
                    WebPDF.Tool.getReaderApp().addAnnotUndo(g)
                }
            }, this.onAnnotLButtonDblClk = function(a, b, c) {
                if (null != b) {
                    var d = M.canAnswer(b);
                    return d ? (d.onLButtonDblClk(a, b, c), x("[annot-name=" + b.getAnnotName() + "] .popup_child.fwr-annot-reply"), $("#" + K).hide(), !0) : !1
                }
                return !1
            }, this.onAnnotMouseOver = function(a, b, c) {
                if (!b) return !1;
                D(a, b, c);
                try {
                    var d = (a.getPageIndex(), b.getAnnotName(), M.canAnswer(b));
                    return null == d ? !1 : (d.onMouseOver(a, b, c), !0)
                } catch (e) {
                    return console.error(e), !1
                }
            }, this.onAnnotMouseLeave = function(a, b, c) {
                if (!b) return !1;
                D(a, b, c);
                try {
                    var d = E.getCurToolHandler();
                    if (null != b && $.isFunction(d.getIsOnDraw) && d.getIsOnDraw()) return !1;
                    var e = M.canAnswer(b);
                    return null == e ? !1 : (e.onMouseLeave(a, b, c), !0)
                } catch (f) {
                    return console.error(f), !1
                }
            }, this.updateAnnotsPosition = function(a, b) {
                var c = a.getPDFPage();
                N = !0, c.enumAnnots(function(c) {
                    var d = M.canAnswer(c, !0);
                    return null != d && d.onUpdatePosition(a, c, b), !0
                }), N = !1
            }, this.onDocViewResize = function() {}, this.onPreDocViewResize = function() {
                Z.length = 0;
                for (var a = E.getMainView().getDocView(), b = a.getVisiblePageRange(), c = b.begin; c <= b.end; c++) Z.push(c)
            }, this.onDocViewScroll = function() {
                M.onDraw()
            }, this.getAnnotsHtmlContent = function(a, b, c) {
                return a ? (a.getPDFPage().isAnnotLoaded() || X[a.getPageIndex()] || O.syncLoadPDFAnnotation(E, E.getPDFDoc(), a.getPageIndex(), function() {}, function() {}), M.createAnnotsHtmlContent(a, b, c)) : ""
            }, this.getAnnotbyPage = function(a, b, c) {
                return a ? void(a.getPDFPage().isAnnotLoaded() || (E.getMainView().getDocView().loadPages({
                    begin: a.getPageIndex(),
                    end: a.getPageIndex()
                }), O.syncLoadPDFAnnotation(E, E.getPDFDoc(), a.getPageIndex(), b, c))) : ""
            }, this.createAnnotsHtmlContent = function(a, b, c) {
                return aa.createAnnotsHtmlContent(a, b, c)
            }, this.getUIManager = function() {
                return aa
            }, this.isAnnotRenderWithBackgroundImage = function(a) {
                return !1
            }, this.quadPointsToRectArray = function(a, b, c) {
                if (null == a || a.length % 8 != 0) return null;
                for (var d = [], g = 0; g < a.length; g += 8) {
                    var h = null;
                    (b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE) && (h = new e(a[g], a[g + 1], a[g + 6], a[g + 7]));
                    var i = c.TransFormRect(h.left, h.top, h.right, h.bottom);
                    if (h.left = i[0], h.top = i[1], h.right = i[2], h.bottom = i[3], f.normalize(h), f.isEmpty(h)) return null;
                    d.push(h)
                }
                return d
            }, this.showDrawingAnnot = function(a, b, c, d, e) {
                if ("Markup" === b.getType() && (b.getSubType() === WebPDF.Annot.AnnotType.Circle || b.getSubType() === WebPDF.Annot.AnnotType.Square || b.getSubType() === WebPDF.Annot.AnnotType.Line)) {
                    var f = 1,
                        g = 1;
                    e && (f = e, g = e);
                    var j = M.getAnnotCavansDivID(a, b.getAnnotName()),
                        k = document.getElementById(j);
                    if (null == k || c || (k = h.getCanvas(j)), !k && d && (k = d), null == k) return;
                    var l = h.getContext(k),
                        m = b.getBorderWidth() * a.getScale() * f,
                        n = WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                        o = b.getFillColor(),
                        p = b.getRect(),
                        q = a.pdfRectToDevice(p, !0),
                        r = m / 2;
                    q.left += r, q.top += r;
                    var s = new WebPDF.PDFRect(r, r, q.right - q.left, q.bottom - q.top),
                        t = parseInt(2 > m ? 2 : m),
                        u = (WebPDF.AccountInstance.getUserConfig(), {
                            borderColor: n,
                            borderWidth: t,
                            fillColor: o
                        });
                    b.getSubType() === WebPDF.Annot.AnnotType.Circle ? i.drawCircle(l, s.left, s.top, s.right, s.bottom, u) : b.getSubType() === WebPDF.Annot.AnnotType.Square && i.drawSquare(l, s.left, s.top, s.right, s.bottom, u)
                }
            }, this.showDrawingPolygonAnnot = function(a, b, c, d, e) {
                if ("Markup" === b.getType() && (b.getSubType() === WebPDF.Annot.AnnotType.Polygon || b.getSubType() === WebPDF.Annot.AnnotType.PolyLine)) {
                    var f = 1,
                        g = 1;
                    e && (f = e, g = e);
                    var i = M.getAnnotCavansDivID(a, b.getAnnotName()),
                        j = document.getElementById(i);
                    if (null == j || c || (j = h.getCanvas(i)), !j && d && (j = d), null == j) return;
                    var k = (h.getContext(j), b.getBorderWidth() * a.getScale() * f, WebPDF.Common.hexColor2Rgba(b.getColor(), 1), b.getFillColor(), M.canAnswer(b));
                    null != k && k.onDraw(a, b)
                }
            }, this.showAInkAnnot = function(a, b, c, e, f) {
                if ("Markup" === b.getType() && "Ink" === b.getSubType()) {
                    var g = 1,
                        i = 1;
                    f && (g = f, i = f);
                    var j = M.getAnnotCavansDivID(a, b.getAnnotName()),
                        k = document.getElementById(j);
                    if (null == k || c || (k = h.getCanvas(j)), !k && e && (k = e), null == k) return;
                    var l = h.getContext(k);
                    l.lineWidth = b.getInkBorderWidth() * a.getScale() * g, l.strokeStyle = WebPDF.Common.hexColor2Rgba(b.getInkColor(), 1);
                    var m = b.getRect(),
                        n = a.pdfRectToDevice(m, !0),
                        o = b.getInkList();
                    if (null != o) {
                        l.beginPath(), l.lineJoin = "round";
                        for (var p = o.length, q = 0; p > q; q++) {
                            var r = o[q],
                                s = r.length;
                            if (!(1 >= s)) {
                                for (var t = [], u = 0; s > u; u++) {
                                    var v = a.pdfPtToDevice(r[u]);
                                    v.x = (v.x - n.left) * g, v.y = (v.y - n.top) * i, t.push(v)
                                }
                                var w = t[0];
                                if (l.moveTo(w.x, w.y), 1 == s) {
                                    var x = t[1];
                                    l.lineTo(x.x, x.y), l.stroke()
                                } else {
                                    var y, z, D = new d(0, 0),
                                        E = new d(0, 0),
                                        F = new d(0, 0),
                                        G = new d(0, 0),
                                        H = new d(0, 0),
                                        I = new d(0, 0),
                                        J = (new d(0, 0), 1);
                                    D = w;
                                    do l.moveTo(D.x, D.y), s - J == 1 ? (G = t[J++], E.x = (2 * D.x + G.x) / 3, E.y = (2 * D.y + G.y) / 3, F.x = (D.x + 2 * G.x) / 3, F.y = (D.y + 2 * G.y) / 3, l.bezierCurveTo(E.x, C(E.y), F.x, C(F.y), G.x, C(G.y)), D = G) : s - J == 2 ? (E = t[J++], F = t[J], H.x = E.x - D.x, H.y = E.y - D.y, I.x = F.x - E.x, I.y = F.y - E.y, y = A(H) < .001 ? 0 : B(H), z = A(I) < .001 ? 0 : B(I), Math.abs(y - z) > 3.1415926535 / 3 ? (G = E, E.x = (2 * D.x + G.x) / 3, E.y = (2 * D.y + G.y) / 3, F.x = (D.x + 2 * G.x) / 3, F.y = (D.y + 2 * G.y) / 3, l.moveTo(D.x, D.y), l.bezierCurveTo(E.x, C(E.y), F.x, C(F.y), G.x, C(G.y)), D = G) : (l.moveTo(D.x, D.y), l.bezierCurveTo(D.x, C(D.y), E.x, C(E.y), F.x, C(F.y)), J++, D = F)) : (E = t[J++], F = t[J], G = t[J + 1], l.bezierCurveTo(E.x, C(E.y), F.x, C(F.y), G.x, C(G.y)), J += 2, D = G); while (s > J)
                                }
                            }
                        }
                        l.stroke()
                    }
                }
            }, this.drawAnnots = function(a, b, c) {
                a && a.getPDFPage().enumAnnots(function(d) {
                    return M.drawAnnot(a, d, b, c)
                })
            }, this.drawAnnot = function(a, b, c, d, e) {
                var f = null;
                f = WebPDF.ConnectPdf && a.getDocView().getPDFDoc().isCReview() ? M.getAnnotHandlerByAnnot(b) : M.canAnswer(b, !1, e), null != f && f.onDraw(a, b, c, d);
                var g = aa.getCommentAnnotDivID(a, b.getAnnotName()),
                    h = $("#" + g);
                if (M.getCanvasDrawSquiggly(h, b), b.getSubType() == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET) {
                    var i = aa.getAnnotCanvasDivID(a, b.getAnnotName()),
                        j = $("#" + i);
                    M.getCanvasDrawCaret(a, j, b)
                }
                return !0
            }, this.showAnnots = function(a, b, c) {
                function d(a, b, c) {
                    a.isShowInViewer();
                    return a.isShowInViewer() && c ? void b.show() : void b.hide()
                }
                var e = a.getPDFPage();
                if (e) {
                    e.enumAnnots(function(c) {
                        var e = M.getUIManager(),
                            f = c.getType(),
                            g = $("#" + e.getAnnotDivID(a, c.getAnnotName()));
                        switch (d(c, g, b), f) {
                            case WebPDF.Annot.AnnotType.Link:
                                break;
                            case WebPDF.Annot.AnnotType.MarkUp:
                                var h = c.getSubType();
                                switch (h) {
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE:
                                        g = $("#" + e.getCommentAnnotDivID(a, c.getAnnotName())), d(c, g, b);
                                        break;
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET:
                                        g = $("#" + e.getDrawingAnnotDivID(a, c.getAnnotName())), d(c, g, b);
                                        break;
                                    case WebPDF.Annot.AnnotType.Text:
                                        g = $("#" + e.getTextAnnotDivID(a, c.getAnnotName())), d(c, g, b);
                                        break;
                                    case WebPDF.Annot.AnnotType.Image:
                                        g = $("#" + e.getImageImageID(a, c.getAnnotName())), d(c, g, b), c.isDynamic && (g = $("#" + e.getImageDnamicID(a, c.getAnnotName())), d(c, g, b));
                                        break;
                                    case WebPDF.Annot.AnnotType.Stamp:
                                        g = $("#" + e.getStampImageID(a, c.getAnnotName())), d(c, g, b), c.isDynamic && (g = $("#" + e.getStampDnamicID(a, c.getAnnotName())), d(c, g, b));
                                        break;
                                    case WebPDF.Annot.AnnotType.Ink:
                                        g = $("#" + e.getInkAnnotDivID(a, c.getAnnotName())), d(c, g, b);
                                        break;
                                    case WebPDF.Annot.AnnotType.PolyLine:
                                    case WebPDF.Annot.AnnotType.Polygon:
                                    case WebPDF.Annot.AnnotType.Circle:
                                    case WebPDF.Annot.AnnotType.Square:
                                    case WebPDF.Annot.AnnotType.Line:
                                    case WebPDF.Annot.AnnotType.LineArrow:
                                        g = $("#" + e.getDrawingAnnotDivID(a, c.getAnnotName())), d(c, g, b)
                                }
                                var i = c.getPopup();
                                i && 1 == i.getOpenState() && !E.isMobile() && (g = $("#" + e.getAnnotPopupDivID(a, c.getAnnotName())), d(c, g, b));
                                break;
                            case WebPDF.Annot.AnnotType.TypeWriter:
                                g = $("#" + e.getTypewriterAnnotDivID(a, c.getAnnotName())), d(c, g, b);
                                break;
                            case WebPDF.Annot.AnnotType.Textbox:
                                g = $("#" + e.getTextboxAnnotDivID(a, c.getAnnotName())), d(c, g, b);
                                break;
                            case WebPDF.Annot.AnnotType.Callout:
                                g = $("#" + e.getCalloutAnnotDivID(a, c.getAnnotName())), d(c, g, b)
                        }
                    });
                    var f = a.getDocView(),
                        g = f.getPageAnnotUnLoad();
                    $(E).trigger(WebPDF.EventList.ANNOTS_VISIBILITY_CHANGED, {
                        isShow: b,
                        pageAnnotUnload: g,
                        isCommentsMenuClick: c
                    })
                }
            }, this.packageAnnot = function(a) {
                var b = {
                    annotName: a.getAnnotName(),
                    title: a.getTitle(),
                    contents: a.getContents(),
                    modifyDate: a.getModifyDate(),
                    visible: a.isVisible(),
                    subType: a.getSubType(),
                    subject: a.getSubject(),
                    isReply: a.isReply,
                    isParentReply: a.isParentReply,
                    annotJSONData: a.annotJSONData,
                    readOnly: a.isReadOnly()
                };
                if (a.hasOwnProperty("getReplyChain")) {
                    var c = a.getReplyChain();
                    b.getReplyChain = [];
                    for (var d = 0; d < c.length; d++) b.getReplyChain[d] = this.packageAnnot(c[d])
                }
                return "Line" == a.getSubType() && (b.IT = a.getIntent()), b
            }, this.needShowComment = function(a) {
                var b = ["Highlight", WebPDF.Annot.AnnotType.Text, WebPDF.Annot.AnnotType.Ink, "Underline", "Squiggly", "StrikeOut", "Caret", "FreeTextTypewriter", "FreeTextCallout", "FreeText", "Polygon", "PolyLine", WebPDF.Annot.AnnotType.Stamp, WebPDF.Annot.AnnotType.Image, WebPDF.Annot.AnnotType.Circle, WebPDF.Annot.AnnotType.Square, WebPDF.Annot.AnnotType.Line];
                for (var c in b)
                    if (b[c] === a) return !0;
                return !1
            }, this.rotatePopupAnnots = function(a) {
                aa.rotatePopupAnot(a, a.getDocView().getRotate())
            }, this.onDraw = function() {
                null != M.getMarkupAnnotHandler() && M.getMarkupAnnotHandler().onDraw()
            }, this.getCavansElement = function() {
                return document.getElementById(_)
            }, this.bindAnnotEvents = function() {}, this.getAnnotVisibleRect = function(a, b, c, d) {
                var f = a.getPageViewWidth(),
                    g = a.getPageViewHeight(),
                    h = a.getPageIndex(),
                    i = $("#" + a.getPageViewContainerID()),
                    j = a.getDocView().getScrollApi(),
                    k = c,
                    l = d,
                    m = i.offset();
                null != j && (l -= j.getScrollBarHeight(), k -= j.getScrollBarWidth());
                var n = new e(0, 0, 0, 0),
                    o = m.top + g - (b.top + l);
                0 > o && (o = 0), m.top < b.top ? (n.top = b.top - m.top, n.bottom = n.top + g - (b.top - m.top) - o) : (n.top = 0, 0 === h && (n.top = b.top - m.top), n.bottom = g - o), h === a.getDocView().getPageCount() - 1 && m.top + g < b.top + l && (n.bottom += b.top + l - (m.top + g));
                var p = a.getDocView().getViewMode();
                if (p == WebPDF.PDFView.RD_BRMODE_CONTINUOUS_FACING) {
                    var q = k / 2 - 11;
                    if (h % 2 == 0) {
                        n.left = b.left - m.left + 1;
                        var r = m.left + f - (b.left + k);
                        n.right = f - 1, r > 0 && (n.right -= r)
                    } else {
                        n.left = 0, n.right = n.left + q;
                        var r = m.left + f - (b.left + k);
                        r > 0 && (n.right = f - r)
                    }
                } else(p == WebPDF.PDFView.RD_BRMODE_CONTINUOUS || p == WebPDF.PDFView.RD_BRMODE_SINGLE_PAGE) && (n.left = b.left - m.left + 1, n.right = n.left + k);
                return n
            }, this.getAnnotCavansDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Annots_Canvas_" + b
            }, this.clearCanvas = function() {
                aa.clearCanvas()
            }, this.resetPropertyPositon = function(a, b) {
                var c, d = $("#fwrCommentPropertyDlg"),
                    e = $(window).height(),
                    f = $(window).width(),
                    g = d.outerHeight(),
                    h = d.outerWidth(),
                    i = $("#" + b).height(),
                    j = a.pageY,
                    k = a.pageX;
                if (E.isMobile()) {
                    var l = d.find(".fwrm-triangle");
                    if (k > h ? (c = k - h, d.css("left", c), l.css("right", 10)) : (k -= 40, l.css("left", k), d.css("left", 10)), g + i > j && e - j > g) d.css("top", j), l.addClass("up");
                    else if (j >= g + i) j = j - g - i, d.css("top", j), l.addClass("down");
                    else {
                        var m = g - (e - j),
                            n = pageView.getDocView().getScrollApi(),
                            o = n.getContentPositionY();
                        o = m + o, n.scrollTo(0, o), j -= m, l.addClass("up"), d.css("top", j)
                    }
                } else k + h > f && (c = f - h, d.css("left", c))
            }, this.setSelectAnnotColor = function(a, b) {
                var c, d, e = [];
                for (var f in G)
                    if (G.hasOwnProperty(f)) {
                        var g = G[f];
                        if (g && (c = this.getAnnotHandlerByAnnot(g)) && (d = g.getAnnotName(), c.setAnnotColor)) {
                            var h = "Textbox" === g.getType() || "Typewriter" === g.getType(),
                                i = {
                                    type: WebPDF.Annot.PropertyType.ANNOT_COLOR,
                                    name: g.getAnnotName(),
                                    oldData: h ? g.getFontColor() : g.getColor(),
                                    newData: WebPDF.Common.rgb2HexColor(b)
                                };
                            e.push(i), c.setAnnotColor(a, g, b);
                            var j = {
                                annot: this.packageAnnot(g),
                                pageIndex: a.getPageIndex(),
                                annotObject: g
                            };
                            $(E).trigger(WebPDF.EventList.ANNOT_UPDATED, j)
                        }
                    }
                if (e.length > 0) {
                    var k = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_PROPERTY, e);
                    WebPDF.Tool.getReaderApp().addAnnotUndo(k)
                }
            }, this.updateProperties = function(a, b, c, d) {
                var e = a.getPDFPage().getAnnotByName(b);
                if (e) {
                    var f;
                    if (f = this.getAnnotHandlerByAnnot(e)) {
                        switch (c) {
                            case WebPDF.Annot.PropertyType.ANNOT_COLOR:
                                var g = WebPDF.Common.hexColor2Rgba_noAlpha(d);
                                f.setAnnotColor(a, e, g);
                                break;
                            case WebPDF.Annot.PropertyType.ANNOT_FILLCOLOER:
                                f.setAnnotFillColor ? f.setAnnotFillColor(a, e, d) : f.drawingView.setAnnotFillColor(a, e, d);
                                break;
                            case WebPDF.Annot.PropertyType.ANNOT_OPACITY:
                                f.setAnnotOpacity ? f.setAnnotOpacity(a, e, d) : f.drawingView.setAnnotOpacity(a, e, d);
                                break;
                            case WebPDF.Annot.PropertyType.ANNOT_FONTSIZE:
                                f.setAnnotFontSize(a, e, d);
                                break;
                            case WebPDF.Annot.PropertyType.ANNOT_BORDERCOLOR:
                                f.setAnnotBorderColor(a, e, d);
                                break;
                            case WebPDF.Annot.PropertyType.ANNOT_ROTATE:
                                f.setRotation(a, e, d);
                                break;
                            default:
                                f.annotLineBorder ? f.annotLineBorder(a, e, d) : f.drawingView.annotLineBorder(a, e, d)
                        }
                        var h = {
                            annot: this.packageAnnot(e),
                            pageIndex: a.getPageIndex(),
                            annotObject: e
                        };
                        $(E).trigger(WebPDF.EventList.ANNOT_UPDATED, h)
                    }
                }
            }, this.setSelectAnnotLineBorder = function(a, b, c, d) {
                var e, f, g = [];
                for (var h in G)
                    if (G.hasOwnProperty(h)) {
                        var i = G[h];
                        if (i && (e = this.getAnnotHandlerByAnnot(i))) {
                            f = i.getAnnotName();
                            var j, k, l = d ? !1 : !0,
                                m = WebPDF.Annot.PropertyType.ANNOT_OPACITY;
                            if (k = b, "Opacity" === c ? (l && (j = 100 * i.getOpacity()), e.setAnnotOpacity ? e.setAnnotOpacity(a, i, b, d) : e.drawingView.setAnnotOpacity(a, i, b, d)) : "FontSize" === c ? (l && (m = WebPDF.Annot.PropertyType.ANNOT_FONTSIZE, j = i.getFontSize()), e.setAnnotFontSize(a, i, b), k = parseInt(b)) : "FillColor" === c ? (m = WebPDF.Annot.PropertyType.ANNOT_FILLCOLOER, j = i.getFillColor(), k === j && (l = !1), e.setAnnotFillColor ? e.setAnnotFillColor(a, i, b) : e.drawingView.setAnnotFillColor(a, i, b)) : "BorderColor" === c ? (m = WebPDF.Annot.PropertyType.ANNOT_BORDERCOLOR, "Textbox" === i.getType() ? j = i.getColor() : console.warn("unsupport now!"), k === j && (l = !1), e.setAnnotBorderColor(a, i, b)) : (l && (m = WebPDF.Annot.PropertyType.ANNOT_BORDERWIDTH, j = "Ink" === i.getSubType() ? i.getInkBorderWidth() : i.getBorderWidth()), e.annotLineBorder ? e.annotLineBorder(a, i, b, d) : e.drawingView.annotLineBorder(a, i, b, d)), l) {
                                var n = {
                                    type: m,
                                    name: f,
                                    oldData: j,
                                    newData: k
                                };
                                g.push(n)
                            }
                            var o = {
                                annot: this.packageAnnot(i),
                                pageIndex: a.getPageIndex(),
                                annotObject: i
                            };
                            $(E).trigger(WebPDF.EventList.ANNOT_UPDATED, o)
                        }
                    }
                if (g.length > 0) {
                    var p = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_PROPERTY, g);
                    WebPDF.Tool.getReaderApp().addAnnotUndo(p)
                }
            }, this.getCanvasDrawSquiggly = function(a, b) {
                if ($(a).find("canvas").parent().parent()[0]) {
                    var c = $(a).find("canvas").parent().parent()[0].id,
                        d = $("#" + c + " canvas"),
                        e = b;
                    b.getColor() && (e = b.getColor()), M.drawSquigglys(d, e)
                }
            }, this.getCanvasDrawCaret = function(a, b, c, d) {
                var e = h.getCanvas(b.attr("id")),
                    f = h.getContext(e),
                    g = c.getRdRect(),
                    j = g[0] * E.getPixelsPerPoint(),
                    k = [],
                    l = e.width,
                    m = e.height;
                switch ((90 * a.getPDFPage().getPageRotate() % 360 + 360) % 360) {
                    case 0:
                        k.push(new WebPDF.PDFPoint(j, m - j)), k.push(new WebPDF.PDFPoint(l / 2, j)), k.push(new WebPDF.PDFPoint(l - j, m - j));
                        break;
                    case 90:
                        k.push(new WebPDF.PDFPoint(j, j)), k.push(new WebPDF.PDFPoint(l - j, m / 2)), k.push(new WebPDF.PDFPoint(j, m - j));
                        break;
                    case 180:
                        k.push(new WebPDF.PDFPoint(j, j)), k.push(new WebPDF.PDFPoint(l / 2, m - j)), k.push(new WebPDF.PDFPoint(l - j, j));
                        break;
                    case 270:
                        k.push(new WebPDF.PDFPoint(l - j, j)), k.push(new WebPDF.PDFPoint(j, m / 2)), k.push(new WebPDF.PDFPoint(l - j, m - j))
                }
                var n = {
                    fillStyle: "rgba(255,255,255,0)",
                    strokeStyle: d ? d : c.getColor(),
                    lineWidth: j
                };
                i.drawCaret(f, k, n)
            }, this.drawSquigglys = function(a, b) {
                for (var c = a.length, d = c - 1; d >= 0; d--) {
                    var e = h.getCanvas(a[d].id),
                        f = h.getContext(e),
                        g = 0 === e.height ? 1 : e.height,
                        j = 0 === e.width ? 1 : e.width,
                        k = {
                            fillStyle: "rgba(255,255,255,0)",
                            strokeStyle: b,
                            lineWidth: g > j ? j / 2 : g / 2
                        };
                    i.drawSquiggly(f, j, g, k), a[d] = null
                }
            }, this.setAnnotModified = function(a, b) {
                var c = new Date,
                    d = c.getTime(),
                    e = Math.floor(d / 1e3).toString();
                a.setModifyDate(e);
                var f = b.getDocView();
                E.setModified(b, f, !0)
            }, this.updateAnnot = function(a, b, c, d) {
                var e = ($("#" + aa.getAnnotDivID(c, a)), c.getPDFPage().getAnnotByName(a)),
                    f = e.getSubType(),
                    g = c.getPDFPage().getPageIndex(),
                    h = M.getAnnotHandlerByAnnot(e),
                    i = !1,
                    j = new Date,
                    k = j.valueOf(),
                    l = Math.floor(k / 1e3).toString(),
                    m = e.getRect();
                e.getType() == WebPDF.Annot.AnnotType.Callout && h.initPointArrayByAnnot(c, b);
                var n = b.getRect();
                if (m && n) {
                    var o = n.left - m.left,
                        p = n.top - m.top;
                    if (0 != o && 0 != p) {
                        e.setRect(n);
                        var q = c.pdfRectToDevice(m, !0),
                            r = c.pdfRectToDevice(n, !0);
                        o = r.left - q.left, p = r.top - q.top, h.moveAnnot(c, e, o, p, r.left, r.top), i = !0
                    }
                }
                var s = e.getContents(),
                    t = b.getContents();
                if (s != t) {
                    if ((e.getType() == WebPDF.Annot.AnnotType.TypeWriter || e.getType() == WebPDF.Annot.AnnotType.Callout) && e.setRect(n), e.getType() == WebPDF.Annot.AnnotType.Callout) {
                        var u = b.getRectDiffer();
                        e.setRectDiffer(u)
                    }
                    this.updateAnnotContent(g, a, t), i = !0
                }
                if ("Text" != f) {
                    var v = e.getColor(),
                        w = b.getColor();
                    if (w && v != w) {
                        var x = WebPDF.Common.hexColor2Rgba_noAlpha(w);
                        h.setAnnotColor(c, e, x), i = !0
                    }
                }
                if (e.getType() == WebPDF.Annot.AnnotType.Callout) {
                    var y = e.getFontColor(),
                        z = b.getFontColor();
                    z && y != z && (h.setAnnotFontColor(c, e, z), i = !0)
                }
                if (e.getType() == WebPDF.Annot.AnnotType.Textbox) {
                    var y = e.getFontColor(),
                        z = b.getFontColor();
                    z && y != z && (h.setAnnotColor(c, e, z), i = !0), e.annotJSONData.cl = b.annotJSONData.cl, b.annotJSONData.fcl && (e.annotJSONData.fcl = b.annotJSONData.fcl), e.annotJSONData.d = b.annotJSONData.d, (n.left - m.left != 0 || n.top - m.top != 0 || n.right - m.right != 0 || n.bottom - m.bottom != 0) && h.onUpdatePosition(c, e), h.onDraw(c, e, !1)
                }
                if ("Ink" === f ? (h.annotLineBorder(c, b, b.getInkBorderWidth()), i = !0) : "Polygon" === f || "PolyLine" === f ? (e.setVts(b.getVts()), e.getFillColor() != b.getFillColor() && e.setFillColor(b.getFillColor()), e.getBorderWidth() != b.getBorderWidth() && e.setBorderWidth(b.getBorderWidth()), e.getOpacity() != b.getOpacity() && e.setOpacity(b.getOpacity()), h.onDraw(c, e, !1), i = !0) : "Circle" === f || "Square" === f ? (n.left - m.left != 0 || n.top - m.top != 0 || n.right - m.right != 0 || n.bottom - m.bottom != 0) && (e.setRect(n), h.changeRect(c, e), i = !0) : "Line" === f ? ((n.left - m.left != 0 || n.top - m.top != 0 || n.right - m.right != 0 || n.bottom - m.bottom != 0) && (e.setRect(n), e.setLineRect(b.getLineRect()), h.changeRect(c, e), i = !0), b.annotJSONData.cap !== e.annotJSONData.cap && (h.onDraw(c, b, !1), i = !0)) : f === WebPDF.Annot.AnnotType.Image && (i = e.isDifferentFrom(b)), i) {
                    e.setModifyDate(l);
                    var A = c.getDocView();
                    E.setModified(c, A, !0);
                    var B = null;
                    B = d ? {
                        annot: this.packageAnnot(e),
                        pageIndex: c.getPageIndex(),
                        annotObject: e
                    } : {
                        annot: this.packageAnnot(e),
                        pageIndex: c.getPageIndex()
                    }, $(E).trigger(WebPDF.EventList.ANNOT_UPDATED, B)
                }
                return e
            }, this.addFreeTextUndo = function(a, b, c, d, e) {
                if (!b) {
                    var f = E.getMainView().getDocView(),
                        g = f.getPageView(c),
                        h = g.getPDFPage();
                    if (b = h.getAnnotByName(d), !b) return !0
                }
                var i = e ? a.data("before") : b.getContents(),
                    j = a.val();
                if (j !== i) {
                    var k = {
                            name: b.getAnnotName(),
                            newContents: j,
                            oldContents: i ? i : ""
                        },
                        l = new WebPDF.Annot.Undo(c, WebPDF.Annot.UndoType.ANNOT_CONTENT, k);
                    E.addAnnotUndo(l, e)
                }
                a.data("before", a.val()), e ? E.setAnnotContentEdit(!0) : (E.setAnnotContentEdit(!1), E.clearAnnotUndo(!0))
            }
        }, WebPDF.AnnotHandleManager
    }), define("core/Plugins/Annot/AnnotUIManager", ["core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        a("core/Common/Math/Rect");
        var d = a("core/Common/CanvasUtils"),
            e = WebPDF.RectUtils,
            f = WebPDF.PDFRect,
            g = WebPDF.Common,
            h = a("core/Plugins/Annot/Annot"),
            i = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        h.AnnotUIManager = function(a, b) {
            function c(a) {
                switch (a) {
                    case "Comment":
                        return "fwr-comment-annot-icon";
                    case "Key":
                        return "fwr-key-annot-icon";
                    case "Note":
                        return "fwr-note-annot-icon";
                    case "Help":
                        return "fwr-help-annot-icon";
                    case "NewParagraph":
                        return "fwr-new-paragraph-annot-icon";
                    case "Paragraph":
                        return "fwr-paragraph-annot-icon";
                    case "Insert":
                        return "fwr-insert-annot-icon";
                    default:
                        return "fwr-default-annot-icon"
                }
            }

            function h(a) {
                var b = "";
                switch (a) {
                    case "Accepted":
                        b = "fwr-annot-state-accept";
                        break;
                    case "Rejected":
                        b = "fwr-annot-state-rejected";
                        break;
                    case "Cancelled":
                        b = "fwr-annot-state-canceled";
                        break;
                    case "Completed":
                        b = "fwr-annot-state-completed";
                        break;
                    default:
                        b = "fwr-annot-state-default"
                }
                return b
            }

            function j(a) {
                return a = Math.round(a), 0 === a ? 1 : a
            }

            function k(a) {
                var b = "<div id='{annotDivID}' class='fwr-annot {subType} fwr-annot-drawing-parent' style='left:{select_left}px;top:{select_top}px;width:{width}px;height:{height}px' page-index={pageIndex} annot-name={annotName}><div style='display:none' id='{annotBorderID}'> </div></div>",
                    c = "<div class='{noPrintClassName}' ><div class='fwr-drawing-annot fwr-annot-data' id='{annotShowDivID}' style='left:{left}px;top:{top}px;width:{width}px;height:{height}px'><div style='position:absolute;left:0px;top:0px;width:100%;height:100%'><canvas class='vml' id='{canvasID}' width={width} height={height} style='-moz-opacity:{ca};opacity:{ca};position:absolute;left:0px;top:0px;width:100%;height:100%;'/></div></div></div>";
                return b += c, b = b.format(a)
            }

            function l(a, b, c) {
                if (b) {
                    var d = o.getMainView().getDocView(),
                        e = d.getRotate(),
                        f = b.getPageViewWidth() * c,
                        g = b.getPageViewHeight() * c;
                    e % 180 != 0 && (f = b.getPageViewHeight() * c, g = b.getPageViewWidth() * c);
                    var h = WebPDF.RectUtils.width(a),
                        i = WebPDF.RectUtils.height(a);
                    a.left < 1 && (a.left = 1, a.right = a.left + h), a.top < 1 && (a.top = 1, a.bottom = a.top + i), a.right > f - 1 && (a.right = f - 1, a.left = a.right - h), a.bottom > g - 1 && (a.bottom = g - 1, a.top = a.bottom - i)
                }
            }
            var m, n = a,
                o = b,
                p = this;
            this.getCanvasDiv = function() {
                var a = "<canvas class='vml' style='position:absolute;top:0px;left:0px;z-index:2' id='" + m + "'></canvas>";
                return a
            }, this.init = function() {
                var a = o.getMainView().getDocView();
                m = a.getDocViewContainerID() + "_AnnotCanvas";
                $("#" + a.getDocViewContainerID()), a.getPageView(0);
                o.addIgnoreMouseEventClass("fwr_popup_content")
            }, this.getAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Annots_" + b
            }, this.getCommentAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Comment_Annots_" + b
            }, this.getCommentAnnotQuadDivID = function(a, b, c) {
                var d = p.getCommentAnnotDivID(a, b);
                return d += "_quad_" + c
            }, this.getCommentAnnotRectDivID = function(a, b) {
                var c = p.getCommentAnnotDivID(a, b);
                return c += "_rect"
            }, this.getTextAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Text_Annots_" + b
            }, this.getInkAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Ink_Annots_" + b
            }, this.getDrawingAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Drawing_Annots_" + b
            }, this.getDrawingAnnotBorderDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Drawing_Border_" + b
            }, this.getAnnotCanvasDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Annots_Canvas_" + b
            }, this.getCommentAnnotQuadCanvasID = function(a, b, c) {
                var d = p.getAnnotCanvasDivID(a, b);
                return d += "_quad_" + c
            }, this.getAnnotPopupDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Popup_" + b
            }, this.getPageAnnotsContainerID = function(a) {
                return a.getPageViewContainerID() + "_AnnotsContainer"
            }, this.getTypewriterAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Typewriter_Annots_" + b
            }, this.getTypewriterAnnotRectDivID = function(a, b) {
                var c = p.getTypewriterAnnotDivID(a, b);
                return c += "_rect"
            }, this.getTypewriterAnnotCanvasDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Typewriter_Annots_Canvas_" + b
            }, this.getCalloutAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Callout_Annots_" + b
            }, this.getTextboxAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Textbox_Annots_" + b
            }, this.getCalloutAnnotRectDivID = function(a, b) {
                var c = p.getCalloutAnnotDivID(a, b);
                return c += "_rect"
            }, this.getTextboxAnnotRectDivID = function(a, b) {
                var c = p.getTextboxAnnotDivID(a, b);
                return c += "_rect"
            }, this.getCalloutAnnotCanvasDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Callout_Annots_Canvas_" + b
            }, this.getCanvasAnnotRectCanvasDivID = function(a, b) {
                var c = p.getCalloutAnnotCanvasDivID(a, b);
                return c += "_rect"
            }, this.getStampDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Annots_" + b
            }, this.getStampImageID = function(a, b) {
                return a.getPageViewContainerID() + "_Stamp_Images_" + b
            }, this.getStampBorderID = function(a, b) {
                return a.getPageViewContainerID() + "_Stamp_Border_" + b
            }, this.getStampDnamicID = function(a, b) {
                return a.getPageViewContainerID() + "_Stamp_DynamicInfo_" + b
            }, this.getImageDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Annots_" + b
            }, this.getImageImageID = function(a, b) {
                return a.getPageViewContainerID() + "_Image_Images_" + b
            }, this.getImageBorderID = function(a, b) {
                return a.getPageViewContainerID() + "_Image_Border_" + b
            }, this.getImageDnamicID = function(a, b) {
                return a.getPageViewContainerID() + "_Image_DynamicInfo_" + b
            }, this.getStampPageViewRect = function(a, b) {
                var c = this.getStampDivID(a, b);
                return this.getAnnotPageViewRect(a, b, c)
            }, this.getImagePageViewRect = function(a, b) {
                var c = this.getImageDivID(a, b);
                return this.getAnnotPageViewRect(a, b, c)
            }, this.getAnnotPageViewRect = function(a, b, c) {
                var d = $("#" + c),
                    e = new f;
                return e.top = parseFloat(d.css("top")), e.left = parseFloat(d.css("left")), e.bottom = e.top + parseFloat(d.css("height")), e.right = e.left + parseFloat(d.css("width")), e
            }, this.updateStampBorder = function(a, b, c) {
                var d = this.getStampBorderID(a, b),
                    e = $("#" + d);
                if (c === !1) return void e.hide();
                var f = this.getStampPageViewRect(a, b),
                    g = f.bottom - f.top,
                    h = f.right - f.left,
                    i = o.getDocView().getRotate(),
                    j = "";
                j = 90 == i || 270 == i ? "<div class ='fwr-annot-border fwr-stamp-select-border' style='left: -4px;top: -4px; cursor:ne-resize' dir='0'></div><div class ='fwr-annot-border fwr-stamp-select-border' style='left:" + (h - 4) + "px;top: -4px; cursor:nw-resize' dir='1'></div> <div class ='fwr-annot-border fwr-stamp-select-border' style='left: -4px;top:" + (g - 4) + "px; cursor:nw-resize' dir='2'></div> <div class ='fwr-annot-border fwr-stamp-select-border' style='left:" + (h - 4) + "px;top:" + (g - 4) + "px; cursor:ne-resize' dir='3'></div> " : "<div class ='fwr-annot-border fwr-stamp-select-border' style='left: -4px;top: -4px; cursor:nw-resize' dir='0'></div><div class ='fwr-annot-border fwr-stamp-select-border' style='left:" + (h - 4) + "px;top: -4px; cursor:ne-resize' dir='1'></div> <div class ='fwr-annot-border fwr-stamp-select-border' style='left: -4px;top:" + (g - 4) + "px; cursor:ne-resize' dir='2'></div> <div class ='fwr-annot-border fwr-stamp-select-border' style='left:" + (h - 4) + "px;top:" + (g - 4) + "px; cursor:nw-resize' dir='3'></div> ", e[0].innerHTML = j, e.show()
            }, this.updateImageBorder = function(a, b, c) {
                var d = this.getImageBorderID(a, b),
                    e = $("#" + d);
                if (c === !1) return void e.hide();
                var f = this.getImagePageViewRect(a, b),
                    g = f.bottom - f.top,
                    h = f.right - f.left,
                    i = o.getDocView().getRotate(),
                    j = "";
                j = 90 == i || 270 == i ? "<div class ='fwr-annot-border fwr-image-select-border' style='left: -4px;top: -4px; cursor:ne-resize' dir='0'></div><div class ='fwr-annot-border fwr-image-select-border' style='left:" + (h - 4) + "px;top: -4px; cursor:nw-resize' dir='1'></div> <div class ='fwr-annot-border fwr-image-select-border' style='left: -4px;top:" + (g - 4) + "px; cursor:nw-resize' dir='2'></div> <div class ='fwr-annot-border fwr-image-select-border' style='left:" + (h - 4) + "px;top:" + (g - 4) + "px; cursor:ne-resize' dir='3'></div> " : "<div class ='fwr-annot-border fwr-image-select-border' style='left: -4px;top: -4px; cursor:nw-resize' dir='0'></div><div class ='fwr-annot-border fwr-image-select-border' style='left:" + (h - 4) + "px;top: -4px; cursor:ne-resize' dir='1'></div> <div class ='fwr-annot-border fwr-image-select-border' style='left: -4px;top:" + (g - 4) + "px; cursor:ne-resize' dir='2'></div> <div class ='fwr-annot-border fwr-image-select-border' style='left:" + (h - 4) + "px;top:" + (g - 4) + "px; cursor:nw-resize' dir='3'></div> ", e[0].innerHTML = j, e.show()
            }, this.getAnnotRectDivID = function(a, b) {
                var c = p.getTypewriterAnnotDivID(a, b);
                return c += "_rect"
            }, this.getStampRectDivID = this.getAnnotRectDivID, this.getImageRectDivID = this.getAnnotRectDivID, this.getAnnotDivIDFromTypewriterAnnotRectDivID = function(a) {
                return a.replace("_Typewriter", "").replace("_rect", "")
            }, this.getAnnotDivIDFromTextboxAnnotRectDivID = function(a) {
                return a.replace("_Textbox", "").replace("_rect", "")
            }, this.getAnnotDivIDFromCalloutAnnotRectDivID = function(a) {
                return a.replace("_Callout", "").replace("_rect", "")
            }, this.getAnnotMoveDivID = function(a, b) {
                var c = p.getAnnotDivID(a, b);
                return c += "_move"
            }, this.createAnnotMoveDiv = function(a, b, c) {
                var d = b.getAnnotName(),
                    e = $("#" + this.getAnnotDivID(a, d)),
                    f = this.getAnnotMoveDivID(a, d),
                    g = "",
                    h = "",
                    i = o.getDocView().getRotate();
                90 == i || 270 == i ? (g = "left:" + (parseFloat(e.css("left")) + c.y) + "px;top:" + (parseFloat(e.css("top")) + c.x) + "px;", g += "width:" + e.css("width") + ";height:" + e.css("height") + ";", h = "<div id='" + f + "' style='" + g + "' class='fwr-annot-move-div'/>") : (g = "left:" + (parseFloat(e.css("left")) + c.x) + "px;top:" + (parseFloat(e.css("top")) + c.y) + "px;", g += "width:" + e.css("width") + ";height:" + e.css("height") + ";", h = "<div id='" + f + "' style='" + g + "' class='fwr-annot-move-div'/>"), e.after(h)
            }, this.removeAnnotMoveDiv = function(a, b) {
                $(".fwr-annot-move-div").remove();
            }, this.changeAnnotRectMove = function(a, b, c) {
                if ("Polygon" === b.getSubType() || "PolyLine" === b.getSubType()) return !1;
                var d = b.getAnnotName(),
                    e = this.getAnnotMoveDivID(a, d),
                    f = $("#" + e);
                f.css({
                    left: c.left - 1 + "px",
                    top: c.top - 1 + "px",
                    width: c.right - c.left + "px",
                    height: c.bottom - c.top + "px"
                })
            }, this.getElemRect = function(a) {
                var b = $(a),
                    c = parseFloat(b.css("left")),
                    d = parseFloat(b.css("top")),
                    e = parseFloat(b.css("width")),
                    g = parseFloat(b.css("height")),
                    h = new f;
                return h.left = c, h.top = d, h.right = h.left + e, h.bottom = h.top + g, h
            }, this.genReplyAnnotHTML = function(a, b, c, d) {
                var e = "";
                if (o.isMobile()) {
                    var f = "<li class='reply-annot' id='" + a.getAnnotName() + "' page-index='" + c + "'>",
                        i = 180,
                        j = "72px";
                    if (a.isParentReply) f += "<div style='padding-bottom:35px;position:relative;margin-left:36px;'>", f += "<div style='position:absolute;width:16px;height:16px;left:56px;' />", i = 216, j = "72px";
                    else {
                        var k = a.getReplyChain();
                        open = "", close = "display:none", k && 0 != k.length || (open = "display:none", close = "display:none"), f += "<div style='padding-bottom:35px;position:relative;'>", f += "<div style='position:absolute;width:16px;height:16px;left:0;'><svg style='width:16px;height:16px;float:left;' class='fwr-replys-state'><use class='child-open' xlink:href='#icon-annots-open-reply' style='" + open + "'></use><use class='child-close' xlink:href='#icon-annots-close-reply' style='" + close + "'></use></svg></div>"
                    }
                    f += "<div style='position:absolute;width:16px;height:16px;left:36px;'><svg style='width:16px;height:16px;float:left;'><use xlink:href='#icon-popup-reply'></use></svg></div>";
                    var l, m, n = a.getStateList();
                    if (n.length > 0) {
                        for (var p = 0; p < n.length; p++) m = n[p], "Review" == m.getStateMode() && (l = h(m.getState()));
                        f += "<div style='float:left;height:16px;width:16px;margin:1px 2px 0 0;' class=' " + l + " '></div>"
                    }
                    var q = "white-space: nowrap;text-overflow: ellipsis;overflow: hidden;";
                    f += "<div class='fwr-reply-title' style='" + q + "padding-left:72px;padding-right:25px;height:20px;font-size:1.0rem;margin:0 0 5px 0;'>" + g.htmlEncodeEx(a.getSubject()) + "</div>", f += "<div class='fwr-popup-replymenu' parent='reply' style='position:absolute;width:24px;height:24px;right:0;top:0;'><svg style='width:24px;height:24px;float:left;'><use xlink:href='#icon-annot-menu'></use></svg></div>", f += "<div style='" + q + "clear:both;font-size:1.0rem;padding-left:" + j + ";'>" + g.timestampToDateString(a.getModifyDate(), g.AnnotTimeFormat) + "</div>", f += "<div class='fwr_popup_content' style='clear:both; width:auto; font-size:1.0rem;margin-left:" + j + ";min-height:20px' contenteditable='true' annot-name='" + a.getAnnotName() + "''>" + g.htmlEncodeEx(a.getContents()) + "</div></div>", f += this.createReplyChainHtmlContent(a, b, !1, c), e += f + "</li>"
                } else {
                    var r = a.getColor(),
                        s = g.isColorBlack(r) ? "color:#fff;" : "color:#000;";
                    e += "<div class='popup_child' id='" + a.getAnnotName() + "' style='position:relative;margin-bottom:5px;border-style:solid; border-width: 1px;border-color:" + r + ";" + s + "'>", e += "<div class='popup_child fwr-annot-reply' style='position:relative;left:0px;top:0px;height:18px;overflow:hidden;background-color:" + r + "' annot-name='" + a.getAnnotName() + "'>";
                    var l, m, t = 2,
                        n = a.getStateList();
                    if (n.length > 0) {
                        t += 18;
                        for (var p = 0; p < n.length; p++) m = n[p], "Review" == m.getStateMode() && (l = h(m.getState()));
                        e += "<div class='popup_child fwr-annot-state-icon fwr-annot-reply" + l + "' annot-name='" + a.getAnnotName() + "'></div>"
                    }
                    var u = a.getTitle(); - 1 == u.indexOf(" to ") && (u += " to " + d), e += "<div class='popup_child' style='font-family:Arial;font-size:12px;position:relative;left:" + t + "px;'><div class='fwr-annot-reply' style='position: relative;line-height:18px; float:left;background-color:" + r + "' annot-name='" + a.getAnnotName() + "'>" + g.htmlEncodeEx(u) + "</div>", e += "<div class='popup_child fwr-annot-reply' style='position:relative;margin-left:13px;line-height:18px;float:none;background-color:" + r + ";overflow:hidden;text-overflow:ellipsis;padding-left:15px;white-space:nowrap' annot-name='" + a.getAnnotName() + "'>" + g.timestampToDateString(a.getModifyDate(), g.AnnotTimeFormat) + "</div></div>", e += "</div>", e += "<div class='popup_child' style='position:relative;clear:both;padding-left:5px;padding-right:5px;both; left: 0px; top: 0px;'>", contentClass = "popup_child", contentEditableAttr = "", o.isEditable() && (contentClass += " fwr_popup_content", contentEditableAttr = "contenteditable='true'"), e += "<div class='" + contentClass + "' page-index ='" + c + "' annot-name='" + a.getAnnotName() + "' annot-reply='true' " + contentEditableAttr + " style='clear:both;padding-top:2px;padding-bottom:2px;word-wrap: break-word; word-break: normal;color:#000;min-height: 14px;'>" + g.htmlEncodeEx(a.getContents()) + "</div>", e += this.createReplyChainHtmlContent(a, b, !1, c), e += "</div>", e += "</div>"
                }
                return e
            }, this.createReplyChainHtmlContent = function(a, b, c, d) {
                var e = a.getReplyChain(),
                    f = e.length,
                    g = "";
                o.isMobile() && f > 0 && (g += "<ul>");
                for (var h = 0; f > h; h++) {
                    var i = e[h];
                    "del" in i.annotJSONData && 1 == i.annotJSONData.del || (g += this.genReplyAnnotHTML(i, b, d, a.getTitle()))
                }
                return o.isMobile() && f > 0 && (g += "</ul>"), g
            }, this.createPopupAnnotHtmlContent = function(a, b, d, i, j) {
                var k = a.getPopup(),
                    m = "no_print";
                if (null == k || null != a.getHeadAnnot()) return "";
                var n = a.getAnnotName(),
                    q = p.getAnnotPopupDivID(b, n),
                    r = k.getRect();
                if (e.isEmpty(r)) {
                    var s = a.getRect(),
                        t = b.pdfRectToDevice(s, !0),
                        u = new f;
                    e.copy(t, u), u.left *= d, u.top *= d, u.right *= d, u.bottom *= d, r.left = u.left, r.top = u.top, r.right = r.left + WebPDF.Annot.MKA_POPUPWIDTH, r.bottom = r.top - WebPDF.Annot.MKA_POPUPHEIGHT
                }
                var v = b.pdfRectToDevice(r, !1),
                    w = Math.floor(e.width(v)),
                    x = Math.floor(e.height(v));
                v.top < 0 && (v.top = 0, v.bottom += x), j && l(v, b, d);
                var y = "";
                (0 === k.getOpenState() || o.isMobile() && !i) && (y = "display:none;");
                var z = 0,
                    A = "";
                if (!j) {
                    var B = b.getDocView().getRotate();
                    if (0 != B) {
                        z = (360 - B) % 360;
                        var C = (w - x) / 2;
                        A = 270 == z ? WebPDF.Common.getTransformCssString(z, -C, -C) : 90 == z ? WebPDF.Common.getTransformCssString(z, C, C) : WebPDF.Common.getTransformCssString(z)
                    }
                }
                var D = 0,
                    E = "";
                if (o.isMobile()) {
                    E += "<div id='" + q + "' class='fwr-popup-annot " + m + "' style='position:fixed; box-sizing:border-box; -webkit-box-sizing:border-box; -moz-box-sizing:border-box; left:0px !important; top:0px !important; width:100%; height:100%; background:rgba(0,0,0,0.5); padding: 20px; margin:0 auto; z-index:999999;" + y + "' page-index='" + b.getPageIndex() + "' annot-name='" + n + "'>", E += "<div id='fwrm-popup-container' style='float:left; width:100%; height:100%;'><div id='fwrm-popup-head' style='float:left;width:100%;height:52px;line-height：52px;font-size:1.4rem;background:#FFFFFF;border-radius:12px 12px 0 0;-webkit-border-radius:12px 12px 0 0;-moz-border-radius:12px 12px 0 0;'>", E += i ? "<p id='fwrm-popup-head-cancel' style='float:left;padding:10px 0 0 20px;'>Cancel</p>" : "<p id='fwrm-popup-head-delete' style='float:left;padding:10px 0 0 20px;'>Delete</p>", E += "<p id='fwrm-popup-head-ok' style='float:right;padding:10px 20px 0 0;'>OK</p>", E += "</div>", E += "<div id='fwrm-popup-content-container' style='float:left;width:100%;height:250px;overflow-y:auto;background:#fdf3a0;padding:20px 20px 10px 20px;border-radius:0 0 12px 12px;-webkit-border-radius:0 0 12px 12px;-moz-border-radius:0 0 12px 12px;box-sizing: border-box;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;text-shadow:none;'>";
                    var F, G = a.getStateList();
                    if (G.length > 0) {
                        for (var H = 0; H < G.length; H++) "Review" == G[H].getStateMode() && (F = h(G[H].getState()));
                        E += "<div style='float:left;height:16px;width:16px;margin:3px 10px 0 0;' class='" + F + "'></div>"
                    }
                    E += "<div style='padding:0 0 35px 0'><p style='float:left;width:80%;height:20px;font-size:1.5rem;margin:0 0 5px 0;'>" + g.htmlEncodeEx(a.getTitle()) + "</p>", E += "<div class='fwr-popup-replymenu' parent='popup' style='float:right;width:24px;height:24px;'><svg style='width:24px;height:24px;float:left;'><use xlink:href='#icon-annot-menu'></use></svg></div>", E += "<p class='popup-time' style='clear:both;width:100%; height:20px; font-size:1.0rem;margin:0 0 5px 0;'>" + g.timestampToDateString(a.getModifyDate(), g.AnnotTimeFormat) + "</p>", E += "<div id='fwrm-popup-content' class='fwr_popup_content' contenteditable='true' style='width:100%;min-height:22px;padding:1px;outline:0;font-size:1.0rem;word-wrap:break-word;word-break:normal;overflow-x:hidden;overflow-y:auto;'>" + g.htmlEncodeEx(a.getContents()) + "</div></div>", E += this.createReplyChainHtmlContent(a, 10, !0, b.getPageIndex()), E += "</div>", E += "</div>", E += "</div>"
                } else {
                    var I = g.isColorBlack(a.getColor()) ? "color:#fff;" : "";
                    if (E = "<div id='" + q + "' class='fwr-popup-annot " + m + "' style='left:" + v.left + "px;top:" + v.top + "px;width:" + w + "px;height:" + x + "px;background-color:" + a.getColor() + ";" + y + I + A + "' page-index='" + b.getPageIndex() + "' annot-name='" + n + "'>", E += "<div class='popup_header' style='position:absolute;left:0px;top:0px;height:20px;width:100%;overflow:hidden;'>", a.getSubType() === WebPDF.Annot.AnnotType.Text) {
                        var J = c(a.getTextAnnotName());
                        E += "<div class='popup_header fwr-annot-icon " + J + "'></div>"
                    }
                    E += "<div class='popup_header' style='position:relative;left:20px;width:" + (w - 40) + "px'><div class='popup_child'  style='position: absolute; left: 0px; top: 2px;background-color:" + a.getColor() + "'>" + g.htmlEncodeEx(a.getSubject()) + "</div>", E += "<div class='popup_header popup-time' style='position:absolute;top:2px;height:18px;right:1px;background-color:" + a.getColor() + "'>" + g.timestampToDateString(a.getModifyDate(), g.AnnotTimeFormat) + "</div></div>", E += "<div  data-i18n='Annot.ClosePopupAnnot' class='fwr-annot-close-btn' style='left:" + (w - 20) + "px;'></div>", E += "</div>", E += "<div class='popup_header' style='position:absolute;left:0px;top:20px;height:20px;width:100%'>";
                    var F, G = a.getStateList();
                    if (G.length > 0) {
                        for (var H = 0; H < G.length; H++) "Review" == G[H].getStateMode() && (F = h(G[H].getState()));
                        E += "<div class='popup_header fwr-annot-state-icon " + F + "'></div>"
                    }
                    E += "<div class='popup_header' style='white-space: nowrap;overflow: hidden;text-overflow: ellipsis;position:absolute;top:2px;height:18px;left:20px'>" + g.htmlEncodeEx(a.getTitle()) + "</div>", E += "</div>";
                    var K = "rgb(255, 255, 255)",
                        L = "";
                    WebPDF.Environment.ie8OrLower && (L = "white-space:normal;"), "#ffffff" === a.getColor() && (K = "rgb(240, 240, 240)"), E += "<div class='popup_child' style='overflow: auto; background-color: " + K + ";white-space: pre-wrap;" + L + "position: absolute; left: 4px; top:40px; width: " + (w - 8) + "px; bottom:10px;'>", E += "<div class='popup_child' style='position:relative;padding:2px;clear:both;left: 0px; top: 0px;'>", E += "<div class='popup_child fwr_popup_content' page-index ='" + b.getPageIndex() + "' annot-name='" + a.getAnnotName() + "' annot-reply='false' contenteditable='true' style='clear:both;padding-top:2px;padding-bottom:2px;word-wrap: break-word; word-break: normal;color:#000;min-height: 14px;'>" + g.htmlEncodeEx(a.getContents()) + "</div>", E += "</div>", E += this.createReplyChainHtmlContent(a, D, !1, b.getPageIndex()), E += "</div>", E += "</div>"
                }
                return E
            }, this.createAAnnotHtmlContent = function(a, d, g, h, l, m, q, r) {
                if (null == d || null == a || !d.isVisible()) return "";
                var s = d.canBePrint() ? "" : "no_print",
                    t = n.isAnnotRenderWithBackgroundImage(d),
                    u = a.getPDFPage(),
                    v = a.getScale(),
                    w = o.getPixelsPerPoint(),
                    x = (a.getPDFPageWidth() * w * v, a.getPDFPageHeight() * w * v, a.getPageIndex()),
                    y = (90 * u.getPageRotate() % 360 + 360) % 360,
                    z = (d.getRotate() % 360 + 360) % 360,
                    A = y - z,
                    B = d.getRect();
                WebPDF.RectUtils.normalize(B), "Text" == d.getSubType() && B.right - B.left < 20 && (B.right = B.left + 20, d.setRect(B));
                var C = null;
                C = q ? q : a.pdfRectToDevice(B, !0);
                var D = d.getType(),
                    E = new f;
                e.copy(C, E), h = (null != h && h) > 0 ? h : 1, E.left *= h, E.top *= h, E.right *= h, E.bottom *= h;
                var F = e.width(E),
                    G = e.height(E),
                    H = p.getAnnotDivID(a, d.getAnnotName()),
                    I = "";
                switch (D) {
                    case WebPDF.Annot.AnnotType.Link:
                        var J = d.getAction();
                        if (null != J) {
                            var K = "fwr-annot";
                            switch ("Select Text" === o.getCurToolHandler().getName() && (K = ""), J.getActionType()) {
                                case "URI":
                                    var L = J.getURI();
                                    L = L.replace(/^\s*/g, "");
                                    var M = L.toLowerCase(),
                                        N = 0 === M.indexOf("http:"),
                                        O = 0 === M.indexOf("https:");
                                    N || O || (L = "http://" + L), I = "<div id='" + H + "' class='" + K + " fwr_link_annot' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' link-uri='" + WebPDF.Common.htmlEncodeEx(L) + "' annot-name='" + g + "' page-index='" + x + "' title=\"" + L + '"></div>';
                                    break;
                                case "GoTo":
                                    I = "<div id='" + H + "' class='" + K + " fwr_link_annot' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' page-index='" + x + "' annot-name='" + g + "'></div>"
                            }
                        } else I = "<div id='" + H + "' class='fwr-annot' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' page-index='" + x + "' annot-name='" + g + "'></div>";
                        break;
                    case WebPDF.Annot.AnnotType.MarkUp:
                        if (t) I = "<div id='" + H + "' class='fwr-annot' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' page-index='" + x + "' annot-name='" + g + "'></div>";
                        else {
                            var P = d.getSubType();
                            switch (P) {
                                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT:
                                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE:
                                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY:
                                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT:
                                    var Q = d.getQuadPoints(),
                                        R = "",
                                        S = "",
                                        T = "",
                                        U = "";
                                    P == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE ? (R = "fwr-annot-underline-parent", S = "border-color:" + d.getColor()) : P == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? (R = "fwr-annot-highlight-parent", S = "background-color:" + d.getColorWithOpacity()) : P == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT ? R = "fwr-annot-strikeout-parent" : P == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY && (R = "fwr-annot-squiggly-parent"), I = "<div id='" + H + "' class='" + s + " ' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;position:absolute;' page-index='" + x + "' annot-name='" + g + "'></div>";
                                    var V, W = !1,
                                        X = p.getCommentAnnotDivID(a, g),
                                        Y = "<div class='" + s + "' id='" + X + "' page-index='" + x + "' annot-name='" + g + "'>";
                                    if (null != Q) {
                                        var Z = n.quadPointsToRectArray(Q, P, u.getPageMatrix());
                                        if (null != Z) {
                                            for (var _ = 0; _ < Z.length; _++) {
                                                V = Z[_], V = a.pdfRectToDevice(V, !0);
                                                var aa = V,
                                                    ba = p.getCommentAnnotQuadDivID(a, g, _),
                                                    ca = p.getCommentAnnotQuadCanvasID(a, g, _);
                                                if (P == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE) {
                                                    var da;
                                                    switch (A) {
                                                        case 0:
                                                            da = "border-width: 0 0 " + j(e.height(aa) * h / 8) + "px 0;";
                                                            break;
                                                        case 90:
                                                            da = "border-width: 0 0 0 " + j(e.width(aa) * h / 8) + "px;";
                                                            break;
                                                        case 180:
                                                            da = "border-width:" + j(e.height(aa) * h / 8) + "px 0 0 0;";
                                                            break;
                                                        case 270:
                                                            da = "border-width:0 " + j(e.width(aa) * h / 8) + "px 0 0;"
                                                    }
                                                    T = "border-style:solid;" + da
                                                } else T = "";
                                                if (P == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT) {
                                                    var ea = "",
                                                        fa = "",
                                                        ga = "",
                                                        ha = "";
                                                    0 === A || 180 === A ? (ea = "width:100%;", fa = "height:" + j(e.height(aa) * h / 8) + "px;", ga = "margin-top:-" + j(e.height(aa) * h / 16) + "px;", ha = "top:50%;") : (90 === A || 270 === A) && (ea = "height:100%;", fa = "width:" + j(e.width(aa) * h / 8) + "px;", ga = "margin-left:-" + j(e.width(aa) * h / 16) + "px;", ha = "left:50%;"), U = '<div class="inner-div" style="position:absolute;' + ea + ha + ga + fa + "background:" + d.getColor() + ';"></div>'
                                                } else if (P == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY) {
                                                    var ia = "",
                                                        ja = 0,
                                                        ka = 0;
                                                    switch (A) {
                                                        case 0:
                                                            ia = "bottom:0px;", ja = j(e.width(aa) * h), ka = j(e.height(aa) * h / 4);
                                                            break;
                                                        case 90:
                                                            ja = j(e.width(aa) * h / 4), ka = j(e.height(aa) * h);
                                                            break;
                                                        case 180:
                                                            ia = "top:0px", ja = j(e.width(aa) * h), ka = j(e.height(aa) * h / 4);
                                                            break;
                                                        case 270:
                                                            ja = j(e.width(aa) * h / 4), ka = j(e.height(aa) * h), ia = "left:" + 3 * ja + "px"
                                                    }
                                                    U = "<canvas  id = '" + ca + "' class='vml " + R + "' style='position:absolute;" + ia + "' height='" + ka + "' width='" + ja + "' ></canvas>"
                                                } else U = "";
                                                Y += "<div id='" + ba + "' class='fwr-highlight-annot fwr-annot fwr-annot-data " + R + "' style='" + S + ";" + T + "left:" + aa.left * h + "px;top:" + aa.top * h + "px;width:" + e.width(aa) * h + "px;height:" + j(e.height(aa) * h) + "px' page-index='" + x + "' annot-name='" + g + "' >" + U + "</div>"
                                            }
                                            W = !0
                                        }
                                    }
                                    if (!W) {
                                        var la = p.getCommentAnnotRectDivID(a, g);
                                        Y += "<div id='" + la + "' class='fwr-annot-highlight fwr-annot-data ' style='background-color:" + d.getColor() + ";left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px' ></div>"
                                    }
                                    Y += "</div>", I += Y;
                                    break;
                                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET:
                                    if (!t) {
                                        var ma = p.getDrawingAnnotBorderDivID(a, g),
                                            X = p.getDrawingAnnotDivID(a, g),
                                            na = p.getAnnotCanvasDivID(a, g),
                                            oa = i.adjust(a, d, h),
                                            pa = {
                                                annotDivID: H,
                                                select_left: E.left - oa - 1,
                                                select_top: E.top - oa - 1,
                                                left: E.left - oa,
                                                top: E.top - oa,
                                                width: F + 2 * oa,
                                                height: G + 2 * oa,
                                                pageIndex: x,
                                                annotBorderID: ma,
                                                annotName: g,
                                                noPrintClassName: s,
                                                annotShowDivID: X,
                                                canvasID: na,
                                                ca: d.annotJSONData.ca
                                            };
                                        I = k(pa)
                                    }
                                    break;
                                case WebPDF.Annot.AnnotType.Text:
                                    if (!t) {
                                        s = "no_print";
                                        var qa = "";
                                        0 != A && (qa = ";" + WebPDF.Common.getTransformCssString(A)), I = "<div id='" + H + "' class='fwr-annot fwr-annot-text-parent' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' page-index='" + x + "' annot-name='" + g + "'></div>";
                                        var X = p.getTextAnnotDivID(a, g),
                                            Y = "<div>";
                                        c(d.getTextAnnotName());
                                        Y += b.isMobile() ? "<div class='fwr-text-annot fwrm-text-annot fwr-annot-data  " + s + "' id='" + X + "' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;" + qa + ";background-position: center center; background-repeat: no-repeat;'><svg><use xlink:href='#icon-text-annot'></use></svg>" : "<div class='fwr-text-annot fwr-annot-data " + s + "' id='" + X + "' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;" + qa + ";background-position: center center; background-repeat: no-repeat;'>", Y += "</div>", Y += "</div>", I += Y
                                    }
                                    break;
                                case WebPDF.Annot.AnnotType.Ink:
                                    if (!t) {
                                        I = "<div id='" + H + "' class='fwr-annot fwr-annot-ink-parent' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' page-index='" + x + "' annot-name='" + g + "'></div>";
                                        var X = p.getInkAnnotDivID(a, g),
                                            na = p.getAnnotCanvasDivID(a, g),
                                            Y = "<div class='" + s + "'>";
                                        Y += "<div class='fwr-ink-annot fwr-annot-data ' id='" + X + "' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px'>", Y += "<div style='position:absolute;left:0px;top:0px;width:100%;height:100%'>", Y += "<canvas class='vml' id='" + na + "' width='" + F + "' height='" + G + "' style='position:absolute;left:0px;top:0px;width:100%;height:100%;' />", Y += "</div>", Y += "</div>", Y += "</div>", I += Y
                                    }
                                    break;
                                case WebPDF.Annot.AnnotType.Stamp:
                                    var ra = p.getStampDivID(a, g),
                                        sa = p.getStampImageID(a, g),
                                        ma = p.getStampBorderID(a, g),
                                        ta = p.getStampDnamicID(a, g),
                                        ua = d.getIcon(),
                                        va = o.getMainView().getDocView(),
                                        wa = va.getRotate(),
                                        xa = "",
                                        ya = F,
                                        za = G,
                                        Aa = 0,
                                        Ba = 0,
                                        Ca = 0;
                                    if (m) switch (y) {
                                        case 0:
                                            90 == z ? (Aa = -90, ya = G, za = F, Ba = Ca = (F - G) / 2) : 180 == z ? Aa = -180 : 270 == z && (Aa = -270, ya = G, za = F, Ba = Ca = -(F - G) / 2);
                                            break;
                                        case 90:
                                            0 == z ? (Aa = -270, ya = G, za = F, Ba = Ca = -(F - G) / 2) : 180 == z ? (Aa = -90, ya = G, za = F, Ba = Ca = (F - G) / 2) : 270 == z && (Aa = -180);
                                            break;
                                        case 180:
                                            0 == z ? Aa = -180 : 90 == z ? (Aa = -270, ya = G, za = F, Ba = Ca = -(F - G) / 2) : 270 == z && (Aa = -90, ya = G, za = F, Ba = Ca = (F - G) / 2);
                                            break;
                                        case 270:
                                            0 == z ? (Aa = -90, ya = G, za = F, Ba = Ca = (F - G) / 2) : 90 == z ? Aa = -180 : 180 == z && (Aa = -270, ya = G, za = F, Ba = Ca = -(F - G) / 2)
                                    } else switch (wa) {
                                        case 90:
                                            Aa = -90, ya = G, za = F, Ba = Ca = (F - G) / 2;
                                            break;
                                        case 180:
                                            Aa = -180;
                                            break;
                                        case 270:
                                            Aa = -270, ya = G, za = F, Ba = Ca = -(F - G) / 2
                                    }
                                    xa = WebPDF.Common.getTransformCssString(Aa, Ba, Ca);
                                    var I = "<div class='fwr-annot fwr-annot-stamp-parent' style='position: absolute; left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' id='" + ra + "'page-index ='" + a.getPageIndex() + "' annot-name='" + g + "'> <div style='display:none' id='" + ma + "'> </div></div><div><Image src=' " + WebPDF.optionParameters.baseUrl + ua + "' id='" + sa + "' class = 'fwr-annot-data fwr-annot-stamp-image' style='position: absolute; left:" + E.left + "px;top:" + E.top + "px;width:" + ya + "px;height:" + za + "px;" + xa + "'>",
                                        Da = "";
                                    if (d.isDynamic()) {
                                        var Ea = d.getDynamicInfo();
                                        d.setDynamicInfo(Ea), xa = "";
                                        var Fa = 0,
                                            Ga = 0,
                                            Ha = 0,
                                            Ia = 0,
                                            Ja = 0;
                                        if (offSetX = 0, offSetY = 0, m) {
                                            var Ka = 1;
                                            Ka = F > G ? F / WebPDF.Annot.StampDefaultValue.Width : G / WebPDF.Annot.StampDefaultValue.Width, Ha = 12 * Ka;
                                            var La = "annot_dynamic_temp";
                                            Da = "<p id='" + La + "' class ='fwr-stamp-info' style='display:none;position: absolute; left:" + Ia + "px;top:" + Ja + "px;font-size:" + Ha + "px; " + xa + "'>" + Ea + "</p>", $(document.body).append(Da);
                                            var Ma = $("#" + La),
                                                Na = Ma.width(),
                                                Oa = Ma.height();
                                            if (Ma.remove(), 0 == y) {
                                                switch (z) {
                                                    case 0:
                                                        Aa = 0, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Fa, Ja = E.top + Ga;
                                                        break;
                                                    case 90:
                                                        Aa = -90, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Height, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Width, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Ga, Ja = E.bottom - Fa;
                                                        break;
                                                    case 180:
                                                        Aa = -180, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Fa, Ja = E.bottom - Ga;
                                                        break;
                                                    case 270:
                                                        Aa = -270, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Height, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Width, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Ga, Ja = E.top + Fa
                                                }
                                                if (12 > Ha) {
                                                    var Pa = Ha / 12,
                                                        Qa = Na * (1 - Pa) / 2,
                                                        Ra = Oa * (1 - Pa) / 2;
                                                    Ja -= Ra
                                                }
                                            } else if (90 == y) switch (z) {
                                                case 0:
                                                    if (Aa = -270, Fa = WebPDF.Annot.stampInfoOffset.left * G / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * F / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Ga, Ja = E.top + Fa, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Oa * (1 - Pa) / 2,
                                                            Ra = Na * (1 - Pa) / 2;
                                                        Ja += Qa
                                                    }
                                                    break;
                                                case 90:
                                                    if (Aa = 0, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Fa, Ja = E.top + Ga, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Na * (1 - Pa) / 2,
                                                            Ra = Oa * (1 - Pa) / 2;
                                                        Ja -= Ra
                                                    }
                                                    break;
                                                case 180:
                                                    if (Aa = -90, Fa = WebPDF.Annot.stampInfoOffset.left * G / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * F / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Ga, Ja = E.bottom - Fa, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Na * (1 - Pa) / 2,
                                                            Ra = Oa * (1 - Pa) / 2;
                                                        Ja -= Ra
                                                    }
                                                    break;
                                                case 270:
                                                    if (Aa = -180, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Fa, Ja = E.bottom - Ga, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Na * (1 - Pa) / 2,
                                                            Ra = Oa * (1 - Pa) / 2;
                                                        Ja -= Ra
                                                    }
                                            } else if (180 == y) switch (z) {
                                                    case 0:
                                                        if (Aa = -180, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Fa, Ja = E.bottom - Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                        break;
                                                    case 90:
                                                        if (Aa = -270, Fa = WebPDF.Annot.stampInfoOffset.left * G / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * F / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Ga, Ja = E.top + Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Oa * (1 - Pa) / 2,
                                                                Ra = Na * (1 - Pa) / 2;
                                                            Ja += Qa
                                                        }
                                                        break;
                                                    case 180:
                                                        if (Aa = 0, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Fa, Ja = E.top + Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ia += Ra, Ja -= Ra
                                                        }
                                                        break;
                                                    case 270:
                                                        if (Aa = -90, Fa = WebPDF.Annot.stampInfoOffset.left * G / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * F / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Ga, Ja = E.bottom - Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                } else if (270 == y) switch (z) {
                                                    case 0:
                                                        if (Aa = -90, Fa = WebPDF.Annot.stampInfoOffset.left * G / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * F / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Ga, Ja = E.bottom - Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                        break;
                                                    case 90:
                                                        if (Aa = -180, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Fa, Ja = E.bottom - Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                        break;
                                                    case 180:
                                                        if (Aa = -270, Fa = WebPDF.Annot.stampInfoOffset.left * G / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * F / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Ga, Ja = E.top + Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Oa * (1 - Pa) / 2,
                                                                Ra = Na * (1 - Pa) / 2;
                                                            Ja += Qa
                                                        }
                                                        break;
                                                    case 270:
                                                        if (Aa = 0, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Fa, Ja = E.top + Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ia += Ra, Ja -= Ra
                                                        }
                                                }
                                                xa = WebPDF.Common.getTransformCssString(Aa, offSetX, offSetY, 0, 0, Pa), Da = "<p id='" + ta + "' class ='fwr-stamp-info' style='margin:0 auto;padding:0;list-style:none;border:none;position: absolute; left:" + Ia + "px;top:" + Ja + "px;font-size:" + Ha + "px; " + xa + "'>" + Ea + "</p>"
                                        } else {
                                            switch (wa) {
                                                case 0:
                                                    Aa = 0, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Fa, Ja = E.top + Ga;
                                                    break;
                                                case 90:
                                                    Aa = -90, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Height, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Width, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.left + Ga, Ja = E.bottom - Fa;
                                                    break;
                                                case 180:
                                                    Aa = -180, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Width, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Height, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Fa, Ja = E.bottom - Ga;
                                                    break;
                                                case 270:
                                                    Aa = -270, Fa = WebPDF.Annot.stampInfoOffset.left * F / WebPDF.Annot.StampDefaultValue.Height, Ga = WebPDF.Annot.stampInfoOffset.top * G / WebPDF.Annot.StampDefaultValue.Width, Ha = 12 * G / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Ga, Ja = E.top + Fa
                                            }
                                            xa = WebPDF.Common.getTransformCssString(Aa, 0, 0), Da = "<p id='" + ta + "' class ='fwr-stamp-info' style='position: absolute; left:" + Ia + "px;top:" + Ja + "px;font-size:" + Ha + "px; " + xa + "'>" + Ea + "</p>"
                                        }
                                    }
                                    I += Da, I += "</image>", I += "</div>";
                                    break;
                                case WebPDF.Annot.AnnotType.Circle:
                                case WebPDF.Annot.AnnotType.Square:
                                case WebPDF.Annot.AnnotType.Line:
                                    if (!t) {
                                        var ma = p.getDrawingAnnotBorderDivID(a, g),
                                            X = p.getDrawingAnnotDivID(a, g),
                                            na = p.getAnnotCanvasDivID(a, g),
                                            oa = i.adjust(a, d, h),
                                            pa = {
                                                annotDivID: H,
                                                select_left: E.left - oa - 1,
                                                select_top: E.top - oa - 1,
                                                left: E.left - oa,
                                                top: E.top - oa,
                                                width: F + 2 * oa,
                                                height: G + 2 * oa,
                                                pageIndex: x,
                                                annotBorderID: ma,
                                                annotName: g,
                                                noPrintClassName: s,
                                                annotShowDivID: X,
                                                canvasID: na,
                                                ca: d.annotJSONData.ca
                                            };
                                        I = k(pa)
                                    }
                                    break;
                                case WebPDF.Annot.AnnotType.Polygon:
                                case WebPDF.Annot.AnnotType.PolyLine:
                                    if (!t) {
                                        var ma = p.getDrawingAnnotBorderDivID(a, g),
                                            X = p.getDrawingAnnotDivID(a, g),
                                            na = p.getAnnotCanvasDivID(a, g),
                                            Sa = E.left,
                                            Ta = E.top,
                                            Ua = E.left,
                                            Va = E.top,
                                            Wa = F,
                                            Xa = G,
                                            pa = {
                                                annotDivID: H,
                                                select_left: Sa,
                                                select_top: Ta,
                                                left: Ua,
                                                top: Va,
                                                width: Wa,
                                                height: Xa,
                                                pageIndex: x,
                                                annotBorderID: ma,
                                                annotName: g,
                                                noPrintClassName: s,
                                                annotShowDivID: X,
                                                canvasID: na,
                                                ca: d.annotJSONData.ca,
                                                subType: P
                                            };
                                        "PolygonCloud" == d.annotJSONData.it && (pa.ca = 1), I = k(pa)
                                    }
                                    break;
                                case WebPDF.Annot.AnnotType.Image:
                                    wa = a.getDocView().getRotate(), A = y - wa - z;
                                    var ra = p.getImageDivID(a, g),
                                        sa = p.getImageImageID(a, g),
                                        ma = p.getImageBorderID(a, g),
                                        ta = p.getImageDnamicID(a, g),
                                        Ya = d.getImageURL(),
                                        Za = d.getNatualWidth(),
                                        $a = d.getNaturalHeight(),
                                        va = o.getMainView().getDocView(),
                                        wa = va.getRotate(),
                                        _a = 0;
                                    _a = m ? -wa - y : -wa;
                                    var xa = "",
                                        ya = F,
                                        za = G,
                                        Aa = 0,
                                        Ba = 0,
                                        Ca = 0;
                                    if (m) switch (y) {
                                        case 0:
                                            90 == z ? (ya = G, za = F, Ba = Ca = (F - G) / 2) : 180 == z || 270 == z && (ya = G, za = F, Ba = Ca = -(F - G) / 2);
                                            break;
                                        case 90:
                                            0 == z ? (ya = G, za = F, Ba = Ca = -(F - G) / 2) : 180 == z && (ya = G, za = F, Ba = Ca = (F - G) / 2);
                                            break;
                                        case 180:
                                            0 == z || (90 == z ? (ya = G, za = F, Ba = Ca = -(F - G) / 2) : 270 == z && (ya = G, za = F, Ba = Ca = (F - G) / 2));
                                            break;
                                        case 270:
                                            0 == z ? (ya = G, za = F, Ba = Ca = (F - G) / 2) : 90 == z || 180 == z && (ya = G, za = F, Ba = Ca = -(F - G) / 2)
                                    } else switch (wa) {
                                        case 90:
                                            ya = G, za = F, Ba = Ca = (F - G) / 2;
                                            break;
                                        case 180:
                                            break;
                                        case 270:
                                            ya = G, za = F, Ba = Ca = -(F - G) / 2
                                    }
                                    xa = WebPDF.Common.getTransformCssString(_a, Ba, Ca);
                                    var I = "<div class='fwr-annot fwr-annot-image-parent' style='position: absolute; left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' id='" + ra + "'page-index ='" + a.getPageIndex() + "' annot-name='" + g + "'> <div style='display:none' id='" + ma + "'> </div></div><div><image src='" + Ya + "' id='" + sa + "' class = 'fwr-annot-data fwr-annot-stamp-image' style='position: absolute; left:" + E.left + "px;top:" + E.top + "px;width:" + ya + "px;height:" + za + "px;opacity: " + d.getOpacity() + ";" + xa + "'>",
                                        Da = "";
                                    if (d.isDynamic()) {
                                        var Ea = d.getDynamicInfo();
                                        d.setDynamicInfo(Ea), xa = "";
                                        var Fa = 0,
                                            Ga = 0,
                                            Ha = 0,
                                            Ia = 0,
                                            Ja = 0;
                                        if (offSetX = 0, offSetY = 0, m) {
                                            var Ka = 1;
                                            Ka = F > G ? F / Za : G / Za, Ha = 12 * Ka;
                                            var La = "annot_dynamic_temp";
                                            Da = "<p id='" + La + "' class ='fwr-stamp-info' style='display:none;position: absolute; left:" + Ia + "px;top:" + Ja + "px;font-size:" + Ha + "px; " + xa + "'>" + Ea + "</p>", $(document.body).append(Da);
                                            var Ma = $("#" + La),
                                                Na = Ma.width(),
                                                Oa = Ma.height();
                                            if (Ma.remove(), Fa = WebPDF.Annot.stampInfoOffset.left * F / Za, Ga = WebPDF.Annot.stampInfoOffset.top * G / $a, Ha = 12 * G / Za, 0 == y) {
                                                switch (z) {
                                                    case 0:
                                                        Aa = 0, Ia = E.left + Fa, Ja = E.top + Ga;
                                                        break;
                                                    case 90:
                                                        Aa = -90, Ia = E.left + Ga, Ja = E.bottom - Fa;
                                                        break;
                                                    case 180:
                                                        Aa = -180, Ha = 12 * F / WebPDF.Annot.StampDefaultValue.Width, Ia = E.right - Fa, Ja = E.bottom - Ga;
                                                        break;
                                                    case 270:
                                                        Aa = -270, Ia = E.right - Ga, Ja = E.top + Fa
                                                }
                                                if (12 > Ha) {
                                                    var Pa = Ha / 12,
                                                        Qa = Na * (1 - Pa) / 2,
                                                        Ra = Oa * (1 - Pa) / 2;
                                                    Ja -= Ra
                                                }
                                            } else if (90 == y) switch (z) {
                                                case 0:
                                                    if (Aa = -270, Ia = E.right - Ga, Ja = E.top + Fa, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Oa * (1 - Pa) / 2,
                                                            Ra = Na * (1 - Pa) / 2;
                                                        Ja += Qa
                                                    }
                                                    break;
                                                case 90:
                                                    if (Aa = 0, Ia = E.left + Fa, Ja = E.top + Ga, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Na * (1 - Pa) / 2,
                                                            Ra = Oa * (1 - Pa) / 2;
                                                        Ja -= Ra
                                                    }
                                                    break;
                                                case 180:
                                                    if (Aa = -90, Ia = E.left + Ga, Ja = E.bottom - Fa, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Na * (1 - Pa) / 2,
                                                            Ra = Oa * (1 - Pa) / 2;
                                                        Ja -= Ra
                                                    }
                                                    break;
                                                case 270:
                                                    if (Aa = -180, Ia = E.right - Fa, Ja = E.bottom - Ga, 12 > Ha) {
                                                        var Pa = Ha / 12,
                                                            Qa = Na * (1 - Pa) / 2,
                                                            Ra = Oa * (1 - Pa) / 2;
                                                        Ja -= Ra
                                                    }
                                            } else if (180 == y) switch (z) {
                                                    case 0:
                                                        if (Aa = -180, Ia = E.right - Fa, Ja = E.bottom - Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                        break;
                                                    case 90:
                                                        if (Aa = -270, Ia = E.right - Ga, Ja = E.top + Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Oa * (1 - Pa) / 2,
                                                                Ra = Na * (1 - Pa) / 2;
                                                            Ja += Qa
                                                        }
                                                        break;
                                                    case 180:
                                                        if (Aa = 0, Ia = E.left + Fa, Ja = E.top + Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ia += Ra, Ja -= Ra
                                                        }
                                                        break;
                                                    case 270:
                                                        if (Aa = -90, Ia = E.left + Ga, Ja = E.bottom - Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                } else if (270 == y) switch (z) {
                                                    case 0:
                                                        if (Aa = -90, Ia = E.left + Ga, Ja = E.bottom - Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                        break;
                                                    case 90:
                                                        if (Aa = -180, Ia = E.right - Fa, Ja = E.bottom - Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ja -= Ra
                                                        }
                                                        break;
                                                    case 180:
                                                        if (Aa = -270, Ia = E.right - Ga, Ja = E.top + Fa, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Oa * (1 - Pa) / 2,
                                                                Ra = Na * (1 - Pa) / 2;
                                                            Ja += Qa
                                                        }
                                                        break;
                                                    case 270:
                                                        if (Aa = 0, Ia = E.left + Fa, Ja = E.top + Ga, 12 > Ha) {
                                                            var Pa = Ha / 12,
                                                                Qa = Na * (1 - Pa) / 2,
                                                                Ra = Oa * (1 - Pa) / 2;
                                                            Ia += Ra, Ja -= Ra
                                                        }
                                                }
                                                xa = WebPDF.Common.getTransformCssString(Aa, offSetX, offSetY, 0, 0, Pa), Da = "<p id='" + ta + "' class ='fwr-image-info' style='margin:0 auto;padding:0;list-style:none;border:none;position: absolute; left:" + Ia + "px;top:" + Ja + "px;font-size:" + Ha + "px; " + xa + "'>" + Ea + "</p>"
                                        } else {
                                            switch (Fa = WebPDF.Annot.stampInfoOffset.left * F / Za, Ga = WebPDF.Annot.stampInfoOffset.top * G / $a, Ha = 12 * F / Za, wa) {
                                                case 0:
                                                    Aa = 0, Ia = E.left + Fa, Ja = E.top + Ga;
                                                    break;
                                                case 90:
                                                    Aa = -90, Ia = E.left + Ga, Ja = E.bottom - Fa;
                                                    break;
                                                case 180:
                                                    Aa = -180, Ia = E.right - Fa, Ja = E.bottom - Ga;
                                                    break;
                                                case 270:
                                                    Aa = -270, Ia = E.right - Ga, Ja = E.top + Fa
                                            }
                                            xa = WebPDF.Common.getTransformCssString(Aa, 0, 0), Da = "<p id='" + ta + "' class ='fwr-stamp-info' style='position: absolute; left:" + Ia + "px;top:" + Ja + "px;font-size:" + Ha + "px; " + xa + "'>" + Ea + "</p>"
                                        }
                                    }
                                    I += Da, I += "</image>", I += "</div>"
                            }
                        }
                        if (r !== !0) {
                            var ab = p.createPopupAnnotHtmlContent(d, a, h, l, m);
                            if (o.isMobile())
                                if ($(".fwrm-popups").get(0)) $(".fwrm-popups").append(ab);
                                else {
                                    var bb = "<div class='fwrm-popups'></div>";
                                    $("body").append(bb), $(".fwrm-popups").append(ab)
                                }
                            else I += ab
                        }
                        break;
                    case WebPDF.Annot.AnnotType.TypeWriter:
                        var cb = F,
                            db = G;
                        if (!t) {
                            var eb = d.getIT();
                            if (eb.toLowerCase() == WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TYPEWRITER.toLowerCase()) {
                                var fb = "left";
                                switch (d.getTextAlign()) {
                                    case WebPDF.Annot.TypeWriterTextAlignStyle.CENTERED:
                                        fb = "center";
                                        break;
                                    case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                        fb = "right"
                                }
                                var qa = "",
                                    gb = "";
                                if (0 != A) switch (A) {
                                    case 270:
                                    case -90:
                                        cb = G + .5, db = F + .5, qa = WebPDF.Common.getTransformCssString(270, -cb, 0, 0, 0);
                                        break;
                                    case -270:
                                    case 90:
                                        cb = G + .5, db = F + .5, qa = WebPDF.Common.getTransformCssString(90, 0, -db, 0, 0);
                                        break;
                                    case 180:
                                    case -180:
                                        qa = WebPDF.Common.getTransformCssString(180, 0, 0)
                                }
                                I = "<div id='" + H + "' class='fwr-annot fwr-annot-typewriter-parent' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' page-index='" + x + "' annot-name='" + g + "'></div>";
                                var hb = p.getTypewriterAnnotDivID(a, g),
                                    ib = d.getOpacity(),
                                    jb = o.getPixelsPerPoint(),
                                    kb = a.getScale(),
                                    Pa = kb * h,
                                    Ha = d.getFontSize() * jb * Pa;
                                WebPDF.Engine.JR && (Ha /= jb);
                                var lb = d.getLineHeight();
                                (isNaN(lb) || 0 == lb) && (lb = d.getFontHeight(), d.setLineHeight(lb)), lb *= jb * Pa;
                                var mb = "line-height:" + lb + "px;font-size:" + Ha + "px;color:" + d.getFontColor() + ";opacity:" + ib + ";text-align:" + fb + ";font-family:" + d.getFontName() + ";" + qa + "width:" + (cb + .05) + "px;height:" + (db + .05) + "px;",
                                    nb = "";
                                ib >= 0 && 1 > ib && (nb += "alpha(opacity=" + 100 * ib + ") "), nb += gb, "" != nb && (mb += "filter:" + nb + ";");
                                var ob = "<textarea id='" + p.getTypewriterAnnotRectDivID(a, g) + "'class='fwr-typewriter-annot-nor fwr-annot-data 'style='" + mb + "-webkit-user-select:auto;word-break: break-all;'>" + d.getContents() + "</textarea>",
                                    pb = "position: absolute;left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;";
                                I += "<div id='" + hb + "'style='" + pb + "-webkit-user-select:auto;'>" + ob + "</div>"
                            }
                        }
                        break;
                    case WebPDF.Annot.AnnotType.Callout:
                        var cb = F,
                            db = G;
                        if (!t) {
                            var eb = d.getIT();
                            if (eb.toLowerCase() == WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT.toLowerCase()) {
                                var fb = "left";
                                switch (d.getTextAlign()) {
                                    case WebPDF.Annot.TypeWriterTextAlignStyle.CENTERED:
                                        fb = "center";
                                        break;
                                    case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                        fb = "right"
                                }
                                var qa = "",
                                    gb = "";
                                if (0 != A) switch (A) {
                                    case 270:
                                    case -90:
                                        cb = G + .5, db = F + .5, qa = WebPDF.Common.getTransformCssString(270, -cb, 0, 0, 0);
                                        break;
                                    case -270:
                                    case 90:
                                        cb = G + .5, db = F + .5, qa = WebPDF.Common.getTransformCssString(90, 0, -db, 0, 0);
                                        break;
                                    case 180:
                                    case -180:
                                        qa = WebPDF.Common.getTransformCssString(180, 0, 0)
                                }
                                I = "<div id='" + H + "' class='fwr-annot fwr-annot-callout-parent' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;z-index:6;' page-index='" + x + "' annot-name='" + g + "'></div>";
                                var hb = p.getCalloutAnnotDivID(a, g),
                                    ib = d.getOpacity(),
                                    jb = o.getPixelsPerPoint(),
                                    kb = a.getScale(),
                                    Pa = kb * h,
                                    Ha = d.getFontSize() * jb * Pa,
                                    lb = d.getLineHeight();
                                (isNaN(lb) || 0 == lb) && (lb = d.getFontHeight(), d.setLineHeight(lb));
                                var qb = new f,
                                    rb = new f;
                                eb.toLowerCase() === WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT.toLowerCase() && (qb = d.getRectDiffer(), e.copy(qb, rb), rb.left *= kb * jb * h, rb.top *= kb * jb * h, rb.right *= kb * jb * h, rb.bottom *= kb * jb * h);
                                var sb, tb, ub, vb, wb, xb = a.getDocView().getRotate(),
                                    yb = 90 * a.getPDFPage().getPageRotate(),
                                    z = d.getRotate();
                                wb = m ? z : xb, 0 === yb ? 90 === wb ? (sb = cb - rb.top - rb.bottom - 1, tb = db - rb.left - rb.right - 1, ub = rb.left + .5, vb = -(rb.bottom + .5)) : 180 === wb ? (sb = cb - rb.left - rb.right - 1, tb = db - rb.top - rb.bottom - 1, ub = rb.left + .5, vb = rb.top + .5) : 270 === wb ? (sb = cb - rb.top - rb.bottom - 1, tb = Math.abs(db - rb.left - rb.right - 1), ub = -(rb.right + .5), vb = rb.top + .5) : (sb = cb - rb.left - rb.right - 1, tb = db - rb.top - rb.bottom - 1, ub = rb.left + .5, vb = rb.top + .5) : 90 === yb ? (m && (wb -= 90), 90 === wb ? (sb = cb - rb.left - rb.right - 1, tb = db - rb.top - rb.bottom - 1, ub = rb.bottom + .5, vb = -(rb.right + .5)) : 180 === wb ? (sb = cb - rb.top - rb.bottom - 1, tb = db - rb.left - rb.right - 1, ub = rb.bottom + .5, vb = rb.left + .5) : 270 === wb ? (sb = cb - rb.left - rb.right - 1, tb = Math.abs(db - rb.top - rb.bottom - 1), ub = -(rb.top + .5), vb = rb.left + .5) : (sb = cb - rb.top - rb.bottom - 1, tb = db - rb.left - rb.right - 1, ub = rb.bottom + .5, vb = rb.left + .5)) : 180 === yb ? (m && (wb -= 180), 90 === wb ? (sb = cb - rb.top - rb.bottom - 1, tb = db - rb.left - rb.right - 1, ub = rb.right + .5, vb = -(rb.top + .5)) : 180 === wb ? (sb = cb - rb.left - rb.right - 1, tb = db - rb.top - rb.bottom - 1, ub = rb.right + .5, vb = rb.bottom + .5) : 270 === wb ? (sb = cb - rb.top - rb.bottom - 1, tb = Math.abs(db - rb.left - rb.right - 1), ub = -(rb.left + .5), vb = rb.bottom + .5) : (sb = cb - rb.left - rb.right - 1, tb = db - rb.top - rb.bottom - 1, ub = rb.right + .5, vb = rb.bottom + .5)) : 270 === yb && (m && (wb -= 270), 90 === wb ? (sb = cb - rb.left - rb.right - 1, tb = db - rb.top - rb.bottom - 1, ub = rb.top + .5, vb = -(rb.left + .5)) : 180 === wb ? (sb = cb - rb.top - rb.bottom - 1, tb = db - rb.left - rb.right - 1, ub = rb.top + .5, vb = rb.right + .5) : 270 === wb ? (sb = cb - rb.left - rb.right - 1, tb = Math.abs(db - rb.top - rb.bottom - 1), ub = -(rb.bottom + .5), vb = rb.right + .5) : (sb = cb - rb.top - rb.bottom - 1, tb = db - rb.left - rb.right - 1, ub = rb.top + .5, vb = rb.right + .5)), lb *= jb * Pa;
                                var mb = "line-height:" + lb + "px;font-size:" + Ha + "px;color:" + d.getFontColor() + ";opacity:" + ib + ";text-align:" + fb + ";font-family:" + d.getFontName() + ";" + qa + ";width:" + sb + "px;height:" + tb + "px;position: absolute;left:" + ub + "px;top:" + vb + "px;",
                                    nb = "";
                                ib >= 0 && 1 > ib && (nb += "alpha(opacity=" + 100 * ib + ") "), nb += gb, "" != nb && (mb += "filter:" + nb + ";");
                                var ob = "<textarea id='" + p.getCalloutAnnotRectDivID(a, g) + "'class='fwr-callout-annot-nor fwr-annot-data 'style='" + mb + "-webkit-user-select:auto;'>" + d.getContents() + "</textarea>",
                                    pb = "position: absolute;left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;",
                                    zb = "<canvas class='vml' id='" + p.getCanvasAnnotRectCanvasDivID(a, g) + "' width='" + F + "' height='" + G + "' style='-moz-opacity:1;opacity:1;position:absolute;left:0px;top:0px;z-index:4;'></canvas>";
                                I += "<div id='" + hb + "'style='" + pb + "-webkit-user-select:auto;'>" + ob + zb + "</div>"
                            }
                        }
                        break;
                    case WebPDF.Annot.AnnotType.Textbox:
                        var cb = F,
                            db = G;
                        if (!t) {
                            var eb = d.getIT();
                            if (eb.toLowerCase() == WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TEXTBOX.toLowerCase()) {
                                var fb = "left";
                                switch (d.getTextAlign()) {
                                    case WebPDF.Annot.TypeWriterTextAlignStyle.CENTERED:
                                        fb = "center";
                                        break;
                                    case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                        fb = "right"
                                }
                                var qa = "",
                                    gb = "";
                                if (0 != A) switch (A) {
                                    case 270:
                                    case -90:
                                        cb = G + .5, db = F + .5, qa = WebPDF.Common.getTransformCssString(270, -cb, 0, 0, 0);
                                        break;
                                    case -270:
                                    case 90:
                                        cb = G + .5, db = F + .5, qa = WebPDF.Common.getTransformCssString(90, 0, -db, 0, 0);
                                        break;
                                    case 180:
                                    case -180:
                                        qa = WebPDF.Common.getTransformCssString(180, 0, 0)
                                }
                                var ma = p.getDrawingAnnotBorderDivID(a, g);
                                I = "<div id='" + H + "' class='fwr-annot fwr-annot-textbox-parent' style='left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;' page-index='" + x + "' annot-name='" + g + "'><div id='" + ma + "' style='display:none'></div></div>";
                                var hb = p.getTextboxAnnotDivID(a, g),
                                    ib = d.getOpacity(),
                                    jb = o.getPixelsPerPoint(),
                                    kb = a.getScale(),
                                    Pa = kb * h,
                                    Ha = d.getFontSize() * jb * Pa,
                                    lb = d.getLineHeight();
                                (isNaN(lb) || 0 == lb) && (lb = d.getFontHeight(), d.setLineHeight(lb)), lb *= jb * Pa;
                                var mb = "line-height:" + lb + "px;font-size:" + Ha + "px;color:" + d.getFontColor() + ";opacity:" + ib + ";text-align:" + fb + ";font-family:" + d.getFontName() + ";" + qa + "width:" + (cb + .05) + "px;height:" + (db + .05) + "px;",
                                    nb = "";
                                ib >= 0 && 1 > ib && (nb += "alpha(opacity=" + 100 * ib + ") "), nb += gb, "" != nb && (mb += "filter:" + nb + ";");
                                var Ab = d.getDA();
                                if (Ab && /\s?\d*Tc/.test(Ab)) {
                                    var Bb = Ab.match(/\w* ?([0-9\.]+) Tc/)[1];
                                    if (Bb = 4 * parseFloat(Bb) / 300, /\w* ?([0-9\.]+) Tz/.test(Ab)) {
                                        var Cb = Ab.match(/\w* ?([0-9\.]+) Tz/)[1];
                                        Bb *= parseFloat(Cb)
                                    }
                                    mb += "letter-spacing:" + Bb + "px;"
                                }
                                var Db = d.getFillColor();
                                "#000000" == Db && (Db = "rgba:(0,0,0,0)"), mb += "background-color:" + Db + ";";
                                var Eb = d.getBorderStyle();
                                switch (Eb) {
                                    case 0:
                                        Eb = "solid";
                                        break;
                                    case 1:
                                        Eb = "dashed";
                                        break;
                                    default:
                                        Eb = "solid"
                                }
                                var Fb = d.getColor() || "#FF0000",
                                    Gb = 4 * d.getBorderWidth() / 3,
                                    Hb = navigator.userAgent.toLowerCase(); - 1 != Hb.indexOf("safari") && (Gb = Math.ceil(Gb)), mb += "border:" + Gb + "px " + Eb + " " + Fb + ";", mb += "padding:" + Gb + "px;box-sizing:border-box;";
                                var Ib = 'data-minheight = "' + G + '"',
                                    ob = "<textarea " + Ib + " id='" + p.getTextboxAnnotRectDivID(a, g) + "'class='fwr-textbox-annot-nor'style='" + mb + "-webkit-user-select:auto;word-break: break-all;'>" + d.getContents() + "</textarea>",
                                    pb = "position: absolute;left:" + E.left + "px;top:" + E.top + "px;width:" + F + "px;height:" + G + "px;";
                                I += "<div class='fwr-annot-data' id='" + hb + "'style='" + pb + "-webkit-user-select:auto;'>" + ob + "</div>"
                            }
                        }
                }
                return I
            }, this.createAnnotsHtmlContent = function(a, b, c, d) {
                if (!a) return "";
                var e = a.getPDFPage(),
                    f = "<div id='" + p.getPageAnnotsContainerID(a) + "' >";
                return e.enumAnnots(function(e) {
                    var g = p.createAAnnotHtmlContent(a, e, e.getAnnotName(), b, !1, c, null, d);
                    f += g
                }), f += "</div>"
            }, this.array2Rect = function(a) {
                var b = new f;
                return b.left = a[0], b.top = a[1], b.right = a[2], b.bottom = a[3], b
            }, this.rotateRect = function(a, b) {
                var c = new WebPDF.PDFMatrix;
                switch (a) {
                    case -270:
                    case 90:
                        c.Translate(-b.left, -b.bottom, !1), c.Rotate(Math.PI / 180 * a, !1), c.Translate(b.left, b.bottom, !1);
                        break;
                    case -180:
                    case 180:
                        c.Translate(-b.right, -b.bottom, !1), c.Rotate(Math.PI / 180 * a, !1), c.Translate(b.right, b.bottom, !1);
                        break;
                    case -90:
                    case 270:
                        c.Translate(-b.right, -b.top, !1), c.Rotate(Math.PI / 180 * a, !1), c.Translate(b.right, b.top, !1)
                }
                var d = c.TransFormRect(b.left, b.top, b.right, b.bottom),
                    e = p.array2Rect(d);
                return e
            }, this.rotateRectEx = function(a, b, c) {
                var d = new WebPDF.PDFRect,
                    e = a.getPageWidth(),
                    f = a.getPageHight();
                switch (b) {
                    case 90:
                        d.left = f - c.bottom, d.top = c.left, d.right = f - c.top, d.left = c.right;
                        break;
                    case 180:
                        d.left = e - c.right, d.top = e - c.bottom, d.right = e - c.left, d.bottom = f - c.top;
                        break;
                    case 270:
                        d.left = top, d.top = e - c.right, d.right = c.bottom, d.left = e - c.left
                }
                return d
            }, this.getCanvasElement = function() {
                return document.getElementById(m)
            }, this.getAnnotCanvasID = function() {
                return m
            }, this.setCanvasRect = function(a, b, c, d) {
                if ($("#" + m).attr({
                        width: parseInt(c),
                        height: parseInt(d)
                    }), $("#" + m).css({
                        left: parseInt(a),
                        top: parseInt(b)
                    }), !$.support.canvas) {
                    var e = $("#" + m).children();
                    if (null == e) return;
                    $(e).css({
                        width: parseInt(c),
                        height: parseInt(d)
                    })
                }
            }, this.getCanvasOffset = function() {
                var a = p.getCanvasElement();
                if (null == a) return !1;
                ctx = a.getContext("2d");
                var b = $(a);
                return b.offset()
            }, this.removeCanvans = function() {
                var a = p.getCanvasElement();
                a && $(a).remove()
            }, this.resetCanvens = function(a) {
                var b, c, d = o.getMainView().getDocView(),
                    e = d.getDocViewDimension(),
                    f = d.getScrollApi();
                null != f && (e.width -= f.getScrollBarWidth(), e.height -= f.getScrollBarHeight());
                var g = 0,
                    h = 0,
                    i = p.getCanvasElement();
                if (i || (i = p.getCanvasDiv()), $(i).appendTo($("#" + a.getPageViewContainerID())), WebPDF.Environment.mobile || a.getPageViewWidth() <= e.width) {
                    var j = $("#" + a.getPageViewContainerID()).offset(),
                        k = $("#" + d.getDocViewContainerID()).offset();
                    g = k.left - j.left, b = parseInt(e.width), c = parseInt(a.getPageViewHeight())
                } else b = parseInt(a.getPageViewWidth()), c = parseInt(a.getPageViewHeight());
                d.getRotate() % 180 == 0 ? p.setCanvasRect(g, h, b, c) : p.setCanvasRect(h, g, c, b), p.clearCanvas()
            }, this.clearCanvas = function() {
                var a = d.getCanvas(m);
                if (null == a) return null;
                var b = d.getContext(a);
                return b.clearRect(0, 0, a.width, a.height), b
            }, this.rotatePopupAnot = function(a, b) {
                var c = $("#" + p.getPageAnnotsContainerID(a) + " .fwr-popup-annot");
                b = (b + 360) % 360;
                for (var d = (360 - b) % 360, e = 0; e < c.length; e++) {
                    var f = c[e],
                        g = c.width(),
                        h = c.height(),
                        i = (g - h) / 2;
                    270 == d || 90 == d ? WebPDF.Common.addTranslateCss($(f), d, i, -i) : WebPDF.Common.addTranslateCss($(f), d)
                }
            }, this.rotatePopupAnnot = function(a, b) {
                var c = a.getDocView().getRotate();
                c = (c + 360) % 360;
                var d = (360 - c) % 360,
                    e = $("#" + this.getAnnotPopupDivID(a, b)),
                    f = e.width(),
                    g = e.height(),
                    h = (f - g) / 2;
                270 == d || 90 == d ? WebPDF.Common.addTranslateCss($(e), d, h, -h) : WebPDF.Common.addTranslateCss($(e), d)
            }, this.createPropertyHtmlContent = function(a) {
                var b, c = a.event,
                    d = c.pageY - 100,
                    e = a.annot.annotJSONData.subty;
                if (o.isMobile()) {
                    if (b = '<div id="fwrCommentPropertyDlg" class="fwrm-property">', b += '<dl class="fwr-choose-color"><dt>' + i18n.t("AnnotProperties.Color") + "</dt><dd>", a.colorArr)
                        for (var f = 0; f < a.colorArr.length; f++) {
                            var g = "";
                            "FreeText" === e ? a.colorArr[f] === a.annot.getFontColor() && (g = " selected") : a.colorArr[f] === a.annot.getColor() && (g = " selected"), b += '<span class="span-color' + g + '"><span style="background-color: ' + a.colorArr[f] + '"></span></span>'
                        }
                    b += "</dl>", a.multiSelect || (b += '<div class="fwrm-set-default"><span><input type="checkbox" id="set_default" /></span>' + i18n.t("AnnotProperties.SetDefault") + "</div>"), b += '<div class="fwrm-triangle"></div>', b += "</div>"
                } else {
                    if (b = '<div id="fwrCommentPropertyDlg" class="fwr-modal fwr-alert fwr-property" ', b += ' style="top: ' + d + "px;left: " + c.pageX + 'px" >', b += '<div class="fwr-modal-header">', b += '<a class="close" webpdf-data-dismiss="modal"></a>', b += '<h4 id="fwrAlertDialogTitle">' + a.title + "</h4></div>", b += '<div class="fwr-modal-body">', "Highlight" === e || "Underline" === e || "Ink" === e || "FreeText" === e) {
                        if (b += '<dl class="fwr-choose-color"><dt>' + i18n.t("AnnotProperties.Color") + "</dt><dd>", a.colorArr)
                            for (var f = 0; f < a.colorArr.length; f++) {
                                var g = "";
                                "FreeText" === e ? a.colorArr[f] === a.annot.getFontColor() && (g = " selected") : a.colorArr[f] === a.annot.getColor() && (g = " selected"), b += '<span class="span-color' + g + '"><span style="background-color: ' + a.colorArr[f] + '"></span></span>'
                            }
                        b += "</dd></dl>"
                    }
                    a.multiSelect || (b += '<div><span><input type="checkbox" id="set_default"/></span>' + i18n.t("AnnotProperties.SetDefault") + "</div>"), b += '</div><div class="fwr-modal-footer"><a href="#" id="closeBtn" class="btn" webpdf-data-dismiss="modal">' + i18n.t("AnnotProperties.CloseBtn") + "</a>", b += "</div>", b += "</div>"
                }
                return b
            }, this.placeCaretAtEnd = function(a) {
                if ("undefined" != typeof window.getSelection && "undefined" != typeof document.createRange) {
                    var b = document.createRange();
                    b.selectNodeContents(a), b.collapse(!1);
                    var c = window.getSelection();
                    c.removeAllRanges(), c.addRange(b), a.focus()
                } else if ("undefined" != typeof document.body.createTextRange) {
                    var d = document.body.createTextRange();
                    d.moveToElementText(a), d.collapse(!1), d.select()
                }
            }
        }
    }), define("core/Common/CanvasUtils", [], function(a, b, c) {
        var d = {
            getCanvas: function(a) {
                var b = document.getElementById(a);
                return null != b && (uuClass.Canvas.InitCavansElement(b), b = document.getElementById(a)), b
            },
            getContext: function(a) {
                var b = a.getContext("2d");
                return this.cleanContext(a, b), b
            },
            cleanContext: function(a, b) {
                null != b._clear ? b._clear() : b.clearRect(0, 0, a.width, a.height)
            }
        };
        return d
    }), define("core/Plugins/Annot/PDFAnnotationLoader", ["core/Plugins/Annot/Annot", "core/WebPDF"], function(a, b, c) {
        var d = a("core/Plugins/Annot/Annot");
        WebPDF.currentPDFAnnotUser = new Array, WebPDF.annotUserMap = new Object;
        var e = {
            pageIndex: "number",
            annotations: "annots"
        };
        d.PDFAnnotationLoader = function() {
            function a(b, c) {
                if (c && b && b.getType() === WebPDF.Annot.AnnotType.MarkUp) {
                    var d = b.getGroupAnnotMap();
                    for (var e in d) {
                        var f = d[e];
                        c.addAnnot(f), a(f, c)
                    }
                }
            }

            function b(b, c) {
                var d = c[e.pageIndex],
                    f = b.getPage(d),
                    g = b.isUserAnnotLoaded();
                if (!f.isAnnotLoaded()) {
                    var h = c[e.annotations],
                        i = f.getAnnotJsonData();
                    null != i && i.length > 0 && (i = f.filterExistAnnots(h, i));
                    var j = h.concat(i);
                    f.setAnnotJsonData(j), g && f.setAnnotLoaded(!0);
                    for (var k = 0; k < h.length; k++) {
                        var l = WebPDF.Annot.AnnotFactory.createAnnot(h[k], d);
                        if (l)
                            if ("signature" == l.getType()) f.addSignature(l);
                            else {
                                var m = ["Link", "Highlight", WebPDF.Annot.AnnotType.Text, WebPDF.Annot.AnnotType.Ink, "Underline", "StrikeOut", "Squiggly", "Caret", "FreeText", WebPDF.Annot.AnnotType.Stamp, WebPDF.Annot.AnnotType.Circle, WebPDF.Annot.AnnotType.Polygon, WebPDF.Annot.AnnotType.PolyLine, WebPDF.Annot.AnnotType.Square, WebPDF.Annot.AnnotType.Line],
                                    n = l.getSubType();
                                for (var o in m)
                                    if (m[o] === n) {
                                        f.addAnnot(l), a(l, f);
                                        break
                                    }
                            }
                    }
                }
            }

            function c(b, c) {
                for (var d = 0; d < c.length; d++) {
                    var f = c[d],
                        g = f[e.pageIndex],
                        h = b.getPage(g),
                        i = f[e.annotations],
                        j = h.getAnnotJsonData();
                    if (null != j && j.length > 0) {
                        var k = h.filterExistAnnots(i, j);
                        i = i.concat(k)
                    }
                    h.setAnnotJsonData(i), h.setAnnotLoaded(!0);
                    var l = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                        m = l.getPageAnnotUnLoad();
                    WebPDF.Common.arrayRemove(m, g);
                    for (var n = 0; n < i.length; n++) {
                        var o = WebPDF.Annot.AnnotFactory.createAnnot(i[n], g);
                        if (o)
                            if ("signature" == o.getType()) h.addSignature(o);
                            else {
                                var p = ["Link", "Highlight", WebPDF.Annot.AnnotType.Text, WebPDF.Annot.AnnotType.Ink, "Underline", "StrikeOut", "Squiggly", "Caret", "FreeText", WebPDF.Annot.AnnotType.Stamp, WebPDF.Annot.AnnotType.Image, WebPDF.Annot.AnnotType.Circle, WebPDF.Annot.AnnotType.Polygon, WebPDF.Annot.AnnotType.PolyLine, WebPDF.Annot.AnnotType.Square, WebPDF.Annot.AnnotType.Line],
                                    q = o.getSubType();
                                for (var r in p)
                                    if (p[r] === q) {
                                        h.addAnnot(o), a(o, h);
                                        break
                                    }
                            }
                    }
                }
                b.setUserAnnotLoaded(!0)
            }

            function d(a, c, e, g, i, j) {
                function k(k) {
                    if (null == k.response) return console.warn("Get annot data error: response is null"), void j(k.response);
                    var l = k.error;
                    if (0 != l) {
                        if (WebPDF.Common.isNeedRetry(k.status)) {
                            var m = WebPDF.AjaxRetryManager.getNextAnnotDataRequestInterval(c.getMainView().getDocView().getPageCount());
                            return f--, void setTimeout(function() {
                                d(a, c, e, g, i, j)
                            }, m)
                        }
                        return console.error("Get annot data error:" + l), void j(k.response)
                    }
                    var n = $.parseJSON(k.data);
                    null != n && b(e, n), i(k.pageIndex), h[k.pageIndex] = 1, $(c).trigger(WebPDF.EventList.ANNOTS_LOADED_SUCCESS, {
                        pageIndex: k.pageIndex
                    })
                }

                function l() {
                    j(null)
                }
                if ($.isFunction(i) && $.isFunction(j) || $.error("both 'doneHandler' and 'failedHandler' must be function."), 0 >= f) return console.error("Maximum number of retries exceeded for getAnnotData request."), void j(null);
                var m = c.getOptions().url + "annots/" + g;
                c.isFormMode() && (m += "?formMode=true");
                var n = {
                        pageIndex: g
                    },
                    o = {
                        url: m,
                        isAsync: a,
                        password: c.getPDFPassword(),
                        requestData: n,
                        docPermission: c.getDocPermission()
                    },
                    p = {
                        type: "getAnnots",
                        data: o,
                        success: k,
                        error: l
                    },
                    q = c.getDataControl();
                q.getAnnots(p)
            }
            var f = WebPDF.Config.defaults.requestRetryCount,
                g = this;
            this.asyncLoadUserAnnotation = function(a, b, d, e) {/*
                if ($.isFunction(d) && $.isFunction(e) || $.error("both 'doneHandler' and 'failedHandler' must be function."), 0 >= f) return console.error("Maximum number of retries exceeded for getAnnotData request."), void e(null);
                var h = a.getOptions().url;
                if (!h.match(/\/null\//)) {
                    var i = h + "userannots?" + Math.random();
                    a.isFormMode() && (i += "&formMode=true"), $.ajax({
                        url: i,
                        dataType: "json",
                        headers: {
                            "x-auth-doc": a.getPDFPassword()
                        },
                        success: function(h) {
                            if (null == h) return console.warn("Get annot data error: response is null"), void e(h);
                            var i = h.error;
                            if (0 != i) {
                                if (!WebPDF.Common.isNeedRetry(h.status)) return void e(h);
                                var j = WebPDF.AjaxRetryManager.getNextAnnotDataRequestInterval(a.getMainView().getDocView().getPageCount());
                                f--, setTimeout(function() {
                                    g.asyncLoadUserAnnotation(a, b, d, e)
                                }, j)
                            }
                            try {
                                var k = h.data;
                                if ("undefined" == typeof k || null == k) return b.setUserAnnotLoaded(!0), void d();
                                var l = $.parseJSON(k);
                                null != l ? c(b, l) : b.setUserAnnotLoaded(!0), d()
                            } catch (m) {
                                return console.error(m), e(h), !1
                            }
                        },
                        error: function() {
                            e(null)
                        }
                    })
                }*/
            }, this.asyncLoadCommentAnnotation = function(a, c, d, e, f, g) {
                function h(c) {
                    if (null == c.response) return console.warn("Get annot data error: response is null"), void g(c.response);
                    var d = c.error;
                    if (0 !== d && !WebPDF.Common.isNeedRetry(c.status)) return console.error("Get annot data error:" + d), void g(c.response);
                    try {
                        var e = $.parseJSON(c.data),
                            h = [];
                        if (e)
                            for (var i = e.annotsArr, j = a.getMainView().getDocView(), k = j.getPageAnnotUnLoad(), l = 0; l < i.length; l++) {
                                var m = a.getPDFDoc();
                                b(m, i[l]);
                                var n = i[l].number,
                                    o = j.getPageView(n);
                                o.setCommentListLoaded(!0), WebPDF.Common.arrayRemove(k, n), h.push(n)
                            }
                        f(h)
                    } catch (p) {
                        return console.error(p), g(c.response), !1
                    }
                }

                function i() {
                    g(null)
                }
                $.isFunction(f) && $.isFunction(g) || $.error('both "doneHandler" and "failedHandler" must be function.');
                var j = a.getOptions().url + "commentListAnnots?" + Math.random();
                a.isFormMode() && (j += "?formMode=true");
                var k = d.join(","),
                    l = a.getDataControl(),
                    m = {
                        password: a.getPDFPassword(),
                        unLoadPageStr: k,
                        count: e
                    },
                    n = {
                        url: j,
                        requestData: m
                    },
                    o = {
                        type: "getCommentList",
                        data: n,
                        success: h,
                        error: i
                    };
                l.getCommentList(o)
            };
            var h = {};
            this.asyncLoadPDFAnnotation = function(a, b, c, e, g) {
                return c in h ? void e(c) : (f = WebPDF.Config.defaults.requestRetryCount, void d(!0, a, b, c, e, g))
            }, this.syncLoadPDFAnnotation = function(a, b, c, e, g) {
                return c in h ? void e(c) : (f = WebPDF.Config.defaults.requestRetryCount, void d(!1, a, b, c, e, g))
            }
        }
    }), define("core/Plugins/Annot/MarkupAnnotHandler", ["core/Plugins/Annot/PopupMousePtHandler"], function(a, b, c) {
        a("core/Plugins/Annot/PopupMousePtHandler");
        var d = WebPDF.PDFRect,
            e = WebPDF.RectUtils,
            f = .95,
            g = .05,
            h = 3.141592653,
            i = 28;
        return WebPDF.MarkupAnnotHandler = function(a, b) {
            function c() {
                $(v).on(WebPDF.EventList.DOCVIEW_SCROLL, function() {
                    var a = this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                        b = null,
                        c = null,
                        d = null;
                    a && (b = a.getAnnotHandlerMgr()), b && (c = b.getUIManager(), d = b.getMarkupAnnotHandler()), c && c.clearCanvas(), d && d.updatePoupAnnots()
                }), $(v).on(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, function() {
                    var a = this.getDocView(),
                        b = a.getPageView(a.getCurPageIndex());
                    if (null != b && b.isLoadAnnot()) {
                        var c = this.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                            d = null,
                            e = null,
                            f = null;
                        c && (d = c.getAnnotHandlerMgr()), d && (e = d.getUIManager(), f = d.getMarkupAnnotHandler()), e && e.rotatePopupAnot(b, a.getRotate), f && f.updatePoupAnnots()
                    }
                })
            }

            function j() {
                if (!v.isMobile())
                    for (var a, b, c = v.getMainView().getDocView(), d = c.getVisiblePageRange(), e = $("#" + c.getDocViewContainerID()), f = c.getDocViewDimension(), g = f.height, h = f.width, i = e.offset(), j = d.begin; j <= d.end; j++) b = c.getPageView(j), a = w.getAnnotVisibleRect(b, i, h, g), b.getPDFPage().enumAnnots(function(c) {
                        c.getType() === WebPDF.Annot.AnnotType.MarkUp && s(b, a, c)
                    })
            }

            function k(a, b) {
                if (null != z.annotName && -1 != z.page) {
                    var c = a.getDocView().getPageView(z.pageIndex),
                        d = $("#" + x.getAnnotPopupDivID(c, z.annotName));
                    null != d && d.removeClass("fwr-popup-annot-focus fwr-popup-annot-to-frontend")
                }
                z.annotName = b, z.page = a.getPageIndex(), z.pageIndex = a.getPageIndex();
                var e = x.getAnnotPopupDivID(a, b),
                    f = $("#" + e);
                f.addClass("fwr-popup-annot-to-frontend")
            }

            function l(a, b) {
                A.pageIndex = a, A.annotName = b
            }

            function m(a, b, c) {
                var d = v.getMainView().getDocView(),
                    e = $("#" + d.getDocViewContainerID()),
                    f = d.getDocViewDimension(),
                    g = f.height,
                    h = f.width,
                    i = e.offset(),
                    j = a.getPDFPage().getAnnotByName(b),
                    k = w.getAnnotVisibleRect(a, i, h, g);
                s(a, k, j);
                var l = a.getPageIndex(),
                    m = x.getAnnotPopupDivID(a, b),
                    n = $("#" + m);
                if (b != z.annotName || z.pageIndex != l) {
                    if (null != z.annotName && -1 != z.pageIndex) {
                        var o = a.getDocView().getPageView(z.pageIndex),
                            p = $("#" + x.getAnnotPopupDivID(o, z.annotName));
                        null != p && (p.removeClass("fwr-popup-annot-to-frontend"), p.removeClass("fwr-popup-annot-focus"))
                    }
                    0 != c && (c = !0)
                }
                if (v.isEditable() && (z.isFocus || 0 == c || (c = !0), c)) {
                    var q = $("#" + m + " .fwr_popup_content:first-child");
                    q.length > 0
                }
                if (n.addClass("fwr-popup-annot-focus"), !v.isMobile()) {
                    var r = x.getAnnotDivID(a, b),
                        t = $("#" + r);
                    t.removeClass("fwr-annot-selected"), w.clearSelection()
                }
                z.annotName = b, z.pageIndex = l, z.isFocus = !0
            }

            function n(a, b, c, e) {
                var f = new d(0, 0, 0, 0);
                return f = 90 == b ? new d(a.left, a.top - c, e + a.left, a.top) : 180 == b ? new d(a.left - c, a.top - e, a.left, a.top) : 270 == b ? new d(a.left - e, a.top, a.left, c + a.top) : new d(a.left, a.top, c + a.left, e + a.top)
            }

            function o(a, b, c, d) {
                return b % 180 != 0 ? e.offset(a, d, c) : e.offset(a, c, d), a
            }

            function p(a, b) {
                var c = v.getMainView().getDocView(),
                    d = c.getPageView(b);
                if (!d) return !1;
                var e = d.getPDFPage(),
                    f = e.getAnnotByName(a);
                if (!f) return !1;
                if (f.getType() != WebPDF.Annot.AnnotType.MarkUp) return !1;
                var g = f.getPopup();
                return null == g ? !1 : 0 == g.getOpenState() ? !1 : !0
            }

            function q(a, b, c, f) {
                var g = v.getMainView().getDocView(),
                    j = g.getPageView(f);
                if (!j) return !1;
                var k = j.getPDFPage(),
                    l = k.getAnnotByName(c);
                if (!l) return !1;
                if (l.getType() != WebPDF.Annot.AnnotType.MarkUp) return !1;
                var m = l.getPopup();
                if (null == m) return !1;
                if (0 == m.getOpenState()) return !1;
                var p = $("#" + j.getPageViewContainerID()).offset();
                if (null == p) return !1;
                p.left -= b.left, p.top -= b.top;
                var q = x.getAnnotDivID(j, c),
                    s = $("#" + q),
                    t = x.getAnnotPopupDivID(j, c),
                    u = $("#" + t),
                    w = s.position(),
                    y = u.position();
                if (null == w || null == y) return !1;
                var z = g.getRotate(),
                    A = j.devicePtToPageRotate(new WebPDF.PDFPoint(w.left, w.top), z);
                w.left = A.x, w.top = A.y, A = j.devicePtToPageRotate(new WebPDF.PDFPoint(y.left, y.top), z), y.left = A.x, y.top = A.y;
                var B = n(w, z, s.width(), s.height()),
                    C = n(y, z, u.width(), u.height());
                o(B, z, p.left, p.top), o(C, z, p.left, p.top);
                var D = new d(C.left, C.top, C.right, C.top + 20);
                D.bottom > C.bottom && (D.bottom = C.bottom);
                var E = new d(0, 0, 0, 0);
                e.copy(C, E), e.normalize(E);
                var F = new WebPDF.PDFPoint((B.left + B.right) / 2, (B.top + B.bottom) / 2);
                if (e.ptInRect(E, F)) return !1;
                var G = 2 * h,
                    H = 2 * h,
                    I = new d(0, 0, 0, 0),
                    J = new d(0, 0, 0, 0),
                    K = new d(0, 0, 0, 0),
                    L = new WebPDF.PDFPoint(0, 0),
                    M = new WebPDF.PDFPoint(0, 0);
                if (F.x < C.left ? (I.left = F.x, I.right = C.left, I.top = Math.min(F.y, C.top), I.bottom = Math.max(F.y, C.bottom), G = Math.atan2((D.top + D.bottom) / 2 - F.y, e.width(I))) : F.x > C.right && (I.left = C.right, I.right = F.x, I.top = Math.min(F.y, C.top), I.bottom = Math.max(F.y, C.bottom), G = Math.atan2((D.top + D.bottom) / 2 - F.y, e.width(I))), F.y < C.top ? (J.left = Math.min(F.x, C.left), J.right = Math.max(F.x, C.right), J.top = F.y, J.bottom = C.top, H = Math.atan2((C.left + C.right) / 2 - F.x, e.height(J))) : F.y > C.bottom && (J.left = Math.min(F.x, C.left), J.right = Math.max(F.x, C.right), J.top = C.bottom, J.bottom = F.y, H = Math.atan2((C.left + C.right) / 2 - F.x, e.height(J))), Math.abs(G) < Math.abs(H)) {
                    e.copy(I, K), F.x < C.left ? (L.x = C.left, M.x = C.left) : (L.x = C.right, M.x = C.right);
                    var N = (D.top + D.bottom) / 2,
                        O = i / (2 * Math.cos(G)) + .5;
                    L.y = N - O, M.y = N + O, L.y = Math.max(L.y, C.top), L.y = Math.min(L.y, C.bottom), M.y = Math.max(M.y, C.top), M.y = Math.min(M.y, C.bottom)
                } else {
                    e.copy(J, K), F.y < C.top ? (L.y = C.top, M.y = C.top) : (L.y = C.bottom, M.y = C.bottom);
                    var P = (C.left + C.right) / 2,
                        Q = i / (2 * Math.cos(H)) + .5;
                    L.x = P - Q, M.x = P + Q, L.x = Math.max(L.x, C.left), L.x = Math.min(L.x, C.right), M.x = Math.max(M.x, C.left), M.x = Math.min(M.x, C.right)
                }
                var R = l.getColor();
                return r(a, F.x, F.y, L.x, L.y, M.x, M.y, "rgba(125,125,125,0.35)", "rgba(125,125,125,0.35)", 2), r(a, F.x, F.y, L.x, L.y, M.x, M.y, WebPDF.Common.hexColor2Rgba(R, .7), WebPDF.Common.hexColor2Rgba(R, 1), 1), !0
            }

            function r(a, b, c, d, e, h, i, j, k, l) {
                if (null != a) {
                    a.save();
                    var m = (b + d + h) / 3,
                        n = (c + e + i) / 3;
                    a.beginPath(), a.moveTo(b, c);
                    var o = b + (m - b) * g,
                        p = c + (n - c) * g,
                        q = d + (m - d) * f,
                        r = e + (n - e) * f;
                    a.bezierCurveTo(o, p, q, r, d, e), a.lineTo(h, i);
                    var s = h + (m - h) * f,
                        t = i + (n - i) * f,
                        u = b + (m - b) * g,
                        v = c + (n - c) * g;
                    a.bezierCurveTo(s, t, u, v, b, c), a.closePath(), a.fillStyle = j, a.fill(), a.strokeStyle = k, a.lineWidth = l, a.stroke(), a.restore()
                }
            }

            function s(a, b, c) {
                if (!v.isMobile()) {
                    var d = c.getPopup();
                    if (null != d) {
                        var e = a.getDocView().getRotate(),
                            f = WebPDF.Common.clone(b);
                        WebPDF.RectUtils.deflateEx(f, 1), f = a.deviceRectToPageRotate(f, e);
                        var g = x.getAnnotPopupDivID(a, c.getAnnotName()),
                            h = $("#" + g),
                            i = d.getRect(),
                            j = a.pdfRectToDevice(i, !1),
                            k = h.outerWidth(),
                            l = h.outerHeight(),
                            m = a.getPageViewHeight();
                        if (e % 180 != 0) {
                            k = h.outerHeight(), l = h.outerWidth();
                            var n = l - k;
                            f.right += n, j.left < f.left ? (j.left = f.left, j.right = j.left + l, j.right = Math.min(m + n, j.left + l), j.left = Math.max(0, j.right - l)) : j.right > f.right && (j.right = f.right, j.left = Math.max(0, j.right - l), j.right = Math.min(m, j.left + l)), j.top < f.top && (j.top = f.top, j.bottom = j.top + k), j.bottom + n > f.bottom && (j.bottom = f.bottom - n, j.bottom - k > f.top && (j.top = j.bottom - k), j.top >= j.bottom && (j.top = j.bottom - k), j.top < f.top && (j.top = f.top))
                        } else {
                            var m = a.getPageViewHeight();
                            j.top < f.top ? (j.top = f.top, j.bottom = j.top + l, j.bottom = Math.min(m, j.top + l), j.top = Math.max(0, j.bottom - l)) : j.bottom > f.bottom && (j.bottom = f.bottom, j.top = Math.max(0, j.bottom - l), j.bottom = Math.min(m, j.top + l)), j.left < f.left && (j.left = f.left, j.right = j.left + k), j.right > f.right && (j.right = f.right, j.right - k > f.left && (j.left = j.right - k), j.left >= j.right && (j.left = j.right - k), j.left < f.left && (j.left = f.left))
                        }
                        $("#" + g).css({
                            left: Math.round(j.left),
                            top: Math.round(j.top)
                        })
                    }
                }
            }

            function t(a, b) {
                var c = a.getPDFPage(),
                    d = c.getAnnotByName(b);
                if (null != d) {
                    var e = d.getPopup();
                    if (null != e) {
                        var f = x.getAnnotPopupDivID(a, b),
                            g = $("#" + f);
                        null != g && (g.hide(), e.setOpenState(0))
                    }
                }
            }

            function u(a, b) {
                var c = a.getPDFPage(),
                    d = c.getAnnotByName(b);
                if (null == d) return 0;
                if (d.getType() != WebPDF.Annot.AnnotType.MarkUp) return 0;
                var e = d.getPopup();
                if (null == e) {
                    var f = d.getModifyDate(),
                        g = d.getRect(),
                        h = new WebPDF.PDFRect(0, 0, 0, 0);
                    h.top = g.top, h.right = c.getPageWidth(), h.left = h.right - WebPDF.Annot.MKA_POPUPWIDTH, h.bottom = h.top - WebPDF.Annot.MKA_POPUPHEIGHT;
                    var i = {
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: f,
                        n: f + "_popup",
                        op: 0,
                        rc: [h.left, h.top, h.right, h.bottom]
                    };
                    d.setPopupData(i);
                    var j = x.createPopupAnnotHtmlContent(d, a, 1),
                        k = x.getPageAnnotsContainerID(a);
                    v.isMobile() || $("#" + k).append(j), e = d.getPopup()
                }
                if (null == e) return 0;
                var l = x.getAnnotPopupDivID(a, b),
                    m = $("#" + l);
                if (null == m) return 0;
                if (v.isMobile() || 0 === e.getOpenState()) {
                    if (d.getSubType() != WebPDF.Annot.AnnotType.Text) m.show();
                    else {
                        var n = m.find("#fwrm-popup-head-cancel");
                        n.length > 0 && (n.attr("id", "fwrm-popup-head-delete"), n.text("Delete")), m.show()
                    }
                    if (!v.isMobile()) {
                        var o = $("#" + a.getDocView().getDocViewContainerID()),
                            p = a.getDocView().getDocViewDimension(),
                            q = p.height,
                            r = p.width,
                            t = o.offset(),
                            u = w.getAnnotVisibleRect(a, t, r, q);
                        s(a, u, d)
                    }
                    return e.setOpenState(1), 1
                }
                return m.hide(), e.setOpenState(0), 0
            }
            var v = a,
                w = b,
                x = w.getUIManager(),
                y = this,
                z = {
                    pageIndex: -1,
                    annotName: null,
                    isFocus: !1
                },
                A = {
                    pageIndex: -1,
                    annotName: null
                };
            this.updatePoupAnnots = function() {
                j()
            }, this.init = function() {
                this.popupMousePtHandler = new WebPDF.Event.PopupMousePtHandler(y, w), v.registerMousePtHandler(this.popupMousePtHandler), v.isMarkUpEventInit() || (c(), v.setMarkUpEventInit(!0));
                var a = $("#" + v.getAppId());
                a.off("mousedown", ".popup_child").on("mousedown", ".popup_child", function(a) {
                        if (2 == a.button) return $(a.target).fwrContextMenu(null, null, document.getElementById(v.getMainFrameId())), a.stopPropagation(), !1;
                        var b, c = $(this);
                        b = c.hasClass("fwr_popup_content") ? c : c.find(".fwr_popup_content");
                        var d = b.attr("annot-name"),
                            e = b.attr("page-index");
                        if (!d || !e) return !1;
                        var f = v.getMainView().getDocView().getPageView(e),
                            g = f.getPDFPage().getAnnotByName(d);
                        g.isReadOnly() || v.isReadOnly() || !v.isAnnot() ? b.attr("contenteditable", "false") : b.attr("contenteditable", "true");
                        var h = y.getDirectPopupParent(a.target);
                        y.setFocusAnnotByTarget(h);
                        var i = $(a.target);
                        return a.target.scrollWidth && a.clientX > a.target.scrollWidth + i.offset().left || a.target.scrollHeight && a.clientY > a.target.scrollHeight + i.offset().top ? (a.stopPropagation(), !1) : void 0
                    }),
                    function(a) {
                        $("body").on("mousedown touchstart", ".fwr-popup-annot", function(b) {
                            if (v.isMobile()) return !0;
                            if (2 != b.button) return !0;
                            $(document).trigger("click.fwrContextMenu");
                            var c = $(b.currentTarget).attr("annot-name"),
                                d = $(b.currentTarget).attr("page-index");
                            if (!c || !d) return !1;
                            var e = v.getMainView().getDocView().getPageView(d),
                                f = e.getPDFPage().getAnnotByName(c);
                            a.clearSelection(), a.setFocusAnnot(e, f), a.selectAnnot(e, f), $(b.target).fwrContextMenu("fwr-annots-context-menu", {
                                onSelect: function(b, c) {
                                    return a.onAnnotMenuSelect($(this), b)
                                }
                            }, document.getElementById(v.getMainFrameId()))
                        })
                    }(w), a.on("mousedown touchstart", ".fwr-annot-close-btn", function(a) {
                        try {
                            if (0 != a.button && 1 != a.button && void 0 != a.button) return console.log("return true"), !0;
                            $(".annot-content-editing").blur();
                            var b = parseInt(a.target.parentNode.parentNode.getAttribute("page-index")),
                                c = a.target.parentNode.parentNode.getAttribute("annot-name"),
                                d = v.getMainView().getDocView().getPageView(b);
                            return t(d, c), !0
                        } catch (e) {
                            return console.error(e), !1
                        }
                    }), $("body").off("tap", "#fwrm-popup-head").on("tap", "#fwrm-popup-head", function(a) {
                        var b = $("#" + w.getContextMenuId());
                        if (b.hide(), "fwrm-popup-head-delete" == a.target.id || "fwrm-popup-head-cancel" == a.target.id) w.deleteSelection();
                        else if ("fwrm-popup-head-ok" == a.target.id) {
                            $(".annot-content-editing").blur();
                            var c = parseInt(a.target.parentNode.parentNode.parentNode.getAttribute("page-index")),
                                d = a.target.parentNode.parentNode.parentNode.getAttribute("annot-name"),
                                e = v.getMainView().getDocView().getPageView(c);
                            t(e, d), w.clearSelection()
                        }
                        return a.stopPropagation(), !1
                    }), $("body").off("mousedown touchstart", "#fwrm-popup-content").on("mousedown touchstart", "#fwrm-popup-content", function(a) {
                        return 2 == a.button ? (a.stopPropagation(), !1) : v.isReadOnly() ? void $(a.target).attr("contenteditable", "false") : void $(a.target).attr("contenteditable", "true")
                    }), $("body").off("mousedown touchstart", "#fwrm-popup-content").on("mousedown touchstart", "#fwrm-popup-content", function(a) {
                        return 2 == a.button ? ("jeegoocontext" in $(a.target) && $(a.target).jeegoocontext(null), a.stopPropagation(), !1) : v.isReadOnly() ? void $(a.target).attr("contenteditable", "false") : void $(a.target).attr("contenteditable", "true")
                    }), a.off("mouseenter mouseleave", ".fwr-popup-annot").on("mouseenter mouseleave", ".fwr-popup-annot", function(a) {
                        if ("mouseover" == a.type || "mouseenter" == a.type) try {
                            var b = parseInt(a.currentTarget.getAttribute("page-index")),
                                c = a.currentTarget.getAttribute("annot-name"),
                                d = v.getMainView().getDocView().getPageView(b),
                                e = d.getPDFPage(),
                                f = e.getAnnotByName(c);
                            return y.onMouseOver(d, f, a), !1
                        } catch (g) {
                            return console.error(g), !1
                        } else if ("mouseout" == a.type || "mouseleave" == a.type) try {
                            A.pageIndex = -1, A.annotName = null;
                            var h = v.getCurToolHandler();
                            if (h && h.isProcessing()) return !1;
                            if (h && $.isFunction(h.isDrawing) && h.isDrawing()) return !1;
                            var i = w.canAnswer(f, !0);
                            return null == i ? (y.onDraw(), x.removeCanvans(), !1) : (w.onDraw(), !0)
                        } catch (g) {
                            return console.error(g), !1
                        }
                    }), $("body").off("tap", ".fwr-popup-annot").on("tap", ".fwr-popup-annot", function(a) {
                        var b = $("#" + w.getContextMenuId());
                        return b.hide(), !0
                    }), $("body").off("tap", ".fwr-replys-state").on("tap", ".fwr-replys-state", function(a) {
                        var b = $(a.target).closest(".fwr-replys-state"),
                            c = b.children()[0],
                            d = b.children()[1],
                            e = b.closest("li");
                        return "none" != $(c).css("display") ? ($(c).hide(), $(d).show(), $(e.children("ul")[0]).fadeOut()) : "none" != $(d).css("display") && ($(c).show(), $(d).hide(), $(e.children("ul")[0]).fadeIn()), !1
                    }), $("body").off("tap", ".fwr-popup-replymenu").on("tap", ".fwr-popup-replymenu", function(a) {
                        var b, c = $(a.target).closest(".fwr-popup-replymenu").attr("parent");
                        "popup" == c ? (attrStr = "annot-name", b = ".fwr-popup-annot") : "reply" == c && (attrStr = "id", b = ".reply-annot");
                        var d = $(a.target).closest(b).attr(attrStr),
                            e = $(a.target).closest(b).attr("page-index"),
                            f = $("#" + w.getContextMenuId()),
                            g = f.width();
                        $("#open_property").hide(),
                            f.attr("annot-name", d), f.attr("page-index", e), f.css({
                                left: a.clientX - g,
                                top: a.clientY,
                                display: "block",
                                zIndex: 1e6
                            });
                        var h = $("#delete_annot,#reply_annot");
                        return h.off("tap").tap(function(a) {
                            return w.onAnnotMenuSelect($(this), a), !1
                        }), !1
                    }), $("body").off("focus tap", ".fwr_popup_content").on("focus tap", ".fwr_popup_content", function(a) {
                        var b = $(a.target).closest(".fwr-popup-annot"),
                            c = $(b).attr("page-index"),
                            d = $(a.target).attr("annot-name"),
                            e = v.getMainView().getDocView().getPageView(c),
                            f = e.getPDFPage(),
                            g = (f.getAnnotByName(d), $(this));
                        if (v.isReadOnly()) return void g.attr("contenteditable", "false");
                        g.attr("contenteditable", "true"), g.addClass("annot-content-editing"), "undefined" != typeof g.get(0).innerText ? g.data("before", g.get(0).innerText) : g.data("before", g.get(0).textContent);
                        var h = y.getDirectPopupParent(g.get(0));
                        return h ? (y.setFocusAnnotByTarget(h), $(v).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                            annotName: $(a.target).attr("annot-name"),
                            pageIndex: $(b).attr("page-index")
                        }), !0) : !1
                    });
                var b = !1;
                $("body").off("compositionstart", ".fwr_popup_content").on("compositionstart", ".fwr_popup_content", function(a) {
                    b = !0
                }), $("body").off("compositionend", ".fwr_popup_content").on("compositionend", ".fwr_popup_content", function(a) {
                    b = !1
                }), $("body").off("blur keyup paste ", ".fwr_popup_content").on("blur keyup paste", ".fwr_popup_content", function(a) {
                    if (!b && (89 != a.keyCode && 90 != a.keyCode || !a.ctrlKey) && 17 != a.keyCode) {
                        var c = $(this),
                            d = c.closest(".fwr-popup-annot"),
                            e = parseInt(d.attr("page-index")),
                            f = d.attr("annot-name"),
                            g = v.getMainView().getDocView(),
                            h = g.getPageView(e),
                            i = h.getPDFPage(),
                            j = i.getAnnotByName(f);
                        if (null != j) {
                            var k = c.attr("annot-name"),
                                l = j.getReplyAnnotByName(k);
                            if (WebPDF.Environment.ie8OrLower && $(this).parents(".fwr-popup-annot").removeClass("fwr-popup-annot-focus"), v.isReadOnly()) return !1;
                            c.attr("contenteditable", "true");
                            var m = null;
                            "undefined" != typeof c.get(0).innerText ? WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 || WebPDF.Environment.edge ? (m = c.get(0).innerHTML, m = m.replace(/<\/p>$ /, ""), m = m.replace(/(<p><br><\/p>)|(<div><br><\/div>)/g, "\n"), m = m.replace(/(<p>)|(<div>)/g, ""), m = WebPDF.Common.htmlDecode(m), m = m.replace(/<br>/g, "\n"), m = m.replace(/(<\/p>)|(<\/div>)/g, "\n"), m = m.replace(/<[^<>]*>/g, "")) : (m = "none" !== c.parents(".fwr-popup-annot").css("display") ? c.get(0).innerText : j.getContents(), "" === m && (m = c.get(0).innerText)) : m = c.get(0).textContent;
                            var n = c.data("before");
                            ("undefined" == typeof n || null == n) && (n = m, c.data("before", m));
                            var o = c.attr("annot-reply"),
                                p = "true" == o;
                            v.isMobile() && (p = l);
                            var q = new Date,
                                r = q.valueOf(),
                                s = Math.floor(r / 1e3).toString();
                            if (n != m) {
                                c.data("before", m);
                                var t = {
                                        name: p ? k : f,
                                        newContents: m,
                                        oldContents: n
                                    },
                                    u = new WebPDF.Annot.Undo(e, WebPDF.Annot.UndoType.ANNOT_CONTENT, t);
                                v.addAnnotUndo(u, !0), v.setAnnotContentEdit(!0), v.setModified(h, g, !0)
                            }
                            if ("blur" == a.type || "focusout" == a.type) {
                                if (document.getElementById(g.getDocViewContainerID()).focus(), c.removeClass("annot-content-editing"), c.attr("contenteditable", "false"), v.isMobile() || $(this).parents(".fwr-popup-annot").removeClass("fwr-popup-annot-focus"), !w) {
                                    var x = v.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                                    w = x.getAnnotHandlerMgr()
                                }
                                v.clearAnnotUndo(!0);
                                var t = {
                                    name: p ? k : f,
                                    newContents: m,
                                    oldContents: p ? l.getContents() : j.getContents()
                                };
                                if (t.newContents !== t.oldContents) {
                                    var u = new WebPDF.Annot.Undo(e, WebPDF.Annot.UndoType.ANNOT_CONTENT, t);
                                    v.addAnnotUndo(u)
                                }
                                return v.setAnnotContentEdit(!1), p ? (j = l, j.setContents(m), j.setModifyDate(s)) : (j.setContents(m), j.setModifyDate(s)), $(this).parents(".fwr-popup-annot").find(".popup-time").text(WebPDF.Common.timestampToDateString(j.getModifyDate(), WebPDF.Common.AnnotTimeFormat)), $(v).trigger(WebPDF.EventList.ANNOT_UPDATED, {
                                    annot: w.packageAnnot(j),
                                    pageIndex: h.getPageIndex(),
                                    annotObject: j
                                }), !0
                            }
                            return 32 === a.keyCode && a.preventDefault && a.preventDefault(), !0
                        }
                    }
                })
            }, this.getDirectPopupParent = function(a) {
                for (var b = a, c = new RegExp("(^|\\s)fwr-popup-annot(\\s|$)"); null != b && !c.test(b.className);)
                    if (b = b.parentNode, /^body|html$/i.test(b.nodeName)) return null;
                return b
            }, this.clear = function() {
                v.isMobile() && $(".fwrm-popups").remove(), w = null
            }, this.setFocusAnnotByTarget = function(b, c) {
                var d = parseInt(b.getAttribute("page-index")),
                    e = b.getAttribute("annot-name");
                ("undefined" == typeof c || null == c || 1 == c) && (c = !0), m(a.getMainView().getDocView().getPageView(d), e, c)
            }, this.moveCurrentPopupAnnot = function(a, b) {
                y.movePopupAnnot(z.pageIndex, z.annotName, a, b)
            }, this.movePopupAnnot = function(a, b, c, d) {
                var f = v.getMainView().getDocView(),
                    g = f.getPageView(a);
                if (!g) return !1;
                var h = g.getPDFPage(),
                    i = h.getAnnotByName(b);
                if (!i) return !1;
                if (i.getType() != WebPDF.Annot.AnnotType.MarkUp) return !1;
                var j = i.getPopup();
                if (null == j) return !1;
                var k = j.getRect(),
                    l = v.getPixelsPerPoint(),
                    m = f.getRotate(),
                    n = c / g.getScale() / l,
                    o = d / g.getScale() / l;
                if (90 == m) {
                    var p = n;
                    n = o, o = p
                } else if (180 == m) n = -n;
                else if (270 == m) {
                    var p = o;
                    o = -n, n = -p
                } else o = -o;
                e.offset(k, n, o), j.setRect(k);
                var q = $("#" + f.getDocViewContainerID()),
                    r = f.getDocViewDimension(),
                    t = r.height,
                    u = r.width,
                    x = q.offset(),
                    y = w.getAnnotVisibleRect(g, x, u, t);
                if (s(g, y, i), v.isAnnot()) {
                    var f = v.getDocView();
                    v.setModified(g, f, !0)
                }
            }, this.onDraw = function() {
                var a = x.clearCanvas();
                if (-1 != A.pageIndex && null != A.annotName) {
                    var b = v.getMainView().getDocView(),
                        c = b.getPageView(A.pageIndex);
                    if (!c || !p(A.annotName, A.pageIndex)) return !1;
                    x.resetCanvens(c);
                    var a = w.getCavansElement().getContext("2d");
                    v.isMobile() || q(a, x.getCanvasOffset(), A.annotName, A.pageIndex)
                }
            }, this.onFocus = function(a, b) {
                var c = b.getPopup();
                c && 1 === c.getOpenState() && k(a, b.getAnnotName(), x)
            }, this.onLButtonDblClk = function(a, b) {
                v.isMobile() || l(-1, null);
                var c = b.getHeadAncestorAnnot(),
                    d = c ? c : b,
                    e = d.getAnnotName();
                if (d.getInreplyto && d.getInreplyto() && (e = d.getInreplyto()), 1 == u(a, e) && (v.isMobile() || l(a.getPageIndex(), e), m(a, e, !0), v.isMobile())) {
                    var f = x.getAnnotPopupDivID(a, e),
                        g = $("#" + f),
                        h = g.find("#fwrm-popup-container");
                    if (null != h || h.length > 0) {
                        var i = new Hammer(h.get(0));
                        i.off("doubletap").on("doubletap", function(a) {
                            return a.preventDefault(), a.srcEvent.stopPropagation(), !1
                        })
                    }
                }
                if (v.isAnnot()) {
                    var j = v.getDocView();
                    v.setModified(a, j, !0)
                }
                w.onDraw()
            }, this.onMouseOver = function(a, b, c) {
                var d = b.getAnnotName(),
                    e = a.getPageIndex();
                A.pageIndex = e, A.annotName = d;
                var f = w.canAnswer(b);
                if (null == f) return !1;
                var g = b.getHeadAncestorAnnot();
                return null != g ? (A.pageIndex = e, A.annotName = g.getAnnotName()) : (A.pageIndex = e, A.annotName = d), w.onDraw(), !0
            }, this.onMouseLeave = function(a, b, c) {
                A.pageIndex = -1, A.annotName = null;
                var d = w.canAnswer(b);
                return null == d ? !1 : (w.onDraw(), x.removeCanvans(), !0)
            }, this.onUpdatePosition = function(a, b, c) {}
        }, WebPDF.MarkupAnnotHandler
    }), define("core/Plugins/Annot/PopupMousePtHandler", [], function(a, b, c) {
        var d = function(a, b) {
            this._markupAnnotHandler = a, this._annotHandlerManager = b, this._bMoveDown = !1, this._oldPosY = 0, this._oldPosX = 0, this.selectedAnnot = {}
        };
        return d.prototype = {
            getType: function() {
                return "Popup Annot Mouse Pt Handler"
            },
            onLButtonDown: function(a) {
                var b = this._markupAnnotHandler.getDirectPopupParent(a.target);
                return b ? (WebPDF.Common.preventDefaults(a), this._markupAnnotHandler.setFocusAnnotByTarget(b), this._bMoveDown = !0, this._oldPosY = a.pageY, this._oldPosX = a.pageX, !0) : !1
            },
            onLButtonUp: function(a) {
                return this._bMoveDown = !1, this._annotHandlerManager.onDraw(), !1
            },
            onLButtonDblClk: function(a) {
                return !1
            },
            onMouseMove: function(a) {
                return this._bMoveDown ? (this._annotHandlerManager.clearCanvas(), this._markupAnnotHandler.moveCurrentPopupAnnot(a.pageX - this._oldPosX, a.pageY - this._oldPosY), this._oldPosY = a.pageY, this._oldPosX = a.pageX, !0) : !1
            },
            onRButtonDown: function(a) {
                return !1
            },
            onRButtonUp: function(a) {
                var b = $("#" + this._annotHandlerManager.getContextMenuId());
                if (b.removeAttr("annot-name"), b.removeAttr("page-index"), !$(a.target).hasClass("fwr-annot-reply")) return !1;
                if (null == $(a.target).attr("annot-name")) return !0;
                var c = $(a.target).closest(".fwr-popup-annot");
                annotName = $(a.target).attr("annot-name"), pageIndex = c.attr("page-index"), $("#open_property").hide(), b.attr("annot-name", annotName), b.attr("page-index", pageIndex);
                var d = WebPDF.Common.getReaderApp().getMainView().getDocView().getPageView(pageIndex),
                    e = d.getPDFPage().getAnnotByName(annotName);
                e.isReadOnly() ? $("#fwr-annots-context-menu #delete_annot").hide() : $("#fwr-annots-context-menu #delete_annot").show();
                var f = this._annotHandlerManager;
                return $(".fwr-annot-reply").fwrContextMenu("fwr-annots-context-menu", {
                    onSelect: function(a, b) {
                        return f.onAnnotMenuSelect($(this), a)
                    }
                }, document.getElementById("docViewer")), $(".fwr-annot-reply").trigger("contextmenu.fwrContextMenu", a), !0
            },
            onRButtonDblClk: function(a) {
                return !1
            },
            onMouseWheel: function(a) {
                return !1
            },
            onMouseOver: function(a) {
                return !1
            },
            onMouseOut: function(a) {
                return !1
            },
            onMouseLeave: function(a) {
                return !1
            },
            onMouseEnter: function(a) {
                return !1
            },
            onHold: function(a) {
                return !1
            }
        }, WebPDF.Event.PopupMousePtHandler = d, WebPDF.Event.PopupMousePtHandler
    }), define("core/Plugins/Annot/PDFTypewriter", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = a("core/Plugins/Annot/PDFAnnot");
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat;
        WebPDF.Annot.TypewriterAnnotType = {
            TYPEWRITERTYPE_TYPEWRITER: "FreeTextTypewriter",
            TYPEWRITERTYPE_TEXTBOX: "FreeTextTextbox",
            TYPEWRITERTYPE_CALLOUT: "FreeTextCallout"
        }, WebPDF.Annot.TypewriteAnnotDefaultValue = {
            LineHeight: 22,
            FontHeight: 22,
            FontSize: 20,
            NewAnnotWidth: 5
        }, WebPDF.Annot.TypeWriterTextAlignStyle = {
            LEFT_JUSTIFIED: 0,
            CENTERED: 1,
            RIGHT_JUSTIFIED: 2
        };
        var g = function(a, b) {
            g.superclass.constructor.call(this, a, b), $.extend(this, {
                getIT: function() {
                    var a = this.annotJSONData[f.it];
                    return (null == a || "" == a) && (a = WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT), a
                },
                getFontName: function() {
                    var a = this.annotJSONData[f.fontName];
                    return (null == a || "" == a) && (a = "Helvetica"), a
                },
                getLineHeight: function() {
                    return this.annotJSONData[f.lineHeight]
                },
                setLineHeight: function(a) {
                    this.annotJSONData[f.lineHeight] = a
                },
                getFontHeight: function() {
                    return this.annotJSONData[f.fontHeight]
                },
                getFontSize: function() {
                    return this.annotJSONData[f.fontSize]
                },
                getFontColor: function() {
                    return this.annotJSONData[f.fontColor]
                },
                setFontColor: function(a) {
                    this.annotJSONData[f.fontColor] = a
                },
                getOpacity: function() {
                    return this.annotJSONData[f.opacity]
                },
                getTextAlign: function() {
                    return this.annotJSONData[f.textAlign]
                }
            })
        };
        return g.prototype = {
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getQuadPoints();
                if (c) {
                    for (var d = "", e = 0; e < c.length; e++) {
                        var f = String.Format("{0},", c[e]);
                        d += f
                    }
                    d = d.substr(0, d.length - 1), b.setAttribute("coords", d)
                }
                var h = this.getBorderWidth();
                h && b.setAttribute("width", h.toString());
                var i = this.getDashArray();
                if (i)
                    for (var e = 0; e < i.length; e++);
                var j = this.getBorderStyle();
                j && this.setBorderStyleToNode(b, j);
                var k = this.getRotate();
                b.setAttribute("rotation", k.toString());
                var l = this.getTextAlign(),
                    m = "";
                m = 0 === l ? "left" : 1 === l ? "center" : "right", b.setAttribute("justification", m);
                var n = this.getIT();
                n && b.setAttribute("intent", n);
                var o = a.createElement("contents-richtext");
                b.appendChild(o);
                var p = a.createElement("body");
                o.appendChild(p), p.setAttribute("xmlns", "http://www.w3.org/1999/xhtml"), p.setAttribute("xmlns:xfa", "http://www.xfa.org/schema/xfa-data/1.0/"), p.setAttribute("xfa:APIVersion", "Acroform:2.7.0.0"), p.setAttribute("xfa:spec", "2.1");
                var q = a.createElement("p");
                p.appendChild(q), q.setAttribute("dir", "ltr");
                var r = a.createElement("span");
                q.appendChild(r);
                var s = String.Format("font-size:{0}pt;font-style:normal;font-weight:normal", this.getFontSize());
                s += ";color:" + this.getFontColor(), s += ";font-family:" + this.getFontName(), r.setAttribute("style", s);
                var t = a.createTextNode(this.getContents());
                r.appendChild(t)
            }
        }, e.extend(g, d), WebPDF.Annot.PDFTypewriter = g, WebPDF.Annot.PDFTypewriter
    }), define("core/Plugins/Annot/CommentAnnot/CommentAnnotHandler", ["core/Plugins/Annot/CommentAnnot/CommentAnnotService", "core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/WebPDF", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", "core/Plugins/Annot/DrawingPropertyDlg"], function(a, b, c) {
        var d = a("core/Plugins/Annot/CommentAnnot/CommentAnnotService"),
            e = a("core/Plugins/Annot/CommentAnnot/CommentAnnotView"),
            f = a("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService"),
            g = a("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView");
        a("core/Plugins/Annot/DrawingPropertyDlg");
        WebPDF.CommentAnnotHandler = function(a, b, c, d, e, f) {
            this.readerApp = e, this.annotHandlerManager = f, this.commentAnnotService = c, this.commentAnnotView = b, this.commentAnnotService.setCommentType(a), this.getService = function() {
                return this.commentAnnotService
            }, this.getView = function() {
                return this.commentAnnotView
            }, this.drawingPropertyDlg = d, this.drawingPropertyDlg.setAnnotHandler(this)
        }, WebPDF.CommentAnnotHandler.prototype = {
            getType: function() {
                return this.getService().getCommentType()
            },
            canAnswer: function(a, b) {
                var c = this.readerApp.getCurToolHandler();
                return this.getService().canAnswer(a, c, b)
            },
            canMove: function(a) {
                return !1
            },
            moveAnnot: function(a, b, c, d, e, f) {},
            deleteAnnot: function(a, b) {
                a && b && this.readerApp.isEditable() && this.getView().deleteAnnot(a, b)
            },
            setAnnotProperty: function(a, b, c, d) {
                var e = this.readerApp;
                if (e.isEditable()) {
                    var f = {
                        annot: b,
                        event: c,
                        multiSelect: d,
                        pageView: a
                    };
                    this.drawingPropertyDlg.setOptions(f), this.drawingPropertyDlg.show(c.pageX, c.pageY, f)
                }
            },
            setAnnotColor: function(a, b, c) {
                a && b && (this.getView().setAnnotColor(a, c, b), this.getService().setAnnotColor(b, c), WebPDF.Common.getReaderApp().setModified(a, a.getDocView(), !0))
            },
            setAnnotOpacity: function(a, b, c, d) {
                c = parseFloat(c) / 100, c.toFixed(2), this.getView().setAnnotOpacity(a, b, c), d || (this.getService().setAnnotOpacity(a, b, c), this.readerApp.setModified(a, a.getDocView(), !0))
            },
            onDraw: function(a, b, c, d) {},
            onSelected: function(a, b) {
                return a && b ? (this.getView().selectAnnot(a, b.getAnnotName()), b.getInreplyto() && this.getView().selectAnnot(a, b.getInreplyto()), b.getGrp() && this.getView().selectAnnot(a, b.getGrp()), !0) : void 0
            },
            onDeSelected: function(a, b) {
                a && b && (this.drawingPropertyDlg.disabledDlg(), this.getView().deSelectedAnnot(a, b.getAnnotName()), b.getInreplyto() && this.getView().deSelectedAnnot(a, b.getInreplyto()), b.getGrp() && this.getView().deSelectedAnnot(a, b.getGrp()))
            },
            onFocus: function(a, b) {
                this.annotHandlerManager.getMarkupAnnotHandler().onFocus(a, b)
            },
            onLButtonDown: function(a, b, c) {
                return this.onSelected(a, b)
            },
            onLButtonUp: function(a, b, c) {},
            onLButtonDblClk: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onLButtonDblClk(a, b, c)
            },
            onMouseOver: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseOver(a, b, c)
            },
            onMouseLeave: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseLeave(a, b, c)
            },
            onUpdatePosition: function(a, b, c) {
                var d = a.getPDFPage(),
                    e = b.getRect(),
                    f = a.pdfRectToDevice(e, !0),
                    g = b.getSubType(),
                    h = b.getQuadPoints(),
                    i = [];
                if (null != h) {
                    var j = this.annotHandlerManager.quadPointsToRectArray(h, g, d.getPageMatrix());
                    if (null != j)
                        for (var k = 0; k < j.length; k++) {
                            var l = j[k];
                            l = a.pdfRectToDevice(l, !0), i.push(l)
                        }
                }
                this.getView().setAnnotPosition(a, b, f, i)
            }
        }, b.createCommentAnnotHandle = function(a, b, c) {
            var h = null,
                i = WebPDF.AccountInstance.getUserConfig();
            switch (c) {
                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT:
                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT_AREA:
                    var j = ["#ffff00", "#ccff66", "#00ffff", "#99ccff", "#7480fc", "#cc99ff", "#ff99ff", "#ff9999", "#00cc66", "#22f3b1"],
                        k = null,
                        l = null;
                    c === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? (k = new e, l = new d, l.setCommentType(WebPDF.Tools.TOOL_NAME_COMMENT_HIGHLIGHT)) : (k = new g, l = f.getAreaHighlightAnnotService(WebPDF.Tool.getReaderApp()), l.setCommentType(WebPDF.Tools.TOOL_NAME_COMMENT_HIGHLIGHT_AREA));
                    var m = {
                            title: i18n.t("AnnotProperties.HighlightTitle"),
                            colorArr: j,
                            drawingConfig: i.annot.highLight
                        },
                        n = new CommentPropertyDlg(null, null, m);
                    h = new WebPDF.CommentAnnotHandler(c, k, l, n, a, b);
                    break;
                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE:
                    var j = ["#33cc00", "#cccc00", "#ff9933", "#0099cc", "#bbbbbb", "#3366ff", "#cc33ff", "#cc0099", "#ff0000", "#686767"],
                        k = new e,
                        l = new d;
                    l.setCommentType(WebPDF.Tools.TOOL_NAME_COMMENT_UNDERLINE);
                    var m = {
                            title: i18n.t("AnnotProperties.UnderlineTitle"),
                            colorArr: j,
                            drawingConfig: i.annot.underLine
                        },
                        n = new CommentPropertyDlg(null, null, m);
                    h = new WebPDF.CommentAnnotHandler(c, k, l, n, a, b);
                    break;
                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY:
                    var j = ["#33cc00", "#cccc00", "#ff9933", "#0099cc", "#bbbbbb", "#3366ff", "#cc33ff", "#cc0099", "#ff0000", "#686767"],
                        k = new e;
                    k.setAnnotHandlerMgr(b);
                    var l = new d;
                    l.setCommentType(WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY);
                    var m = {
                            title: i18n.t("AnnotProperties.SquigglyTitle"),
                            colorArr: j,
                            drawingConfig: i.annot.squiggly
                        },
                        n = new CommentPropertyDlg(null, null, m);
                    h = new WebPDF.CommentAnnotHandler(c, k, l, n, a, b);
                    break;
                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT:
                    var j = ["#ff3333", "#ff00ff", "#9966ff", "#66cc33", "#996666", "#cccc00", "#ff9900", "#00ccff", "#00cccc", "#000000"],
                        k = new e,
                        l = new d;
                    l.setCommentType(WebPDF.Tools.TOOL_NAME_COMMENT_STRIKEOUT);
                    var m = {
                            title: i18n.t("AnnotProperties.StrikeOutTitle"),
                            colorArr: j,
                            drawingConfig: i.annot.strikeOut
                        },
                        n = new CommentPropertyDlg(null, null, m);
                    h = new WebPDF.CommentAnnotHandler(c, k, l, n, a, b);
                    break;
                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE:
                    var j = ["#ff3333", "#ff00ff", "#9966ff", "#66cc33", "#996666", "#cccc00", "#ff9900", "#00ccff", "#00cccc", "#000000"],
                        k = new e,
                        l = new d;
                    l.setCommentType(WebPDF.Tools.TOOL_NAME_COMMENT_REPLACE);
                    var m = {
                            title: i18n.t("AnnotProperties.ReplaceTitle"),
                            colorArr: j,
                            drawingConfig: i.annot.replace
                        },
                        n = new CommentPropertyDlg(null, null, m);
                    h = new WebPDF.CommentAnnotHandler(c, k, l, n, a, b);
                    break;
                case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET:
                    var j = ["#ff3333", "#ff00ff", "#9966ff", "#66cc33", "#996666", "#cccc00", "#ff9900", "#00ccff", "#00cccc", "#000000"],
                        k = new e,
                        l = new d;
                    l.setCommentType(WebPDF.Tools.TOOL_NAME_COMMENT_CARET);
                    var m = {
                            title: i18n.t("AnnotProperties.InsertTitle"),
                            colorArr: j,
                            drawingConfig: i.annot.caret
                        },
                        n = new CommentPropertyDlg(null, null, m);
                    h = new WebPDF.CommentAnnotHandler(c, k, l, n, a, b);
                    break;
                default:
                    title = ""
            }
            return h
        }
    }), define("core/Plugins/Annot/CommentAnnot/CommentAnnotService", [], function(a, b, c) {
        var d = WebPDF.Annot.MKA_POPUPWIDTH,
            e = WebPDF.Annot.MKA_POPUPHEIGHT;
        return CommentAnnotService = function() {
            this.commentType = ""
        }, CommentAnnotService.prototype = {
            setCommentType: function(a) {
                this.commentType = a
            },
            getCommentType: function() {
                return this.commentType
            },
            isEditableCommentsType: function(a) {
                return a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE || a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT || a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY || a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT || a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE || a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET ? !0 : !1
            },
            canAnswer: function(a, b, c) {
                if (!a) return !1;
                var d = a.getSubType();
                if (!this.isEditableCommentsType(d)) return !1;
                if (!b) return !1;
                var e = b.getName();
                return e == WebPDF.Tools.TOOL_NAME_SELANNOT || e === WebPDF.Tools.TOOL_NAME_HAND || e === this.getCommentType() || e == WebPDF.Tools.TOOL_NAME_COMMENT_REPLACE ? !0 : c && e === WebPDF.TOOL_NAME_SELECTTEXT ? !0 : !1
            },
            setAnnotColor: function(a, b) {
                b = WebPDF.Common.rgb2HexColor(b), a.setColor(b)
            },
            setAnnotOpacity: function(a, b, c) {
                b.setOpacity(c), _readerApp.setModified(a, a.getDocView(), !0)
            },
            addPdfAnnot: function(a, b, c, f, g, h, i, j, k, l, m, n) {
                function o(a, b, d, e, g, h, i, j) {
                    var k = s.getDefaultOpacity(e),
                        l = {
                            c: "",
                            ca: k,
                            cd: b,
                            cl: g,
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: b,
                            n: null,
                            subj: h,
                            subty: e,
                            tit: i,
                            ty: "Markup",
                            rc: null,
                            pdf: "false",
                            del: 0
                        };
                    if (e == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE ? (l.subj = e, l.subty = h, l.it = "StrikeOutTextEdit") : l.pop = null, e == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET) l.it = "Insert Text", l.rc = [j.x - j.width / 2, j.y - j.height / 2, j.x + j.width / 2, j.y + j.height / 2], l.rd = [Math.abs(j.height) / 10, Math.abs(j.height) / 10, Math.abs(j.height) / 10, Math.abs(j.height) / 10];
                    else {
                        l.Quad = [], WebPDF.RectUtils.normalize(d[0]);
                        var m = d[0],
                            n = new WebPDF.PDFMatrix;
                        n.SetReverse(a);
                        var o = new WebPDF.PDFMatrix;
                        o.SetReverse(c[0]), r(l.Quad, m, n, o, c[0], f[0]);
                        for (var p = 1; p < d.length; p++) {
                            var q = d[p];
                            o = new WebPDF.PDFMatrix, o.SetReverse(c[p]), r(l.Quad, q, n, o, c[p], f[p]), WebPDF.RectUtils.normalize(q), WebPDF.RectUtils.union(m, q)
                        }
                        l.rc = [m.left, m.top, m.right, m.bottom]
                    }
                    return l
                }

                function p(a, b, c, f, g) {
                    var h = new WebPDF.PDFRect(0, 0, 0, 0);
                    h.top = a.top, h.left = (f - d * c) / (g * c), h.right = h.left + d, h.bottom = h.top - e;
                    var i = {
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: b,
                        n: b + "_popup",
                        op: 0,
                        rc: [h.left, h.top, h.right, h.bottom]
                    };
                    return i
                }

                function q(a, b, c) {
                    var d = c[a];
                    c[a] = c[b], c[b] = d
                }

                function r(a, b, c, d, e, f) {
                    var g = c.TransFormRect(b.left, b.top, b.right, b.bottom),
                        h = d.TransFormRect(g[0], g[1], g[2], g[3]);
                    switch (f) {
                        case WebPDF.Text.WritingMode.TEXT_WRITING_MODE_LRTB:
                            h[2] < h[0] && q(2, 0, h), h[1] > h[3] && q(1, 3, h);
                            break;
                        case WebPDF.Text.WritingMode.TEXT_WRITING_MODE_RLTB:
                            h[0] > h[2] && q(2, 0, h), h[1] > h[3] && q(1, 3, h);
                            break;
                        case WebPDF.Text.WritingMode.TEXT_WRITING_MODE_LRBT:
                            h[2] < h[0] && q(2, 0, h), h[1] < h[3] && q(1, 3, h);
                            break;
                        case WebPDF.Text.WritingMode.TEXT_WRITING_MODE_RLBT:
                            h[0] > h[2] && q(2, 0, h), h[1] < h[3] && q(1, 3, h)
                    }
                    var i = e.TransFormPoint(h[0], h[3]),
                        j = e.TransFormPoint(h[2], h[3]),
                        k = e.TransFormPoint(h[2], h[1]),
                        l = e.TransFormPoint(h[0], h[1]);
                    a.push(i[0], l[1], j[0], k[1], l[0], i[1], k[0], j[1])
                }
                if (!a || b.length < 0) return !1;
                var s = this,
                    t = new Date,
                    u = t.valueOf(),
                    v = Math.floor(u / 1e3).toString();
                n = n ? n : this.commentType;
                var w = o(a.getPageMatrix(), v, b, n, g, h, i, m);
                n !== WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE && (w.pop = p(b[0], v, j, k, l));
                var x = WebPDF.Annot.AnnotFactory.createAnnot(w, a.getPageIndex(), !1);
                return a.getAnnotJsonData().push(w), a.addAnnot(x), x
            },
            isEnabled: function(a) {
                return a ? a.getDocType() != WebPDF.Annot.DocType.XFA ? !0 : !0 : !1
            },
            isCommenAnnot: function(a, b) {
                if (!a) return !1;
                var c = a.getPDFPage(),
                    d = c.getAnnotByName(b);
                return d && "Markup" === d.getType() && d.getSubType() === this.commentType ? !0 : !1
            },
            getDefaultOpacity: function(a) {
                var b = WebPDF.AccountInstance.getUserConfig();
                return a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? b.annot.highLight.opacity : 1
            }
        }, CommentAnnotService
    }), define("core/Plugins/Annot/CommentAnnot/CommentAnnotView", ["core/WebPDF"], function(a, b, c) {
        a("core/WebPDF");
        var d = null;
        return CommentAnnotView = function() {
            this.setAnnotHandlerMgr = function(a) {
                d = a
            }, this.getPageAnnotsContainerID = function(a) {
                return a.getPageViewContainerID() + "_AnnotsContainer"
            }, this.getAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Annots_" + b
            }, this.getCommentAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Comment_Annots_" + b
            }, this.getAnnotPopupDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Popup_" + b
            }, this.getCommentAnnotQuadDivID = function(a, b, c) {
                var d = this.getCommentAnnotDivID(a, b);
                return d += "_quad_" + c
            }, this.getCommentAnnotRectDivID = function(a, b) {
                var c = this.getCommentAnnotDivID(a, b);
                return c += "_rect"
            }, this.getAnnotCanvasDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Annots_Canvas_" + b
            }, this.getDrawingAnnotDivID = function(a, b) {
                return a.getPageViewContainerID() + "_Drawing_Annots_" + b
            }
        }, CommentAnnotView.prototype = {
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.getAnnotDivID(a, c);
                $("#" + d).remove();
                var e = this.getCommentAnnotDivID(a, c);
                $("#" + e).remove();
                var e = this.getDrawingAnnotDivID(a, c);
                $("#" + e).remove();
                var f = b.getPopup();
                if (null != f && null == b.getHeadAnnot()) {
                    var g = this.getAnnotPopupDivID(a, c);
                    $("#" + g).remove()
                }
            },
            setAnnotColor: function(a, b, c) {
                var e = c.getAnnotName(),
                    f = this.getCommentAnnotDivID(a, e),
                    g = $("#" + f),
                    h = c.getOpacity();
                if (b = WebPDF.Common.restRgbaAlpha(b, h), !WebPDF.Environment.mobile) {
                    var i = this.getAnnotPopupDivID(a, e),
                        j = $("#" + i);
                    WebPDF.Common.isColorBlack(WebPDF.Common.rgb2HexColor(b)) ? j.css("color", "#fff") : j.css("color", "#000"), j.css("backgroundColor", b), j.find(".popup_header .popup_child").css("backgroundColor", b), j.find(".popup_header").css("backgroundColor", b)
                }
                var k = $("#" + f + " canvas");
                if (k.length && d ? d.drawSquigglys(k, b) : "Underline" === c.getSubType() ? g.find("div").css("border-color", b) : "StrikeOut" === c.getSubType() ? g.find("div.inner-div").css("background-color", b) : g.find("div").css("background-color", b), c.getSubType() == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET) {
                    var l = this.getAnnotCanvasDivID(a, c.getAnnotName()),
                        m = $("#" + l);
                    d.getCanvasDrawCaret(a, m, c, b)
                }
                this.deSelectedAnnot(a, e)
            },
            setAnnotOpacity: function(a, b, c) {
                var e = b.getAnnotName(),
                    f = this.getCommentAnnotDivID(a, e),
                    g = $("#" + f),
                    h = b.getColorWithOpacity(),
                    i = WebPDF.Common.restRgbaAlpha(h, c);
                if (!WebPDF.Environment.mobile) {
                    var j = this.getAnnotPopupDivID(a, e),
                        k = $("#" + j);
                    k.css("backgroundColor", i), k.find(".popup_header .popup_child").css("backgroundColor", i), k.find(".popup_header").css("backgroundColor", i)
                }
                var l = $("#" + f + " canvas");
                l.length && d ? d.drawSquigglys(l, i) : "Underline" === b.getSubType() ? g.find("div").css("border-color", i) : "StrikeOut" === b.getSubType() ? g.find("div.inner-div").css("background-color", i) : g.find("div").css("background-color", i), this.deSelectedAnnot(a, e)
            },
            selectAnnot: function(a, b) {
                var c = this.getAnnotDivID(a, b);
                $("#" + c).addClass("fwr-annot-selected");
                var d = this.getCommentAnnotDivID(a, b);
                $("#" + d).addClass("fwr-annot-comment-selected")
            },
            deSelectedAnnot: function(a, b) {
                var c = this.getAnnotDivID(a, b);
                $("#" + c).removeClass("fwr-annot-selected");
                var d = this.getCommentAnnotDivID(a, b);
                $("#" + d).removeClass("fwr-annot-comment-selected")
            },
            setAnnotPosition: function(a, b, c, e) {
                function f(a) {
                    return a = Math.round(a), 0 === a ? 1 : a
                }

                function g(c, e, g) {
                    var h = a.getPDFPage(),
                        i = (90 * h.getPageRotate() % 360 + 360) % 360,
                        j = (b.getRotate() % 360 + 360) % 360,
                        k = i - j,
                        l = b.getSubType();
                    switch (l) {
                        case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE:
                            var m = "";
                            switch (k) {
                                case 0:
                                    m = "0 0 " + f(e / 8) + "px 0";
                                    break;
                                case 90:
                                    m = "0 0 0 " + f(g / 8) + "px";
                                    break;
                                case 180:
                                    m = f(e / 8) + "px 0 0 0";
                                    break;
                                case 270:
                                    m = "0 " + f(g / 8) + "px 0 0"
                            }
                            $("#" + c).css("borderWidth", m);
                            break;
                        case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY:
                            var n = $("#" + c),
                                o = n.find("canvas");
                            if (90 === k || 270 === k) {
                                var p = e;
                                e = g, g = p
                            }
                            var q = {
                                transform: "rotate(" + k + "deg)",
                                "transform-origin": "0 0"
                            };
                            switch (k) {
                                case 0:
                                    break;
                                case 90:
                                    q.left = e / 4 + "px";
                                    break;
                                case 180:
                                    q.top = e / 4 + "px", q.left = g + "px";
                                    break;
                                case 270:
                                    q.top = g + "px", q.left = 3 * e / 4 + "px"
                            }
                            o.each(function(a, b) {
                                $(b).css(q), b.height = e / 4 > 2 ? e / 4 : 2, b.width = g
                            }), d.getCanvasDrawSquiggly(n, b);
                            break;
                        case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT:
                        case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE:
                        case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET:
                            var r, s, t, u;
                            switch (k) {
                                case 0:
                                    r = f(e / 8), t = r / 2, t = "-" + t + "px", $("#" + c).children("div").css({
                                        height: r,
                                        marginTop: t
                                    });
                                    break;
                                case 90:
                                    s = f(g / 8), u = s / 2, u = "-" + u + "px", $("#" + c).children("div").css({
                                        height: "100%",
                                        width: s,
                                        marginLeft: u
                                    });
                                    break;
                                case 180:
                                    r = f(e / 8), t = r / 2, t = "-" + t + "px", $("#" + c).children("div").css({
                                        height: r,
                                        marginTop: t
                                    });
                                    break;
                                case 270:
                                    s = f(g / 8), u = s / 2, u = "-" + u + "px", $("#" + c).children("div").css({
                                        height: "100%",
                                        width: s,
                                        marginLeft: u
                                    })
                            }
                    }
                }
                var h = b.getAnnotName(),
                    i = this.getAnnotDivID(a, h);
                $("#" + i).css({
                    left: c.left,
                    top: c.top,
                    width: WebPDF.RectUtils.width(c),
                    height: WebPDF.RectUtils.height(c)
                });
                var j = this.getAnnotCanvasDivID(a, h);
                $("#" + j).css({
                    width: WebPDF.RectUtils.width(c),
                    height: WebPDF.RectUtils.height(c)
                }), $("#" + j)[0] && d.getCanvasDrawCaret(a, $("#" + j), b);
                var k = this.getDrawingAnnotDivID(a, h);
                $("#" + k).css({
                    left: c.left,
                    top: c.top,
                    width: WebPDF.RectUtils.width(c),
                    height: WebPDF.RectUtils.height(c)
                });
                var l = !1;
                if (e) {
                    for (var m = 0; m < e.length; m++) {
                        var n = e[m],
                            o = this.getCommentAnnotQuadDivID(a, h, m);
                        $("#" + o).css({
                            left: n.left,
                            top: n.top,
                            width: WebPDF.RectUtils.width(n),
                            height: WebPDF.RectUtils.height(n)
                        }), g(o, WebPDF.RectUtils.height(n), WebPDF.RectUtils.width(n))
                    }
                    l = !0
                }
                if (!l) {
                    var p = this.getCommentAnnotRectDivID(a, h);
                    $("#" + p).css({
                        left: c.left,
                        top: c.top,
                        width: WebPDF.RectUtils.width(c),
                        height: WebPDF.RectUtils.height(c)
                    })
                }
            },
            setDocCursor: function(a, b) {
                function c() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (i.addClass("fwr-highlight-cursor-ie"), i.css("cursor", "text")) : i.addClass("fwr-highlight-cursor")
                }

                function d() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (i.addClass("fwr-underline-cursor-ie"), i.css("cursor", "text")) : i.addClass("fwr-underline-cursor")
                }

                function e() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (i.addClass("fwr-strikeout-cursor-ie"), i.css("cursor", "text")) : i.addClass("fwr-strikeout-cursor")
                }

                function f() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (i.addClass("fwr-squiggly-cursor-ie"), i.css("cursor", "text")) : i.addClass("fwr-squiggly-cursor")
                }

                function g() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (i.addClass("fwr-replacetext-cursor-ie"), i.css("cursor", "text")) : i.addClass("fwr-replacetext-cursor")
                }

                function h() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (i.addClass("fwr-inserttext-cursor-ie"), i.css("cursor", "text")) : i.addClass("fwr-inserttext-cursor")
                }
                if (a) {
                    var i = $("#" + a.getDocViewContainerID());
                    b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? c() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE ? d() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT ? e() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY ? f() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE ? g() : b == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET && h()
                }
            },
            delDocCursor: function(a, b) {
                function c() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? i.removeClass("fwr-highlight-cursor-ie") : i.removeClass("fwr-highlight-cursor")
                }

                function d() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? i.removeClass("fwr-underline-cursor-ie") : i.removeClass("fwr-underline-cursor")
                }

                function e() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? i.removeClass("fwr-strikeout-cursor-ie") : i.removeClass("fwr-strikeout-cursor")
                }

                function f() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? i.removeClass("fwr-squiggly-cursor-ie") : i.removeClass("fwr-squiggly-cursor")
                }

                function g() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? i.removeClass("fwr-replacetext-cursor-ie") : i.removeClass("fwr-replacetext-cursor")
                }

                function h() {
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? i.removeClass("fwr-inserttext-cursor-ie") : i.removeClass("fwr-inserttext-cursor")
                }
                if (a) {
                    var i = $("#" + a.getDocViewContainerID());
                    b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? c() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE ? d() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT ? e() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY ? f() : b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE ? g() : b == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET && h()
                }
            },
            clearHighLightRectsSelected: function(a, b, c) {
                function d(a) {
                    var b = a.getPageViewContainerID() + "_TextSelectedHighLightsSelected",
                        c = $("#" + b);
                    c.length <= 0 || c.empty()
                }
                if (b && b >= 0) {
                    var e = a.getPageView(b);
                    if (!e) return;
                    return void d(e)
                }
                for (var f = a.getPageCount(), g = 0; f > g; g++) {
                    var e = a.getPageView(g);
                    if (!e) break;
                    d(e)
                }
            },
            addAnnot: function(a, b, c) {
                if (a && b) {
                    var e = this.getPageAnnotsContainerID(b),
                        f = $("#" + e),
                        g = a.createAAnnotHtmlContent(b, c, c.getAnnotName(), 1, !1);
                    if (f.append(g), d && (c.getSubType() == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY && d.getCanvasDrawSquiggly(g, c), c.getSubType() == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET)) {
                        var h = $(g).find("canvas");
                        d.getCanvasDrawCaret(b, h, c)
                    }
                }
            }
        }, CommentAnnotView
    }), define("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", ["core/Plugins/Annot/CommentAnnot/CommentAnnotService"], function(a, b, c) {
        function d(a) {
            var b = a,
                c = new g(0, 0),
                d = new g(0, 0),
                e = WebPDF.TextSelection.PDFTextSelectTool,
                f = !1,
                j = [],
                m = -1;
            $.extend(this, {
                getStartPageIndex: function() {
                    return m
                },
                clearSelection: function() {
                    f = !1, c = new g(0, 0), d = new g(0, 0), _selectionRectArrayInfo = [], j = [], m = -1, _endPageIndex = -1
                },
                onLButtonDown: function(a) {
                    f = !0;
                    var d = new WebPDF.PDFPoint(0, 0),
                        g = e.getPageViewInfoByMouseEvent(b, a, d, !0, !1);
                    m = g.getPageIndex(), c = d
                },
                onMouseMove: function(a) {
                    function k(a, c, d) {
                        if (j = [], a.equal(c)) return !1;
                        var e = b.getMainView().getDocView().getPageView(d);
                        if (!e) return !1;
                        var f = new g(0, 0),
                            k = new g(0, 0);
                        f = e.devicePtToPDF(a), k = e.devicePtToPDF(c);
                        var l = new h(f.x, f.y, k.x, k.y);
                        return i.normalize(l), i.isEmpty(l) ? !1 : (j.push(l), !0)
                    }
                    if (f) {
                        var l = new WebPDF.PDFPoint(0, 0);
                        l.x = a.pageX, l.y = a.pageY;
                        var n = b.getMainView().getDocView().getPageView(m).getPageViewRect();
                        if (!i.ptInRect(n, l)) return !1;
                        e.getPageViewInfoByMouseEvent(b, a, l, !0, !1), d = l, k(c, d, m)
                    }
                },
                getSelectionArray: function() {
                    return j
                },
                addPdfAnnot: function(a, b, c, d, e, f, g, h) {
                    function i(a, b, c, d, e, f, g) {
                        var h = {
                            c: "",
                            ca: m.getDefaultOpacity(d),
                            cd: b,
                            cl: e,
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: b,
                            n: null,
                            pop: null,
                            subj: f,
                            subty: d,
                            tit: g,
                            ty: "Markup",
                            Quad: [],
                            rc: null,
                            areahi: "AreaHi",
                            pdf: "false",
                            del: 0
                        };
                        WebPDF.RectUtils.normalize(c), h.rc = [c.left, c.top, c.right, c.bottom];
                        var i = new WebPDF.PDFMatrix;
                        i.SetReverse(a);
                        var j = i.TransFormRect(c.left, c.top, c.right, c.bottom);
                        return c = new WebPDF.PDFRect(j[0], j[1], j[2], j[3]), h.Quad = [c.left, c.bottom, c.right, c.bottom, c.left, c.top, c.right, c.top], h
                    }

                    function j(a, b, c, d, e) {
                        var f = new WebPDF.PDFRect(0, 0, 0, 0);
                        f.top = a.top, f.left = (d - k * c) / (e * c), f.right = f.left + k, f.bottom = f.top - l;
                        var g = {
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: b,
                            n: b + "_popup",
                            op: 0,
                            rc: [f.left, f.top, f.right, f.bottom]
                        };
                        return g
                    }
                    if (!a || b.length < 0) return !1;
                    var m = this,
                        n = new Date,
                        o = n.valueOf(),
                        p = Math.floor(o / 1e3).toString(),
                        q = a.getPDFPage(),
                        r = i(q.getPageMatrix(), p, b, this.getCommentType(), c, d, e);
                    r.pop = j(b, p, f, g, h);
                    var s = WebPDF.Annot.AnnotFactory.createAnnot(r, q.getPageIndex(), !1);
                    return q.getAnnotJsonData().push(r), q.addAnnot(s), s
                }
            })
        }
        var e = a("core/Plugins/Annot/CommentAnnot/CommentAnnotService"),
            f = WebPDF.Interface,
            g = WebPDF.PDFPoint,
            h = WebPDF.PDFRect,
            i = WebPDF.RectUtils,
            j = null,
            k = WebPDF.Annot.MKA_POPUPWIDTH,
            l = WebPDF.Annot.MKA_POPUPHEIGHT;
        f.extend(d, e), b.getAreaHighlightAnnotService = function(a) {
            return null == j && (j = new d(a)), j
        }
    }), define("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", ["core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/WebPDF"], function(a, b, c) {
        var d = a("core/Plugins/Annot/CommentAnnot/CommentAnnotView"),
            e = WebPDF.Interface,
            f = WebPDF.RectUtils;
        WebPDF.PDFRect;
        return AreaHighlightAnnotView = function() {
            AreaHighlightAnnotView.superclass.constructor.call(this), this._highlightDivCreatedPageList = {}, $.extend(this, {
                setDocCursor: function(a, b) {
                    function c() {
                        WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (d.addClass("fwr-note-cursor-ie"), d.css("cursor", "crosshair")) : d.addClass("fwr-note-cursor")
                    }
                    if (a) {
                        var d = $("#" + a.getDocViewContainerID());
                        b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT && c()
                    }
                },
                delDocCursor: function(a, b) {
                    function c() {
                        WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? d.removeClass("fwr-note-cursor-ie") : d.removeClass("fwr-note-cursor")
                    }
                    if (a) {
                        var d = $("#" + a.getDocViewContainerID());
                        b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT && c()
                    }
                },
                clearAreaHighLightSelect: function(a, b, c) {
                    function d(a) {
                        var b = e.getAreaHighlightDivID(a),
                            c = $("#" + b);
                        c.length > 0 && c.empty()
                    }
                    var e = this;
                    if (b && b >= 0) {
                        var f = a.getPageView(b);
                        if (!f) return;
                        return void d(f)
                    }
                    for (var g = a.getPageCount(), h = 0; g > h; h++) {
                        var f = a.getPageView(h);
                        if (!f) break;
                        d(f)
                    }
                },
                addAnnot: function(a, b, c) {
                    if (a && b) {
                        var d = this.getPageAnnotsContainerID(b),
                            e = $("#" + d),
                            f = a.createAAnnotHtmlContent(b, c, c.getAnnotName(), 1, !1);
                        e.append(f)
                    }
                },
                highlightSelectedArea: function(a, b) {
                    var c = this.getAreaHighlightDivID(a),
                        d = a.getPageIndex();
                    if (!this._highlightDivCreatedPageList[d]) {
                        var e = "<div id='" + c + "' style='z-index:7;'></div>",
                            g = $("#" + a.getPageViewContainerID());
                        g.append(e), this._highlightDivCreatedPageList[d] = !0
                    }
                    var h = "",
                        i = $("#" + c);
                    i.empty();
                    for (var j = 0; j < b.length; j++) {
                        var k = b[j];
                        f.normalize(k), k = a.pdfRectToDevice(k, !0), h += "<div id='area_highlight_" + d + "_" + j + "'class='fwr-text-highlight' style='left:" + k.left + "px;top:" + k.top + "px;width:" + f.width(k) + "px;height:" + f.height(k) + "px' ></div>"
                    }
                    i.append(h)
                },
                getAreaHighlightDivID: function(a) {
                    return a.getPageViewContainerID() + "_AreaHighLights"
                }
            })
        }, e.extend(AreaHighlightAnnotView, d), AreaHighlightAnnotView
    }), define("core/Plugins/Annot/DrawingPropertyDlg", [], function(a, b, c) {
        function d(a, b, c, d, f) {
            function i(a, d, f) {
                a && (a = WebPDF.Common.rgb2HexColor(a));
                var g = null;
                $.isFunction(c.getIntent) && (g = c.getIntent()), e(WebPDF.Tool.getReaderApp(), c, g, a, d, f), h = !0, k(b)
            }

            function k(a) {
                h && WebPDF.Tool.getReaderApp().setModified(a, a.getDocView(), !0)
            }
            if (g) {
                $(a).attr("checked", "checked");
                var l = $("#fwrCommentPropertyDlg .span-color.selected>span").css("backgroundColor");
                j && !l && (l = j);
                var m = parseInt($("#border_width").val());
                i(l, m, f)
            } else $(a).attr("checked", !1)
        }

        function e(a, b, c, d, e, f) {
            var g = b.getSubType(),
                h = b.getType();
            if (f) {
                d && (c && f[c] ? f[c].clr = d : f[g] ? f[g].clr = d : f.clr ? f.clr = d : ("Textbox" === h || "Polygon" == g && "PolygonCloud" == b.getIT()) && (f.fontColor = d)), "Line" === g && (f.Line.cap = b.showCaption()), ("Ink" === g && e || "Polygon" == g && "PolygonCloud" == b.getIT() && e) && (f.borderWidth = e), ("Square" === g || "Textbox" === h || "Circle" === g || "Polygon" === g) && (f.fillColor = b.getFillColor()), ("Textbox" === h || "Polygon" == g && "PolygonCloud" == b.getIT()) && (f.fillColor = b.getFillColor(), f.borderColor = b.getColor(), f.opacity = b.getOpacity()), "Textbox" === h && (f.fontSize = b.getFontSize(), f.lineHeight = b.getLineHeight()), "Callout" === h && (f.fillColor = b.getFillColor()), "Highlight" === g && (f.opacity = b.getOpacity());
                var i = WebPDF.AccountInstance.getUserConfig(),
                    j = WebPDF.AccountInstance.getUserId();
                if (null === j || "Anonymous" === j || "" === j) return !1;
                var k = a.getOptions().baseUrl + "api/systemuser/userconfig/save",
                    l = {
                        id: i.userId,
                        userName: i.userName,
                        userConfig: JSON.stringify(i)
                    };
                $.ajax({
                    type: "POST",
                    url: k,
                    dataType: "json",
                    data: l,
                    success: function(a) {
                        0 === a.error
                    },
                    error: function(a) {}
                })
            }
        }

        function f(a, b, c, d) {
            c = null == c ? 1 : c, d = d || 11;
            var e = $(".fwr-drag-progress #bar").width(),
                f = parseFloat((b - c) / d * e).toFixed(2);
            a.setPosInBar(f)
        }
        var g = !1,
            h = !1,
            i = !0,
            j = null;
        CommentPropertyDlg = function(a, b, c) {
            this.annotUIManager = null, this.option = c, this.annotHandler = a, this.pageView = b, WebPDF.Tool.getReaderApp().isMobile() ? this.eventType = "tap" : this.eventType = "click";
            var d = this;
            this.bindEvents = function(a) {
                function b(a) {
                    var b = a ? a.toHexString() : null;
                    d.onSelectLineWidth(b, "FillColor")
                }
                a.annot.annotJSONData.r && $("#btnPropRotate").val(a.annot.annotJSONData.r);
                var c = $("#fwrCommentPropertyDlg");
                $("#fwrCommentPropertyDlg #closeBtn, #fwrCommentPropertyDlg .close").off(d.eventType).on(d.eventType, function() {
                    return d.onClosePop(), !1
                }), $("#fwrCommentPropertyDlg .span-color").off(d.eventType).on(d.eventType, function() {
                    return .4 == $("#fwrCommentPropertyDlg .fwr-modal-body").css("opacity") ? !1 : (d.onSelectColor(this), !1)
                }), $("#set_default").off(d.eventType).on(d.eventType, function() {
                    return g = !g, g ? ($(this).parent().addClass("fwrm-set-default-checked"), $(".fwrm-set-default-checked").off("tap").on("tap", function() {
                        $(this).removeClass("fwrm-set-default-checked"), $("#set_default").trigger(d.eventType)
                    })) : $(this).parent().removeClass("fwrm-set-default-checked"), d.onSetDefaultColor(this), WebPDF.Tool.getReaderApp().isMobile() ? !1 : void 0
                });
                var e = new k("btn_op", "bar_op", "op", d, 0, 100, "Opacity"),
                    h = new k("btn", "bar", "border_width", d);
                $("#border_width").off("keyup").on("keyup", function(a, b) {
                    var c = this.value;
                    return "" === c ? !1 : ((isNaN(c) || 0 >= c || !/(^[1-9]\d*$)/.test(c) || c > 12) && (this.value = 3), f(h, this.value), void("from-show" !== b && d.onSelectLineWidth(this.value)))
                }), $("#op").off("keyup").on("keyup", function(a, b) {
                    var c = this.value;
                    return "" === c ? !1 : ((isNaN(c) || 0 > c || !/(^[1-9]\d*$)/.test(c) || c > 100) && (this.value = 0), f(e, this.value, 0, 100), void("from-show" !== b && d.onSelectLineWidth(this.value, "Opacity")))
                }), c.find("[data-role=user]").off("change.userInput").on("change.userInput", function() {
                    var a = $(this);
                    d.onUpdateUserName(a.val())
                }), c.find("[data-role=subject]").off("change.subjectInput").on("change.subjectInput", function() {
                    var a = $(this);
                    d.onUpdateSubject(a.val())
                }), c.find("#showCaption").off("change").on("change", function() {
                    var a = $(this).prop("checked");
                    d.onUpdateCaption(a)
                }), $("#btnFillColor").spectrum({
                    color: a.annot.getFillColor(),
                    showInput: !1,
                    preferredFormat: "hex",
                    showPalette: !0,
                    allowEmpty: !0,
                    palette: [
                        ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                        ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                        ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                        ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                        ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                        ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                        ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                        ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
                    ],
                    move: b,
                    change: b,
                    hide: b
                }), $("#btnBorderColor").spectrum({
                    color: a.annot.getColor(),
                    showInput: !1,
                    preferredFormat: "hex",
                    showPalette: !0,
                    palette: [
                        ["#000", "#444", "#666", "#999", "#ccc", "#eee", "#f3f3f3", "#fff"],
                        ["#f00", "#f90", "#ff0", "#0f0", "#0ff", "#00f", "#90f", "#f0f"],
                        ["#f4cccc", "#fce5cd", "#fff2cc", "#d9ead3", "#d0e0e3", "#cfe2f3", "#d9d2e9", "#ead1dc"],
                        ["#ea9999", "#f9cb9c", "#ffe599", "#b6d7a8", "#a2c4c9", "#9fc5e8", "#b4a7d6", "#d5a6bd"],
                        ["#e06666", "#f6b26b", "#ffd966", "#93c47d", "#76a5af", "#6fa8dc", "#8e7cc3", "#c27ba0"],
                        ["#c00", "#e69138", "#f1c232", "#6aa84f", "#45818e", "#3d85c6", "#674ea7", "#a64d79"],
                        ["#900", "#b45f06", "#bf9000", "#38761d", "#134f5c", "#0b5394", "#351c75", "#741b47"],
                        ["#600", "#783f04", "#7f6000", "#274e13", "#0c343d", "#073763", "#20124d", "#4c1130"]
                    ],
                    change: function(a) {
                        $("#btnBorderColor").val() && d.onSelectLineWidth($("#btnBorderColor").val(), "BorderColor")
                    }
                }), $("#btnFontSize").off("change.fontSize").on("change.fontSize", function() {
                    var a = $(this).val();
                    d.onSelectLineWidth(a, "FontSize")
                }), $("#btnPropRotate").off("change.propRotate").on("change.propRotate", function() {
                    var a = $(this).val();
                    d.onUpdateRotate(a)
                }), WebPDF.Tool.getReaderApp().isMobile() && ($(document).off("tap").on("tap", function() {
                    var a = $("#fwrCommentPropertyDlg");
                    if (!a.is(":hidden")) return i ? void d.onClosePop() : void(i = !0)
                }), $("#fwrCommentPropertyDlg").off("tap").on("tap", function(a) {
                    return "set_default" === a.srcElement.id ? !0 : !1
                }))
            }
        }, CommentPropertyDlg.prototype = {
            setAnnotHandler: function(a) {
                this.annotHandler = a, this.annotUIManager = new WebPDF.Annot.AnnotUIManager(a.annotHandlerManager, WebPDF.Tool.getReaderApp())
            },
            setOptions: function(a) {
                $.extend(this.option, a), a.pageView && (this.pageView = a.pageView)
            },
            render: function(a, b) {
                function c(c, d) {
                    var e, f = c.annot.annotJSONData,
                        g = f.subty,
                        h = f.ty,
                        i = f.subject,
                        j = f.it,
                        k = f.tit,
                        l = (f.areahi, f.cap);
                    if (e = '<div id="fwrCommentPropertyDlg" class="fwr-modal fwr-alert fwr-property" ', e += ' style="top: ' + b + "px;left: " + a + 'px" >', e += '<div class="fwr-modal-header">', e += '<a class="close" webpdf-data-dismiss="modal"></a>', e += '<h4 id="fwrAlertDialogTitle">' + d + "</h4></div>", e += '<div class="fwr-modal-body" style="-moz-opacity:1;opacity:1;">', c.colorArr) {
                        if (e += '<dl class="fwr-choose-color"><dt>' + i18n.t("AnnotProperties.Color") + "</dt><dd>", c.colorArr)
                            for (var m = 0; m < c.colorArr.length; m++) {
                                var n = "";
                                "FreeText" === g && "Callout" !== h ? c.colorArr[m] === c.annot.getFontColor() && (n = " selected") : c.colorArr[m] === c.annot.getColor() && (n = " selected"), c.multiSelect && (n = ""), e += '<span class="span-color ' + n + '"><span style="background-color: ' + c.colorArr[m] + '"></span></span>'
                            }
                        e += "</dd></dl>"
                    }
                    var o, p = 0,
                        q = " hidden",
                        r = " hidden",
                        s = " hidden",
                        t = " hidden",
                        u = "hidden";
                    "Ink" === g && (p = c.annot.getInkBorderWidth(), q = ""), ("Textbox" === h || "Polygon" == g && j && "PolygonCloud" == j) && (o = parseInt(100 * c.annot.getOpacity()), p = c.annot.getBorderWidth(), r = "", s = ""), "Callout" === h && (s = ""), "Highlight" == g && (o = parseInt(100 * c.annot.getOpacity()), r = ""), "Screen" === g && (r = "", t = "", s = " hidden", q = " hidden", o = parseInt(100 * c.annot.getOpacity())), "LineDimension" === j && (u = ""), e += '<ul class="fwr-drag-progress pencil-progress' + q + '"><li><em>' + i18n.t("AnnotProperties.Size") + '</em><span class="wrap-val"><input type="text" value="' + p + '" id="border_width"></span><div class="scale_panel"><div class="scale" id="bar"><div></div><span id="btn"></span></div></div></li></ul>';
                    var v = "";
                    if (c.annot.getFontSize && c.annot.getFontSize()) {
                        var w = [12, 14, 16, 20, 22, 24, 26, 28, 36, 48, 72],
                            x = !0,
                            y = "";
                        w.forEach(function(a) {
                            a === parseInt(c.annot.getFontSize()) ? (y = ' selected="selected"', x = !1) : y = "", v += "<option " + y + ' value="' + a + '">' + a + "</option>"
                        }), x && (v = "<option>" + c.annot.getFontSize() + "</option>" + v)
                    }
                    return e += '<ul class="fwr-bor-bg-color' + s + '"><li><div class="fwr-fill-color"><span>' + i18n.t("AnnotProperties.FillBGColor") + '</span><input id="btnFillColor" /></div><div class="fwr-fill-border"><span>' + i18n.t("AnnotProperties.BorderColor") + '</span><input id="btnBorderColor" /></div><div class="fwr-set-fontsize"><span>' + i18n.t("AnnotProperties.FontSize") + '</span><select id="btnFontSize">' + v + "</select></div></li></ul>", e += ['<div class="fwr-caption ', u, '">', "<label>", '<input type="checkbox" id="showCaption"', l ? "checked" : "", ">", "&nbsp;", i18n.t("AnnotProperties.ShowCaption"), "</label>", "</div>"].join(""), e += '<ul class="fwr-drag-progress opacity-progress' + r + '"><li><em style="">' + i18n.t("AnnotProperties.Opacity") + '</em><span class="wrap-val" style=""><input type="text" value="' + o + '" id="op"> %</span><div class="scale_panel"><div class="scale" id="bar_op"><div></div><span id="btn_op"></span></div></div></li></ul>', e += '<div class="fwr-image-proper' + t + '"><ul><li><em>' + i18n.t("AnnotProperties.Subject") + '</em><input type="text" data-role="subject" value="' + i + '"></li><li><em>' + i18n.t("AnnotProperties.User") + '</em><input type="text" data-role="user" value="' + k + '"></li><li><em>' + i18n.t("AnnotProperties.Rotate") + '</em><select id="btnPropRotate"><option>0</option><option>90</option><option>180</option><option>270</option></select></li></ul></div>', e += c.multiSelect ? '<div style="display:none"><span><input type="checkbox" id="set_default" /></span> ' + i18n.t("AnnotProperties.SetDefault") + "</div>" : '<div><span><input type="checkbox" id="set_default"/></span> ' + i18n.t("AnnotProperties.SetDefault") + "</div>", e += '</div><div class="fwr-modal-footer"><a href="#" id="closeBtn" class="btn" webpdf-data-dismiss="modal">' + i18n.t("AnnotProperties.CloseBtn") + "</a>", e += "</div>", e += "</div>"
                }

                function d(a) {
                    var b, c = a.annot.annotJSONData.subty;
                    if (b = '<div id="fwrCommentPropertyDlg" class="fwrm-property">', b += '<dl class="fwr-choose-color"><dt>' + i18n.t("AnnotProperties.Color") + "</dt><dd>", a.colorArr)
                        for (var d = 0; d < a.colorArr.length; d++) {
                            var e = "";
                            a.colorArr[d] === a.annot.getColor() && (e = " selected"), b += '<span class="span-color' + e + '"><span style="background-color: ' + a.colorArr[d] + '"></span></span>'
                        }
                    b += "</dl>";
                    var f = 0,
                        g = " hidden";
                    return "Ink" === c && (f = a.annot.getInkBorderWidth(), g = ""), b += '<ul class="fwr-drag-progress' + g + '"><li><em>' + i18n.t("AnnotProperties.Size") + '</em> <span class="wrap-val"><input readonly="readonly" class="fwrm-input" type="text" value="' + f + '" id="border_width"></span><div class="scale_panel"><div class="scale" id="bar"><div></div><span id="btn"></span></div></div></li></ul>', a.multiSelect || (b += '<div class="fwrm-set-default"><span><input type="checkbox" id="set_default" /></span>' + i18n.t("AnnotProperties.SetDefault") + "</div>"), b += '<div class="fwrm-triangle"></div>', b += "</div>"
                }

                function e(c, d) {
                    var e = c.annot.annotJSONData,
                        f = e.subty,
                        h = e.ty;
                    if ($("#fwrAlertDialogTitle").html(d), $("#showCaption").prop("checked", !!e.cap), "Ink" === f && $("#border_width").val(c.annot.getInkBorderWidth()), e.it && "PolygonCloud" == e.it && $("#border_width").val(c.annot.getBorderWidth()), "Textbox" === h || "Polygon" == f && e.it && "PolygonCloud" == e.it) {
                        $("#btnFillColor").val(c.annot.getFillColor()), $("#btnBorderColor").val(c.annot.getColor()), $("#op").val(parseInt(100 * c.annot.getOpacity()));
                        var i = "";
                        if (c.annot.getFontSize && c.annot.getFontSize()) {
                            var j = [12, 14, 16, 20, 22, 24, 26, 28, 36, 48, 72],
                                k = !0,
                                l = "";
                            j.forEach(function(a) {
                                a === parseInt(c.annot.getFontSize()) ? (l = ' selected="selected"', k = !1) : l = "", i += "<option " + l + ' value="' + a + '">' + a + "</option>"
                            }), k && (i = "<option>" + c.annot.getFontSize() + "</option>" + i), $("#btnFontSize").html(i)
                        }
                    }
                    if ("Screen" === f) {
                        $("#op").val(parseInt(100 * c.annot.getOpacity()));
                        var m = $("#fwrCommentPropertyDlg");
                        m.find("[data-role=user]").val(c.annot.getTitle()), m.find("[data-role=subject]").val(c.annot.getSubject()), $("#btnPropRotate").val(e.r)
                    }
                    "Highlight" === e.subty && $("#op").val(parseInt(100 * c.annot.getOpacity()));
                    var n = $("#fwrCommentPropertyDlg .span-color span");
                    if (n)
                        for (var o = 0; o < n.length; o++) {
                            var p = "";
                            "FreeText" === f && "Callout" !== h ? c.colorArr[o].toLowerCase() === c.annot.getFontColor().toLowerCase() && (p = " selected") : c.colorArr[o].toLowerCase() === c.annot.getColor().toLowerCase() && (p = " selected"), c.multiSelect && (p = "");
                            var q = $(n[o]).parent();
                            $(q).removeClass("selected"), p && $(q).addClass(p), $(n[o]).css("backgroundColor", c.colorArr[o])
                        }
                    $(g).css("top", b + "px"), $(g).css("left", a + "px"), $("#fwrCommentPropertyDlg .fwr-modal-body").css("-moz-opacity", 1), $("#fwrCommentPropertyDlg .fwr-modal-body").css("opacity", 1), c.multiSelect ? $("#set_default").parent().parent().hide() : $("#set_default").parent().parent().show(), $("#set_default").attr("disabled", !1)
                }
                b -= 100;
                var f;
                if (WebPDF.Tool.getReaderApp().isMobile()) {
                    var g = document.getElementById("fwrCommentPropertyDlg");
                    if (g) {
                        var h = i18n.t("AnnotProperties.Color");
                        e(this.option, h)
                    } else f = d(this.option)
                } else {
                    var g = document.getElementById("fwrCommentPropertyDlg"),
                        h = this.option.multiSelect ? i18n.t("AnnotProperties.AnnotsProperties") : this.option.title;
                    g ? e(this.option, h) : f = c(this.option, h)
                }
                return f
            },
            show: function(a, b, c) {
                var d = this.render(a, b),
                    e = c.annot.annotJSONData;
                if (!d) {
                    var f = $("#fwrCommentPropertyDlg");
                    if (f.is(":hidden") ? $("#fwrCommentPropertyDlg").show() : i = !1, $(".fwr-choose-color").removeClass("hidden"), $(".fwr-caption").addClass("hidden"), $("#showCaption").prop("checked", !!e.cap), $("#set_default").parent().parent().show(), "LineDimension" === e.it && $(".fwr-caption").removeClass("hidden"), "Ink" === e.subty) $(".pencil-progress").removeClass("hidden"), $(".opacity-progress, .fwr-bor-bg-color, .fwr-image-proper").addClass("hidden");
                    else if ("Textbox" === e.ty || e.it && "PolygonCloud" == e.it) $(".fwr-drag-progress, .fwr-image-proper").addClass("hidden"), $(".opacity-progress, .fwr-bor-bg-color").removeClass("hidden"), $(".fwr-set-fontsize").css("display", "inline-block"), $(".fwr-fill-border").css("display", "inline-block"), e.it && "PolygonCloud" == e.it && ($(".fwr-set-fontsize").css("display", "none"), $(".fwr-drag-progress").removeClass("hidden"), $(".fwr-fill-border").css("display", "none"));
                    else if ("Screen" === e.subty) $(".fwr-bor-bg-color, .fwr-drag-progress, .fwr-choose-color").addClass("hidden"), $(".opacity-progress, .fwr-image-proper").removeClass("hidden"), $("#set_default").parent().parent().hide();
                    else if ("Highlight" === e.subty) $(".opacity-progress").removeClass("hidden"), $(".fwr-image-proper, .pencil-progress, .fwr-bor-bg-color").addClass("hidden");
                    else if (e.it && "FreeTextCallout" === e.it) $(".fwr-bor-bg-color").removeClass("hidden"), $(".fwr-fill-border").hide(), $(".fwr-set-fontsize").hide(), $(".opacity-progress").addClass("hidden"), $("#btnFillColor").spectrum("set", c.annot.getFillColor());
                    else switch (e.subty) {
                        case WebPDF.Annot.AnnotType.Square:
                        case WebPDF.Annot.AnnotType.Circle:
                            $(".opacity-progress,.pencil-progress").addClass("hidden"), $(".fwr-bor-bg-color").removeClass("hidden"), $(".fwr-fill-border").hide(), $(".fwr-set-fontsize").hide(), $("#btnFillColor").spectrum("set", c.annot.getFillColor());
                            break;
                        case WebPDF.Annot.AnnotType.Polygon:
                        case WebPDF.Annot.AnnotType.Cloud:
                            $(".fwr-bor-bg-color").removeClass("hidden"), $(".fwr-fill-border").hide(), $(".fwr-set-fontsize").hide(), $("#btnFillColor").spectrum("set", c.annot.getFillColor());
                            break;
                        default:
                            $(".fwr-drag-progress, .fwr-bor-bg-color, .fwr-image-proper").addClass("hidden")
                    }
                    return this.bindEvents(c), this.resetPropertyPositon(a, b), void $("#border_width, #op").trigger("keyup", ["from-show"])
                }
                switch ($("body").append(d), "Screen" === e.subty ? ($(".fwr-choose-color").addClass("hidden"), $("#set_default").parent().parent().hide()) : $("#set_default").parent().parent().show(), e.it && "FreeTextCallout" === e.it && ($(".fwr-set-fontsize").css("display", "none"), $(".fwr-fill-border").css("display", "none")), e.it && "PolygonCloud" == e.it && ($(".fwr-set-fontsize").css("display", "none"), $(".fwr-drag-progress").removeClass("hidden"), $(".fwr-fill-border").css("display", "none")), e.subty) {
                    case WebPDF.Annot.AnnotType.Square:
                    case WebPDF.Annot.AnnotType.Polygon:
                    case WebPDF.Annot.AnnotType.Circle:
                    case WebPDF.Annot.AnnotType.Cloud:
                        $(".fwr-bor-bg-color").removeClass("hidden"), $(".fwr-fill-border").hide(), $(".fwr-set-fontsize").hide(), $("#btnFillColor").spectrum("set", c.annot.getFillColor())
                }
                $("#fwrCommentPropertyDlg").draggable({
                    containment: "#docViewer"
                }), this.bindEvents(c), this.resetPropertyPositon(a, b), $("#border_width, #op").trigger("keyup", ["from-show"])
            },
            onClosePop: function(a) {
                var b = $("#set_default").get(0);
                d(b, this.pageView, this.option.annot, this.eventType, this.option.drawingConfig);
                var c = $("#fwrCommentPropertyDlg");
                c.get(0) && (c.hide(), $("#set_default").attr("checked", !1), $("#set_default").parent().removeClass("fwrm-set-default-checked"), g = !1)
            },
            onUpdateRotate: function(a) {
                var b = this.option.annot;
                this.annotHandler.annotHandlerManager.setAnnotModified(b, this.pageView), this.annotHandler.annotHandlerManager.setSelectionRotate(a)
            },
            onSelectColor: function(a) {
                $(a).addClass("selected").siblings().removeClass("selected");
                var b = $(a).children().css("backgroundColor");
                j = b, h = !0;
                var c = this.option.annot;
                this.annotHandler.annotHandlerManager.setAnnotModified(c, this.pageView), this.annotHandler.annotHandlerManager.setSelectAnnotColor(this.pageView, b)
            },
            onSelectLineWidth: function(a, b, c) {
                var d = this.option.annot;
                this.annotHandler.annotHandlerManager.setAnnotModified(d, this.pageView), this.annotHandler.annotHandlerManager.setSelectAnnotLineBorder(this.pageView, a, b, c)
            },
            onSetDefaultColor: function(a) {
                return d(a, this.pageView, this.option.annot, this.eventType, this.option.subDrawingConfig ? this.option.subDrawingConfig : this.option.drawingConfig)
            },
            onUpdateSubject: function(a) {
                this._updateAnnotJSONData(WebPDF.Annot.AnnotDataJSONFormat.subject, a)
            },
            onUpdateCaption: function(a) {
                this._updateAnnotJSONData(WebPDF.Annot.AnnotDataJSONFormat.cap, a)
            },
            onUpdateUserName: function(a) {
                this._updateAnnotJSONData(WebPDF.Annot.AnnotDataJSONFormat.title, a)
            },
            _updateAnnotJSONData: function(a, b) {
                var c = this.option.annot,
                    d = c.annotJSONData[a];
                if (b !== d) {
                    var e = $.extend({}, c.annotJSONData);
                    e[a] = b, h = !0;
                    var f = this.pageView,
                        g = f.getPageIndex(),
                        i = c.getAnnotName(),
                        j = WebPDF.Annot.AnnotFactory.createAnnot(e, g, !1);
                    this.annotHandler.annotHandlerManager.updateAnnot(i, j, f, !0), c.annotJSONData[a] = b
                }
            },
            disabledDlg: function() {
                $("#fwrCommentPropertyDlg .fwr-modal-body").css("-moz-opacity", .4), $("#fwrCommentPropertyDlg .fwr-modal-body").css("opacity", .4), $("#set_default").attr("disabled", !0), $("#fwrCommentPropertyDlg .span-color").removeClass("selected")
            },
            resetPropertyPositon: function(a, b) {
                var c, d = this.annotUIManager.getAnnotDivID(this.option.pageView, this.option.annot.getAnnotName()),
                    e = $("#fwrCommentPropertyDlg"),
                    f = $(window).height(),
                    g = $(window).width(),
                    h = e.outerHeight(),
                    i = e.outerWidth(),
                    j = $("#" + d).height(),
                    k = b,
                    l = a;
                if (WebPDF.Tool.getReaderApp().isMobile()) {
                    var m = e.find(".fwrm-triangle");
                    if (l > i ? (c = l - i, e.css("left", c), m.css("right", 10)) : (l -= 40, m.css("left", l), e.css("left", 10)), m.removeClass("up down"), h + j > k && f - k > h) e.css("top", k), m.addClass("up");
                    else if (k >= h + j) k = k - h - j, e.css("top", k), m.addClass("down");
                    else {
                        var n = h - (f - k),
                            o = this.option.pageView.getDocView().getScrollApi(),
                            p = o.getContentPositionY();
                        p = n + p, o.scrollTo(0, p), k -= n, m.addClass("up"), e.css("top", k)
                    }
                } else l + i > g && (c = g - i, e.css("left", c))
            }
        };
        var k = function(a, b, c, d, e, f, g) {
            this.btn = document.getElementById(a), this.bar = document.getElementById(b), this.title = document.getElementById(c), this.step = this.bar && this.bar.getElementsByTagName("div")[0], this.init(), this.historyVal = 3, this.commentPropertyDlg = d, this.minVal = null == e ? 1 : e, this.maxVal = f || 11, this.setProperty = g
        };
        return k.prototype = {
            init: function() {
                var a = this;
                if (a.btn) {
                    var b = "onmousedown",
                        c = "onmousemove",
                        d = "onmouseup";
                    WebPDF.Tool.getReaderApp().isMobile() && (b = "ontouchstart", c = "ontouchmove", d = "ontouchend"), a.btn[b] = function(b) {
                        function e(b, c, d, e, f) {
                            var g = (b || window.event).clientX || b.changedTouches[0].clientX,
                                h = Math.min(e, Math.max(-2, d + (g - c)));
                            a.btn.style.left = h + "px", a.ondrag(Math.round(100 * Math.max(0, h / e)), h, f), window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty(), preventDefaults(b)
                        }
                        var f = !0,
                            g = (b || window.event).clientX || b.touches[0].clientX,
                            h = this.offsetLeft,
                            i = a.bar.offsetWidth - this.offsetWidth;
                        document[c] = function(a) {
                            e(a, g, h, i, !0)
                        }, "onmouseup" === d ? document.onmouseup = function(a) {
                            f && (e(a, g, h, i), this.onmousemove = null, f = !1)
                        } : document.ontouchend = new Function("this.ontouchmove=null"), preventDefaults(b)
                    }
                }
            },
            ondrag: function(a, b, c) {
                var d = this.minVal + parseInt(Math.floor(a / 100 * this.maxVal));
                c && d === this.historyVal || (this.title.value = d, this.historyVal = d, this.commentPropertyDlg.onSelectLineWidth(d, this.setProperty, c))
            },
            setPosInBar: function(a) {
                var b = $(this.bar).outerWidth() - $(this.btn).outerWidth();
                a > b && (a = b), 0 >= a && (a = -2), this.btn.style.left = a + "px"
            }
        }, CommentPropertyDlg
    }), define("core/Plugins/Annot/LinkAnnotHandler", [], function(a, b, c) {
        return WebPDF.LinkAnnotHandler = function(a, b) {
            this.readerApp = a, this.annotHandlerManager = b
        }, WebPDF.LinkAnnotHandler.prototype = {
            getType: function() {
                return "Link"
            },
            canAnswer: function(a, b) {
                var c = this.readerApp.getCurToolHandler();
                if (c) {
                    var d = c.getName();
                    if (d === WebPDF.Tools.TOOL_NAME_HAND) return !0
                }
                return !1
            },
            canMove: function(a) {
                return !1
            },
            moveAnnot: function(a, b, c, d, e, f) {
                return !1
            },
            deleteAnnot: function(a, b) {},
            onDraw: function(a, b, c, d) {},
            onSelected: function(a, b) {},
            onDeSelected: function(a, b) {},
            addCursor: function(a, b, c) {
                var d = a.getAnnotDivID(b, c.getAnnotName()),
                    e = $("#" + d);
                e.css("cursor", "pointer")
            },
            removeCursor: function(a, b, c) {
                var d = a.getAnnotDivID(b, c.getAnnotName()),
                    e = $("#" + d);
                e.css("cursor", "")
            },
            onFocus: function(a, b) {},
            onLButtonDown: function(a, b, c) {},
            onLButtonUp: function(a, b, c) {
                var d = b.getAction();
                if (null != d) switch (d.getActionType()) {
                    case "GoTo":
                        var e = d.getPDFDestination();
                        if (null != e) return a.getDocView().gotoPageByDestination(e), !1;
                        break;
                    case "URI":
                        var f = c.target.getAttribute("link-uri");
                        f && window.open(f)
                } else {
                    var e = d.getPDFDestination();
                    if (null != e) return a.getDocView().gotoPageByDestination(e), !1
                }
                return !1
            },
            onLButtonDblClk: function(a, b, c) {},
            onMouseOver: function(a, b, c) {},
            onMouseLeave: function(a, b, c) {},
            onUpdatePosition: function(a, b, c) {
                var d = (a.getPDFPage(), b.getRect()),
                    e = a.pdfRectToDevice(d, !0),
                    f = this.annotHandlerManager.getUIManager(),
                    g = f.getAnnotDivID(a, b.getAnnotName());
                $("#" + g).css({
                    left: e.left,
                    top: e.top,
                    width: WebPDF.RectUtils.width(e),
                    height: WebPDF.RectUtils.height(e)
                })
            }
        }, WebPDF.LinkAnnotHandler
    }), define("core/Plugins/Annot/TextAnnotHandler", ["core/Plugins/Annot/TextAnnotView", "core/Plugins/Annot/TextAnnotService"], function(a, b, c) {
        var d = null,
            e = null;
        return WebPDF.TextAnnotHandler = function(b, c) {
            this.readerApp = b, this.annotHandlerManager = c, d = a("core/Plugins/Annot/TextAnnotView").createTextAnnotView(b, c.getUIManager()), e = a("core/Plugins/Annot/TextAnnotService").createTextAnnotService(b)
        }, WebPDF.TextAnnotHandler.prototype = {
            getType: function() {
                return "Text"
            },
            canAnswer: function(a, b) {
                return e.canAnswer(b)
            },
            canMove: function(a) {
                return !0
            },
            moveAnnot: function(a, b, c, f, g, h) {
                d.moveAnnot(a, b, c, f, g, h), e.addAnnotRecord(a.getPageIndex(), b, "Edit")
            },
            deleteAnnot: function(a, b) {
                d.deleteAnnot(a, b), e.deleteAnnot(a, b)
            },
            onDraw: function(a, b, c, d) {},
            onSelected: function(a, b) {
                return d.selectAnnot(a, b), !0
            },
            onDeSelected: function(a, b) {
                return d.unSelectAnnot(a, b), !0
            },
            onFocus: function(a, b) {},
            onLButtonDown: function(a, b, c) {
                return this.onSelected(a, b)
            },
            onLButtonUp: function(a, b, c) {},
            onLButtonDblClk: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onLButtonDblClk(a, b, c)
            },
            onMouseOver: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseOver(a, b, c)
            },
            onMouseLeave: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseLeave(a, b, c)
            },
            onUpdatePosition: function(a, b, c) {
                d.updatePosition(a, b)
            }
        }, WebPDF.TextAnnotHandler
    }), define("core/Plugins/Annot/TextAnnotView", [], function(a, b, c) {
        function d(a, b) {
            e = a, f = b
        }
        var e = null,
            f = null;
        d.prototype = {
            activate: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (b.addClass("fwr-note-cursor-ie"), b.css("cursor", "crosshair")) : b.addClass("fwr-note-cursor")
            },
            deactivate: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-note-cursor-ie") : b.removeClass("fwr-note-cursor")
            },
            moveAnnot: function(a, b, c, d, e, g) {
                var h = b.getAnnotName(),
                    i = f.getAnnotDivID(a, h),
                    j = $("#" + i);
                j.css({
                    left: e + "px",
                    top: g + "px"
                });
                var k = f.getTextAnnotDivID(a, h),
                    l = $("#" + k);
                l.css({
                    left: e + "px",
                    top: g + "px"
                })
            },
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = f.getAnnotDivID(a, c);
                $("#" + d).remove();
                var e = f.getTextAnnotDivID(a, c);
                $("#" + e).remove();
                var g = b.getPopup();
                if (null != g && null == b.getHeadAnnot()) {
                    var h = f.getAnnotPopupDivID(a, c);
                    $("#" + h).remove()
                }
            },
            selectAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = f.getAnnotDivID(a, c),
                    e = f.getTextAnnotDivID(a, c);
                $("#" + d).addClass("fwr-annot-selected"), $("#" + e).addClass("fwr-annot-image-selected")
            },
            unSelectAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = f.getAnnotDivID(a, c),
                    e = f.getTextAnnotDivID(a, c);
                $("#" + d).removeClass("fwr-annot-selected"), $("#" + e).removeClass("fwr-annot-image-selected")
            },
            updatePosition: function(a, b) {
                var c = b.getRect(),
                    d = a.pdfRectToDevice(c, !0),
                    e = f.getTextAnnotDivID(a, b.getAnnotName()),
                    g = f.getAnnotDivID(a, b.getAnnotName()),
                    h = $("#" + g);
                h.css({
                    left: d.left,
                    top: d.top,
                    width: WebPDF.RectUtils.width(d),
                    height: WebPDF.RectUtils.height(d)
                }), $("#" + e).css({
                    left: d.left,
                    top: d.top,
                    width: WebPDF.RectUtils.width(d),
                    height: WebPDF.RectUtils.height(d)
                })
            }
        }, b.createTextAnnotView = function(a, b) {
            return new d(a, b)
        }
    }), define("core/Plugins/Annot/TextAnnotService", [], function(a, b, c) {
        function d(a, b) {
            l = a, k = b
        }
        var e = WebPDF.Annot.AnnotFactory,
            f = 1,
            g = WebPDF.Annot.MKA_POPUPWIDTH,
            h = WebPDF.Annot.MKA_POPUPHEIGHT,
            i = 20,
            j = 20,
            k = null,
            l = null;
        d.prototype = {
            isTextAnnot: function(a) {
                return a && "Markup" === a.getType() && "Text" === a.getSubType() ? !1 : !0
            },
            getPageViewByPos: function(a, b) {
                for (var c = l.getDocView(), d = c.getVisiblePageRange(), e = null, f = null, g = d.begin; g <= d.end; g++) {
                    var h = c.getPageView(g),
                        f = h.getPageViewRect();
                    if (WebPDF.RectUtils.ptInRect(f, a, b)) {
                        e = h;
                        break
                    }
                }
                return e
            },
            canAnswer: function(a) {
                var b = l.getCurToolHandler();
                if (null != b) {
                    var c = b.getName();
                    if (c === WebPDF.Tools.TOOL_NAME_SELANNOT || c === WebPDF.Tools.TOOL_NAME_HAND || c === WebPDF.Tools.TOOL_NAME_TEXTANNOT) return !0;
                    if (void 0 != a && a && c === WebPDF.TOOL_NAME_SELECTTEXT) return !0
                }
                return !1
            },
            addAnnot: function(a, b, c, d) {
                var e = l.getMainView().getDocView();
                WebPDF.Common.preventDefaults(d, !0);
                var f = this.createAnnot(a, b, c),
                    g = [];
                g.push(f.annotJSONData);
                var h = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, g);
                return l.addAnnotUndo(h), e.setModified(!0), f
            },
            createAnnot: function(a, b, c) {
                var d = new Date,
                    m = d.valueOf(),
                    n = Math.floor(m / 1e3).toString(),
                    o = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                    p = {
                        c: "",
                        ca: f,
                        cd: n,
                        cl: "#ffff00",
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: n,
                        n: null,
                        pop: null,
                        subj: i18n.t("Annot.AnnotSubjNote"),
                        subty: "Text",
                        tit: o,
                        ty: "Markup",
                        Quad: [],
                        txtn: "Comment",
                        r: 90 * a.getPDFPage().getPageRotate() + a.getDocView().getRotate(),
                        rc: null,
                        pdf: "false",
                        del: 0
                    },
                    q = a.getPDFPage(),
                    r = q.getPageWidth(),
                    s = q.getPageHeight(),
                    t = new WebPDF.PDFPoint(b, c);
                t = a.devicePtToPDF(t);
                var u = i / 2,
                    v = j / 2,
                    w = new WebPDF.PDFRect(t.x - u, t.y + v, t.x + u, t.y - v);
                w.left < 0 && WebPDF.RectUtils.offset(w, 0 - w.left, 0), w.bottom < 0 && WebPDF.RectUtils.offset(w, 0, 0 - w.bottom), w.right > r && WebPDF.RectUtils.offset(w, r - w.right, 0), w.top > s && WebPDF.RectUtils.offset(w, 0, s - w.top), p.rc = [w.left, w.top, w.right, w.bottom];
                var x = new WebPDF.PDFRect(0, 0, 0, 0);
                x.top = w.top;
                var y = a.getDocView().getPageViewRender().getPixelsPerPoint(),
                    z = a.getDocView().getScale();
                90 == a.getDocView().getRotate() || 270 == a.getDocView().getRotate() ? x.left = (a.getPageViewHeight() - g * y) / (z * y) : x.left = (a.getPageViewWidth() - g * y) / (z * y), x.right = x.left + g, x.bottom = x.top - h, x.bottom < 0 && WebPDF.RectUtils.offset(x, 0, -x.bottom), p.pop = {
                    f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                    md: n,
                    n: n + "_popup",
                    op: 1,
                    rc: [x.left, x.top, x.right, x.bottom]
                };
                var A = e.createAnnot(p, q.getPageIndex(), !1);
                q.getAnnotJsonData().push(p), q.addAnnot(A), a.setModified(!0);
                var B = k.getAnnotHandlerMgr().getUIManager().getPageAnnotsContainerID(a),
                    C = $("#" + B),
                    D = A.getAnnotName(),
                    E = k.getAnnotHandlerMgr().getUIManager().createAAnnotHtmlContent(a, A, D, 1, !0);
                C.append(E);
                var F = $("#" + a.getDocView().getDocViewContainerID()),
                    G = F.height(),
                    H = F.width(),
                    I = F.offset(),
                    J = k.getAnnotHandlerMgr().getAnnotVisibleRect(a, I, H, G);
                return k.getAnnotHandlerMgr().updateAnnotsPosition(a, J, A),
                    k.getAnnotHandlerMgr().setFocusAnnot(a, A), l.isMobile() && k.getAnnotHandlerMgr().setPopupFocus(a, A), $(l).trigger(WebPDF.EventList.ANNOT_ADDED, {
                        pageIndex: q.getPageIndex(),
                        annot: k.getAnnotHandlerMgr().packageAnnot(A),
                        annotObject: A
                    }), $(l).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                        annotName: A.getAnnotName(),
                        pageIndex: q.getPageIndex()
                    }), A
            },
            addAnnotRecord: function(a, b, c) {
                var d = "[" + b.getRect().left + " " + b.getRect().top + " " + b.getRect().right + " " + b.getRect().bottom + "]",
                    e = '{"Type":"' + b.getSubType() + '", "ActionType":"' + c + '", "PageIndex":"' + a + '", "Rect":"' + d + '"}';
                l.addRecord("Comment", "Comment", e)
            },
            deleteAnnot: function(a, b) {
                b.getAnnotName()
            }
        }, b.createTextAnnotService = function(a, b) {
            var c = new d(a, b);
            return c
        }
    }), define("core/Plugins/Annot/TypewriterAnnotHandler", ["core/Plugins/Annot/TypewriterAnnotView", "core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/TypewriterAnnotService"], function(a, b, c) {
        var d, e, f;
        WebPDF.PDFRect, WebPDF.RectUtils;
        return WebPDF.TypewriterAnnotHandler = function(b, c, g) {
            this.readerApp = b, this.annotType = c, this.annotHandlerManager = g, this.annotUIManager = g.getUIManager(), e = a("core/Plugins/Annot/TypewriterAnnotView").createTypewriterAnnotView(g, b), f = a("core/Plugins/Annot/TypewriterAnnotService").createTypewriterAnnotService(g, b);
            var h = WebPDF.AccountInstance.getUserConfig(),
                i = ["#3366cc", "#669933", "#cc6600", "#cc9900", "#a3a305", "#cc0000", "#336666", "#660066", "#000000", "#8f8e8e"],
                j = {
                    title: i18n.t("AnnotProperties.TypeWriterTitle"),
                    colorArr: i,
                    drawingConfig: h.annot.typeWriter
                };
            this.commentPropertyDlg = new CommentPropertyDlg(null, null, j), this.commentPropertyDlg.setAnnotHandler(this), this.init(), d = this
        }, WebPDF.TypewriterAnnotHandler.prototype = {
            getType: function() {
                return this.annotType
            },
            canAnswer: function(a) {
                return f.canAnswer(a, this.annotType) ? !0 : !1
            },
            canMove: function(a) {
                return !0
            },
            isTypewritersType: function(a) {
                return f.isTypewritersType(a)
            },
            moveAnnot: function(a, b, c, d, g, h) {
                e.moveAnnot(a, b, c, d, g, h), f.moveAnnotRecord(a, b)
            },
            deleteAnnot: function(a, b) {
                e.deleteAnnot(a, b)
            },
            setAnnotProperty: function(a, b, c, d) {
                var e = WebPDF.Common.getReaderApp();
                if (e.isEditable()) {
                    var f = {
                        annot: b,
                        event: c,
                        multiSelect: d,
                        pageView: a
                    };
                    this.commentPropertyDlg.setOptions(f), this.commentPropertyDlg.show(c.pageX, c.pageY, f)
                }
            },
            setAnnotColor: function(a, b, c) {
                e.setAnnotColor(a, b.getAnnotName(), c), f.setAnnotColor(a, b, c)
            },
            onDraw: function(a, b, c, d) {
                e.onDraw(a, b)
            },
            onSelected: function(a, b) {
                return e.onSelected(a, b), !0
            },
            onDeSelected: function(a, b) {
                return e.onDeSelected(a, b), this.commentPropertyDlg.disabledDlg(), !0
            },
            onFocus: function(a, b) {},
            onLButtonDown: function(a, b, c) {
                return this.onSelected(a, b)
            },
            onLButtonDblClk: function(a, b, c) {
                return b.isReadOnly() || (e.onTypewriterAnnotEdit(a, b), c.preventDefault()), !1
            },
            onMouseOver: function(a, b, c) {},
            onMouseLeave: function(a, b, c) {},
            onUpdatePosition: function(a, b, c) {
                e.onUpdatePosition(a, b, c)
            },
            init: function() {
                e.editTypewriteForBlur(), e.editTypewriteForKeyup(), e.editTypewriteForFocus()
            },
            resizeTextArea: function(a, b) {
                e.onDraw(a, b, !0), e.resizeTextArea()
            }
        }, WebPDF.TypewriterAnnotHandler
    }), define("core/Plugins/Annot/TypewriterAnnotView", ["core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        function d(a, b) {
            h = b, i = $("#" + h.getAppId()), l = new WebPDF.Annot.AnnotUIManager(a, h), k = a, j = this
        }

        function e(a, b) {
            return Math.abs(parseFloat(a) - parseFloat(b)) <= 1
        }

        function f(a, b) {
            return e(a.left, b.left) && e(a.right, b.right) && e(a.top, b.top) && e(a.bottom, b.bottom)
        }
        a("core/Plugins/Annot/AnnotUIManager");
        var g, h, i, j, k, l, m = WebPDF.PDFRect,
            n = WebPDF.RectUtils;
        d.prototype = {
            containsJQDocView: function(a) {
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                return WebPDF.Common.containsNode(c.get(0), a.target, !0) ? void 0 : !1
            },
            onLButtonInPage: function(a) {
                for (var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(), c = b.getVisiblePageRange(), d = null, e = null, f = c.begin; f <= c.end; f++) {
                    var g = b.getPageView(f),
                        h = $("#" + g.getPageViewContainerID()).offset(),
                        i = g.getPageViewWidth(),
                        j = g.getPageViewHeight();
                    if (e = new WebPDF.PDFRect(h.left, h.top, h.left + i, h.top + j), WebPDF.RectUtils.normalize(e), WebPDF.RectUtils.ptInRect(e, a.pageX, a.pageY)) {
                        d = g;
                        break
                    }
                }
                return d ? {
                    pageView: d,
                    pageViewRect: e
                } : !1
            },
            setAnnotColor: function(a, b, c) {
                var d = l.getTypewriterAnnotDivID(a, b),
                    e = $("#" + d);
                e.find("textarea").css("color", c)
            },
            onDraw: function(a, b) {
                if (null != b && null != a && b.isVisible() && b.getType() == WebPDF.Annot.AnnotType.TypeWriter) {
                    this.currentPageIndex = a.getPageIndex(), this.currentAnnotName = b.getAnnotName();
                    var c = $("#" + l.getTypewriterAnnotRectDivID(a, this.currentAnnotName));
                    c.data("before", c.val())
                }
            },
            onSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).addClass("fwr-annot-selected")
            },
            onDeSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).removeClass("fwr-annot-selected");
                var e = $("#" + l.getTypewriterAnnotRectDivID(a, c)),
                    f = e.data("before"),
                    g = e.val();
                if (f != g) {
                    var i = {
                        name: c,
                        oldContents: f,
                        newContents: g
                    };
                    h.addAnnotUndo(i)
                }
                h.clearAnnotUndo(!0), h.setAnnotContentEdit(!1)
            },
            addTypewriteCursor: function() {
                var a = h.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (b.addClass("fwr-typewriter-cursor-ie"), b.css("cursor", "text")) : b.addClass("fwr-typewriter-cursor")
            },
            removeTypewriteCursor: function() {
                var a = h.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-typewriter-cursor-ie") : b.removeClass("fwr-typewriter-cursor")
            },
            createAnnot: function(a, b, c, d) {
                var e = a.getUIManager().getPageAnnotsContainerID(b),
                    f = $("#" + e),
                    g = c.getAnnotName(),
                    i = a.getUIManager().createAAnnotHtmlContent(b, c, g, 1, !1);
                f.append(i), $(h).trigger(WebPDF.EventList.ANNOT_ADDED, {
                    pageIndex: d.getPageIndex(),
                    annot: a.packageAnnot(c),
                    annotObject: c
                }), $(h).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                    annotName: c.getAnnotName(),
                    pageIndex: d.getPageIndex()
                })
            },
            editTypewriteForKeyup: function() {
                var a = !1;
                i.off("compositionstart", ".fwr-typewriter-annot-edit").on("compositionstart", ".fwr-typewriter-annot-edit", function(b) {
                    a = !0
                }), i.off("compositionend", ".fwr-typewriter-annot-edit").on("compositionend", ".fwr-typewriter-annot-edit", function(b) {
                    a = !1
                }), i.off("keyup", ".fwr-typewriter-annot-edit").on("keyup", ".fwr-typewriter-annot-edit", function(b) {
                    var c = $("#docViewer_ViewContainer .fwrJspContainer")[0] || $("#docViewer_ViewContainer .fwrJspContainer-ie")[0],
                        d = h.getMainFrameId(),
                        e = $("#" + d).offset().top;
                    if (!h.isMobile() && c[0] && c.offset().top !== e && c.offset({
                            top: e
                        }), !a && (89 != b.keyCode && 90 != b.keyCode || !b.ctrlKey) && 17 != b.keyCode) {
                        var f = $(this);
                        return k.addFreeTextUndo(f, null, j.currentPageIndex, j.currentAnnotName, !0)
                    }
                }), i.off("paste", ".fwr-callout-annot-edit").on("paste", ".fwr-callout-annot-edit", function(a) {
                    var b = $(this);
                    k.addFreeTextUndo(b, null, j.currentPageIndex, j.currentAnnotName, !0)
                })
            },
            editTypewriteForFocus: function() {
                i.off("focus", ".fwr-typewriter-annot-nor").on("focus", ".fwr-typewriter-annot-nor", function(a) {
                    var b = $(this),
                        c = $("#" + l.getAnnotDivIDFromTypewriterAnnotRectDivID(b.attr("id")));
                    j.currentPageIndex = parseInt(c.attr("page-index")), j.currentAnnotName = c.attr("annot-name"), j.originContents = b.val(), j._spellCheck(1), j._setTextareaCursorPosition(b.get(0), b.val().length), j._addAndRemoveChangeValueEvent(b.get(0), !0), WebPDF.Environment.webkit || $("#" + l.getAnnotDivIDFromTypewriterAnnotRectDivID(b.attr("id"))).removeClass("fwr-annot-selected").addClass("fwr-typewriter-annot-edit-border"), b.removeClass("fwr-typewriter-annot-nor").addClass("fwr-typewriter-annot-edit")
                })
            },
            editTypewriteForBlur: function() {
                var a = $("#" + h.getAppId());
                a.off("blur", ".fwr-typewriter-annot-edit").on("blur", ".fwr-typewriter-annot-edit", function(a) {
                    var b = h.getMainView().getDocView(),
                        c = $(this);
                    if ("undefined" == typeof j.currentAnnotName || "undefined" == typeof j.currentPageIndex) return console.log("error in typewriter blur"), !0;
                    j._addAndRemoveChangeValueEvent(c.get(0), !1);
                    var d = b.getPageView(j.currentPageIndex),
                        e = d.getPDFPage(),
                        f = e.getAnnotByName(j.currentAnnotName);
                    if (!f) return !0;
                    WebPDF.Environment.webkit || $("#" + l.getAnnotDivIDFromTypewriterAnnotRectDivID(c.attr("id"))).removeClass("fwr-typewriter-annot-edit-border"), c.removeClass("fwr-typewriter-annot-edit").addClass("fwr-typewriter-annot-nor");
                    $("#" + l.getAnnotDivIDFromTypewriterAnnotRectDivID(c.attr("id")));
                    if (j._spellCheck(0), !f || c.val() == j.originContents && c.val() == f.getContents() || (k.addFreeTextUndo(c, f, j.currentPageIndex), f.setContents(c.val()), d.setModified(!0), b.setModified(!0)), h.setAnnotContentEdit(!1), h.clearAnnotUndo(!0), delete j.currentAnnotName, delete j.currentPageIndex, WebPDF.Environment.iOS && WebPDF.Environment.mobile) {
                        var g = $("body").scrollTop();
                        0 != g && $("body").scrollTop(0)
                    }
                    return $(h).trigger(WebPDF.EventList.ANNOT_UPDATED, {
                        annot: k.packageAnnot(f),
                        pageIndex: d.getPageIndex(),
                        annotObject: f
                    }), !0
                })
            },
            onTypewriterAnnotEdit: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getTypewriterAnnotRectDivID(a, c),
                    e = l.getAnnotDivID(a, c),
                    f = $("#" + d),
                    g = h.getDocView(),
                    i = g.getScrollApi();
                if (null != i) {
                    var j = $("#" + e),
                        k = new m,
                        o = new m;
                    k.left = Math.max(0, parseFloat(j.css("left"))), k.top = Math.max(0, parseFloat(j.css("top"))), k.right = k.left + parseFloat(j.css("width")), k.bottom = k.top + parseFloat(j.css("height")), n.copy(k, o), o = a.PageRotateToScreen(o, g.getRotate());
                    var p = $("#" + g.getDocViewContainerID()),
                        q = p.height(),
                        r = p.offset(),
                        s = $("#" + a.getPageViewContainerID()),
                        t = s.offset();
                    return q -= i.getScrollBarHeight(), r.top + q <= t.top + o.bottom && i.scrollByY(t.top + o.bottom - r.top - q + 5), WebPDF.Environment.mobile ? (WebPDF.Environment.iOS ? setTimeout(function() {
                        f.focus()
                    }, 0) : f.focus(), !1) : void(WebPDF.Environment.ie8OrLower ? setTimeout(function() {
                        f.focus()
                    }, 0) : f.focus())
                }
            },
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).remove();
                var e = l.getTypewriterAnnotDivID(a, c);
                $("#" + e).remove()
            },
            moveAnnot: function(a, b, c, d, e, f) {
                var g = b.getAnnotName(),
                    h = $("#" + l.getAnnotDivID(a, g));
                h.css({
                    left: e + "px",
                    top: f + "px"
                });
                var i = $("#" + l.getTypewriterAnnotDivID(a, g));
                i.css({
                    left: e + "px",
                    top: f + "px"
                })
            },
            onUpdatePosition: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = a.pdfRectToDevice(b.getRect(), !0),
                    f = $("#" + l.getAnnotDivID(a, d)),
                    g = $("#" + l.getTypewriterAnnotDivID(a, d)),
                    i = $("#" + l.getTypewriterAnnotRectDivID(a, d)),
                    j = e.left,
                    k = e.top,
                    m = a.getPDFPage(),
                    o = (90 * m.getPageRotate() % 360 + 360) % 360,
                    p = (b.getRotate() % 360 + 360) % 360,
                    q = o - p,
                    r = h.getPixelsPerPoint(),
                    s = r * a.getScale(),
                    t = b.getFontSize() * s;
                WebPDF.Engine.JR && (t /= s), i.css("fontSize", t + "px");
                var u = n.width(e),
                    v = b.getLineHeight(),
                    w = v * s;
                i.css("line-height", w + "px");
                var x = n.height(e),
                    y = u,
                    z = x,
                    A = "";
                if (0 != q) switch (q) {
                    case -90:
                    case 270:
                        y = x, z = u, A = "rotate(270deg) translateX(" + -(y + .05) + "px)";
                        break;
                    case -270:
                    case 90:
                        y = x, z = u, A = "rotate(90deg) translateY(" + -(z + .05) + "px)";
                        break;
                    case -180:
                    case 180:
                        A = "rotate(180deg)"
                }
                if (g.css({
                        left: j + "px",
                        top: k + "px",
                        width: u + "px",
                        height: x + "px"
                    }), f.css({
                        left: j + "px",
                        top: k + "px",
                        width: u + .2 * b.getFontSize() + "px",
                        height: x + "px"
                    }), i.css({
                        "-webkit-transform": A,
                        "-moz-transform": A,
                        "-o-transform": A,
                        "-ms-transform": A,
                        transform: A,
                        width: y + .2 * b.getFontSize() + .05 + "px",
                        height: z + .05 + "px"
                    }), 12 > t) {
                    var B = t / 12;
                    if (WebPDF.Environment.chrome) {
                        var C = "scale(" + B + ")";
                        "" != A ? A += C : A = C, i.css({
                            "-webkit-transform": A,
                            "-moz-transform": A,
                            "-o-transform": A,
                            "-ms-transform": A,
                            transform: A,
                            width: y + y * (1 - B) + "px",
                            height: z + z * (1 - B) + "px"
                        }), f.css({
                            "-webkit-transform": A,
                            "-moz-transform": A,
                            "-o-transform": A,
                            "-ms-transform": A,
                            transform: A
                        })
                    }
                }
            },
            resizeTextArea: function() {
                this._spellCheck(0)
            },
            _spellCheck: function(a) {
                var b = this.currentPageIndex,
                    c = this.currentAnnotName;
                if ("undefined" != typeof b && "undefined" != typeof c) {
                    var d = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                        g = d.getPageView(b),
                        i = $("#" + l.getTypewriterAnnotRectDivID(g, c)),
                        j = i.parent(),
                        k = $("#" + l.getAnnotDivID(g, c)),
                        o = g.getPDFPage(),
                        p = o.getAnnotByName(c);
                    if (p) {
                        var q = h.getPixelsPerPoint(),
                            r = q * g.getScale(),
                            s = (90 * o.getPageRotate() % 360 + 360) % 360,
                            t = (p.getRotate() % 360 + 360) % 360,
                            u = s - t,
                            v = 0,
                            w = 0;
                        90 == d.getRotate() || 270 == d.getRotate() ? (v = g.getPageViewHeight(), w = g.getPageViewWidth()) : (v = g.getPageViewWidth(), w = g.getPageViewHeight());
                        var x = new m,
                            y = new m;
                        x.left = Math.max(0, parseFloat(k.css("left"))), x.top = Math.max(0, parseFloat(k.css("top"))), x.right = x.left + parseFloat(k.css("width")), x.bottom = x.top + parseFloat(k.css("height")), n.copy(x, y), ("undefined" == typeof a || isNaN(a)) && (a = 1);
                        var z = a * parseFloat(i.css("font-size")),
                            A = this._calActualWidth(i) + z,
                            B = n.width(y);
                        (90 == u || 270 == u || -90 == u || -270 == u) && (B = n.height(y));
                        var C = A - B,
                            D = A;
                        if (!e(C, 0)) switch (p.getTextAlign()) {
                            case WebPDF.Annot.TypeWriterTextAlignStyle.CENTERED:
                                var E = C / 2;
                                switch (u) {
                                    case 0:
                                    case 180:
                                        E = Math.min(E, y.left), E = Math.min(E, v - y.right), y.left -= E, y.right += E, D = y.right - y.left;
                                        break;
                                    case 90:
                                    case 270:
                                        E = Math.min(E, w - y.bottom), E = Math.min(E, y.top), y.bottom += E, y.top -= E, D = y.bottom - y.top
                                }
                                break;
                            case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                switch (u) {
                                    case 0:
                                        y.left = y.left - C, y.left < 0 && (y.left = 0, y.right = Math.min(v, y.left + A)), D = y.right - y.left;
                                        break;
                                    case 90:
                                        y.bottom = y.bottom + C, y.bottom > w && (y.bottom = w, y.top = Math.max(0, y.bottom - A)), D = y.bottom - y.top;
                                        break;
                                    case 180:
                                        y.right = y.right + C, y.right > v && (y.right = v, y.left = Math.max(0, y.right - A)), D = y.right - y.left;
                                        break;
                                    case 270:
                                        y.top = y.top - C, y.top < 0 && (y.top = 0, y.bottom = Math.min(w, y.top + A)), D = y.bottom - y.top
                                }
                                break;
                            default:
                                switch (u) {
                                    case 0:
                                        y.right = y.right + C, y.right > v && (y.right = v, y.left = x.left), D = y.right - y.left;
                                        break;
                                    case -270:
                                    case 90:
                                        y.bottom = y.bottom + C, y.bottom > w && (y.bottom = w, y.top = x.top), D = y.bottom - y.top;
                                        break;
                                    case 180:
                                    case -180:
                                        y.left = y.left - C, y.left < 0 && (y.left = 0, y.right = x.right), D = y.right - y.left;
                                        break;
                                    case 270:
                                    case -90:
                                        y.top = y.top - C, y.top < 0 && (y.top = 0, y.bottom = x.bottom), D = y.bottom - y.top
                                }
                        }
                        var F = parseFloat(i.css("line-height"));
                        (isNaN(F) || 0 == F) && (F = p.getLineHeight() * r), i.css({
                            height: F,
                            width: D
                        });
                        var G = i.get(0).scrollHeight;
                        switch (i.css({
                            height: G,
                            "max-height": w
                        }), u) {
                            case 270:
                            case -90:
                                y.right = Math.min(v, y.left + G);
                                var H = y.left + G - v;
                                H > 0 && (y.left -= H, y.left < 0 && (y.left = 0));
                                break;
                            case -270:
                            case 90:
                                y.left = Math.max(0, y.right - G);
                                var H = y.right - G;
                                0 > H && (y.right -= H, y.right > v && (y.right = v));
                                break;
                            case 180:
                            case -180:
                                y.top = Math.max(0, y.bottom - G);
                                var H = y.bottom - G;
                                0 > H && (y.bottom -= H, y.bottom > w && (y.bottom = w));
                                break;
                            default:
                                y.bottom = Math.min(w, y.top + G);
                                var H = y.top + G - w;
                                H > 0 && (y.top -= H, y.top <= 0 && (y.top = 0))
                        }
                        if (!f(x, y)) {
                            var I = n.width(y) + "px",
                                J = n.height(y) + "px",
                                K = I,
                                L = J,
                                M = "";
                            switch (u) {
                                case 270:
                                case -90:
                                    K = J, L = I, M = "rotate(270deg) translateX(" + -n.height(y) + "px)";
                                    break;
                                case -270:
                                case 90:
                                    K = J, L = I, M = "rotate(90deg) translateY(" + -n.width(y) + "px)";
                                    break;
                                case 180:
                                case -180:
                                    M = "rotate(180deg)"
                            }
                            k.css({
                                left: y.left + "px",
                                top: y.top + "px",
                                width: I,
                                height: J
                            }), j.css({
                                left: y.left + "px",
                                top: y.top + "px",
                                width: I,
                                height: J
                            }), i.css({
                                "-webkit-transform": M,
                                "-moz-transform": M,
                                "-o-transform": M,
                                "-ms-transform": M,
                                transform: M,
                                width: K,
                                height: L
                            });
                            var N = new m;
                            N.left = y.left / r, N.top = o.getPageHeight() - y.top / r, N.right = y.right / r, N.bottom = o.getPageHeight() - y.bottom / r, n.normalize(N), p.setRect(N), N = null;
                            var O = new Date,
                                P = O.valueOf(),
                                Q = Math.floor(P / 1e3).toString();
                            if (p.setModifyDate(Q), 0 != a) {
                                var R = d.getScrollApi();
                                if (null != R) {
                                    y = g.PageRotateToScreen(y, d.getRotate()), x = g.PageRotateToScreen(x, d.getRotate());
                                    var S = y.left - x.left,
                                        T = y.right - x.right,
                                        U = y.bottom - x.bottom,
                                        V = $("#" + d.getDocViewContainerID()),
                                        W = V.height(),
                                        X = V.width(),
                                        Y = V.offset(),
                                        Z = $("#" + g.getPageViewContainerID()),
                                        _ = Z.offset();
                                    if (W -= R.getScrollBarHeight(), X -= R.getScrollBarWidth(), U > 0) Y.top + W <= _.top + y.bottom && R.scrollByY(U + 5);
                                    else if (0 > U && Y.top >= _.top + y.bottom - F) {
                                        var aa = Math.min(Y.top - (_.top + y.top), Y.top + W - (_.top + y.bottom)),
                                            ba = Math.min(U, -aa);
                                        R.scrollByY(ba - 5)
                                    }
                                    switch (p.getTextAlign()) {
                                        case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                            if (S > 0) {
                                                if (Y.left + X <= _.left + y.right) {
                                                    var ca = Math.min(_.left + y.right - (Y.left + X), _.left + y.left - Y.left),
                                                        da = Math.max(S, ca);
                                                    R.scrollByX(da + 5)
                                                }
                                            } else 0 > S && Y.left >= _.left + y.left && R.scrollByX(S - 5);
                                            break;
                                        default:
                                            if (T > 0) Y.left + X <= _.left + y.right && R.scrollByX(T + 5);
                                            else if (0 > T && Y.left >= _.left + y.left) {
                                                var ca = Math.min(Y.left + X - (_.left + y.right), Y.left - (_.left + y.left)),
                                                    da = Math.min(T, -ca);
                                                R.scrollByX(da - 5)
                                            }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            _calActualWidth: function(a) {
                var b = $('<div rows="1" width="auto"></div>');
                b.css({
                    position: "absolute",
                    margin: 0,
                    padding: 0,
                    display: "block",
                    width: "1px",
                    "float": "left",
                    "white-space": "nowrap",
                    visibility: "hidden",
                    font: a.css("font"),
                    "font-family": a.css("font-family"),
                    "font-size": a.css("font-size")
                }), a.after(b);
                for (var c = a.val(), d = c.split("\n"), e = d.length, f = 0, g = 10, h = 0; e > h; ++h) {
                    var i = WebPDF.Common.htmlEncode(d[h].replace(/ /g, "&nbsp;")),
                        j = b.html(i).get(0).scrollWidth;
                    f = Math.max(f, j), d[h].length > 0 && (g = Math.min(g, j / d[h].length)), i = null
                }
                return b.remove(), f + g / 2
            },
            _calActualLineHeight: function(a) {
                var b = $('<textarea rows="1">AbgH@</textarea>');
                b.css({
                    position: "absolute",
                    margin: 0,
                    padding: 0,
                    display: "block",
                    width: "1px",
                    "float": "left",
                    "white-space": "nowrap",
                    visibility: "hidden",
                    font: a.css("font"),
                    "font-family": a.css("font-family"),
                    "font-size": a.css("font-size")
                }), b.css("lineHeight", "normal"), a.after(b);
                var c = parseFloat(b.get(0).scrollHeight);
                return b.remove(), c
            },
            _setTextareaCursorPosition: function(a, b) {
                if (a.setSelectionRange) a.setSelectionRange(b, b);
                else if (a.createTextRange) {
                    var c = a.createTextRange();
                    a.value.length === b ? (c.collapse(!1), c.select()) : c.select()
                }
            },
            _addAndRemoveChangeValueEvent: function(a, b) {
                function c(a) {
                    if (!a || !WebPDF.Environment.ie || "value" == a.propertyName) {
                        d._spellCheck(1);
                        var b = h.getMainView().getDocView();
                        b.setModified(!0)
                    }
                }
                var d = this;
                WebPDF.Environment.ie8OrLower || WebPDF.Environment.ie9Compact || WebPDF.Environment.ie10Compact ? b ? a.attachEvent("onpropertychange", c) : a.detachEvent("onpropertychange", c) : b ? a.addEventListener("input", c, !1) : a.removeEventListener("input", c, !1)
            }
        }, b.createTypewriterAnnotView = function(a, b) {
            return null == g && (g = new d(a, b)), g
        }
    }), define("core/Plugins/Annot/TypewriterAnnotService", [], function(a, b, c) {
        function d(a, b) {
            f = b
        }
        var e, f;
        d.prototype = {
            getAnnot: function(a, b, c, d) {
                var e = a.pageX - d.left,
                    g = a.pageY - d.bottom,
                    h = WebPDF.AccountInstance.getUserConfig(),
                    i = new Date,
                    j = i.valueOf(),
                    k = Math.floor(j / 1e3).toString(),
                    l = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                    m = {
                        c: "",
                        ca: 1,
                        q: 0,
                        cd: k,
                        cl: "",
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: k,
                        n: null,
                        subj: i18n.t("Annot.AnnotSubjTypewriter"),
                        subty: "FreeText",
                        tit: l,
                        ty: "Typewriter",
                        fs: WebPDF.Annot.TypewriteAnnotDefaultValue.FontSize,
                        fh: WebPDF.Annot.TypewriteAnnotDefaultValue.FontHeight,
                        lnh: WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight,
                        fc: h.annot.typeWriter.clr,
                        ftn: "Helvetica",
                        it: b,
                        r: 90 * c.getPDFPage().getPageRotate() + c.getDocView().getRotate(),
                        rc: null,
                        pdf: "false",
                        del: 0
                    },
                    n = c.getPDFPage(),
                    o = n.getPageWidth(),
                    p = n.getPageHeight(),
                    q = new WebPDF.PDFPoint(e, g);
                q = c.devicePtToPDF(q);
                var r = null,
                    s = c.getDocView().getRotate();
                r = 90 == s ? new WebPDF.PDFRect(q.x, q.y, q.x + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight, q.y - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidth) : 180 == s ? new WebPDF.PDFRect(q.x - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidth, q.y + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight, q.x, q.y) : 270 == s ? new WebPDF.PDFRect(q.x - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight, q.y, q.x, q.y - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidth) : new WebPDF.PDFRect(q.x, q.y, q.x + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidth, q.y - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight), r.left < 0 && WebPDF.RectUtils.offset(r, 0 - r.left, 0), r.bottom < 0 && WebPDF.RectUtils.offset(r, 0, 0 - r.bottom), r.right > o && WebPDF.RectUtils.offset(r, o - r.right, 0), r.top > p && WebPDF.RectUtils.offset(r, 0, p - r.top), m.rc = [r.left, r.top, r.right, r.bottom];
                var t = WebPDF.Annot.AnnotFactory.createAnnot(m, n.getPageIndex(), !1);
                n.getAnnotJsonData().push(m), n.addAnnot(t), c.setModified(!0);
                var u = [];
                u.push(t.annotJSONData);
                var v = new WebPDF.Annot.Undo(c.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, u);
                return f.addAnnotUndo(v), {
                    pAnnot: t,
                    pageView: c,
                    pPDFPage: n
                }
            },
            moveAnnotRecord: function(a, b) {
                var c = "[" + b.getRect().left + " " + b.getRect().top + " " + b.getRect().right + " " + b.getRect().bottom + "]",
                    d = '{"Type":"' + b.getSubType() + '", "ActionType":"Edit", "PageIndex":"' + a.getPageIndex() + '", "Rect":"' + c + '"}';
                f.addRecord("Comment", "Comment", d)
            },
            addAnnotRecord: function(a, b) {
                var c = "[" + a.getRect().left + " " + a.getRect().top + " " + a.getRect().right + " " + a.getRect().bottom + "]",
                    d = '{"Type":"' + a.getSubType() + '", "ActionType":"Add", "PageIndex":"' + b.getPageIndex() + '", "Rect":"' + c + '"}';
                f.addRecord("Comment", "Comment", d)
            },
            isTypewritersType: function(a) {
                return a.toLowerCase() == WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TYPEWRITER.toLowerCase() ? !0 : !1
            },
            setAnnotColor: function(a, b, c) {
                c = WebPDF.Common.rgb2HexColor(c), b.setColor(c), b.setFontColor(c), f.setModified(a, a.getDocView(), !0)
            },
            canAnswer: function(a, b) {
                if (!f.isEditable()) return !1;
                var c = a.getIT();
                if (!this.isTypewritersType(c) || !a.isVisible()) return !1;
                var d = f.getCurToolHandler();
                if (null != d) {
                    var e = d.getName();
                    if (e === WebPDF.Tools.TOOL_NAME_SELANNOT || e === WebPDF.Tools.TOOL_NAME_HAND || e.toLowerCase() === b.toLowerCase()) return !0
                }
            }
        }, b.createTypewriterAnnotService = function(a, b) {
            return null == e && (e = new d(a, b)), e
        }
    }), define("core/Plugins/Annot/CalloutAnnotHandler", ["core/Plugins/Annot/CalloutAnnotView", "core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/CalloutAnnotService"], function(a, b, c) {
        function d(a, b) {
            e.onUpdatePosition(a, b)
        }
        var e, f, g, h, i = (WebPDF.PDFRect, WebPDF.RectUtils, -1);
        return WebPDF.CalloutAnnotHandler = function(b, c, d) {
            this.readerApp = b, h = b, this.annotType = c, this.annotHandlerManager = d, this.annotUIManager = d.getUIManager(), this.oldRect = null, this.oldRectDiffer = null, this.oldFreeCoordLine = null, f = a("core/Plugins/Annot/CalloutAnnotView").createCalloutAnnotView(d, b), g = a("core/Plugins/Annot/CalloutAnnotService").createCalloutAnnotService(d, b);
            var i = WebPDF.AccountInstance.getUserConfig(),
                j = ["#3366cc", "#669933", "#cc6600", "#cc9900", "#a3a305", "#ff0000", "#336666", "#660066", "#000000", "#8f8e8e"],
                k = {
                    title: i18n.t("AnnotProperties.CalloutTitle"),
                    colorArr: j,
                    drawingConfig: i.annot.callout
                };
            this.commentPropertyDlg = new CommentPropertyDlg(null, null, k), this.commentPropertyDlg.setAnnotHandler(this), this.init(), e = this
        }, WebPDF.CalloutAnnotHandler.prototype = {
            getType: function() {
                return this.annotType
            },
            canAnswer: function(a) {
                return g.canAnswer(a, this.annotType) ? !0 : !1
            },
            canMove: function(a) {
                return !0
            },
            isTypewritersType: function(a) {
                return g.isTypewritersType(a)
            },
            addCursor: function(a, b, c) {
                if (b) {
                    var d = b.getAnnotName(),
                        e = this.annotUIManager.getAnnotDivID(a, d);
                    c >= 0 ? ($("#" + e).removeClass("fwr-default-cursor"), WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? ($("#" + e).addClass("fwr-note-cursor-ie"), $("#" + e).css("cursor", "crosshair")) : $("#" + e).addClass("fwr-note-cursor")) : $("#" + e).addClass("fwr-default-cursor")
                } else {
                    var f = h.getMainView().getDocView(),
                        g = $("#" + f.getDocViewContainerID());
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (g.addClass("fwr-note-cursor-ie"), g.css("cursor", "crosshair")) : g.addClass("fwr-note-cursor")
                }
            },
            moveAnnot: function(a, b, c, d, e, h) {
                f.moveAnnot(a, b, c, d, e, h), g.moveAnnot(a, b, c, d), g.moveAnnotRecord(a, b)
            },
            deleteAnnot: function(a, b) {
                f.deleteAnnot(a, b)
            },
            setAnnotProperty: function(a, b, c, d) {
                var e = WebPDF.Common.getReaderApp();
                if (e.isEditable()) {
                    var f = {
                        annot: b,
                        event: c,
                        multiSelect: d,
                        pageView: a
                    };
                    this.commentPropertyDlg.setOptions(f), this.commentPropertyDlg.show(c.pageX, c.pageY, f)
                }
            },
            setAnnotColor: function(a, b, c) {
                g.setAnnotColor(a, b, c);
                var d = g.getPointsByAnnot(b),
                    e = f.drawCallout(a, b),
                    h = f.isSelected(a, b),
                    i = {
                        borderColor: b.getColor(),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        isDrawArrow: !0,
                        isDrawArc: h
                    },
                    j = g.getRectPoints(d, a),
                    k = g.getPointsToAnnotCanvas(d, j);
                return f.drawCallout1(e, k, null, i), !0
            },
            setAnnotFillColor: function(a, b, c) {
                g.setAnnotFillColor(a, b, c);
                var d = g.getPointsByAnnot(b),
                    e = f.drawCallout(a, b),
                    h = f.isSelected(a, b),
                    i = {
                        borderColor: b.getColor(),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        isDrawArrow: !0,
                        isDrawArc: h
                    },
                    j = g.getRectPoints(d, a),
                    k = g.getPointsToAnnotCanvas(d, j);
                f.drawCallout1(e, k, null, i)
            },
            setAnnotFontColor: function(a, b, c) {
                b.setFontColor(c), f.updateAnnotFontColor(a, b, c)
            },
            onDraw: function(a, b, c, d) {
                var e = g.initPointArrayByAnnot(a, b),
                    h = f.drawCallout(a, b),
                    i = {
                        borderColor: b.getColor(),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        isDrawArrow: !0,
                        isDrawArc: !1
                    },
                    j = g.getRectPoints(e, a),
                    k = g.getPointsToAnnotCanvas(e, j);
                f.drawCallout1(h, k, null, i), f.onDraw(a, b)
            },
            onSelected: function(a, b) {
                var c = g.getPointsByAnnot(b);
                f.onSelected(a, b);
                var d = f.drawCallout(a, b),
                    e = {
                        borderColor: b.getColor(),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        isDrawArrow: !0,
                        isDrawArc: !0
                    },
                    h = g.getRectPoints(c, a),
                    i = g.getPointsToAnnotCanvas(c, h);
                return f.drawCallout1(d, i, null, e), !0
            },
            onDeSelected: function(a, b) {
                var c = g.getPointsByAnnot(b);
                f.onDeSelected(a, b), this.commentPropertyDlg.disabledDlg();
                var d = f.drawCallout(a, b),
                    e = {
                        borderColor: b.getColor(),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        isDrawArrow: !0,
                        isDrawArc: !1
                    },
                    h = g.getRectPoints(c, a),
                    i = g.getPointsToAnnotCanvas(c, h);
                return d && f.drawCallout1(d, i, null, e), !0
            },
            onFocus: function(a, b) {},
            onLButtonDown: function(a, b, c) {
                return i = e.getCurPointIndex(a, b, c), i > -1 && (this.oldRect = b.getRect(), this.oldRectDiffer = b.getRectDiffer(), this.oldFreeCoordLine = b.getFreeCoordinatesLine()), this.onSelected(a, b)
            },
            getCurPointIndex: function(a, b, c) {
                var d = a.pdfRectToDevice(b.getRect(), !0),
                    e = g.getPointsByAnnot(b),
                    h = f.getAnnotTopALeft(a, b),
                    i = [c.pageX, c.pageY],
                    j = d.right - d.left,
                    k = d.bottom - d.top,
                    l = -1;
                if (270 === a.getDocView().getRotate())
                    for (var m = 0; m < e.length; m++) Math.abs(e[m].x - d.left + (i[1] - j - h.top)) < WebPDF.Config.defaults.drawingSelectSize / 2 && Math.abs(e[m].y - d.top - (i[0] - h.left)) < WebPDF.Config.defaults.drawingSelectSize / 2 && (l = m);
                else if (90 === a.getDocView().getRotate())
                    for (var m = 0; m < e.length; m++) Math.abs(e[m].x - d.left - (i[1] - h.top)) < WebPDF.Config.defaults.drawingSelectSize / 2 && Math.abs(e[m].y - d.top + (i[0] - h.left - k)) < WebPDF.Config.defaults.drawingSelectSize / 2 && (l = m);
                else if (180 === a.getDocView().getRotate())
                    for (var m = 0; m < e.length; m++) Math.abs(e[m].x - d.left + (i[0] - h.left - j)) < WebPDF.Config.defaults.drawingSelectSize / 2 && Math.abs(e[m].y - d.top + (i[1] - h.top - k)) < WebPDF.Config.defaults.drawingSelectSize / 2 && (l = m);
                else
                    for (var m = 0; m < e.length; m++) Math.abs(e[m].x - d.left + h.left - i[0]) < WebPDF.Config.defaults.drawingSelectSize / 2 && Math.abs(e[m].y - d.top + h.top - i[1]) < WebPDF.Config.defaults.drawingSelectSize / 2 && (l = m);
                return l
            },
            onAnnotLButtonUp: function(a, b, c) {
                if (i > -1) {
                    var d = {
                            name: b.getAnnotName(),
                            newRect: b.getRect(),
                            oldRect: this.oldRect,
                            newRectDiffer: b.getRectDiffer(),
                            oldRectDiffer: this.oldRectDiffer,
                            oldFreeCoordLine: this.oldFreeCoordLine,
                            newFreeCoordLine: b.getFreeCoordinatesLine()
                        },
                        e = [];
                    e.push(d);
                    var f = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_MOVE, e);
                    h.addAnnotUndo(f), this.oldRect = null, this.oldRectDiffer = null, this.oldFreeCoordLine = null
                }
                i = -1, c.preventDefault()
            },
            onLButtonDblClk: function(a, b, c) {
                b.isReadOnly() || (f.onCalloutAnnotEdit(a, b), c.preventDefault())
            },
            onMouseMove: function(a, b, c) {
                if (!a) return !0;
                var d = g.getPointsByAnnot(b);
                if (-1 === i) return !1;
                var e = (this.annotHandlerManager.getCavansElement(), {
                        left: 0,
                        top: 0
                    }),
                    h = new WebPDF.PDFPoint(0, 0);
                h.setPoint(c.pageX - e.left, c.pageY - e.top);
                var j = $("#" + a.getPageViewContainerID()).offset();
                h.x -= j.left - e.left, h.y -= j.top - e.top;
                var k = a.devicePtToPDF(h),
                    l = a.pdfPtToDevice(k),
                    m = b.getRotate();
                d = g.updatePointArray(a, d, l, i, null, m);
                var n = g.getRectPoints(d, a);
                d = g.updatePointArrayByPointArray(a, b, d), g.setPointsMapByAnnot(b, d);
                var o = new WebPDF.PDFRect(n[0].x, n[0].y, n[1].x, n[1].y),
                    p = a.deviceRectToPDF(o, !0, 0);
                b.setRect(p);
                var q = new WebPDF.PDFPoint(d[0].x, d[0].y),
                    r = new WebPDF.PDFPoint(d[1].x, d[1].y),
                    s = new WebPDF.PDFPoint(d[2].x, d[2].y),
                    t = new WebPDF.PDFPoint(d[3].x, d[3].y),
                    u = new WebPDF.PDFPoint(d[4].x, d[4].y);
                q = a.point2pdf(q), r = a.point2pdf(r), s = a.point2pdf(s), t = a.point2pdf(t), u = a.point2pdf(u);
                var v = 90 * a.getPDFPage().getPageRotate(),
                    w = b.getRotate() - v;
                180 === v ? 270 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.x - p.right), Math.abs(u.y - p.bottom), Math.abs(u.x - p.left), Math.abs(t.y - p.top))) : 180 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.x - p.right), Math.abs(t.y - p.bottom), Math.abs(u.x - p.left), Math.abs(u.y - p.top))) : 90 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.x - p.right), Math.abs(t.y - p.bottom), Math.abs(t.x - p.left), Math.abs(u.y - p.top))) : b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.x - p.right), Math.abs(u.y - p.bottom), Math.abs(t.x - p.left), Math.abs(t.y - p.top))) : 90 === v ? 270 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.y - p.top), Math.abs(t.x - p.right), Math.abs(u.y - p.bottom), Math.abs(u.x - p.left))) : 180 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.y - p.top), Math.abs(t.x - p.right), Math.abs(t.y - p.bottom), Math.abs(u.x - p.left))) : 90 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.y - p.top), Math.abs(u.x - p.right), Math.abs(t.y - p.bottom), Math.abs(t.x - p.left))) : b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.y - p.top), Math.abs(u.x - p.right), Math.abs(u.y - p.bottom), Math.abs(t.x - p.left))) : 270 === v ? 270 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.y - p.bottom), Math.abs(u.x - p.left), Math.abs(t.y - p.top), Math.abs(t.x - p.right))) : 180 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.y - p.bottom), Math.abs(u.x - p.left), Math.abs(u.y - p.top), Math.abs(t.x - p.right))) : 90 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.y - p.bottom), Math.abs(t.x - p.left), Math.abs(u.y - p.top), Math.abs(u.x - p.right))) : b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.y - p.bottom), Math.abs(t.x - p.left), Math.abs(t.y - p.top), Math.abs(u.x - p.right))) : 270 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.x - p.left), Math.abs(t.y - p.top), Math.abs(t.x - p.right), Math.abs(u.y - p.bottom))) : 180 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(u.x - p.left), Math.abs(u.y - p.top), Math.abs(t.x - p.right), Math.abs(t.y - p.bottom))) : 90 === w ? b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.x - p.left), Math.abs(u.y - p.top), Math.abs(u.x - p.right), Math.abs(t.y - p.bottom))) : b.setRectDiffer(new WebPDF.PDFRect(Math.abs(t.x - p.left), Math.abs(t.y - p.top), Math.abs(u.x - p.right), Math.abs(u.y - p.bottom))), b.setFreeCoordinatesLine([q.x, q.y, r.x, r.y, s.x, s.y]), f.onUpdatePosition(a, b, d, null);
                var x = f.drawCallout(a, b),
                    y = f.isSelected(a, b),
                    z = {
                        borderColor: b.getColor(),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        isDrawArrow: !0,
                        isDrawArc: y
                    },
                    A = g.getPointsToAnnotCanvas(d, n);
                return f.drawCallout1(x, A, null, z), !0
            },
            onMouseOver: function(a, b, c) {},
            onMouseLeave: function(a, b, c) {},
            onUpdatePosition: function(a, b, c) {
                var d = b.getFreeCoordinatesLine(),
                    e = g.getRdToPdfPt(b, a),
                    h = new WebPDF.PDFPoint(d[0], d[1]),
                    i = new WebPDF.PDFPoint(d[2], d[3]),
                    j = new WebPDF.PDFPoint(d[4], d[5]),
                    k = e[0],
                    l = e[1];
                if (Math.abs(k.x - j.x) < .1 || Math.abs(l.x - j.x) < .1) i.y = k.y - (k.y - l.y) / 2, j.y = i.y;
                else if (Math.abs(k.y - j.y) < .1 || Math.abs(l.y - j.y) < .1) i.x = k.x - (k.x - l.x) / 2, j.x = i.x;
                else if (Math.abs((k.x + l.x) / 2 - j.x) < .1) {
                    i.x = k.x - (k.x - l.x) / 2, j.x = i.x;
                    var m = Math.abs(l.y - j.y) > Math.abs(k.y - j.y) ? k.y - j.y : l.y - j.y;
                    j.y = j.y + m, i.y = i.y + m
                } else if (Math.abs((k.y + l.y) / 2 - j.y) < .1) {
                    i.y = k.y - (k.y - l.y) / 2, j.y = i.y;
                    var n = Math.abs(k.x - j.x) > Math.abs(l.x - j.x) ? l.x - j.x : k.x - j.x;
                    j.x = j.x + n, i.x = i.x + n
                }
                b.setFreeCoordinatesLine([h.x, h.y, i.x, i.y, j.x, j.y]), h = a.pdfPtToDevice(h), i = a.pdfPtToDevice(i), j = a.pdfPtToDevice(j), k = a.pdfPtToDevice(k), l = a.pdfPtToDevice(l);
                var o = g.getPointsByAnnot(b);
                o[0] = h, o[1] = i, o[2] = j, o[3] = k, o[4] = l, g.setPointsByAnnot(b, o, null);
                var p = f.drawCallout(a, b),
                    q = f.isSelected(a, b),
                    r = {
                        borderColor: b.getColor(),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        isDrawArrow: !0,
                        isDrawArc: q
                    };
                f.onUpdatePosition(a, b, c);
                var s = g.getRectPoints(o, a),
                    t = g.getPointsToAnnotCanvas(o, s);
                f.drawCallout1(p, t, null, r)
            },
            initPointArrayByAnnot: function(a, b) {
                g.initPointArrayByAnnot(a, b)
            },
            init: function() {
                f.editCalloutForBlur(), f.editCalloutForKeyup(), f.editCalloutForFocus(d)
            },
            resizeTextArea: function(a, b) {
                f.onDraw(a, b, !0), f.resizeTextArea(a, b)
            }
        }, WebPDF.CalloutAnnotHandler
    }), define("core/Plugins/Annot/CalloutAnnotView", ["core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        function d(a, b) {
            h = b, i = $("#" + h.getAppId()), l = new WebPDF.Annot.AnnotUIManager(a, h), k = a, j = this
        }

        function e(a, b) {
            return Math.abs(parseFloat(a) - parseFloat(b)) <= 1
        }

        function f(a, b) {
            return e(a.left, b.left) && e(a.right, b.right) && e(a.top, b.top) && e(a.bottom, b.bottom)
        }
        a("core/Plugins/Annot/AnnotUIManager");
        var g, h, i, j, k, l, m = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            n = WebPDF.PDFRect,
            o = WebPDF.RectUtils;
        d.prototype = {
            setAnnotFillColor: function(a, b, c) {},
            containsJQDocView: function(a) {
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                return WebPDF.Common.containsNode(c.get(0), a.target, !0) ? void 0 : !1
            },
            onLButtonInPage: function(a) {
                for (var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(), c = b.getVisiblePageRange(), d = null, e = null, f = c.begin; f <= c.end; f++) {
                    var g = b.getPageView(f),
                        h = $("#" + g.getPageViewContainerID()).offset(),
                        i = g.getPageViewWidth(),
                        j = g.getPageViewHeight();
                    if (e = new WebPDF.PDFRect(h.left, h.top, h.left + i, h.top + j), WebPDF.RectUtils.normalize(e), WebPDF.RectUtils.ptInRect(e, a.pageX, a.pageY)) {
                        d = g;
                        break
                    }
                }
                return d ? {
                    pageView: d,
                    pageViewRect: e
                } : !1
            },
            onDraw: function(a, b, c) {
                if (null != b && null != a && b.isVisible() && b.getType() === WebPDF.Annot.AnnotType.Callout && (this.currentPageIndex = a.getPageIndex(), this.currentAnnotName = b.getAnnotName(), !c)) {
                    var d = $("#" + l.getCalloutAnnotRectDivID(a, this.currentAnnotName));
                    d.data("before", d.val())
                }
            },
            updateAnnotFontColor: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = $("#" + l.getCalloutAnnotRectDivID(a, d));
                e.css("color", c)
            },
            onSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).addClass("fwr-annot-selected")
            },
            isSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                return $("#" + d).hasClass("fwr-annot-selected")
            },
            onDeSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).removeClass("fwr-annot-selected");
                var e = $("#" + l.getCalloutAnnotRectDivID(a, c)),
                    f = e.data("before"),
                    g = e.val();
                if (f != g) {
                    var i = {
                        name: c,
                        oldContents: f,
                        newContents: g
                    };
                    h.addAnnotUndo(i)
                }
                h.clearAnnotUndo(!0), h.setAnnotContentEdit(!1)
            },
            getAnnotTopALeft: function(a, b) {
                if (a) {
                    var c = b.getAnnotName(),
                        d = l.getAnnotDivID(a, c),
                        e = $("#" + d).offset();
                    return {
                        top: e.top,
                        left: e.left
                    }
                }
            },
            getAnnotCanvas: function() {
                return k.getCavansElement()
            },
            addCalloutCursor: function() {
                var a = h.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (b.addClass("fwr-callout-cursor-ie"), b.css("cursor", "text")) : b.addClass("fwr-callout-cursor")
            },
            removeCalloutCursor: function() {
                var a = h.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-callout-cursor-ie") : b.removeClass("fwr-callout-cursor")
            },
            createAnnot: function(a, b, c, d) {
                var e = a.getUIManager().getPageAnnotsContainerID(b),
                    f = $("#" + e),
                    g = c.getAnnotName(),
                    i = a.getUIManager().createAAnnotHtmlContent(b, c, g, 1, !1);
                f.append(i), $(h).trigger(WebPDF.EventList.ANNOT_ADDED, {
                    pageIndex: d.getPageIndex(),
                    annot: a.packageAnnot(c)
                }), $(h).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                    annotName: c.getAnnotName(),
                    pageIndex: d.getPageIndex()
                })
            },
            drawCallout: function(a, b) {
                var c = l.getCanvasAnnotRectCanvasDivID(a, b.getAnnotName()),
                    d = document.getElementById(c);
                if (null == d || $.support.canvas || (uuClass.Canvas.InitCavansElement(d), d = document.getElementById(c)), null != d) {
                    var e = d.getContext("2d");
                    return null != e._clear ? e._clear() : e.clearRect(0, 0, d.width + 1, d.height + 1), e
                }
            },
            drawCallout1: function(a, b, c, d) {
                d.isDrawArrow && (d.startStyle = "OpenArrow", d.endStyle = "None");
                var e = d.fillColor;
                if (d.fillColor = "", m.drawLineArrow(a, b[0].x, b[0].y, b[1].x, b[1].y, d), m.drawLine(a, b[1].x, b[1].y, b[2].x, b[2].y, d), d.fillColor = e, m.drawSquare(a, b[3].x, b[3].y, b[4].x, b[4].y, d), d.isDrawArc)
                    for (var f = 0; f < b.length; f++) m.drawRect(a, b[f].x - WebPDF.Config.defaults.drawingSelectSize / 2, b[f].y - WebPDF.Config.defaults.drawingSelectSize / 2, WebPDF.Config.defaults.drawingSelectSize, WebPDF.Config.defaults.drawingSelectSize)
            },
            editCalloutForKeyup: function() {
                var a = !1;
                i.off("compositionstart", ".fwr-callout-annot-edit").on("compositionstart", ".fwr-callout-annot-edit", function(b) {
                    a = !0
                }), i.off("compositionend", ".fwr-callout-annot-edit").on("compositionend", ".fwr-callout-annot-edit", function(b) {
                    a = !1
                }), i.off("keyup", ".fwr-callout-annot-edit").on("keyup", ".fwr-callout-annot-edit", function(b) {
                    var c = h.getMainView().getDocView(),
                        d = $("#docViewer_ViewContainer .fwrJspContainer")[0] || $("#docViewer_ViewContainer .fwrJspContainer-ie")[0],
                        e = h.getMainFrameId(),
                        f = $("#" + e).offset().top;
                    if (!h.isMobile() && d[0] && d.offset().top !== f && d.offset({
                            top: f
                        }), !a && (89 != b.keyCode && 90 != b.keyCode || !b.ctrlKey) && 17 != b.keyCode) {
                        var g = c.getPageView(j.currentPageIndex),
                            i = g.getPDFPage(),
                            l = i.getAnnotByName(j.currentAnnotName);
                        if (!l) return !0;
                        var m = $(this);
                        k.addFreeTextUndo(m, l, j.currentPageIndex, j.currentAnnotName, !0)
                    }
                }), i.off("paste", ".fwr-callout-annot-edit").on("paste", ".fwr-callout-annot-edit", function(a) {
                    var b = $(this);
                    k.addFreeTextUndo(b, null, j.currentPageIndex, j.currentAnnotName, !0)
                })
            },
            editCalloutForFocus: function(a) {
                i.off("focus", ".fwr-callout-annot-nor").on("focus", ".fwr-callout-annot-nor", function(b) {
                    var c = $(this),
                        d = $("#" + l.getAnnotDivIDFromCalloutAnnotRectDivID(c.attr("id")));
                    j.currentPageIndex = parseInt(d.attr("page-index")), j.currentAnnotName = d.attr("annot-name"), j.originContents = c.val(), j._spellCheck(1, a), j._setTextareaCursorPosition(c.get(0), c.val().length), j._addAndRemoveChangeValueEvent(c.get(0), !0, a), WebPDF.Environment.webkit || $("#" + l.getAnnotDivIDFromCalloutAnnotRectDivID(c.attr("id"))).removeClass("fwr-annot-selected").addClass("fwr-callout-annot-edit-border"), c.removeClass("fwr-callout-annot-nor").addClass("fwr-callout-annot-edit"), c.data("before", c.val())
                })
            },
            editCalloutForBlur: function() {
                i.off("blur", ".fwr-callout-annot-edit").on("blur", ".fwr-callout-annot-edit", function(a) {
                    var b = h.getMainView().getDocView(),
                        c = $(this);
                    if ("undefined" == typeof j.currentAnnotName || "undefined" == typeof j.currentPageIndex) return console.log("error in callout blur"), !0;
                    j._addAndRemoveChangeValueEvent(c.get(0), !1);
                    var d = b.getPageView(j.currentPageIndex),
                        e = d.getPDFPage(),
                        f = e.getAnnotByName(j.currentAnnotName);
                    if (!f) return !0;
                    WebPDF.Environment.webkit || $("#" + l.getAnnotDivIDFromCalloutAnnotRectDivID(c.attr("id"))).removeClass("fwr-callout-annot-edit-border"), c.removeClass("fwr-callout-annot-edit").addClass("fwr-callout-annot-nor");
                    $("#" + l.getAnnotDivIDFromCalloutAnnotRectDivID(c.attr("id")));
                    if (j._spellCheck(0), f && c.val() != j.originContents && (k.addFreeTextUndo(c, f, j.currentPageIndex), f.setContents(c.val()), d.setModified(!0), b.setModified(!0)), h.setAnnotContentEdit(!1), h.clearAnnotUndo(!0), WebPDF.Environment.iOS && WebPDF.Environment.mobile) {
                        var g = $("body").scrollTop();
                        0 != g && $("body").scrollTop(0)
                    }
                    return $(h).trigger(WebPDF.EventList.ANNOT_UPDATED, {
                        annot: k.packageAnnot(f),
                        pageIndex: d.getPageIndex(),
                        annotObject: f
                    }), delete j.currentAnnotName, delete j.currentPageIndex, !0
                })
            },
            onCalloutAnnotEdit: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getCalloutAnnotRectDivID(a, c),
                    e = l.getAnnotDivID(a, c),
                    f = $("#" + d),
                    g = h.getDocView(),
                    i = g.getScrollApi();
                if (null != i) {
                    var j = $("#" + e),
                        k = new n,
                        m = new n;
                    k.left = Math.max(0, parseFloat(j.css("left"))), k.top = Math.max(0, parseFloat(j.css("top"))), k.right = k.left + parseFloat(j.css("width")), k.bottom = k.top + parseFloat(j.css("height")), o.copy(k, m), m = a.PageRotateToScreen(m, g.getRotate());
                    var p = $("#" + g.getDocViewContainerID()),
                        q = p.height(),
                        r = p.width(),
                        s = p.offset(),
                        t = $("#" + a.getPageViewContainerID()),
                        u = t.offset();
                    return q -= i.getScrollBarHeight(), s.top + q <= u.top + m.bottom && i.scrollByY(u.top + m.bottom - s.top - q + 5), s.left + r <= u.left + m.right && i.scrollByX(u.left + m.right - s.left - r + 5), WebPDF.Environment.mobile ? (WebPDF.Environment.iOS ? setTimeout(function() {
                        f.focus()
                    }, 0) : (window.onresize(), f.focus()), !1) : void(WebPDF.Environment.ie8OrLower ? setTimeout(function() {
                        f.focus()
                    }, 0) : f.focus())
                }
            },
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).remove();
                var e = l.getCalloutAnnotDivID(a, c);
                $("#" + e).remove()
            },
            moveAnnot: function(a, b, c, d, e, f) {
                var g = b.getAnnotName(),
                    h = $("#" + l.getAnnotDivID(a, g));
                h.css({
                    left: e + "px",
                    top: f + "px"
                });
                var i = $("#" + l.getCalloutAnnotDivID(a, g));
                i.css({
                    left: e + "px",
                    top: f + "px"
                })
            },
            onUpdatePosition: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = a.pdfRectToDevice(b.getRect(), !0),
                    f = $("#" + l.getAnnotDivID(a, d)),
                    g = $("#" + l.getCalloutAnnotDivID(a, d)),
                    i = $("#" + l.getCalloutAnnotRectDivID(a, d)),
                    j = $("#" + l.getCanvasAnnotRectCanvasDivID(a, d)),
                    k = e.left,
                    m = e.top,
                    p = a.getPDFPage(),
                    q = (90 * p.getPageRotate() % 360 + 360) % 360,
                    r = (b.getRotate() % 360 + 360) % 360,
                    s = q - r,
                    t = h.getPixelsPerPoint(),
                    u = t * a.getScale(),
                    v = b.getFontSize() * u;
                i.css("fontSize", v + "px");
                var w = o.width(e),
                    x = b.getLineHeight(),
                    y = x * u;
                i.css("line-height", y + "px");
                var z = o.height(e),
                    A = w,
                    B = z,
                    C = "";
                if (0 != s) switch (s) {
                    case -90:
                    case 270:
                        A = z, B = w, C = "rotate(270deg) translateX(" + -(A + .05) + "px)";
                        break;
                    case -270:
                    case 90:
                        A = z, B = w, C = "rotate(90deg) translateY(" + -(B + .05) + "px)";
                        break;
                    case -180:
                    case 180:
                        C = "rotate(180deg)"
                }
                var D = b.getRectDiffer(),
                    E = new n;
                o.copy(D, E), E.left *= u, E.top *= u, E.right *= u, E.bottom *= u;
                var F = b.getRotate() - q;
                0 > F && (F += 360);
                var G, H, I, J;
                0 === q ? 90 === F ? (G = A - E.top - E.bottom - 1, H = B - E.left - E.right - 1, I = E.left + .5, J = -(E.bottom + .5)) : 180 === F || 0 === F ? (G = A - E.left - E.right - 1, H = B - E.top - E.bottom - 1, I = E.left + .5, J = E.top + .5) : 270 === F && (G = A - E.top - E.bottom - 1, H = Math.abs(B - E.left - E.right - 1), I = -(E.right + .5), J = E.top + .5) : 180 === q ? 90 === F ? (G = A - E.top - E.bottom - 1, H = B - E.left - E.right - 1, I = E.right + .5, J = -(E.top + .5)) : 180 === F || 0 === F ? (G = A - E.left - E.right - 1, H = B - E.top - E.bottom - 1, I = E.right + .5, J = E.bottom + .5) : 270 === F && (G = A - E.top - E.bottom - 1, H = Math.abs(B - E.left - E.right - 1), I = -(E.left + .5), J = E.bottom + .5) : 270 === q ? 90 === F ? (G = A - E.left - E.right - 1, H = B - E.top - E.bottom - 1, I = E.top + .5, J = -(E.left + .5)) : 180 === F || 0 === F ? (G = A - E.top - E.bottom - 1, H = B - E.left - E.right - 1, I = E.top + .5, J = E.right + .5) : 270 === F && (G = Math.abs(A - E.left - E.right - 1), H = Math.abs(B - E.top - E.bottom - 1), I = -(E.bottom + .5), J = E.right + .5) : 90 === q && (90 === F ? (G = A - E.left - E.right - 1, H = B - E.top - E.bottom - 1, I = E.bottom + .5, J = -(E.right + .5)) : 180 === F || 0 === F ? (G = A - E.top - E.bottom - 1, H = B - E.left - E.right - 1, I = E.bottom + .5, J = E.left + .5) : 270 === F && (G = A - E.left - E.right - 1, H = Math.abs(B - E.top - E.bottom - 1), I = -(E.top + .5), J = E.left + .5)), g.css({
                    left: k + "px",
                    top: m + "px",
                    width: w + "px",
                    height: z + "px"
                }), f.css({
                    left: k + "px",
                    top: m + "px",
                    width: w + "px",
                    height: z + "px"
                }), j.attr("width", w), j.attr("height", z), i.css({
                    "-webkit-transform": C,
                    "-moz-transform": C,
                    "-o-transform": C,
                    "-ms-transform": C,
                    transform: C,
                    left: I,
                    top: J,
                    width: G,
                    height: H
                })
            },
            resizeTextArea: function(a, b) {
                this._spellCheck(0)
            },
            _spellCheck: function(a, b) {
                var c = this.currentPageIndex,
                    d = this.currentAnnotName;
                if ("undefined" != typeof c && "undefined" != typeof d) {
                    var e = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                        g = e.getPageView(c),
                        i = $("#" + l.getCalloutAnnotRectDivID(g, d)),
                        j = ($("#" + l.getCanvasAnnotRectCanvasDivID(g, d)), i.parent()),
                        k = $("#" + l.getAnnotDivID(g, d)),
                        m = g.getPDFPage(),
                        p = m.getAnnotByName(d);
                    if (p) {
                        var q = h.getPixelsPerPoint(),
                            r = q * g.getScale(),
                            s = (90 * m.getPageRotate() % 360 + 360) % 360,
                            t = (p.getRotate() % 360 + 360) % 360,
                            u = s - t,
                            v = 0,
                            w = 0;
                        90 == e.getRotate() || 270 == e.getRotate() ? (v = g.getPageViewHeight(), w = g.getPageViewWidth()) : (v = g.getPageViewWidth(), w = g.getPageViewHeight());
                        var x = p.getRect();
                        x = g.pdfRectToDevice(x, !0);
                        var y = new n;
                        o.copy(x, y), ("undefined" == typeof a || isNaN(a)) && (a = 1);
                        var z = (a * parseFloat(i.css("font-size")), i.width(), i.height()),
                            A = parseFloat(i.css("line-height"));
                        (isNaN(A) || 0 == A) && (A = p.getLineHeight() * r), A > z && i.css({
                            height: A
                        });
                        var B = i.get(0).scrollHeight;
                        i.css({
                            height: B
                        });
                        var C = new n,
                            D = p.getRectDiffer();
                        D.left *= r, D.top *= r, D.right *= r, D.bottom *= r, o.copy(D, C);
                        var E, F = p.getRotate() - s;
                        if (0 === s || 180 === s) switch (F) {
                                case 270:
                                case -90:
                                    var G = Math.max(-8 * g.getScale(), y.right - C.left - C.right - B);
                                    if (E = y.right - G - C.left - C.right, 0 === s) {
                                        var H = C.left - (E - z);
                                        H = H > 8 * g.getScale() ? H : 8 * g.getScale(), G = G + C.left - H, C.left = H, H <= 8 * g.getScale() && (y.left = G)
                                    } else {
                                        var I = C.right - (E - z);
                                        I = I > 8 * g.getScale() ? I : 8 * g.getScale(), G = G + C.right - I, C.right = I, I <= 8 * g.getScale() && (y.left = G)
                                    }
                                    break;
                                case -270:
                                case 90:
                                    var J = Math.min(v + 8 * g.getScale(), y.left + C.left + C.right + B);
                                    if (E = J - y.left - C.right - C.left, 0 === s) {
                                        var I = C.right - (E - z);
                                        I = I > 8 * g.getScale() ? I : 8 * g.getScale(), J = J - C.right + I, C.right = I
                                    } else {
                                        var H = C.left - (E - z);
                                        H = H > 8 * g.getScale() ? H : 8 * g.getScale(), J = J - C.left + H, C.left = H
                                    }
                                    y.right = J;
                                    break;
                                case 180:
                                case -180:
                                    var K = Math.max(-8 * g.getScale(), y.bottom - C.bottom - C.top - B);
                                    if (E = y.bottom - K - C.top - C.bottom, 0 === s) {
                                        var L = C.top - (E - z);
                                        L = L > 8 * g.getScale() ? L : 8 * g.getScale(), K = K + C.top - L, C.top = L, L <= 8 * g.getScale() && (y.top = K)
                                    } else {
                                        var M = C.bottom - (E - z);
                                        M = M > 8 * g.getScale() ? M : 8 * g.getScale(), K = K + C.bottom - M, C.bottom = M, M <= 8 * g.getScale() && (y.top = K)
                                    }
                                    break;
                                default:
                                    var N = Math.min(w + 8 * g.getScale(), y.top + C.top + C.bottom + B);
                                    if (E = N - y.top - C.top - C.bottom, 0 === s) {
                                        var M = C.bottom - (E - z);
                                        M = M > 8 * g.getScale() ? M : 8 * g.getScale(), N = N - C.bottom + M, C.bottom = M
                                    } else {
                                        var L = C.top - (E - z);
                                        L = L > 8 * g.getScale() ? L : 8 * g.getScale(), N = N - C.top + L, C.top = L
                                    }
                                    y.bottom = N
                            } else if (270 === s || 90 === s) switch (F) {
                                case 90:
                                case -270:
                                    var J = Math.min(v + 8 * g.getScale(), y.left + C.bottom + C.top + B);
                                    if (E = J - y.left - C.bottom - C.top, 90 === s) {
                                        var L = C.top - (E - z);
                                        L = L > 8 * g.getScale() ? L : 8 * g.getScale(), J = J - C.top + L, C.top = L
                                    } else {
                                        var M = C.bottom - (E - z);
                                        M = M > 8 * g.getScale() ? M : 8 * g.getScale(), J = J - C.bottom + M, C.bottom = M
                                    }
                                    y.right = J;
                                    break;
                                case -90:
                                case 270:
                                    var G = y.right - C.top - C.bottom - B;
                                    if (G = G > -8 * g.getScale() ? G : -8 * g.getScale(), E = y.right - G - C.bottom - C.top, 90 === s) {
                                        var M = C.bottom - (E - z);
                                        M = M > 8 * g.getScale() ? M : 8 * g.getScale(), G = G + C.bottom - M, C.bottom = M
                                    } else {
                                        var L = C.top - (E - z);
                                        L = L > 8 * g.getScale() ? L : 8 * g.getScale(), G = G + C.top - L, C.top = L
                                    }
                                    G = G > 0 ? G : 0, y.left = G;
                                    break;
                                case 180:
                                case -180:
                                    var K = y.bottom - C.right - C.left - B;
                                    if (K = K < -8 * g.getScale() ? -8 * g.getScale() : K, E = y.bottom - K - C.right - C.left, 90 === s) {
                                        var H = C.left - (E - z);
                                        H = H > 8 * g.getScale() ? H : 8 * g.getScale(), K = K + C.left - H, C.left = H
                                    } else {
                                        var I = C.right - (E - z);
                                        I = I > 8 * g.getScale() ? I : 8 * g.getScale(), K = K + C.right - I, C.right = I
                                    }
                                    y.top = K;
                                    break;
                                default:
                                    var N = Math.min(w + 8 * g.getScale(), y.top + C.left + C.right + B);
                                    if (E = N - y.top - C.left - C.right, 90 === s) {
                                        var I = C.right - (E - z);
                                        I = I > 8 * g.getScale() ? I : 8 * g.getScale(), N = N - C.right + I, C.right = I
                                    } else {
                                        var H = C.left - (E - z);
                                        H = H > 8 * g.getScale() ? H : 8 * g.getScale(), N = N - C.left + H, C.left = H
                                    }
                                    y.bottom = N
                            }
                            var O = new WebPDF.PDFRect;
                        o.copy(C, O), O.left /= r, O.top /= r, O.right /= r, O.bottom /= r, p.setRectDiffer(O);
                        var P = o.width(y) + "px",
                            Q = o.height(y) + "px",
                            R = P,
                            S = Q,
                            T = "";
                        switch (u) {
                            case 270:
                            case -90:
                                R = Q, S = P, T = "rotate(270deg) translateX(" + -o.height(y) + "px)";
                                break;
                            case -270:
                            case 90:
                                R = Q, S = P, T = "rotate(90deg) translateY(" + -o.width(y) + "px)";
                                break;
                            case 180:
                            case -180:
                                T = "rotate(180deg)"
                        }
                        if (k.css({
                                left: y.left + "px",
                                top: y.top + "px",
                                width: P,
                                height: Q
                            }), j.css({
                                left: y.left + "px",
                                top: y.top + "px",
                                width: P,
                                height: Q
                            }), i.css({
                                "-webkit-transform": T,
                                "-moz-transform": T,
                                "-o-transform": T,
                                "-ms-transform": T,
                                transform: T,
                                height: E
                            }), 0 !== s || 180 !== F && -180 !== F || i.css({
                                top: C.top + "px"
                            }), 180 !== s || 180 !== F && -180 !== F || i.css({
                                top: Q - C.bottom + "px"
                            }), !f(x, y) || !f(D, C)) {
                            var U = new n;
                            U.left = y.left / r, U.top = m.getPageHeight() - y.top / r, U.right = y.right / r, U.bottom = m.getPageHeight() - y.bottom / r, o.normalize(U), p.setRect(U), U = null;
                            var V = new Date,
                                W = V.valueOf(),
                                X = Math.floor(W / 1e3).toString();
                            if (p.setModifyDate(X), $.isFunction(b) && b(g, p), 0 != a) {
                                var Y = e.getScrollApi();
                                if (null != Y) {
                                    y = g.PageRotateToScreen(y, e.getRotate()), x = g.PageRotateToScreen(x, e.getRotate());
                                    var Z = y.left - x.left,
                                        _ = y.right - x.right,
                                        aa = y.bottom - x.bottom,
                                        ba = $("#" + e.getDocViewContainerID()),
                                        ca = ba.height(),
                                        da = ba.width(),
                                        ea = ba.offset(),
                                        fa = $("#" + g.getPageViewContainerID()),
                                        ga = fa.offset();
                                    if (ca -= Y.getScrollBarHeight(), da -= Y.getScrollBarWidth(), aa > 0) ea.top + ca <= ga.top + y.bottom && Y.scrollByY(aa + 5);
                                    else if (0 > aa && ea.top >= ga.top + y.bottom - A) {
                                        var ha = Math.min(ea.top - (ga.top + y.top), ea.top + ca - (ga.top + y.bottom)),
                                            ia = Math.min(aa, -ha);
                                        Y.scrollByY(ia - 5)
                                    }
                                    switch (p.getTextAlign()) {
                                        case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                            if (Z > 0) {
                                                if (ea.left + da <= ga.left + y.right) {
                                                    var ja = Math.min(ga.left + y.right - (ea.left + da), ga.left + y.left - ea.left),
                                                        ka = Math.max(Z, ja);
                                                    Y.scrollByX(ka + 5)
                                                }
                                            } else 0 > Z && ea.left >= ga.left + y.left && Y.scrollByX(Z - 5);
                                            break;
                                        default:
                                            if (_ > 0) ea.left + da <= ga.left + y.right && Y.scrollByX(_ + 5);
                                            else if (0 > _ && ea.left >= ga.left + y.left) {
                                                var ja = Math.min(ea.left + da - (ga.left + y.right), ea.left - (ga.left + y.left)),
                                                    ka = Math.min(_, -ja);
                                                Y.scrollByX(ka - 5)
                                            }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            _calActualWidth: function(a) {
                var b = $('<div rows="1" width="auto"></div>');
                b.css({
                    position: "absolute",
                    margin: 0,
                    padding: 0,
                    display: "block",
                    width: "1px",
                    "float": "left",
                    "white-space": "nowrap",
                    visibility: "hidden",
                    font: a.css("font"),
                    "font-family": a.css("font-family"),
                    "font-size": a.css("font-size")
                }), a.after(b);
                for (var c = a.val(), d = c.split("\n"), e = d.length, f = 0, g = 10, h = 0; e > h; ++h) {
                    var i = WebPDF.Common.htmlEncode(d[h].replace(/ /g, "&nbsp;")),
                        j = b.html(i).get(0).scrollWidth;
                    f = Math.max(f, j), d[h].length > 0 && (g = Math.min(g, j / d[h].length)), i = null
                }
                return b.remove(), f + g / 2
            },
            _calActualLineHeight: function(a) {
                var b = $('<textarea rows="1">AbgH@</textarea>');
                b.css({
                    position: "absolute",
                    margin: 0,
                    padding: 0,
                    display: "block",
                    width: "1px",
                    "float": "left",
                    "white-space": "nowrap",
                    visibility: "hidden",
                    font: a.css("font"),
                    "font-family": a.css("font-family"),
                    "font-size": a.css("font-size")
                }), b.css("lineHeight", "normal"), a.after(b);
                var c = parseFloat(b.get(0).scrollHeight);
                return b.remove(), c
            },
            _setTextareaCursorPosition: function(a, b) {
                if (a.setSelectionRange) a.setSelectionRange(b, b);
                else if (a.createTextRange) {
                    var c = a.createTextRange();
                    a.value.length === b ? (c.collapse(!1), c.select()) : c.select()
                }
            },
            _addAndRemoveChangeValueEvent: function(a, b, c) {
                function d(a) {
                    if (!a || !WebPDF.Environment.ie || "value" == a.propertyName) {
                        e._spellCheck(1, c);
                        var b = h.getMainView().getDocView();
                        b.setModified(!0)
                    }
                }
                var e = this;
                WebPDF.Environment.ie8OrLower || WebPDF.Environment.ie9Compact || WebPDF.Environment.ie10Compact ? b ? a.attachEvent("onpropertychange", d) : a.detachEvent("onpropertychange", d) : b ? a.addEventListener("input", d, !1) : a.removeEventListener("input", d, !1)
            }
        }, b.createCalloutAnnotView = function(a, b) {
            return null == g && (g = new d(a, b)), g
        }
    }), define("core/Plugins/Annot/CalloutAnnotService", [], function(a, b, c) {
        function d(a, b) {
            f = b, g = this
        }
        var e, f;
        WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout = 100, WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft = 15;
        var g, h = WebPDF.PDFPoint,
            i = (WebPDF.PDFRect, WebPDF.RectUtils),
            j = 2,
            k = {};
        d.prototype = {
            getAnnot: function(a, b, c, d, e, f) {
                var g = WebPDF.AccountInstance.getUserConfig(),
                    j = new Date,
                    k = j.valueOf(),
                    l = Math.floor(k / 1e3).toString(),
                    m = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                    n = {
                        c: "",
                        ca: 1,
                        q: 0,
                        cd: l,
                        cl: g.annot.callout.clr,
                        bw: g.annot.callout.borderWidth,
                        fcl: g.annot.callout.fillColor,
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: l,
                        n: null,
                        subj: i18n.t("Annot.AnnotSubjCallout"),
                        subty: "FreeText",
                        le: ["OpenArrow", "None"],
                        tit: m,
                        ty: "Callout",
                        fs: WebPDF.Annot.TypewriteAnnotDefaultValue.FontSize / 1.33,
                        fh: WebPDF.Annot.TypewriteAnnotDefaultValue.FontHeight,
                        lnh: WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight,
                        fc: g.annot.callout.fontColor,
                        ftn: "Helvetica",
                        it: b,
                        r: 90 * c.getPDFPage().getPageRotate() + c.getDocView().getRotate(),
                        rc: null,
                        rd: null,
                        ftcl: null,
                        pdf: "false",
                        del: 0
                    };
                if (5 !== d.length) return null;
                for (var o = $(f).offset(), p = $("#" + c.getPageViewContainerID()).offset(), q = 0; q < d.length; q++) 270 === c.getDocView().getRotate() || 90 === c.getDocView().getRotate() ? (d[q].y = d[q].y - (p.left - o.left), d[q].x = d[q].x - (p.top - o.top)) : (d[q].x = d[q].x - (p.left - o.left), d[q].y = d[q].y - (p.top - o.top));
                d = this.updatePointArrayByPointArray(c, null, d);
                var r = this.getRectPoints(d, c);
                i.setRect(e, r[0].x, r[0].y, r[1].x, r[1].y), i.normalizeEx(e);
                var s, t, u, v, w, x, y = e.left,
                    z = e.top,
                    A = i.height(e),
                    B = i.width(e),
                    C = new WebPDF.PDFRect(y, z, y + B, z + A),
                    D = c.getPDFPage();
                s = new h(d[0].x, d[0].y), t = new h(d[1].x, d[1].y), u = new h(d[2].x, d[2].y), v = new h(d[3].x, d[3].y), w = new h(d[4].x, d[4].y), x = c.deviceRectToPDF(C, !0, 0), s = c.point2pdf(s), t = c.point2pdf(t), u = c.point2pdf(u), v = c.point2pdf(v), w = c.point2pdf(w), n.ftcl = [s.x, s.y, t.x, t.y, u.x, u.y], n.rc = [x.left, x.top, x.right, x.bottom];
                var E = c.getDocView().getRotate(),
                    F = 90 * c.getPDFPage().getPageRotate();
                0 === F ? 270 === E ? n.rd = [Math.abs(w.x - x.left), Math.abs(v.y - x.top), Math.abs(v.x - x.right), Math.abs(w.y - x.bottom)] : 180 === E ? n.rd = [Math.abs(w.x - x.left), Math.abs(w.y - x.top), Math.abs(v.x - x.right), Math.abs(v.y - x.bottom)] : 90 === E ? n.rd = [Math.abs(v.x - x.left), Math.abs(w.y - x.top), Math.abs(w.x - x.right), Math.abs(v.y - x.bottom)] : n.rd = [Math.abs(v.x - x.left), Math.abs(v.y - x.top), Math.abs(w.x - x.right), Math.abs(w.y - x.bottom)] : 90 === F ? 270 === E ? n.rd = [Math.abs(v.y - x.top), Math.abs(v.x - x.right), Math.abs(w.y - x.bottom), Math.abs(w.x - x.left)] : 180 === E ? n.rd = [Math.abs(w.y - x.top), Math.abs(v.x - x.right), Math.abs(v.y - x.bottom), Math.abs(w.x - x.left)] : 90 === E ? n.rd = [Math.abs(w.y - x.top), Math.abs(w.x - x.right), Math.abs(v.y - x.bottom), Math.abs(v.x - x.left)] : n.rd = [Math.abs(v.y - x.top), Math.abs(w.x - x.right), Math.abs(w.y - x.bottom), Math.abs(v.x - x.left)] : 180 === F ? 270 === E ? n.rd = [Math.abs(v.x - x.right), Math.abs(w.y - x.bottom), Math.abs(w.x - x.left), Math.abs(v.y - x.top)] : 180 === E ? n.rd = [Math.abs(v.x - x.right), Math.abs(v.y - x.bottom), Math.abs(w.x - x.left), Math.abs(w.y - x.top)] : 90 === E ? n.rd = [Math.abs(w.x - x.right), Math.abs(v.y - x.bottom), Math.abs(v.x - x.left), Math.abs(w.y - x.top)] : n.rd = [Math.abs(w.x - x.right), Math.abs(w.y - x.bottom), Math.abs(v.x - x.left), Math.abs(v.y - x.top)] : 270 === F && (270 === E ? n.rd = [Math.abs(w.y - x.bottom), Math.abs(w.x - x.left), Math.abs(v.y - x.top), Math.abs(v.x - x.right)] : 180 === E ? n.rd = [Math.abs(v.y - x.bottom), Math.abs(w.x - x.left), Math.abs(w.y - x.top), Math.abs(v.x - x.right)] : 90 === E ? n.rd = [Math.abs(v.y - x.bottom), Math.abs(v.x - x.left), Math.abs(w.y - x.top), Math.abs(w.x - x.right)] : n.rd = [Math.abs(w.y - x.bottom), Math.abs(v.x - x.left), Math.abs(v.y - x.top), Math.abs(w.x - x.right)]);
                var G = WebPDF.Annot.AnnotFactory.createAnnot(n, c.getPageIndex(), !1);
                D.getAnnotJsonData().push(n), D.addAnnot(G), c.setModified(!0), this.setPointsMapByAnnot(G, d);
                var H = [];
                H.push(G.annotJSONData);
                var I = new WebPDF.Annot.Undo(c.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, H);
                return WebPDF.Tool.getReaderApp().addAnnotUndo(I), {
                    pAnnot: G,
                    pageView: c,
                    pPDFPage: D
                }
            },
            getPointByEvent: function(a, b, c) {
                var d = c.pageX,
                    e = c.pageY,
                    f = $("#" + a.getPageViewContainerID()).offset(),
                    g = $(b).offset(),
                    h = d - f.left,
                    i = e - f.top;
                0 > h && (d = f.left), h > a.getPageViewWidth() && (d = f.left + a.getPageViewWidth()), 0 > i && (e = f.top), i > a.getPageViewHeight() && (e = f.top + a.getPageViewHeight());
                var j = null,
                    k = a.getDocView().getRotate(),
                    l = $(b).width(),
                    m = $(b).height();
                return j = 90 === k ? new WebPDF.PDFPoint(e - g.top, m - (d - g.left)) : 180 === k ? new WebPDF.PDFPoint(l - (d - g.left), m - (e - g.top)) : 270 === k ? new WebPDF.PDFPoint(l - (e - g.top), d - g.left) : new WebPDF.PDFPoint(d - g.left, e - g.top)
            },
            initPointArrayByAnnot: function(a, b) {
                var c = b.getRect(),
                    d = b.getRectDiffer(),
                    e = b.getFreeCoordinatesLine(),
                    h = new WebPDF.PDFPoint(e[0], e[1]),
                    i = null,
                    j = null;
                4 === e.length ? (i = new WebPDF.PDFPoint(e[0], e[1]), j = new WebPDF.PDFPoint(e[2], e[3])) : (i = new WebPDF.PDFPoint(e[2], e[3]), j = new WebPDF.PDFPoint(e[4], e[5]));
                var k = f.getPixelsPerPoint(),
                    l = k * a.getScale(),
                    m = 8 / l;
                (d.left < m || d.right < m || d.top < m || d.bottom < m) && (d.left = d.left + m, d.right = d.right + m, d.top = d.top + m, d.bottom = d.bottom + m, c.left > c.right ? (c.left = c.left + m, c.right = c.right - m) : (c.left = c.left - m, c.right = c.right + m), c.top > c.bottom ? (c.top = c.top + m, c.bottom = c.bottom - m) : (c.top = c.top - m, c.bottom = c.bottom + m)), b.setRectDiffer(d), b.setRect(c);
                var n = new WebPDF.PDFPoint(c.left + d.left, c.top - d.top),
                    o = new WebPDF.PDFPoint(c.right - d.right, c.bottom + d.bottom);
                c = a.pdfRectToDevice(c, !0), h = a.pdfPtToDevice(h), i = a.pdfPtToDevice(i), j = a.pdfPtToDevice(j), n = a.pdfPtToDevice(n), o = a.pdfPtToDevice(o);
                var p = new Array(5);
                p[0] = h, p[1] = i, p[2] = j;
                var q = b.getRotate() - 90 * a.getPDFPage().getPageRotate();
                return p[4] = new WebPDF.PDFPoint(0, 0), p[3] = new WebPDF.PDFPoint(0, 0), 90 === q ? (n.x < o.x ? (p[4].x = o.x, p[3].x = n.x) : (p[4].x = n.x, p[3].x = o.x), n.y < o.y ? (p[4].y = o.y, p[3].y = n.y) : (p[4].y = n.y, p[3].y = o.y)) : 180 === q ? (n.x > o.x ? (p[4].x = o.x, p[3].x = n.x) : (p[4].x = n.x, p[3].x = o.x), n.y < o.y ? (p[4].y = o.y, p[3].y = n.y) : (p[4].y = n.y, p[3].y = o.y)) : 270 === q ? (n.x > o.x ? (p[4].x = o.x, p[3].x = n.x) : (p[4].x = n.x, p[3].x = o.x), n.y > o.y ? (p[4].y = o.y, p[3].y = n.y) : (p[4].y = n.y, p[3].y = o.y)) : (p[3] = n, p[4] = o), g.setPointsByAnnot(b, p, c), p = g.getPointArrayRect(p, c)
            },
            initPointArrayByStartPoint: function(a, b, c, d) {
                j = 2, b = new Array(5);
                for (var e = 0; e < b.length; e++) b[e] = new WebPDF.PDFPoint(0, 0);
                var f = a.getDocView().getRotate(),
                    g = a.getPageViewWidth(),
                    h = a.getPageViewHeight(),
                    i = parseInt($(d).css("top")),
                    k = parseInt($(d).css("left"));
                if (90 === f) {
                    b[0].x = c.x, b[0].y = c.y, b[1].x = c.x, b[1].y = c.y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].x = c.x, b[2].y = c.y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[3].y = b[2].y, b[4].x = b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout;
                    var l = 0;
                    if (b[3].x < 0 && (l = b[3].x), b[4].x > h - i && (l = b[4].x - (h - i)), 0 !== l) {
                        for (var e = 1; 4 >= e; e++) b[e].x = b[e].x - l;
                        for (var e = 2; 4 >= e; e++) b[e].y -= 10
                    }
                    if (b[4].y < 0 && (b[1].y = c.y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].y = c.y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].y = b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].y = b[2].y, 0 !== l))
                        for (var e = 2; 4 >= e; e++) b[e].y += 10
                } else if (180 === f) {
                    b[0].x = c.x, b[0].y = c.y, b[1].x = c.x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[1].y = c.y, b[2].x = c.x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].y = c.y, b[3].x = b[2].x, b[3].y = b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].x = b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2;
                    var m = 0;
                    if (b[4].y < 0 && (m = b[4].y), b[3].y > h - i && (m = b[3].y - (h - i)), 0 !== m) {
                        for (var e = 1; 4 >= e; e++) b[e].y = b[e].y - m;
                        for (var e = 2; 4 >= e; e++) b[e].x -= 10
                    }
                    if (b[4].x + k < 0 && (b[1].x = c.x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].x = c.x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].x = b[2].x, 0 !== m))
                        for (var e = 2; 4 >= e; e++) b[e].x += 10
                } else if (270 === f) {
                    b[0].x = c.x, b[0].y = c.y, b[1].x = c.x, b[1].y = c.y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].x = c.x, b[2].y = c.y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[3].y = b[2].y, b[4].x = b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].y = b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout;
                    var l = 0;
                    if (b[4].x < 0 && (l = b[4].x), b[3].x > h - i && (l = b[3].x - (h - i)), 0 !== l) {
                        for (var e = 1; 4 >= e; e++) b[e].x = b[e].x - l;
                        for (var e = 2; 4 >= e; e++) b[e].y += 10
                    }
                    if (b[4].y > g - k && (b[1].y = c.y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].y = c.y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].y = b[2].y, 0 !== l))
                        for (var e = 2; 4 >= e; e++) b[e].y -= 10
                } else {
                    b[0].x = c.x, b[0].y = c.y, b[1].x = c.x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[1].y = c.y, b[2].x = c.x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].y = c.y, b[3].x = b[2].x, b[3].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].x = b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].y = b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2;
                    var m = 0;
                    if (b[3].y < 0 && (m = b[3].y), b[4].y > h - i && (m = b[4].y - (h - i)), 0 !== m) {
                        for (var e = 1; 4 >= e; e++) b[e].y = b[e].y - m;
                        for (var e = 2; 4 >= e; e++) b[e].x += 10
                    }
                    if (b[4].x > g - k && (b[1].x = c.x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].x = c.x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].x = b[2].x, 0 !== m))
                        for (var e = 2; 4 >= e; e++) b[e].x -= 10
                }
                return b
            },
            updatePointArray: function(a, b, c, d, e, f) {
                var g, h, i, k, l = a.getDocView().getRotate(),
                    m = a.getPageViewWidth(),
                    n = a.getPageViewHeight(),
                    o = parseInt($(e).css("top")),
                    p = parseInt($(e).css("left"));
                if (void 0 !== f && (f -= 90 * a.getPDFPage().getPageRotate(), l = f), 90 === l) {
                    if (-1 === d) {
                        b[1].x = c.x, b[1].y = c.y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].x = c.x, b[2].y = c.y, b[3].x = b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[3].y = b[2].y, b[4].x = b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout;
                        var q = 0;
                        if (b[3].x < 0 && (q = b[3].x), b[4].x > n - o && (q = b[4].x - (n - o)), 0 !== q) {
                            for (var r = 1; 4 >= r; r++) b[r].x = b[r].x - q;
                            for (var r = 2; 4 >= r; r++) b[r].y -= 10
                        }
                        if (p = Math.abs($("#" + a.getPageViewContainerID()).offset().left - $(e).offset().left), b[4].y - p < 0 && (b[4].y = p, b[3].y = p + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[1].y = b[3].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].y = b[3].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, 0 !== q))
                            for (var r = 2; 4 >= r; r++) b[r].y += 10
                    } else c.x < 0 && (c.x = 0), c.y < 0 && (c.y = 0), c.x > n && (c.x = n), c.y > m && (c.y = m);
                    0 === d ? (b[0].x = c.x, b[0].y = c.y) : 1 === d ? b[1].x === b[2].x ? b[1].y > b[2].y ? c.y - b[2].y > 10 && (b[1].y = c.y) : b[2].y - c.y > 10 && (b[1].y = c.y) : b[1].x > b[2].x ? c.x - b[2].x > 10 && (b[1].x = c.x) : b[2].x - c.x > 10 && (b[1].x = c.x) : 2 === d ? b[1].x === b[2].x ? b[1].y > b[2].y ? c.y - b[4].y > 20 && (b[2].y = c.y, b[3].y = c.y) : b[3].y - c.y > 20 && (b[2].y = c.y, b[4].y = c.y) : b[1].x > b[2].x ? c.x - b[3].x > 20 && (b[2].x = c.x, b[4].x = c.x) : b[4].x - c.x > 20 && (b[2].x = c.x, b[3].x = c.x) : 3 === d ? (b[4].x - c.x > 20 && (b[3].x = c.x), c.y - b[4].y > 20 && (b[3].y = c.y)) : 4 === d ? (c.x - b[3].x > 20 && (b[4].x = c.x), b[3].y - c.y > 20 && (b[4].y = c.y)) : b[4].x > n && (b[4].x = n, b[3].x = n - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight, b[2].x = n - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[1].x = b[2].x), g = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[3].y - b[0].y) * (b[3].y - b[0].y), h = (b[3].x - b[0].x) * (b[3].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y), i = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[4].y - b[0].y) * (b[4].y - b[0].y), k = (b[4].x - b[0].x) * (b[4].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y)
                } else if (180 === l) {
                    if (-1 === d) {
                        b[1].x = c.x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[1].y = c.y, b[2].x = c.x, b[2].y = c.y, b[3].x = b[2].x, b[3].y = b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].x = b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2;
                        var s = 0;
                        if (b[4].y < 0 && (s = b[4].y), b[3].y > n - o && (s = b[3].y - (n - o)), 0 !== s) {
                            for (var r = 1; 4 >= r; r++) b[r].y = b[r].y - s;
                            for (var r = 2; 4 >= r; r++) b[r].x -= 10
                        }
                        if (b[4].x + p <= 0 && (b[4].x = -p, b[3].x = b[4].x + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[1].x = b[3].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].x = b[3].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, 0 !== s))
                            for (var r = 2; 4 >= r; r++) b[r].x += 10
                    } else c.x < 0 && (c.x = 0), c.y < 0 && (c.y = 0), c.x > m && (c.x = m), c.y > n && (c.y = n);
                    0 === d ? (b[0].x = c.x, b[0].y = c.y) : 1 === d ? b[1].x === b[2].x ? b[1].y > b[2].y ? c.y - b[2].y > 10 && (b[1].y = c.y) : b[2].y - c.y > 10 && (b[1].y = c.y) : b[1].x > b[2].x ? c.x - b[2].x > 10 && (b[1].x = c.x) : b[2].x - c.x > 10 && (b[1].x = c.x) : 2 === d ? b[1].x === b[2].x ? b[1].y > b[2].y ? c.y - b[4].y > 20 && (b[2].y = c.y, b[3].y = c.y) : b[3].y - c.y > 20 && (b[2].y = c.y, b[4].y = c.y) : b[1].x > b[2].x ? c.x - b[4].x > 20 && (b[2].x = c.x, b[3].x = c.x) : b[3].x - c.x > 20 && (b[2].x = c.x, b[4].x = c.x) : 3 === d ? (c.x - b[4].x > 20 && (b[3].x = c.x), c.y - b[4].y > 20 && (b[3].y = c.y)) : (b[3].x - c.x > 20 && (b[4].x = c.x), b[3].y - c.y > 20 && (b[4].y = c.y)), g = (b[3].x - b[0].x) * (b[3].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y), h = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[3].y - b[0].y) * (b[3].y - b[0].y), i = (b[4].x - b[0].x) * (b[4].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y), k = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[4].y - b[0].y) * (b[4].y - b[0].y)
                } else if (270 === l) {
                    if (-1 === d) {
                        b[1].x = c.x, b[1].y = c.y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[2].x = c.x, b[2].y = c.y, b[3].x = b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[3].y = b[2].y, b[4].x = b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].y = b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout;
                        var q = 0;
                        if (b[4].x < 0 && (q = b[4].x), b[3].x > n - o && (q = b[3].x - (n - o)), 0 !== q) {
                            for (var r = 1; 4 >= r; r++) b[r].x = b[r].x - q;
                            for (var r = 2; 4 >= r; r++) b[r].y += 10
                        }
                        if (p = Math.abs($("#" + a.getPageViewContainerID()).offset().left - $(e).offset().left), b[4].y > m + p && (b[4].y = m + p, b[3].y = b[4].y - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[2].y = b[3].y, b[1].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, 0 !== q))
                            for (var r = 2; 4 >= r; r++) b[r].y -= 10
                    } else c.x < 0 && (c.x = 0), c.y < 0 && (c.y = 0), c.x > n && (c.x = n), c.y > m && (c.y = m);
                    0 === d ? (b[0].x = c.x,
                        b[0].y = c.y) : 1 === d ? b[1].x === b[2].x ? b[1].y > b[2].y ? c.y - b[2].y > 10 && (b[1].y = c.y) : b[2].y - c.y > 10 && (b[1].y = c.y) : b[1].x > b[2].x ? c.x - b[2].x > 10 && (b[1].x = c.x) : b[2].x - c.x > 10 && (b[1].x = c.x) : 2 === d ? b[1].x === b[2].x ? b[1].y > b[2].y ? c.y - b[3].y > 20 && (b[2].y = c.y, b[4].y = c.y) : b[4].y - c.y > 20 && (b[2].y = c.y, b[3].y = c.y) : b[1].x > b[2].x ? c.x - b[4].x > 20 && (b[2].x = c.x, b[3].x = c.x) : b[3].x - c.x > 20 && (b[2].x = c.x, b[4].x = c.x) : 3 === d ? (c.x - b[4].x > 20 && (b[3].x = c.x), b[4].y - c.y > 20 && (b[3].y = c.y)) : 4 === d && (b[3].x - c.x > 20 && (b[4].x = c.x), c.y - b[3].y > 20 && (b[4].y = c.y)), g = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[3].y - b[0].y) * (b[3].y - b[0].y), h = (b[3].x - b[0].x) * (b[3].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y), i = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[4].y - b[0].y) * (b[4].y - b[0].y), k = (b[4].x - b[0].x) * (b[4].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y)
                } else {
                    if (-1 === d) {
                        b[1].x = c.x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[1].y = c.y, b[2].x = c.x, b[2].y = c.y, b[3].x = b[2].x, b[3].y = b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, b[4].x = b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[4].y = b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2;
                        var s = 0;
                        if (b[3].y < 0 && (s = b[3].y), b[4].y > n - o && (s = b[4].y - (n - o)), 0 !== s) {
                            for (var r = 1; 4 >= r; r++) b[r].y = b[r].y - s;
                            for (var r = 2; 4 >= r; r++) b[r].x += 10
                        }
                        if (b[4].x > m - p && (b[4].x = m - p, b[3].x = b[4].x - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthCallout, b[2].x = b[3].x + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight / 2, 0 !== s))
                            for (var r = 2; 4 >= r; r++) b[r].x -= 10
                    } else c.x < 0 && (c.x = 0), c.y < 0 && (c.y = 0), c.x > m && (c.x = m), c.y > n && (c.y = n);
                    0 === d ? (b[0].x = c.x, b[0].y = c.y) : 1 === d ? b[2].x === b[1].x ? b[2].y > b[1].y ? b[2].y - c.y > 10 && (b[1].y = c.y) : c.y - b[2].y > 10 && (b[1].y = c.y) : b[2].x > b[1].x ? b[2].x - c.x > 10 && (b[1].x = c.x) : c.x - b[2].x > 10 && (b[1].x = c.x) : 2 === d ? b[2].x === b[1].x ? b[2].y > b[1].y ? b[4].y - c.y > 20 && (b[2].y = c.y, b[3].y = b[2].y) : b[2].y - c.y > 20 && (b[2].y = c.y, b[4].y = b[2].y) : b[2].x > b[1].x ? b[4].x - c.x > 20 && (b[2].x = c.x, b[3].x = b[2].x) : b[2].x - c.x > 20 && (b[2].x = c.x, b[4].x = b[2].x) : 3 === d ? (b[4].x - c.x > 20 && (b[3].x = c.x, b[2].x = c.x), b[4].y - c.y > 20 && (b[3].y = c.y)) : 4 === d && (c.x - b[3].x > 20 && (b[4].x = c.x), c.y - b[3].y > 20 && (b[4].y = c.y)), g = (b[3].x - b[0].x) * (b[3].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y), h = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[3].y - b[0].y) * (b[3].y - b[0].y), i = (b[4].x - b[0].x) * (b[4].x - b[0].x) + ((b[3].y + b[4].y) / 2 - b[0].y) * ((b[3].y + b[4].y) / 2 - b[0].y), k = ((b[3].x + b[4].x) / 2 - b[0].x) * ((b[3].x + b[4].x) / 2 - b[0].x) + (b[4].y - b[0].y) * (b[4].y - b[0].y)
                }
                if (1 === d) return b;
                var t = 2,
                    u = g;
                return u > h && (u = h, t = 4), u > i && (u = i, t = 6), u > k && (t = 8), 90 === l ? 2 === t ? (b[1].x = (b[3].x + b[4].x) / 2, b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].y && (b[1].y = b[3].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[3].x + b[4].x) / 2, b[2].y = b[3].y, b[1].y - b[3].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].y = b[2].y)) : 4 === t ? (b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].x && (b[1].x = b[3].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[4].y + b[3].y) / 2, b[2].x = b[3].x, b[2].y = (b[4].y + b[3].y) / 2, b[3].x - b[1].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x)) : 6 === t ? (b[1].x = (b[4].x + b[3].x) / 2, b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].y && (b[1].y = b[4].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[4].x + b[3].x) / 2, b[2].y = b[4].y, b[4].y - b[1].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].y = b[2].y)) : (b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].x && (b[1].x = b[4].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[4].y + b[3].y) / 2, b[2].x = b[4].x, b[2].y = (b[4].y + b[3].y) / 2, b[1].x - b[4].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].x = b[2].x)) : 180 === l ? 2 === t ? (b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].x && (b[1].x = b[3].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[4].y + b[3].y) / 2, b[2].x = b[3].x, b[2].y = (b[4].y + b[3].y) / 2, b[1].x - b[3].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x)) : 4 === t ? (b[1].x = (b[3].x + b[4].x) / 2, b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].y && (b[1].y = b[3].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[3].x + b[4].x) / 2, b[2].y = b[3].y, b[1].y - b[3].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].y = b[2].y)) : 6 === t ? (b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].x && (b[1].x = b[4].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[3].y + b[4].y) / 2, b[2].x = b[4].x, b[2].y = (b[3].y + b[4].y) / 2, b[4].x - b[1].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].x = b[2].x)) : (b[1].x = (b[3].x + b[4].x) / 2, b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].y && (b[1].y = b[4].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[3].x + b[4].x) / 2, b[2].y = b[4].y, b[4].y - b[1].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].y = b[2].y)) : 270 === l ? 2 === t ? (b[1].x = (b[3].x + b[4].x) / 2, b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].y && (b[1].y = b[3].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[3].x + b[4].x) / 2, b[2].y = b[3].y, b[3].y - b[1].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].y = b[2].y)) : 4 === t ? (b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].x && (b[1].x = b[3].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[3].y + b[4].y) / 2, b[2].x = b[3].x, b[2].y = (b[3].y + b[4].y) / 2, b[1].x - b[3].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x)) : 6 === t ? (b[1].x = (b[4].x + b[3].x) / 2, b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].y && (b[1].y = b[4].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[4].x + b[3].x) / 2, b[2].y = b[4].y, b[1].y - b[4].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].y = b[2].y)) : (b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].x && (b[1].x = b[4].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[4].y + b[3].y) / 2, b[2].x = b[4].x, b[2].y = (b[4].y + b[3].y) / 2, b[4].x - b[1].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].x = b[2].x)) : 2 === t ? (b[2].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].x && (b[1].x = b[3].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[3].y + b[4].y) / 2, b[2].x = b[3].x, b[2].y = (b[3].y + b[4].y) / 2, b[3].x - b[1].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].x = b[2].x)) : 4 === t ? (b[1].x = (b[3].x + b[4].x) / 2, b[2].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft >= b[0].y && (b[1].y = b[3].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[3].x + b[4].x) / 2, b[2].y = b[3].y, b[3].y - b[1].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[3].y = b[2].y)) : 6 === t ? (b[2].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].x && (b[1].x = b[4].x + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[1].y = (b[3].y + b[4].y) / 2, b[2].x = b[4].x, b[2].y = (b[3].y + b[4].y) / 2, b[1].x - b[4].x < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].x = b[1].x - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].x = b[2].x)) : (b[1].x = (b[3].x + b[4].x) / 2, b[2].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft <= b[0].y && (b[1].y = b[4].y + WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft), b[2].x = (b[3].x + b[4].x) / 2, b[2].y = b[4].y, b[1].y - b[4].y < WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft && (b[2].y = b[1].y - WebPDF.Annot.TypewriteAnnotDefaultValue.kneePointLeft, b[4].y = b[2].y)), j = t, b
            },
            setPointsByAnnot: function(a, b, c) {
                var d = a.getAnnotName(),
                    e = null;
                e = new Array(b.length);
                for (var f = 0; f < e.length; f++) e[f] = new WebPDF.PDFPoint(b[f].x, b[f].y);
                k[d] = e
            },
            setPagePointsByAnnot: function(a, b, c, d) {
                var e = a.getAnnotName(),
                    f = $("#" + b.getPageViewContainerID()).offset(),
                    g = $(d).offset(),
                    h = null;
                h = new Array(c.length);
                for (var i = 0; i < h.length; i++) h[i] = new WebPDF.PDFPoint(c[i].x - (f.left - g.left), c[i].y - (f.top - g.top));
                k[e] = h
            },
            setPointsMapByAnnot: function(a, b) {
                var c = a.getAnnotName();
                k[c] = b
            },
            getPointsToAnnotCanvas: function(a, b) {
                var c = null;
                c = new Array(a.length);
                for (var d = 0; d < c.length; d++) c[d] = new WebPDF.PDFPoint(a[d].x - b[0].x, a[d].y - b[0].y);
                return c
            },
            copyRectArr: function(a) {
                var b = null;
                b = new Array(a.length);
                for (var c = 0; c < b.length; c++) b[c] = new WebPDF.PDFPoint(a[c].x, a[c].y);
                return b
            },
            getPointsByAnnot: function(a) {
                var b = a.getAnnotName();
                return k[b]
            },
            getMinDistancePoint: function() {
                return j
            },
            getPointArrayRect: function(a, b) {
                for (var c = new Array(a.length), d = 0; d < c.length; d++) c[d] = new WebPDF.PDFPoint(a[d].x - b.left, a[d].y - b.top);
                return c
            },
            getRectPoints: function(a, b) {
                var c = 1;
                b && (c = b.getScale());
                for (var d = new Array(2), e = new h(a[0].x, a[0].y), f = new h(a[0].x, a[0].y), g = 1; g < a.length; g++) a[g].x < e.x && (e.x = a[g].x), a[g].y < e.y && (e.y = a[g].y), a[g].x > f.x && (f.x = a[g].x), a[g].y > f.y && (f.y = a[g].y);
                return e.x = e.x - 8 * c, e.y = e.y - 8 * c, f.x = f.x + 8 * c, f.y = f.y + 8 * c, d[0] = e, d[1] = f, d
            },
            updatePointArrayByPointArray: function(a, b, c) {
                var d = c[3].x > c[4].x ? c[4].x : c[3].x,
                    e = c[3].x > c[4].x ? c[3].x : c[4].x,
                    f = c[3].y > c[4].y ? c[4].y : c[3].y,
                    g = c[3].y > c[4].y ? c[3].y : c[4].y,
                    h = a.getDocView().getRotate();
                b && (h = b.getRotate() - 90 * a.getPDFPage().getPageRotate(), 0 > h && (h += 360));
                var i = !1;
                if (c[0].x > d - 5 && c[0].x < e + 5 && c[0].y > f - 5 && c[0].y < g + 5 && (i = !0), !i) return c;
                var j = a.getPageViewWidth(),
                    k = a.getPageViewHeight(),
                    l = k;
                (90 === h || 270 === h) && (k = j, j = l);
                var m = c[0].y - c[1].y,
                    n = c[0].x - c[1].x,
                    o = 0,
                    p = c[1].x === c[2].x ? !1 : !0;
                p ? ((e >= j || e + n >= j) && n > 0 && (o = j - e - n), (0 >= d || 0 >= d + n) && 0 > n && (o = -(d + n))) : ((g >= k || g + m >= k) && m > 0 && (o = k - g - m), (0 >= f || 0 >= f + m) && 0 > m && (o = -(f + m)));
                for (var q = 1; 4 >= q; q++) p ? c[q].x += n : c[q].y += m;
                if (0 !== o)
                    for (var r = 0; 4 >= r; r++) p ? c[r].x += o : c[r].y += o;
                return c
            },
            moveAnnot: function(a, b, c, d) {
                for (var e = this.getPointsByAnnot(b), f = 0; f < e.length; f++) e[f].x = e[f].x + c, e[f].y = e[f].y + d;
                var g = new WebPDF.PDFPoint(e[0].x, e[0].y),
                    h = new WebPDF.PDFPoint(e[1].x, e[1].y),
                    i = new WebPDF.PDFPoint(e[2].x, e[2].y);
                g = a.point2pdf(g), h = a.point2pdf(h), i = a.point2pdf(i), b.setFreeCoordinatesLine([g.x, g.y, h.x, h.y, i.x, i.y])
            },
            moveAnnotRecord: function(a, b) {
                var c = "[" + b.getRect().left + " " + b.getRect().top + " " + b.getRect().right + " " + b.getRect().bottom + "]",
                    d = '{"Type":"' + b.getSubType() + '", "ActionType":"Edit", "PageIndex":"' + a.getPageIndex() + '", "Rect":"' + c + '"}';
                f.addRecord("Comment", "Comment", d)
            },
            addAnnotRecord: function(a, b) {
                var c = "[" + a.getRect().left + " " + a.getRect().top + " " + a.getRect().right + " " + a.getRect().bottom + "]",
                    d = '{"Type":"' + a.getSubType() + '", "ActionType":"Add", "PageIndex":"' + b.getPageIndex() + '", "Rect":"' + c + '"}';
                f.addRecord("Comment", "Comment", d)
            },
            isTypewritersType: function(a) {
                return a.toLowerCase() == WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT.toLowerCase() ? !0 : !1
            },
            setAnnotColor: function(a, b, c) {
                c = WebPDF.Common.rgb2HexColor(c), b.setColor(c), f.setModified(a, a.getDocView(), !0)
            },
            setAnnotFillColor: function(a, b, c) {
                b.setFillColor(c), f.setModified(a, a.getDocView(), !0)
            },
            getRdToPdfPt: function(a, b) {
                var c = [],
                    d = a.getRect(),
                    e = a.getRectDiffer(),
                    f = new WebPDF.PDFPoint(0, 0),
                    g = new WebPDF.PDFPoint(0, 0),
                    h = 90 * b.getPDFPage().getPageRotate();
                180 === h ? (g.x = d.right - e.left, g.y = d.bottom + e.top, f.x = e.right + d.left, f.y = d.top - e.bottom) : 90 === h ? (f.y = d.top - e.left, g.x = d.right - e.top, g.y = e.right + d.bottom, f.x = e.bottom + d.left) : 270 === h ? (f.x = e.top + d.left, f.y = d.top - e.right, g.x = d.right - e.bottom, g.y = e.left + d.bottom) : (f.x = e.left + d.left, f.y = d.top - e.top, g.x = d.right - e.right, g.y = e.bottom + d.bottom), c[0] = new WebPDF.PDFPoint(0, 0), c[1] = new WebPDF.PDFPoint(0, 0);
                var i = a.getRotate() - h;
                return 90 === i ? (f.x < g.x ? (c[1].x = g.x, c[0].x = f.x) : (c[1].x = f.x, c[0].x = g.x), f.y < g.y ? (c[1].y = g.y, c[0].y = f.y) : (c[1].y = f.y, c[0].y = g.y)) : 180 === i ? (f.x > g.x ? (c[1].x = g.x, c[0].x = f.x) : (c[1].x = f.x, c[0].x = g.x), f.y < g.y ? (c[1].y = g.y, c[0].y = f.y) : (c[1].y = f.y, c[0].y = g.y)) : 270 === i ? (f.x > g.x ? (c[1].x = g.x, c[0].x = f.x) : (c[1].x = f.x, c[0].x = g.x), f.y > g.y ? (c[1].y = g.y, c[0].y = f.y) : (c[1].y = f.y, c[0].y = g.y)) : (c[0] = f, c[1] = g), c
            },
            canAnswer: function(a, b) {
                if (!f.isEditable()) return !1;
                var c = a.getIT();
                if (!this.isTypewritersType(c) || !a.isVisible()) return !1;
                var d = f.getCurToolHandler();
                if (null != d) {
                    var e = d.getName();
                    if (e === WebPDF.Tools.TOOL_NAME_SELANNOT || e === WebPDF.Tools.TOOL_NAME_HAND || e.toLowerCase() === b.toLowerCase()) return !0
                }
            }
        }, b.createCalloutAnnotService = function(a, b) {
            return null == e && (e = new d(a, b)), e
        }
    }), define("core/Plugins/Annot/TextboxAnnotHandler", ["core/Plugins/Annot/TextboxAnnotView", "core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/TextboxAnnotService", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"], function(a, b, c) {
        var d, e, f, g, h = (WebPDF.PDFRect, WebPDF.RectUtils, WebPDF.Common.Direc);
        return WebPDF.TextboxAnnotHandler = function(b, c, h) {
            this.readerApp = b, this.annotType = c, this.annotHandlerManager = h, this.annotUIManager = h.getUIManager(), f = a("core/Plugins/Annot/TextboxAnnotView").createTextboxAnnotView(h, b), e = a("core/Plugins/Annot/TextboxAnnotService").createTextboxAnnotService(h, b);
            var i = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotService");
            g = new i(WebPDF.Tools.TOOL_NAME_INKANNOT), g.addMatchToolType(WebPDF.Tools.TOOL_NAME_INKANNOT);
            var j = WebPDF.AccountInstance.getUserConfig(),
                k = ["#737FFB", "#FFFF01", "#CCFF66", "#01FFFF", "#99CCFF", "#CB98FE", "#FF9999", "#FF0000", "#C3C3C3", "#010101"],
                l = {
                    title: i18n.t("AnnotProperties.TextboxTitle"),
                    colorArr: k,
                    drawingConfig: j.annot.textbox
                };
            this.commentPropertyDlg = new CommentPropertyDlg(null, null, l), this.commentPropertyDlg.setAnnotHandler(this), this.init(), d = this
        }, WebPDF.TextboxAnnotHandler.prototype = {
            changeRect: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = this.annotUIManager.getTextboxAnnotRectDivID(a, d);
                $("#" + e).removeClass("default-add"), this.onUpdatePosition(a, b), f.updateBorder(a, b, !0)
            },
            setAnnotProperty: function(a, b, c, d) {
                var e = WebPDF.Common.getReaderApp();
                if (e.isEditable()) {
                    var f = {
                        annot: b,
                        event: c,
                        multiSelect: d,
                        pageView: a
                    };
                    this.commentPropertyDlg.setOptions(f), this.commentPropertyDlg.show(c.pageX, c.pageY, f)
                }
            },
            onAnnotChangeFinish: function(a, b) {
                if (!a || !b) return !1;
                var c = f.getMoveDivRect(a, b);
                WebPDF.RectUtils.offset(c, 0, 0);
                var d = b.getRect(),
                    e = a.pdfRectToDevice(d, !0);
                if (WebPDF.RectUtils.equal(c, e)) return !1;
                this.setAnnotRect(a, b, c), this.changeRect(a, b, null);
                var g = [],
                    h = {
                        name: b.getAnnotName(),
                        newRect: b.getRect(),
                        oldRect: d
                    };
                g.push(h);
                var i = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_MOVE, g);
                return WebPDF.Common.getReaderApp().addAnnotUndo(i), !0
            },
            geometricScalingRect: function(a, b, c, d, e, f, g, i) {
                function j(a, b, c, d) {
                    var e = a.getPageViewHeight(),
                        f = a.getPageViewWidth(),
                        g = !1,
                        h = a.PtPageRotateToScreen(b, a.getDocView().getRotate()),
                        i = h.x + c,
                        j = h.y + d;
                    return i > f ? (c = f - h.x, g = !0) : 0 > i && (c = 0 - h.x, g = !0), j > e ? (d = e - h.y, g = !0) : 0 > j && (d = 0 - h.y, g = !0), g ? {
                        x: 0,
                        y: 0
                    } : {
                        x: c,
                        y: d
                    }
                }

                function k(a, b, c, d, e, f, g) {
                    var i = 0,
                        k = 0,
                        l = !1,
                        m = a.getPageViewHeight(),
                        n = a.getPageViewWidth(),
                        o = a.getDocView().getRotate(),
                        p = c - e,
                        q = d - f;
                    if (g == h.MOVE_START) {
                        var r = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.left, b.top), a.getDocView().getRotate()),
                            s = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.right, b.bottom), a.getDocView().getRotate()),
                            i = r.x + p,
                            k = r.y + q;
                        return Math.abs(s.x - i) < minLineDistance && Math.abs(s.y - k) < minLineDistance ? {
                            x: 0,
                            y: 0
                        } : j(a, new WebPDF.PDFPoint(b.left, b.top), p, q)
                    }
                    if (g == h.MOVE_END) {
                        var r = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.left, b.top), a.getDocView().getRotate()),
                            s = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.right, b.bottom), a.getDocView().getRotate()),
                            i = s.x + p,
                            k = s.y + q;
                        return Math.abs(i - r.x) < minLineDistance && Math.abs(k - r.y) < minLineDistance ? {
                            x: 0,
                            y: 0
                        } : j(a, new WebPDF.PDFPoint(b.right, b.bottom), p, q)
                    }
                    return b = a.PageRotateToScreen(b, o), g == h.LEFT_TOP ? (i = b.left + p, k = b.top + q) : g == h.RIGHT_TOP ? (i = b.right + p, k = b.top + q) : g == h.RIGHT_BOTTOM ? (i = b.right + p, k = b.bottom + q) : g == h.LEFT_BOTTOM ? (i = b.left + p, k = b.bottom + q) : g == h.RIGHT ? i = b.right + p : g == h.LEFT ? i = b.left + p : g == h.TOP ? k = b.top + q : g == h.BOTTOM && (k = b.bottom + q), i > n ? (p = n - b.right, l = !0) : 0 > i && (p = 0 - b.left, l = !0), k > m ? (q = m - b.bottom, l = !0) : 0 > k && (q = 0 - b.top, l = !0), l ? {
                        x: 0,
                        y: 0
                    } : {
                        x: p,
                        y: q
                    }
                }

                function l(a, b, c, d, e, f) {
                    var g = a.PageRotateToScreen(b, a.getDocView().getRotate());
                    g.left += c, g.top += d, g.right += e, g.bottom += f, WebPDF.RectUtils.normalizeEx(g), g = a.deviceRectToPageRotate(g, a.getDocView().getRotate()), WebPDF.RectUtils.copy(g, b)
                }

                function m(a, b, c, d) {
                    var e = a.getDocView().getRotate();
                    switch (c) {
                        case h.LEFT_TOP:
                            l(a, b, d.x, d.y, 0, 0);
                            break;
                        case h.RIGHT_TOP:
                            l(a, b, 0, d.y, d.x, 0);
                            break;
                        case h.LEFT_BOTTOM:
                            l(a, b, d.x, 0, 0, d.y);
                            break;
                        case h.RIGHT_BOTTOM:
                            l(a, b, 0, 0, d.x, d.y);
                            break;
                        case h.LEFT:
                            l(a, b, d.x, 0, 0, 0);
                            break;
                        case h.RIGHT:
                            l(a, b, 0, 0, d.x, 0);
                            break;
                        case h.TOP:
                            l(a, b, 0, d.y, 0, 0);
                            break;
                        case h.BOTTOM:
                            l(a, b, 0, 0, 0, d.y);
                            break;
                        case h.MOVE_START:
                            var f = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.left, b.top), e);
                            f.x += d.x, f.y += d.y, f = a.devicePtToPageRotate(f, e), b.left = f.x, b.top = f.y;
                            break;
                        case h.MOVE_END:
                            var f = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.right, b.bottom), e);
                            f.x += d.x, f.y += d.y, f = a.devicePtToPageRotate(f, e), b.right = f.x, b.bottom = f.y
                    }
                }
                var n = $.extend(!0, {}, c),
                    o = k(a, n, d, e, f, g, i);
                return 0 != o.x && 0 != o.y ? (m(a, c, i, o), !0) : !1
            },
            onAnnotChangeRectMove: function(a, b, c, d, e, g) {
                var h = b.getRect(),
                    i = a.pdfRectToDevice(h, !0);
                this.geometricScalingRect(a, b, i, c.pageX, c.pageY, e, g, d) && f.changeAnnotRectMove(a, b, i)
            },
            getType: function() {
                return this.annotType
            },
            canAnswer: function(a) {
                return !0
            },
            canMove: function(a) {
                return !0
            },
            isTextboxType: function(a) {
                return !0
            },
            setAnnotOpacity: function(a, b, c, d) {
                f.setAnnotOpacity(a, b, c), d || (e.setAnnotOpacity(a, b, c), this.readerApp.setModified(a, a.getDocView(), !0))
            },
            setAnnotFontSize: function(a, b, c) {
                e.setAnnotFontSize(a, b, c), f.setAnnotFontSize(a, b, c), this.readerApp.setModified(a, a.getDocView(), !0)
            },
            setAnnotFillColor: function(a, b, c) {
                e.setAnnotFillColor(a, b, c), f.setAnnotFillColor(a, b, c), this.readerApp.setModified(a, a.getDocView(), !0)
            },
            setAnnotBorderColor: function(a, b, c) {
                e.setAnnotBorderColor(a, b, c), f.setAnnotBorderColor(a, b, c), this.readerApp.setModified(a, a.getDocView(), !0)
            },
            annotLineBorder: function(a, b, c) {},
            updateAnnotContent: function(a, b) {
                f.spellCheck(null, a, b)
            },
            moveAnnot: function(a, b, c, d, e, g) {
                f.moveAnnot(a, b, c, d, e, g), a.addAnnotRecord(b, "Edit")
            },
            deleteAnnot: function(a, b) {
                f.deleteAnnot(a, b)
            },
            setAnnotColor: function(a, b, c) {
                e.setAnnotColor(a, b, c), f.updateAnnotFontColor(a, b, c)
            },
            onDraw: function(a, b, c, d) {
                f.onDraw(a, b)
            },
            onSelected: function(a, b) {
                return f.onSelected(a, b), !0
            },
            onDeSelected: function(a, b) {
                return f.onDeSelected(a, b), this.commentPropertyDlg.disabledDlg(), !0
            },
            onFocus: function(a, b) {
                return !1
            },
            onLButtonDown: function(a, b, c) {
                return this.onSelected(a, b)
            },
            onLButtonDblClk: function(a, b, c) {
                return b.isReadOnly() || (f.onTextboxAnnotEdit(a, b), c.preventDefault()), !1
            },
            onMouseOver: function(a, b, c) {},
            onMouseLeave: function(a, b, c) {},
            onUpdatePosition: function(a, b, c) {
                f.onUpdatePosition(a, b, c)
            },
            init: function() {
                f.editTextboxForBlur(), f.editTextboxForKeyup(), f.editTextboxForFocus()
            },
            showAnnot: function(a, b, c) {
                f.showAnnot(a, b, c)
            },
            setAnnotRect: function(a, b, c) {
                if (!a || !b) return !1;
                var d = a.deviceRectToPDF(c, !0, 0);
                return b.setRect(d), !0
            },
            updateAnnot: function(a, b, c) {
                if (c.color) {
                    var d = WebPDF.Common.rgb2HexColor(c.color);
                    f.setAnnotColor(a, b.getAnnotName(), d), e.setAnnotColor(a, b, d)
                }
            },
            resizeTextArea: function(a, b) {
                f.resizeTextArea()
            }
        }, WebPDF.TextboxAnnotHandler
    }), define("core/Plugins/Annot/TextboxAnnotView", ["core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        function d(a, b) {
            h = b, i = $("#" + h.getAppId()), l = new WebPDF.Annot.AnnotUIManager(a, h), k = a, j = this
        }

        function e(a, b) {
            return Math.abs(parseFloat(a) - parseFloat(b)) <= 1
        }

        function f(a, b) {
            return e(a.left, b.left) && e(a.right, b.right) && e(a.top, b.top) && e(a.bottom, b.bottom)
        }
        a("core/Plugins/Annot/AnnotUIManager");
        var g, h, i, j, k, l, m = WebPDF.PDFRect,
            n = WebPDF.RectUtils,
            o = WebPDF.Common.Direc,
            p = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        d.prototype = {
            containsJQDocView: function(a) {
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                return WebPDF.Common.containsNode(c.get(0), a.target, !0) ? void 0 : !1
            },
            setAnnotColor: function(a, b, c) {
                var d = l.getTextboxAnnotDivID(a, b),
                    e = $("#" + d);
                e.find("textarea").css("color", c)
            },
            setAnnotOpacity: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = l.getTextboxAnnotDivID(a, d),
                    f = $("#" + e);
                f.find("textarea").css("opacity", c / 100)
            },
            setAnnotFillColor: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = l.getTextboxAnnotDivID(a, d),
                    f = $("#" + e);
                f.find("textarea").css("backgroundColor", c || "transparent")
            },
            setAnnotBorderColor: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = l.getTextboxAnnotDivID(a, d),
                    f = $("#" + e);
                f.find("textarea").css("borderColor", c || "transparent")
            },
            setAnnotFontSize: function(a, b, c) {
                this.onUpdatePosition(a, b), j.spellCheck(null, a, b)
            },
            annotLineBorder: function(a, b, c) {},
            getMoveDivRect: function(a, b) {
                var c = l.getAnnotMoveDivID(a, b.getAnnotName()),
                    d = document.getElementById(c),
                    e = l.getElemRect(d),
                    f = p.adjust(a, b);
                return WebPDF.RectUtils.deflateEx(e, f), e
            },
            changeAnnotRectMove: function(a, b, c) {
                l.changeAnnotRectMove(a, b, c)
            },
            updateBorder: function(a, b, c) {
                function d(a) {
                    return s = "<div class ='fwr-annot-border fwr-textbox-select-border' style='left: {left_x}px;top: {left_y}px; cursor:{w_cursor}' dir='{direct_left}'></div><div class ='fwr-annot-border fwr-textbox-select-border' style='left:{top_x}px;top: {top_y}px; cursor:{s_cursor}' dir='{direct_top}'></div> <div class ='fwr-annot-border fwr-textbox-select-border' style='left:{right_x}px;top:{right_y}px; cursor:{w_cursor}' dir='{direct_right}'></div> <div class ='fwr-annot-border fwr-textbox-select-border' style='left:{bottom_x}px;top:{bottom_y}px;cursor:{s_cursor}' dir='{direct_bottom}'></div> <div class ='fwr-annot-border fwr-textbox-select-border' style='left:{ltx}px;top:{lty}px; cursor:{nw_cursor}' dir='{direct_lt}'></div><div class ='fwr-annot-border fwr-textbox-select-border' style='left:{rtx}px;top:{rty}px; cursor:{ne_cursor}' dir='{direct_rt}'></div><div class ='fwr-annot-border fwr-textbox-select-border' style='left:{rbx}px;top:{rby}px; cursor:{nw_cursor}' dir='{direct_rb}'></div><div class ='fwr-annot-border fwr-textbox-select-border' style='left:{lbx}px;top:{lby}px; cursor:{ne_cursor}' dir='{direct_lb}'></div>", s.format(a)
                }
                if (a && b) {
                    var e = b.getAnnotName(),
                        f = function(a, b) {
                            var c = $("#" + b),
                                d = new m;
                            return d.top = parseFloat(c.css("top")), d.left = parseFloat(c.css("left")), d.bottom = d.top + parseFloat(c.css("height")), d.right = d.left + parseFloat(c.css("width")), d
                        },
                        g = l.getDrawingAnnotBorderDivID(a, e),
                        i = $("#" + g),
                        j = l.getTypewriterAnnotDivID(a, e),
                        k = l.getAnnotDivIDFromTypewriterAnnotRectDivID(j),
                        n = f(a, k),
                        p = n.bottom - n.top,
                        q = n.right - n.left,
                        r = h.getDocView().getRotate(),
                        s = "",
                        t = [o.LEFT, o.TOP, o.RIGHT, o.BOTTOM],
                        u = [o.LEFT_TOP, o.RIGHT_TOP, o.RIGHT_BOTTOM, o.LEFT_BOTTOM],
                        v = ["w-resize", "s-resize"],
                        w = ["nw-resize", "ne-resize"],
                        x = r / 90 % 4,
                        y = r / 90 % 2,
                        z = {
                            left_x: -4,
                            left_y: p / 2 - 4,
                            direct_left: t[x],
                            top_x: q / 2 - 4,
                            top_y: -4,
                            direct_top: t[(x + 1) % 4],
                            right_x: q - 4,
                            right_y: p / 2 - 4,
                            direct_right: t[(x + 2) % 4],
                            bottom_x: q / 2 - 4,
                            bottom_y: p - 4,
                            direct_bottom: t[(x + 3) % 4],
                            w_cursor: v[y],
                            s_cursor: v[(y + 1) % 2],
                            ltx: -4,
                            lty: -4,
                            direct_lt: u[x],
                            rtx: q - 4,
                            rty: -4,
                            direct_rt: u[(x + 1) % 4],
                            rbx: q - 4,
                            rby: p - 4,
                            direct_rb: u[(x + 2) % 4],
                            lbx: -4,
                            lby: p - 4,
                            direct_lb: u[(x + 3) % 4],
                            nw_cursor: w[y],
                            ne_cursor: w[(y + 1) % 2]
                        };
                    s = d(z), i[0] && (i[0].innerHTML = s), c === !1 ? i.hide() : i.show()
                }
            },
            onSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).addClass("fwr-annot-selected"), this.updateBorder(a, b, !0)
            },
            onDeSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).removeClass("fwr-annot-selected"), this.updateBorder(a, b, !1);
                var e = $("#" + l.getTextboxAnnotRectDivID(a, c)),
                    f = e.data("before"),
                    g = e.val();
                if (f != g) {
                    var i = {
                        name: c,
                        oldContents: f,
                        newContents: g
                    };
                    h.addAnnotUndo(i)
                }
                h.clearAnnotUndo(!0), h.setAnnotContentEdit(!1)
            },
            createAnnot: function(a, b, c, d) {
                var e = a.getUIManager().getPageAnnotsContainerID(b),
                    f = $("#" + e),
                    g = c.getAnnotName(),
                    i = a.getUIManager().createAAnnotHtmlContent(b, c, g, 1, !1);
                f.append(i), this.updateBorder(b, c, !1), $(h).trigger(WebPDF.EventList.ANNOT_ADDED, {
                    pageIndex: d.getPageIndex(),
                    annot: a.packageAnnot(c),
                    annotObject: c
                }), $(h).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                    annotName: c.getAnnotName(),
                    pageIndex: d.getPageIndex()
                })
            },
            editTextboxForKeyup: function() {
                var a = !1;
                i.off("compositionstart", ".fwr-textbox-annot-edit").on("compositionstart", ".fwr-textbox-annot-edit", function(b) {
                    a = !0
                }), i.off("compositionend", ".fwr-textbox-annot-edit").on("compositionend", ".fwr-textbox-annot-edit", function(b) {
                    a = !1
                }), i.off("keyup", ".fwr-textbox-annot-edit").on("keyup", ".fwr-textbox-annot-edit", function(b) {
                    var c = $("#docViewer_ViewContainer .fwrJspContainer")[0] || $("#docViewer_ViewContainer .fwrJspContainer-ie")[0],
                        d = h.getMainFrameId(),
                        e = $("#" + d).offset().top;
                    if (!h.isMobile() && c[0] && c.offset().top !== e && c.offset({
                            top: e
                        }), !a && (89 != b.keyCode && 90 != b.keyCode || !b.ctrlKey) && 17 != b.keyCode) {
                        var f = $(this);
                        return k.addFreeTextUndo(f, null, j.currentPageIndex, j.currentAnnotName, !0)
                    }
                }), i.off("paste", ".fwr-callout-annot-edit").on("paste", ".fwr-callout-annot-edit", function(a) {
                    var b = $(this);
                    k.addFreeTextUndo(b, null, j.currentPageIndex, j.currentAnnotName, !0)
                })
            },
            editTextboxForFocus: function() {
                i.off("focus", ".fwr-textbox-annot-nor").on("focus", ".fwr-textbox-annot-nor", function(a) {
                    var b = $(this),
                        c = $("#" + l.getAnnotDivIDFromTextboxAnnotRectDivID(b.attr("id")));
                    j.currentPageIndex = parseInt(c.attr("page-index")), j.currentAnnotName = c.attr("annot-name"), j.originContents = b.val(), j.spellCheck(1), c.children().hide(), j._setTextareaCursorPosition(b.get(0), b.val().length), j._addAndRemoveChangeValueEvent(b.get(0), !0), WebPDF.Environment.webkit || $("#" + l.getAnnotDivIDFromTextboxAnnotRectDivID(b.attr("id"))).removeClass("fwr-annot-selected").addClass("fwr-textbox-annot-edit-border"), b.removeClass("fwr-textbox-annot-nor").addClass("fwr-textbox-annot-edit")
                })
            },
            editTextboxForBlur: function() {
                var a = $("#" + h.getAppId());
                a.off("blur", ".fwr-textbox-annot-edit").on("blur", ".fwr-textbox-annot-edit", function(a) {
                    var b = h.getMainView().getDocView(),
                        c = $(this);
                    if ("undefined" == typeof j.currentAnnotName || "undefined" == typeof j.currentPageIndex) return console.log("error in textbox blur"), !0;
                    j._addAndRemoveChangeValueEvent(c.get(0), !1);
                    var d = b.getPageView(j.currentPageIndex),
                        e = d.getPDFPage(),
                        f = e.getAnnotByName(j.currentAnnotName);
                    if (!f) return !0;
                    WebPDF.Environment.webkit || $("#" + l.getAnnotDivIDFromTextboxAnnotRectDivID(c.attr("id"))).removeClass("fwr-textbox-annot-edit-border"), c.removeClass("fwr-textbox-annot-edit").addClass("fwr-textbox-annot-nor");
                    $("#" + l.getAnnotDivIDFromTextboxAnnotRectDivID(c.attr("id")));
                    if (j.spellCheck(0), !f || c.val() == j.originContents && c.val() == f.getContents() || (k.addFreeTextUndo(c, f, j.currentPageIndex), f.setContents(c.val()), d.setModified(!0), b.setModified(!0)), h.setAnnotContentEdit(!1), h.clearAnnotUndo(!0), delete j.currentAnnotName, delete j.currentPageIndex, WebPDF.Environment.iOS && WebPDF.Environment.mobile) {
                        var g = $("body").scrollTop();
                        0 != g && $("body").scrollTop(0)
                    }
                    return $(h).trigger(WebPDF.EventList.ANNOT_UPDATED, {
                        annot: k.packageAnnot(f),
                        pageIndex: d.getPageIndex(),
                        annotObject: f
                    }), !0
                })
            },
            onTextboxAnnotEdit: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getTextboxAnnotRectDivID(a, c),
                    e = l.getAnnotDivID(a, c),
                    f = $("#" + d),
                    g = h.getDocView(),
                    i = g.getScrollApi();
                if (null != i) {
                    var j = $("#" + e),
                        k = new m,
                        o = new m;
                    k.left = Math.max(0, parseFloat(j.css("left"))), k.top = Math.max(0, parseFloat(j.css("top"))), k.right = k.left + parseFloat(j.css("width")), k.bottom = k.top + parseFloat(j.css("height")), n.copy(k, o), o = a.PageRotateToScreen(o, g.getRotate());
                    var p = $("#" + g.getDocViewContainerID()),
                        q = p.height(),
                        r = p.offset(),
                        s = $("#" + a.getPageViewContainerID()),
                        t = s.offset();
                    return q -= i.getScrollBarHeight(), r.top + q <= t.top + o.bottom && i.scrollByY(t.top + o.bottom - r.top - q + 5), WebPDF.Environment.mobile ? (WebPDF.Environment.iOS ? setTimeout(function() {
                        f.focus()
                    }, 0) : f.focus(), !1) : void(WebPDF.Environment.ie8OrLower ? setTimeout(function() {
                        f.focus()
                    }, 0) : f.focus())
                }
            },
            onLButtonInPage: function(a) {
                for (var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(), c = b.getVisiblePageRange(), d = null, e = null, f = c.begin; f <= c.end; f++) {
                    var g = b.getPageView(f),
                        h = $("#" + g.getPageViewContainerID()).offset(),
                        i = g.getPageViewWidth(),
                        j = g.getPageViewHeight();
                    if (e = new WebPDF.PDFRect(h.left, h.top, h.left + i, h.top + j), WebPDF.RectUtils.normalize(e), WebPDF.RectUtils.ptInRect(e, a.pageX, a.pageY)) {
                        d = g;
                        break
                    }
                }
                return d ? {
                    pageView: d,
                    pageViewRect: e
                } : !1
            },
            moveAnnot: function(a, b, c, d, e, f) {
                var g = b.getAnnotName(),
                    h = $("#" + l.getAnnotDivID(a, g));
                h.css({
                    left: e + "px",
                    top: f + "px"
                });
                var i = $("#" + l.getTextboxAnnotDivID(a, g));
                i.css({
                    left: e + "px",
                    top: f + "px"
                })
            },
            updateAnnotFontColor: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = $("#" + l.getTextboxAnnotRectDivID(a, d));
                e.css("color", c)
            },
            onDraw: function(a, b) {
                if (null != b && null != a && b.isVisible() && b.getType() == WebPDF.Annot.AnnotType.Textbox) {
                    var c = b.getAnnotName(),
                        d = l.getTextboxAnnotRectDivID(a, c),
                        e = $("#" + d),
                        f = b.getDA();
                    if (f && /\s?\d*Tc/.test(f)) {
                        var g = f.match(/\w* ?([0-9\.]+) Tc/)[1];
                        if (g = 4 * parseFloat(g) / 300, /\w* ?([0-9\.]+) Tz/.test(f)) {
                            var h = f.match(/\w* ?([0-9\.]+) Tz/)[1];
                            g *= parseFloat(h)
                        }
                        e.css("letter-spacing", g + "px")
                    } else e.css("letter-spacing", "initial");
                    var i = b.getColor() || "#FF0000",
                        j = b.getBorderStyle(),
                        k = b.getBorderWidth();
                    switch (j) {
                        default:
                            case 0:
                            j = "solid";
                        break;
                        case "dash":
                                case 1:
                                j = "dashed"
                    }
                    e.css("border", k + "px " + j + " " + i);
                    var m = "left";
                    switch (b.getTextAlign()) {
                        case WebPDF.Annot.TypeWriterTextAlignStyle.CENTERED:
                            m = "center";
                            break;
                        case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                            m = "right"
                    }
                    e.css("text-align", m);
                    var n = b.getFillColor();
                    "#000000" == n && (n = "rgba:(0,0,0,0)"), e.css("background-color", n);
                    var o = $("#" + l.getTextboxAnnotRectDivID(a, c));
                    o.data("before", o.val())
                }
            },
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = l.getAnnotDivID(a, c);
                $("#" + d).remove();
                var e = l.getTextboxAnnotDivID(a, c);
                $("#" + e).remove()
            },
            showAnnot: function(a, b, c) {
                function d(a, b, c) {
                    return a.isShowInViewer() && c ? void b.show() : void b.hide()
                }
                var e = $("#" + l.getTextboxAnnotDivID(a, b.getAnnotName()));
                d(b, e, c)
            },
            onUpdatePosition: function(a, b, c) {
                var d = b.getAnnotName(),
                    e = a.pdfRectToDevice(b.getRect(), !0),
                    f = $("#" + l.getAnnotDivID(a, d)),
                    g = $("#" + l.getTextboxAnnotDivID(a, d)),
                    i = $("#" + l.getTextboxAnnotRectDivID(a, d)),
                    j = e.left,
                    k = e.top,
                    m = a.getPDFPage(),
                    o = (90 * m.getPageRotate() % 360 + 360) % 360,
                    p = (b.getRotate() % 360 + 360) % 360,
                    q = o - p,
                    r = h.getPixelsPerPoint(),
                    s = r * a.getScale(),
                    t = b.getFontSize() * s;
                i.css("fontSize", t + "px");
                var u = n.width(e),
                    v = b.getLineHeight(),
                    w = v * s;
                i.css("line-height", w + "px");
                var x = n.height(e),
                    y = u,
                    z = x,
                    A = "";
                if (0 != q) switch (q) {
                    case -90:
                    case 270:
                        y = x, z = u, A = "rotate(270deg) translateX(" + -(y + .05) + "px)";
                        break;
                    case -270:
                    case 90:
                        y = x, z = u, A = "rotate(90deg) translateY(" + -(z + .05) + "px)";
                        break;
                    case -180:
                    case 180:
                        A = "rotate(180deg)"
                }
                if (g.css({
                        left: j + "px",
                        top: k + "px",
                        width: u + "px",
                        height: x + "px"
                    }), f.css({
                        left: j + "px",
                        top: k + "px",
                        width: u + "px",
                        height: x + "px"
                    }), i.css({
                        "-webkit-transform": A,
                        "-moz-transform": A,
                        "-o-transform": A,
                        "-ms-transform": A,
                        transform: A,
                        width: y + "px",
                        height: z + "px"
                    }), 12 > t);
                i.hasClass("default-add") || 0 != q && 180 != q && -180 != q || i.data("minheight", x), f.hasClass("fwr-annot-selected") ? this.updateBorder(a, b, !0) : this.updateBorder(a, b, !1)
            },
            resizeTextArea: function() {
                this.spellCheck(0)
            },
            spellCheck: function(a, b, c) {
                var d = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    g = this.currentPageIndex,
                    i = this.currentAnnotName;
                if (b && c ? (g = b.getPageIndex(), i = c.getAnnotName()) : b = d.getPageView(g), b) {
                    var j = b.getPDFPage();
                    if (c = j.getAnnotByName(i), c && "undefined" != typeof g && "undefined" != typeof i) {
                        var k = $("#" + l.getTextboxAnnotRectDivID(b, i)),
                            o = k.parent(),
                            p = $("#" + l.getAnnotDivID(b, i)),
                            q = h.getPixelsPerPoint(),
                            r = q * b.getScale(),
                            s = (90 * j.getPageRotate() % 360 + 360) % 360,
                            t = (c.getRotate() % 360 + 360) % 360,
                            u = s - t,
                            v = 0,
                            w = 0;
                        90 == d.getRotate() || 270 == d.getRotate() ? (v = b.getPageViewHeight(), w = b.getPageViewWidth()) : (v = b.getPageViewWidth(), w = b.getPageViewHeight());
                        var x = new m,
                            y = new m;
                        x.left = Math.max(0, parseFloat(p.css("left"))), x.top = Math.max(0, parseFloat(p.css("top"))), x.right = x.left + parseFloat(p.css("width")), x.bottom = x.top + parseFloat(p.css("height")), n.copy(x, y), ("undefined" == typeof a || isNaN(a)) && (a = 1);
                        var z = n.width(y),
                            A = n.width(y);
                        (90 == u || 270 == u || -90 == u || -270 == u) && (A = n.height(y));
                        var B = z - A;
                        B = 0;
                        var C = A;
                        if (!e(B, 0)) switch (c.getTextAlign()) {
                            case WebPDF.Annot.TypeWriterTextAlignStyle.CENTERED:
                                var D = B / 2;
                                switch (u) {
                                    case 0:
                                    case 180:
                                        D = Math.min(D, y.left), D = Math.min(D, v - y.right), y.left -= D, y.right += D, C = y.right - y.left;
                                        break;
                                    case 90:
                                    case 270:
                                        D = Math.min(D, w - y.bottom), D = Math.min(D, y.top), y.bottom += D, y.top -= D, C = y.bottom - y.top
                                }
                                break;
                            case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                switch (u) {
                                    case 0:
                                        y.left = y.left - B, y.left < 0 && (y.left = 0, y.right = Math.min(v, y.left + z)), C = y.right - y.left;
                                        break;
                                    case 90:
                                        y.bottom = y.bottom + B, y.bottom > w && (y.bottom = w, y.top = Math.max(0, y.bottom - z)), C = y.bottom - y.top;
                                        break;
                                    case 180:
                                        y.right = y.right + B, y.right > v && (y.right = v, y.left = Math.max(0, y.right - z)), C = y.right - y.left;
                                        break;
                                    case 270:
                                        y.top = y.top - B, y.top < 0 && (y.top = 0, y.bottom = Math.min(w, y.top + z)), C = y.bottom - y.top
                                }
                                break;
                            default:
                                switch (u) {
                                    case 0:
                                        y.right = y.right + B, y.right > v && (y.right = v, y.left = x.left), C = y.right - y.left;
                                        break;
                                    case -270:
                                    case 90:
                                        y.bottom = y.bottom + B, y.bottom > w && (y.bottom = w, y.top = x.top), C = y.bottom - y.top;
                                        break;
                                    case 180:
                                    case -180:
                                        y.left = y.left - B, y.left < 0 && (y.left = 0, y.right = x.right), C = y.right - y.left;
                                        break;
                                    case 270:
                                    case -90:
                                        y.top = y.top - B, y.top < 0 && (y.top = 0, y.bottom = x.bottom), C = y.bottom - y.top
                                }
                        }
                        var E = parseFloat(k.css("line-height"));
                        if ((isNaN(E) || 0 == E) && (E = c.getLineHeight() * r), !k.hasClass("default-add") && (0 == u || 180 == u || -180 == u)) {
                            var F = k.data("minheight");
                            F >= E && (E = F)
                        }
                        k.css({
                            height: E,
                            width: C
                        });
                        var G = k.get(0).scrollHeight;
                        switch (k.css({
                            height: G,
                            "max-height": w
                        }), u) {
                            case 270:
                            case -90:
                                y.right = Math.min(v, y.left + G);
                                var H = y.left + G - v;
                                H > 0 && (y.left -= H, y.left < 0 && (y.left = 0));
                                break;
                            case -270:
                            case 90:
                                y.left = Math.max(0, y.right - G);
                                var H = y.right - G;
                                0 > H && (y.right -= H, y.right > v && (y.right = v));
                                break;
                            case 180:
                            case -180:
                                y.top = Math.max(0, y.bottom - G);
                                var H = y.bottom - G;
                                0 > H && (y.bottom -= H, y.bottom > w && (y.bottom = w));
                                break;
                            default:
                                y.bottom = Math.min(w, y.top + G);
                                var H = y.top + G - w;
                                H > 0 && (y.top -= H, y.top <= 0 && (y.top = 0))
                        }
                        if (!f(x, y)) {
                            var I = n.width(y) + "px",
                                J = n.height(y) + "px",
                                K = I,
                                L = J,
                                M = "";
                            switch (u) {
                                case 270:
                                case -90:
                                    K = J, L = I, M = "rotate(270deg) translateX(" + -n.height(y) + "px)";
                                    break;
                                case -270:
                                case 90:
                                    K = J, L = I, M = "rotate(90deg) translateY(" + -n.width(y) + "px)";
                                    break;
                                case 180:
                                case -180:
                                    M = "rotate(180deg)"
                            }
                            p.css({
                                left: y.left + "px",
                                top: y.top + "px",
                                width: I,
                                height: J
                            }), o.css({
                                left: y.left + "px",
                                top: y.top + "px",
                                width: I,
                                height: J
                            }), k.css({
                                "-webkit-transform": M,
                                "-moz-transform": M,
                                "-o-transform": M,
                                "-ms-transform": M,
                                transform: M,
                                width: K,
                                height: L
                            }), p.hasClass("fwr-annot-selected") ? this.updateBorder(b, c, !0) : this.updateBorder(b, c, !1);
                            var N = new m;
                            N.left = y.left / r, N.top = j.getPageHeight() - y.top / r, N.right = y.right / r, N.bottom = j.getPageHeight() - y.bottom / r, n.normalize(N), c.setRect(N), N = null;
                            var O = new Date,
                                P = O.valueOf(),
                                Q = Math.floor(P / 1e3).toString();
                            if (c.setModifyDate(Q), 0 != a) {
                                var R = d.getScrollApi();
                                if (null != R) {
                                    y = b.PageRotateToScreen(y, d.getRotate()), x = b.PageRotateToScreen(x, d.getRotate());
                                    var S = y.left - x.left,
                                        T = y.right - x.right,
                                        U = y.bottom - x.bottom,
                                        V = $("#" + d.getDocViewContainerID()),
                                        W = V.height(),
                                        X = V.width(),
                                        Y = V.offset(),
                                        Z = $("#" + b.getPageViewContainerID()),
                                        _ = Z.offset();
                                    if (W -= R.getScrollBarHeight(), X -= R.getScrollBarWidth(), U > 0) Y.top + W <= _.top + y.bottom && R.scrollByY(U + 5);
                                    else if (0 > U && Y.top >= _.top + y.bottom - E) {
                                        var aa = Math.min(Y.top - (_.top + y.top), Y.top + W - (_.top + y.bottom)),
                                            ba = Math.min(U, -aa);
                                        R.scrollByY(ba - 5)
                                    }
                                    switch (c.getTextAlign()) {
                                        case WebPDF.Annot.TypeWriterTextAlignStyle.RIGHT_JUSTIFIED:
                                            if (S > 0) {
                                                if (Y.left + X <= _.left + y.right) {
                                                    var ca = Math.min(_.left + y.right - (Y.left + X), _.left + y.left - Y.left),
                                                        da = Math.max(S, ca);
                                                    R.scrollByX(da + 5)
                                                }
                                            } else 0 > S && Y.left >= _.left + y.left && R.scrollByX(S - 5);
                                            break;
                                        default:
                                            if (T > 0) Y.left + X <= _.left + y.right && R.scrollByX(T + 5);
                                            else if (0 > T && Y.left >= _.left + y.left) {
                                                var ca = Math.min(Y.left + X - (_.left + y.right), Y.left - (_.left + y.left)),
                                                    da = Math.min(T, -ca);
                                                R.scrollByX(da - 5)
                                            }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            _calActualWidth: function(a) {
                var b = $('<div rows="1" width="auto"></div>');
                b.css({
                    position: "absolute",
                    margin: 0,
                    padding: 0,
                    display: "block",
                    width: "1px",
                    "float": "left",
                    "white-space": "nowrap",
                    visibility: "hidden",
                    font: a.css("font"),
                    "font-family": a.css("font-family"),
                    "font-size": a.css("font-size")
                }), a.after(b);
                for (var c = a.val(), d = c.split("\n"), e = d.length, f = 0, g = 10, h = 0; e > h; ++h) {
                    var i = WebPDF.Common.htmlEncode(d[h].replace(/ /g, "&nbsp;")),
                        j = b.html(i).get(0).scrollWidth;
                    f = Math.max(f, j), d[h].length > 0 && (g = Math.min(g, j / d[h].length)), i = null
                }
                return b.remove(), f + g / 2
            },
            _calActualLineHeight: function(a) {
                var b = $('<textarea rows="1">AbgH@</textarea>');
                b.css({
                    position: "absolute",
                    margin: 0,
                    padding: 0,
                    display: "block",
                    width: "1px",
                    "float": "left",
                    "white-space": "nowrap",
                    visibility: "hidden",
                    font: a.css("font"),
                    "font-family": a.css("font-family"),
                    "font-size": a.css("font-size")
                }), b.css("lineHeight", "normal"), a.after(b);
                var c = parseFloat(b.get(0).scrollHeight);
                return b.remove(), c
            },
            _setTextareaCursorPosition: function(a, b) {
                if (a.setSelectionRange) a.setSelectionRange(b, b);
                else if (a.createTextRange) {
                    var c = a.createTextRange();
                    a.value.length === b ? (c.collapse(!1), c.select()) : c.select()
                }
            },
            _addAndRemoveChangeValueEvent: function(a, b) {
                function c(a) {
                    if (!a || !WebPDF.Environment.ie || "value" == a.propertyName) {
                        d.spellCheck(1);
                        var b = h.getMainView().getDocView();
                        b.setModified(!0)
                    }
                }
                var d = this;
                WebPDF.Environment.ie8OrLower || WebPDF.Environment.ie9Compact || WebPDF.Environment.ie10Compact ? b ? a.attachEvent("onpropertychange", c) : a.detachEvent("onpropertychange", c) : b ? a.addEventListener("input", c, !1) : a.removeEventListener("input", c, !1)
            }
        }, b.createTextboxAnnotView = function(a, b) {
            return null == g && (g = new d(a, b)), g
        }
    }), define("core/Plugins/Annot/TextboxAnnotService", [], function(a, b, c) {
        function d(a, b) {
            f = b
        }
        var e, f;
        WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthTexbox = 140, d.prototype = {
            getAnnot: function(a, b, c, d, e) {
                var g = a.pageX - d.left,
                    h = a.pageY - d.bottom,
                    i = WebPDF.AccountInstance.getUserConfig(),
                    j = new Date,
                    k = j.valueOf(),
                    l = Math.floor(k / 1e3).toString(),
                    m = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                    n = {
                        c: "",
                        ca: i.annot.textbox.opacity,
                        q: 0,
                        cd: l,
                        cl: i.annot.textbox.borderColor,
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: l,
                        n: null,
                        subj: i18n.t("Annot.AnnotSubjTextbox"),
                        subty: "FreeText",
                        tit: m,
                        ty: "Textbox",
                        fs: i.annot.textbox.fontSize,
                        fh: i.annot.textbox.fontSize,
                        lnh: i.annot.textbox.lineHeight,
                        fc: i.annot.textbox.fontColor,
                        fcl: i.annot.textbox.fillColor,
                        bw: i.annot.textbox.borderWidth,
                        ftn: "Helvetica",
                        it: b,
                        r: 90 * c.getPDFPage().getPageRotate() + c.getDocView().getRotate(),
                        rc: null,
                        pdf: "false",
                        del: 0
                    },
                    o = c.getPDFPage(),
                    p = o.getPageWidth(),
                    q = o.getPageHeight(),
                    r = new WebPDF.PDFPoint(g, h);
                if (r = c.devicePtToPDF(r), e) n.rc = e;
                else {
                    var s = null,
                        t = c.getDocView().getRotate();
                    s = 90 == t ? new WebPDF.PDFRect(r.x, r.y, r.x + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight, r.y + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthTexbox) : 180 == t ? new WebPDF.PDFRect(r.x - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthTexbox, r.y + WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight, r.x, r.y) : 270 == t ? new WebPDF.PDFRect(r.x - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight, r.y, r.x, r.y - WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthTexbox) : new WebPDF.PDFRect(r.x, r.y, r.x + WebPDF.Annot.TypewriteAnnotDefaultValue.NewAnnotWidthTexbox, r.y - WebPDF.Annot.TypewriteAnnotDefaultValue.LineHeight), s.left < 0 && WebPDF.RectUtils.offset(s, 0 - s.left, 0), s.bottom < 0 && WebPDF.RectUtils.offset(s, 0, 0 - s.bottom), s.right > p && WebPDF.RectUtils.offset(s, p - s.right, 0), s.top > q && WebPDF.RectUtils.offset(s, 0, q - s.top), n.rc = [s.left, s.top, s.right, s.bottom]
                }
                var u = WebPDF.Annot.AnnotFactory.createAnnot(n, o.getPageIndex(), !1);
                o.getAnnotJsonData().push(n), o.addAnnot(u), c.setModified(!0);
                var v = [];
                v.push(u.annotJSONData);
                var w = new WebPDF.Annot.Undo(c.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, v);
                return f.addAnnotUndo(w), {
                    pAnnot: u,
                    pageView: c,
                    pPDFPage: o
                }
            },
            istextboxsType: function(a) {
                return a.toLowerCase() == WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TEXTBOX.toLowerCase() ? !0 : !1
            },
            setAnnotColor: function(a, b, c) {
                c = WebPDF.Common.rgb2HexColor(c), b.setFontColor(c), f.setModified(a, a.getDocView(), !0)
            },
            setAnnotFontSize: function(a, b, c) {
                c = parseInt(c);
                var d = parseFloat(c / b.getFontSize()),
                    e = b.getLineHeight() * d;
                b.setLineHeight(e), b.setFontSize(c), f.setModified(a, a.getDocView(), !0)
            },
            setAnnotOpacity: function(a, b, c) {
                b.setOpacity(parseInt(c) / 100), f.setModified(a, a.getDocView(), !0)
            },
            setAnnotFillColor: function(a, b, c) {
                b.setFillColor(c), f.setModified(a, a.getDocView(), !0)
            },
            setAnnotBorderColor: function(a, b, c) {
                b.setColor(c), f.setModified(a, a.getDocView(), !0)
            },
            canAnswer: function(a, b) {
                if (!f.isEditable()) return !1;
                var c = a.getIT();
                if (!this.istextboxsType(c) || !a.isVisible()) return !1;
                var d = f.getCurToolHandler();
                if (null != d) {
                    var e = d.getName();
                    if (e === WebPDF.Tools.TOOL_NAME_SELANNOT || e === WebPDF.Tools.TOOL_NAME_HAND || e.toLowerCase() === b.toLowerCase()) return !0
                }
            }
        }, b.createTextboxAnnotService = function(a, b) {
            return null == e && (e = new d(a, b)), e
        }
    }), define("core/Plugins/Annot/DrawingAnnot/DrawingAnnotService", [], function(a, b, c) {
        function d() {
            this.matchToolTypes = [WebPDF.Tools.TOOL_NAME_SELANNOT, WebPDF.Tools.TOOL_NAME_HAND]
        }
        var e = WebPDF.Common.Direc,
            f = WebPDF.Tool.getReaderApp(),
            g = 25;
        return d.prototype = {
            addMatchToolType: function(a) {
                this.matchToolTypes.push(a)
            },
            canAnswer: function(a, b) {
                var c = f.getCurToolHandler();
                if (!c) return !1;
                var d = c.getName();
                for (var e in this.matchToolTypes)
                    if (this.matchToolTypes[e] === d) return !0;
                return void 0 != b && b && d === WebPDF.TOOL_NAME_SELECTTEXT ? !0 : void 0
            },
            moveAnnotRecord: function(a, b) {
                var c = "[" + b.getRect().left + " " + b.getRect().top + " " + b.getRect().right + " " + b.getRect().bottom + "]",
                    d = '{"Type":"' + b.getSubType() + '", "ActionType":"Edit", "PageIndex":"' + a.getPageIndex() + '", "Rect":"' + c + '"}';
                f.addRecord("Comment", "Comment", d)
            },
            setAnnotColor: function(a, b) {
                return b = WebPDF.Common.rgb2HexColor(b), a.getSubType() == WebPDF.Annot.AnnotType.Ink ? void a.setInkColor(b) : void a.setColor(b)
            },
            setLineBorder: function(a, b) {
                a.getSubType() === WebPDF.Annot.AnnotType.Ink && a.setInkBorderWidth(b)
            },
            geometricScalingRect: function(a, b, c, d, f, h, i, j) {
                function k(a, b, c, d) {
                    var e = a.getPageViewHeight(),
                        f = a.getPageViewWidth(),
                        g = !1,
                        h = a.PtPageRotateToScreen(b, a.getDocView().getRotate()),
                        i = h.x + c,
                        j = h.y + d;
                    return i > f ? (c = f - h.x, g = !0) : 0 > i && (c = 0 - h.x, g = !0), j > e ? (d = e - h.y, g = !0) : 0 > j && (d = 0 - h.y, g = !0), g ? {
                        x: 0,
                        y: 0
                    } : {
                        x: c,
                        y: d
                    }
                }

                function l(a, b, c, d, f, h, i) {
                    var j = 0,
                        l = 0,
                        m = !1,
                        n = a.getPageViewHeight(),
                        o = a.getPageViewWidth(),
                        p = a.getDocView().getRotate(),
                        q = c - f,
                        r = d - h;
                    if (i == e.MOVE_START) {
                        var s = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.left, b.top), a.getDocView().getRotate()),
                            t = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.right, b.bottom), a.getDocView().getRotate()),
                            j = s.x + q,
                            l = s.y + r;
                        return Math.abs(t.x - j) < g && Math.abs(t.y - l) < g ? {
                            x: 0,
                            y: 0
                        } : k(a, new WebPDF.PDFPoint(b.left, b.top), q, r)
                    }
                    if (i == e.MOVE_END) {
                        var s = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.left, b.top), a.getDocView().getRotate()),
                            t = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.right, b.bottom), a.getDocView().getRotate()),
                            j = t.x + q,
                            l = t.y + r;
                        return Math.abs(j - s.x) < g && Math.abs(l - s.y) < g ? {
                            x: 0,
                            y: 0
                        } : k(a, new WebPDF.PDFPoint(b.right, b.bottom), q, r)
                    }
                    return b = a.PageRotateToScreen(b, p), i == e.LEFT_TOP ? (j = b.left + q, l = b.top + r) : i == e.RIGHT_TOP ? (j = b.right + q, l = b.top + r) : i == e.RIGHT_BOTTOM ? (j = b.right + q, l = b.bottom + r) : i == e.LEFT_BOTTOM ? (j = b.left + q, l = b.bottom + r) : i == e.RIGHT ? j = b.right + q : i == e.LEFT ? j = b.left + q : i == e.TOP ? l = b.top + r : i == e.BOTTOM && (l = b.bottom + r), j > o ? (q = o - b.right, m = !0) : 0 > j && (q = 0 - b.left, m = !0), l > n ? (r = n - b.bottom, m = !0) : 0 > l && (r = 0 - b.top, m = !0), m ? {
                        x: 0,
                        y: 0
                    } : {
                        x: q,
                        y: r
                    }
                }

                function m(a, b, c, d, e, f) {
                    var g = a.PageRotateToScreen(b, a.getDocView().getRotate());
                    g.left += c, g.top += d, g.right += e, g.bottom += f, WebPDF.RectUtils.normalizeEx(g), g = a.deviceRectToPageRotate(g, a.getDocView().getRotate()), WebPDF.RectUtils.copy(g, b)
                }

                function n(a, b, c, d) {
                    var f = a.getDocView().getRotate();
                    switch (c) {
                        case e.LEFT_TOP:
                            m(a, b, d.x, d.y, 0, 0);
                            break;
                        case e.RIGHT_TOP:
                            m(a, b, 0, d.y, d.x, 0);
                            break;
                        case e.LEFT_BOTTOM:
                            m(a, b, d.x, 0, 0, d.y);
                            break;
                        case e.RIGHT_BOTTOM:
                            m(a, b, 0, 0, d.x, d.y);
                            break;
                        case e.LEFT:
                            m(a, b, d.x, 0, 0, 0);
                            break;
                        case e.RIGHT:
                            m(a, b, 0, 0, d.x, 0);
                            break;
                        case e.TOP:
                            m(a, b, 0, d.y, 0, 0);
                            break;
                        case e.BOTTOM:
                            m(a, b, 0, 0, 0, d.y);
                            break;
                        case e.MOVE_START:
                            var g = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.left, b.top), f);
                            g.x += d.x, g.y += d.y, g = a.devicePtToPageRotate(g, f), b.left = g.x, b.top = g.y;
                            break;
                        case e.MOVE_END:
                            var g = a.PtPageRotateToScreen(new WebPDF.PDFPoint(b.right, b.bottom), f);
                            g.x += d.x, g.y += d.y, g = a.devicePtToPageRotate(g, f), b.right = g.x, b.bottom = g.y
                    }
                }
                var o = $.extend(!0, {}, c),
                    p = l(a, o, d, f, h, i, j);
                return 0 != p.x && 0 != p.y ? (n(a, c, j, p), !0) : !1
            },
            setAnnotRect: function(a, b, c) {
                if (!a || !b) return !1;
                var d = a.deviceRectToPDF(c, !0, 0),
                    e = [],
                    g = {
                        name: b.getAnnotName(),
                        newRect: d,
                        oldRect: b.getRect()
                    };
                e.push(g);
                var h = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_MOVE, e);
                return f.addAnnotUndo(h), b.setRect(d), !0
            },
            reSetLineAnnotRect: function(a, b, c, d) {
                if (!a || !b) return !1;
                b.setStartPoint(new WebPDF.PDFPoint(c.x, c.y)), b.setEndPoint(new WebPDF.PDFPoint(d.x, d.y));
                var e = new WebPDF.PDFRect(c.x, c.y, d.x, d.y);
                WebPDF.RectUtils.normalize(e);
                var f = 1.5;
                return WebPDF.RectUtils.inflate(e, f), b.setRect(e), !0
            }
        }, d
    }), define("core/Plugins/Annot/DrawingAnnot/InkAnnotHandler", ["core/Plugins/Annot/DrawingAnnot/InkAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"], function(a, b, c) {
        var d, e, f, g = a("core/Plugins/Annot/DrawingAnnot/InkAnnotView"),
            h = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotService");
        return WebPDF.InkAnnotHandler = function(a, b) {
            this.readerApp = a, this.annotHandlerManager = b, e = new g(b, a);
            var c = WebPDF.AccountInstance.getUserConfig(),
                i = ["#ff4c4c", "#8080ff", "#bae94c", "#fff160", "#c3c3c3", "#ff9f40", "#669999", "#c72da1", "#996666", "#000000"];
            f = new h(WebPDF.Tools.TOOL_NAME_INKANNOT), f.addMatchToolType(WebPDF.Tools.TOOL_NAME_INKANNOT);
            var j = {
                title: i18n.t("AnnotProperties.PencilTitle"),
                colorArr: i,
                drawingConfig: c.annot.pencil
            };
            this.commentPropertyDlg = new CommentPropertyDlg(null, null, j), this.commentPropertyDlg.setAnnotHandler(this), d = this
        }, WebPDF.InkAnnotHandler.prototype = {
            getType: function() {
                return "Ink"
            },
            canAnswer: function(a, b) {
                return f.canAnswer(a, b) ? !0 : !1
            },
            canMove: function(a) {
                return !0
            },
            moveAnnot: function(a, b, c, d, g, h) {
                e.moveAnnot(a, b, c, d, g, h), f.moveAnnotRecord(a, b)
            },
            deleteAnnot: function(a, b) {
                e.deleteAnnot(a, b)
            },
            setAnnotProperty: function(a, b, c, d) {
                var e = WebPDF.Common.getReaderApp();
                if (e.isEditable()) {
                    var f = {
                        annot: b,
                        event: c,
                        multiSelect: d,
                        pageView: a
                    };
                    this.commentPropertyDlg.setOptions(f), this.commentPropertyDlg.show(c.pageX, c.pageY, f)
                }
            },
            setAnnotColor: function(a, b, c) {
                c = WebPDF.Common.rgb2HexColor(c), f.setAnnotColor(b, c), e.setAnnotColor(a, b, c), this.readerApp.setModified(a, a.getDocView(), !0)
            },
            annotLineBorder: function(a, b, c, d) {
                e.annotLineBorder(a, b, c), d || (f.setLineBorder(b, c), this.readerApp.setModified(a, a.getDocView(), !0))
            },
            onSelected: function(a, b) {
                return e.onSelected(a, b), e.showPropertyMenuContainer(!0, b), !0
            },
            onDeSelected: function(a, b) {
                e.onDeSelected(a, b), e.showPropertyMenuContainer(!1)
            },
            onFocus: function(a, b) {},
            onLButtonDown: function(a, b, c) {
                return this.onSelected(a, b)
            },
            onLButtonUp: function(a, b, c) {},
            onLButtonDblClk: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onLButtonDblClk(a, b, c)
            },
            onMouseOver: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseOver(a, b, c)
            },
            onMouseLeave: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseLeave(a, b, c)
            },
            onUpdatePosition: function(a, b, c) {
                e.onUpdatePosition(a, b, c)
            },
            onDraw: function(a, b, c, d) {
                e.onDraw(a, b, c, d)
            }
        }, WebPDF.InkAnnotHandler
    }), define("core/Plugins/Annot/DrawingAnnot/InkAnnotView", ["core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b)
        }
        var e = WebPDF.Tool.getReaderApp(),
            f = WebPDF.PDFPoint,
            g = WebPDF.Common,
            h = WebPDF.Interface,
            i = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotView");
        return d.prototype = {
            containsJQDocView: function(a) {
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                return WebPDF.Common.containsNode(c.get(0), a.target, !0) ? void 0 : !1
            },
            onSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotUIManager.getAnnotDivID(a, c);
                $("#" + d).addClass("fwr-annot-selected")
            },
            onDeSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotUIManager.getAnnotDivID(a, c);
                $("#" + d).removeClass("fwr-annot-selected")
            },
            addCursor: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (b.addClass("fwr-pencil-cursor-ie"), b.css("cursor", "crosshair")) : b.addClass("fwr-pencil-cursor")
            },
            onDeactivate: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-pencil-cursor-ie") : b.removeClass("fwr-pencil-cursor")
            },
            onUpdatePosition: function(a, b, c) {
                var d = b.getRect(),
                    e = a.pdfRectToDevice(d, !0),
                    f = this.annotUIManager.getInkAnnotDivID(a, b.getAnnotName()),
                    g = this.annotUIManager.getAnnotCanvasDivID(a, b.getAnnotName());
                $("#" + f).css({
                    left: e.left,
                    top: e.top,
                    width: WebPDF.RectUtils.width(e),
                    height: WebPDF.RectUtils.height(e)
                });
                var h = this.annotUIManager.getAnnotDivID(a, b.getAnnotName()),
                    i = $("#" + h);
                i.css({
                    left: e.left,
                    top: e.top,
                    width: WebPDF.RectUtils.width(e),
                    height: WebPDF.RectUtils.height(e)
                });
                var j = document.getElementById(g);
                null != j && ($(j).height(WebPDF.RectUtils.height(e)), $(j).width(WebPDF.RectUtils.width(e)), $(j).attr("width", WebPDF.RectUtils.width(e)), $(j).attr("height", WebPDF.RectUtils.height(e))), this.onDraw(a, b, !0, 1)
            },
            onDraw: function(a, b, c, d, e) {
                d = $.isNumeric(d) ? d : 1;
                var h = b.getAnnotName(),
                    i = this.annotUIManager.getAnnotCanvasDivID(a, h),
                    j = document.getElementById(i);
                if (null == j || c || $.support.canvas || (uuClass.Canvas.InitCavansElement(j), j = document.getElementById(i)), j) {
                    var k = j.getContext("2d");
                    null != k._clear ? k._clear() : k.clearRect(0, 0, j.width, j.height);
                    var l = e ? e : b.getInkBorderWidth();
                    k.lineWidth = l * a.getScale() * d, k.strokeStyle = WebPDF.Common.hexColor2Rgba(b.getInkColor(), 1);
                    var m = b.getRect(),
                        n = a.pdfRectToDevice(m, !0),
                        o = b.getInkList();
                    if (null != o) {
                        k.beginPath(), k.lineJoin = "round";
                        for (var p = o.length, q = 0; p > q; q++) {
                            var r = o[q],
                                s = r.length;
                            if (!(1 >= s)) {
                                for (var t = [], u = 0; s > u; u++) {
                                    var v = a.pdfPtToDevice(r[u]);
                                    v.x = (v.x - n.left) * d, v.y = (v.y - n.top) * d, t.push(v)
                                }
                                var w = t[0];
                                if (k.moveTo(w.x, w.y), 1 == s) {
                                    var x = t[1];
                                    k.lineTo(x.x, x.y), k.stroke()
                                } else {
                                    var y, z, A = new f(0, 0),
                                        B = new f(0, 0),
                                        C = new f(0, 0),
                                        D = new f(0, 0),
                                        E = new f(0, 0),
                                        F = new f(0, 0),
                                        G = (new f(0, 0), 1);
                                    A = w;
                                    do k.moveTo(A.x, A.y), s - G == 1 ? (D = t[G++], B.x = (2 * A.x + D.x) / 3, B.y = (2 * A.y + D.y) / 3, C.x = (A.x + 2 * D.x) / 3, C.y = (A.y + 2 * D.y) / 3, k.bezierCurveTo(B.x, B.y, C.x, C.y, D.x, D.y), A = D) : s - G == 2 ? (B = t[G++], C = t[G], E.x = B.x - A.x, E.y = B.y - A.y, F.x = C.x - B.x, F.y = C.y - B.y, y = g.vectorLength(E) < .001 ? 0 : g.slopeAngle(E), z = g.vectorLength(F) < .001 ? 0 : g.slopeAngle(F), Math.abs(y - z) > 3.1415926535 / 3 ? (D = B, B.x = (2 * A.x + D.x) / 3, B.y = (2 * A.y + D.y) / 3, C.x = (A.x + 2 * D.x) / 3, C.y = (A.y + 2 * D.y) / 3, k.moveTo(A.x, A.y), k.bezierCurveTo(B.x, B.y, C.x, C.y, D.x, D.y), A = D) : (k.moveTo(A.x, A.y), k.bezierCurveTo(A.x, A.y, B.x, B.y, C.x, C.y), G++, A = C)) : (B = t[G++], C = t[G], D = t[G + 1], k.bezierCurveTo(B.x, B.y, C.x, C.y, D.x, D.y), G += 2, A = D); while (s > G)
                                }
                            }
                        }
                        k.stroke()
                    }
                }
            },
            moveAnnot: function(a, b, c, d, f, g) {
                var h = a.getScale(),
                    i = e.getPixelsPerPoint();
                c /= i * h, d /= i * h, b.offsetInkList(c, d);
                var j = b.getAnnotName(),
                    k = this.annotUIManager.getAnnotDivID(a, j),
                    l = $("#" + k);
                l.css({
                    left: f + "px",
                    top: g + "px"
                });
                var m = this.annotUIManager.getInkAnnotDivID(a, j),
                    n = $("#" + m);
                n.css({
                    left: f + "px",
                    top: g + "px"
                })
            },
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotUIManager.getAnnotDivID(a, c);
                $("#" + d).remove();
                var e = this.annotUIManager.getInkAnnotDivID(a, c);
                $("#" + e).remove();
                var f = b.getPopup();
                if (null != f && null == b.getHeadAnnot()) {
                    var g = this.annotUIManager.getAnnotPopupDivID(a, c);
                    $("#" + g).remove()
                }
            }
        }, h.extend(d, i), d
    }), define("core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", ["core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils"], function(a, b, c) {
        function d(a, b) {
            this.annotUIManager = new WebPDF.Annot.AnnotUIManager(a, b), this.annotHandlerMgr = a
        }
        var e = WebPDF.Tool.getReaderApp(),
            f = (WebPDF.PDFPoint, WebPDF.PDFRect, WebPDF.RectUtils, a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"));
        a("core/Common/CoordinateUtils");
        return d.prototype = {
            containsJQDocView: function(a) {
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                return WebPDF.Common.containsNode(c.get(0), a.target, !0) ? void 0 : !1
            },
            onLButtonInPage: function(a) {
                for (var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(), c = b.getVisiblePageRange(), d = null, e = null, f = c.begin; f <= c.end; f++) {
                    var g = b.getPageView(f),
                        h = $("#" + g.getPageViewContainerID()).offset(),
                        i = g.getPageViewWidth(),
                        j = g.getPageViewHeight();
                    if (e = new WebPDF.PDFRect(h.left, h.top, h.left + i, h.top + j), WebPDF.RectUtils.normalize(e), WebPDF.RectUtils.ptInRect(e, a.pageX, a.pageY)) {
                        d = g;
                        break
                    }
                }
                return d ? {
                    pageView: d,
                    pageViewRect: e
                } : !1
            },
            onSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotUIManager.getAnnotDivID(a, c);
                $("#" + d).addClass("fwr-annot-selected"), this.updateBorder(a, b, !0)
            },
            onDeSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotUIManager.getAnnotDivID(a, c);
                $("#" + d).removeClass("fwr-annot-selected"), this.updateBorder(a, b, !1)
            },
            addCursor: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (b.addClass("fwr-note-cursor-ie"), b.css("cursor", "crosshair")) : b.addClass("fwr-note-cursor")
            },
            onActivate: function() {
                this.addCursor()
            },
            onDeactivate: function() {
                var a = e.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-note-cursor-ie") : b.removeClass("fwr-note-cursor")
            },
            onUpdatePosition: function(a, b, c) {
                var d, e, g, h, i = b.getRect(),
                    j = a.pdfRectToDevice(i, !0),
                    k = this.annotUIManager.getDrawingAnnotDivID(a, b.getAnnotName()),
                    l = this.annotUIManager.getAnnotCanvasDivID(a, b.getAnnotName()),
                    m = f.adjust(a, b);
                g = WebPDF.RectUtils.width(j) + 2 * m, h = WebPDF.RectUtils.height(j) + 2 * m, d = j.left - m, e = j.top - m, $("#" + k).css({
                    left: d,
                    top: e,
                    width: g,
                    height: h
                });
                var n = this.annotUIManager.getAnnotDivID(a, b.getAnnotName()),
                    o = $("#" + n);
                o.css({
                    left: d,
                    top: e,
                    width: g,
                    height: h
                });
                var p = document.getElementById(l);
                null != p && ($(p).attr("width", g), $(p).attr("height", h)), this.onDraw(a, b, !0, 1);
                var q = b.getAnnotName(),
                    r = this.annotUIManager.getDrawingAnnotBorderDivID(a, q),
                    s = $("#" + r).is(":visible");
                this.updateBorder(a, b, s)
            },
            moveAnnot: function(a, b, c, d, e, f) {
                var g = b.getAnnotName(),
                    h = this.annotUIManager.getAnnotDivID(a, g),
                    i = $("#" + h);
                i.css({
                    left: e - 1 + "px",
                    top: f - 1 + "px"
                });
                var j = this.annotUIManager.getDrawingAnnotDivID(a, g),
                    k = $("#" + j);
                k.css({
                    left: e + "px",
                    top: f + "px"
                })
            },
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotUIManager.getAnnotDivID(a, c);
                $("#" + d).remove();
                var e = this.annotUIManager.getDrawingAnnotDivID(a, c);
                $("#" + e).remove();
                var f = b.getPopup();
                if (null != f && null == b.getHeadAnnot()) {
                    var g = this.annotUIManager.getAnnotPopupDivID(a, c);
                    $("#" + g).remove()
                }
            },
            setAnnotColor: function(a, b, c) {
                if (this.onDraw(a, b, !0, 1), !e.isMobile()) {
                    var d = this.annotUIManager.getAnnotPopupDivID(a, b.getAnnotName()),
                        f = $("#" + d);
                    WebPDF.Common.isColorBlack(c) ? f.css("color", "#fff") : f.css("color", "#000"), f.css("backgroundColor", c), f.find(".popup_header .popup_child").css("backgroundColor", c), f.find(".popup_header").css("backgroundColor", c)
                }
            },
            setAnnotFillColor: function(a, b, c) {
                b.setFillColor && (b.setFillColor(c), this.onDraw(a, b, !0, 1))
            },
            annotLineBorder: function(a, b, c) {
                this.onDraw(a, b, !0, 1, c)
            },
            showPropertyMenuContainer: function(a, b) {
                var c = "fwr-annots-context-menu-container";
                a ? b.isReadOnly() || $("#" + c).find("#open_property").show() : $("#" + c).find("#open_property").hide()
            },
            changeAnnotRectMove: function(a, b, c) {
                this.annotUIManager.changeAnnotRectMove(a, b, c)
            },
            isBorderVisible: function(a, b) {
                var c = this.annotUIManager.getDrawingAnnotBorderDivID(a, b);
                return $("#" + c).is(":visible") ? !0 : !1
            },
            getMoveDivRect: function(a, b) {
                var c = this.annotUIManager.getAnnotMoveDivID(a, b.getAnnotName()),
                    d = document.getElementById(c),
                    e = this.annotUIManager.getElemRect(d),
                    g = f.adjust(a, b);
                return WebPDF.RectUtils.deflateEx(e, g), e
            }
        }, d
    }), define("core/Common/CoordinateUtils", [], function(a, b, c) {
        return WebPDF.CoordinateUtils = {
            pagePointToCanvansPoint: function(a, b, c, d) {
                var e = new WebPDF.PDFPoint(c.x, c.y),
                    f = $(b).offset(),
                    g = $("#" + a.getPageViewContainerID()).offset(),
                    h = g.left - f.left;
                return 270 == d ? (e.x = a.getPageViewHeight() - c.y, e.y = c.x) : 90 == d ? (e.x = c.y, e.y = a.getPageViewWidth() + 2 * h - c.x) : 180 == d && (e.x = a.getPageViewWidth() + 2 * h - c.x, e.y = a.getPageViewHeight() - c.y), e
            },
            pageRectToCanvansRect: function(a, b, c, d) {
                var e = this.pagePointToCanvansPoint(a, b, new WebPDF.PDFPoint(c.left, c.top), d),
                    f = this.pagePointToCanvansPoint(a, b, new WebPDF.PDFPoint(c.right, c.bottom), d);
                return {
                    left: e.x,
                    top: e.y,
                    right: f.x,
                    bottom: f.y
                }
            }
        }, WebPDF.CoordinateUtils
    }), define("core/Plugins/Annot/DrawingAnnot/DrawingAnnotHandler", ["core/Plugins/Annot/DrawingPropertyDlg", "core/Plugins/Annot/DrawingAnnot/CircleAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Common/Math/Point", "core/WebPDF", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService", "core/Plugins/Annot/DrawingAnnot/SquareAnnotView", "core/Plugins/Annot/DrawingAnnot/LineAnnotView", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotView", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DrawingAnnot/LineAnnotHandler", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotHandler"], function(a, b, c) {
        var d = (a("core/Plugins/Annot/DrawingPropertyDlg"), a("core/Plugins/Annot/DrawingAnnot/CircleAnnotView")),
            e = a("core/Plugins/Annot/DrawingAnnot/PolygonAnnotView"),
            f = a("core/Plugins/Annot/DrawingAnnot/SquareAnnotView"),
            g = a("core/Plugins/Annot/DrawingAnnot/LineAnnotView"),
            h = a("core/Plugins/Annot/DistanceAnnot/DistanceAnnotView"),
            i = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"),
            j = a("core/Plugins/Annot/DrawingAnnot/PolygonAnnotService");
        WebPDF.DrawingAnnotHandler = function(a, b, c, d, e, f) {
            this.readerApp = e, this.annotHandlerManager = f, this.annotType = a, this.drawingView = b, this.drawingService = c, this.commentPropertyDlg = d, this.commentPropertyDlg.setAnnotHandler(this), this.selectIndex = -1, this.polygonList, this.oldRect, this.oldVts, this._isMoving = !1
        }, WebPDF.DrawingAnnotHandler.prototype = {
            getType: function() {
                return this.annotType
            },
            canAnswer: function(a, b) {
                return this.drawingService.canAnswer(a, b) ? !0 : !1
            },
            canMove: function(a) {
                return !0
            },
            moveAnnot: function(a, b, c, d, e, f) {
                this.drawingService.moveAnnot && this.drawingService.moveAnnot(a, b, c, d, e, f), this.drawingView.moveAnnot(a, b, c, d, e, f), this.drawingService.moveAnnotRecord(a, b)
            },
            deleteAnnot: function(a, b) {
                this.drawingView.deleteAnnot(a, b)
            },
            setAnnotProperty: function(a, b, c, d) {
                var e = WebPDF.Common.getReaderApp();
                if (e.isEditable()) {
                    var f = {
                        annot: b,
                        event: c,
                        multiSelect: d,
                        pageView: a
                    };
                    this.commentPropertyDlg.setOptions(f), this.commentPropertyDlg.show(c.pageX, c.pageY, f)
                }
            },
            setAnnotColor: function(a, b, c) {
                c = WebPDF.Common.rgb2HexColor(c), this.drawingService.setAnnotColor(b, c), this.drawingView.setAnnotColor(a, b, c), this.readerApp.setModified(a, a.getDocView(), !0)
            },
            onSelected: function(a, b) {
                return this.drawingView.onSelected(a, b), this.drawingView.showPropertyMenuContainer(!0, b), !0
            },
            onDeSelected: function(a, b) {
                this.drawingView.onDeSelected(a, b), this.commentPropertyDlg.disabledDlg(), this.drawingView.showPropertyMenuContainer(!1)
            },
            onFocus: function(a, b) {},
            onLButtonDown: function(a, b, c) {
                return this.drawingService.isInPolygonPoint && this.drawingService.polygonPdfVtsToDevice && (this.selectIndex = this.isInPolygonPoint(a, b, c), this.polygonList = this.drawingService.polygonPdfVtsToDevice(a, b.getVts()), this.selectIndex > -1 && (this.oldRect = b.getRect(), this.oldVts = b.getVts())), this.onSelected(a, b)
            },
            onLButtonUp: function(a, b, c) {},
            onAnnotLButtonUp: function(a, b, c) {
                var d = [];
                if (this.selectIndex > -1 && ("Polygon" === b.getSubType() || "PolyLine" === b.getSubType())) {
                    var e = {
                        name: b.getAnnotName(),
                        newRect: b.getRect(),
                        oldRect: this.oldRect,
                        newVts: b.getVts(),
                        oldVts: this.oldVts
                    };
                    d.push(e)
                }
                this.selectIndex = -1, this.polygonList = null;
                var f = a.getDocView(),
                    g = new Date,
                    h = g.valueOf() + 6e4 * g.getTimezoneOffset(),
                    i = Math.floor(h / 1e3).toString();
                if (b.setModifyDate(i), this.readerApp.setModified(a, f, !0), d.length > 0) {
                    var j = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_MOVE, d);
                    this.readerApp.addAnnotUndo(j), this.oldRect = null, this.oldVts = null
                }
                return !0
            },
            onLButtonDblClk: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onLButtonDblClk(a, b, c)
            },
            onMouseOver: function(a, b, c) {},
            onMouseLeave: function(a, b, c) {
                return this._isMoving ? void console.log("isMoveing") : void this.annotHandlerManager.getMarkupAnnotHandler().onMouseLeave(a, b, c)
            },
            onAnnotChangeFinish: function(a, b) {
                if (!a || !b) return !1;
                this._isMoving = !1;
                var c = this.drawingView.getMoveDivRect(a, b);
                WebPDF.RectUtils.offset(c, 1, 1);
                var d = b.getRect(),
                    e = a.pdfRectToDevice(d, !0);
                return WebPDF.RectUtils.equal(c, e) ? !1 : (this.drawingService.setAnnotRect(a, b, c), this.changeRect(a, b, null), !0)
            },
            onAnnotChangeRectMove: function(a, b, c, d, e, f) {
                var g = b.getRect(),
                    h = a.pdfRectToDevice(g, !0);
                this._isMoving = !0, this.drawingService.geometricScalingRect(a, b, h, c.pageX, c.pageY, e, f, d) && (this.drawingView.changeAnnotRectMove(a, b, h), this.drawingView.drawSelectChangeRect(a, h))
            },
            onAnnotChangePointMove: function(a, b, c) {
                function d(a, b) {
                    return e.drawingService.changePolygonToPdf(a, b)
                }
                var e = this;
                if (this.polygonList && this.selectIndex > -1) {
                    this._isMoving = !0;
                    var f = {
                        borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                        borderWidth: b.getBorderWidth() * a.getScale(),
                        fillColor: b.getFillColor(),
                        borderStyle: b.getBorderStyle(),
                        opacity: b.getOpacity(),
                        dashArray: b.getDashArray()
                    };
                    return this.drawingView.drawSelectChangePoint(a, b, c, this.selectIndex, this.polygonList, f, d), !0
                }
                return !1
            },
            changeRect: function(a, b, c) {
                this.onUpdatePosition(a, b)
            },
            onUpdatePosition: function(a, b, c) {
                this.drawingView.onUpdatePosition(a, b, c), this.drawingView.updateBorder(a, b, !1)
            },
            onDraw: function(a, b, c, d) {
                this.drawingView.onDraw(a, b, c, d)
            },
            onRotate: function(a, b) {
                a && b && b.getSubType() == this.annotType && this.drawingView.isBorderVisible(a, b.getAnnotName()) && this.drawingView.updateBorder(a, b, !0)
            },
            isInPolygonPoint: function(a, b, c) {
                return this.drawingService.isInPolygonPoint(a, b, c)
            },
            addCursor: function(a, b, c) {
                this.drawingView.addCursor(a, b, c)
            }
        }, b.createDrawingAnnotHandle = function(b, c, k) {
            var l = null,
                m = WebPDF.AccountInstance.getUserConfig(),
                n = ["#ff9f40", "#8080ff", "#bae94c", "#fff160", "#c3c3c3", "#ff4c4c", "#669999", "#c72da1", "#996666", "#000000"];
            if (k == WebPDF.Annot.AnnotType.Circle) {
                var o = new d(c, b),
                    p = new i;
                p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_CIRCLE);
                var q = {
                        title: i18n.t("AnnotProperties.OvalTitle"),
                        colorArr: n,
                        drawingConfig: m.annot.circle
                    },
                    r = new CommentPropertyDlg(null, null, q);
                l = new WebPDF.DrawingAnnotHandler(k, o, p, r, b, c)
            } else if (k == WebPDF.Annot.AnnotType.Polygon || k == WebPDF.Annot.AnnotType.PolyLine || k == WebPDF.Annot.AnnotType.Cloud) {
                var o = new e(c, b),
                    p = new j,
                    q = {
                        title: i18n.t("AnnotProperties.PolygonTitle"),
                        colorArr: n,
                        drawingConfig: m.annot.polygon
                    };
                k == WebPDF.Annot.AnnotType.PolyLine ? (p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE), q = {
                    title: i18n.t("AnnotProperties.PolylineTitle"),
                    colorArr: n,
                    drawingConfig: m.annot.polyline
                }) : p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_POLYGON), k == WebPDF.Annot.AnnotType.Cloud ? (p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD), q = {
                    title: i18n.t("AnnotProperties.PolygonTitle"),
                    colorArr: n,
                    drawingConfig: m.annot.cloud
                }) : p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_POLYGON);
                var r = new CommentPropertyDlg(null, null, q);
                l = new WebPDF.DrawingAnnotHandler(k, o, p, r, b, c)
            } else if (k == WebPDF.Annot.AnnotType.Square) {
                var o = new f(c, b),
                    p = new i(WebPDF.Tools.TOOL_NAME_DRAWING_SQUARE);
                p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_SQUARE);
                var q = {
                        title: i18n.t("AnnotProperties.RectangleTitle"),
                        colorArr: n,
                        drawingConfig: m.annot.square
                    },
                    r = new CommentPropertyDlg(null, null, q);
                l = new WebPDF.DrawingAnnotHandler(k, o, p, r, b, c)
            } else if (k == WebPDF.Annot.AnnotType.Line) {
                var s = a("core/Plugins/Annot/DrawingAnnot/LineAnnotHandler"),
                    o = new g(c, b),
                    p = new i;
                p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_LINE), p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_LINEARROW), p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_DISTANCE);
                var q = {
                        title: i18n.t("AnnotProperties.LineTitle"),
                        colorArr: n,
                        drawingConfig: {
                            Line: m.annot.line,
                            LineArrow: m.annot.lineArrow
                        }
                    },
                    r = new CommentPropertyDlg(null, null, q);
                l = new s(k, o, p, r, b, c)
            } else if (k === WebPDF.Annot.AnnotType.Distance) {
                var t = a("core/Plugins/Annot/DistanceAnnot/DistanceAnnotHandler"),
                    o = new h(c, b),
                    p = new i;
                p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_LINE), p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_LINEARROW), p.addMatchToolType(WebPDF.Tools.TOOL_NAME_DRAWING_DISTANCE);
                var q = {
                        title: i18n.t("AnnotProperties.LineTitle"),
                        colorArr: n,
                        drawingConfig: {
                            Line: m.annot.distance,
                            LineArrow: m.annot.distance
                        }
                    },
                    r = new CommentPropertyDlg(null, null, q);
                l = new t(k, o, p, r, b, c)
            }
            return l
        }
    }), define("core/Plugins/Annot/DrawingAnnot/CircleAnnotView", ["core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b), this.onDraw = function(a, b, c, d) {
                d = $.isNumeric(d) ? d : 1;
                var e = b.getAnnotName(),
                    f = this.annotUIManager.getAnnotCanvasDivID(a, e),
                    h = document.getElementById(f);
                if (null == h || c || $.support.canvas || (uuClass.Canvas.InitCavansElement(h), h = document.getElementById(f)), h) {
                    var i = h.getContext("2d");
                    null != i._clear ? i._clear() : i.clearRect(0, 0, h.width, h.height);
                    var j = b.getRect(),
                        l = a.pdfRectToDevice(j, !0),
                        m = new WebPDF.PDFRect(0, 0, l.right - l.left, l.bottom - l.top),
                        n = {
                            borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                            borderWidth: b.getBorderWidth() * a.getScale() * d,
                            fillColor: b.getFillColor(),
                            borderStyle: b.getBorderStyle(),
                            dashArray: b.getDashArray()
                        };
                    g.deflateEx(m, n.borderWidth / 2), k.drawCircle(i, m.left, m.top, m.right, m.bottom, n)
                }
            }, this.updateBorder = function(a, b, c) {
                function d(a) {
                    return q = "<div class ='fwr-annot-border fwr-drawing-select-border' style='left: {left_x}px;top: {left_y}px; cursor:{w_cursor}' dir='{direct_left}'></div><div class ='fwr-annot-border fwr-drawing-select-border' style='left:{top_x}px;top: {top_y}px; cursor:{s_cursor}' dir='{direct_top}'></div> <div class ='fwr-annot-border fwr-drawing-select-border' style='left:{right_x}px;top:{right_y}px; cursor:{w_cursor}' dir='{direct_right}'></div> <div class ='fwr-annot-border fwr-drawing-select-border' style='left:{bottom_x}px;top:{bottom_y}px;cursor:{s_cursor}' dir='{direct_bottom}'></div> ", q.format(a)
                }
                if (a && b) {
                    var g = b.getAnnotName(),
                        i = function(a, b) {
                            var c = $("#" + b),
                                d = new f;
                            return d.top = parseFloat(c.css("top")), d.left = parseFloat(c.css("left")), d.bottom = d.top + parseFloat(c.css("height")), d.right = d.left + parseFloat(c.css("width")), d
                        },
                        j = this.annotUIManager.getDrawingAnnotBorderDivID(a, g),
                        k = $("#" + j);
                    if (c === !1) return void k.hide();
                    var l = this.annotUIManager.getDrawingAnnotDivID(a, g),
                        m = i(a, l),
                        n = m.bottom - m.top,
                        o = m.right - m.left,
                        p = e.getDocView().getRotate(),
                        q = "",
                        r = [h.LEFT, h.TOP, h.RIGHT, h.BOTTOM],
                        s = ["w-resize", "s-resize"],
                        t = p / 90 % 4,
                        u = p / 90 % 2,
                        v = {
                            left_x: -4,
                            left_y: n / 2 - 4,
                            direct_left: r[t],
                            top_x: o / 2 - 4,
                            top_y: -4,
                            direct_top: r[(t + 1) % 4],
                            right_x: o - 4,
                            right_y: n / 2 - 4,
                            direct_right: r[(t + 2) % 4],
                            bottom_x: o / 2 - 4,
                            bottom_y: n - 4,
                            direct_bottom: r[(t + 3) % 4],
                            w_cursor: s[u],
                            s_cursor: s[(u + 1) % 2]
                        };
                    q = d(v), k[0].innerHTML = q, k.show()
                }
            }, this.drawSelectChangeRect = function(a, b) {
                function c(a, b, c) {
                    var d = $("#" + a.getPageViewContainerID()).offset(),
                        e = $(b).offset(),
                        f = d.left - e.left,
                        g = d.top - e.top,
                        h = a.getDocView().getRotate(),
                        i = {};
                    return h % 180 == 0 ? (i.left = c.left + f, i.right = c.right + f, i.top = c.top + g, i.bottom = c.bottom + g) : (i.left = c.left + g, i.right = c.right + g, i.top = c.top + f, i.bottom = c.bottom + f), i
                }
                var d = this.annotHandlerMgr.getCavansElement();
                d || (this.annotHandlerMgr.getUIManager().resetCanvens(a), d = this.annotHandlerMgr.getCavansElement());
                var e = d.getContext("2d");
                e.clearRect(0, 0, d.width, d.height);
                var f = c(a, d, b),
                    g = {
                        borderColor: "#55AAAA",
                        borderWidth: 1
                    };
                k.drawCircle(e, f.left, f.top, f.right, f.bottom, g)
            }
        }
        var e = WebPDF.Tool.getReaderApp(),
            f = WebPDF.PDFRect,
            g = WebPDF.RectUtils,
            h = WebPDF.Common.Direc,
            i = WebPDF.Interface,
            j = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotView"),
            k = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        a("core/Common/CoordinateUtils"), WebPDF.Common;
        return d.prototype = {}, i.extend(d, j), d
    }), define("core/Plugins/Annot/DrawingAnnot/PolygonAnnotView", ["core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Common/Math/Point", "core/WebPDF", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b);
            var c = new k;
            this.onDraw = function(a, b, d, e) {
                e = $.isNumeric(e) ? e : 1;
                var f = b.getAnnotName(),
                    g = this.annotUIManager.getAnnotCanvasDivID(a, f),
                    h = (a.getScale(), document.getElementById(g));
                if (null == h || d || $.support.canvas || (uuClass.Canvas.InitCavansElement(h), h = document.getElementById(g)), h) {
                    var i = h.getContext("2d");
                    null != i._clear ? i._clear() : i.clearRect(0, 0, h.width, h.height);
                    var k = {
                            borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                            borderWidth: b.getBorderWidth() * a.getScale() * e,
                            fillColor: b.getFillColor(),
                            borderStyle: b.getBorderStyle(),
                            opacity: b.getOpacity(),
                            dashArray: b.getDashArray()
                        },
                        l = this.getPolygonListInCanvas(a, b);
                    if ("PolyLine" === b.getSubType()) j.drawPolygonListLine(l, i, k);
                    else if ("PolygonCloud" === b.getIT()) {
                        var m = c.getCloudPoints(a, this.getAnnotVtsList(b), !0);
                        j.drawPolygonListCloud(m.csAp, i, k)
                    } else j.drawPolygonListLine(l, i, k, !0)
                }
            }, this.moveAnnot = function(a, b, c, d, e, g) {
                f.setModified(a, a.getDocView(), !0);
                var h = b.getAnnotName(),
                    i = this.annotUIManager.getAnnotDivID(a, h),
                    j = $("#" + i);
                j.css({
                    left: e + "px",
                    top: g + "px"
                });
                var k = this.annotUIManager.getDrawingAnnotDivID(a, h),
                    l = $("#" + k);
                l.css({
                    left: e + "px",
                    top: g + "px"
                })
            }, this.onUpdatePosition = function(a, b, c) {
                var d, e, f, g, h = b.getRect(),
                    i = a.pdfRectToDevice(h, !0),
                    j = this.annotUIManager.getDrawingAnnotDivID(a, b.getAnnotName()),
                    k = this.annotUIManager.getAnnotCanvasDivID(a, b.getAnnotName());
                f = WebPDF.RectUtils.width(i), g = WebPDF.RectUtils.height(i), d = i.left, e = i.top, $("#" + j).css({
                    left: d,
                    top: e,
                    width: f,
                    height: g
                });
                var l = this.annotUIManager.getAnnotDivID(a, b.getAnnotName()),
                    m = $("#" + l);
                m.css({
                    left: d,
                    top: e,
                    width: f,
                    height: g
                });
                var n = document.getElementById(k);
                null != n && ($(n).attr("width", f), $(n).attr("height", g))
            }, this.updateBorder = function(a, b, d) {
                if (a && b) {
                    var e = b.getAnnotName(),
                        f = this.annotUIManager.getAnnotCanvasDivID(a, e),
                        g = document.getElementById(f);
                    if (g) {
                        var h = g.getContext("2d");
                        h.clearRect(0, 0, g.width, g.height);
                        var i = 1,
                            k = {
                                borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                                borderWidth: b.getBorderWidth() * a.getScale() * i,
                                fillColor: b.getFillColor(),
                                borderStyle: b.getBorderStyle(),
                                opacity: b.getOpacity(),
                                dashArray: b.getDashArray()
                            },
                            l = this.getPolygonListInCanvas(a, b);
                        if ("PolyLine" === b.getSubType()) j.drawPolygonListLine(l, h, k);
                        else if ("PolygonCloud" === b.getIT()) {
                            var m = c.getCloudPoints(a, this.getAnnotVtsList(b), !0);
                            j.drawPolygonListCloud(m.csAp, h, k)
                        } else j.drawPolygonListLine(l, h, k, !0);
                        d && j.drawPolygonControlRect(l, h)
                    }
                }
            }, this.drawSelectChangeRect = function(a, b) {}, this.addCursor = function(a, b, c) {
                if (b) {
                    var d = b.getAnnotName(),
                        e = this.annotUIManager.getAnnotDivID(a, d);
                    c >= 0 ? ($("#" + e).removeClass("fwr-default-cursor"), WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? ($("#" + e).addClass("fwr-note-cursor-ie"), $("#" + e).css("cursor", "crosshair")) : $("#" + e).addClass("fwr-note-cursor")) : $("#" + e).addClass("fwr-default-cursor")
                } else {
                    var g = f.getMainView().getDocView(),
                        h = $("#" + g.getDocViewContainerID());
                    WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (h.addClass("fwr-note-cursor-ie"), h.css("cursor", "crosshair")) : h.addClass("fwr-note-cursor")
                }
            }, this.drawSelectChangePoint = function(b, d, h, i, k, l, m) {
                f.setModified(b, b.getDocView(), !0);
                var n = d.getAnnotName(),
                    o = this.annotUIManager.getAnnotCanvasDivID(b, n),
                    p = document.getElementById(o),
                    q = this.annotUIManager.getDrawingAnnotDivID(b, n),
                    r = this.annotUIManager.getAnnotDivID(b, n),
                    s = j.copyPolygonList(k),
                    t = e(h, i, s, p, b, a.getCavansElement()),
                    u = j.getRectPolygonList(t, b),
                    v = m(b, t);
                d.setVts(v);
                var w = new WebPDF.PDFRect(u[0], u[1], u[2], u[3]),
                    x = b.deviceRectToPDF(w, !0, 0),
                    y = 2.25;
                if ("PolyLine" === d.getSubType() && (y = 4.5), "PolygonCloud" == d.getIT()) {
                    for (var z = [], A = 0; A < v.length; A += 2) z.push([v[A], v[A + 1]]);
                    var B = c.getCloudPoints(b, z, !1, !1);
                    x = B.pdfRect, y = 0
                }
                x.left = x.left - y, x.top = x.top + y, x.right = x.right + y, x.bottom = x.bottom - y, d.setRect(x);
                var C = b.pdfRectToDevice(x, !0),
                    D = g.width(C),
                    E = g.height(C);
                $("#" + r).css({
                    left: C.left,
                    top: C.top,
                    width: D,
                    height: E
                }), $("#" + q).css({
                    left: C.left,
                    top: C.top,
                    width: D,
                    height: E
                }), p.width = D, p.height = E;
                var F = new WebPDF.PDFRect(C.left, C.top, C.right - C.left, C.bottom - C.top),
                    G = p.getContext("2d"),
                    H = this.seriPolygonListInCanvas(t, F);
                if ("PolyLine" === d.getSubType()) j.drawPolygonListLine(H, G, l);
                else if ("PolygonCloud" === d.getIT()) {
                    var I = c.getCloudPoints(b, this.getAnnotVtsList(d), !0);
                    j.drawPolygonListCloud(I.csAp, G, l)
                } else j.drawPolygonListLine(H, G, l, !0);
                j.drawPolygonControlRect(H, G);
                var J = {
                    annot: this.annotHandlerMgr.packageAnnot(d),
                    pageIndex: b.getPageIndex(),
                    annotObject: d
                };
                $(f).trigger(WebPDF.EventList.ANNOT_UPDATED, J)
            }, this.getPolygonListInCanvas = function(a, b) {
                var c = this.polygonPdfVtsToDevice(a, b.getVts()),
                    d = b.getRect(),
                    e = a.pdfRectToDevice(d, !0),
                    f = this.seriPolygonListInCanvas(c, e);
                return f
            }, this.polygonPdfVtsToDevice = function(a, b) {
                for (var c = [], d = [], e = [], f = 0; f < b.length; f++) {
                    d = [], e = [], d[0] = b[f], f += 1, f < b.length && (d[1] = b[f]);
                    var g = new WebPDF.PDFPoint(d[0], d[1]),
                        h = a.pdfPtToDevice(g);
                    e[0] = h.x, e[1] = h.y, c.push(e)
                }
                return c
            }, this.seriPolygonListInCanvas = function(a, b) {
                if (a.length > 0)
                    for (var c = 0; c < a.length; c++) a[c][0] = a[c][0] - b.left, a[c][1] = a[c][1] - b.top;
                return a
            }, this.getAnnotVtsList = function(a) {
                for (var b = [], c = a.getVts(), d = 0; d < c.length; d += 2) b.push([parseFloat(c[d]), parseFloat(c[d + 1])]);
                return b
            }, this.setAnnotOpacity = function(a, b, c, d) {
                var e = b.getOpacity();
                b.setOpacity(c / 100), this.onDraw(a, b, !0, 1), d && b.setOpacity(e)
            }, this.setAnnotFillColor = function(a, b, c) {
                b.setFillColor(c), this.onDraw(a, b, !0, 1)
            }, this.annotLineBorder = function(a, b, d, e) {
                e || (b.setBorderWidth(d), f.setModified(a, a.getDocView(), !0));
                var g = b.getAnnotName(),
                    h = this.annotUIManager.getAnnotCanvasDivID(a, g),
                    i = (a.getScale(), document.getElementById(h));
                if (null == i || $.support.canvas || (uuClass.Canvas.InitCavansElement(i), i = document.getElementById(h)), i) {
                    var k = i.getContext("2d");
                    null != k._clear ? k._clear() : k.clearRect(0, 0, i.width, i.height);
                    var l = {
                            borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                            borderWidth: d,
                            fillColor: b.getFillColor(),
                            opacity: b.getOpacity()
                        },
                        m = c.getCloudPoints(a, this.getAnnotVtsList(b), !0);
                    j.drawPolygonListCloud(m.csAp, k, l)
                }
            }
        }

        function e(a, b, c, d, e, f) {
            var g = d.getContext("2d"),
                h = j.copyPolygonList(c);
            g.clearRect(0, 0, d.width, d.height);
            var i = {
                    left: 0,
                    top: 0
                },
                k = new WebPDF.PDFPoint(0, 0);
            k.setPoint(a.pageX - i.left, a.pageY - i.top);
            var l = $("#" + e.getPageViewContainerID()).offset();
            k.x -= l.left - i.left, k.y -= l.top - i.top;
            var m = e.devicePtToPDF(k),
                n = e.pdfPtToDevice(m);
            if (c.length > 0)
                for (var o = 0; o < c.length; o++) o === b && b > -1 ? (h[o][0] = n.x, h[o][1] = n.y) : (h[o][0] = c[o][0], h[o][1] = c[o][1]);
            return h
        }
        var f = WebPDF.Tool.getReaderApp(),
            g = (WebPDF.PDFRect, WebPDF.RectUtils),
            h = (WebPDF.Common.Direc, WebPDF.Interface),
            i = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotView"),
            j = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            k = (a("core/Common/CoordinateUtils"), a("core/Plugins/Annot/DrawingAnnot/PolygonAnnotService"));
        return d.prototype = {}, h.extend(d, i), d
    }), define("core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", ["core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/Math/Point", "core/WebPDF", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"], function(a, b, c) {
        function d() {
            d.superclass.constructor.call(this), this.isInPolygonPoint = function(a, b, c) {
                var d = (c.target, a.getDocView().getDocViewContainerID() + "_AnnotCanvas", $("#" + a.getPageViewContainerID()).offset()),
                    e = c.pageX,
                    f = c.pageY,
                    g = {
                        left: 0,
                        top: 0
                    },
                    h = e - g.left,
                    i = f - g.top;
                h -= d.left - g.left, i -= d.top - g.top;
                var j = a.getPageViewWidth(),
                    k = a.getPageViewHeight(),
                    l = this.polygonPdfVtsToDevice(a, b.getVts()),
                    m = [h, i],
                    n = 0;
                270 === a.getDocView().getRotate() ? (n = m[1], m[1] = m[0], m[0] = k - n) : 180 === a.getDocView().getRotate() ? (m[0] = j - m[0], m[1] = k - m[1]) : 90 === a.getDocView().getRotate() && (n = m[0], m[0] = m[1], m[1] = j - n);
                var o = -1;
                if (l.length > 0)
                    for (var p = 0; p < l.length; p++)
                        if (m && m.length > 0 && m[0] <= l[p][0] + WebPDF.Config.defaults.drawingSelectSize / 2 && m[0] >= l[p][0] - WebPDF.Config.defaults.drawingSelectSize / 2 && m[1] <= l[p][1] + WebPDF.Config.defaults.drawingSelectSize / 2 && m[1] >= l[p][1] - WebPDF.Config.defaults.drawingSelectSize / 2) {
                            o = p;
                            break
                        }
                return o
            }, this.moveAnnot = function(a, b, c, d, e, f) {
                for (var g = this.polygonPdfVtsToDevice(a, b.getVts()), h = 0; h < g.length; h++) g[h][0] = g[h][0] + c, g[h][1] = g[h][1] + d;
                this.addLimitInPage(a, g);
                var i = this.changePolygonToPdf(a, g);
                b.setVts(i)
            }, this.changePolygonToPdf = function(a, b) {
                for (var c = [], d = 0; d < b.length; d++) {
                    var e = new WebPDF.PDFPoint(b[d][0], b[d][1]),
                        f = new l(0, 0);
                    f = a.point2pdf(e);
                    var g = [];
                    g[0] = f.x, g[1] = f.y, c.push(g[0]), c.push(g[1])
                }
                return c
            }, this.polygonDeviceVtsToPdf = function(a, b) {
                for (var c = [], d = 0; d < b.length; d++) {
                    var e = new WebPDF.PDFPoint(b[d][0], b[d][1]),
                        f = a.devicePtToPDF(e),
                        g = [];
                    g[0] = f.x, g[1] = f.y, c.push(g[0]), c.push(g[1])
                }
                return c
            }, this.polygonPdfVtsToDevice = function(a, b) {
                for (var c = [], d = [], e = [], f = 0; f < b.length; f++) {
                    d = [], e = [], d[0] = b[f], f += 1, f < b.length && (d[1] = b[f]);
                    var g = new WebPDF.PDFPoint(d[0], d[1]),
                        h = a.pdfPtToDevice(g);
                    e[0] = h.x, e[1] = h.y, c.push(e)
                }
                return c
            }, this.addLimitInPage = function(a, b) {
                for (var c = a.getPageViewWidth(), d = a.getPageViewHeight(), e = 0; e < b.length; e++) {
                    var f = b[e];
                    f[0] <= WebPDF.Config.defaults.drawingSelectSize / 2 ? f[0] = WebPDF.Config.defaults.drawingSelectSize / 2 : f[0] >= c - WebPDF.Config.defaults.drawingSelectSize / 2 ? f[0] = c - WebPDF.Config.defaults.drawingSelectSize / 2 : f[1] <= WebPDF.Config.defaults.drawingSelectSize / 2 ? f[1] = WebPDF.Config.defaults.drawingSelectSize / 2 : f[1] >= d - WebPDF.Config.defaults.drawingSelectSize / 2 && (f[1] = d - WebPDF.Config.defaults.drawingSelectSize / 2)
                }
            }, this.getCloudPoints = function(a, b, c, d) {
                if (!(b.length < 2)) {
                    var e, f, j, l, m, n, o, q, s, t = 8 * b.length,
                        u = {},
                        v = {},
                        w = [],
                        x = new r;
                    l = 0, e = [b[0][0], b[0][1]], x.left = x.right = e[0], x.bottom = x.top = e[1], s = b.length;
                    for (var y = 1; s >= y; y++) f = [b[y % s][0], b[y % s][1]], u.x = f[0] - e[0], u.y = f[1] - e[1], l += g(u), x.left > f[0] && (x.left = f[0]), x.bottom > f[1] && (x.bottom = f[1]), x.right < f[0] && (x.right = f[0]), x.top < f[1] && (x.top = f[1]), e = [f[0], f[1]];
                    q = l / (1 * t), m = 0, e = [b[0][0], b[0][1]], f = [b[1][0], b[1][1]], u.x = f[0] - e[0], u.y = f[1] - e[1], l = g(u), n = 0, j = [];
                    for (var y = 0, z = 0; t > y; y++) {
                        m > l && (n = l, z++, e = [b[z][0], b[z][1]], f = [b[(z + 1) % s][0], b[(z + 1) % s][1]], u.x = f[0] - e[0], u.y = f[1] - e[1], l += g(u)), v.x = u.x, v.y = u.y;
                        var A = g(v);
                        A > 0 && (v.x = 1 * v.x / A, v.y = 1 * v.y / A), v.x *= m - n, v.y *= m - n, j = [e[0] + v.x, e[1] + v.y], w.push({
                            x: j[0],
                            y: j[1]
                        }), m += q
                    }
                    q = 0, e = {
                        x: w[0].x,
                        y: w[0].y
                    }, t = w.length;
                    for (var y = 1; t >= y; y++) f = {
                        x: w[y % t].x,
                        y: w[y % t].y
                    }, u.x = f.x - e.x, u.y = f.y - e.y, q < g(u) && (q = g(u)), e = {
                        x: f.x,
                        y: f.y
                    };
                    q = 5 * q / 8;
                    var B, C, D = "",
                        E = [],
                        F = !0,
                        G = new r;
                    e = {}, f = {}, j = {};
                    for (var H = 0, y = 0; t > y; y++) {
                        e = {
                            x: w[y].x,
                            y: w[y].y
                        }, f = {
                            x: w[(t - 1 + y) % t].x,
                            y: w[(t - 1 + y) % t].y
                        }, j = {
                            x: w[(y + 1) % t].x,
                            y: w[(y + 1) % t].y
                        }, u.x = f.x - e.x, u.y = f.y - e.y, v.x = j.x - e.x, v.y = j.y - e.y, B = h(u), u.y < 0 && (B *= -1), o = Math.acos(g(u) / (2 * q)), B += o - p / 9, C = h(v), v.y < 0 && (C *= -1), o = Math.acos(g(v) / (2 * q)), C -= o, B > C && (C += 2 * p), G.left = e.x - q, G.bottom = e.y - q, G.right = e.x + q, G.top = e.y + q;
                        var I = i(G, B, C, F);
                        H += I.arrAp.length, D = I.arrAp, G = I.pdfRect, F && (F = !1);
                        for (var J = 0; J < D.length; J++) {
                            for (var K = [], z = 0; z < D[J].length; z++) K.push(D[J][z]);
                            E.push(K)
                        }
                        WebPDF.RectUtils.union(x, G), u.x = e.x - j.x, u.y = e.y - j.y, B = h(u), u.y < 0 && (B *= -1), o = Math.acos(g(u) / (2 * q)), B += o, C = B - p / 9, G.left = j.x - q, G.bottom = j.y - q, G.right = j.x + q, G.top = j.y + q;
                        var I = i(G, B, C, F);
                        H += I.arrAp.length, D = I.arrAp;
                        for (var J = 0; J < D.length; J++) {
                            for (var K = [], z = 0; z < D[J].length; z++) K.push(D[J][z]);
                            E.push(K)
                        }
                    }
                    if (!d) {
                        var L = 2.25 / k.getPixelsPerPoint();
                        x.left = x.left - L, x.top = x.top + L, x.right = x.right + L, x.bottom = x.bottom - L
                    }
                    if (c)
                        for (var M = a.pdfRectToDevice(x, !0), y = 0; y < E.length; y++)
                            for (var z = 0; z < E[y].length; z += 2) {
                                var N = new WebPDF.PDFPoint(E[y][z], E[y][z + 1]),
                                    O = a.pdfPtToDevice(N);
                                E[y][z] = O.x - M.left, E[y][z + 1] = O.y - M.top
                            }
                    return {
                        csAp: E,
                        pdfRect: x
                    }
                }
            }
        }

        function e(a, b) {
            b || (b = {}, b.x = 1, b.y = 0);
            var c = j(a, b);
            return c / (g(a) * g(b))
        }

        function f(a, b) {
            return Math.acos(e(a, b))
        }

        function g(a) {
            return Math.sqrt(a.x * a.x + a.y * a.y)
        }

        function h(a) {
            return f(a)
        }

        function i(a, b, c, d) {
            var e = new r;
            if (WebPDF.RectUtils.isEmpty(a)) return {
                arrAp: [],
                pdfRect: e
            };
            if (Math.abs(c - b) <= q) return {
                arrAp: [],
                pdfRect: e
            };
            var f, g, h, i, j, k, l, m, n, s, t, u, v, w, x, y, z, A, B, C, D, E, F, G, H = [];
            f = (a.right + a.left) / 2, g = (a.top + a.bottom) / 2, h = Math.abs(a.right - a.left) / 2, i = Math.abs(a.top - a.bottom) / 2, F = b, t = h * Math.cos(F), u = i * Math.sin(F), D = f + t, E = g + u, e.left = e.right = D, e.bottom = e.top = E, d && H.push([D, E]);
            var I = 1;
            b > c && (I = -1);
            var J = Math.floor(2 * b / p);
            I > 0 && (J += 1), J *= p / 2;
            for (var K = !1;;) {
                if (G = J, I > 0 ? J >= c && (G = c, K = !0) : c >= J && (G = c, K = !0), t = h * Math.cos(F), u = i * Math.sin(F), z = h * Math.cos(G), A = i * Math.sin(G), j = i * i * t, l = h * h * u, k = i * i * z, m = h * h * A, n = s = -h * h * i * i, B = (l * s - m * n) / (j * m - k * l), C = (k * n - j * s) / (j * m - k * l), D = B - t, E = C - u, v = t + D * o, w = u + E * o, D = B - z, E = C - A, x = z + D * o, y = A + E * o, D = f + v, E = g + w, v = D, w = E, e.left > v && (e.left = v), e.bottom > w && (e.bottom = w), e.right < v && (e.right = v), e.top < w && (e.top = w), D = f + x, E = g + y, x = D, y = E, e.left > x && (e.left = x), e.bottom > y && (e.bottom = y), e.right < x && (e.right = x), e.top < y && (e.top = y), D = f + z, E = g + A, z = D, A = E, e.left > z && (e.left = z), e.bottom > A && (e.bottom = A), e.right < z && (e.right = z), e.top < A && (e.top = A), H.push([v, w, x, y, z, A]), K) break;
                F = G, J += I * p / 2
            }
            return {
                arrAp: H,
                pdfRect: e
            }
        }

        function j(a, b) {
            return a.x * b.x + a.y * b.y
        }
        var k = WebPDF.Tool.getReaderApp(),
            l = (a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"), a("core/Common/Math/Point")),
            m = WebPDF.Interface,
            n = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"),
            o = (WebPDF.Common, .5522847498308),
            p = 3.14159265358979,
            q = 1e-4,
            r = WebPDF.PDFRect;
        return m.extend(d, n), d
    }), define("core/Plugins/Annot/DrawingAnnot/SquareAnnotView", ["core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b), this.onDraw = function(a, b, c, d) {
                d = $.isNumeric(d) ? d : 1;
                var e = b.getAnnotName(),
                    f = this.annotUIManager.getAnnotCanvasDivID(a, e),
                    h = document.getElementById(f);
                if (null == h || c || $.support.canvas || (uuClass.Canvas.InitCavansElement(h), h = document.getElementById(f)), h) {
                    var i = h.getContext("2d");
                    null != i._clear ? i._clear() : i.clearRect(0, 0, h.width, h.height);
                    var j = b.getRect(),
                        l = a.pdfRectToDevice(j, !0),
                        m = new WebPDF.PDFRect(0, 0, l.right - l.left, l.bottom - l.top),
                        n = {
                            borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                            borderWidth: b.getBorderWidth() * a.getScale() * d,
                            fillColor: b.getFillColor(),
                            borderStyle: b.getBorderStyle(),
                            dashArray: b.getDashArray()
                        };
                    g.deflateEx(m, n.borderWidth / 2), k.drawSquare(i, m.left, m.top, m.right, m.bottom, n)
                }
            }, this.updateBorder = function(a, b, c) {
                function d(a) {
                    return q = "<div class ='fwr-annot-border fwr-drawing-select-border' style='left: {left_x}px;top: {left_y}px; cursor:{w_cursor}' dir='{direct_left}'></div><div class ='fwr-annot-border fwr-drawing-select-border' style='left:{top_x}px;top: {top_y}px; cursor:{s_cursor}' dir='{direct_top}'></div> <div class ='fwr-annot-border fwr-drawing-select-border' style='left:{right_x}px;top:{right_y}px; cursor:{w_cursor}' dir='{direct_right}'></div> <div class ='fwr-annot-border fwr-drawing-select-border' style='left:{bottom_x}px;top:{bottom_y}px;cursor:{s_cursor}' dir='{direct_bottom}'></div> <div class ='fwr-annot-border fwr-drawing-select-border' style='left:{ltx}px;top:{lty}px; cursor:{nw_cursor}' dir='{direct_lt}'></div><div class ='fwr-annot-border fwr-drawing-select-border' style='left:{rtx}px;top:{rty}px; cursor:{ne_cursor}' dir='{direct_rt}'></div><div class ='fwr-annot-border fwr-drawing-select-border' style='left:{rbx}px;top:{rby}px; cursor:{nw_cursor}' dir='{direct_rb}'></div><div class ='fwr-annot-border fwr-drawing-select-border' style='left:{lbx}px;top:{lby}px; cursor:{ne_cursor}' dir='{direct_lb}'></div>", q.format(a)
                }
                if (a && b) {
                    var g = b.getAnnotName(),
                        i = function(a, b) {
                            var c = $("#" + b),
                                d = new f;
                            return d.top = parseFloat(c.css("top")), d.left = parseFloat(c.css("left")), d.bottom = d.top + parseFloat(c.css("height")), d.right = d.left + parseFloat(c.css("width")), d
                        },
                        j = this.annotUIManager.getDrawingAnnotBorderDivID(a, g),
                        k = $("#" + j);
                    if (c === !1) return void k.hide();
                    var l = this.annotUIManager.getDrawingAnnotDivID(a, g),
                        m = i(a, l),
                        n = m.bottom - m.top,
                        o = m.right - m.left,
                        p = e.getDocView().getRotate(),
                        q = "",
                        r = [h.LEFT, h.TOP, h.RIGHT, h.BOTTOM],
                        s = [h.LEFT_TOP, h.RIGHT_TOP, h.RIGHT_BOTTOM, h.LEFT_BOTTOM],
                        t = ["w-resize", "s-resize"],
                        u = ["nw-resize", "ne-resize"],
                        v = p / 90 % 4,
                        w = p / 90 % 2,
                        x = {
                            left_x: -4,
                            left_y: n / 2 - 4,
                            direct_left: r[v],
                            top_x: o / 2 - 4,
                            top_y: -4,
                            direct_top: r[(v + 1) % 4],
                            right_x: o - 4,
                            right_y: n / 2 - 4,
                            direct_right: r[(v + 2) % 4],
                            bottom_x: o / 2 - 4,
                            bottom_y: n - 4,
                            direct_bottom: r[(v + 3) % 4],
                            w_cursor: t[w],
                            s_cursor: t[(w + 1) % 2],
                            ltx: -4,
                            lty: -4,
                            direct_lt: s[v],
                            rtx: o - 4,
                            rty: -4,
                            direct_rt: s[(v + 1) % 4],
                            rbx: o - 4,
                            rby: n - 4,
                            direct_rb: s[(v + 2) % 4],
                            lbx: -4,
                            lby: n - 4,
                            direct_lb: s[(v + 3) % 4],
                            nw_cursor: u[w],
                            ne_cursor: u[(w + 1) % 2]
                        };
                    q = d(x), k[0].innerHTML = q, k.show()
                }
            }, this.drawSelectChangeRect = function(a, b) {
                function c(a, b, c) {
                    var d = $("#" + a.getPageViewContainerID()).offset(),
                        e = $(b).offset(),
                        f = d.left - e.left,
                        g = d.top - e.top,
                        h = a.getDocView().getRotate(),
                        i = {};
                    return h % 180 == 0 ? (i.left = c.left + f, i.right = c.right + f, i.top = c.top + g, i.bottom = c.bottom + g) : (i.left = c.left + g, i.right = c.right + g, i.top = c.top + f, i.bottom = c.bottom + f), i
                }
                var d = this.annotHandlerMgr.getCavansElement();
                d || (this.annotHandlerMgr.getUIManager().resetCanvens(a), d = this.annotHandlerMgr.getCavansElement());
                var e = d.getContext("2d");
                e.clearRect(0, 0, d.width, d.height);
                var f = c(a, d, b),
                    g = {
                        borderColor: "#55AAAA",
                        borderWidth: 1
                    };
                k.drawSquare(e, f.left, f.top, f.right, f.bottom, g)
            }
        }
        var e = WebPDF.Tool.getReaderApp(),
            f = WebPDF.PDFRect,
            g = WebPDF.RectUtils,
            h = WebPDF.Common.Direc,
            i = WebPDF.Interface,
            j = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotView"),
            k = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        a("core/Common/CoordinateUtils"), WebPDF.Common;
        return d.prototype = {}, i.extend(d, j), d
    }), define("core/Plugins/Annot/DrawingAnnot/LineAnnotView", ["core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b), this.onDraw = function(a, b, c, d) {
                d = $.isNumeric(d) ? d : 1;
                var e = b.getAnnotName(),
                    f = this.annotUIManager.getAnnotCanvasDivID(a, e),
                    g = document.getElementById(f);
                if (null == g || c || $.support.canvas || (uuClass.Canvas.InitCavansElement(g), g = document.getElementById(f)), g) {
                    var h = g.getContext("2d");
                    null != h._clear ? h._clear() : h.clearRect(0, 0, g.width, g.height);
                    var i = b.getRect(),
                        k = a.pdfRectToDevice(i, !0),
                        l = a.pdfPtToDevice(b.getStartPoint()),
                        m = a.pdfPtToDevice(b.getEndPoint()),
                        n = {
                            borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                            borderWidth: b.getBorderWidth() * a.getScale() * d,
                            startStyle: b.getStartStyle(),
                            endStyle: b.getEndStyle(),
                            fillColor: b.getFillColor(),
                            borderStyle: b.getBorderStyle(),
                            dashArray: b.getDashArray(),
                            arrowLength: a.getScale() * d * 14
                        },
                        o = j.adjust(a, b, d);
                    j.drawLineArrow(h, l.x - k.left + o, l.y - k.top + o, m.x - k.left + o, m.y - k.top + o, n)
                }
            }, this.updateBorder = function(a, b, c) {
                function d(a) {
                    var b = "<div class ='fwr-annot-border fwr-drawing-select-border' style='left: {sx}px;top: {sy}px; cursor:{cursor}' dir='{direct_start}'></div><div class ='fwr-annot-border fwr-drawing-select-border' style='left:{ex}px;top: {ey}px; cursor:{cursor}' dir='{direct_end}'></div> ";
                    return b.format(a)
                }
                if (a && b) {
                    var f = this.annotUIManager.getDrawingAnnotBorderDivID(a, b.getAnnotName()),
                        h = $("#" + f);
                    if (c === !1) return void h.hide();
                    var i = a.pdfRectToDevice(b.getRect(), !0),
                        k = a.pdfPtToDevice(b.getStartPoint()),
                        l = a.pdfPtToDevice(b.getEndPoint()),
                        m = [g.MOVE_START, g.MOVE_END],
                        n = (e.getDocView().getRotate(), 0),
                        o = j.adjust(a, b),
                        p = {
                            sx: k.x - 4 - i.left + o,
                            sy: k.y - 4 - i.top + o,
                            direct_start: m[n],
                            ex: l.x - 4 - i.left + o,
                            ey: l.y - 4 - i.top + o,
                            direct_end: m[(n + 1) % 2],
                            cursor: "move"
                        };
                    h[0].innerHTML = d(p), h.show()
                }
            }, this.changeAnnotRectMove = function(a, b, c) {
                var d = b.getAnnotName(),
                    e = this.annotUIManager.getAnnotMoveDivID(a, d),
                    f = $("#" + e),
                    g = j.adjust(a, b);
                f.css({
                    left: c.left - g + "px",
                    top: c.top - g + "px",
                    width: c.right - c.left + 2 * g + "px",
                    height: c.bottom - c.top + 2 * g + "px"
                })
            }, this.drawSelectChangeRect = function(a, b) {
                function c(a, b, c) {
                    var d = $("#" + a.getPageViewContainerID()).offset(),
                        e = $(b).offset(),
                        f = d.left - e.left,
                        g = d.top - e.top,
                        h = a.getDocView().getRotate(),
                        i = {};
                    return h % 180 == 0 ? (i.x = c.x + f, i.y = c.y + g) : (i.x = c.x + g, i.y = c.y + f), i
                }
                var d = this.annotHandlerMgr.getCavansElement();
                d || (this.annotHandlerMgr.getUIManager().resetCanvens(a), d = this.annotHandlerMgr.getCavansElement());
                var e = d.getContext("2d");
                e.clearRect(0, 0, d.width, d.height);
                var g = c(a, d, new f(b.left, b.top)),
                    h = c(a, d, new f(b.right, b.bottom)),
                    i = {
                        borderColor: "#55AAAA",
                        borderWidth: 1
                    };
                j.drawLine(e, g.x, g.y, h.x, h.y, i)
            }, this.saveLineRect = function(a, b, c) {
                var d = this.annotUIManager.getDrawingAnnotDivID(a, b);
                $("#" + d).data("lineRect", c)
            }, this.getLineRect = function(a, b) {
                var c = this.annotUIManager.getDrawingAnnotDivID(a, b);
                return $("#" + c).data("lineRect")
            }
        }
        var e = WebPDF.Tool.getReaderApp(),
            f = (WebPDF.PDFRect, WebPDF.PDFPoint),
            g = (WebPDF.RectUtils, WebPDF.Common.Direc),
            h = WebPDF.Interface,
            i = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotView"),
            j = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        a("core/Common/CoordinateUtils"), WebPDF.Common;
        return d.prototype = {}, h.extend(d, i), d
    }), define("core/Plugins/Annot/DistanceAnnot/DistanceAnnotView", ["core/Plugins/Annot/DrawingAnnot/LineAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Common/CoordinateUtils", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale"], function(a, b, c) {
        function d(a, b) {
            var c = this;
            e.apply(c, arguments);
            var d = c.onDraw;
            c.onDraw = function(a, b, c, e) {
                if (d.apply(this, arguments), b.showCaption()) {
                    var h = b.getAnnotName(),
                        j = this.annotUIManager.getAnnotCanvasDivID(a, h),
                        k = document.getElementById(j);
                    if (k) {
                        var l = k.getContext("2d"),
                            m = a.pdfPtToDevice(b.getStartPoint()),
                            n = a.pdfPtToDevice(b.getEndPoint()),
                            o = b.getRect(),
                            p = a.pdfRectToDevice(o, !0),
                            q = g.adjust(a, b, e),
                            r = new i(m.x - p.left + q, m.y - p.top + q),
                            s = new i(n.x - p.left + q, n.y - p.top + q),
                            t = a.getDocView().getRotate();
                        f.drawDistanceText(b, l, r, s, t, a.getScale())
                    }
                }
            }
        }
        var e = a("core/Plugins/Annot/DrawingAnnot/LineAnnotView"),
            f = a("core/Plugins/Annot/DistanceAnnot/common"),
            g = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            h = WebPDF.Interface,
            i = WebPDF.PDFPoint;
        h.extend(d, e), c.exports = d
    }), define("core/Plugins/Annot/DistanceAnnot/common", ["core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale"], function(a, b, c) {
        function d(a, b, c, d) {
            var e = h.PIXEL_HORIZONTAL.convertTo(b.x - a.x, c) / d,
                f = h.PIXEL_VERTICAL.convertTo(b.y - a.y, c) / d,
                g = Math.sqrt(e * e + f * f);
            return Math.round(100 * g) / 100
        }

        function e(a, b, c) {
            var d = i18n.t("Distance.Unit." + c.name);
            if ("string" != typeof a || a.trim().length < 1) return "Distance: <br>" + b + d;
            var e = a.split(/\n|\r\n|<br\\?>/g),
                f = new RegExp("^(\\s*)(\\d+(\\.\\d+)?\\s*(" + d + ")?)(.*)$"),
                g = e.length <= 1 ? 0 : 1;
            return e[g] = e[g].replace(f, "$1" + b + d + "$5"), e.join("<br>")
        }

        function f(a, b, c, d, e, f) {
            var h = WebPDF.PDFPoint,
                k = WebPDF.AccountInstance.getUserConfig().annot.distance;
            if (c.y > d.y) {
                var l = c;
                c = d, d = l
            }
            var m = e / 180 * Math.PI,
                n = new h((c.x + d.x) / 2, (c.y + d.y) / 2),
                o = (Math.atan2(d.y - c.y, d.x - c.x) + j) % j,
                p = (o + m) % j;
            p > Math.PI / 2 && p < 3 * Math.PI / 2 && (o += Math.PI);
            var q = Math.ceil(k.fontSize * (Math.log(f + 1) / Math.log(2))),
                r = i.of(a).distanceOf(c, d, f),
                s = r.distance.toFixed(2) + " " + i18n.t("Distance.Unit." + r.unit.name);
            b.font = q + "px bold Arial";
            var t = b.measureText(s),
                u = Math.sqrt(Math.pow(d.x - c.x, 2) + Math.pow(d.y - c.y, 2));
            t.width > u && (q *= Math.max(.4, u / t.width));
            var v;
            v = a ? a.getColor() : k.clr;
            var w = g(v);
            b.save(), b.fillStyle = w, b.font = q + "px bold Arial", b.textBaseline = "middle", b.textAlign = "center", b.translate(n.x, n.y), b.rotate(o), b.fillText(s, 0, 0), b.restore()
        }

        function g(a) {
            var b = 10855845 ^ parseInt(a.replace("#", ""), 16),
                c = 255 - (b >> 16 & 255),
                d = 255 - (b >> 8 & 255),
                e = 255 - (255 & b);
            return "#" + [c, d, e].map(function(a) {
                return a.toString(16)
            }).join("")
        }
        var h = a("core/Plugins/Annot/DistanceAnnot/units"),
            i = a("core/Plugins/Annot/DistanceAnnot/DistanceScale"),
            j = 2 * Math.PI;
        c.exports = {
            calcDistance: d,
            normalizeContent: e,
            drawDistanceText: f
        }
    }), define("core/Plugins/Annot/DistanceAnnot/units", [], function() {
        function a(a, b) {
            this.fromInchRate = a, this.name = b
        }

        function b() {
            this.name = "px"
        }

        function c(a) {
            b.call(this);
            var c = WebPDF.Common.getDeviceDPI();
            switch (a) {
                case d:
                    this.fromInchRate = c.xDPI;
                    break;
                case e:
                    this.fromInchRate = c.yDPI
            }
        }
        var d = {},
            e = {};
        a.prototype.isPixel = !1, a.prototype.convertTo = function(a, b) {
            var c = a / this.fromInchRate;
            return c * b.fromInchRate
        }, b.prototype = Object.create(a.prototype, {
            isPixel: {
                value: !0
            }
        }), b.prototype.convertTo = function(a, b, c) {
            switch (c) {
                case d:
                    return f.PIXEL_VERTICAL.convertTo(a, b);
                case e:
                    return f.PIXEL_HORIZONTAL.convertTo(a, b);
                default:
                    throw new Error("Illegal orientation value")
            }
        }, c.prototype = Object.create(b.prototype, {
            convertTo: {
                value: a.prototype.convertTo
            }
        });
        var f = {
            INCH: new a(1, "inch"),
            CUSTOM: new a(1, "custom"),
            MILE: new a(1 / 63360, "mi"),
            POINT: new a(72, "pt"),
            FOOT: new a(1 / 12, "ft"),
            YARD: new a(1 / 36, "yd"),
            KILOMETER: new a(.0254 / 1e3, "km"),
            METER: new a(.0254, "m"),
            CENTIMETER: new a(2.54, "cm"),
            MILLIMETER: new a(25.4, "mm"),
            PICA: new a(6, "pica"),
            PIXEL_HORIZONTAL: new c(e),
            PIXEL_VERTICAL: new c(d),
            PIXEL: new b,
            ORIENTATION: {
                VERTICAL: d,
                HORIZONTAL: e
            },
            smartConvert: function(a, b, c, d) {
                if (c === f.PIXEL) switch (d) {
                    case f.ORIENTATION.VERTICAL:
                        c = f.PIXEL_VERTICAL;
                        break;
                    case f.ORIENTATION.HORIZONTAL:
                        c = f.PIXEL_VERTICAL
                }
                return b.convertTo(a, c)
            }
        };
        return f
    }), define("core/Plugins/Annot/DistanceAnnot/DistanceScale", ["core/Plugins/Annot/DistanceAnnot/units"], function(a, b, c) {
        function d() {
            this.fromScale = 1, this.toScale = 1, this.fromUnit = f.INCH, this.toUnit = f.INCH, this.precision = .01, this.$jq = $(this)
        }

        function e(a, b) {
            return "number" != typeof b && (b = .01), b = 1 / b, Math.round(Math.abs(a) * b) / b
        }
        var f = a("core/Plugins/Annot/DistanceAnnot/units"),
            g = new d;
        c.exports = g;
        var h = 999999,
            i = 1e-4,
            j = {};
        for (var k in f) {
            var l = f[k];
            l.name && (j[l.name] = l)
        }
        $.extend(d.prototype, {
            MAX_SCALE_VALUE: h,
            MIN_SCALE_VALUE: i,
            of: function(a) {
                var b;
                if (a && (b = a.getAnnotJSONData().measure), !b) return g;
                var c = new d;
                return c.fromScale = b[0], c.toScale = b[2], c.setFromUnit(b[1]), c.setToUnit(b[3]), c
            },
            setFromUnit: function(a) {
                return j[a] ? (this.fromUnit = j[a], this.$jq.trigger("change", this), this) : void 0
            },
            setToUnit: function(a) {
                return j[a] ? (this.toUnit = j[a], this.$jq.trigger("change", this), this) : void 0
            },
            change: function(a) {
                return this.$jq.on("change", a), this
            },
            offChange: function(a) {
                return this.$jq.off("change", a), this
            },
            scale: function() {
                var a = this.fromUnit.convertTo(this.fromScale, this.toUnit);
                return this.toScale / a
            },
            measureForAnnot: function() {
                return [this.fromScale, this.fromUnit.name, this.toScale, this.toUnit.name, 1]
            },
            distanceOf: function(a, b, c) {
                var d = b.x - a.x,
                    g = b.y - a.y,
                    h = this.scale(),
                    i = c,
                    j = f.PIXEL_HORIZONTAL.convertTo(d, this.fromUnit),
                    k = f.PIXEL_HORIZONTAL.convertTo(g, this.fromUnit),
                    l = this.fromUnit.convertTo(j, this.toUnit) * h / i,
                    m = this.fromUnit.convertTo(k, this.toUnit) * h / i,
                    n = Math.sqrt(l * l + m * m);
                return {
                    unit: this.toUnit,
                    distanceX: e(l, this.precision),
                    distanceY: e(m, this.precision),
                    distance: e(n, this.precision)
                }
            }
        })
    }), define("core/Plugins/Annot/DrawingAnnot/LineAnnotHandler", [], function(a, b, c) {
        return LineAnnotHandler = function(a, b, c, d, e, f) {
            function g(a, b, c) {
                var d = a.PtPageRotateToScreen(b, c);
                return d = a.devicePtToPDF(d, c)
            }
            LineAnnotHandler.superclass.constructor.call(this, a, b, c, d, e, f), this.moveAnnot = function(a, b, c, d, e, f) {
                this.drawingView.moveAnnot(a, b, c, d, e, f);
                var h = a.pdfPtToDevice(b.getStartPoint()),
                    i = a.pdfPtToDevice(b.getEndPoint());
                h.offset(c, d), i.offset(c, d);
                var j = a.getDocView().getRotate();
                h = g(a, h, j), i = g(a, i, j), this.drawingService.reSetLineAnnotRect(a, b, h, i), this.drawingService.moveAnnotRecord(a, b)
            }, this.onAnnotChangeFinish = function(a, b) {
                if (!a || !b) return !1;
                this._isMoving = !1;
                var c = this.annotChangeFinish(a, b);
                return c ? (this.addAnnotUndo(a, c), !0) : !1
            }, this.addAnnotUndo = function(a, b) {
                var c = [b],
                    d = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_MOVE, c);
                this.readerApp.addAnnotUndo(d)
            }, this.annotChangeFinish = function(a, b) {
                var c = this.drawingView.getLineRect(a, b.getAnnotName());
                if (!c) return null;
                this._isMoving = !1;
                var d = a.getDocView().getRotate(),
                    e = new WebPDF.PDFPoint(c.left, c.top);
                e = g(a, e, d);
                var f = new WebPDF.PDFPoint(c.right, c.bottom);
                f = g(a, f, d);
                var h = b.getRect(),
                    i = b.getStartPoint(),
                    j = b.getEndPoint();
                this.drawingService.reSetLineAnnotRect(a, b, e, f), this.changeRect(a, b, null);
                var k = {
                    name: b.getAnnotName(),
                    newRect: b.getRect(),
                    oldRect: h,
                    oldStartPoint: i,
                    newStartPoint: b.getStartPoint(),
                    oldEndPoint: j,
                    newEndPoint: b.getEndPoint()
                };
                return k
            }, this.onAnnotChangeRectMove = function(b, c, d, e, f, g) {
                var h = c.getRect(),
                    i = b.pdfRectToDevice(h, !0);
                if (this.annotType == a) {
                    this._isMoving = !0;
                    var j = b.pdfPtToDevice(c.getStartPoint()),
                        k = b.pdfPtToDevice(c.getEndPoint()),
                        l = new WebPDF.PDFRect(j.x, j.y, k.x, k.y);
                    this.drawingService.geometricScalingRect(b, c, l, d.pageX, d.pageY, f, g, e) && (WebPDF.RectUtils.copy(l, i), WebPDF.RectUtils.normalizeEx(i), this.drawingView.changeAnnotRectMove(b, c, i), this.drawingView.drawSelectChangeRect(b, l), this.drawingView.saveLineRect(b, c.getAnnotName(), l))
                }
            }
        }, WebPDF.Interface.extend(LineAnnotHandler, WebPDF.DrawingAnnotHandler), LineAnnotHandler
    }), define("core/Plugins/Annot/DistanceAnnot/DistanceAnnotHandler", ["core/Plugins/Annot/DrawingAnnot/LineAnnotHandler", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        "use strict";

        function d(a, b, c, g, h, m) {
            d.superclass.constructor.call(this, a, b, c, g, h, m);
            var n = this,
                o = $("#" + h.getAppId()),
                p = n.canAnswer;
            $(h).on([WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, WebPDF.EventList.DOCVIEW_PAGE_CHANGED].join(","), function() {
                var a = h.getDocView(),
                    c = a.getPageView(a.getCurPageIndex()),
                    d = c.getPDFPage();
                d.enumAnnots(function(a) {
                    "LineDimension" === a.getIntent() && b.onDraw(c, a, !0)
                })
            }), o.off("blur.distance", ".fwr_popup_content").on("blur.distance", ".fwr_popup_content", function() {
                var a = $(this),
                    b = a.closest(".fwr-popup-annot"),
                    c = parseInt(b.attr("page-index")),
                    d = a.attr("annot-name"),
                    e = h.getMainView().getDocView(),
                    f = e.getPageView(c),
                    g = f.getPDFPage(),
                    i = g.getAnnotByName(d),
                    j = $(this).html(),
                    m = j.split(/\r\n|\n|<br\/?>/),
                    o = parseFloat(m[1]);
                if (!isNaN(o)) {
                    var p = i.getStartPoint(),
                        q = i.getEndPoint(),
                        r = f.pdfPtToDevice(p),
                        s = f.pdfPtToDevice(q),
                        t = k.of(i),
                        u = t.distanceOf(r, s, f.getScale()).distance;
                    if (o !== u) {
                        var v = o / u,
                            w = q.x - p.x,
                            x = q.y - p.y,
                            y = new l(p.x + w * v, p.y + x * v),
                            z = f.pdfPtToDevice(y),
                            A = r.x - z.x,
                            B = z.y - r.y,
                            C = f.getPageViewWidth(),
                            D = f.getPageViewHeight();
                        switch (e.getRotate()) {
                            case 90:
                            case 270:
                                C = f.getPageViewHeight(), D = f.getPageViewWidth()
                        }
                        z.x < 0 ? (z.x = 0, z.y = r.y + B * (r.x / A)) : z.x > C && (z.x = C, z.y = r.y + B * (r.x - C) / A), z.y < 0 ? (z.y = 0, z.x = r.x + A * (r.y / B)) : z.y > D && (z.y = D, z.x = r.x + A * (r.y - D) / B), y = f.devicePtToPDF(z);
                        var E = new WebPDF.PDFRect(r.x, r.y, z.x, z.y),
                            F = i.getRect(),
                            G = f.pdfRectToDevice(F, !0);
                        WebPDF.RectUtils.copy(E, G), WebPDF.RectUtils.normalizeEx(G), n.drawingView.changeAnnotRectMove(f, i, G), n.drawingView.drawSelectChangeRect(f, E), n.drawingView.saveLineRect(f, i.getAnnotName(), E), n.onAnnotChangeFinish(f, i)
                    }
                }
            }), this.onAnnotChangeFinish = function(a, b) {
                var c = this.annotChangeFinish(a, b);
                if (!c) return !1;
                this._isMoving = !1;
                var d = a.pdfPtToDevice(b.getStartPoint()),
                    e = a.pdfPtToDevice(b.getEndPoint()),
                    f = k.of(b).distanceOf(d, e, a.getScale()),
                    g = a.getPageIndex(),
                    j = b.getAnnotName(),
                    l = b.getContents(),
                    m = i.normalizeContent(b.getContents(), f.distance, f.unit);
                this.annotHandlerManager.updateAnnotContent(g, j, m, !1);
                var n = {
                    annot: this.annotHandlerManager.packageAnnot(b),
                    pageIndex: g,
                    annotObject: b
                };
                $(h).trigger(WebPDF.EventList.ANNOT_UPDATED, n), c.oldContents = l, c.newContents = b.getContents(), this.addAnnotUndo(a, c)
            };
            var q, r = this.onMouseOver,
                s = "mousemove." + Date.now().toString(16),
                t = f();
            this.onMouseOver = function(a, b, c) {
                r.apply(this, arguments);
                var d = $(c.target),
                    f = !1;
                d.on(s, function(c) {
                    var d = c.offsetX,
                        g = c.offsetY,
                        h = a.pdfPtToDevice(b.getStartPoint()),
                        i = a.pdfPtToDevice(b.getEndPoint()),
                        k = j.adjust(a, b, a.getScale()),
                        m = b.getRect(),
                        n = a.pdfRectToDevice(m, !0),
                        o = new l(h.x - n.left + k, h.y - n.top + k),
                        p = new l(i.x - n.left + k, i.y - n.top + k),
                        r = new l(d, g);
                    t.remove(), clearTimeout(q), e(o, r) + e(r, p) - e(o, p) < 3 ? (q = setTimeout(function() {
                        t.find(">.annot-tooltip-header").text(b.getTitle()), t.find(">.annot-tooltip-body>pre").html(b.getContents()), t.css({
                            left: c.clientX,
                            top: c.clientY + 15
                        }).appendTo("body")
                    }, 1e3), f = !0) : (f && t.remove(), f = !1)
                }), d.on("remove", function() {
                    t.remove(), clearTimeout(q)
                })
            }, this.onMouseLeave = function(a, b, c) {
                $(c.target).off(s), t.remove(), clearTimeout(q)
            }, this.canAnswer = function() {
                var a = h.getCurToolHandler(),
                    b = h.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_DRAWING_DISTANCE);
                return b !== a || b.isDirty() ? p.apply(this, arguments) : !1
            }
        }

        function e(a, b) {
            return Math.sqrt(Math.pow(b.x - a.x, 2) + Math.pow(b.y - a.y, 2))
        }

        function f() {
            return $(['<div class="annot-tooltip">', '<div class="annot-tooltip-header">', "</div>", "<hr>", '<div class="annot-tooltip-body">', "<pre></pre>", "</div>", "</div>"].join(""))
        }
        var g = WebPDF.Interface,
            h = a("core/Plugins/Annot/DrawingAnnot/LineAnnotHandler"),
            i = a("core/Plugins/Annot/DistanceAnnot/common"),
            j = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            k = a("core/Plugins/Annot/DistanceAnnot/DistanceScale"),
            l = WebPDF.PDFPoint;
        c.exports = d, g.extend(d, h)
    }), define("core/Plugins/Annot/CommonMarkupAnnotHandler", [], function(a, b, c) {
        return WebPDF.CommonMarkupHandler = "CommonMarkupHandler", WebPDF.InkHandler = "Ink", WebPDF.CommonMarkupAnnotHandler = function(a, b, c) {
            this.readerApp = a, this.type = c, this.annotHandlerManager = b
        }, WebPDF.CommonMarkupAnnotHandler.prototype = {
            getType: function() {
                return this.type
            },
            canAnswer: function(a, b) {
                var c = (a.getSubType(), this.readerApp.getCurToolHandler());
                if (c) {
                    var d = c.getName();
                    if (d === WebPDF.Tools.TOOL_NAME_SELANNOT || d === WebPDF.Tools.TOOL_NAME_HAND || d === this.annotType) return !0;
                    if (void 0 != b && b && d === WebPDF.TOOL_NAME_SELECTTEXT) return !0
                }
                return !1
            },
            canMove: function(a) {
                return !1
            },
            moveAnnot: function(a, b, c, d, e, f) {},
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotHandlerManager.getUIManager(),
                    e = d.getAnnotDivID(a, c);
                $("#" + e).remove();
                var f = d.getInkAnnotDivID(a, c);
                $("#" + f).remove()
            },
            onDraw: function(a, b, c, d) {},
            onSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotHandlerManager.getUIManager(),
                    e = d.getAnnotDivID(a, c);
                return $("#" + e).addClass("fwr-annot-selected"), !0
            },
            onDeSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotHandlerManager.getUIManager(),
                    e = d.getAnnotDivID(a, c);
                $("#" + e).removeClass("fwr-annot-selected")
            },
            onFocus: function(a, b) {
                this.annotHandlerManager.getMarkupAnnotHandler().onFocus(a, b)
            },
            onLButtonDown: function(a, b, c) {
                return this.onSelected(a, b)
            },
            onLButtonUp: function(a, b, c) {},
            onLButtonDblClk: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onLButtonDblClk(a, b, c)
            },
            onMouseOver: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseOver(a, b, c)
            },
            onMouseLeave: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseLeave(a, b, c)
            },
            onUpdatePosition: function(a, b, c) {
                var d = (a.getPDFPage(), b.getRect()),
                    e = a.pdfRectToDevice(d, !0),
                    f = this.annotHandlerManager.getUIManager(),
                    g = f.getAnnotDivID(a, b.getAnnotName());
                $("#" + g).css({
                    left: e.left,
                    top: e.top,
                    width: WebPDF.RectUtils.width(e),
                    height: WebPDF.RectUtils.height(e)
                })
            }
        }, WebPDF.CommonMarkupAnnotHandler
    }), define("core/Plugins/Annot/StampAnnotHandler", [], function(a, b, c) {
        return WebPDF.StampAnnotHandler = function(a, b) {
            this.readerApp = a, this.annotHandlerManager = b
        }, WebPDF.StampAnnotHandler.prototype = {
            getType: function() {
                return WebPDF.Annot.AnnotType.Stamp
            },
            canAnswer: function(a, b) {
                var c = this.readerApp.getCurToolHandler();
                if (null != c) {
                    var d = c.getName();
                    if (d === WebPDF.Tools.TOOL_NAME_SELANNOT || d === WebPDF.Tools.TOOL_NAME_HAND || d === WebPDF.Tools.TOOL_NAME_STAMP) return !0;
                    if (void 0 != b && b && d === WebPDF.TOOL_NAME_SELECTTEXT) return !0
                }
                return !1
            },
            canMove: function(a) {
                return !0
            },
            moveAnnot: function(a, b, c, d, e, f) {
                var g = b.getAnnotName(),
                    h = this.annotHandlerManager.getUIManager(),
                    i = h.getStampImageID(a, g),
                    j = $("#" + i);
                if (j.css({
                        left: e + "px",
                        top: f + "px"
                    }), b.isDynamic()) {
                    var k = h.getStampDnamicID(a, g),
                        l = parseInt(j.css("height")),
                        m = parseInt(j.css("width")),
                        n = $("#" + k),
                        o = n.width(),
                        p = n.height();
                    leftoffset = WebPDF.Annot.stampInfoOffset.left * m / WebPDF.Annot.StampDefaultValue.Width, topoffset = WebPDF.Annot.stampInfoOffset.top * l / WebPDF.Annot.StampDefaultValue.Height;
                    var q = l / WebPDF.Annot.StampDefaultValue.Height,
                        r = 0,
                        s = 0,
                        t = (a.getDocView().getRotate(), (90 * a.getPDFPage().getPageRotate() % 360 + 360) % 360),
                        u = (b.getRotate() % 360 + 360) % 360;
                    if (0 == t) switch (u) {
                        case 0:
                            if (r = e + leftoffset, s = f + topoffset, 1 > q) {
                                var v = o * (1 - q) / 2,
                                    w = p * (1 - q) / 2;
                                r -= v, s -= w
                            }
                            break;
                        case 90:
                            if (r = e + topoffset, s = f + m - leftoffset - o, 1 > q) {
                                var v = p * (1 - q) / 2,
                                    w = o * (1 - q) / 2;
                                r -= v, s += w
                            }
                            break;
                        case 180:
                            if (r = e + m - leftoffset - o, s = f + l - topoffset - p, 1 > q) {
                                var v = o * (1 - q) / 2,
                                    w = p * (1 - q) / 2;
                                r += v, s += w
                            }
                            break;
                        case 270:
                            if (r = e + l - topoffset - p, s = f + leftoffset, 1 > q) {
                                var v = p * (1 - q) / 2,
                                    w = o * (1 - q) / 2;
                                r += v, s -= w
                            }
                    } else if (90 == t) switch (u) {
                        case 0:
                            if (r = e + l - topoffset - p, s = f + leftoffset, 1 > q) {
                                var v = p * (1 - q) / 2,
                                    w = o * (1 - q) / 2;
                                r += v, s -= w
                            }
                            break;
                        case 90:
                            if (r = e + leftoffset, s = f + topoffset, 1 > q) {
                                var v = o * (1 - q) / 2,
                                    w = p * (1 - q) / 2;
                                r -= v, s -= w
                            }
                            break;
                        case 180:
                            if (r = e + topoffset, s = f + m - leftoffset - o, 1 > q) {
                                var v = p * (1 - q) / 2,
                                    w = o * (1 - q) / 2;
                                r -= v, s += w
                            }
                            break;
                        case 270:
                            if (r = e + m - leftoffset - o, s = f + l - topoffset - p, 1 > q) {
                                var v = o * (1 - q) / 2,
                                    w = p * (1 - q) / 2;
                                r += v, s += w
                            }
                    } else if (180 == t) switch (u) {
                            case 0:
                                if (r = e + m - leftoffset - o, s = f + l - topoffset - p, 1 > q) {
                                    var v = o * (1 - q) / 2,
                                        w = p * (1 - q) / 2;
                                    r += v, s += w
                                }
                                break;
                            case 90:
                                if (r = e + l - topoffset - p, s = f + leftoffset, 1 > q) {
                                    var v = p * (1 - q) / 2,
                                        w = o * (1 - q) / 2;
                                    r += v, s -= w
                                }
                                break;
                            case 180:
                                if (r = e + leftoffset, s = f + topoffset, 1 > q) {
                                    var v = o * (1 - q) / 2,
                                        w = p * (1 - q) / 2;
                                    r -= v, s -= w
                                }
                                break;
                            case 270:
                                if (r = e + topoffset, s = f + m - leftoffset - o, 1 > q) {
                                    var v = p * (1 - q) / 2,
                                        w = o * (1 - q) / 2;
                                    r -= v, s += w
                                }
                        } else if (270 == t) switch (u) {
                            case 0:
                                if (r = e + topoffset, s = f + m - leftoffset - o, 1 > q) {
                                    var v = p * (1 - q) / 2,
                                        w = o * (1 - q) / 2;
                                    r -= v, s += w
                                }
                                break;
                            case 90:
                                if (r = e + m - leftoffset - o, s = f + l - topoffset - p, 1 > q) {
                                    var v = o * (1 - q) / 2,
                                        w = p * (1 - q) / 2;
                                    r += v, s += w
                                }
                                break;
                            case 180:
                                if (r = e + l - topoffset - p, s = f + leftoffset, 1 > q) {
                                    var v = p * (1 - q) / 2,
                                        w = o * (1 - q) / 2;
                                    r += v, s -= w
                                }
                                break;
                            case 270:
                                if (r = e + leftoffset, s = f + topoffset, 1 > q) {
                                    var v = o * (1 - q) / 2,
                                        w = p * (1 - q) / 2;
                                    r -= v, s -= w
                                }
                        }
                        n.css({
                        left: r + "px",
                        top: s + "px"
                    })
                }
                var x = h.getStampDivID(a, g),
                    y = $("#" + x);
                y.css({
                    left: e + "px",
                    top: f + "px"
                }), h.updateStampBorder(a, g, !0)
            },
            changeRect: function(a, b, c) {
                this.onUpdatePosition(a, b)
            },
            resetDynamicInfo: function(a, b) {
                if (b.isDynamic()) {
                    var c = b.getAnnotName(),
                        d = this.annotHandlerManager.getUIManager(),
                        e = d.getStampDnamicID(a, c),
                        f = $("#" + e),
                        g = this.readerApp.getMainView().getDocView(),
                        h = g.getRotate(),
                        i = f.width(),
                        j = f.height(),
                        k = 0,
                        l = 0,
                        m = 0,
                        n = 0,
                        o = 0,
                        p = b.getRect(),
                        q = a.pdfRectToDevice(p, !0),
                        r = 12,
                        s = 0;
                    switch (h) {
                        case 90:
                            if (m = -90, k = l = -Math.abs(i - j) / 2, n = f.css("left"), o = parseFloat(f.css("top")) - i + "px", r = 12 * WebPDF.RectUtils.height(q) / WebPDF.Annot.StampDefaultValue.Width, 12 > r) {
                                s = r / 12;
                                var t = j * (1 - s) / 2,
                                    u = i * (1 - s) / 2;
                                n = parseFloat(n) - t + "px", o = parseFloat(o) + u + "px"
                            }
                            break;
                        case 180:
                            if (m = -180, n = parseFloat(f.css("left")) - i + "px", o = parseFloat(f.css("top")) - j + "px", r = 12 * WebPDF.RectUtils.width(q) / WebPDF.Annot.StampDefaultValue.Width, 12 > r) {
                                s = r / 12;
                                var t = i * (1 - s) / 2,
                                    u = j * (1 - s) / 2;
                                n = parseFloat(n) + t + "px", o = parseFloat(o) + u + "px"
                            }
                            break;
                        case 270:
                            if (m = -270, k = l = Math.abs(i - j) / 2, n = parseFloat(f.css("left")) - j + "px", o = f.css("top"), r = 12 * WebPDF.RectUtils.height(q) / WebPDF.Annot.StampDefaultValue.Width, 12 > r) {
                                s = r / 12;
                                var t = j * (1 - s) / 2,
                                    u = i * (1 - s) / 2;
                                n = parseFloat(n) + t + "px", o = parseFloat(o) - u + "px"
                            }
                            break;
                        case 0:
                            if (n = f.css("left"), o = f.css("top"), r = 12 * WebPDF.RectUtils.width(q) / WebPDF.Annot.StampDefaultValue.Width, 12 > r) {
                                s = r / 12;
                                var t = i * (1 - s) / 2,
                                    u = j * (1 - s) / 2;
                                n = parseFloat(n) - t + "px", o = parseFloat(o) - u + "px"
                            }
                    }
                    WebPDF.Common.addTranslateCss(f, m, k, l, null, null, s), f.css({
                        left: n,
                        top: o
                    })
                }
            },
            deleteAnnot: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotHandlerManager.getUIManager(),
                    e = d.getStampDivID(a, c);
                $("#" + e).remove();
                var f = d.getStampImageID(a, c);
                $("#" + f).parent().remove();
                var g = b.getPopup();
                if (null != g && null == b.getHeadAnnot()) {
                    var h = d.getAnnotPopupDivID(a, c);
                    $("#" + h).remove()
                }
            },
            onDraw: function(a, b, c, d) {},
            onSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotHandlerManager.getUIManager(),
                    e = d.getStampDivID(a, c),
                    f = d.getStampImageID(a, c);
                if ($("#" + e).addClass("fwr-annot-selected"), $("#" + f).addClass("fwr-annot-image-selected"), b.isDynamic()) {
                    var g = d.getStampDnamicID(a, c);
                    $("#" + g).addClass("fwr-annot-image-selected")
                }
                return d.updateStampBorder(a, c, !0), !0
            },
            onDeSelected: function(a, b) {
                var c = b.getAnnotName(),
                    d = this.annotHandlerManager.getUIManager(),
                    e = d.getStampDivID(a, c),
                    f = d.getStampImageID(a, c);
                if ($("#" + e).removeClass("fwr-annot-selected"), $("#" + f).removeClass("fwr-annot-image-selected"), b.isDynamic()) {
                    var g = d.getStampDnamicID(a, c);
                    $("#" + g).removeClass("fwr-annot-image-selected")
                }
                d.updateStampBorder(a, c, !1)
            },
            onFocus: function(a, b) {},
            onLButtonDown: function(a, b, c) {
                return this.onSelected(a, b)
            },
            onLButtonUp: function(a, b, c) {},
            onLButtonDblClk: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onLButtonDblClk(a, b, c)
            },
            onMouseOver: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseOver(a, b, c)
            },
            onMouseLeave: function(a, b, c) {
                this.annotHandlerManager.getMarkupAnnotHandler().onMouseLeave(a, b, c)
            },
            onUpdatePosition: function(a, b, c) {
                var d = a.getPDFPage(),
                    e = b.getRect(),
                    f = a.pdfRectToDevice(e, !0),
                    g = (a.getScale(), this.annotHandlerManager.getUIManager()),
                    h = g.getStampDivID(a, b.getAnnotName()),
                    i = g.getStampImageID(a, b.getAnnotName()),
                    j = $("#" + i),
                    k = (b.getRotate() % 360 + 360) % 360,
                    l = (90 * d.getPageRotate() % 360 + 360) % 360,
                    m = (a.getDocView().getRotate(), WebPDF.RectUtils.width(f)),
                    n = WebPDF.RectUtils.height(f),
                    o = 10;
                o >= m && (m = o);
                var p = 0,
                    q = 0,
                    r = 0;
                if (0 == l) switch (k) {
                    case 90:
                        r = -90, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = (n - m) / 2;
                        break;
                    case 180:
                        r = -180;
                        break;
                    case 270:
                        r = -270, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = -(n - m) / 2;
                        break;
                    case 0:
                } else if (90 == l) switch (k) {
                    case 0:
                        r = -270, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = -(n - m) / 2;
                        break;
                    case 180:
                        r = -90, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = (n - m) / 2;
                        break;
                    case 270:
                        r = -180;
                        break;
                    case 90:
                } else if (180 == l) switch (k) {
                        case 0:
                            r = -180;
                            break;
                        case 90:
                            r = -270, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = -(n - m) / 2;
                            break;
                        case 270:
                            r = -90, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = (n - m) / 2;
                            break;
                        case 180:
                    } else if (270 == l) switch (k) {
                        case 0:
                            r = -90, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = (n - m) / 2;
                            break;
                        case 90:
                            r = -180;
                            break;
                        case 180:
                            r = -270, m = WebPDF.RectUtils.height(f), n = WebPDF.RectUtils.width(f), p = q = -(n - m) / 2;
                            break;
                        case 270:
                    }
                    if (WebPDF.Common.addTranslateCss(j, r, p, q), j.css({
                            left: f.left,
                            top: f.top,
                            width: m,
                            height: n
                        }), b.isDynamic()) {
                        var s = g.getStampDnamicID(a, b.getAnnotName()),
                            t = $("#" + s),
                            u = (a.getScale(), n / WebPDF.Annot.StampDefaultValue.Height),
                            v = 0,
                            w = 0,
                            x = 0;
                        1 > u && (x = u);
                        var y = 0,
                            z = 0,
                            p = 0,
                            q = 0,
                            r = 0,
                            A = 12 * u,
                            B = b.getDynamicInfo(),
                            C = "annot_dynamic_temp";
                        tempDynamicHtml = "<p id='" + C + "' class ='fwr-stamp-info' style='display:none;position: absolute; left:" + y + "px;top:" + z + "px;font-size:" + A + "px; '>" + B + "</p>", $(document.body).append(tempDynamicHtml);
                        var D = $("#" + C);
                        WebPDF.Common.addTranslateCss(D, r, p, q, null, null, u);
                        var E = D.width(),
                            F = D.height();
                        if (D.remove(), 0 == l) switch (k) {
                            case 0:
                                if (v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + v, z = f.top + w, 12 > A) {
                                    var G = E * (1 - x) / 2,
                                        H = F * (1 - x) / 2;
                                    y -= G, z -= H
                                }
                                break;
                            case 90:
                                if (r = -90, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + w, z = f.bottom - v - E, 12 > A) {
                                    var G = F * (1 - x) / 2,
                                        H = E * (1 - x) / 2;
                                    y -= G, z += H
                                }
                                p = q = -Math.abs(E - F) / 2;
                                break;
                            case 180:
                                if (r = -180, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - v - E, z = f.bottom - w - F, 12 > A) {
                                    var G = E * (1 - x) / 2,
                                        H = F * (1 - x) / 2;
                                    y += G, z += H
                                }
                                break;
                            case 270:
                                if (r = -270, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - w - F, z = f.top + v, 12 > A) {
                                    var G = F * (1 - x) / 2,
                                        H = E * (1 - x) / 2;
                                    y += G, z -= H
                                }
                                p = q = Math.abs(E - F) / 2
                        } else if (90 == l) switch (k) {
                            case 90:
                                if (v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + v, z = f.top + w, 12 > A) {
                                    var G = E * (1 - x) / 2,
                                        H = F * (1 - x) / 2;
                                    y -= G, z -= H
                                }
                                break;
                            case 180:
                                if (r = -90, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + w, z = f.bottom - v - E, 12 > A) {
                                    var G = F * (1 - x) / 2,
                                        H = E * (1 - x) / 2;
                                    y -= G, z += H
                                }
                                p = q = -Math.abs(E - F) / 2;
                                break;
                            case 270:
                                if (r = -180, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - v - E, z = f.bottom - w - F, 12 > A) {
                                    var G = E * (1 - x) / 2,
                                        H = F * (1 - x) / 2;
                                    y += G, z += H
                                }
                                break;
                            case 0:
                                if (r = -270, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - w - F, z = f.top + v, 12 > A) {
                                    var G = F * (1 - x) / 2,
                                        H = E * (1 - x) / 2;
                                    y += G, z -= H
                                }
                                p = q = Math.abs(E - F) / 2
                        } else if (180 == l) switch (k) {
                                case 180:
                                    if (v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + v, z = f.top + w, 12 > A) {
                                        var G = E * (1 - x) / 2,
                                            H = F * (1 - x) / 2;
                                        y -= G, z -= H
                                    }
                                    break;
                                case 270:
                                    if (r = -90, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + w, z = f.bottom - v - E, 12 > A) {
                                        var G = F * (1 - x) / 2,
                                            H = E * (1 - x) / 2;
                                        y -= G, z += H
                                    }
                                    p = q = -Math.abs(E - F) / 2;
                                    break;
                                case 0:
                                    if (r = -180, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - v - E, z = f.bottom - w - F, 12 > A) {
                                        var G = E * (1 - x) / 2,
                                            H = F * (1 - x) / 2;
                                        y += G, z += H
                                    }
                                    break;
                                case 90:
                                    if (r = -270, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - w - F, z = f.top + v, 12 > A) {
                                        var G = F * (1 - x) / 2,
                                            H = E * (1 - x) / 2;
                                        y += G, z -= H
                                    }
                                    p = q = Math.abs(E - F) / 2
                            } else if (270 == l) switch (k) {
                                case 270:
                                    if (v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + v, z = f.top + w, 12 > A) {
                                        var G = E * (1 - x) / 2,
                                            H = F * (1 - x) / 2;
                                        y -= G, z -= H
                                    }
                                    break;
                                case 0:
                                    if (r = -90, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.left + w, z = f.bottom - v - E, 12 > A) {
                                        var G = F * (1 - x) / 2,
                                            H = E * (1 - x) / 2;
                                        y -= G, z += H
                                    }
                                    p = q = -Math.abs(E - F) / 2;
                                    break;
                                case 90:
                                    if (r = -180, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - v - E, z = f.bottom - w - F, 12 > A) {
                                        var G = E * (1 - x) / 2,
                                            H = F * (1 - x) / 2;
                                        y += G, z += H
                                    }
                                    break;
                                case 180:
                                    if (r = -270, v = WebPDF.Annot.stampInfoOffset.left * u, w = WebPDF.Annot.stampInfoOffset.top * u, y = f.right - w - F, z = f.top + v, 12 > A) {
                                        var G = F * (1 - x) / 2,
                                            H = E * (1 - x) / 2;
                                        y += G, z -= H
                                    }
                                    p = q = Math.abs(E - F) / 2
                            }
                            WebPDF.Common.addTranslateCss(t, r, p, q, null, null, x), t.css({
                            left: y + "px",
                            top: z + "px",
                            "font-size": A + "px"
                        })
                    }
                $("#" + h).css({
                    left: f.left,
                    top: f.top,
                    width: WebPDF.RectUtils.width(f),
                    height: WebPDF.RectUtils.height(f)
                });
                var I = b.getAnnotName(),
                    J = g.getStampBorderID(a, I),
                    K = $("#" + J).is(":visible");
                g.updateStampBorder(a, I, K)
            },
            onRotate: function(a, b) {
                if (a && b && b.getSubType() == this.getType()) {
                    var c = this.annotHandlerManager.getUIManager(),
                        d = b.getAnnotName(),
                        e = c.getStampBorderID(a, d);
                    $("#" + e).is(":visible") && c.updateStampBorder(a, d, !0)
                }
            }
        }, WebPDF.StampAnnotHandler
    }), define("core/Plugins/Annot/ImageAnnot/ImageAnnotHandler", ["core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        function d(a, b, c) {
            var d = b.annotJSONData.r = (parseInt(c) + 360) % 360,
                g = (90 * a.getPDFPage().getPageRotate() % 360 + 360) % 360,
                h = g - d,
                i = "#docViewer_ViewContainer_PageContainer_" + a.getPageIndex() + "_Annots_" + b.getAnnotName(),
                j = "#docViewer_ViewContainer_PageContainer_" + a.getPageIndex() + "_Image_Images_" + b.getAnnotName(),
                k = $(j),
                l = parseInt($(i).css("top")),
                m = parseInt($(i).css("left")),
                n = $(i).width(),
                o = $(i).height(),
                p = Math.abs(n * f(h) + o * e(h)),
                q = Math.abs(n * e(h) + o * f(h)),
                r = Math.sqrt(q * q + p * p) / 2,
                s = Math.atan2(o, n) / Math.PI * 180,
                t = h - s,
                u = r * e(t) - q / 2,
                v = -(r * f(t) + p / 2);
            k.css({
                transform: "rotate(" + h + "deg) translateX(" + u + "px) translateY(" + v + "px)",
                "transform-origin": "0 0",
                width: q + "px",
                height: p + "px",
                top: l + "px",
                left: m + "px"
            })
        }

        function e(a) {
            return g(a, Math.cos)
        }

        function f(a) {
            return g(a, Math.sin)
        }

        function g(a, b) {
            return Math.round(100 * b(a / 180 * Math.PI)) / 100
        }

        function h(a, b) {
            this.readerApp = a, this.annotHandlerManager = b;
            var c = ["#737FFB", "#FFFF01", "#CCFF66", "#01FFFF", "#99CCFF", "#CB98FE", "#FF9999", "#FF0000", "#C3C3C3", "#010101"],
                d = {
                    title: i18n.t("AnnotProperties.ImageTitle"),
                    colorArr: c
                };
            this.commentPropertyDlg = new CommentPropertyDlg(null, null, d), this.commentPropertyDlg.setAnnotHandler(this), this.annotUIManager = new WebPDF.Annot.AnnotUIManager(b, this.readerApp)
        }

        function i(a, b, c, d) {
            var e = b.getAnnotName(),
                f = this.annotUIManager.getAnnotDivID(a, e),
                g = $("#" + f);
            g.next().children("img").css("opacity", c / 100), d || (b.setOpacity(parseFloat(c) / 100), this.readerApp.setModified(a, a.getDocView(), !0))
        }

        function j(a, b, c, d) {
            var e = WebPDF.Common.getReaderApp();
            if (e.isEditable()) {
                var f = {
                    annot: b,
                    event: c,
                    multiSelect: d,
                    pageView: a
                };
                this.commentPropertyDlg.setOptions(f), this.commentPropertyDlg.show(c.pageX, c.pageY, f)
            }
        }

        function k() {
            return WebPDF.Annot.AnnotType.Image
        }

        function l(a, b) {
            var c = this.readerApp.getCurToolHandler();
            if (null != c) {
                var d = c.getName();
                if (d === WebPDF.Tools.TOOL_NAME_SELANNOT || d === WebPDF.Tools.TOOL_NAME_HAND || d === WebPDF.Tools.TOOL_NAME_IMAGE) return !0;
                if (void 0 != b && b && d === WebPDF.TOOL_NAME_SELECTTEXT) return !0
            }
            return !1
        }

        function m(a) {
            return !0
        }

        function n(a, b, c, e, f, g) {
            var h = b.getAnnotName(),
                i = this.annotHandlerManager.getUIManager(),
                j = i.getImageImageID(a, h),
                k = $("#" + j);
            if (k.css({
                    left: f + "px",
                    top: g + "px"
                }), b.isDynamic()) {
                var l = i.getImageDnamicID(a, h),
                    m = parseInt(k.css("height")),
                    n = parseInt(k.css("width")),
                    o = $("#" + l),
                    p = o.width(),
                    q = o.height();
                leftoffset = WebPDF.Annot.stampInfoOffset.left * n / b.getNaturalWidth(), topoffset = WebPDF.Annot.stampInfoOffset.top * m / b.getNaturalHeight();
                var r = m / b.getNaturalHeight(),
                    s = 0,
                    t = 0,
                    u = (a.getDocView().getRotate(), (90 * a.getPDFPage().getPageRotate() % 360 + 360) % 360),
                    v = (b.getRotate() % 360 + 360) % 360;
                if (0 == u) switch (v) {
                    case 0:
                        if (s = f + leftoffset, t = g + topoffset, 1 > r) {
                            var w = p * (1 - r) / 2,
                                x = q * (1 - r) / 2;
                            s -= w, t -= x
                        }
                        break;
                    case 90:
                        if (s = f + topoffset, t = g + n - leftoffset - p, 1 > r) {
                            var w = q * (1 - r) / 2,
                                x = p * (1 - r) / 2;
                            s -= w, t += x
                        }
                        break;
                    case 180:
                        if (s = f + n - leftoffset - p, t = g + m - topoffset - q, 1 > r) {
                            var w = p * (1 - r) / 2,
                                x = q * (1 - r) / 2;
                            s += w, t += x
                        }
                        break;
                    case 270:
                        if (s = f + m - topoffset - q, t = g + leftoffset, 1 > r) {
                            var w = q * (1 - r) / 2,
                                x = p * (1 - r) / 2;
                            s += w, t -= x
                        }
                } else if (90 == u) switch (v) {
                    case 0:
                        if (s = f + m - topoffset - q, t = g + leftoffset, 1 > r) {
                            var w = q * (1 - r) / 2,
                                x = p * (1 - r) / 2;
                            s += w, t -= x
                        }
                        break;
                    case 90:
                        if (s = f + leftoffset, t = g + topoffset, 1 > r) {
                            var w = p * (1 - r) / 2,
                                x = q * (1 - r) / 2;
                            s -= w, t -= x
                        }
                        break;
                    case 180:
                        if (s = f + topoffset, t = g + n - leftoffset - p, 1 > r) {
                            var w = q * (1 - r) / 2,
                                x = p * (1 - r) / 2;
                            s -= w, t += x
                        }
                        break;
                    case 270:
                        if (s = f + n - leftoffset - p, t = g + m - topoffset - q, 1 > r) {
                            var w = p * (1 - r) / 2,
                                x = q * (1 - r) / 2;
                            s += w, t += x
                        }
                } else if (180 == u) switch (v) {
                        case 0:
                            if (s = f + n - leftoffset - p, t = g + m - topoffset - q, 1 > r) {
                                var w = p * (1 - r) / 2,
                                    x = q * (1 - r) / 2;
                                s += w, t += x
                            }
                            break;
                        case 90:
                            if (s = f + m - topoffset - q, t = g + leftoffset, 1 > r) {
                                var w = q * (1 - r) / 2,
                                    x = p * (1 - r) / 2;
                                s += w, t -= x
                            }
                            break;
                        case 180:
                            if (s = f + leftoffset, t = g + topoffset, 1 > r) {
                                var w = p * (1 - r) / 2,
                                    x = q * (1 - r) / 2;
                                s -= w, t -= x
                            }
                            break;
                        case 270:
                            if (s = f + topoffset, t = g + n - leftoffset - p, 1 > r) {
                                var w = q * (1 - r) / 2,
                                    x = p * (1 - r) / 2;
                                s -= w, t += x
                            }
                    } else if (270 == u) switch (v) {
                        case 0:
                            if (s = f + topoffset, t = g + n - leftoffset - p, 1 > r) {
                                var w = q * (1 - r) / 2,
                                    x = p * (1 - r) / 2;
                                s -= w, t += x
                            }
                            break;
                        case 90:
                            if (s = f + n - leftoffset - p, t = g + m - topoffset - q, 1 > r) {
                                var w = p * (1 - r) / 2,
                                    x = q * (1 - r) / 2;
                                s += w, t += x
                            }
                            break;
                        case 180:
                            if (s = f + m - topoffset - q, t = g + leftoffset, 1 > r) {
                                var w = q * (1 - r) / 2,
                                    x = p * (1 - r) / 2;
                                s += w, t -= x
                            }
                            break;
                        case 270:
                            if (s = f + leftoffset, t = g + topoffset, 1 > r) {
                                var w = p * (1 - r) / 2,
                                    x = q * (1 - r) / 2;
                                s -= w, t -= x
                            }
                    }
                    o.css({
                    left: s + "px",
                    top: t + "px"
                })
            }
            var y = i.getImageDivID(a, h),
                z = $("#" + y);
            z.css({
                left: f + "px",
                top: g + "px"
            }), d(a, b, b.annotJSONData.r), i.updateImageBorder(a, h, !0)
        }

        function o(a, b, c) {
            this.onUpdatePosition(a, b)
        }

        function p(a, b) {
            if (b.isDynamic()) {
                var c = b.getAnnotName(),
                    d = this.annotHandlerManager.getUIManager(),
                    e = d.getImageDnamicID(a, c),
                    f = $("#" + e),
                    g = this.readerApp.getMainView().getDocView(),
                    h = g.getRotate(),
                    i = f.width(),
                    j = f.height(),
                    k = 0,
                    l = 0,
                    m = 0,
                    n = 0,
                    o = 0,
                    p = b.getRect(),
                    q = a.pdfRectToDevice(p, !0),
                    r = 12,
                    s = 0;
                switch (h) {
                    case 90:
                        if (m = -90, k = l = -Math.abs(i - j) / 2, n = f.css("left"), o = parseFloat(f.css("top")) - i + "px", r = 12 * WebPDF.RectUtils.height(q) / b.getNaturalWidth(), 12 > r) {
                            s = r / 12;
                            var t = j * (1 - s) / 2,
                                u = i * (1 - s) / 2;
                            n = parseFloat(n) - t + "px", o = parseFloat(o) + u + "px"
                        }
                        break;
                    case 180:
                        if (m = -180, n = parseFloat(f.css("left")) - i + "px", o = parseFloat(f.css("top")) - j + "px", r = 12 * WebPDF.RectUtils.width(q) / b.getNaturalWidth(), 12 > r) {
                            s = r / 12;
                            var t = i * (1 - s) / 2,
                                u = j * (1 - s) / 2;
                            n = parseFloat(n) + t + "px", o = parseFloat(o) + u + "px"
                        }
                        break;
                    case 270:
                        if (m = -270, k = l = Math.abs(i - j) / 2, n = parseFloat(f.css("left")) - j + "px", o = f.css("top"), r = 12 * WebPDF.RectUtils.height(q) / b.getNaturalWidth(), 12 > r) {
                            s = r / 12;
                            var t = j * (1 - s) / 2,
                                u = i * (1 - s) / 2;
                            n = parseFloat(n) + t + "px", o = parseFloat(o) - u + "px"
                        }
                        break;
                    case 0:
                        if (n = f.css("left"), o = f.css("top"), r = 12 * WebPDF.RectUtils.width(q) / b.getNaturalWidth(), 12 > r) {
                            s = r / 12;
                            var t = i * (1 - s) / 2,
                                u = j * (1 - s) / 2;
                            n = parseFloat(n) - t + "px", o = parseFloat(o) - u + "px"
                        }
                }
                WebPDF.Common.addTranslateCss(f, m, k, l, null, null, s), f.css({
                    left: n,
                    top: o
                })
            }
        }

        function q(a, b) {
            var c = b.getAnnotName(),
                d = this.annotHandlerManager.getUIManager(),
                e = d.getImageDivID(a, c);
            $("#" + e).remove();
            var f = d.getImageImageID(a, c);
            $("#" + f).parent().remove();
            var g = b.getPopup();
            if (null != g && null == b.getHeadAnnot()) {
                var h = d.getAnnotPopupDivID(a, c);
                $("#" + h).remove()
            }
        }

        function r(a, b, c, d) {}

        function s(a, b) {
            var c = b.getAnnotName(),
                d = this.annotHandlerManager.getUIManager(),
                e = d.getImageDivID(a, c),
                f = d.getImageImageID(a, c);
            if ($("#" + e).addClass("fwr-annot-selected"), $("#" + f).addClass("fwr-annot-image-selected"), b.isDynamic()) {
                var g = d.getImageDnamicID(a, c);
                $("#" + g).addClass("fwr-annot-image-selected")
            }
            return d.updateImageBorder(a, c, !0), !0
        }

        function t(a, b) {
            var c = b.getAnnotName(),
                d = this.annotHandlerManager.getUIManager(),
                e = d.getImageDivID(a, c),
                f = d.getImageImageID(a, c);
            if ($("#" + e).removeClass("fwr-annot-selected"), $("#" + f).removeClass("fwr-annot-image-selected"), b.isDynamic()) {
                var g = d.getImageDnamicID(a, c);
                $("#" + g).removeClass("fwr-annot-image-selected")
            }
            d.updateImageBorder(a, c, !1)
        }

        function u(a, b) {}

        function v(a, b, c) {
            return this.onSelected(a, b)
        }

        function w(a, b, c) {}

        function x(a, b, c) {}

        function y(a, b, c) {
            this.annotHandlerManager.getMarkupAnnotHandler().onMouseOver(a, b, c)
        }

        function z(a, b, c) {
            this.annotHandlerManager.getMarkupAnnotHandler().onMouseLeave(a, b, c)
        }

        function A(a, b, c) {
            var e = a.getPDFPage(),
                f = b.getRect(),
                g = a.pdfRectToDevice(f, !0),
                h = (a.getScale(), this.annotHandlerManager.getUIManager()),
                i = h.getImageDivID(a, b.getAnnotName()),
                j = h.getImageImageID(a, b.getAnnotName()),
                k = $("#" + j),
                l = a.getDocView().getRotate(),
                m = (b.getRotate() % 360 + 360) % 360,
                n = (90 * e.getPageRotate() % 360 + 360) % 360,
                o = WebPDF.RectUtils.width(g),
                p = WebPDF.RectUtils.height(g),
                q = 10;
            q >= o && (o = q);
            var r = 0,
                s = 0,
                t = -n - l - m;
            if (0 == n) switch (m) {
                case 90:
                    o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = (p - o) / 2;
                    break;
                case 180:
                    break;
                case 270:
                    o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = -(p - o) / 2;
                    break;
                case 0:
            } else if (90 == n) switch (m) {
                case 0:
                    o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = -(p - o) / 2;
                    break;
                case 180:
                    o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = (p - o) / 2;
                    break;
                case 270:
                    break;
                case 90:
            } else if (180 == n) switch (m) {
                    case 0:
                        break;
                    case 90:
                        o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = -(p - o) / 2;
                        break;
                    case 270:
                        o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = (p - o) / 2;
                        break;
                    case 180:
                } else if (270 == n) switch (m) {
                    case 0:
                        o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = (p - o) / 2;
                        break;
                    case 90:
                        break;
                    case 180:
                        o = WebPDF.RectUtils.height(g), p = WebPDF.RectUtils.width(g), r = s = -(p - o) / 2;
                        break;
                    case 270:
                }
                if (WebPDF.Common.addTranslateCss(k, t, r, s), k.css({
                        left: g.left,
                        top: g.top,
                        width: o,
                        height: p
                    }), b.isDynamic()) {
                    var u = h.getImageDnamicID(a, b.getAnnotName()),
                        v = $("#" + u),
                        w = (a.getScale(), p / b.getNaturalHeight()),
                        x = 0,
                        y = 0,
                        z = 0;
                    1 > w && (z = w);
                    var A = 0,
                        B = 0,
                        r = 0,
                        s = 0,
                        t = 0,
                        C = 12 * w,
                        D = b.getDynamicInfo(),
                        E = "annot_dynamic_temp";
                    tempDynamicHtml = "<p id='" + E + "' class ='fwr-image-info' style='display:none;position: absolute; left:" + A + "px;top:" + B + "px;font-size:" + C + "px; '>" + D + "</p>", $(document.body).append(tempDynamicHtml);
                    var F = $("#" + E);
                    WebPDF.Common.addTranslateCss(F, t, r, s, null, null, w);
                    var G = F.width(),
                        H = F.height();
                    if (F.remove(), x = WebPDF.Annot.stampInfoOffset.left * w, y = WebPDF.Annot.stampInfoOffset.top * w, 0 == n) switch (m) {
                        case 0:
                            if (A = g.left + x, B = g.top + y, 12 > C) {
                                var I = G * (1 - z) / 2,
                                    J = H * (1 - z) / 2;
                                A -= I, B -= J
                            }
                            break;
                        case 90:
                            if (t = -90, A = g.left + y, B = g.bottom - x - G, 12 > C) {
                                var I = H * (1 - z) / 2,
                                    J = G * (1 - z) / 2;
                                A -= I, B += J
                            }
                            r = s = -Math.abs(G - H) / 2;
                            break;
                        case 180:
                            if (t = -180, A = g.right - x - G, B = g.bottom - y - H, 12 > C) {
                                var I = G * (1 - z) / 2,
                                    J = H * (1 - z) / 2;
                                A += I, B += J
                            }
                            break;
                        case 270:
                            if (t = -270, A = g.right - y - H, B = g.top + x, 12 > C) {
                                var I = H * (1 - z) / 2,
                                    J = G * (1 - z) / 2;
                                A += I, B -= J
                            }
                            r = s = Math.abs(G - H) / 2
                    } else if (90 == n) switch (m) {
                        case 90:
                            if (A = g.left + x, B = g.top + y, 12 > C) {
                                var I = G * (1 - z) / 2,
                                    J = H * (1 - z) / 2;
                                A -= I, B -= J
                            }
                            break;
                        case 180:
                            if (t = -90, A = g.left + y, B = g.bottom - x - G, 12 > C) {
                                var I = H * (1 - z) / 2,
                                    J = G * (1 - z) / 2;
                                A -= I, B += J
                            }
                            r = s = -Math.abs(G - H) / 2;
                            break;
                        case 270:
                            if (t = -180, A = g.right - x - G, B = g.bottom - y - H, 12 > C) {
                                var I = G * (1 - z) / 2,
                                    J = H * (1 - z) / 2;
                                A += I, B += J
                            }
                            break;
                        case 0:
                            if (t = -270, A = g.right - y - H, B = g.top + x, 12 > C) {
                                var I = H * (1 - z) / 2,
                                    J = G * (1 - z) / 2;
                                A += I, B -= J
                            }
                            r = s = Math.abs(G - H) / 2
                    } else if (180 == n) switch (m) {
                            case 180:
                                if (A = g.left + x, B = g.top + y, 12 > C) {
                                    var I = G * (1 - z) / 2,
                                        J = H * (1 - z) / 2;
                                    A -= I, B -= J
                                }
                                break;
                            case 270:
                                if (t = -90, A = g.left + y, B = g.bottom - x - G, 12 > C) {
                                    var I = H * (1 - z) / 2,
                                        J = G * (1 - z) / 2;
                                    A -= I, B += J
                                }
                                r = s = -Math.abs(G - H) / 2;
                                break;
                            case 0:
                                if (t = -180, A = g.right - x - G, B = g.bottom - y - H, 12 > C) {
                                    var I = G * (1 - z) / 2,
                                        J = H * (1 - z) / 2;
                                    A += I, B += J
                                }
                                break;
                            case 90:
                                if (t = -270, A = g.right - y - H, B = g.top + x, 12 > C) {
                                    var I = H * (1 - z) / 2,
                                        J = G * (1 - z) / 2;
                                    A += I, B -= J
                                }
                                r = s = Math.abs(G - H) / 2
                        } else if (270 == n) switch (m) {
                            case 270:
                                if (A = g.left + x, B = g.top + y, 12 > C) {
                                    var I = G * (1 - z) / 2,
                                        J = H * (1 - z) / 2;
                                    A -= I, B -= J
                                }
                                break;
                            case 0:
                                if (t = -90, A = g.left + y, B = g.bottom - x - G, 12 > C) {
                                    var I = H * (1 - z) / 2,
                                        J = G * (1 - z) / 2;
                                    A -= I, B += J
                                }
                                r = s = -Math.abs(G - H) / 2;
                                break;
                            case 90:
                                if (t = -180, A = g.right - x - G, B = g.bottom - y - H, 12 > C) {
                                    var I = G * (1 - z) / 2,
                                        J = H * (1 - z) / 2;
                                    A += I, B += J
                                }
                                break;
                            case 180:
                                if (t = -270, A = g.right - y - H, B = g.top + x, 12 > C) {
                                    var I = H * (1 - z) / 2,
                                        J = G * (1 - z) / 2;
                                    A += I, B -= J
                                }
                                r = s = Math.abs(G - H) / 2
                        }
                        WebPDF.Common.addTranslateCss(v, t, r, s, null, null, z), v.css({
                        left: A + "px",
                        top: B + "px",
                        "font-size": C + "px"
                    })
                }
            $("#" + i).css({
                left: g.left,
                top: g.top,
                width: WebPDF.RectUtils.width(g),
                height: WebPDF.RectUtils.height(g)
            });
            var K = b.getAnnotName(),
                L = h.getImageBorderID(a, K),
                M = $("#" + L).is(":visible");
            h.updateImageBorder(a, K, M), d(a, b, b.annotJSONData.r)
        }

        function B(a, b) {
            if (a && b && b.getSubType() == this.getType()) {
                var c = this.annotHandlerManager.getUIManager(),
                    d = b.getAnnotName(),
                    e = c.getImageBorderID(a, d);
                $("#" + e).is(":visible") && c.updateImageBorder(a, d, !0)
            }
        }
        return a("core/Plugins/Annot/AnnotUIManager"), WebPDF.ImageAnnotHandler = h, $.extend(h.prototype, {
            getType: k,
            canAnswer: l,
            canMove: m,
            moveAnnot: n,
            changeRect: o,
            resetDynamicInfo: p,
            deleteAnnot: q,
            onDraw: r,
            onSelected: s,
            onDeSelected: t,
            onFocus: u,
            onLButtonDown: v,
            onLButtonUp: w,
            onLButtonDblClk: x,
            onMouseOver: y,
            onMouseLeave: z,
            onUpdatePosition: A,
            onRotate: B,
            setAnnotProperty: j,
            setRotation: d,
            setAnnotOpacity: i
        }), WebPDF.ImageAnnotHandler
    }), define("core/Plugins/Annot/Undo/AnnotUndo", [], function(a, b, c) {
        return WebPDF.Annot.UndoType = {
            ANNOT_CREATE: 0,
            ANNOT_DELETE: 1,
            ANNOT_MOVE: 2,
            ANNOT_PROPERTY: 3,
            ANNOT_REPLY: 4,
            ANNOT_CONTENT: 5
        }, WebPDF.Annot.PropertyType = {
            ANNOT_COLOR: 0,
            ANNOT_FILLCOLOER: 1,
            ANNOT_OPACITY: 2,
            ANNOT_FONTSIZE: 3,
            ANNOT_BORDERCOLOR: 4,
            ANNOT_BORDERWIDTH: 5,
            ANNOT_ROTATE: 6
        }, WebPDF.Annot.Undo = function(a, b, c) {
            this.type = b, this.pageIndex = a, this.annotDataList = c
        }, WebPDF.Annot.Undo
    }), define("core/Plugins/Annot/AnnotMousePtHandler", [], function(a, b, c) {
        var d = function(a) {
            this.baseAnnotPlugin = a, this.dirc = 0, this.isSelectedBorderClick = !1, this.isSelectedPoint = !1, this.selectedPageView = null, this.selectedAnnot = null
        };
        return d.prototype = {
            _getPageAndAnnot: function(a) {
                var b = null,
                    c = null;
                if ($(a).hasClass("fwr-annot")) {
                    var d = parseInt(a.getAttribute("page-index")),
                        e = a.getAttribute("annot-name"),
                        f = this.baseAnnotPlugin.getReaderApp().getMainView().getDocView();
                    c = f.getPageView(d);
                    var g = c.getPDFPage();
                    b = g.getAnnotByName(e)
                }
                return {
                    annot: b,
                    page: c
                }
            },
            isClickOnBorder: function(a) {
                return this.isSelectedBorderClick = !1, $(a).hasClass("fwr-annot-border") && (this.dirc = parseInt(a.getAttribute("dir")), this.isSelectedBorderClick = !0), this.isSelectedBorderClick
            },
            getType: function() {
                return "Annot Mouse Pt Handler"
            },
            onLButtonDown: function(a) {
                var b = this._getPageAndAnnot(a.target);
                return null === b.annot && this.isClickOnBorder(a.target) && (b = this._getPageAndAnnot(a.target.parentNode.parentNode), b.annot) ? (this.selectedAnnot = b.annot, this.selectedPageView = b.page, this.baseAnnotPlugin.onAnnotChangeRectClick(b.page, b.annot, a)) : ((b.annot && "FreeText" === b.annot.getSubType() || b.annot && "Polygon" === b.annot.getSubType() || b.annot && "PolyLine" === b.annot.getSubType()) && (this.selectedAnnot = b.annot, this.selectedPageView = b.page), this.baseAnnotPlugin.onAnnotLButtonDown(b.page, b.annot, a))
            },
            onLButtonUp: function(a) {
                var b = this._getPageAndAnnot(a.target);
                return this.isSelectedBorderClick && (this.baseAnnotPlugin.onAnnotChangeRectFinish(this.selectedPageView, this.selectedAnnot, a), this.isSelectedBorderClick = !1), this.baseAnnotPlugin.onAnnotLButtonUp(b.page, b.annot, a);
            },
            onLButtonDblClk: function(a) {
                var b = _readerApp.getCurToolHandler();
                if ($.isFunction(b.getIsOnDraw) && b.getIsOnDraw()) return !1;
                var c = this._getPageAndAnnot(a.target);
                return this.baseAnnotPlugin.onAnnotLButtonDblClk(c.page, c.annot, a)
            },
            onMouseMove: function(a) {
                var b = WebPDF.Tool.getReaderApp();
                if (!b.isAnnot()) return !1;
                var c = this._getPageAndAnnot(a.target);
                return this.isSelectedBorderClick && this.baseAnnotPlugin.onAnnotChangeRectMove(this.selectedPageView, this.selectedAnnot, a, this.dirc), this.baseAnnotPlugin.onAnnotMouseMove(c.page, c.annot, a)
            },
            onRButtonDown: function(a) {
                var b = this._getPageAndAnnot(a.target);
                return this.baseAnnotPlugin.onAnnotRButtonDown(b.page, b.annot, a)
            },
            onRButtonUp: function(a) {
                return !1
            },
            onRButtonDblClk: function(a) {
                return !1
            },
            onMouseWheel: function(a) {
                return !1
            },
            onMouseOver: function(a) {
                var b = this._getPageAndAnnot(a.target);
                return this.baseAnnotPlugin.onAnnotMouseOver(b.page, b.annot, a)
            },
            onMouseOut: function(a) {
                return this.onMouseLeave(a)
            },
            onMouseLeave: function(a) {
                var b = this._getPageAndAnnot(a.fromElement);
                return this.baseAnnotPlugin.onAnnotMouseLeave(b.page, b.annot, a)
            },
            onMouseEnter: function(a) {
                return this.onMouseOver(a)
            },
            onDoubleTap: function(a) {
                var b = this._getPageAndAnnot(a.target);
                return this.baseAnnotPlugin.onAnnotLButtonDblClk(b.page, b.annot, a)
            },
            onPinchIn: function(a) {
                return !1
            },
            onPinchOut: function(a) {
                return !1
            },
            onHold: function(a) {
                var b = this._getPageAndAnnot(a.target);
                return this.baseAnnotPlugin.onAnnotHold(b.page, b.annot, a)
            }
        }, WebPDF.Event.AnnotMousePtHandler = d, WebPDF.Event.AnnotMousePtHandler
    }), define("core/Plugins/Annot/AnnotSelectionTool", ["core/Plugins/TextSelection/PDFTextSelectTool", "core/Plugins/Text/PDFTextObject", "core/Common/Math/Point", "core/WebPDF", "core/Common/Math/Rect", "core/Plugins/Text/PDFTextPage", "core/Plugins/TextSelection/PDFTextPageSelect"], function(a, b, c) {
        WebPDF.Tools.TOOL_NAME_SELANNOT = "Annot Selection Tool";
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect;
        a("core/Plugins/TextSelection/PDFTextSelectTool");
        return WebPDF.Tools.AnnotSelectionToolHandler = function(a, b) {
            function c() {
                if (null == r) {
                    var a = h.getMainView().getDocView(),
                        b = a.getPageView(0),
                        c = $("#" + a.getDocViewContainerID()),
                        d = a.getDocViewContainerID() + "_annot_bound_select",
                        e = "<div class='fwr-annot-bound-selection fwr-hidden' id='" + d + "'></div>";
                    null != b && b.isContentCreated() ? $("#" + b.getPageViewContainerID()).parent().parent().append(e) : c.append(e), r = $("#" + d)
                }
                return r
            }

            function f() {
                var a = c(),
                    b = Math.abs(l.x - k.x),
                    d = Math.abs(l.y - k.y),
                    e = null,
                    f = null;
                l.x < k.x && l.y < k.y && (e = l.x, f = l.y), l.x > k.x && l.y < k.y && (e = k.x, f = l.y), l.x < k.x && l.y > k.y && (e = l.x, f = k.y), l.x >= k.x && l.y >= k.y && (e = k.x, f = k.y);
                var g = h.getMainView().getDocView(),
                    i = g.getDocViewClientRect();
                WebPDF.RectUtils.normalizeEx(i);
                var j = g.getScrollApi(),
                    m = 0,
                    n = 0;
                j && (m = j.getContentPositionX(), n = j.getContentPositionY());
                var p = o.getPageViewRect();
                WebPDF.RectUtils.normalizeEx(p), e < p.left && (b -= p.left - e, e = p.left), f < p.top && (d -= p.top - f, f = p.top);
                var q = e + b > p.right ? p.right : e + b,
                    r = f + d >= p.bottom ? p.bottom - 3 : f + d;
                b = q - e, d = r - f, a.css({
                    left: e - i.left + m,
                    top: f - i.top + n,
                    width: b,
                    height: d
                }), a.removeClass("fwr-hidden")
            }

            function g() {
                var a = c();
                a.addClass("fwr-hidden")
            }
            var h = a,
                i = b,
                j = new e(0, 0, 0, 0),
                k = new d(0, 0),
                l = new d(0, 0),
                m = new d(0, 0),
                n = new d(0, 0),
                o = null,
                p = null,
                q = this,
                r = null,
                s = !1;
            this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_SELANNOT
            }, this.onInit = function(a, b) {
                $.extend(i, {})
            }, this.onDestroy = function() {}, this.onActivate = function() {
                if (null != h.getMainView()) {
                    var a = h.getMainView().getDocView(),
                        b = $("#" + a.getDocViewContainerID());
                    b.css({
                        cursor: "auto"
                    })
                }
            }, this.onDeactivate = function() {
                i.clearSelection()
            }, this.isEnabled = function() {
                var a = h.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() !== WebPDF.PDFDocType.XFA ? !0 : !1
            }, this.isProcessing = function() {
                return s
            }, this.onLButtonDown = function(a) {
                var b = h.getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(c.get(0), a.target, !0)) return !1;
                var f = (h.getMainView().getDocView(), a.shiftKey),
                    g = a.ctrlKey;
                f || g || (b.clearAllSelection(), i.clearSelection());
                var l = null,
                    p = new d(0, 0);
                return l = WebPDF.TextSelection.PDFTextSelectTool.getPageViewInfoByMouseEvent(h, a, p, !0, !1), null == l ? !1 : p.x < 0 || p.x > l.getPageViewWidth() ? !1 : (WebPDF.Common.preventDefaults(a, !0), s = !0, o = l, m = n = p, k.x = a.pageX, k.y = a.pageY, j = new e(0, 0, 0, 0), !0)
            }, this.onLButtonUp = function(a) {
                if (s) {
                    l.x = a.pageX, l.y = a.pageY, g();
                    var b = null,
                        c = new d(0, 0);
                    b = WebPDF.TextSelection.PDFTextSelectTool.getPageViewInfoByMouseEvent(h, a, c, !0, !1), null == b && (b = o);
                    var f = -1;
                    if (f = b.getPageIndex(), n = 0 == c.x && 0 == c.y ? p : c, null == n) return !0;
                    f != o.getPageIndex() && (f < o.getPageIndex() ? n.y = 0 : n.y = o.getPageViewHeight());
                    var q = new d(0, 0),
                        r = new d(0, 0);
                    q = o.devicePtToPDF(m), r = o.devicePtToPDF(n), j = new e(q.x, q.y, r.x, r.y), WebPDF.RectUtils.normalize(j), i.selectAnnotsByRect(o, j)
                }
                return s = !1, WebPDF.RectUtils.empty(j), k.x = 0, k.y = 0, l.x = 0, l.y = 0, o = null, !0
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.clipSelectRect = function(a, b) {
                var c = a.getPageViewRect();
                b.left = b.left > c.left ? b.left : c.left, b.top = b.top > c.top ? b.top : c.top, b.right = b.right > c.right ? c.right : b.right, b.bottom = b.bottom > c.bottom ? c.bottom : b.bottom
            }, this.onMouseMove = function(a) {
                if (s) {
                    var b = null,
                        c = new d(0, 0);
                    b = WebPDF.TextSelection.PDFTextSelectTool.getPageViewInfoByMouseEvent(h, a, c, !0, !1), null != b && (o = b, p = c), WebPDF.Common.preventDefaults(a, !0), l.x = a.pageX, l.y = a.pageY, f()
                }
                return !0
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return q.onLButtonUp(a), !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Event.AnnotSelectionToolHandler
    }), define("core/Plugins/Annot/TextAnnotToolHandler", ["core/Plugins/Annot/AnnotFactory", "core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Plugins/Annot/PDFMarkup", "core/Common/Interface", "core/Plugins/Annot/CommentAnnot/CommentAnnot", "core/Plugins/Annot/PDFLink", "core/Plugins/Action/Action", "core/Plugins/Action/PDFDestination", "core/Plugins/Annot/PDFInk", "core/Plugins/Annot/PDFCallout", "core/Plugins/Annot/PDFTextBox", "core/Plugins/Annot/ImageAnnot/PDFImage", "core/Plugins/Signature/PDFSignature", "core/Plugins/InkSign/PDFInkSign", "core/Plugins/Annot/DrawingAnnot/PDFCircle", "core/Plugins/Annot/DrawingAnnot/PDFSquare", "core/Plugins/Annot/DrawingAnnot/PDFPolygon", "core/Plugins/Annot/DrawingAnnot/PDFLine", "core/Plugins/Annot/TextAnnotService", "core/Plugins/Annot/TextAnnotView", "core/Plugins/Annot/AnnotCommonView"], function(a, b, c) {
        return a("core/Plugins/Annot/AnnotFactory"), WebPDF.Tools.TOOL_NAME_TEXTANNOT = "TextAnnot Tool", WebPDF.Tools.TextAnnotToolHandler = function(b) {
            var c = null,
                d = !1,
                e = null,
                f = null,
                g = null;
            this.onInit = function(d) {
                c = d;
                a("core/Plugins/Annot/TextAnnotService");
                e = a("core/Plugins/Annot/TextAnnotView").createTextAnnotView(d, b.getAnnotHandlerMgr().getUIManager()), f = a("core/Plugins/Annot/TextAnnotService").createTextAnnotService(d, b), g = a("core/Plugins/Annot/AnnotCommonView").createAnnotCommonView(d)
            }, this.onDestroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_TEXTANNOT
            }, this.onActivate = function() {
                e.activate()
            }, this.onDeactivate = function() {
                e.deactivate()
            }, this.isEnabled = function() {
                var a = c.getPDFDoc();
                return a && a.getDocType() != WebPDF.PDFDocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return d
            }, this.onLButtonDown = function(a) {
                var b = null,
                    e = c.getMainView().getDocView(),
                    h = g.hasAnnotTag($(a.target));
                if (h) {
                    var i = g.getPageIndex(a.target),
                        j = g.getAnnotName(a.target);
                    b = e.getPageView(i);
                    var k = b.getPDFPage(),
                        l = k.getAnnotByName(j),
                        m = f.isTextAnnot(l);
                    if (0 == m) return !1
                }
                var n = $("#" + e.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(n.get(0), a.target, !0)) return !1;
                if (b = f.getPageViewByPos(a.pageX, a.pageY), b && b.isPageLoadLimit()) return !1;
                if (null != b) {
                    var o = b.getPageViewRect(),
                        l = f.addAnnot(b, a.pageX - o.left, a.pageY - o.bottom, a);
                    f.addAnnotRecord(b.getPageIndex(), l, "add")
                }
                return d = !0, !0
            }, this.onLButtonUp = function(a) {
                return d = !1, !0
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                return !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }, this.addAnnot = function(a, b, c) {
                return f.createAnnot(a, b, c)
            }
        }, WebPDF.Event.TextAnnotToolHandler
    }), define("core/Plugins/Annot/AnnotFactory", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Plugins/Annot/PDFMarkup", "core/Common/Interface", "core/Plugins/Annot/CommentAnnot/CommentAnnot", "core/Plugins/Annot/PDFLink", "core/Plugins/Action/Action", "core/Plugins/Action/PDFDestination", "core/Plugins/Annot/PDFInk", "core/Plugins/Annot/PDFCallout", "core/Plugins/Annot/PDFTextBox", "core/Plugins/Annot/ImageAnnot/PDFImage", "core/Plugins/Signature/PDFSignature", "core/Plugins/InkSign/PDFInkSign", "core/Plugins/Annot/DrawingAnnot/PDFCircle", "core/Plugins/Annot/DrawingAnnot/PDFSquare", "core/Plugins/Annot/DrawingAnnot/PDFPolygon", "core/Plugins/Annot/DrawingAnnot/PDFLine"], function(a, b, c) {
        a("core/Plugins/Annot/PDFAnnot"), a("core/Plugins/Annot/PDFMarkup"), a("core/Plugins/Annot/CommentAnnot/CommentAnnot"), a("core/Plugins/Annot/PDFLink"), a("core/Plugins/Annot/PDFInk"), a("core/Plugins/Annot/PDFCallout"), a("core/Plugins/Annot/PDFTextBox"), a("core/Plugins/Annot/ImageAnnot/PDFImage"), a("core/Plugins/Signature/PDFSignature"), a("core/Plugins/InkSign/PDFInkSign"), a("core/Plugins/Annot/DrawingAnnot/PDFCircle"), a("core/Plugins/Annot/DrawingAnnot/PDFSquare"), a("core/Plugins/Annot/DrawingAnnot/PDFPolygon"), a("core/Plugins/Annot/DrawingAnnot/PDFLine");
        var d = WebPDF.Annot.PDFLink,
            e = WebPDF.Annot.PDFTextBox,
            f = WebPDF.Annot.PDFMarkup,
            g = WebPDF.Annot.PDFTypewriter,
            h = WebPDF.Annot.PDFCallout,
            i = WebPDF.Annot.AnnotDataJSONFormat,
            j = WebPDF.Signature.PDFSignature;
        WebPDF.InkSign.PDFInkSign;
        return WebPDF.Annot.AnnotFactory = function() {
            var a = {
                createAnnot: function(a, b, c) {
                    try {
                        var k = null;
                        switch (a[i.type]) {
                            case "Link":
                                k = new d(a, b);
                                break;
                            case "Typewriter":
                                k = new g(a, b);
                                break;
                            case "Callout":
                                k = new h(a, b);
                                break;
                            case "Textbox":
                            case "TextBox":
                                k = new e(a, b);
                                break;
                            case "Markup":
                                switch (a[WebPDF.Annot.AnnotDataJSONFormat.subType]) {
                                    case "Ink":
                                        k = new WebPDF.Annot.PDFInk(a, b);
                                        break;
                                    case "Screen":
                                        k = new WebPDF.Annot.PDFImage(a, b);
                                        break;
                                    case "Stamp":
                                        k = new WebPDF.Annot.PDFStamp(a, b);
                                        break;
                                    case WebPDF.Annot.AnnotType.Circle:
                                        k = new WebPDF.Annot.PDFCircle(a, b);
                                        break;
                                    case WebPDF.Annot.AnnotType.PolyLine:
                                    case WebPDF.Annot.AnnotType.Polygon:
                                        "Cloud" == a[WebPDF.Annot.AnnotDataJSONFormat.subject] && (a[WebPDF.Annot.AnnotDataJSONFormat.it] = "PolygonCloud"), k = new WebPDF.Annot.PDFPolygon(a, b);
                                        break;
                                    case WebPDF.Annot.AnnotType.Square:
                                        k = new WebPDF.Annot.PDFSquare(a, b);
                                        break;
                                    case WebPDF.Annot.AnnotType.Line:
                                        k = new WebPDF.Annot.PDFLine(a, b);
                                        break;
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET:
                                    case WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE:
                                        k = new WebPDF.Annot.CommentAnnot(a, b);
                                        break;
                                    default:
                                        k = new f(a, b)
                                }
                                var l = a[i.group];
                                if (l)
                                    for (var m = 0; m < l.length; m++) {
                                        l[m].irt = a.n;
                                        var n = this.createAnnot(l[m], b, c);
                                        null !== n && (n.setHeadAnnot(k), k.addAnnotToGroup(n))
                                    }
                                break;
                            default:
                                if (a[i.subType] == WebPDF.Annot.AnnotType.Widget && ("Sig" == a[i.ft] || "Straddle" == a[i.subty])) {
                                    var o = new j(a, "signature");
                                    return o
                                }
                                if ("Straddle" == a[i.subType]) {
                                    var o = new j(a, "signature");
                                    if (null === a[WebPDF.Signature.SignatureJSONFormat.n]) {
                                        var p = WebPDF.Common.generateUUID();
                                        o.setSigName(p)
                                    }
                                    return o
                                }
                        }
                        if ("false" === a[i.pdf] && (c = !1), null == k) return null;
                        if (null != c && k.setSourceAnnot(c), null == k.getAnnotName() || k.getAnnotName().length <= 0) {
                            var q = WebPDF.Common.generateUUID();
                            k.setAnnotName(q)
                        }
                        return k
                    } catch (r) {
                        console.error(r)
                    }
                }
            };
            return a
        }(), WebPDF.Annot.AnnotFactory
    }), define("core/Plugins/Annot/PDFMarkup", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = a("core/Plugins/Annot/PDFAnnot");
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b), $.extend(this, {
                    getOpenState: function() {
                        return this.annotJSONData[f.openState]
                    },
                    setOpenState: function(a) {
                        this.annotJSONData[f.openState] = a
                    }
                })
            };
        e.extend(g, d), WebPDF.Annot.PDFPopup = g;
        var h = function(a) {
            this.annotStateJSONData = a
        };
        h.prototype = {
            getState: function() {
                return this.annotStateJSONData[f.state]
            },
            getStateMode: function() {
                return this.annotStateJSONData[f.stateModel]
            }
        }, WebPDF.Annot.PDFAnnotState = h;
        var i = function(a, b) {
            i.superclass.constructor.call(this, a, b), this.popup = null, this.replyChain = null, this.stateList = null, this.groupAnnots = {}, this.headAnnot = null, this.replyChainAnnotMap = {}, $.extend(this, {
                getOpacity: function() {
                    return this.annotJSONData[f.opacity]
                },
                getSubject: function() {
                    return "undefined" == typeof this.annotJSONData[f.subject] ? "" : this.annotJSONData[f.subject]
                },
                getTitle: function() {
                    return this.annotJSONData[f.title]
                },
                setTitle: function(a) {
                    this.annotJSONData[f.title] = a
                },
                setSubject: function(a) {
                    this.annotJSONData[f.subject] = a
                },
                getPopup: function() {
                    if (null == this.popup) {
                        if (null == this.annotJSONData[f.popup]) return null;
                        this.popup = new g(this.annotJSONData[f.popup], this.pageIndex)
                    }
                    return this.popup
                },
                setPopupData: function(a) {
                    this.annotJSONData[f.popup] = a
                },
                getTextAnnotName: function() {
                    return this.annotJSONData[f.textAnnotName]
                },
                _initReplyChain: function() {
                    if (null == this.replyChain) {
                        if (this.replyChain = [], null == this.annotJSONData[f.replyChain]) return;
                        for (var a = this.annotJSONData[f.replyChain].length, b = 0, c = 0; a > c; c++)
                            if (!("del" in this.annotJSONData[f.replyChain][c] && 1 == this.annotJSONData[f.replyChain][c].del)) {
                                var d = new i(this.annotJSONData[f.replyChain][c]);
                                if (d.isReply = !0, d.isParentReply = this.isReply, d.parentName = this.getAnnotName(), d.annotJSONData.pdf === !1 && d.setSourceAnnot(!1), !d.getAnnotName()) {
                                    var e = WebPDF.Common.createUniqueId();
                                    d.setAnnotName(e)
                                }
                                this.replyChain[b++] = d, this.replyChainAnnotMap[d.getAnnotName()] = d, this.replyChain[b - 1]._initReplyChain()
                            }
                    }
                },
                getReplyAnnotByName: function(a) {
                    var b = this.replyChainAnnotMap[a];
                    if (b) return b;
                    for (var c in this.replyChainAnnotMap)
                        if (b = this.replyChainAnnotMap[c].getReplyAnnotByName(a)) return b;
                    return b
                },
                delReplyAnnotByName: function(a) {
                    var b = this.replyChainAnnotMap[a];
                    if (b) {
                        delete this.replyChainAnnotMap[a];
                        for (var c in this.annotJSONData.rpy)
                            if (this.annotJSONData.rpy[c].n === a) {
                                this.annotJSONData.rpy.splice(c, 1), this.replyChain.splice(c, 1);
                                break
                            }
                    } else
                        for (var c in this.replyChainAnnotMap) this.replyChainAnnotMap[c].delReplyAnnotByName(a)
                },
                addReplyAnnot: function() {
                    var a = new Date,
                        b = a.valueOf(),
                        c = Math.floor(b / 1e3).toString(),
                        d = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                        e = d + " to " + this.getTitle(),
                        g = {
                            c: "",
                            cd: c,
                            cl: "#5555aa",
                            f: 4,
                            md: c,
                            subj: e,
                            subty: "Text",
                            tit: d,
                            pdf: !1,
                            del: 0
                        };
                    f.replyChain in this.annotJSONData || (this.annotJSONData[f.replyChain] = []);
                    var h = this.annotJSONData[f.replyChain].length,
                        j = new i(g),
                        k = WebPDF.Common.createUniqueId();
                    return j.setAnnotName(k), j.setSourceAnnot(!1), j.isReply = !0, j.isParentReply = this.isReply, j.parentName = this.getAnnotName(), this.replyChain[h] = j, this.replyChainAnnotMap[k] = j, this.annotJSONData[f.replyChain].push(g), j
                },
                addReplyAnnotByJson: function(a, b) {
                    f.replyChain in this.annotJSONData || (this.annotJSONData[f.replyChain] = []);
                    var c = this.annotJSONData[f.replyChain].length,
                        d = new i(a, b);
                    return d.setSourceAnnot(!1), d.isReply = !0, d.isParentReply = this.isReply, d.parentName = this.getAnnotName(), this.replyChain[c] = d, this.replyChainAnnotMap[a[f.name]] = d, this.annotJSONData[f.replyChain].push(a), d
                },
                getReplyChain: function() {
                    return this._initReplyChain(), this.replyChain
                },
                _initStateList: function() {
                    if (null == this.stateList) {
                        if (this.stateList = [], null == this.annotJSONData[f.stateList]) return;
                        for (var a = this.annotJSONData[f.stateList].length, b = 0; a > b; b++) this.stateList[b] = new h(this.annotJSONData[f.stateList][b])
                    }
                },
                getStateList: function() {
                    return this._initStateList(), this.stateList
                },
                getGroupAnnotMap: function() {
                    return this.groupAnnots
                },
                addAnnotToGroup: function(a) {
                    return null == a ? !1 : (this.groupAnnots[a.getAnnotName()] = a, !0)
                },
                getHeadAnnot: function() {
                    return this.headAnnot
                },
                setHeadAnnot: function(a) {
                    this.headAnnot = a
                },
                getHeadAncestorAnnot: function() {
                    for (var a = this.headAnnot; a;) {
                        if (a.getType() !== WebPDF.Annot.AnnotType.MarkUp) return a;
                        if (!a.getHeadAnnot()) return a;
                        a = a.getHeadAnnot()
                    }
                    return a
                },
                getIntent: function() {
                    return this.annotJSONData[f.it]
                },
                getFillColor: function() {
                    return this.annotJSONData[f.fillColor]
                },
                getColorWithOpacity: function() {
                    var a = this.getColor(),
                        b = this.getOpacity();
                    return WebPDF.Common.hexColor2Rgba(a, b)
                }
            })
        };
        return i.prototype.exportPropertyToXFDF = function(a, b) {
            function c(a, b, c, d) {
                var e = a.createElement(b.getSubType().toLowerCase()),
                    f = a.getElementsByTagName("annots");
                f.length <= 0 || (f[0].appendChild(e), e.setAttribute("page", c), b.exportPropertyToXFDF(a, e), e.setAttribute("inreplyto", d), e.setAttribute("replyType", "reply"))
            }
            i.superclass.exportPropertyToXFDF.apply(this, arguments);
            var d = this.getCreationDate();
            d && (d = WebPDF.Common.timestampToPDFTimeString(d), b.setAttribute("creationdate", d));
            var e = this.getOpacity();
            e && b.setAttribute("opacity", e);
            var f = this.getSubject();
            f && b.setAttribute("subject", f);
            var g = this.getIntent();
            if (g && b.setAttribute("intent", g), this.getRdRect) {
                var h = this.getRdRect();
                if (h) {
                    var j = String.Format("{0},{1},{2},{3}", h[0], h[1], h[2], h[3]);
                    b.setAttribute("fringe", j)
                }
            }
            if (this.getRT && this.getRT()) {
                var k = this.getRT();
                b.setAttribute("replyType", k.toLowerCase())
            }
            if (this.getInreplyto && this.getInreplyto()) {
                var l = this.getInreplyto();
                b.setAttribute("inreplyto", l)
            }
            var m = this.getPopup();
            if (m) {
                var n = a.createElement("popup");
                m.exportPropertyToXFDF(a, n);
                var o = m.getOpenState();
                n.setAttribute("open", o ? "yes" : "no"), b.appendChild(n)
            }
            for (var p = parseInt(b.getAttribute("page")), q = 0; q < this.getReplyChain().length; q++) {
                var r = this.getReplyChain()[q];
                r && c(a, r, p, this.getAnnotName())
            }
        }, e.extend(i, d), WebPDF.Annot.PDFMarkup = i, WebPDF.Annot.PDFMarkup
    }), define("core/Plugins/Annot/CommentAnnot/CommentAnnot", ["core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Interface"], function(a, b, c) {
        WebPDF.Annot = a("core/Plugins/Annot/Annot"), WebPDF.Annot.CommentAnnotType = {
            COMMENTTYPE_UNDERLINE: "Underline",
            COMMENTTYPE_HIGHLIGHT: "Highlight",
            COMMENTTYPE_SQUIGGLY: "Squiggly",
            COMMENTTYPE_STRIKEOUT: "StrikeOut",
            COMMENTTYPE_CARET: "Caret",
            COMMENTTYPE_REPLACE: "Replace",
            COMMENTTYPE_HIGHLIGHT_AREA: "AreaHighlight"
        };
        var d = WebPDF.Annot.PDFMarkup;
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b)
            };
        return g.prototype = {
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getQuadPoints();
                if (c) {
                    for (var d = "", e = 0; e < c.length; e++) {
                        var f = String.Format("{0},", c[e]);
                        d += f
                    }
                    d = d.substr(0, d.length - 1), b.setAttribute("coords", d)
                }
            },
            getIT: function() {
                var a = this.annotJSONData[f.it];
                return a || (a = ""), a
            },
            setIT: function(a) {
                this.annotJSONData[f.it] = a
            },
            getRdRect: function() {
                return this.annotJSONData[f.rectDiffer]
            },
            setRdRect: function(a) {
                this.annotJSONData[f.rd] = a
            },
            getRT: function() {
                return this.annotJSONData[f.replyType]
            },
            setRT: function(a) {
                this.annotJSONData[f.replyType] = a
            },
            getInreplyto: function() {
                return this.annotJSONData[f.inreplyto]
            },
            setInreplyto: function(a) {
                this.annotJSONData[f.inreplyto] = a
            },
            setGrp: function(a) {
                this.annotJSONData[f.grp] = a
            },
            getGrp: function() {
                return this.annotJSONData[f.grp] instanceof Object && (this.annotJSONData[f.grp] = this.annotJSONData[f.grp][0].n), this.annotJSONData[f.grp]
            }
        }, e.extend(g, d), WebPDF.Annot.CommentAnnot = g, WebPDF.Annot.CommentAnnot
    }), define("core/Plugins/Annot/PDFLink", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface", "core/Plugins/Action/Action", "core/Plugins/Action/PDFDestination"], function(a, b, c) {
        var d = a("core/Plugins/Annot/PDFAnnot");
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = a("core/Plugins/Action/Action"),
            g = WebPDF.Annot.AnnotDataJSONFormat,
            h = function(a, b) {
                h.superclass.constructor.call(this, a, b), this.pdfDestination = null, this.pdfAction = null, $.extend(this, {
                    getPDFDestination: function() {
                        return null == this.pdfDestination && (this.pdfDestination = new WebPDF.Annot.PDFDestination(this.annotJSONData[g.destinationInfo])), this.pdfDestination
                    },
                    getAction: function() {
                        return null == this.annotJSONData[g.action] ? null : (null == this.pdfAction && (this.pdfAction = new f(this.annotJSONData[g.action])), this.pdfAction)
                    },
                    getSubType: function() {
                        return WebPDF.Annot.AnnotType.Link
                    }
                })
            };
        return e.extend(h, d), WebPDF.Annot.PDFLink = h, WebPDF.Annot.PDFLink
    }), define("core/Plugins/Action/Action", ["core/Plugins/Action/PDFDestination", "core/WebPDF"], function(a, b, c) {
        var d = a("core/Plugins/Action/PDFDestination");
        WebPDF.PDFActionType = {
            Unsupported: 0,
            GoToE: 1,
            GoTo: 2,
            Hide: 3,
            ImportData: 4,
            JavaScript: 5,
            Launch: 6,
            Named: 7,
            GoToR: 8,
            Rendition: 9,
            ResetForm: 10,
            SubmitForm: 11,
            URI: 12
        };
        var e = function(a) {
            this.AnnotActionJSONFormat = {
                actionType: "ty",
                destination: "ds",
                URI: "uri"
            }, this.actionJSONData = a, this.pdfDestination = null
        };
        return e.prototype = {
            getActionType: function() {
                return this.actionJSONData[this.AnnotActionJSONFormat.actionType]
            },
            getPDFDestination: function() {
                if (null == this.pdfDestination) {
                    var a = this.actionJSONData[this.AnnotActionJSONFormat.destination];
                    if (null == a || "undefined" == a) return null;
                    this.pdfDestination = new d(a)
                }
                return this.pdfDestination
            },
            getURI: function() {
                return this.actionJSONData[this.AnnotActionJSONFormat.URI]
            }
        }, WebPDF.Action = e, WebPDF.Action
    }), define("core/Plugins/Annot/PDFInk", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = (a("core/Plugins/Annot/PDFAnnot"), WebPDF.Annot.PDFMarkup);
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b), this.inkList = null, $.extend(this, {
                    _initInkList: function(a, b, c) {
                        if (c || null == this.inkList) {
                            if (null == this.annotJSONData[f.inkList]) return;
                            var d = null;
                            c && null != this.inkList && (d = this.inkList), this.inkList = [];
                            var e, g = 0;
                            if (null != d ? (g = d.length, e = this.annotJSONData[f.inkList]) : g = this.annotJSONData[f.inkList].length, c && g > 0)
                                for (var h = 0; g > h; h++) {
                                    for (var i = d[h], j = [], k = i.length, l = 0; k > l; l++) {
                                        var m = i[l];
                                        m.x += a, m.y -= b, j.push(m)
                                    }
                                    for (var n = 0; 2 * k > n; n += 2) e[h][n] = j[n / 2].x, e[h][n + 1] = j[n / 2].y;
                                    this.inkList.push(j)
                                } else
                                    for (var h = 0; g > h; h++) {
                                        for (var o = this.annotJSONData[f.inkList][h], p = o.length, j = [], l = 0; p > l; l += 2) j.push(new WebPDF.PDFPoint(o[l], o[l + 1]));
                                        this.inkList.push(j)
                                    }
                        }
                    },
                    setInkList: function(a) {
                        this.inkList = a, this._initInkList(0, 0, !0)
                    },
                    offsetInkList: function(a, b) {
                        this._initInkList(a, b, !0)
                    },
                    getInkBorderWidth: function() {
                        return this.annotJSONData[f.inkBorderWidth]
                    },
                    setInkBorderWidth: function(a) {
                        this.annotJSONData[f.inkBorderWidth] = a
                    },
                    getInkColor: function() {
                        return this.annotJSONData[f.inkColor]
                    },
                    setInkColor: function(a) {
                        this.annotJSONData[f.inkColor] = a, this.annotJSONData[f.color] = a
                    },
                    getInkList: function() {
                        return this._initInkList(), this.inkList
                    }
                })
            };
        return g.prototype = {
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getBorderStyle();
                c && this.setBorderStyleToNode(b, c);
                var d = this.getInkBorderWidth();
                d && b.setAttribute("width", d.toString());
                var e = this.getInkList();
                if (e) {
                    for (var f = a.createElement("inklist"), h = 0; h < e.length; h++) {
                        for (var i = "", j = a.createElement("gesture"), k = e[h], l = 0; l < k.length; l++) {
                            var m = WebPDF.Tool.getReaderApp().getPDFDoc().getPage(this.pageIndex).transformPointToPDF(k[l].x, k[l].y),
                                n = String.Format("{0},{1};", m.x, m.y);
                            i += n
                        }
                        i = i.substr(0, i.length - 1);
                        var o = a.createTextNode(i);
                        j.appendChild(o), f.appendChild(j)
                    }
                    b.appendChild(f)
                }
                var p = this.getDashArray();
                if (p)
                    for (var h = 0; h < p.length; h++) String.Format("{0},{1}", p[h].length, p[h].nCap)
            }
        }, e.extend(g, d), WebPDF.Annot.PDFInk = g, WebPDF.Annot.PDFInk
    }), define("core/Plugins/Annot/PDFCallout", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = a("core/Plugins/Annot/PDFAnnot");
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b), $.extend(this, {
                    getIT: function() {
                        var a = this.annotJSONData[f.it];
                        return (null == a || "" == a) && (a = WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT), a
                    },
                    getFontName: function() {
                        var a = this.annotJSONData[f.fontName];
                        return (null == a || "" == a) && (a = "Helvetica"), a
                    },
                    getLineHeight: function() {
                        return this.annotJSONData[f.lineHeight]
                    },
                    setLineHeight: function(a) {
                        this.annotJSONData[f.lineHeight] = a
                    },
                    getFontHeight: function() {
                        return this.annotJSONData[f.fontHeight]
                    },
                    getFontSize: function() {
                        return this.annotJSONData[f.fontSize]
                    },
                    getFontColor: function() {
                        return this.annotJSONData[f.fontColor]
                    },
                    setFontColor: function(a) {
                        this.annotJSONData[f.fontColor] = a
                    },
                    setFillColor: function(a) {
                        this.annotJSONData[f.fillColor] = a
                    },
                    getOpacity: function() {
                        return this.annotJSONData[f.opacity]
                    },
                    getTextAlign: function() {
                        return this.annotJSONData[f.textAlign]
                    },
                    setFreeCoordinatesLine: function(a) {
                        this.annotJSONData[f.freeCoordinatesLine] = a
                    },
                    getFreeCoordinatesLine: function() {
                        return this.annotJSONData[f.freeCoordinatesLine]
                    },
                    getLineStyle: function() {
                        return this.annotJSONData[f.lineStyle]
                    },
                    setLineStyle: function(a) {
                        this.annotJSONData[f.lineStyle] = a
                    }
                })
            };
        return g.prototype = {
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getQuadPoints();
                if (c) {
                    for (var d = "", e = 0; e < c.length; e++) {
                        var h = String.Format("{0},", c[e]);
                        d += h
                    }
                    d = d.substr(0, d.length - 1), b.setAttribute("coords", d)
                }
                var i = this.getBorderWidth();
                i && b.setAttribute("width", i.toString());
                var j = this.getFillColor();
                j && b.setAttribute("color", j.toString()), b.setAttribute("head", "OpenArrow");
                var k = this.getDashArray();
                if (k)
                    for (var e = 0; e < k.length; e++);
                var l = this.getBorderStyle();
                l && this.setBorderStyleToNode(b, l);
                var m = this.getRotate();
                b.setAttribute("rotation", m.toString());
                var n = this.getTextAlign(),
                    o = "";
                o = 0 === n ? "left" : 1 === n ? "center" : "right", b.setAttribute("justification", o);
                var p = this.getFreeCoordinatesLine();
                if (p) {
                    for (var q = "", e = 0; e < p.length; e += 2) {
                        var r = WebPDF.Tool.getReaderApp().getPDFDoc().getPage(this.pageIndex).transformPointToPDF(p[e], p[e + 1]);
                        q += String.Format("{0},{1},", r.x, r.y)
                    }
                    q && (q = q.substr(0, q.length - 1), b.setAttribute("callout", q))
                }
                var s = this.getIT();
                s && b.setAttribute("intent", s);
                var t = this.getRectDiffer();
                if (t) {
                    var u = String.Format("{0},{1},{2},{3}", t.left, t.bottom, t.right, t.top);
                    b.setAttribute("fringe", u)
                }
                var v = a.createElement("contents-richtext");
                b.appendChild(v);
                var w = a.createElement("body");
                v.appendChild(w), w.setAttribute("xmlns", "http://www.w3.org/1999/xhtml"), w.setAttribute("xmlns:xfa", "http://www.xfa.org/schema/xfa-data/1.0/"), w.setAttribute("xfa:APIVersion", "Acroform:2.7.0.0"), w.setAttribute("xfa:spec", "2.1");
                var x = a.createElement("p");
                w.appendChild(x), x.setAttribute("dir", "ltr");
                var y = a.createElement("span");
                x.appendChild(y);
                var z = String.Format("font-size:{0}pt;font-style:normal;font-weight:normal", this.getFontSize());
                z += ";color:" + this.getFontColor(), z += ";font-family:" + this.getFontName(), y.setAttribute("style", z);
                var A = a.createTextNode(this.getContents());
                y.appendChild(A);
                var B = this.annotJSONData[f.defaultAp];
                if (!B) {
                    var C, D, E, F = this.getColor(),
                        G = F.length;
                    7 === G ? (C = parseInt(F.slice(1, 3), 16), D = parseInt(F.slice(3, 5), 16), E = parseInt(F.slice(5), 16)) : 4 === G && (C = parseInt(F.charAt(1) + F.charAt(1), 16), D = parseInt(F.charAt(2) + F.charAt(2), 16), E = parseInt(F.charAt(3) + F.charAt(3), 16)), B = C / 256 + " " + D / 256 + " " + E / 256 + " rg"
                }
                var H = a.createTextNode(B),
                    I = a.createElement("defaultappearance");
                I.appendChild(H), b.appendChild(I)
            }
        }, e.extend(g, d), WebPDF.Annot.PDFCallout = g, WebPDF.Annot.PDFCallout
    }), define("core/Plugins/Annot/PDFTextBox", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = a("core/Plugins/Annot/PDFAnnot");
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b), $.extend(this, {
                    getIT: function() {
                        var a = this.annotJSONData[f.it];
                        return (null == a || "" == a) && (a = WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TEXTBOX), a
                    },
                    getFontName: function() {
                        var a = this.annotJSONData[f.fontName];
                        return (null == a || "" == a) && (a = "Helvetica"), a
                    },
                    getLineHeight: function() {
                        return this.annotJSONData[f.lineHeight]
                    },
                    setLineHeight: function(a) {
                        this.annotJSONData[f.lineHeight] = a
                    },
                    getFontHeight: function() {
                        return this.annotJSONData[f.fontHeight]
                    },
                    setFontHeight: function(a) {
                        this.annotJSONData[f.fontHeight] = a
                    },
                    getFontSize: function() {
                        return this.annotJSONData[f.fontSize]
                    },
                    setFontSize: function(a) {
                        this.annotJSONData[f.fontSize] = a
                    },
                    getFontColor: function() {
                        return this.annotJSONData[f.fontColor]
                    },
                    setFontColor: function(a) {
                        this.annotJSONData[f.fontColor] = a
                    },
                    setFillColor: function(a) {
                        this.annotJSONData[f.fillColor] = a
                    },
                    getOpacity: function() {
                        return this.annotJSONData[f.opacity]
                    },
                    getTextAlign: function() {
                        return this.annotJSONData[f.textAlign]
                    },
                    getDA: function() {
                        return this.annotJSONData[f.defaultAp]
                    }
                })
            };
        return g.prototype = {
            canComment: function() {
                return !0
            },
            canExportToFDFOrXFDF: function() {
                return !0
            },
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getQuadPoints();
                if (c) {
                    for (var d = "", e = 0; e < c.length; e++) {
                        var h = String.Format("{0},", c[e]);
                        d += h
                    }
                    d = d.substr(0, d.length - 1), b.setAttribute("coords", d)
                }
                var i = this.getBorderWidth();
                i && b.setAttribute("width", i.toString());
                var j = this.getFillColor();
                j && b.setAttribute("color", j.toString());
                var k = this.getOpacity();
                k && b.setAttribute("opacity", k.toString());
                var l = this.getDashArray();
                if (l)
                    for (var e = 0; e < l.length; e++) String.Format("{0},{1}", l[e].length, l[e].nCap);
                var m = this.getBorderStyle();
                m && this.setBorderStyleToNode(b, m);
                var n = this.getRotate();
                b.setAttribute("rotation", n.toString());
                var o = this.getTextAlign(),
                    p = "";
                p = 0 === o ? "left" : 1 === o ? "center" : "right", b.setAttribute("justification", p);
                var q = this.getIT();
                q && b.setAttribute("intent", q);
                var r = a.createElement("contents-richtext");
                b.appendChild(r);
                var s = a.createElement("body");
                r.appendChild(s), s.setAttribute("xmlns", "http://www.w3.org/1999/xhtml"), s.setAttribute("xmlns:xfa", "http://www.xfa.org/schema/xfa-data/1.0/"), s.setAttribute("xfa:APIVersion", "Acroform:2.7.0.0"), s.setAttribute("xfa:spec", "2.1");
                var t = a.createElement("p");
                s.appendChild(t), t.setAttribute("dir", "ltr");
                var u = a.createElement("span");
                t.appendChild(u);
                var v = String.Format("font-size:{0}pt;font-style:normal;font-weight:normal", this.getFontSize());
                v += ";background: " + this.getFillColor() + ";color:" + this.getFontColor(), v += ";font-family:" + this.getFontName(), u.setAttribute("style", v);
                var w = a.createTextNode(this.getContents());
                u.appendChild(w);
                var x = "color:" + this.getColor(),
                    y = a.createTextNode(x),
                    z = a.createElement("defaultstyle");
                z.appendChild(y), b.appendChild(z);
                var A = this.annotJSONData[f.defaultAp];
                if (!A) {
                    var B, C, D, E = this.getColor(),
                        F = E.length;
                    7 === F ? (B = parseInt(E.slice(1, 3), 16), C = parseInt(E.slice(3, 5), 16), D = parseInt(E.slice(5), 16)) : 4 === F && (B = parseInt(E.charAt(1) + E.charAt(1), 16), C = parseInt(E.charAt(2) + E.charAt(2), 16), D = parseInt(E.charAt(3) + E.charAt(3), 16)), A = B / 256 + " " + C / 256 + " " + D / 256 + " rg"
                }
                var G = a.createTextNode(A),
                    H = a.createElement("defaultappearance");
                H.appendChild(G), b.appendChild(H)
            }
        }, e.extend(g, d), WebPDF.Annot.PDFTextBox = g, WebPDF.Annot.PDFTextBox
    }), define("core/Plugins/Annot/ImageAnnot/PDFImage", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        function d(a, b) {
            d.superclass.constructor.call(this, a, b)
        }
        a("core/Plugins/Annot/PDFAnnot");
        var e = WebPDF.Annot.PDFMarkup;
        a("core/Common/Interface");
        var f = WebPDF.Interface,
            g = WebPDF.Annot.AnnotDataJSONFormat;
        return WebPDF.Annot.PDFImage = d, $.extend(d.prototype, {
            setDynamicInfo: function(a) {
                return this.annotJSONData.dc = a
            },
            getDynamicInfo: function() {
                return this.annotJSONData.dc
            },
            isDynamic: function() {
                return this.annotJSONData[g.dynamic]
            },
            getSubType: function() {
                return WebPDF.Annot.AnnotType.Image
            },
            getNatualWidth: function() {
                return this.annotJSONData.naturalWidth
            },
            getNaturalHeight: function() {
                return this.annotJSONData.naturalHeight
            },
            getImageURL: function() {
                return this.annotJSONData.stamp_ic
            }
        }), f.extend(d, e), d
    }), define("core/Plugins/Signature/PDFSignature", ["core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.Signature = {}, a("core/Common/Math/Point");
        var e = a("core/Common/Math/Rect");
        d.Signature.SignatureType = {
            Normal: 0,
            Straddle: 1
        }, d.Signature.SignatureJSONFormat = {
            image: "imgUrl",
            rect: "rc",
            index: "pageIndex",
            rotation: "r",
            n: "n",
            local: "location",
            reason: "reason",
            signer: "name",
            dn: "dn",
            contactInfo: "contact",
            filter: "filter",
            subFilter: "subFilter",
            hash: "hash",
            left: "left",
            top: "top",
            right: "right",
            bottom: "bottom",
            flag: "f",
            subType: "subty",
            md: "md",
            isLayerBoder: "isStraddle",
            straddle: "straddle",
            type: "type",
            pos: "position",
            range: "range",
            percent: "percent",
            parent: "parent"
        };
        var f = d.Signature.SignatureJSONFormat;
        return d.Signature.PDFSignature = function(a, b) {
            this.sigJSONData = a, this.cerType = null, this.sigType = b
        }, d.Signature.PDFSignature.prototype = {
            getSigJSONData: function() {
                return this.sigJSONData
            },
            getSigName: function() {
                return null != this.sigJSONData[f.n] ? this.sigJSONData[f.n] : this.sigJSONData[f.parent]
            },
            setSigName: function(a) {
                this.sigJSONData[f.n] = a
            },
            getRect: function() {
                var a = this.sigJSONData[f.rect];
                a[0] == a[2] && (a[2] += 1), a[1] == a[3] && (a[3] += 1);
                var b = new e(a[0], a[1], a[2], a[3]);
                return b
            },
            setRect: function(a) {
                var b = this.sigJSONData[f.rect];
                b[0] = a.left, b[1] = a.top, b[2] = a.right, b[3] = a.bottom
            },
            getPageIndex: function() {
                return this.sigJSONData[f.index]
            },
            setPageIndex: function(a) {
                this.sigJSONData[f.index] = a
            },
            getRotation: function() {
                return this.sigJSONData[f.rotation]
            },
            setRotation: function(a) {
                this.sigJSONData[f.rotation] = a
            },
            getLocation: function() {
                return this.sigJSONData[f.local]
            },
            setLocation: function(a) {
                this.sigJSONData[f.local] = a
            },
            getReason: function() {
                return this.sigJSONData[f.reason]
            },
            setReason: function(a) {
                this.sigJSONData[f.reason] = a
            },
            getImageUrl: function() {
                return this.sigJSONData[f.image]
            },
            setImageUrl: function(a) {
                this.sigJSONData[f.image] = a
            },
            getCerType: function() {
                return this.cerType
            },
            setCerType: function(a) {
                this.cerType = a
            },
            getType: function() {
                return this.sigType
            },
            isLayerBoder: function() {
                return this.sigJSONData[f.isLayerBoder]
            },
            setType: function(a) {
                this.sigType = a
            },
            setStraddleType: function(a) {
                this.sigJSONData[f.straddle][f.type] = a
            },
            getStraddleType: function(a) {
                return this.sigJSONData[f.straddle][f.type]
            },
            setStraddlePercent: function(a) {
                this.sigJSONData[f.straddle][f.percent] = a
            },
            getStraddlePercent: function(a) {
                return this.sigJSONData[f.straddle][f.percent]
            },
            setStraddlePageRange: function(a) {
                this.sigJSONData[f.straddle][f.range] = a
            },
            getStraddlePageRange: function() {
                return this.sigJSONData[f.straddle][f.range]
            },
            setStraddlePos: function(a) {
                this.sigJSONData[f.straddle][f.pos] = a
            },
            getStraddlePos: function() {
                return this.sigJSONData[f.straddle][f.pos]
            },
            generatePosionByRect: function(a) {
                this.sigJSONData[f.left] = a.left, this.sigJSONData[f.right] = a.right, this.sigJSONData[f.bottom] = a.bottom, this.sigJSONData[f.top] = a.top
            },
            isShow: function() {
                return "134" == this.sigJSONData[f.flag] ? !1 : !0
            },
            isStraddle: function() {
                return "Straddle" == this.sigJSONData[f.subType] ? !0 : !1
            },
            getParent: function() {
                return this.sigJSONData[f.parent]
            },
            getModifyTime: function() {
                return this.sigJSONData[f.md]
            },
            getSigner: function() {
                return this.sigJSONData[f.signer]
            }
        }, d.Signature.PDFSignature
    }), define("core/Plugins/InkSign/PDFInkSign", ["core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.InkSign = {}, a("core/Common/Math/Point");
        var e = a("core/Common/Math/Rect");
        d.InkSign.InkSignType = {
            Normal: 0,
            Straddle: 1
        }, d.InkSign.InkSignJSONFormat = {
            rect: "rc",
            index: "pageIndex",
            rotation: "r",
            n: "n",
            local: "location",
            reason: "reason",
            signer: "name",
            dn: "dn",
            contactInfo: "contact",
            filter: "filter",
            subFilter: "subFilter",
            hash: "hash",
            left: "left",
            top: "top",
            right: "right",
            bottom: "bottom",
            flag: "f",
            subType: "subty",
            md: "md",
            inkData: "inkData",
            isLayerBoder: "isStraddle"
        };
        var f = d.InkSign.InkSignJSONFormat;
        return d.InkSign.PDFInkSign = function(a, b) {
            this.sigJSONData = a, this.sigType = b
        }, d.InkSign.PDFInkSign.prototype = {
            getSigJSONData: function() {
                return this.sigJSONData
            },
            getSigName: function() {
                return this.sigJSONData[f.n]
            },
            setSigName: function(a) {
                this.sigJSONData[f.n] = a
            },
            getRect: function() {
                var a = this.sigJSONData[f.rect];
                a[0] == a[2] && (a[2] += 1), a[1] == a[3] && (a[3] += 1);
                var b = new e(a[0], a[1], a[2], a[3]);
                return b
            },
            setRect: function(a) {
                var b = this.sigJSONData[f.rect];
                b[0] = a.left, b[1] = a.top, b[2] = a.right, b[3] = a.bottom
            },
            getPageIndex: function() {
                return this.sigJSONData[f.index]
            },
            setPageIndex: function(a) {
                this.sigJSONData[f.index] = a
            },
            getLocation: function() {
                return this.sigJSONData[f.local]
            },
            setLocation: function(a) {
                this.sigJSONData[f.local] = a
            },
            getReason: function() {
                return this.sigJSONData[f.reason]
            },
            setReason: function(a) {
                this.sigJSONData[f.reason] = a
            },
            getInkData: function() {
                return this.sigJSONData[f.inkData]
            },
            setInkData: function(a) {
                this.sigJSONData[f.inkData] = a
            },
            getType: function() {
                return this.sigType
            },
            isLayerBoder: function() {
                return this.sigJSONData[f.isLayerBoder]
            },
            setType: function(a) {
                this.sigType = a
            },
            generatePosionByRect: function(a) {
                this.sigJSONData[f.left] = a.left, this.sigJSONData[f.right] = a.right, this.sigJSONData[f.bottom] = a.bottom, this.sigJSONData[f.top] = a.top
            },
            isShow: function() {
                return "134" == this.sigJSONData[f.flag] ? !1 : !0
            },
            getModifyTime: function() {
                return this.sigJSONData[f.md]
            },
            getSigner: function() {
                return this.sigJSONData[f.signer]
            }
        }, d.InkSign.PDFInkSign
    }), define("core/Plugins/Annot/DrawingAnnot/PDFCircle", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = (a("core/Plugins/Annot/PDFAnnot"), WebPDF.Annot.PDFMarkup);
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b)
            };
        return g.prototype = {
            createAnnot: function(a, b) {
                if ("Markup" != a[f.type] || a[WebPDF.Annot.AnnotDataJSONFormat.subType] != WebPDF.Annot.AnnotType.Circle) return null;
                new WebPDF.Annot.PDFCircle(a)
            },
            setFillColor: function(a) {
                this.annotJSONData[f.fillColor] = a
            },
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getBorderStyle();
                c && this.setBorderStyleToNode(b, c);
                var d = this.getBorderWidth();
                d && b.setAttribute("width", d.toString());
                var e = this.getDashArray();
                if (e)
                    for (var f = 0; f < e.length; f++) String.Format("{0},{1}", e[f].length, e[f].nCap);
                var h = this.getFillColor();
                h && b.setAttribute("interior-color", h)
            }
        }, e.extend(g, d), WebPDF.Annot.PDFCircle = g, WebPDF.Annot.PDFCircle
    }), define("core/Plugins/Annot/DrawingAnnot/PDFSquare", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = (a("core/Plugins/Annot/PDFAnnot"), WebPDF.Annot.PDFMarkup);
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b)
            };
        return g.prototype = {
            createAnnot: function(a, b) {
                if ("Markup" != a[f.type] || a[WebPDF.Annot.AnnotDataJSONFormat.subType] != WebPDF.Annot.AnnotType.Square) return null;
                new WebPDF.Annot.PDFSquare(a)
            },
            setFillColor: function(a) {
                this.annotJSONData[f.fillColor] = a
            },
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getBorderStyle();
                c && this.setBorderStyleToNode(b, c);
                var d = this.getBorderWidth();
                d && b.setAttribute("width", d.toString());
                var e = this.getDashArray();
                if (e)
                    for (var f = 0; f < e.length; f++) String.Format("{0},{1}", e[f].length, e[f].nCap);
                var h = this.getFillColor();
                h && b.setAttribute("interior-color", h)
            }
        }, e.extend(g, d), WebPDF.Annot.PDFSquare = g, WebPDF.Annot.PDFSquare
    }), define("core/Plugins/Annot/DrawingAnnot/PDFPolygon", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = (a("core/Plugins/Annot/PDFAnnot"), WebPDF.Annot.PDFMarkup);
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat,
            g = function(a, b) {
                g.superclass.constructor.call(this, a, b)
            };
        return g.prototype = {
            createAnnot: function(a, b) {
                if ("Markup" != a[f.type] || a[WebPDF.Annot.AnnotDataJSONFormat.subType] != WebPDF.Annot.AnnotType.Circle) return null;
                new WebPDF.Annot.PDFPolygon(a)
            },
            getVts: function() {
                return this.annotJSONData[f.vts]
            },
            setVts: function(a) {
                this.annotJSONData[f.vts] = a
            },
            getIT: function() {
                var a = this.annotJSONData[f.it];
                return a || "Cloud" != this.annotJSONData[f.subject] && "��" != this.annotJSONData[f.subject] || (a = "PolygonCloud"), a
            },
            setIT: function(a) {
                this.annotJSONData[f.it] = a
            },
            setFillColor: function(a) {
                this.annotJSONData[f.fillColor] = a
            },
            getOpacity: function() {
                return this.annotJSONData[f.opacity]
            },
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getBorderStyle();
                c && this.setBorderStyleToNode(b, c);
                var d = this.getBorderWidth();
                d && b.setAttribute("width", d.toString());
                var e = this.getDashArray();
                if (e)
                    for (var f = 0; f < e.length; f++) String.Format("{0},{1}", e[f].length, e[f].nCap);
                var h = this.getFillColor();
                h && b.setAttribute("interior-color", h), this.getIT() && (b.setAttribute("IT", this.getIT()), b.setAttribute("style", "cloudy"), b.setAttribute("intensity", 2));
                var i = this.getVts();
                if (i) {
                    for (var j = "", f = 0; f < i.length; f += 2) {
                        var k = WebPDF.Tool.getReaderApp().getPDFDoc().getPage(this.pageIndex).transformPointToPDF(i[f], i[f + 1]);
                        j += String.Format("{0},{1};", k.x, k.y)
                    }
                    if (j) {
                        j = j.substr(0, j.length - 1);
                        var l = a.createElement("vertices"),
                            m = a.createTextNode(j);
                        l.appendChild(m), b.appendChild(l)
                    }
                }
            }
        }, e.extend(g, d), WebPDF.Annot.PDFPolygon = g, WebPDF.Annot.PDFPolygon
    }), define("core/Plugins/Annot/DrawingAnnot/PDFLine", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = (a("core/Plugins/Annot/PDFAnnot"), WebPDF.Annot.PDFMarkup);
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat;
        WebPDF.Annot.LineStyle = {
            None: "None",
            OpenArrow: "OpenArrow",
            ClosedArrow: "ClosedArrow",
            Square: "Square",
            Circle: "Circle",
            Diamond: "Diamond",
            Butt: "Butt",
            ROpenArrow: "ROpenArrow",
            RClosedArrow: "RClosedArrow",
            Slash: "Slash"
        };
        var g = function(a, b) {
            switch (g.superclass.constructor.call(this, a, b), this.annotJSONData.cap) {
                case 1:
                case !0:
                    this.annotJSONData.cap = !0;
                    break;
                default:
                    this.annotJSONData.cap = !1
            }
            this.getLineRect = function() {
                var a = this.annotJSONData[f.lineRect];
                if (!a) return a;
                var b = new WebPDF.PDFRect(a[0], a[1], a[2], a[3]);
                return b
            }, this.setLineRect = function(a) {
                this.annotJSONData[f.lineRect] = [a.left, a.top, a.right, a.bottom]
            }, this.setStartPoint = function(a) {
                var b = this.annotJSONData[f.lineRect];
                b || (b = []), b[0] = a.x, b[1] = a.y
            }, this.getStartPoint = function() {
                var a = new WebPDF.PDFPoint(0, 0),
                    b = this.annotJSONData[f.lineRect];
                return b ? (a.x = b[0], a.y = b[1], a) : a
            }, this.setEndPoint = function(a) {
                var b = this.annotJSONData[f.lineRect];
                b || (b = []), b[2] = a.x, b[3] = a.y
            }, this.getEndPoint = function() {
                var a = new WebPDF.PDFPoint(0, 0),
                    b = this.annotJSONData[f.lineRect];
                return b ? (a.x = b[2], a.y = b[3], a) : a
            }, this.getLineStyle = function() {
                return this.annotJSONData[f.lineStyle]
            }, this.getStartStyle = function() {
                var a = "None",
                    b = this.annotJSONData[f.lineStyle];
                return b && b[0] ? b[0] : a
            }, this.setStartStyle = function(a) {
                var b = this.annotJSONData[f.lineStyle];
                b || (b = ["None", "None"]), b[0] = a, this.annotJSONData[f.lineStyle] = b
            }, this.getEndStyle = function() {
                var a = "None",
                    b = this.annotJSONData[f.lineStyle];
                return b && b[1] ? b[1] : a
            }, this.setEndStyle = function(a) {
                var b = this.annotJSONData[f.lineStyle];
                b || (b = ["None", "None"]), b[1] = a, this.annotJSONData[f.lineStyle] = b
            }, this.getIntent = function() {
                return this.annotJSONData[f.it]
            }, this.showCaption = function() {
                return this.annotJSONData[f.cap] !== !1
            }
        };
        return g.prototype = {
            createAnnot: function(a, b) {
                if ("Markup" != a[f.type] || a[WebPDF.Annot.AnnotDataJSONFormat.subType] != WebPDF.Annot.AnnotType.Line) return null;
                new WebPDF.Annot.PDFLine(a)
            },
            exportPropertyToXFDF: function(a, b) {
                g.superclass.exportPropertyToXFDF.apply(this, arguments);
                var c = this.getBorderStyle();
                c && this.setBorderStyleToNode(b, c);
                var d = this.getBorderWidth();
                d && b.setAttribute("width", d.toString());
                var e = this.getDashArray();
                if (e)
                    for (var f = 0; f < e.length; f++) String.Format("{0},{1}", e[f].length, e[f].nCap);
                var h = this.getStartPoint(),
                    i = this.getEndPoint(),
                    j = WebPDF.Tool.getReaderApp().getPDFDoc().getPage(this.pageIndex).transformPointToPDF(h.x, h.y),
                    k = WebPDF.Tool.getReaderApp().getPDFDoc().getPage(this.pageIndex).transformPointToPDF(i.x, i.y),
                    l = String.Format("{0},{1}", j.x, j.y),
                    m = String.Format("{0},{1}", k.x, k.y);
                b.setAttribute("start", l), b.setAttribute("end", m);
                var n = this.getStartStyle(),
                    o = this.getEndStyle();
                b.setAttribute("head", n), b.setAttribute("tail", o);
                var p = this.getFillColor();
                p && b.setAttribute("interior-color", p);
                var q = this.showCaption();
                b.setAttribute("cap", q)
            }
        }, e.extend(g, d), WebPDF.Annot.PDFLine = g, WebPDF.Annot.PDFLine
    }), define("core/Plugins/Annot/AnnotCommonView", [], function(a, b, c) {
        function d(a) {
            e = a
        }
        var e = null;
        d.prototype = {
            hasAnnotTag: function(a) {
                return a.hasClass("fwr-annot") ? !0 : !1
            },
            getPageIndex: function(a) {
                return parseInt(a.getAttribute("page-index"))
            },
            getAnnotName: function(a) {
                return a.getAttribute("annot-name")
            }
        }, b.createAnnotCommonView = function(a) {
            return new d(a)
        }
    }), define("core/Plugins/Annot/TypewriterAnnotToolHandler", ["core/Plugins/Annot/TypewriterAnnotView", "core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/TypewriterAnnotService"], function(a, b, c) {
        var d, e, f;
        return WebPDF.Tools.TOOL_NAME_TYPERWRITER = "FreeTextTypewriter", WebPDF.Event.TypewriterAnnotToolHandler = function(b, c) {
            var g = null,
                h = b,
                i = !1;
            this.onInit = function(b) {
                g = b, f = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(), d = a("core/Plugins/Annot/TypewriterAnnotView").createTypewriterAnnotView(f, b), e = a("core/Plugins/Annot/TypewriterAnnotService").createTypewriterAnnotService(f, b)
            }, this.onDestroy = function() {}, this.getName = function() {
                return h
            }, this.onActivate = function() {
                h === WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_TYPEWRITER && d.addTypewriteCursor()
            }, this.onDeactivate = function() {
                d.removeTypewriteCursor()
            }, this.isEnabled = function() {
                var a = g.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() != WebPDF.PDFDocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return i
            }, this.onLButtonDown = function(a) {
                if (d.containsJQDocView(a) === !1) return !1;
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = d.onLButtonInPage(a);
                if (!c.pageView || c.pageView.isPageLoadLimit()) return !1;
                var g = e.getAnnot(a, h, c.pageView, c.pageViewRect);
                g && (d.createAnnot(f, g.pageView, g.pAnnot, g.pPDFPage), d.onTypewriterAnnotEdit(g.pageView, g.pAnnot), e.addAnnotRecord(g.pAnnot, g.pPDFPage), b.setModified(!0)), i = !0
            }, this.onLButtonUp = function(a) {
                i = !1
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                return !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Event.TypewriterAnnotToolHandler
    }), define("core/Plugins/Annot/TextboxAnnotToolHandler", ["core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/TextboxAnnotView", "core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/TextboxAnnotService"], function(a, b, c) {
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect,
            f = WebPDF.RectUtils,
            g = a("core/Common/CoordinateUtils"),
            h = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        return WebPDF.Tools.TOOL_NAME_TEXTBOX = "FreeTextTextbox", WebPDF.Event.TextboxAnnotToolHandler = function(b, c) {
            function i(a, b) {
                var c = l.getAnnot(a, s, p.pageView, p.pageViewRect, b);
                if (c) {
                    var d = WebPDF.Tool.getReaderApp().getMainView().getDocView();
                    if (k.createAnnot(m, c.pageView, c.pAnnot, c.pPDFPage), null == b) {
                        var e = q.getTextboxAnnotRectDivID(z, c.pAnnot.getAnnotName()),
                            f = $("#" + e);
                        f.addClass("default-add")
                    }
                    k.onTextboxAnnotEdit(c.pageView, c.pAnnot), c.pageView.addAnnotRecord(c.pAnnot, "Add"), d.setModified(!0)
                }
            }

            function j() {
                t = !1, m.getUIManager().removeCanvans(), A = !1
            }
            var k, l, m, n, o, p, q, r = null,
                s = b,
                t = !1,
                u = 1,
                v = "#ff1418",
                w = new d(0, 0),
                x = new d(0, 0),
                y = new e,
                z = null,
                A = !1;
            this.onInit = function(b) {
                r = b, m = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(), k = a("core/Plugins/Annot/TextboxAnnotView").createTextboxAnnotView(m, b), l = a("core/Plugins/Annot/TextboxAnnotService").createTextboxAnnotService(m, b), q = new WebPDF.Annot.AnnotUIManager(m, r)
            }, this.onDestroy = function() {}, this.getName = function() {
                return s
            }, this.onActivate = function() {}, this.onDeactivate = function() {}, this.isEnabled = function() {
                var a = r.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() != WebPDF.PDFDocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return t
            }, this.onLButtonDown = function(a) {
                if (p = k.onLButtonInPage(a), !p.pageView || p.pageView.isPageLoadLimit()) return !1;
                if (p.pageView.isPageLoaded()) {
                    if (z = p.pageView, !c) return !1;
                    c.getAnnotHandlerMgr().getUIManager().resetCanvens(z), n = c.getAnnotHandlerMgr().getCavansElement(), o = n.getContext("2d");
                    var b = $(n).offset();
                    return w.setPoint(a.pageX - b.left, a.pageY - b.top), x.setPoint(a.pageX - b.left, a.pageY - b.top), f.empty(y), A = !0, t = !0, !0
                }
            }, this.onLButtonUp = function(a) {
                if (!A) return !0;
                if (x.x === w.x || x.y === w.y) return A = !1, i(a, null), j(), !0;
                if (k.containsJQDocView(a) === !1) return !1;
                var b, c = $(n).offset(),
                    d = $("#" + z.getPageViewContainerID()).offset(),
                    e = y.left - (d.left - c.left),
                    g = f.width(y),
                    h = y.top - (d.top - c.top),
                    l = f.height(y);
                b = y.left > y.right ? new WebPDF.PDFRect(e - g, h - l, e, h) : new WebPDF.PDFRect(e, h, e + g, h + l);
                var m = z.deviceRectToPDF(b, !0),
                    o = -.5,
                    p = -.5,
                    q = [m.left - o, m.top + p, m.right + o, m.bottom - p];
                return i(a, q), j(), !0
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                if (!A) return !1;
                var b = a.pageX,
                    c = a.pageY,
                    d = $("#" + z.getPageViewContainerID()).offset(),
                    e = $(n).offset(),
                    i = b - d.left,
                    j = c - d.top;
                if (0 > i && (b = d.left), i > z.getPageViewWidth() && (b = d.left + z.getPageViewWidth()), 0 > j && (c = d.top), j > z.getPageViewHeight() && (c = d.top + z.getPageViewHeight()), x.x = b - e.left, x.y = c - e.top, o.clearRect(0, 0, n.width, n.height), x.x === w.x || x.y === w.y) return !0;
                f.setRect(y, w.x, w.y, x.x, x.y);
                var k = g.pageRectToCanvansRect(z, n, y, z.getDocView().getRotate()),
                    l = u * z.getScale();
                l = parseInt(2 > l ? 2 : l);
                var m = {
                    borderColor: v,
                    borderWidth: l
                };
                return h.drawSquare(o, k.left, k.top, k.right, k.bottom, m), !0
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Event.TextboxAnnotToolHandler
    }), define("core/Plugins/Annot/CalloutAnnotToolHandler", ["core/Common/CoordinateUtils", "core/Plugins/Annot/CalloutAnnotView", "core/Plugins/Annot/AnnotUIManager", "core/Common/Math/Rect", "core/WebPDF", "core/Common/CanvasUtils", "core/Plugins/Annot/Annot", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/CalloutAnnotService"], function(a, b, c) {
        var d, e, f, g = (WebPDF.PDFPoint, WebPDF.PDFRect, WebPDF.RectUtils);
        WebPDF.Tools.TOOL_NAME_CALLOUT = "FreeTextCallout";
        var h = a("core/Common/CoordinateUtils");
        return WebPDF.Event.CalloutAnnotToolHandler = function(b, c) {
            var i, j, k, l, m = null,
                n = b,
                o = !1,
                p = new WebPDF.PDFPoint(0, 0),
                q = new WebPDF.PDFPoint(0, 0),
                r = new WebPDF.PDFRect,
                s = !1,
                t = !1;
            this.onInit = function(b) {
                m = b, f = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(), d = a("core/Plugins/Annot/CalloutAnnotView").createCalloutAnnotView(f, b), e = a("core/Plugins/Annot/CalloutAnnotService").createCalloutAnnotService(f, b)
            }, this.onDestroy = function() {}, this.getName = function() {
                return n
            }, this.onActivate = function() {
                n === WebPDF.Annot.TypewriterAnnotType.TYPEWRITERTYPE_CALLOUT && d.addCalloutCursor()
            }, this.onDeactivate = function() {
                d.removeCalloutCursor()
            }, this.isEnabled = function() {
                var a = m.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() != WebPDF.PDFDocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return o
            }, this.onLButtonDown = function(a) {
                if (o) return t = !0, !1;
                t = !1;
                var b = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                if (!b) return !1;
                var c = d.onLButtonInPage(a);
                if (!c.pageView || c.pageView.isPageLoadLimit()) return !1;
                b.getAnnotHandlerMgr().getUIManager().resetCanvens(c.pageView), j = b.getAnnotHandlerMgr().getCavansElement(), k = j.getContext("2d"), i = c.pageView, p = e.getPointByEvent(i, j, a), l = e.initPointArrayByStartPoint(i, l, p, j);
                var f = e.getRectPoints(l, i);
                g.setRect(r, f[0].x, f[0].y, f[1].x, f[1].y), g.normalizeEx(r);
                var m = (h.pageRectToCanvansRect(i, j, r, i.getDocView().getRotate()), WebPDF.AccountInstance.getUserConfig()),
                    n = {
                        borderColor: m.annot.callout.clr,
                        borderWidth: m.annot.callout.borderWidth * i.getScale(),
                        fillColor: m.annot.callout.fillColor,
                        isDrawArrow: !1,
                        isDrawArc: !1
                    };
                return d.drawCallout1(k, l, r, n), o = !0, !0
            }, this.onLButtonUp = function(a) {
                if (!o) return f.getUIManager().removeCanvans(), !1;
                if (!o || !t) return !1;
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = e.getAnnot(a, n, i, l, r, j);
                if (c) {
                    d.createAnnot(f, c.pageView, c.pAnnot, c.pPDFPage);
                    var g = d.drawCallout(c.pageView, c.pAnnot),
                        h = e.getPointsByAnnot(c.pAnnot),
                        p = {
                            borderColor: c.pAnnot.getColor(),
                            borderWidth: c.pAnnot.getBorderWidth() * i.getScale(),
                            fillColor: c.pAnnot.getFillColor(),
                            isDrawArrow: !0,
                            isDrawArc: !1
                        },
                        q = e.getRectPoints(h, c.pageView),
                        u = e.getPointsToAnnotCanvas(h, q);
                    d.drawCallout1(g, u, null, p), k.closePath(), k.clearRect(0, 0, j.width, j.height), d.onCalloutAnnotEdit(c.pageView, c.pAnnot), a.preventDefault(), e.addAnnotRecord(c.pAnnot, c.pPDFPage), b.setModified(!0)
                }
                return l = null, s = !1, o = !1, m.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), WebPDF.Environment.mobile && $("#annottools").children("ul").find("li").removeClass("selected"), f.getUIManager().removeCanvans(), !0
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                if (!o) return !1;
                if (s = !0, q = e.getPointByEvent(i, j, a), q.x === p.x || q.y === p.y) return !0;
                k.clearRect(0, 0, j.width, j.height), l = e.updatePointArray(i, l, q, -1, j);
                var b = e.getRectPoints(l, i);
                WebPDF.RectUtils.setRect(r, b[0].x, b[0].y, b[1].x, b[1].y), WebPDF.RectUtils.normalizeEx(r);
                var c = (h.pageRectToCanvansRect(i, j, r, i.getDocView().getRotate()), WebPDF.AccountInstance.getUserConfig()),
                    f = {
                        borderColor: c.annot.callout.clr,
                        borderWidth: c.annot.callout.borderWidth * i.getScale(),
                        fillColor: c.annot.callout.fillColor,
                        isDrawArrow: !1,
                        isDrawArc: !1
                    };
                return d.drawCallout1(k, l, r, f), !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onMouseDown = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Event.CalloutAnnotToolHandler
    }), define("core/Plugins/Annot/ImageAnnot/ImageAnnotToolHandler", [], function(a, b, c) {
        function d(a) {
            function b(a) {
                q = a
            }

            function c() {
                var a = q.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (b.addClass("fwr-note-cursor-ie"), b.css("cursor", "crosshair")) : b.addClass("fwr-note-cursor")
            }

            function d() {
                var a = q.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-note-cursor-ie") : b.removeClass("fwr-note-cursor")
            }

            function f(a) {
                t = a
            }

            function g(a) {
                p = a
            }

            function h() {
                return WebPDF.Tools.TOOL_NAME_IMAGE
            }

            function i() {
                var a = q.getMainView().getDocView().getPDFDoc();
                return !!a && a.getDocType() != WebPDF.PDFDocType.XFA
            }

            function j() {
                return u
            }

            function k(a) {
                if (null == t) return !0;
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(c.get(0), a.target, !0)) return !1;
                for (var d = b.getVisiblePageRange(), e = null, f = null, g = d.begin; g <= d.end; g++) {
                    var h = b.getPageView(g),
                        i = $("#" + h.getPageViewContainerID()).offset(),
                        j = h.getPageViewWidth(),
                        k = h.getPageViewHeight();
                    if (f = new WebPDF.PDFRect(i.left, i.top, i.left + j, i.top + k), WebPDF.RectUtils.normalize(f), WebPDF.RectUtils.ptInRect(f, a.pageX, a.pageY)) {
                        e = h;
                        break
                    }
                }
                if (null != e) {
                    if (e.isPageLoadLimit()) return !1;
                    s.createAnnot(e, a.pageX - f.left, a.pageY - f.bottom), $.isFunction(p) && p(), b.setModified(!0), u = !0
                }
                return !0
            }

            function l(a) {
                return u = !1, !0
            }

            function m(a, b, c) {
                var d = Date.now(),
                    f = Math.floor(d / 1e3).toString(),
                    g = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                    h = a.getPDFPage(),
                    i = h.getPageWidth(),
                    j = h.getPageHeight(),
                    k = t.naturalWidth || i,
                    l = t.naturalHeight || .382 * k,
                    m = Math.min(k, i) / k;
                k *= m, l *= m, m = Math.min(l, j) / l, k *= m, l *= m;
                var n = 90 * a.getPDFPage().getPageRotate() + a.getDocView().getRotate(),
                    o = {
                        c: "",
                        ca: 1,
                        stamp_ic: t.imageURL,
                        cl: "#000000",
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: f,
                        cd: f,
                        n: null,
                        pop: null,
                        subj: t.subject,
                        subty: "Screen",
                        tit: g,
                        ty: "Markup",
                        r: n,
                        rc: null,
                        pdf: "false",
                        del: 0,
                        dyna: !1,
                        df: 0,
                        dc: "",
                        naturalWidth: k,
                        naturalHeight: l
                    },
                    m = a.getScale(),
                    p = (q.getPixelsPerPoint(), q.getMainView().getDocView()),
                    s = p.getRotate(),
                    u = new WebPDF.PDFPoint(b, c);
                u = a.devicePtToPDF(u);
                var v = k / 2,
                    w = l / 2;
                0 == s || 180 == s ? pdfrect = new WebPDF.PDFRect(u.x - v, u.y + w, u.x + v, u.y - w) : (90 == s || 270 == s) && (pdfrect = new WebPDF.PDFRect(u.x - w, u.y + v, u.x + w, u.y - v)), pdfrect.left < 0 && WebPDF.RectUtils.offset(pdfrect, 0 - pdfrect.left, 0), pdfrect.bottom < 0 && WebPDF.RectUtils.offset(pdfrect, 0, 0 - pdfrect.bottom), pdfrect.right > i && WebPDF.RectUtils.offset(pdfrect, i - pdfrect.right, 0), pdfrect.top > j && WebPDF.RectUtils.offset(pdfrect, 0, j - pdfrect.top), o.rc = [pdfrect.left, pdfrect.top, pdfrect.right, pdfrect.bottom];
                var x = e.createAnnot(o, h.getPageIndex(), !1);
                h.getAnnotJsonData().push(o), h.addAnnot(x), a.setModified(!0);
                var y = r.getAnnotHandlerMgr(),
                    z = y.getUIManager().getPageAnnotsContainerID(a),
                    A = $("#" + z),
                    B = x.getAnnotName(),
                    C = y.getUIManager().createAAnnotHtmlContent(a, x, B, 1, !1, !1);
                A.append(C);
                var D = y.getAnnotHandler(WebPDF.Annot.AnnotType.Image);
                D && D.resetDynamicInfo(a, x), y.clearSelection(), y.setFocusAnnot(a, x), y.addSelection(x);
                var E = [];
                E.push(x.annotJSONData);
                var F = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, E);
                q.addAnnotUndo(F), $(q).trigger(WebPDF.EventList.ANNOT_ADDED, {
                    pageIndex: h.getPageIndex(),
                    annot: r.getAnnotHandlerMgr().packageAnnot(x)
                }), $(q).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                    annotName: x.getAnnotName(),
                    pageIndex: h.getPageIndex()
                })
            }

            function n() {
                return !1
            }

            function o() {}
            var p, q = null,
                r = a,
                s = this,
                t = null,
                u = !1;
            WebPDF.Annot.MKA_POPUPWIDTH, WebPDF.Annot.MKA_POPUPHEIGHT;
            s.onInit = b, s.onActivate = c, s.onDeactivate = d, s.setCurrentImage = f, s.setAddImageCallback = g, s.onDestroy = o, s.getName = h, s.isEnabled = i, s.isProcessing = j, s.createAnnot = m, s.onLButtonDown = k, s.onLButtonUp = l, s.onLButtonDblClk = n, s.onMouseMove = n, s.onRButtonDown = n, s.onRButtonUp = n, s.onRButtonDblClk = n, s.onMouseWheel = n, s.onMouseOver = n, s.onMouseOut = n, s.onMouseEnter = n, s.onMouseLeave = n, s.onKeyDown = n, s.onKeyUp = n, s.onChar = n
        }
        var e = WebPDF.Annot.AnnotFactory;
        WebPDF.Common;
        return WebPDF.Tools.TOOL_NAME_IMAGE = "Image", WebPDF.Tools.ImageAnnotToolHandler = d, d
    }), define("core/Plugins/Annot/StampAnnotToolHandler", ["core/Plugins/Annot/PDFStamp", "core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        a("core/Plugins/Annot/PDFStamp");
        var d = WebPDF.Annot.AnnotFactory,
            e = WebPDF.Common;
        return WebPDF.Tools.TOOL_NAME_STAMP = "Stamp", WebPDF.Tools.StampAnnotToolHandler = function(a) {
            var b = null,
                c = a,
                f = !1,
                g = this,
                h = null,
                i = null,
                j = WebPDF.Annot.MKA_POPUPWIDTH,
                k = WebPDF.Annot.MKA_POPUPHEIGHT,
                l = 1;
            this.onInit = function(a) {
                b = a
            }, this.setCurrentStamp = function(a) {
                h = a
            }, this.setAddStampCallback = function(a) {
                i = a
            }, this.onDestroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_STAMP
            }, this.onActivate = function() {
                var a = b.getMainView().getDocView(),
                    c = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (c.addClass("fwr-note-cursor-ie"), c.css("cursor", "crosshair")) : c.addClass("fwr-note-cursor")
            }, this.onDeactivate = function() {
                var a = b.getMainView().getDocView(),
                    c = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? c.removeClass("fwr-note-cursor-ie") : c.removeClass("fwr-note-cursor")
            }, this.isEnabled = function() {
                var a = b.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() != WebPDF.PDFDocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return f
            }, this.onLButtonDown = function(a) {
                if (null == h) return !0;
                var b = WebPDF.Tool.getReaderApp().getMainView().getDocView(),
                    c = $("#" + b.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(c.get(0), a.target, !0)) return !1;
                for (var d = b.getVisiblePageRange(), e = null, j = null, k = d.begin; k <= d.end; k++) {
                    var l = b.getPageView(k),
                        m = $("#" + l.getPageViewContainerID()).offset(),
                        n = l.getPageViewWidth(),
                        o = l.getPageViewHeight();
                    if (j = new WebPDF.PDFRect(m.left, m.top, m.left + n, m.top + o), WebPDF.RectUtils.normalize(j), WebPDF.RectUtils.ptInRect(j, a.pageX, a.pageY)) {
                        e = l;
                        break
                    }
                }
                return !e || e.isPageLoadLimit() ? !1 : (null != e && (g.createAnnot(e, a.pageX - j.left, a.pageY - j.bottom), $.isFunction(i) && i(), b.setModified(!0)), f = !0, !0)
            }, this.onLButtonUp = function(a) {
                return f = !1, !0
            }, this.createAnnot = function(a, f, g) {
                function i(a) {
                    switch (a) {
                        case WebPDF.Annot.StampName.Approved:
                            return i18n.t("Annot.AnnotSubjApproved");
                        case WebPDF.Annot.StampName.Draft:
                            return i18n.t("Annot.AnnotSubjDraft");
                        case WebPDF.Annot.StampName.Confidential:
                            return i18n.t("Annot.AnnotSubjConfidential");
                        case WebPDF.Annot.StampName.Emergency:
                            return i18n.t("Annot.AnnotSubjEmergency");
                        case WebPDF.Annot.StampName.Completed:
                            return i18n.t("Annot.AnnotSubjCompleted");
                        case WebPDF.Annot.StampName.Received:
                            return i18n.t("Annot.AnnotSubjReceived");
                        case WebPDF.Annot.StampName.Reviewed:
                            return i18n.t("Annot.AnnotSubjReviewed");
                        case WebPDF.Annot.StampName.Revised:
                            return i18n.t("Annot.AnnotSubjRevised");
                        case "Stamp":
                            return i18n.t("PCLng.ToolBar.Stamp");
                        default:
                            return a
                    }
                }
                var m = new Date,
                    n = m.valueOf(),
                    o = Math.floor(n / 1e3).toString(),
                    p = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                    q = {
                        c: "",
                        stamp_ic: h.icon,
                        ca: l,
                        cd: o,
                        cl: "#ff0000",
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: o,
                        n: null,
                        pop: null,
                        subj: i(h.type),
                        subty: WebPDF.Annot.AnnotType.Stamp,
                        tit: p,
                        ty: "Markup",
                        r: 90 * a.getPDFPage().getPageRotate() + a.getDocView().getRotate(),
                        rc: null,
                        pdf: "false",
                        del: 0,
                        dyna: !1,
                        df: 0,
                        dc: ""
                    };
                if (void 0 !== h.dynamic) {
                    q.dyna = !0;
                    for (var r = h.dynamic, s = 0, t = "", u = !1, v = e.timestampToDateString(q.cd, e.StampTimeFormat), n = v.split(" "), w = 0; w < r.length; w++) "name" == r[w] ? (s += WebPDF.Annot.stampDynamimc.name, t += q.tit, u = !0) : "time" == r[w] ? (s += WebPDF.Annot.stampDynamimc.time, u && (t += ","), t += n[0], u = !0) : "date" == r[w] && (s += WebPDF.Annot.stampDynamimc.date, u && (t += ","), t += n[1]);
                    q.df = s, q.dc = t
                }
                var x = (a.getScale(), b.getPixelsPerPoint(), a.getPDFPage()),
                    y = x.getPageWidth(),
                    z = x.getPageHeight(),
                    A = b.getMainView().getDocView(),
                    B = A.getRotate(),
                    C = h.width ? 3 * h.width / 4 : 148.5,
                    D = h.height ? 3 * h.height / 4 : 45,
                    E = new WebPDF.PDFPoint(f, g);
                E = a.devicePtToPDF(E);
                var F = C / 2,
                    G = D / 2,
                    H = ((90 * x.getPageRotate() % 360 + 360) % 360, null);
                if (0 == B || 180 == B ? H = new WebPDF.PDFRect(E.x - F, E.y + G, E.x + F, E.y - G) : (90 == B || 270 == B) && (H = new WebPDF.PDFRect(E.x - G, E.y + F, E.x + G, E.y - F)),
                    H.left < 0 && WebPDF.RectUtils.offset(H, 0 - H.left, 0), H.bottom < 0 && WebPDF.RectUtils.offset(H, 0, 0 - H.bottom), h.width > y || h.height > z) {
                    var I = y / h.width,
                        J = z / h.height;
                    if (J > I) {
                        H.right = y, H.left = 0;
                        var K = z - I * h.height;
                        H.bottom = E.y > K / 2 ? E.y - K / 2 : 0, H.top = H.bottom + I * h.height
                    } else {
                        H.top = z, H.bottom = 0;
                        var L = y - J * h.width;
                        H.left = E.x > L / 2 ? E.x - L / 2 : 0, H.right = H.left + J * h.width
                    }
                }
                H.right > y && WebPDF.RectUtils.offset(H, y - H.right, 0), H.top > z && WebPDF.RectUtils.offset(H, 0, z - H.top), q.rc = [H.left, H.top, H.right, H.bottom];
                var M = new WebPDF.PDFRect(0, 0, 0, 0);
                M.top = H.top;
                var N = a.getDocView().getPageViewRender().getPixelsPerPoint(),
                    O = a.getDocView().getScale();
                M.left = (a.getPageViewWidth() - j * N) / (O * N), M.right = M.left + j, M.bottom = M.top - k, M.bottom < 0 && WebPDF.RectUtils.offset(M, 0, -M.bottom), q.pop = {
                    f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                    md: o,
                    n: o + "_popup",
                    op: 0,
                    rc: [M.left, M.top, M.right, M.bottom]
                };
                var P = d.createAnnot(q, x.getPageIndex(), !1);
                x.getAnnotJsonData().push(q), x.addAnnot(P), a.setModified(!0);
                var Q = c.getAnnotHandlerMgr(),
                    R = Q.getUIManager().getPageAnnotsContainerID(a),
                    S = $("#" + R),
                    T = P.getAnnotName(),
                    U = Q.getUIManager().createAAnnotHtmlContent(a, P, T, 1, !1, !1);
                S.append(U);
                var V = Q.getAnnotHandler(WebPDF.Annot.AnnotType.Stamp);
                V && V.resetDynamicInfo(a, P), Q.clearSelection(), Q.setFocusAnnot(a, P), Q.addSelection(P);
                var W = [];
                W.push(P.annotJSONData);
                var X = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, W);
                b.addAnnotUndo(X), $(b).trigger(WebPDF.EventList.ANNOT_ADDED, {
                    pageIndex: x.getPageIndex(),
                    annot: c.getAnnotHandlerMgr().packageAnnot(P)
                }), $(b).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                    annotName: P.getAnnotName(),
                    pageIndex: x.getPageIndex()
                })
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                return !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Tools.StampAnnotToolHandler
    }), define("core/Plugins/Annot/PDFStamp", ["core/Plugins/Annot/PDFAnnot", "core/Plugins/Annot/Annot", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Interface"], function(a, b, c) {
        var d = (a("core/Plugins/Annot/PDFAnnot"), WebPDF.Annot.PDFMarkup);
        a("core/Common/Interface");
        var e = WebPDF.Interface,
            f = WebPDF.Annot.AnnotDataJSONFormat;
        WebPDF.Annot.StampName = {
            Approved: "Approved",
            Experimental: "Experimental",
            NotApproved: "NotApproved",
            AsIs: "AsIs",
            Expired: "Expired",
            NotForPublicRelease: "NotForPublicRelease",
            Confidential: "Confidential",
            Final: "Final",
            Sold: "Sold",
            Departmental: "Departmental",
            ForComment: "ForComment",
            TopSecret: "TopSecret",
            Draft: "Draft",
            ForPublicRelease: "ForPublicRelease",
            Emergency: "Emergency",
            Received: "Received",
            Reviewed: "Reviewed",
            Revised: "Revised",
            Completed: "Completed"
        }, WebPDF.Annot.StampDefaultValue = {
            Height: 60,
            Width: 198,
            pdfHeight: 30,
            pdfWidth: 100,
            DynamicInfoWidth: 132,
            DynamicInfoHeight: 14
        }, WebPDF.Annot.stampInfoOffset = {
            left: 14,
            top: 34
        }, WebPDF.Annot.stampDefault = {
            StandardStamps: {
                title: "Standard Stamps",
                stamps: [{
                    icon: "\\images\\stamp\\Standard Stamps\\Approved.svg",
                    type: "Approved"
                }, {
                    icon: "\\images\\stamp\\Standard Stamps\\Completed.svg",
                    type: "Completed"
                }, {
                    icon: "\\images\\stamp\\Standard Stamps\\Confidential.svg",
                    type: "Confidential"
                }, {
                    icon: "\\images\\stamp\\Standard Stamps\\Draft.svg",
                    type: "Draft"
                }, {
                    icon: "\\images\\stamp\\Standard Stamps\\Emergency.svg",
                    type: "Emergency"
                }]
            },
            DynamicStamps: {
                title: "Dynamic Stamps",
                stamps: [{
                    icon: "\\images\\stamp\\Dynamic Stamps\\Approved.svg",
                    type: "Approved"
                }, {
                    icon: "\\images\\stamp\\Dynamic Stamps\\Confidential.svg",
                    type: "Confidential"
                }, {
                    icon: "\\images\\stamp\\Dynamic Stamps\\Received.svg",
                    type: "Received"
                }, {
                    icon: "\\images\\stamp\\Dynamic Stamps\\Reviewed.svg",
                    type: "Reviewed"
                }, {
                    icon: "\\images\\stamp\\Dynamic Stamps\\Revised.svg",
                    type: "Revised"
                }]
            }
        }, WebPDF.Annot.stampDynamimc = {
            name: 1,
            time: 16,
            date: 256
        };
        var g = function(a, b) {
            g.superclass.constructor.call(this, a, b), this.pdfDestination = null, this.pdfAction = null, $.extend(this, {
                setDynamicInfo: function(a) {
                    return this.annotJSONData.dc = a
                },
                isDynamic: function() {
                    return this.annotJSONData[f.dynamic]
                },
                getDynamicInfo: function() {
                    return this.annotJSONData.dc
                },
                getIcon: function() {
                    return this.annotJSONData[f.icon]
                },
                getSubType: function() {
                    return WebPDF.Annot.AnnotType.Stamp
                }
            })
        };
        return e.extend(g, d), WebPDF.Annot.PDFStamp = g, WebPDF.Annot.PDFStamp
    }), define("core/Plugins/Annot/DrawingAnnot/DrawingAnnotToolHandler", ["core/Plugins/Annot/DrawingAnnot/CircleTools", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/DrawingAnnot/SquareTools", "core/Plugins/Annot/DrawingAnnot/LineTools", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceLineTool", "core/Plugins/Annot/DistanceAnnot/common", "core/Plugins/Annot/DrawingAnnot/PolygonTools", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Common/Math/Point", "core/WebPDF", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService", "core/Plugins/Annot/DrawingAnnot/CircleAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotView", "core/Plugins/Annot/DrawingAnnot/SquareAnnotView", "core/Plugins/Annot/DrawingAnnot/LineAnnotView", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotView", "core/Plugins/Annot/DistanceAnnot/DistanceAnnotToolHandler", "core/Plugins/Annot/DistanceAnnot/DistanceRulerView", "core/Plugins/Annot/DistanceAnnot/RulerView", "core/Plugins/Annot/DistanceAnnot/Ruler", "core/Plugins/Annot/DistanceAnnot/DistanceToolPopup"], function(a, b, c) {
        var d = a("core/Plugins/Annot/DrawingAnnot/CircleTools"),
            e = a("core/Plugins/Annot/DrawingAnnot/SquareTools"),
            f = a("core/Plugins/Annot/DrawingAnnot/LineTools"),
            g = a("core/Plugins/Annot/DistanceAnnot/DistanceLineTool"),
            h = a("core/Plugins/Annot/DrawingAnnot/PolygonTools"),
            i = a("core/Plugins/Annot/DrawingAnnot/CircleAnnotView"),
            j = a("core/Plugins/Annot/DrawingAnnot/PolygonAnnotView"),
            k = a("core/Plugins/Annot/DrawingAnnot/SquareAnnotView"),
            l = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"),
            m = a("core/Plugins/Annot/DrawingAnnot/LineAnnotView"),
            n = a("core/Plugins/Annot/DistanceAnnot/DistanceAnnotView");
        WebPDF.Tools.TOOL_NAME_DRAWING_RECTANGLE = "Rectangle Tool", WebPDF.Tools.TOOL_NAME_DRAWING_CIRCLE = "Circle Tool", WebPDF.Tools.TOOL_NAME_DRAWING_SQUARE = "Square Tool", WebPDF.Tools.TOOL_NAME_DRAWING_LINE = "Line Tool", WebPDF.Tools.TOOL_NAME_DRAWING_LINEARROW = "LineArrow Tool", WebPDF.Tools.TOOL_NAME_DRAWING_POLYGON = "Polygon Tool", WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE = "Polyline Tool", WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD = "Cloud Tool", WebPDF.Tools.TOOL_NAME_DRAWING_DISTANCE = "Distance Tool", WebPDF.Event.DrawingAnnotToolHandler = function(a, b, c, d) {
            var e = null,
                f = !1,
                g = !1,
                h = !1,
                i = d;
            this.annotToolType = a;
            var b = (WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(), b);
            this.onInit = function(a) {
                e = a
            }, this.destroy = function() {}, this.getName = function() {
                return this.annotToolType
            }, this.onActivate = function() {
                f = !0, b.onActivate()
            }, this.onDeactivate = function() {
                f = !1, g = !1, b.onDeactivate(), i && i.resetDefault()
            }, this.isEnabled = function() {
                var a = e.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() !== WebPDF.Annot.DocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return f
            }, this.isDrawing = function() {
                return h || (i.getIsOnDraw ? i.getIsOnDraw() : !1)
            }, this.onLButtonDown = function(a) {
                if (f = !0, g = !0, h = !1, !i) return !1;
                if (b.containsJQDocView(a) === !1) return !1;
                var c = b.onLButtonInPage(a);
                return !c.pageView || c.pageView.isPageLoadLimit() ? !1 : c.pageView.isPageLoaded() ? (i.getUserColor(), i.onMouseDown(a, c.pageView), !1) : void 0
            }, this.onLButtonUp = function(a) {
                return f = !1, h = !1, g = !1, i ? i.onMouseUp(a) : !1
            }, this.createAnnot = function(a, b, c) {}, this.onLButtonDblClk = function(a) {
                return i ? b.containsJQDocView(a) === !1 ? !1 : (i.onLButtonDblClk(a), !1) : !1
            }, this.onMouseMove = function(a) {
                return null != i ? (g && (h = !0), i.onMouseMove(a)) : !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                if (!i) return !1;
                if (b.containsJQDocView(a) === !1) return !1;
                var c = b.onLButtonInPage(a);
                if (!c.pageView || c.pageView.isPageLoadLimit()) return !1;
                if (c.pageView.isPageLoaded()) return i.onRButtonUp(a, c.pageView), a.stopPropagation(), a.preventDefault(), !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return i ? (i.onMouseUp(a), !1) : !1
            }, this.onKeyDown = function(a) {
                return 16 == a.keyCode && i && i.setShiftFlag(!0), !1
            }, this.onKeyUp = function(a) {
                return 16 == a.keyCode && i && i.setShiftFlag(!1), !1
            }, this.onChar = function(a) {
                return !1
            }, this.getIsOnDraw = function() {
                return i.getIsOnDraw ? i.getIsOnDraw() : !1
            }
        }, b.createDrawingAnnotToolHandle = function(b) {
            var c = null,
                o = WebPDF.Common.getReaderApp();
            if (!o) return null;
            var p = o.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr();
            if (!p) return null;
            var q = WebPDF.AccountInstance.getUserConfig(),
                r = WebPDF.Annot.LineStyle;
            if (b == WebPDF.Tools.TOOL_NAME_DRAWING_CIRCLE) {
                var s = new i(p, o),
                    t = new l,
                    u = new d(p.getCavansElement(), q.annot.circle);
                c = new WebPDF.Event.DrawingAnnotToolHandler(b, s, t, u)
            } else if (b == WebPDF.Tools.TOOL_NAME_DRAWING_POLYGON || b == WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE || b == WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD) {
                var s = new j(p, o),
                    t = new l(b, o),
                    u = new h(p.getCavansElement(), q.annot.polygon);
                b == WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE ? u = new h(p.getCavansElement(), q.annot.polyline) : b == WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD && (u = new h(p.getCavansElement(), q.annot.cloud)), c = new WebPDF.Event.DrawingAnnotToolHandler(b, s, t, u)
            } else if (b == WebPDF.Tools.TOOL_NAME_DRAWING_SQUARE) {
                var s = new k(p, o),
                    t = new l(b, o),
                    u = new e(p.getCavansElement(), q.annot.square);
                c = new WebPDF.Event.DrawingAnnotToolHandler(b, s, t, u)
            } else if (b == WebPDF.Tools.TOOL_NAME_DRAWING_LINE) {
                var s = new m(p, o),
                    t = new l,
                    v = {
                        startStyle: r.None,
                        endStyle: r.None,
                        subj: i18n.t("Annot.AnnotSubjLine")
                    },
                    u = new f(p.getCavansElement(), q.annot.line, v);
                c = new WebPDF.Event.DrawingAnnotToolHandler(b, s, t, u)
            } else if (b === WebPDF.Tools.TOOL_NAME_DRAWING_DISTANCE) {
                var t = new l,
                    v = {
                        startStyle: r.OpenArrow,
                        endStyle: r.OpenArrow,
                        subj: i18n.t("Annot.AnnotSubjDistance"),
                        intent: "LineDimension"
                    },
                    u = new g(p.getCavansElement(), q.annot.distance, v),
                    s = new n(p, o),
                    w = a("core/Plugins/Annot/DistanceAnnot/DistanceAnnotToolHandler");
                c = new w(b, s, t, u)
            } else if (b == WebPDF.Tools.TOOL_NAME_DRAWING_LINEARROW) {
                var s = new m(p, o),
                    t = new l,
                    v = {
                        startStyle: r.None,
                        endStyle: r.OpenArrow,
                        intent: "LineArrow",
                        subj: i18n.t("Annot.AnnotSubjLineArrow")
                    },
                    u = new f(p.getCavansElement(), q.annot.lineArrow, v);
                c = new WebPDF.Event.DrawingAnnotToolHandler(b, s, t, u)
            }
            return c
        }
    }), define("core/Plugins/Annot/DrawingAnnot/CircleTools", ["core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect,
            f = WebPDF.RectUtils,
            g = (WebPDF.Annot.PDFAnnot, a("core/Common/CoordinateUtils")),
            h = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            i = function(a, b) {
                var c = !1,
                    i = WebPDF.Common.getReaderApp(),
                    j = b.borderWidth,
                    k = b.clr,
                    l = b.fillColor,
                    m = null,
                    n = new d(0, 0),
                    o = new d(0, 0),
                    p = new e,
                    q = null,
                    r = !1,
                    s = this,
                    t = 1,
                    u = 180,
                    v = 120,
                    w = null,
                    x = null;
                this.getColor = function() {
                    return k
                }, this.getUserColor = function() {
                    return j = b.borderWidth, k = b.clr, l = b.fillColor, m = k, k
                }, this.resetDefault = function() {
                    x && x.clearRect(0, 0, w.width, w.height), q = null, r = !1
                }, this.onMouseDown = function(a, b) {
                    var c = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    if (!c) return !1;
                    c.getAnnotHandlerMgr().getUIManager().resetCanvens(b), w = c.getAnnotHandlerMgr().getCavansElement(), x = w.getContext("2d"), q = b;
                    var d = $(w).offset();
                    return n.setPoint(a.pageX - d.left, a.pageY - d.top), o.setPoint(a.pageX - d.left, a.pageY - d.top), f.empty(p), r = !0, !0
                }, this.onMouseMove = function(a) {
                    if (!r) return !1;
                    var b = a.pageX,
                        d = a.pageY,
                        e = $("#" + q.getPageViewContainerID()).offset(),
                        i = $(w).offset(),
                        m = b - e.left,
                        s = d - e.top;
                    if (0 > m && (b = e.left), m > q.getPageViewWidth() && (b = e.left + q.getPageViewWidth()), 0 > s && (d = e.top), s > q.getPageViewHeight() && (d = e.top + q.getPageViewHeight()), o.x = b - i.left, o.y = d - i.top, x.clearRect(0, 0, w.width, w.height), o.x === n.x || o.y === n.y) return !0;
                    if (f.setRect(p, n.x, n.y, o.x, o.y), c) {
                        var t = p.right - p.left,
                            u = p.bottom - p.top,
                            v = Math.abs(t) < Math.abs(u) ? Math.abs(t) : Math.abs(u);
                        0 != t && (p.right = p.left + v * t / Math.abs(t)), 0 != u && (p.bottom = p.top + v * u / Math.abs(u))
                    }
                    f.normalizeEx(p);
                    var y = g.pageRectToCanvansRect(q, w, p, q.getDocView().getRotate()),
                        z = {
                            borderColor: k,
                            borderWidth: j * q.getScale(),
                            fillColor: l
                        };
                    return h.drawCircle(x, y.left, y.top, y.right, y.bottom, z), !0
                }, this.CreateAnnot = function() {
                    var a = $(w).offset(),
                        b = $("#" + q.getPageViewContainerID()).offset(),
                        c = 1.5,
                        d = 1.5,
                        e = p.left - (b.left - a.left),
                        g = f.width(p),
                        h = p.top - (b.top - a.top),
                        k = f.height(p),
                        n = new Date,
                        o = n.valueOf(),
                        r = Math.floor(o / 1e3).toString(),
                        s = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                        x = {
                            c: "",
                            ca: t,
                            cd: r,
                            cl: m,
                            fcl: l,
                            bw: j,
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: r,
                            n: null,
                            pop: null,
                            subj: i18n.t("Annot.AnnotSubjOval"),
                            subty: "Circle",
                            tit: s,
                            ty: "Markup",
                            rc: null,
                            pdf: "false",
                            del: 0
                        },
                        y = q.getPDFPage(),
                        z = (y.getPageWidth(), y.getPageHeight(), new WebPDF.PDFRect(e, h, e + g, h + k)),
                        A = q.deviceRectToPDF(z, !0);
                    x.rc = [A.left - c, A.top + d, A.right + c, A.bottom - d];
                    var B = new WebPDF.PDFRect(0, 0, 0, 0);
                    B.top = A.top;
                    var C = q.getDocView().getPageViewRender().getPixelsPerPoint(),
                        D = q.getScale();
                    B.left = (q.getPageViewWidth() - u * C) / (D * C), B.right = B.left + u, B.bottom = B.top - v, B.bottom < 0 && f.offset(B, 0, -B.bottom), x.pop = {
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: r,
                        n: r + "_popup",
                        op: 0,
                        rc: [B.left, B.top, B.right, B.bottom]
                    };
                    var E = WebPDF.Annot.AnnotFactory.createAnnot(x, y.getPageIndex(), !1);
                    y.getAnnotJsonData().push(x), y.addAnnot(E), q.setModified(!0);
                    var F = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                        G = F.getUIManager().getPageAnnotsContainerID(q),
                        H = $("#" + G),
                        I = E.getAnnotName(),
                        J = F.getUIManager().createAAnnotHtmlContent(q, E, I, 1, !1);
                    H.append(J), F.showDrawingAnnot(q, E, !1), q.getDocView().setModified(!0);
                    var K = [];
                    K.push(E.annotJSONData);
                    var L = new WebPDF.Annot.Undo(q.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, K);
                    i.addAnnotUndo(L), $(i).trigger(WebPDF.EventList.ANNOT_ADDED, {
                        pageIndex: y.getPageIndex(),
                        annot: F.packageAnnot(E),
                        annotObject: E
                    });
                    var M = "[" + E.getRect().left + " " + E.getRect().top + " " + E.getRect().right + " " + E.getRect().bottom + "]",
                        N = '{"Type":"' + E.getSubType() + '", "ActionType":"Add", "PageIndex":"' + y.getPageIndex() + '", "Rect":"' + M + '"}';
                    return i.addRecord("Comment", "Comment", N), F.clearSelection(), $(i).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                        annotName: E.getAnnotName(),
                        pageIndex: y.getPageIndex()
                    }), F.setFocusAnnot(q, E), F.addSelection(E), E
                }, this.onMouseUp = function(a) {
                    var b = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    return r ? o.x === n.x || o.y === n.y ? (r = !1, b && b.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0) : (s.CreateAnnot(), x.closePath(), x.clearRect(0, 0, w.width, w.height), r = !1, b && b.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0) : !0
                }, this.onRButtonUp = function(a) {
                    return !1
                }, this.setShiftFlag = function(a) {
                    c = a
                }
            };
        return i
    }), define("core/Plugins/Annot/DrawingAnnot/SquareTools", ["core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect,
            f = WebPDF.RectUtils,
            g = (WebPDF.Annot.PDFAnnot, a("core/Common/CoordinateUtils")),
            h = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            i = function(a, b) {
                var c = !1,
                    i = WebPDF.Common.getReaderApp(),
                    j = b.borderWidth,
                    k = b.clr,
                    l = b.fillColor,
                    m = null,
                    n = new d(0, 0),
                    o = new d(0, 0),
                    p = new e,
                    q = null,
                    r = !1,
                    s = this,
                    t = 1,
                    u = 180,
                    v = 120,
                    w = null,
                    x = null;
                this.getColor = function() {
                    return k
                }, this.getUserColor = function() {
                    return j = b.borderWidth, k = b.clr, m = k, l = b.fillColor, k
                }, this.resetDefault = function() {
                    x && x.clearRect(0, 0, w.width, w.height), q = null, r = !1
                }, this.onMouseDown = function(a, b) {
                    var c = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    if (!c) return !1;
                    c.getAnnotHandlerMgr().getUIManager().resetCanvens(b), w = c.getAnnotHandlerMgr().getCavansElement(), x = w.getContext("2d"), q = b;
                    var d = $(w).offset();
                    return n.setPoint(a.pageX - d.left, a.pageY - d.top), o.setPoint(a.pageX - d.left, a.pageY - d.top), f.empty(p), r = !0, !0
                }, this.onMouseMove = function(a) {
                    if (!r) return !1;
                    var b = a.pageX,
                        d = a.pageY,
                        e = $("#" + q.getPageViewContainerID()).offset(),
                        i = $(w).offset(),
                        m = b - e.left,
                        s = d - e.top;
                    if (0 > m && (b = e.left), m > q.getPageViewWidth() && (b = e.left + q.getPageViewWidth()), 0 > s && (d = e.top), s > q.getPageViewHeight() && (d = e.top + q.getPageViewHeight()), o.x = b - i.left, o.y = d - i.top, x.clearRect(0, 0, w.width, w.height), o.x === n.x || o.y === n.y) return !0;
                    if (f.setRect(p, n.x, n.y, o.x, o.y), c) {
                        var t = p.right - p.left,
                            u = p.bottom - p.top,
                            v = Math.abs(t) < Math.abs(u) ? Math.abs(t) : Math.abs(u);
                        0 != t && (p.right = p.left + v * t / Math.abs(t)), 0 != u && (p.bottom = p.top + v * u / Math.abs(u))
                    }
                    f.normalizeEx(p);
                    var y = g.pageRectToCanvansRect(q, w, p, q.getDocView().getRotate()),
                        z = j * q.getScale();
                    z = parseInt(2 > z ? 2 : z);
                    var A = {
                        borderColor: k,
                        borderWidth: z,
                        fillColor: l
                    };
                    return h.drawSquare(x, y.left, y.top, y.right, y.bottom, A), !0
                }, this.CreateAnnot = function() {
                    var a = $(w).offset(),
                        b = $("#" + q.getPageViewContainerID()).offset(),
                        c = 1.5,
                        d = 1.5,
                        e = p.left - (b.left - a.left),
                        g = f.width(p),
                        h = p.top - (b.top - a.top),
                        k = f.height(p),
                        n = new Date,
                        o = n.valueOf(),
                        r = Math.floor(o / 1e3).toString(),
                        s = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                        x = {
                            c: "",
                            ca: t,
                            cd: r,
                            cl: m,
                            fcl: l,
                            bw: j,
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: r,
                            n: null,
                            pop: null,
                            subj: i18n.t("Annot.AnnotSubjRectangle"),
                            subty: "Square",
                            tit: s,
                            ty: "Markup",
                            rc: null,
                            pdf: "false",
                            del: 0
                        },
                        y = q.getPDFPage(),
                        z = (y.getPageWidth(), y.getPageHeight(), new WebPDF.PDFRect(e, h, e + g, h + k)),
                        A = q.deviceRectToPDF(z, !0);
                    x.rc = [A.left - c, A.top + d, A.right + c, A.bottom - d];
                    var B = new WebPDF.PDFRect(0, 0, 0, 0);
                    B.top = A.top;
                    var C = q.getDocView().getPageViewRender().getPixelsPerPoint(),
                        D = q.getScale();
                    B.left = (q.getPageViewWidth() - u * C) / (D * C), B.right = B.left + u, B.bottom = B.top - v, B.bottom < 0 && f.offset(B, 0, -B.bottom), x.pop = {
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: r,
                        n: r + "_popup",
                        op: 0,
                        rc: [B.left, B.top, B.right, B.bottom]
                    };
                    var E = WebPDF.Annot.AnnotFactory.createAnnot(x, y.getPageIndex(), !1);
                    y.getAnnotJsonData().push(x), y.addAnnot(E), q.setModified(!0);
                    var F = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                        G = F.getUIManager().getPageAnnotsContainerID(q),
                        H = $("#" + G),
                        I = E.getAnnotName(),
                        J = F.getUIManager().createAAnnotHtmlContent(q, E, I, 1, !1);
                    H.append(J), F.showDrawingAnnot(q, E, !1), q.getDocView().setModified(!0);
                    var K = [];
                    K.push(E.annotJSONData);
                    var L = new WebPDF.Annot.Undo(q.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, K);
                    i.addAnnotUndo(L), $(i).trigger(WebPDF.EventList.ANNOT_ADDED, {
                        pageIndex: y.getPageIndex(),
                        annot: F.packageAnnot(E),
                        annotObject: E
                    });
                    var M = "[" + E.getRect().left + " " + E.getRect().top + " " + E.getRect().right + " " + E.getRect().bottom + "]",
                        N = '{"Type":"' + E.getSubType() + '", "ActionType":"Add", "PageIndex":"' + y.getPageIndex() + '", "Rect":"' + M + '"}';
                    return i.addRecord("Comment", "Comment", N), F.clearSelection(), $(i).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                        annotName: E.getAnnotName(),
                        pageIndex: y.getPageIndex()
                    }), F.setFocusAnnot(q, E), F.addSelection(E), E
                }, this.onLButtonDblClk = function(a) {}, this.onMouseUp = function(a) {
                    var b = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    return r ? o.x === n.x || o.y === n.y ? (r = !1, b && b.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0) : (s.CreateAnnot(), x.closePath(), x.clearRect(0, 0, w.width, w.height), r = !1, b && b.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0) : !0
                }, this.onRButtonUp = function(a) {
                    return !1
                }, this.setShiftFlag = function(a) {
                    c = a
                }
            };
        return i
    }), define("core/Plugins/Annot/DrawingAnnot/LineTools", ["core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DistanceAnnot/units"], function(a, b, c) {
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect,
            f = WebPDF.RectUtils,
            g = (WebPDF.Annot.PDFAnnot, a("core/Common/CoordinateUtils")),
            h = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            i = a("core/Plugins/Annot/DistanceAnnot/DistanceScale"),
            j = (WebPDF.Annot.AnnotDataJSONFormat, WebPDF.Annot.LineStyle),
            k = function(a, b, c) {
                var k = !1,
                    l = WebPDF.Common.getReaderApp(),
                    m = b.borderWidth,
                    n = b.clr,
                    o = b.cap,
                    p = null,
                    q = new d(0, 0),
                    r = new d(0, 0),
                    s = new e,
                    t = null,
                    u = !1,
                    v = this,
                    w = 1,
                    x = 180,
                    y = 120,
                    z = null,
                    A = null;
                this.getColor = function() {
                    return n
                }, this.getUserColor = function() {
                    return n = b.clr, m = b.borderWidth, o = b.cap, p = n, n
                }, this.resetDefault = function() {
                    A && A.clearRect(0, 0, z.width, z.height), t = null, u = !1
                }, this.onMouseDown = function(a, b) {
                    var c = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    if (!c) return !1;
                    c.getAnnotHandlerMgr().getUIManager().resetCanvens(b), z = c.getAnnotHandlerMgr().getCavansElement(), A = z.getContext("2d"), t = b;
                    var d = $(z).offset();
                    return q.setPoint(a.pageX - d.left, a.pageY - d.top), r.setPoint(a.pageX - d.left, a.pageY - d.top), f.empty(s), u = !0, !0
                }, this.onMouseMove = function(a) {
                    return u ? (this.drawOnMoving(a), !0) : !1
                }, this.drawOnMoving = function(a) {
                    var b = a.pageX,
                        d = a.pageY,
                        e = $("#" + t.getPageViewContainerID()).offset(),
                        i = $(z).offset(),
                        k = b - e.left,
                        l = d - e.top;
                    if (0 > k && (b = e.left), k > t.getPageViewWidth() && (b = e.left + t.getPageViewWidth()), 0 > l && (d = e.top), l > t.getPageViewHeight() && (d = e.top + t.getPageViewHeight()), r.x = b - i.left, r.y = d - i.top, A.clearRect(0, 0, z.width, z.height), r.equal(q)) return !1;
                    f.setRect(s, q.x, q.y, r.x, r.y), f.normalizeEx(s);
                    var o = g.pagePointToCanvansPoint(t, z, q, t.getDocView().getRotate()),
                        p = g.pagePointToCanvansPoint(t, z, r, t.getDocView().getRotate()),
                        u = {
                            borderColor: n,
                            borderWidth: m * t.getScale(),
                            startStyle: c ? c.startStyle : j.None,
                            endStyle: c ? c.endStyle : j.None,
                            arrowLength: 14 * t.getScale()
                        };
                    h.drawLineArrow(A, o.x, o.y, p.x, p.y, u)
                }, this.CreateAnnot = function() {
                    var a = $(z).offset(),
                        b = $("#" + t.getPageViewContainerID()).offset(),
                        e = {
                            x: b.left - a.left,
                            y: b.top - a.top
                        },
                        g = 1.5,
                        h = 1.5,
                        k = s.left - e.x,
                        n = f.width(s),
                        u = s.top - e.y,
                        v = f.height(s),
                        A = t.devicePtToPDF(new d(q.x - e.x, q.y - e.y)),
                        B = t.devicePtToPDF(new d(r.x - e.x, r.y - e.y)),
                        C = [A.x, A.y, B.x, B.y],
                        D = new Date,
                        E = D.valueOf(),
                        F = Math.floor(E / 1e3).toString(),
                        G = c ? c.startStyle : j.None,
                        H = c ? c.endStyle : j.None,
                        I = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                        J = {
                            c: "",
                            ca: w,
                            cd: F,
                            cl: p,
                            bw: m,
                            l: C,
                            le: [G, H],
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: F,
                            n: null,
                            pop: null,
                            subj: c.subj,
                            subty: "Line",
                            tit: I,
                            ty: "Markup",
                            rc: null,
                            pdf: "false",
                            del: 0,
                            cap: o
                        };
                    c.intent && (J.it = c.intent), "LineDimension" === c.intent && (J.measure = i.measureForAnnot());
                    var K = t.getPDFPage(),
                        L = new WebPDF.PDFRect(k, u, k + n, u + v),
                        M = t.deviceRectToPDF(L, !0);
                    J.rc = [M.left - g, M.top + h, M.right + g, M.bottom - h];
                    var N = new WebPDF.PDFRect(0, 0, 0, 0);
                    N.top = M.top;
                    var O = t.getDocView().getPageViewRender().getPixelsPerPoint(),
                        P = t.getScale();
                    N.left = (t.getPageViewWidth() - x * O) / (P * O), N.right = N.left + x, N.bottom = N.top - y, N.bottom < 0 && f.offset(N, 0, -N.bottom), J.pop = {
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: F,
                        n: F + "_popup",
                        op: 0,
                        rc: [N.left, N.top, N.right, N.bottom]
                    };
                    var Q = WebPDF.Annot.AnnotFactory.createAnnot(J, K.getPageIndex(), !1);
                    K.getAnnotJsonData().push(J), K.addAnnot(Q), t.setModified(!0);
                    var R = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                        S = R.getUIManager().getPageAnnotsContainerID(t),
                        T = $("#" + S),
                        U = Q.getAnnotName(),
                        V = R.getUIManager().createAAnnotHtmlContent(t, Q, U, 1, !1);
                    T.append(V), this.showDrawingAnnot(t, Q, !1), t.getDocView().setModified(!0);
                    var W = [];
                    W.push(Q.annotJSONData);
                    var X = new WebPDF.Annot.Undo(t.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, W);
                    l.addAnnotUndo(X), $(l).trigger(WebPDF.EventList.ANNOT_ADDED, {
                        pageIndex: K.getPageIndex(),
                        annot: R.packageAnnot(Q),
                        annotObject: Q
                    });
                    var Y = "[" + Q.getRect().left + " " + Q.getRect().top + " " + Q.getRect().right + " " + Q.getRect().bottom + "]",
                        Z = '{"Type":"' + Q.getSubType() + '", "ActionType":"Add", "PageIndex":"' + K.getPageIndex() + '", "Rect":"' + Y + '"}';
                    return l.addRecord("Comment", "Comment", Z), R.clearSelection(), $(l).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                        annotName: Q.getAnnotName(),
                        pageIndex: K.getPageIndex()
                    }), R.setFocusAnnot(t, Q), R.addSelection(Q), Q
                }, this.onMouseUp = function(a) {
                    var b = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    return u ? r.equal(q) ? (u = !1, b && b.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0) : (v.CreateAnnot(), A.closePath(), A.clearRect(0, 0, z.width, z.height), u = !1, b && b.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0) : !0
                }, this.onLButtonDblClk = function() {
                    return !1
                }, this.onRButtonUp = function(a) {
                    return !1
                }, this.setShiftFlag = function(a) {
                    k = a
                }, this.getCurEndPoint = function() {
                    return r
                }, this.getCurStartPoint = function() {
                    return q
                }, this._setCurStartPoint = function(a) {
                    q = a
                }, this.showDrawingAnnot = function(a, b, d, e, f) {
                    var g = 1,
                        i = 1;
                    f && (g = f, i = f);
                    var k = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                        l = k.getAnnotCavansDivID(a, b.getAnnotName()),
                        m = document.getElementById(l);
                    if (null == m || d || $.support.canvas || (uuClass.Canvas.InitCavansElement(m), m = document.getElementById(l)), !m && e && (m = e), null != m) {
                        var n = m.getContext("2d");
                        null != n._clear ? n._clear() : n.clearRect(0, 0, m.width, m.height);
                        var o = b.getRect(),
                            p = a.pdfRectToDevice(o, !0),
                            q = a.pdfPtToDevice(b.getStartPoint()),
                            r = a.pdfPtToDevice(b.getEndPoint()),
                            s = {
                                borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                                borderWidth: b.getBorderWidth() * a.getScale() * g,
                                startStyle: c ? c.startStyle : j.None,
                                endStyle: c ? c.endStyle : j.None,
                                arrowLength: a.getScale() * g * 14
                            },
                            t = h.adjust(a, b, g);
                        h.drawLineArrow(n, q.x - p.left + t, q.y - p.top + t, r.x - p.left + t, r.y - p.top + t, s)
                    }
                }
            };
        return k
    }), define("core/Plugins/Annot/DistanceAnnot/DistanceLineTool", ["core/Plugins/Annot/DrawingAnnot/LineTools", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/DistanceAnnot/DistanceScale", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/common"], function(a) {
        function b(a, b, i) {
            function j(b, c) {
                if (z) {
                    l();
                    var e = (360 - c.oldRotate) % 360,
                        f = (360 - c.newRotate) % 360,
                        g = (f - e) / 180 * Math.PI,
                        h = Math.sqrt(Math.pow(p.x, 2) + Math.pow(p.y, 2)),
                        i = Math.atan2(p.y, p.x),
                        j = i + g,
                        k = new d(h * Math.cos(j), h * Math.sin(j)),
                        m = o.getPageViewRect(),
                        q = new d((m.right + m.left) / 2, (m.bottom + m.top) / 2),
                        r = new d(q.x + k.x, q.y - k.y);
                    p = k;
                    var s = $(a).offset(),
                        t = new d(r.x - s.left, r.y - s.top);
                    n._setCurStartPoint(t)
                }
            }

            function k() {
                if (z) {
                    l();
                    var b = o.getScale();
                    if (b !== q) {
                        var c = o.getPageViewRect(),
                            e = new d((c.right + c.left) / 2, (c.bottom + c.top) / 2),
                            f = b / q,
                            g = new d(p.x * f, p.y * f),
                            h = new d(e.x + g.x, e.y - g.y),
                            i = $(a).offset(),
                            j = new d(h.x - i.left, h.y - i.top);
                        p = g, n._setCurStartPoint(j), q = b, $(window).trigger("mousemove")
                    }
                }
            }

            function l() {
                var b = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                b && (b.getAnnotHandlerMgr().getUIManager().resetCanvens(o), a = b.getAnnotHandlerMgr().getCavansElement(), y = a.getContext("2d"))
            }

            function m() {
                var a = '<div class="fwr-distance-context-menu-container"><ul id="distanceDrawingMenu" style="display:none" class="fwrContextMenu fwr-cm-default"><li id="distance_complete">' + i18n.t("Distance.ContextMenu.Complete") + '</li><li id="distance_cancel">' + i18n.t("Distance.ContextMenu.Cancel") + "</li></ul></div>";
                r = $(a), $("body").append(r), $("#distance_complete").off("click").on("click", function(a) {
                    return $(this).hasClass("complete-disabled") ? !1 : (n.onMouseDown(a, o), n.resetDefault(), !1)
                }), $("#distance_cancel").off("click").on("click", function() {
                    return n.resetDefault(), !1
                })
            }
            var n = this;
            c.apply(n, arguments);
            var o, p, q, r, s, t = n.onMouseDown,
                u = n.onMouseUp,
                v = n.CreateAnnot,
                w = n.drawOnMoving,
                x = n.resetDefault,
                y = null,
                z = !1,
                A = !1,
                B = WebPDF.Common.getReaderApp();
            this.activate = function() {
                $(B).on(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, j), $(B).on(WebPDF.EventList.DOCVIEW_RESIZE, k)
            }, this.deactivate = function() {
                $(B).off(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, j), $(B).off(WebPDF.EventList.DOCVIEW_RESIZE, k)
            }, this.getIsOnDraw = function() {
                return z
            }, this.resetDefault = function() {
                if (x.apply(this, arguments), s) {
                    var a = $("#" + s.getPageViewContainerID()),
                        b = $("#" + B.getMainView().getMainFrameID()).get(0);
                    a.fwrContextMenu("distanceDrawingMenu", {}, b).nofwrContextMenu()
                }
                s = null, z = !1, o = null
            }, this.onMouseDown = function(b, c) {
                function e() {
                    var e = t.call(n, b, c),
                        f = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    f && (f.getAnnotHandlerMgr().getUIManager().resetCanvens(c), a = f.getAnnotHandlerMgr().getCavansElement(), y = a.getContext("2d"));
                    var g = c.getPageViewRect(),
                        h = new d(b.pageX, b.pageY),
                        i = new d((g.right + g.left) / 2, (g.bottom + g.top) / 2);
                    return p = new d(h.x - i.x, i.y - h.y), q = o.getScale(), e
                }
                if (A = !1, z && o && c !== o) return o = c, e();
                if (o = c, z) {
                    u.call(n, b, c), z = !1;
                    var f = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    return f && f.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0
                }
                return z = !0, e()
            }, this.onMouseMove = function(a) {
                return z ? A ? !0 : (this.drawOnMoving(a), !0) : !1
            }, this.drawOnMoving = function() {
                w.apply(this, arguments);
                var b = WebPDF.AccountInstance.getUserConfig(),
                    c = b.annot.distance;
                if (c.cap) {
                    var d = this.getCurStartPoint(),
                        f = this.getCurEndPoint(),
                        g = o.getDocView().getRotate(),
                        i = h.pagePointToCanvansPoint(o, a, d, g),
                        j = h.pagePointToCanvansPoint(o, a, f, g);
                    e.drawDistanceText(null, y, i, j, g, o.getScale())
                }
            }, this.onMouseUp = function() {
                return !1
            }, this.CreateAnnot = function() {
                var a = v.apply(n, arguments),
                    b = WebPDF.Tool.getReaderApp(),
                    c = b.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                    d = a.getAnnotName(),
                    f = o.pdfPtToDevice(a.getStartPoint()),
                    h = o.pdfPtToDevice(a.getEndPoint()),
                    i = g.distanceOf(f, h, o.getScale()),
                    j = o.getPageIndex(),
                    k = e.normalizeContent(a.getContents(), i.distance, i.unit);
                c.updateAnnotContent(j, d, k, !1);
                var l = {
                    annot: c.packageAnnot(a),
                    pageIndex: j,
                    annotObject: a
                };
                $(b).trigger(WebPDF.EventList.ANNOT_UPDATED, l)
            }, this.onRButtonUp = function(a, b) {
                var c = $("#" + b.getPageViewContainerID()),
                    d = $("#" + B.getMainView().getMainFrameID()).get(0);
                return b && z ? (s = b, A = !0, r || m(), r.css({
                    left: a.pageX,
                    top: a.pageY,
                    display: "block"
                }), c.fwrContextMenu("distanceDrawingMenu", {}, d), a.stopPropagation(), a.preventDefault(), !1) : (c.fwrContextMenu("distanceDrawingMenu", {}, d).nofwrContextMenu(), !1)
            }, this.showDrawingAnnot = function(a, b, c, g, h) {
                var j = WebPDF.Annot.LineStyle,
                    k = 1,
                    l = 1;
                h && (k = h, l = h);
                var m = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                    n = m.getAnnotCavansDivID(a, b.getAnnotName()),
                    o = document.getElementById(n);
                if (null == o || c || $.support.canvas || (uuClass.Canvas.InitCavansElement(o), o = document.getElementById(n)), !o && g && (o = g), null != o) {
                    var p = o.getContext("2d");
                    null != p._clear ? p._clear() : p.clearRect(0, 0, o.width, o.height);
                    var q = b.getRect(),
                        r = a.pdfRectToDevice(q, !0),
                        s = a.pdfPtToDevice(b.getStartPoint()),
                        t = a.pdfPtToDevice(b.getEndPoint()),
                        u = {
                            borderColor: WebPDF.Common.hexColor2Rgba(b.getColor(), 1),
                            borderWidth: b.getBorderWidth() * a.getScale() * k,
                            startStyle: i ? i.startStyle : j.None,
                            endStyle: i ? i.endStyle : j.None,
                            arrowLength: a.getScale() * k * 14
                        },
                        v = f.adjust(a, b, k),
                        w = new d(s.x - r.left + v, s.y - r.top + v),
                        x = new d(t.x - r.left + v, t.y - r.top + v);
                    if (f.drawLineArrow(p, w.x, w.y, x.x, x.y, u), b.showCaption()) {
                        var y = a.getDocView().getRotate();
                        e.drawDistanceText(b, p, w, x, y, a.getScale() * k)
                    }
                }
            }
        }
        var c = a("core/Plugins/Annot/DrawingAnnot/LineTools"),
            d = WebPDF.PDFPoint,
            e = a("core/Plugins/Annot/DistanceAnnot/common"),
            f = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils"),
            g = a("core/Plugins/Annot/DistanceAnnot/DistanceScale"),
            h = a("core/Common/CoordinateUtils");
        return b.prototype = c.prototype, b
    }), define("core/Plugins/Annot/DrawingAnnot/PolygonTools", ["core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/DrawingAnnot/PolygonAnnotService", "core/Common/Math/Point", "core/WebPDF", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"], function(a, b, c) {
        var d = WebPDF.PDFPoint,
            e = (WebPDF.PDFRect, WebPDF.RectUtils),
            f = (WebPDF.Annot.PDFAnnot, a("core/Common/CoordinateUtils"), a("core/Plugins/Annot/DrawingAnnot/DrawingUtils")),
            g = a("core/Plugins/Annot/DrawingAnnot/PolygonAnnotService"),
            h = function(a, b) {
                function c() {
                    r && r.fwrContextMenu("polyDrawingMenu", {}, document.getElementById(u.getMainView().getMainFrameID())).nofwrContextMenu()
                }

                function h(a, b, c) {
                    for (var d = !1, e = 0; e < c.length; e++)
                        if (a === c[e][0] && b === c[e][1]) {
                            d = !0;
                            break
                        }
                    return d
                }

                function i(a) {
                    return F.length < L ? !1 : (a.CreateAnnot(F),
                        void a.resetDefault())
                }

                function j(a) {
                    if (!$(".fwr-polyannots-context-menu-container").get(0)) {
                        var b = '<div class="fwr-polyannots-context-menu-container"><ul id="polyDrawingMenu" style="display:none;top:' + a.pageY + "px;left:" + a.pageX + 'px" class="fwrContextMenu fwr-cm-default"><li id="poly_complete">' + i18n.t("PolygonRightMenu.complete") + '</li><li id="poly_cancel">' + i18n.t("PolygonRightMenu.cancel") + "</li></ul></div>";
                        $("body").append(b), q = $(".fwr-polyannots-context-menu-container ul"), $(document).off("click.polygonMenu").on("click.polygonMenu", function() {
                            q.hide()
                        })
                    }
                    F.length < L - 1 || s && F.length == L - 1 ? $("#poly_complete").addClass("complete-disabled") : $("#poly_complete").removeClass("complete-disabled")
                }

                function k(a) {
                    $("#poly_complete").off("click").on("click", function() {
                        return $(this).hasClass("complete-disabled") ? !1 : (o && p && (h(o, p, G) || (G.push([o, p]), F.push([B.x, B.y])), m = o, n = p), i(a), O = !1, !1)
                    }), $("#poly_cancel").off("click").on("click", function() {
                        return a.resetDefault(), O = !1, !1
                    })
                }
                var l, m, n, o, p, q, r, s, t = !1,
                    u = WebPDF.Common.getReaderApp(),
                    v = b.borderWidth,
                    w = b.clr,
                    x = b.fillColor,
                    y = b.opacity || 1,
                    z = null,
                    A = new d(0, 0),
                    B = new d(0, 0),
                    C = null,
                    D = this,
                    E = new g,
                    F = [],
                    G = [],
                    H = !1,
                    I = 1,
                    J = 180,
                    K = 120,
                    L = 3,
                    M = null,
                    N = null,
                    O = !1;
                $(u).on(WebPDF.EventList.DOCVIEW_PAGE_CHANGED, function(a, b) {
                    D.resetDefault()
                }), $(u).on(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, function(a, b) {
                    D.resetDefault()
                }), $(u).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function(a, b) {
                    D.resetDefault()
                }), this.getColor = function() {
                    return w
                }, this.getUserColor = function() {
                    return v = b.borderWidth, w = b.clr, x = b.fillColor, y = b.opacity || 1, z = w, w
                }, this.onMouseDown = function(a, b) {
                    var c = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                    if (!c) return !1;
                    if (l !== b.getPageIndex() && this.resetDefault(), s = !0, !H) {
                        l = b.getPageIndex(), c.getAnnotHandlerMgr().getUIManager().resetCanvens(b), M = c.getAnnotHandlerMgr().getCavansElement(), N = M.getContext("2d"), C = b;
                        var d = $(M).offset();
                        A.setPoint(a.pageX - d.left, a.pageY - d.top), B.setPoint(a.pageX - d.left, a.pageY - d.top), H = !0;
                        var e = f.deviceRotate(new WebPDF.PDFPoint(A.x, A.y), C.getDocView().getRotate(), M, C);
                        m = e.x, n = e.y, F.push([A.x, A.y]), G.push([m, n]), O = !0, j(a), r = $("#" + b.getPageViewContainerID()), r.fwrContextMenu("polyDrawingMenu", {}, document.getElementById(u.getMainView().getMainFrameID()))
                    }
                    return o && p && (h(o, p, G) || (G.push([o, p]), F.push([B.x, B.y]), j(a), r = $("#" + b.getPageViewContainerID()), r.fwrContextMenu("polyDrawingMenu", {}, document.getElementById(u.getMainView().getMainFrameID()))), m = o, n = p), !0
                }, this.onMouseMove = function(a) {
                    if (!C) return !1;
                    if (H) {
                        var b = a.pageX,
                            c = a.pageY,
                            d = $("#" + C.getPageViewContainerID()).offset(),
                            e = $(M).offset(),
                            g = b - d.left,
                            h = c - d.top;
                        if (0 > g && (b = d.left), g > C.getPageViewWidth() && (b = d.left + C.getPageViewWidth()), 0 > h && (c = d.top), h > C.getPageViewHeight() && (c = d.top + C.getPageViewHeight()), B.x = b - e.left, B.y = c - e.top, B.x === A.x || B.y === A.y) return !0;
                        if (2 == G.length && B.x === G[G.length - 1][0] && B.y === G[G.length - 1][1]) return !0;
                        var i = {
                                borderColor: w,
                                borderWidth: v * C.getScale(),
                                fillColor: x,
                                opacity: y
                            },
                            j = f.deviceRotate(new WebPDF.PDFPoint(B.x, B.y), C.getDocView().getRotate(), M, C);
                        N.clearRect(0, 0, M.width, M.height);
                        var k = WebPDF.ViewerInstance.getCurToolHandlerName();
                        if (k == WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD) {
                            var l = [];
                            l.push([j.x, j.y]);
                            for (var q = G.length - 1; q >= 0; q--) l.push([G[q][0], G[q][1]]);
                            var r = E.getCloudPoints(C, l, !1);
                            r && f.drawPolygonListCloud(r.csAp, N, i)
                        } else f.drawPolygonListLine(G, N, i), f.drawLine(N, m, n, j.x, j.y, i);
                        o = j.x, p = j.y, s = !1
                    }
                    return !0
                }, this.CreateAnnot = function(a) {
                    for (var b = $(M).offset(), c = $("#" + C.getPageViewContainerID()).offset(), d = 0; d < a.length; d++) {
                        var g = a[d];
                        g[0] = g[0] - (c.left - b.left), g[1] = g[1] - (c.top - b.top)
                    }
                    var h, i = E.polygonDeviceVtsToPdf(C, a);
                    if (u.getCurToolHandler().getName() === WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD) {
                        for (var j = [], d = 0; d < i.length; d += 2) j.push([i[d], i[d + 1]]);
                        var k = E.getCloudPoints(C, j, !1, !1),
                            l = k.pdfRect;
                        h = [l.left, l.bottom, l.right, l.top]
                    } else E.addLimitInPage(C, a), h = f.getRectPolygonList(a, C);
                    var m = h[2] - h[0],
                        n = h[3] - h[1],
                        o = h[0],
                        p = h[1],
                        q = i18n.t("Annot.AnnotSubjPolygon"),
                        r = "Polygon";
                    u.getCurToolHandler().getName() === WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE && (q = i18n.t("Annot.AnnotSubjPolyline"), r = "PolyLine"), u.getCurToolHandler().getName() === WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD && (q = i18n.t("Annot.AnnotSubjCloud"), r = "Polygon");
                    var s = new Date,
                        t = s.valueOf(),
                        w = Math.floor(t / 1e3).toString(),
                        A = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                        B = {
                            c: "",
                            ca: y || I,
                            cd: w,
                            cl: z,
                            fcl: x,
                            bw: v,
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: w,
                            n: null,
                            pop: null,
                            subj: q,
                            subty: r,
                            tit: A,
                            ty: "Markup",
                            rc: null,
                            vts: i,
                            pdf: "false",
                            del: 0
                        };
                    u.getCurToolHandler().getName() === WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD && (B.it = "PolygonCloud", x && (B.fcl = x));
                    var D = C.getPDFPage(),
                        F = new WebPDF.PDFRect(o, p, o + m, p + n),
                        G = C.deviceRectToPDF(F, !0),
                        H = 2.25;
                    u.getCurToolHandler().getName() === WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE && (H = 4.5), B.rc = [G.left - H, G.top + H, G.right + H, G.bottom - H], u.getCurToolHandler().getName() === WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD && (H = 0, B.rc = [F.left - H, F.top + H, F.right + H, F.bottom - H]);
                    var L = new WebPDF.PDFRect(0, 0, 0, 0);
                    L.top = G.top;
                    var N = C.getDocView().getPageViewRender().getPixelsPerPoint(),
                        O = C.getDocView().getScale();
                    L.left = (C.getPageViewWidth() - J * N) / (O * N), L.right = L.left + J, L.bottom = L.top - K, L.bottom < 0 && e.offset(L, 0, -L.bottom), B.pop = {
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: w,
                        n: w + "_popup",
                        op: 0,
                        rc: [L.left, L.top, L.right, L.bottom]
                    };
                    var P = WebPDF.Annot.AnnotFactory.createAnnot(B, D.getPageIndex(), !1);
                    D.getAnnotJsonData().push(B), D.addAnnot(P), C.setModified(!0);
                    var Q = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                        R = Q.getUIManager().getPageAnnotsContainerID(C),
                        S = $("#" + R),
                        T = P.getAnnotName(),
                        U = Q.getUIManager().createAAnnotHtmlContent(C, P, T, 1, !1);
                    S.append(U), Q.showDrawingPolygonAnnot(C, P, !1), C.getDocView().setModified(!0);
                    var V = [];
                    V.push(P.annotJSONData);
                    var W = new WebPDF.Annot.Undo(C.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, V);
                    u.addAnnotUndo(W), $(u).trigger(WebPDF.EventList.ANNOT_ADDED, {
                        pageIndex: D.getPageIndex(),
                        annot: Q.packageAnnot(P),
                        annotObject: P
                    });
                    var X = "[" + P.getRect().left + " " + P.getRect().top + " " + P.getRect().right + " " + P.getRect().bottom + "]",
                        Y = '{"Type":"' + P.getSubType() + '", "ActionType":"Add", "PageIndex":"' + D.getPageIndex() + '", "Rect":"' + X + '"}';
                    return u.addRecord("Comment", "Comment", Y), Q.clearSelection(), $(u).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                        annotName: P.getAnnotName(),
                        pageIndex: D.getPageIndex()
                    }), Q.setFocusAnnot(C, P), Q.addSelection(P), P
                }, this.onMouseUp = function(a) {}, this.onLButtonDblClk = function(a) {
                    return C ? (i(this), O = !1, a.stopPropagation && a.stopPropagation(), void(a.preventDefault && a.preventDefault())) : !1
                }, this.onRButtonUp = function(a, b) {
                    return b ? (H ? (j(a), k(this), r = $("#" + b.getPageViewContainerID()), r.fwrContextMenu("polyDrawingMenu", {}, document.getElementById(u.getMainView().getMainFrameID()))) : c(), a.stopPropagation(), a.preventDefault(), !1) : !1
                }, this.resetDefault = function() {
                    c(), F = [], G = [], l = null, H = !1, o = null, p = null, r = null, C = null;
                    var a = u.getCurToolHandler();
                    if (a) {
                        var b = a.getName();
                        if (b == WebPDF.Tools.TOOL_NAME_DRAWING_POLYGON || b == WebPDF.Tools.TOOL_NAME_DRAWING_POLYLINE || b == WebPDF.Tools.TOOL_NAME_DRAWING_CLOUD) {
                            var d = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                            return d ? void d.getAnnotHandlerMgr().getUIManager().removeCanvans() : !1
                        }
                    }
                }, this.setShiftFlag = function(a) {
                    t = a
                }, this.setIsOnDraw = function(a) {
                    O = a
                }, this.getIsOnDraw = function() {
                    return O
                }
            };
        return h
    }), define("core/Plugins/Annot/DistanceAnnot/DistanceAnnotToolHandler", ["core/Plugins/Annot/DistanceAnnot/DistanceRulerView", "core/Plugins/Annot/DistanceAnnot/RulerView", "core/Plugins/Annot/DistanceAnnot/Ruler", "core/Plugins/Annot/DistanceAnnot/DistanceToolPopup", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale"], function(a, b, c) {
        "use strict";

        function d(a, b, c, g) {
            function h(a) {
                o = a, t.call(p, a), q = new e(a), r = new f(a)
            }

            function i() {
                u.apply(p, arguments), g.activate();
                var a = o.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID()),
                    c = $("#" + o.getMainFrameId());
                q.activate(b, c), r.activate()
            }

            function j() {
                v.apply(p, arguments), g.deactivate(), q.deactive(), r.deactive(), s = !1
            }

            function k() {
                return WebPDF.Tools.TOOL_NAME_DRAWING_DISTANCE
            }

            function l() {
                var a = x.apply(p, arguments);
                if (g.getIsOnDraw()) {
                    s = !0;
                    var b = g.getCurStartPoint(),
                        c = g.getCurEndPoint();
                    r.render(b, c)
                }
                return a
            }

            function m(a) {
                var b = w.call(p, a);
                if (b) {
                    var c = g.getCurStartPoint(),
                        d = g.getCurEndPoint();
                    r.render(c, d)
                }
                return b
            }

            function n() {
                return s
            }
            d.superclass.constructor.call(this, a, b, c, g);
            var o = null,
                p = this,
                q = null,
                r = null,
                s = !1,
                t = p.onInit,
                u = p.onActivate,
                v = p.onDeactivate,
                w = p.onMouseMove,
                x = p.onLButtonDown;
            p.onInit = h, p.onActivate = i, p.onDeactivate = j, p.onMouseMove = m, p.getName = k, p.onLButtonDown = l, p.isDirty = n
        }
        var e = a("core/Plugins/Annot/DistanceAnnot/DistanceRulerView"),
            f = a("core/Plugins/Annot/DistanceAnnot/DistanceToolPopup"),
            g = WebPDF.Interface;
        WebPDF.Tools.DistanceAnnotToolHandler = d, c.exports = d, g.extend(d, WebPDF.Event.DrawingAnnotToolHandler)
    }), define("core/Plugins/Annot/DistanceAnnot/DistanceRulerView", ["core/Plugins/Annot/DistanceAnnot/RulerView", "core/Plugins/Annot/DistanceAnnot/Ruler"], function(a, b, c) {
        "use strict";

        function d(a) {
            this._readerApp = a, this.isActive = !1, this.horizontalCanvas = $('<canvas class="ruler ruler_horizontal"></canvas>'), this.verticalCanvas = $('<canvas class="ruler ruler_vertical"></canvas>'), this._executeDeactive = m, this._unit = o.UNIT_INCH
        }

        function e(a, b) {
            function c() {
                if (l.isActive) {
                    var a = k(l._readerApp, n, o);
                    l.horizontalRulerView.setOffset(a.left), l.horizontalRulerView.render()
                }
            }

            function d() {
                l.isActive && l.update()
            }

            function e() {
                l.isActive && l.update()
            }

            function g() {
                if (l.isActive) {
                    var a = k(l._readerApp, n, o);
                    l.verticalRulerView.setOffset(a.top), l.verticalRulerView.render()
                }
            }

            function h() {
                if (l.isActive) {
                    var a = k(l._readerApp, n, o);
                    l.horizontalRulerView.setOffset(a.left), l.horizontalRulerView.render()
                }
            }

            function i() {
                l.isActive && l.update()
            }

            function j(a) {
                if (l.isActive) {
                    l.render();
                    var b = a.clientX,
                        c = a.clientY;
                    l.verticalRulerView.renderMousePointer(c - l.verticalCanvas.offset().top), l.horizontalRulerView.renderMousePointer(b - l.horizontalCanvas.offset().left)
                }
            }
            var l = this;
            if (!l.isActive) {
                var n = l.horizontalCanvas,
                    o = l.verticalCanvas;
                a.addClass("activate-ruler");
                var p;
                p = WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 || WebPDF.Environment.edge ? a.find(">.fwrJspContainer-ie") : a.find(">.fwrJspContainer");
                var q = l._readerApp.getDocView();
                q.setShowRuler(!0), p.append(n), b.before(o);
                var r = window.screen.availWidth,
                    s = window.screen.availHeight;
                n.attr({
                    width: r,
                    height: 16
                });
                var t = n.offset();
                o.attr({
                    height: s,
                    width: 16
                }).css({
                    left: t.left - 16
                }), $(window).trigger("resize"), l.isActive = !0, l.update();
                var u = f(d, l),
                    v = f(e, l),
                    w = f(g, l),
                    x = f(h, l),
                    y = f(i, l),
                    z = f(j, l),
                    A = f(c, l);
                a.on("jsp-scroll-y", w), a.on("jsp-scroll-x", x), $(this._readerApp).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, u).on(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, v).on(WebPDF.EventList.DOCVIEW_PAGE_CHANGED, A), $(window).on("resize", y), $(window).on("mousemove", z), l._executeDeactive = function() {
                    l.isActive = !1, l._readerApp.getDocView().setShowRuler(!1), a.removeClass("activate-ruler"), a.off("jsp-scroll-y", w), a.off("jsp-scroll-x", x), $(l._readerApp).off(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, u), $(l._readerApp).off(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, v), $(l._readerApp).off(WebPDF.EventList.DOCVIEW_PAGE_CHANGED, A), $(window).off("resize", y), $(window).off("mousemove", z), $(window).trigger("resize"), l.horizontalCanvas.remove(), l.verticalCanvas.remove(), l.horizontalRulerView = null, l.verticalRulerView = null, l._executeDeactive = m
                }
            }
        }

        function f(a, b) {
            var c;
            return function() {
                clearTimeout(c);
                var d = arguments;
                c = setTimeout(function() {
                    a.apply(b, d)
                }, 0)
            }
        }

        function g(a) {
            o.isSupportedUnit(a) && (this._unit = a, this.update())
        }

        function h() {
            if (this.isActive) {
                var a = this.horizontalCanvas,
                    b = this.verticalCanvas,
                    c = this._readerApp.getDocView(),
                    d = c.getPageView(c.getCurPageIndex()),
                    e = d.getScale(),
                    f = this._unit,
                    g = $(window),
                    h = g.width(),
                    i = Math.max(g.height(), window.screen.availHeight),
                    j = new o(l().xDPI, 1.5 * h * Math.max(e, 1), e, f),
                    m = new o(l().yDPI, 2 * i * Math.max(e, 1), e, f);
                a.attr("width", j.length), b.attr("height", m.length);
                var p = a.offset();
                b.css({
                    left: p.left - 16
                });
                var q = k(this._readerApp, a, b);
                this.horizontalRulerView = new n(a.get(0), j, q.left), this.verticalRulerView = new n(b.get(0), m, q.top), this.render()
            }
        }

        function i() {
            this.isActive && (this.horizontalRulerView.render(), this.verticalRulerView.render())
        }

        function j() {
            this._executeDeactive()
        }

        function k(a, b, c) {
            var d = a.getDocView(),
                e = d.getPageView(d.getCurPageIndex()),
                f = e.getPageViewHtmlOffset(),
                g = f.left - b.offset().left,
                h = f.top - c.offset().top;
            return {
                left: g,
                top: h
            }
        }

        function l() {
            return WebPDF.Common.getDeviceDPI()
        }

        function m() {}
        var n = a("core/Plugins/Annot/DistanceAnnot/RulerView"),
            o = a("core/Plugins/Annot/DistanceAnnot/Ruler");
        c.exports = d, $.extend(d.prototype, {
            activate: e,
            deactive: j,
            update: h,
            render: i,
            setUnit: g
        })
    }), define("core/Plugins/Annot/DistanceAnnot/RulerView", ["core/Plugins/Annot/DistanceAnnot/Ruler.js"], function(a, b, c) {
        "use strict";

        function d(a, b, c) {
            this.ruler = b;
            var e = a.offsetWidth,
                f = a.offsetHeight;
            switch (e > f ? (this.orientation = d.ORIENTATION_HORIZONTAL, this.place = h) : (this.orientation = d.ORIENTATION_VERTICAL, this.place = i), this.canvas = a, this.canvasHeight = f, this.canvasWidth = e, this.offset = 0, this.offsetX = 0, this.offsetY = 0, this.setOffset(c), this.orientation) {
                case d.ORIENTATION_HORIZONTAL:
                    this.length = e;
                    break;
                case d.ORIENTATION_VERTICAL:
                    this.length = f
            }
        }

        function e(a) {
            switch (this.offset = a || 0, this.orientation) {
                case d.ORIENTATION_HORIZONTAL:
                    this.offsetX = this.offset;
                    break;
                case d.ORIENTATION_VERTICAL:
                    this.offsetY = this.offset
            }
        }

        function f() {
            function a() {
                for (var a = e.ruler.iterator(); a.hasNext();) {
                    var b, f = a.next(),
                        g = e.place(f),
                        h = g.x + e.offsetX,
                        i = g.y + e.offsetY,
                        j = g.textX + e.offsetX,
                        k = g.textY + e.offsetY;
                    switch (e.orientation) {
                        case d.ORIENTATION_HORIZONTAL:
                            b = e.canvasHeight;
                            break;
                        case d.ORIENTATION_VERTICAL:
                            b = e.canvasWidth
                    }
                    c(f, b, h, i, j, k)
                }
            }

            function b() {
                function a() {
                    for (; f.hasNext();) {
                        var a = f.next(),
                            b = e.place(a),
                            d = b.x,
                            g = e.offsetY - b.y,
                            h = b.textX,
                            i = e.offsetY - b.textY;
                        c(a, e.canvasWidth, d, g, h, i)
                    }
                }

                function b() {
                    for (; f.hasNext();) {
                        var a = f.next(),
                            b = e.place(a),
                            d = e.offsetX - b.x,
                            g = b.y,
                            h = e.offsetX - b.textX + 4,
                            i = b.textY;
                        c(a, e.canvasHeight, d, g, h, i)
                    }
                }
                var f = e.ruler.iterator();
                switch (f.next(), e.orientation) {
                    case d.ORIENTATION_HORIZONTAL:
                        b();
                        break;
                    case d.ORIENTATION_VERTICAL:
                        a()
                }
            }

            function c(a, b, c, d, g, h) {
                switch (a.type) {
                    case l.SCALE_TYPE_UNIT:
                        b /= 4;
                        break;
                    case l.SCALE_TYPE_MIDDLE:
                        b /= 2;
                        break;
                    case l.SCALE_TYPE_SCALE:
                        b = b
                }
                k(f, e.orientation, b, c, d), a.type === l.SCALE_TYPE_SCALE && f.fillText(a.scale + "", g, h)
            }
            var e = this,
                f = e.canvas.getContext("2d");
            f.clearRect(0, 0, e.canvasWidth, e.canvasHeight), f.save(), j(f), a(), b(), f.restore()
        }

        function g(a) {
            var b = this,
                c = b.canvas.getContext("2d");
            switch (c.save(), c.strokeStyle = "#666", c.lineWidth = 1, c.beginPath(), a += .5, b.orientation) {
                case d.ORIENTATION_HORIZONTAL:
                    c.moveTo(a, 0), c.lineTo(a, b.canvasHeight);
                    break;
                case d.ORIENTATION_VERTICAL:
                    c.moveTo(0, a), c.lineTo(b.canvasWidth, a)
            }
            c.closePath(), c.stroke(), c.restore()
        }

        function h(a) {
            return {
                x: a.offset,
                y: this.canvasHeight,
                textX: a.offset + 2,
                textY: this.canvasHeight / 2 - 1
            }
        }

        function i(a) {
            return {
                x: 16,
                y: a.offset,
                textX: 2,
                textY: a.offset + 10
            }
        }

        function j(a) {
            a.strokeStyle = "#000", a.lineWidth = 1, a.font = "10px Verdana"
        }

        function k(a, b, c, e, f) {
            a.beginPath(), c = Math.ceil(c), e = Math.floor(e), f = Math.floor(f);
            var g, h;
            switch (b) {
                case d.ORIENTATION_VERTICAL:
                    f += .5, g = e - c, h = f;
                    break;
                default:
                    e += .5, g = e, h = f - c
            }
            a.moveTo(e, f), a.lineTo(g, h), a.closePath(), a.stroke()
        }
        c.exports = d;
        var l = a("core/Plugins/Annot/DistanceAnnot/Ruler");
        d.ORIENTATION_HORIZONTAL = "horizontal", d.ORIENTATION_VERTICAL = "vertical", $.extend(d.prototype, {
            render: f,
            renderMousePointer: g,
            setOffset: e
        })
    }), define("core/Plugins/Annot/DistanceAnnot/Ruler", [], function(a, b, c) {
        "use strict";

        function d(a, b, c, d, e) {
            this.dpi = a, this.length = b, this.setZoom(c), this.setUnit(d), this.minDivisionPixels = e || a / this.inchRate / 10
        }

        function e(a) {
            function b() {
                return f < a.length
            }

            function c() {
                var b, c = i % 10;
                return 0 === c ? (b = d.SCALE_TYPE_SCALE, h += 10 * e.division) : b = 5 === c ? d.SCALE_TYPE_MIDDLE : d.SCALE_TYPE_UNIT, f += e.divisionPixels, i++, {
                    type: b,
                    scale: h * a.scaleRate,
                    offset: f
                }
            }
            this.hasNext = b, this.next = c;
            var e = g(a.dpi, a.zoom, a.inchRate, a.minDivisionPixels),
                f = -e.divisionPixels,
                h = 10 * -e.division,
                i = 0
        }

        function f(a) {
            switch (a) {
                case d.UNIT_INCH:
                    return 1;
                case d.UNIT_MILLIMETER:
                case d.UNIT_CENTIMETER:
                    return 2.54;
                case d.UNIT_PICA:
                    return 6;
                default:
                    throw new Error("Illegal unit: " + a)
            }
        }

        function g(a, b, c, d) {
            if (b >= 1) return {
                divisionPixels: a / c * b / 10,
                division: .1
            };
            var e = a / c * b / 10,
                f = Math.max(d, e),
                g = Math.floor(f / e),
                h = g * e;
            return {
                divisionPixels: h,
                division: g / 10
            }
        }
        c.exports = d, d.UNIT_CENTIMETER = "centimeter", d.UNIT_MILLIMETER = "millimeter", d.UNIT_INCH = "inch", d.UNIT_PICA = "pica", d.ALL_UNITS = [d.UNIT_INCH, d.UNIT_CENTIMETER, d.UNIT_INCH, d.UNIT_PICA], d.SCALE_TYPE_UNIT = "unit", d.SCALE_TYPE_MIDDLE = "middle", d.SCALE_TYPE_SCALE = "scale", d.isSupportedUnit = function(a) {
            switch (a) {
                case d.UNIT_CENTIMETER:
                case d.UNIT_MILLIMETER:
                case d.UNIT_INCH:
                case d.UNIT_PICA:
                    return !0
            }
            return !1
        }, $.extend(d.prototype, {
            setUnit: function(a) {
                this.unit = a || d.UNIT_INCH, this.inchRate = f(this.unit), this.scaleRate = this.unit === d.UNIT_MILLIMETER ? 10 : 1
            },
            setZoom: function(a) {
                this.zoom = Math.max(a, .001)
            },
            iterator: function() {
                return new e(this)
            },
            clone: function() {
                return new d(this.dpi, this.zoom, this.length, this.unit, this.minDivisionPixels)
            }
        })
    }), define("core/Plugins/Annot/DistanceAnnot/DistanceToolPopup", ["core/Plugins/Annot/DistanceAnnot/Ruler", "core/Plugins/Annot/DistanceAnnot/units", "core/Plugins/Annot/DistanceAnnot/DistanceScale"], function(a, b, c) {
        function d() {
            this.currentMesurement = {
                distanceX: 0,
                distanceY: 0,
                distance: 0,
                angle: 0
            }
        }

        function e() {
            function a() {
                var a = $(this),
                    b = a.val();
                if (b.length > 11) return !1;
                var c = parseFloat(b);
                if (c > l.MAX_SCALE_VALUE || c < l.MIN_SCALE_VALUE) return !1;
                var d = Math.max(34, 7 * b.length);
                a.css("width", d)
            }
            var b = this,
                c = [k.POINT, k.INCH, k.CENTIMETER, k.PICA, k.MILLIMETER],
                d = [k.POINT, k.INCH, k.CENTIMETER, k.PICA, k.MILLIMETER, k.FOOT, k.YARD, k.METER, k.KILOMETER, k.MILE, k.CUSTOM],
                e = $(m),
                g = e.find("select[name=fromUnit]"),
                h = e.find("select[name=toUnit]"),
                i = e.find("input[name=fromScale]"),
                j = e.find("input[name=toScale]"),
                n = e.find(".close");
            c.forEach(function(a) {
                var b = $("<option>");
                b.text(i18n.t("Distance.Unit." + a.name)), b.attr("value", a.name), g.append(b)
            }), d.forEach(function(a) {
                var b = $("<option>");
                b.text(i18n.t("Distance.Unit." + a.name)), b.attr("value", a.name), h.append(b)
            }), e.draggable(), e.css("position", "fixed"), e.i18n(), $("body").append(e), b.$element = e, b.isActive = !0, this.renderScaleInfo(), g.off("change").on("change", function() {
                l.setFromUnit(g.val())
            }), h.off("change").on("change", function() {
                l.setToUnit(h.val())
            }), i.off("change").on("change", function() {
                l.fromScale = f(i.val(), l.fromScale), i.val(l.fromScale), a.call(this)
            }), j.off("change").on("change", function() {
                l.toScale = f(j.val(), l.toScale), j.val(l.toScale), a.call(this)
            }), i.on("input", a), j.on("input", a), n.off("click").on("click", function() {
                e.slideUp(100)
            })
        }

        function f(a, b) {
            var c = parseFloat(a, 10);
            return isNaN(c) || !isFinite(c) ? b : c < l.MIN_SCALE_VALUE ? l.MIN_SCALE_VALUE : c > l.MAX_SCALE_VALUE ? l.MAX_SCALE_VALUE : c
        }

        function g() {
            this.isActive && (this.isActive = !1, this.$element.remove())
        }

        function h() {
            var a = this.$element.find("select[name=fromUnit]"),
                b = this.$element.find("select[name=toUnit]");
            a.val(l.fromUnit.name), b.val(l.toUnit.name), this.$element.find("input[name=fromScale]").val(l.fromScale), this.$element.find("input[name=toScale]").val(l.toScale)
        }

        function i(a, b) {
            var c = WebPDF.Tool.getReaderApp(),
                d = c.getDocView(),
                e = d.getPageView(d.getCurPageIndex()),
                f = b.x - a.x,
                g = b.y - a.y,
                h = Math.atan2(Math.abs(g), f),
                i = (j(h / Math.PI * 180) + 360) % 360,
                k = e.getScale(),
                m = l.distanceOf(a, b, k);
            i = j(i), this.currentMesurement = {
                distanceX: m.distanceX,
                distanceY: m.distanceY,
                distance: m.distance,
                angle: i
            };
            var n = i18n.t("Distance.Unit." + l.fromUnit.name),
                o = i18n.t("Distance.Unit." + l.toUnit.name);
            this.$element.find("[data-role=distance-value]").text(m.distance.toFixed(2) + " " + o), this.$element.find("[data-role=angle-value]").text(i.toFixed(2)), this.$element.find("[data-role=offset-x-value]").text(m.distanceX.toFixed(2) + " " + o), this.$element.find("[data-role=offset-y-value]").text(m.distanceY.toFixed(2) + " " + o), this.$element.find("[data-role=scale-value]").text(l.fromScale + n + " = " + l.toScale + o)
        }

        function j(a) {
            return Math.round(100 * a) / 100
        }
        var k = (a("core/Plugins/Annot/DistanceAnnot/Ruler"), a("core/Plugins/Annot/DistanceAnnot/units")),
            l = a("core/Plugins/Annot/DistanceAnnot/DistanceScale"),
            m = ['<div class="fwr-modal distance-dialog">', '<div class="fwr-modal-header">', '<a class="close" webpdf-data-dismiss="modal"></a>', "<span data-i18n=Distance.Dialog.title>Distance Measurement</span>", "</div>", '<div class="fieldset">', '<span class="fieldset-title" data-i18n="Distance.Scale.title">', "Scale", "</span>", '<div class="fieldset-content">', '<ul class="form-group">', '<li class="form-item">', '<input name="fromScale">', "</li>", '<li class="form-item">', '<select name="fromUnit"></select>', "</li>", '<li class="form-item"> = </li>', '<li class="form-item">', '<input name="toScale">', "</li>", '<li class="form-item">', '<select name="toUnit"></select>', "</li>", "</ul>", "</div>", "</div>", '<div class="fieldset">', '<span class="fieldset-title" data-i18n="[html]Distance.Measurement.title">', "Measurement", "</span>", '<div class="fieldset-content">', '<table class="measurements-table">', "<tr>", '<th data-i18n="Distance.Measurement.Label.Distance">Distance:</th>', '<td data-role="distance-value"></td>', '<th class="offset-item-label">ΔX:</th>', '<td data-role="offset-x-value"></td>', "</tr>", "<tr>", '<th data-role="angle" data-i18n="Distance.Measurement.Label.Angle">Angle:</th>', '<td data-role="angle-value"></th>', '<th class="offset-item-label">ΔY:</th>', '<td data-role="offset-y-value"></td>', "</tr>", "<tr>", '<th data-i18n="Distance.Measurement.Label.Scale">Scale:</th>', '<td data-role="scale-value" colspan="3"></td>', "</tr>", "</table>", "</div>", "</div>", "</div>"].join("");
        c.exports = d, $.extend(d.prototype, {
            activate: e,
            deactive: g,
            render: i,
            renderScaleInfo: h
        })
    }), define("core/Plugins/Annot/CommentAnnot/CommentAnnotToolHandler", ["core/Plugins/Annot/CommentAnnot/CommentAnnotService", "core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/WebPDF"], function(a, b, c) {
        var d = a("core/Plugins/Annot/CommentAnnot/CommentAnnotService"),
            e = a("core/Plugins/Annot/CommentAnnot/CommentAnnotView");
        return WebPDF.Tools.TOOL_NAME_COMMENT_HIGHTLIGHT = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT, WebPDF.Tools.TOOL_NAME_COMMENT_UNDERLINE = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE, WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY, WebPDF.Tools.TOOL_NAME_COMMENT_STRIKEOUT = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT, WebPDF.Tools.TOOL_NAME_COMMENT_OVAL = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_OVAL, WebPDF.Tools.TOOL_NAME_COMMENT_RECTANGLE = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_RECTANGLE, WebPDF.Tools.TOOL_NAME_COMMENT_LINE = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_LINE, WebPDF.Tools.TOOL_NAME_COMMENT_ARROW = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_ARROW, WebPDF.Tools.TOOL_NAME_COMMENT_REPLACE = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE, WebPDF.Tools.TOOL_NAME_COMMENT_CARET = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET, WebPDF.Event.CommentAnnotToolHandler = function(a, b) {
            this._isProcessing = !1, this._pTextSelectTool = null, this.getReaderApp = function() {
                return WebPDF.Tool.getReaderApp()
            }, this.getTextSelectTool = function() {
                return this._pTextSelectTool
            }, this.commentAnnotService = new d, this.commentAnnotView = new e, this.commentAnnotService.setCommentType(a), this.getService = function() {
                return this.commentAnnotService
            }, this.getView = function() {
                return this.commentAnnotView
            }
        }, WebPDF.Event.CommentAnnotToolHandler.prototype = {
            onInit: function(a) {
                if (WebPDF.TextSelection && WebPDF.TextSelection.PDFTextSelectTool) {
                    var b = this.getReaderApp().getToolHandlerByName(WebPDF.Tools.TOOL_NAME_SELECTTEXT);
                    b && (this._pTextSelectTool = b.getTextSelectService())
                }
            },
            destroy: function() {},
            getName: function() {
                return this.getService().getCommentType()
            },
            onActivate: function() {
                this.getView().setDocCursor(this.getReaderApp().getMainView().getDocView(), this.getService().getCommentType())
            },
            onDeactivate: function() {
                this.getView().delDocCursor(this.getReaderApp().getMainView().getDocView(), this.getService().getCommentType())
            },
            isEnabled: function() {
                return this.getService().isEnabled()
            },
            isProcessing: function() {
                return this._isProcessing
            },
            onLButtonDown: function(a) {
                var b = new RegExp("(^|\\s)fwr-annot(\\s|$)"),
                    c = b.test(a.target.className),
                    d = null,
                    e = this.getReaderApp(),
                    f = e.getMainView().getDocView();
                if (c) {
                    var g = parseInt(a.target.getAttribute("page-index")),
                        h = a.target.getAttribute("annot-name");
                    if (d = f.getPageView(g), this.getService().isCommenAnnot(d, h)) return !1
                }
                var i = $("#" + f.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(i.get(0), a.target, !0)) return !1;
                if (null == d) {
                    var j = new WebPDF.PDFPoint(0, 0);
                    if (d = WebPDF.TextSelection.PDFTextSelectTool.getPageViewInfoByMouseEvent(e, a, j, !0, !1), null == d) return !1
                }
                var k = d.getFocusAnnot();
                return k && d.setFocusAnnot(null), d.getDocView().clearAllSelection(), this.getTextSelectTool().onLButtonDown(a), this._isProcessing = !0, !0
            },
            onLButtonUp: function(a) {
                return this.getView().clearHighLightRectsSelected(WebPDF.Tool.getReaderApp().getMainView().getDocView()), this._isProcessing && this.getTextSelectTool().onLButtonUp(a) && this.createAnnot(), this.getTextSelectTool().clearSelection(), this._isProcessing = !1, this.onActivate(), !0
            },
            createAnnot: function() {
                function a(a, d, e, g, h) {
                    if (d.length < 0) return !1;
                    var i = new Date,
                        j = i.valueOf(),
                        k = (Math.floor(j / 1e3).toString(), WebPDF.Tool.getReaderApp().getMainView().getDocView().getPageView(a.getPageIndex())),
                        l = WebPDF.Tool.getReaderApp().getMainView().getDocView().getPageViewRender().getPixelsPerPoint(),
                        m = k.getScale(),
                        n = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                        o = f.getService().getCommentType();
                    if (o === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE) {
                        var p = c(d, m, h, k, l, WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET, n, !0);
                        p.annotJSONData.it = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE;
                        var q = c(d, m, h, k, l, o, n, !0);
                        q.annotJSONData.irt = p.getAnnotName(), q.annotJSONData.rt = "Group", p.annotJSONData.grp = q.getAnnotName();
                        var r = [];
                        r.push(p.annotJSONData), r.push(q.annotJSONData), b(k, r)
                    } else c(d, m, h, k, l, o, n)
                }

                function b(a, b) {
                    var c = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, b);
                    WebPDF.Tool.getReaderApp().addAnnotUndo(c)
                }

                function c(a, c, g, h, i, j, k, l) {
                    var m = f.getService().addPdfAnnot(r, a, p, q, e(f.getService().getCommentType()), d(j), k, i, h.getPageViewWidth(), c, g, j);
                    h.setModified(!0);
                    var n = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr();
                    if (f.getView().addAnnot(n.getUIManager(), h, m), !l) {
                        var o = [m.annotJSONData];
                        b(h, o)
                    }
                    f.getService().getCommentType() === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE && j == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE ? $(f.getReaderApp()).trigger(WebPDF.EventList.ANNOT_ADDED_NOFilter, {
                        pageIndex: r.getPageIndex(),
                        annot: n.packageAnnot(m),
                        annotObject: m
                    }) : $(f.getReaderApp()).trigger(WebPDF.EventList.ANNOT_ADDED, {
                        pageIndex: r.getPageIndex(),
                        annot: n.packageAnnot(m),
                        annotObject: m
                    }), $(f.getReaderApp()).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                        annotName: m.getAnnotName(),
                        pageIndex: r.getPageIndex()
                    });
                    var s = "[" + m.getRect().left + " " + m.getRect().top + " " + m.getRect().right + " " + m.getRect().bottom + "]",
                        t = '{"Type":"' + m.getSubType() + '", "ActionType":"Add", "PageIndex":"' + r.getPageIndex() + '", "Rect":"' + s + '"}';
                    return f.getReaderApp().addRecord("Comment", "Comment", t), j == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET && n.getMarkupAnnotHandler().onLButtonDblClk(h, m), m
                }

                function d(a) {
                    return a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE ? i18n.t("Annot.AnnotSubjUnderline") : a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? i18n.t("Annot.AnnotSubjHighlight") : a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY ? i18n.t("Annot.AnnotSubjSquiggly") : a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT ? i18n.t("Annot.AnnotSubjStrikeout") : f.getService().getCommentType() == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE && a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET ? i18n.t("Annot.AnnotSubjReplace") : a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET ? i18n.t("Annot.AnnotSubjCaret") : a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE ? "StrikeOut" : ""
                }

                function e(a) {
                    var b = WebPDF.AccountInstance.getUserConfig();
                    return a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE ? b.annot.underLine.clr : a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? b.annot.highLight.clr : a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT ? b.annot.strikeOut.clr : a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY ? b.annot.squiggly.clr : a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE ? b.annot.replace.clr : a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET ? b.annot.caret.clr : "#ffff00"
                }
                var f = this,
                    g = 0,
                    h = 0,
                    i = this.getTextSelectTool().getSelectedPageRange(g, h);
                if (g = i.start, h = i.end, 0 > h || 0 > g) return !1;
                for (var j = Math.abs(h - g) + 1, k = h - g >= 0 ? 1 : -1, l = g, m = 0; j > m; l += k, m++) {
                    var n = this.getTextSelectTool().getTextPage(l);
                    if (!n) return;
                    var o = [],
                        p = [],
                        q = [];
                    if (n.pageSelectInfo.getSelectPDFRectAndMatrix(o, p, q), o.length > 0) {
                        var r = this.getReaderApp().getMainView().getDocView().getPageView(l).getPDFPage(),
                            s = !1;
                        f.getService().getCommentType() === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE && (s = !0);
                        var t = n.pageSelectInfo.getEndCartPDFPoint(r.getPageRotate(), s);
                        a(r, o, p, q, t), this.getReaderApp().getMainView().getDocView().setModified(!0)
                    }
                }
                return this.getTextSelectTool().clearSelection(), !0
            },
            onLButtonDblClk: function(a) {
                var b = new RegExp("(^|\\s)fwr-annot(\\s|$)"),
                    c = b.test(a.target.className),
                    d = null,
                    e = this.getReaderApp().getMainView().getDocView();
                if (c) {
                    var f = parseInt(a.target.getAttribute("page-index")),
                        g = a.target.getAttribute("annot-name"),
                        d = e.getPageView(f);
                    if (this.getService().isCommenAnnot(d, g)) return !1
                }
                var h = $("#" + e.getDocViewContainerID());
                if (!WebPDF.Common.containsNode(h.get(0), a.target, !0)) return !1;
                if (null == d) {
                    var i = new WebPDF.PDFPoint(0, 0);
                    d = WebPDF.TextSelection.PDFTextSelectTool.getPageViewInfoByMouseEvent(this.getReaderApp(), a, i, !0, !1)
                }
                if (null == d) return !1;
                d.getFocusAnnot() && d.setFocusAnnot(null), e.clearAllSelection();
                var j = this;
                return this.getTextSelectTool().onLButtonDblClk(a, function() {
                    j.createAnnot(), j.getReaderApp().getMainView().getDocView().setModified(!0)
                }), !0
            },
            onMouseMove: function(a) {
                return this.getTextSelectTool().onMouseMove(a), !0
            },
            onRButtonDown: function(a) {
                return !1
            },
            onRButtonUp: function(a) {
                return !1
            },
            onRButtonDblClk: function(a) {
                return !1
            },
            onMouseWheel: function(a) {
                return !1
            },
            onMouseOver: function(a) {
                return !1
            },
            onMouseOut: function(a) {
                return !1
            },
            onMouseEnter: function(a) {
                return !1
            },
            onMouseLeave: function(a) {
                return !1
            },
            onKeyDown: function(a) {
                return !1
            },
            onKeyUp: function(a) {
                return !1
            },
            onChar: function(a) {
                return !1
            }
        }, WebPDF.Event.CommentAnnotToolHandler
    }), define("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotToolHandler", ["core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView", "core/Plugins/Annot/CommentAnnot/CommentAnnotView", "core/WebPDF", "core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService", "core/Plugins/Annot/CommentAnnot/CommentAnnotService"], function(a, b, c) {
        var d = WebPDF.Interface,
            e = a("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotView"),
            f = a("core/Plugins/Annot/CommentAnnot/AreaHighlightAnnot/AreaHighlightAnnotService");
        WebPDF.Tools.TOOL_NAME_COMMENT_HIGHTLIGHT_AREA = WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT_AREA;
        var g = function(a, b) {
            g.superclass.constructor.call(this, a, b), $.extend(this, {
                getName: function() {
                    return WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT_AREA
                },
                onLButtonDown: function(a) {
                    var b = new RegExp("(^|\\s)fwr-annot(\\s|$)"),
                        c = b.test(a.target.className),
                        d = null,
                        e = this.getReaderApp(),
                        f = e.getMainView().getDocView();
                    if (c) {
                        var g = parseInt(a.target.getAttribute("page-index")),
                            h = a.target.getAttribute("annot-name");
                        if (d = f.getPageView(g), this.getService().isCommenAnnot(d, h)) return !1
                    }
                    var i = $("#" + f.getDocViewContainerID());
                    if (!WebPDF.Common.containsNode(i.get(0), a.target, !0)) return !1;
                    if (null == d) {
                        var j = new WebPDF.PDFPoint(0, 0);
                        if (d = WebPDF.TextSelection.PDFTextSelectTool.getPageViewInfoByMouseEvent(e, a, j, !0, !1), null == d) return !1
                    }
                    var k = d.getPageViewRect();
                    if (!WebPDF.RectUtils.ptInRect(k, a.pageX, a.pageY)) return !1;
                    var l = d.getFocusAnnot();
                    return l && d.setFocusAnnot(null), d.getDocView().clearAllSelection(), this._isLButtonDown = !0, this.getService().onLButtonDown(a), this._isProcessing = !0, !0
                },
                onLButtonUp: function(a) {
                    return this._isProcessing && this._isLButtonDown && this.createAnnot(), this.clearSelection(), this._isProcessing = !1, this._isLButtonDown = !1, this.onActivate(), !0
                },
                clearSelection: function() {
                    this.getView().clearAreaHighLightSelect(WebPDF.Tool.getReaderApp().getMainView().getDocView()), this.getService().clearSelection()
                },
                createAnnot: function() {
                    function a(a, e, f, g) {
                        if (e.length < 0) return !1;
                        var h = new Date,
                            i = h.valueOf(),
                            j = (Math.floor(i / 1e3).toString(), WebPDF.Tool.getReaderApp().getMainView().getDocView().getPageViewRender().getPixelsPerPoint()),
                            k = a.getScale(),
                            l = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                            m = d.getService().addPdfAnnot(a, e, c(d.getService().getCommentType()), b(d.getService().getCommentType()), l, j, a.getPageViewWidth(), k);
                        a.setModified(!0);
                        var n = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr();
                        d.getView().addAnnot(n.getUIManager(), a, m);
                        var o = [];
                        o.push(m.annotJSONData);
                        var p = new WebPDF.Annot.Undo(a.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, o);
                        d.getReaderApp().addAnnotUndo(p), $(d.getReaderApp()).trigger(WebPDF.EventList.ANNOT_ADDED, {
                            pageIndex: a.getPageIndex(),
                            annot: n.packageAnnot(m),
                            annotObject: m
                        }), $(d.getReaderApp()).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                            annotName: m.getAnnotName(),
                            pageIndex: a.getPageIndex()
                        });
                        var q = "[" + m.getRect().left + " " + m.getRect().top + " " + m.getRect().right + " " + m.getRect().bottom + "]",
                            r = '{"Type":"' + m.getSubType() + '", "ActionType":"Add", "PageIndex":"' + a.getPageIndex() + '", "Rect":"' + q + '"}';
                        d.getReaderApp().addRecord("Comment", "Comment", r)
                    }

                    function b(a) {
                        return a == WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? i18n.t("Annot.AnnotSubjHighlight") : ""
                    }

                    function c(a) {
                        var b = WebPDF.AccountInstance.getUserConfig();
                        return a === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT ? b.annot.highLight.clr : "#ffff00"
                    }
                    for (var d = this, e = this.getService().getSelectionArray(), f = 0; f < e.length; f++) {
                        var g = e[f],
                            h = this.getService().getStartPageIndex(),
                            i = this.getReaderApp().getMainView().getDocView().getPageView(h);
                        a(i, g), this.getReaderApp().getMainView().getDocView().setModified(!0)
                    }
                    return this.getTextSelectTool().clearSelection(), !0
                },
                onMouseMove: function(a) {
                    if (this._isLButtonDown) {
                        this.getService().onMouseMove(a);
                        var b = this.getService().getSelectionArray();
                        if (b.length > 0) {
                            var c = this.getReaderApp().getMainView().getDocView().getPageView(this.getService().getStartPageIndex());
                            this.getView().highlightSelectedArea(c, b)
                        }
                    }
                    return !0
                }
            }), this.areaHighlightAnnotService = f.getAreaHighlightAnnotService(WebPDF.Tool.getReaderApp()), this.areaHighlightAnnotView = new e, this.areaHighlightAnnotService.setCommentType(WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT), this._isLButtonDown = !1, this.getService = function() {
                return this.areaHighlightAnnotService
            }, this.getView = function() {
                return this.areaHighlightAnnotView
            }
        };
        return d.extend(g, WebPDF.Event.CommentAnnotToolHandler), WebPDF.Event.AreaHighlightAnnotToolHandler = g, WebPDF.Event.AreaHighlightAnnotToolHandler
    }), define("core/Plugins/Annot/DrawingAnnot/InkAnnotToolHandler", ["core/Plugins/Annot/DrawingAnnot/InkTools", "core/Plugins/Annot/DrawingAnnot/DrawingUtils", "core/Plugins/Annot/DrawingAnnot/InkAnnotView", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotView", "core/Common/CoordinateUtils", "core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"], function(a, b, c) {
        return a("core/Plugins/Annot/DrawingAnnot/InkTools"), WebPDF.Tools.TOOL_NAME_INKANNOT = "InkAnnot Tool", WebPDF.Event.InkAnnotToolHandler = function() {
            var b, c, d, e, f = a("core/Plugins/Annot/DrawingAnnot/InkAnnotView"),
                g = a("core/Plugins/Annot/DrawingAnnot/DrawingAnnotService"),
                h = a("core/Plugins/Annot/DrawingAnnot/InkTools"),
                i = null,
                j = (WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME), !1);
            this.onInit = function(a) {
                i = a, b = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(), c = new f(b, a), d = new g;
                var j = WebPDF.AccountInstance.getUserConfig();
                e = new h(b.getCavansElement(), j.annot.pencil)
            }, this.destroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_INKANNOT
            }, this.onActivate = function() {
                j = !0, c.addCursor()
            }, this.onDeactivate = function() {
                j = !1, c.onDeactivate(), e && e.resetDefault()
            }, this.isEnabled = function() {
                var a = i.getMainView().getDocView().getPDFDoc();
                return a && a.getDocType() !== WebPDF.Annot.DocType.XFA ? !0 : !0
            }, this.isProcessing = function() {
                return j
            }, this.isDrawing = function() {
                return e ? e.getIsOnDraw() : !1
            }, this.onLButtonDown = function(a) {
                if (!e) return !1;
                if (c.containsJQDocView(a) === !1) return !1;
                var b = c.onLButtonInPage(a);
                return !b.pageView || b.pageView.isPageLoadLimit() ? !1 : b.pageView.isPageLoaded() ? (e.getUserColor(), e.onMouseDown(a, b.pageView), !1) : !1
            }, this.onLButtonUp = function(a) {
                return null != e ? e.onMouseUp(a) : !1
            }, this.createAnnot = function(a, b, c) {}, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                return null != e ? e.onMouseMove(a) : !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return null != e ? e.onMouseUp(a) : !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Event.InkAnnotToolHandler
    }), define("core/Plugins/Annot/DrawingAnnot/InkTools", ["core/Plugins/Annot/DrawingAnnot/DrawingUtils"], function(a, b, c) {
        WebPDF.DrawingTools = {};
        WebPDF.PDFPoint, WebPDF.Annot.PDFAnnot;
        WebPDF.DrawingTools.DA_BEZIER = .5522847498308;
        var d = a("core/Plugins/Annot/DrawingAnnot/DrawingUtils");
        return WebPDF.InkTools = function(a, b, c) {
            var e = WebPDF.Common.getReaderApp(),
                f = b.borderWidth ? b.borderWidth : 3,
                g = b.clr,
                h = g,
                i = [],
                j = 0,
                k = 0,
                l = 0,
                m = 0,
                n = null,
                o = !1;
            _self = this;
            var p = 1,
                q = 180,
                r = 120,
                s = null,
                t = null;
            this.getColor = function() {
                return g
            }, this.getUserColor = function() {
                return g = b.clr, f = b.borderWidth ? b.borderWidth : 3, h = g, g
            }, this.resetDefault = function() {
                t && t.clearRect(0, 0, s.width, s.height), n = null, o = !1
            }, this.onMouseDown = function(a, b) {
                var c = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                if (!c) return !1;
                c.getAnnotHandlerMgr().getUIManager().resetCanvens(b), s = c.getAnnotHandlerMgr().getCavansElement(), t = s.getContext("2d"), n = b, t.strokeStyle = g, t.lineWidth = f * b.getScale();
                var e = $(s).offset(),
                    h = a.pageX - e.left,
                    p = a.pageY - e.top,
                    q = d.deviceRotate(new WebPDF.PDFPoint(h, p), b.getDocView().getRotate(), s, n);
                t.beginPath(), t.moveTo(q.x, q.y), j = h, k = h, l = p, m = p;
                var r = new WebPDF.PDFPoint(h, p);
                return i = [], i.push(r), o = !0, _isOnDraw = !1, !0
            }, this.onMouseMove = function(a) {
                if (o) {
                    var b = a.pageX,
                        c = a.pageY,
                        e = $("#" + n.getPageViewContainerID()).offset(),
                        f = $(s).offset(),
                        g = b - e.left,
                        h = c - e.top;
                    0 > g && (b = e.left), g > n.getPageViewWidth() && (b = e.left + n.getPageViewWidth()), 0 > h && (c = e.top), h > n.getPageViewHeight() && (c = e.top + n.getPageViewHeight());
                    var p = b - f.left,
                        q = c - f.top,
                        r = d.deviceRotate(new WebPDF.PDFPoint(p, q), n.getDocView().getRotate(), s, n);
                    t.lineTo(r.x, r.y), t.stroke(), t.moveTo(r.x, r.y), j > p && (j = p), p > k && (k = p), l > q && (l = q), q > m && (m = q);
                    var u = new WebPDF.PDFPoint(p, q);
                    return i.push(u), _isOnDraw = !0, !0
                }
                return !0
            }, this.getIsOnDraw = function() {
                return _isOnDraw
            }, this.CreateAnnot = function() {
                var a = i.length;
                if (!(0 >= a)) {
                    var b = $(s).offset(),
                        c = $("#" + n.getPageViewContainerID()).offset(),
                        d = [],
                        g = [],
                        o = 1.5,
                        t = 1.5;
                    if (1 == a) {
                        var u = i[0];
                        i = [];
                        for (var v = n.getDocView(), w = v.getPageViewRender().getPixelsPerPoint() * n.getScale(), x = 1; f >= x; x++) {
                            var y = (x - WebPDF.DrawingTools.DA_BEZIER) * w;
                            j = u.x - y < j ? u.x - y : j, j = u.x + y < j ? u.x + y : j, k = u.x - y > k ? u.x - y : k, k = u.x + y > k ? u.x + y : k, l = u.y - y < l ? u.y - y : l, l = u.y + y < l ? u.y + y : l, m = u.y - y > m ? u.y - y : m, m = u.y + y > m ? u.y + y : m, i.push(new WebPDF.PDFPoint(u.x - y, u.y)), i.push(new WebPDF.PDFPoint(u.x - y, u.y + y)), i.push(new WebPDF.PDFPoint(u.x, u.y + y)), i.push(new WebPDF.PDFPoint(u.x + y, u.y + y)), i.push(new WebPDF.PDFPoint(u.x + y, u.y)), i.push(new WebPDF.PDFPoint(u.x + y, u.y - y)), i.push(new WebPDF.PDFPoint(u.x, u.y - y)), i.push(new WebPDF.PDFPoint(u.x - y, u.y - y))
                        }
                        a = i.length
                    }
                    for (var z = 0; a > z; z++) {
                        var A = i[z];
                        A.x -= c.left - b.left, A.y -= c.top - b.top;
                        var B = n.devicePtToPDF(A);
                        g.push(B.x), g.push(B.y)
                    }
                    d.push(g);
                    var C = j - (c.left - b.left),
                        D = k - j,
                        E = l - (c.top - b.top),
                        F = m - l,
                        G = new Date,
                        H = G.valueOf(),
                        I = Math.floor(H / 1e3).toString(),
                        J = Configs.UseWholeUserName ? WebPDF.AccountInstance.getUserAccount() : WebPDF.AccountInstance.getUserAccount().split("@")[0],
                        K = {
                            c: "",
                            ca: p,
                            cd: I,
                            cl: h,
                            f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                            md: I,
                            n: null,
                            pop: null,
                            subj: i18n.t("Annot.AnnotSubjPencil"),
                            subty: "Ink",
                            tit: J,
                            ty: "Markup",
                            ikl: d,
                            ikc: h,
                            ikw: f,
                            rc: null,
                            pdf: "false",
                            del: 0
                        },
                        L = n.getPDFPage(),
                        M = (L.getPageWidth(), L.getPageHeight(), new WebPDF.PDFRect(C, E, C + D, E + F)),
                        N = n.deviceRectToPDF(M, !0);
                    K.rc = [N.left - o, N.top + t, N.right + o, N.bottom - t];
                    var O = new WebPDF.PDFRect(0, 0, 0, 0);
                    O.top = N.top;
                    var P = n.getDocView().getPageViewRender().getPixelsPerPoint(),
                        Q = n.getScale();
                    O.left = (n.getPageViewWidth() - q * P) / (Q * P), O.right = O.left + q, O.bottom = O.top - r, O.bottom < 0 && WebPDF.RectUtils.offset(O, 0, -O.bottom), K.pop = {
                        f: WebPDF.Annot.AnnotFlag.ANNOTFLAG_PRINT,
                        md: I,
                        n: I + "_popup",
                        op: 0,
                        rc: [O.left, O.top, O.right, O.bottom]
                    };
                    var R = WebPDF.Annot.AnnotFactory.createAnnot(K, L.getPageIndex(), !1);
                    L.getAnnotJsonData().push(K), L.addAnnot(R), n.setModified(!0);
                    var S = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                        T = S.getUIManager().getPageAnnotsContainerID(n),
                        U = $("#" + T),
                        V = R.getAnnotName(),
                        W = S.getUIManager().createAAnnotHtmlContent(n, R, V, 1, !1);
                    U.append(W), S.showAInkAnnot(n, R, !1), n.getDocView().setModified(!0);
                    var X = [];
                    X.push(R.annotJSONData);
                    var Y = new WebPDF.Annot.Undo(n.getPageIndex(), WebPDF.Annot.UndoType.ANNOT_CREATE, X);
                    e.addAnnotUndo(Y), $(e).trigger(WebPDF.EventList.ANNOT_ADDED, {
                        pageIndex: L.getPageIndex(),
                        annot: S.packageAnnot(R),
                        annotObject: R
                    }), $(e).trigger(WebPDF.EventList.ANNOT_SELECTED, {
                        annotName: R.getAnnotName(),
                        pageIndex: L.getPageIndex()
                    });
                    var Z = "[" + R.getRect().left + " " + R.getRect().top + " " + R.getRect().right + " " + R.getRect().bottom + "]",
                        _ = '{"Type":"' + R.getSubType() + '", "ActionType":"Add", "PageIndex":"' + L.getPageIndex() + '", "Rect":"' + Z + '"}';
                    e.addRecord("Comment", "Comment", _)
                }
            }, this.onMouseUp = function(a) {
                var b = WebPDF.Tool.getReaderApp().getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
                return o && (_self.CreateAnnot(), t.closePath(), t.clearRect(0, 0, s.width, s.height)), o = !1, _isOnDraw = !1, b && b.getAnnotHandlerMgr().getUIManager().removeCanvans(), !0
            }
        }, WebPDF.InkTools
    }), define("core/Plugins/CommentList/CommentListPlugin", ["core/Plugins/CommentList/CommentListService", "core/Plugins/CommentList/MobileCommentListView", "core/Common/Interface", "core/WebPDF", "core/Plugins/CommentList/CommentListView", "core/Plugins/CommentList/PCCommentListView"], function(a, b, c) {
        WebPDF.CommentListPluginName = "comment list Plugin", WebPDF.CommentListPlugin = function(b) {
            function c() {
                WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
                    m.isInit() || (l.setAnnotsCount(0), m.init(), l.setViewCallBack(m.insertPopUpHtml, m.getOffset2Scroll))
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.OFFLINEMODE_CHANGED, function(a, b) {
                    b.isOffline || m.isInit() || (l.setAnnotsCount(0), m.init(), l.setViewCallBack(m.insertPopUpHtml, m.getOffset2Scroll))
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.DOCUMENT_CLOSED, function(a, b) {
                    l.setAnnotsCount(0), l.clearInitFlag(), m.clear()
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.ANNOT_DELETED, function(a, b) {
                    i.isMobile() ? h(a, b) : g(a, b)
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.ANNOT_UPDATED, function(a, b) {
                    m.triggerUpdateAnnot(a, b)
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.ANNOT_ADDED, function(a, b) {
                    if (m.isCommentlistLoad()) {
                        var c = l.getAnnotsCount(),
                            d = m.triggerAddAnnot(a, b, c);
                        l.setAnnotsCount(d)
                    }
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.ANNOTS_VISIBILITY_CHANGED, function(a, b) {
                    m.triggerAnnotVisibleChanged(a, b).then(function(a) {
                        i.isMobile() || l.setAnnotsCount(a)
                    })
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.ANNOT_SELECTED, function(a, b) {
                    m.triggerAnnotSelected(a, b)
                })
            }

            function d() {
                i.isMobile() ? f() : e()
            }

            function e() {
                m.onUpdateAnnotContent(function(a, b, c) {
                    l.updateAnnotContent(a, b, c)
                }), m.onDeleteAnnot(function(a, b) {
                    l.deleteAnnot(a, b)
                }), m.onReplyAnnot(function(a, b) {
                    l.replyAnnot(a, b)
                }), m.onGotoPosition(), m.onLoadAnnots(function(a, b) {
                    l.loadAnnots(a, b, !0)
                })
            }

            function f() {
                m.onMoreAnnot(function(a, b) {
                    l.loadAnnots(a, b, !0)
                }), m.onDeleteOrReplyAnnot(function(a, b) {
                    l.deleteAnnot(a, b)
                }, function(a, b) {
                    l.replyAnnot(a, b)
                })
            }

            function g(a, b) {
                var c = l.getAnnotsCount();
                0 >= c || (b.isReply ? m.removeAnnotContent(b) : (m.triggerDeleteAnnot(b.annotName, b.pageIndex), c--, l.setAnnotsCount(c), m.updateAnnotCount(c)), m.resizeScrollBar())
            }

            function h(a, b) {
                m.triggerDeleteAnnot(b, b.pageIndex), b.isReply || m.updateAnnotCount(b.pageIndex, !1)
            }
            var i = b,
                j = this,
                k = new WebPDF.Annot.PDFAnnotationLoader,
                l = a("core/Plugins/CommentList/CommentListService").createCommentListService(b, k),
                m = null;
            if (navigator.userAgent.match(/mobile|Android|iPhone|ios|iPod/i)) {
                var n = a("core/Plugins/CommentList/MobileCommentListView");
                m = new n(b)
            } else {
                var o = a("core/Plugins/CommentList/PCCommentListView");
                m = new o(b)
            }
            i.isCommentlistEventInit() || (c(), i.setCommentlistEventInit(!0)), this.getName = function() {
                return WebPDF.CommentListPluginName
            }, this.onRegister = function() {}, this.init = function() {}, this.unload = function() {}, this.resizeScrollBar = function() {
                m.resizeScrollBar()
            }, this.loadAnnot = function() {
                l.loadAnnots(function(a, b, c) {
                    a ? (m.loadAnnots(a, b, c), j.resizeScrollBar()) : m.initCLPanel(), d()
                }, $.noop, !1)
            }
        }, b.createPlugin = function(a) {
            return new WebPDF.CommentListPlugin(a)
        }
    }), define("core/Plugins/CommentList/CommentListService", [], function(a, b, c) {
        function d(a, b) {
            function c() {
                var a = e.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    b = null;
                return a ? b = a.getAnnotHandlerMgr() : void 0
            }

            function d(a, b, d) {
                function j(a, b, d) {
                    var e = {};
                    e.pageIndex = a, e.annotsArr = [];
                    for (var f = c(), g = 0; g < b.length; g++) {
                        var h = d.getAnnotByName(b[g].n);
                        h && f.needShowComment(h.getSubType()) && e.annotsArr.push(f.packageAnnot(h))
                    }
                    k.push(e)
                }
                var k = [],
                    l = e.getMainView().getDocView(),
                    m = l.getPageAnnotUnLoad();
                return i && !d ? !1 : m.length <= 0 ? (h = !1, a(), !1) : (f.asyncLoadCommentAnnotation(e, e.getPDFDoc(), m, Configs.CommentList.requestAnnots, function(b) {
                    for (var c = b.length, d = 0; c > d; d++) {
                        var e = l.getPageView(b[d]),
                            f = e.getPDFPage(),
                            i = f.getCommentListAnnotCount();
                        if (g += i, i) {
                            var n = f.getAnnotJsonData();
                            j(b[d], n, f)
                        }
                    }
                    h = m.length > 0 ? !0 : !1, a(k, g, h)
                }, b), void(i = !0))
            }
            var e = a,
                f = b,
                g = 0,
                h = !0,
                i = !1,
                j = null,
                k = null;
            this.setViewCallBack = function(a, b) {
                j = a, k = b
            }, this.replyAnnot = function(a, b) {
                var d = c();
                d.replyAnnot(a, b)
            }, this.updateAnnotContent = function(a, b, d) {
                var f = c();
                f.updateAnnotContent(a, b, d);
                var g = e.getPDFDoc().getPage(a),
                    h = g.getAnnotByName(b);
                if (h) {
                    var i = {
                        annot: f.packageAnnot(h),
                        pageIndex: a,
                        annotObject: h
                    };
                    $(e).trigger(WebPDF.EventList.ANNOT_UPDATED, i)
                }
            }, this.deleteAnnot = function(a, b) {
                var d = e.getMainView().getDocView(),
                    f = d.getPageView(a),
                    g = f.getPDFPage(),
                    h = g.getAnnotByName(b),
                    i = {},
                    j = c();
                if (h && !h.isReply) {
                    var k = j.getAnnotHandlerByAnnot(h);
                    k.deleteAnnot(f, h), h.isSourceAnnot ? (h.hide(), h.setDel(1)) : i[b] = 1;
                    var l = !1,
                        m = [];
                    if (h.getGrp && h.getGrp()) {
                        m.push(h.annotJSONData);
                        var n = g.getAnnotByName(h.getGrp()),
                            k = j.getAnnotHandlerByAnnot(n);
                        k.deleteAnnot(f, n), h.isSourceAnnot ? (n.hide(), n.setDel(1)) : i[h.getGrp()] = 1, l = !0, m.push(n.annotJSONData)
                    }
                    f.getPDFPage().deleteAnnots(i), e.setModified(f, f.getDocView(), !0), l || m.push(h.annotJSONData);
                    var o = new WebPDF.Annot.Undo(a, WebPDF.Annot.UndoType.ANNOT_DELETE, m);
                    e.addAnnotUndo(o), $(e).trigger(WebPDF.EventList.ANNOT_DELETED, {
                        annotName: b,
                        pageIndex: a,
                        isReply: h.isReply,
                        annotObject: h
                    })
                } else h.isReply && j.deleteReplyAnnot(a, b, !0)
            }, this.loadAnnots = function(a, b, c) {
                d(a, b, c)
            }, this.getAnnotsCount = function() {
                return g
            }, this.setAnnotsCount = function(a) {
                g = a
            }, this.clearInitFlag = function() {
                i = !1
            }
        }
        var e = null;
        b.createCommentListService = function(a, b) {
            return null == e && (e = new d(a, b)), e
        }
    }), define("core/Plugins/CommentList/MobileCommentListView", ["core/Common/Interface", "core/WebPDF", "core/Plugins/CommentList/CommentListView"], function(a, b, c) {
        function d(a) {
            d.superclass.constructor.call(this, a), C = a, D = this
        }

        function e(a, b, c) {
            var d = C.getMainView().getDocView(),
                e = d.getPageView(a),
                f = e.getPDFPage(),
                g = f.getAnnotByName(b),
                h = new Date,
                i = h.valueOf() + 6e4 * h.getTimezoneOffset(),
                j = Math.floor(i / 1e3).toString();
            g.getContents() !== c && (g.setContents(c), g.setModifyDate(j), D.insertPopUpHtml(e, g, b, c), e.setModified(!0), d.setModified(!0));
            var k = D.getAnnotMgr();
            return k.packageAnnot(g)
        }

        function f(a) {
            var b = $(".fwrm-annot-edit"),
                c = $(a.target).closest("li"),
                d = $(c).attr("page-index"),
                f = $(c).attr("annot-name"),
                g = a.target.innerText,
                h = e(d, f, g);
            return u(h), b.hide(), !1
        }

        function g(a) {}

        function h(a) {
            if ("undefined" != typeof window.getSelection && "undefined" != typeof document.createRange) {
                var b = document.createRange();
                b.selectNodeContents(a), b.collapse(!1);
                var c = window.getSelection();
                c.removeAllRanges(), c.addRange(b), a.focus()
            } else if ("undefined" != typeof document.body.createTextRange) {
                var d = document.body.createTextRange();
                d.moveToElementText(a), d.collapse(!1), d.select()
            }
        }

        function i(a) {
            var b = new Hammer(a);
            b.add(new Hammer.Tap({
                event: "doubletap",
                taps: 2
            })), b.add(new Hammer.Tap({
                event: "tap"
            })), b.get("doubletap").recognizeWith("tap"), b.get("tap").requireFailure("doubletap"), b.off("doubletap").on("doubletap", function(a) {
                $(".cmtlist-content-editting").blur(), $(".cmtlist-content-editting").removeClass("cmtlist-content-editting"), $(".annot-content").attr("contenteditable", "false");
                var b = $(a.target).closest(".annot-body"),
                    c = b.find("svg");
                if ("FreeText" === $(c).attr("annot-type")) return !1;
                var d = $(b).find("p");
                return $(d[0]).attr("contenteditable", "true"), $(d[0]).addClass("cmtlist-content-editting"), h(d[0]), !1
            }).off("tap").on("tap", function(a) {
                var b = $(a.target).closest(".annot-class");
                if ($(a.target).hasClass("cmtlist-content-editting")) return !1;
                var c = $(b).attr("page-index"),
                    d = $(b).attr("annot-name");
                return $(".cmtlist-content-editting").blur(), $(".cmtlist-content-editting").removeClass("cmtlist-content-editting"), $(".annot-content").attr("contenteditable", "false"), D.gotoPosition(c, d), $("#fwrm-panel").hide(), !1
            })
        }

        function j(a, b, c) {
            var d = o(a),
                e = z.find(".more-annot");
            if (c) {
                if (0 === e.length) {
                    var f = '<div class="more-annot"><span><svg><use xlink:href="#icon-more"></use></svg></span></div>';
                    B = !0, z.append(f)
                }
            } else $(".more-annot").hide();
            if (a.length > 0) {
                var g = a[a.length - 1].pageIndex;
                t(d, g)
            }
        }

        function k() {
            var a = z.offset().top,
                b = $(window).height();
            z.height(b - a)
        }

        function l(a) {
            for (var b = 0, c = 0; c < a.length; c++) a[c].visible && b++;
            return b
        }

        function m(a, b) {
            var c = $(".fwrm-comment-warp li[page-index=" + a + "]>.page-desc>em"),
                d = c.html();
            b ? d++ : d--, c.html(d)
        }

        function n(a, b) {
            var c = $(".fwrm-comment-warp li[page-index=" + a + "]>.page-desc>em");
            c.html(b)
        }

        function o(a) {
            for (var b = "", c = 0; c < a.length; c++) {
                var d = !1,
                    e = "",
                    f = a[c].annotsArr;
                e += "<li page-index=" + a[c].pageIndex + '><div class="page-desc">', e += i18n.t("CommentList.Page") + (parseInt(a[c].pageIndex) + 1), e += "</span><em>" + l(f) + "</em></div><ul>";
                for (var g = 0; g < f.length; g++) {
                    var h = "";
                    f[g].visible && (d = !0, h += p(a[c].annotsArr[g], a[c].pageIndex, !1), e += h)
                }
                e += "</ul></li>", d || (e = ""), b += e
            }
            return b
        }

        function p(a, b, c, d) {
            var e = "",
                f = "",
                g = "";
            return c && (f = "selected "), d || (g = "annot-class "), e += '<li class="' + f + g + 'annot-insert" page-index="' + b + '" annot-name="' + a.annotName + '">', e += '<div class="annot-box">', e += '<div class="annot-body"><div class="annot-title">', e += '<div class="annot-title-left">', d ? svgIcon = '<svg><use xlink:href="#icon-annot-reply"></use></svg>' : svgIcon = r(a.subType), "Line" === a.subType && "LineArrow" == a.IT && (svgIcon = '<svg><use xlink:href="#icon-annots-arrow-hover"></use></svg>'), "FreeText" === a.subType && "FreeTextCallout" === a.annotJSONData.it && (svgIcon = '<svg annot-type="FreeText"><use xlink:href="#icon-callout-hover"></use></svg>'), e += '<span class="icon-comment">' + svgIcon + "</span>", e += "</div>", e += d ? "<h4>" + a.subject + "</h4>" : "<h4>" + a.title + "</h4>", e += "<em>" + y.timestampToDateString(a.modifyDate, y.AnnotTimeFormat) + "</em>", e += "</div>", e += '<p class="annot-content" style="min-height:24px">' + y.htmlEncodeEx(a.contents) + "</p></div>", e += '<i><svg annot-type="' + a.subType + '"><use xlink:href="#icon-more"></use></svg></i>', e += "</div>", e += q(a, b), e += "</li>"
        }

        function q(a, b) {
            var c = "";
            if (a.hasOwnProperty("getReplyChain")) {
                var d = a.getReplyChain,
                    e = d.length;
                if (e > 0) {
                    c += "<ul>";
                    for (var f = 0; e > f; f++) c += p(d[f], b, !1, !0);
                    c += "</ul>"
                }
            }
            return c
        }

        function r(a) {
            var b = "";
            switch (a) {
                case "Highlight":
                    b = '<svg><use xlink:href="#icon-highlight-hover"></use></svg>';
                    break;
                case "Text":
                    b = '<svg><use xlink:href="#icon-note-hover"></use></svg>';
                    break;
                case "Squiggly":
                    b = '<svg><use xlink:href="#icon-annot-squiggly-panel"></use></svg>';
                    break;
                case "StrikeOut":
                    b = '<svg><use xlink:href="#icon-annot-strikeout-panel"></use></svg>';
                    break;
                case "Ink":
                    b = '<svg><use xlink:href="#icon-pencil-hover"></use></svg>';
                    break;
                case "Underline":
                    b = '<svg><use xlink:href="#icon-underline-hover"></use></svg>';
                    break;
                case "FreeText":
                    b = '<svg annot-type="FreeText"><use xlink:href="#icon-typewriter-hover"></use></svg>';
                    break;
                case "Square":
                    b = '<svg><use xlink:href="#icon-annots-rectangle-hover"></use></svg>';
                    break;
                case "Circle":
                    b = '<svg><use xlink:href="#icon-annots-ellipse-hover"></use></svg>';
                    break;
                case "Polygon":
                    b = '<svg><use xlink:href="#icon-annots-polygon-hover"></use></svg>';
                    break;
                case "PolyLine":
                    b = '<svg><use xlink:href="#icon-annots-polyline-hover"></use></svg>';
                    break;
                case "Line":
                    b = '<svg><use xlink:href="#icon-annots-line-hover"></use></svg>';
                    break;
                case "Stamp":
                    b = '<svg><use xlink:href="#icon-annot-stamp-hover"></use></svg>';
                    break;
                default:
                    b = '<svg><use xlink:href="#icon-comment-reply"></use></svg>'
            }
            return b
        }

        function s(a, b, c, d) {
            if ($(".fwrm-comment-warp li[annot-name=" + a.annotName + "]")[0]) return !1;
            var e = "";
            e = p(a, b, !1, a.isReply);
            var h = $(".fwrm-comment-warp>ul>li[page-index=" + b + "]>ul");
            if (h[0]) {
                if (parentDOM = h, a.parent) {
                    var j = $(".fwrm-comment-warp [annot-name=" + a.parent + "]"),
                        k = j.children("ul")[0];
                    k && 0 != k.length ? parentDOM = $(k) : (parentDOM = j, e = "<ul>" + e + "</ul>")
                }
                if (parentDOM.append(e), "cmt" == a.from) {
                    var l = $(parentDOM.find('[annot-name="' + a.annotName + '"] .annot-body p')[0]);
                    l.attr("contenteditable", "true"), l.focus()
                }
            } else {
                var m = "<li page-index=" + b + '><div class="page-desc">';
                m += i18n.t("CommentList.Page"), m += b + 1 + "<em>0</em></div><ul>", m += e, m += "</ul></li>", t(m, b), parentDOM = $($(".fwrm-comment-warp>ul>li[page-index=" + b + "]>ul"))
            }
            if (d === !1) {
                var n = $(".fwrm-comment-warp [annot-name=" + a.annotName + "]");
                n.hide(), n.parent().siblings(".page-desc").hide()
            }
            var o = parentDOM.find('[annot-name="' + a.annotName + '"] .annot-body')[0];
            i(o);
            var l = $(o).find("p");
            return $(l).off("blur").on("blur", f).off("keydown").on("keydown", g), !0
        }

        function t(a, b) {
            var c = 0,
                d = 0;
            $(".fwrm-comment-warp>ul>li[page-index]").each(function(a, e) {
                return d = parseInt($(e).attr("page-index")), d > b ? (c = d, !1) : void 0
            });
            var e = $(".fwrm-comment-warp>ul>li[page-index=" + c + "]");
            e && c > b ? e.before(a) : $(".fwrm-comment-warp>ul").append(a)
        }

        function u(a) {
            var b = $(".fwrm-comment-warp li[annot-name=" + a.annotName + "]>.annot-box"),
                c = b.find("p").html(),
                d = a.contents;
            y.htmlEncodeEx(a.contents) !== c && (b.find("p").html(y.htmlEncodeEx(d)), a.isReply ? b.find("h4").html(a.subject) : b.find("h4").html(a.title), b.find("em").html(y.timestampToDateString(a.modifyDate, y.AnnotTimeFormat)))
        }

        function v(a, b) {
            if (a.isReply) $(".fwrm-panel-commentlist li[annot-name=" + a.annotName + "]").remove();
            else {
                var c = $(".fwrm-comment-warp>ul>li[page-index=" + b + "]>ul>li").size(),
                    d = $(".fwrm-comment-warp>ul>li[page-index=" + b + "]>ul>li:visible").size();
                1 === c ? $(".fwrm-comment-warp>ul>li[page-index=" + b + "]").remove() : (1 === d && $(".fwrm-comment-warp>ul>li[page-index=" + b + "]>.page-desc").hide(), $(".fwrm-panel-commentlist li[annot-name=" + a.annotName + "]").remove())
            }
        }

        function w(a, b, c) {
            for (var d = 0; d < a.length; d++)
                for (var e = a[d].annotsArr, f = 0; f < e.length; f++) e[f].visible && (s(e[f], a[d].pageIndex, !1), m(a[d].pageIndex, !0));
            c || $(".more-annot").hide(), B = !0
        }

        function x() {
            $(".fwrm-comment-warp").off("tap", "i").on("tap", "i", function(a) {
                var b = $(".fwrm-annot-menu"),
                    c = $(this).offset().top + $(this).height() + 10,
                    d = $(this).offset().left + $(this).width() - b.width(),
                    e = $(this).siblings(".annot-body").find("svg");
                "FreeText" === e.attr("annot-type") ? (b.find("li.edit").hide(), b.find("li.reply").hide()) : ("none" === b.find("li.edit").css("display") && b.find("li.edit").show(), b.find("li.reply").show()), c + b.height() > $(window).height() && (c = c - b.height() - $(this).height() - 10);
                var f = $(this).parents("li").attr("page-index"),
                    g = $(this).parents("li").attr("annot-name");
                return b.attr("page-index", f), b.attr("annot-name", g), b.css({
                    top: c,
                    left: d
                }), b.show(), !1
            }), $(".fwrm-panel-commentlist").off("tap").on("tap", function() {
                $(".fwrm-annot-menu").hide()
            }), $(".fwrm-annot-edit .cancel").off("tap").on("tap", function() {
                var a = $(".fwrm-annot-edit");
                return a.hide(), !1
            }), $(".annot-content").off("blur").on("blur", f).off("keydown").on("keydown", g);
            for (var a = $(".annot-body"), b = 0; b < a.length; b++) i(a[b])
        }
        var y = WebPDF.Common;
        $("#fwrm-panel-commentlist").attr("class", "fwrm-panel-commentlist");
        var z = $(".fwrm-panel-commentlist"),
            A = !1,
            B = !0,
            C = null,
            D = null,
            E = a("core/Common/Interface"),
            F = a("core/Plugins/CommentList/CommentListView");
        return d.prototype = {
            initView: function() {
                if (!(z.find(".fwrm-comment-warp").length > 0)) {
                    k();
                    var a = "";
                    a += '<div class="fwrm-comment-warp">', a += '<div class="hide-tip">' + i18n.t("CommentList.HideTip") + "</div>", a += "<ul>", a += "</ul>", a += "</div>";
                    var b = '<div class="fwrm-annot-edit">';
                    b += '<div class="edit-header"><span class="cancel">Cancel</span><span class="ok">OK</span></div>', b += '<div class="edit-content" contenteditable="true"></div>', b += "</div>", b += '<ul class="fwrm-annot-menu">', b += '<li class="reply">' + i18n.t("Annot.Reply") + "</li>", b += '<li class="edit">' + i18n.t("CommentList.Edit") + "</li>", b += '<li class="delete">' + i18n.t("CommentList.Delete") + "</li>", b += "</ul>", b += "</div>", $("#fwrm-panel").append(b), z.append(a), x(), A = !0
                }
            },
            isInit: function() {
                return $("#docViewer_fxCommentListPanel").hasClass("fwr-commentlist-panel")
            },
            clear: function() {
                $("#fwrm-panel-commentlist").html("")
            },
            loadAnnots: function(a, b, c) {
                j(a, b, c)
            },
            isCommentlistLoad: function() {
                return A
            },
            resizeScrollBar: function() {},
            triggerUpdateAnnot: function(a, b) {
                u(b.annot)
            },
            triggerAddAnnot: function(a, b, c) {
                var d = b.annotsArr,
                    e = parseInt(b.pageIndex),
                    f = $(".fwrm-comment-warp li[page-index=" + e + "]>.page-desc>em").html();
                if (f || (f = 0), b.annot) {
                    $(".hide-tip").hide();
                    var g = $(".fwrm-comment-warp>ul>li[page-index=" + e + "]>.page-desc"),
                        h = g.css("display");
                    "none" === h && g.show(), s(b.annot, e, !0), b.annot.isReply || m(e, !0)
                } else if (d.length > 0) {
                    for (var i = 0; i < d.length; i++) {
                        var j = d[i];
                        d[i].visible && (b.isShow ? s(j, e, !1) && f++ : s(j, e, !1, !1))
                    }
                    n(e, f)
                }
                var k = b.pageAnnotUnload;
                return k && k.length <= 0 && $(".more-annot").hide(), f
            },
            triggerAnnotVisibleChanged: WebPDF.Common.debounce(function(a, b) {
                for (var c = 0, d = 0, e = WebPDF.ViewerInstance.getPageCount(), f = WebPDF.Common.getReaderApp().getMainView().getDocView(), g = 0; e > g; g++) {
                    var h = f.getPDFDoc().getPage(g),
                        i = 0;
                    h.enumAnnots(function(a) {
                        if (a && !a.isAnnotDel() && a.isVisible()) {
                            var e = $(".fwrm-comment-warp>ul>li>ul>li[annot-name='" + a.getAnnotName() + "']");
                            if (!(e.length <= 0)) {
                                if (c++, !a.isShowInViewer() || !b.isShow && b.isCommentsMenuClick) return void e.hide();
                                e.show(), d++, i++
                            }
                        }
                    }), i > 0 ? $(".fwrm-comment-warp>ul>li[page-index=" + g + "]>.page-desc").show() : $(".fwrm-comment-warp>ul>li[page-index=" + g + "]>.page-desc").hide()
                }
                if (c > 0 && 0 >= d) {
                    if (!b.isCommentsMenuClick) return;
                    return $(".fwrm-comment-warp .annot-insert").removeClass("annot-insert"), $(".more-annot").hide(), void $(".hide-tip").show()
                }
                var j = b.pageAnnotUnload;
                j.length <= 0 ? $(".more-annot").hide() : $(".more-annot").show(), $(".fwrm-comment-warp .annot-insert").removeClass("annot-insert"), $(".hide-tip").hide()
            }, 0),
            triggerAnnotSelected: function(a, b) {},
            triggerDeleteAnnot: function(a, b) {
                v(a, b)
            },
            updateAnnotCount: function(a, b) {
                m(a, b)
            },
            onDeleteOrReplyAnnot: function(a, b) {
                $(".fwrm-annot-menu").off("tap", "li").on("tap", "li", function() {
                    var c = $(".fwrm-annot-menu"),
                        d = c.attr("page-index"),
                        e = c.attr("annot-name");
                    if ($(this).hasClass("edit")) {
                        $(".annot-content").attr("contenteditable", "false");
                        var f = $(".fwrm-panel-commentlist li[annot-name=" + e + "]>.annot-box>.annot-body>p");
                        $(f).attr("contenteditable", "true"), $(f).addClass("cmtlist-content-editting"), h(f[0])
                    } else $(this).hasClass("delete") ? a(d, e) : $(this).hasClass("reply") && b(d, e);
                    return c.hide(), !1
                })
            },
            onMoreAnnot: function(a) {
                $(".more-annot").off("tap").on("tap", function() {
                    B && (B = !1, a(function(a, b, c) {
                        w(a, b, c)
                    }, $.noop))
                })
            },
            initCLPanel: function() {}
        }, E.extend(d, F), d
    }), define("core/Plugins/CommentList/CommentListView", [], function(a, b, c) {
        function d(a) {
            e = a, f = this, g = new WebPDF.Annot.AnnotUIManager(this, e)
        }
        var e = (WebPDF.RectUtils, WebPDF.PDFRect, null),
            f = null,
            g = null;
        return d.prototype.init = function() {
            this.initView()
        }, d.prototype.insertPopUpHtml = function(a, b, c, d) {
            if (b.isReply) {
                var e = $($("#" + c).children()[0]).children()[5];
                $(e).html(WebPDF.Common.htmlEncodeEx(d))
            } else {
                var f = $("#" + g.getAnnotPopupDivID(a, b.getAnnotName()));
                f.find("#fwrm-popup-content").html(WebPDF.Common.htmlEncodeEx(d))
            }
        }, d.prototype.getOffset2Scroll = function(a, b) {
            return a.getOffsetByAnnotRect(b)
        }, d.prototype.gotoPosition = function(a, b) {
            var c = e.getMainView().getDocView();
            c.gotoPageByAnnot(a, b, !0)
        }, d.prototype.getAnnotMgr = function() {
            var a = e.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME);
            return a ? a.getAnnotHandlerMgr() : void 0
        }, d
    }), define("core/Plugins/CommentList/PCCommentListView", ["core/Common/Interface", "core/WebPDF", "core/Plugins/CommentList/CommentListView"], function(a, b, c) {
        function d(a, b, c) {
            d.superclass.constructor.call(this, a, b, c), z = a, D = z.getOptions(), A = this
        }

        function e() {
            var a = $("#navigationPanel").outerWidth(),
                b = $("#navigation").outerHeight(),
                c = 0;
            "block" === $("#fields_highlight").css("display") && (c = $("#fields_highlight").outerHeight()), $("#docViewer_fxCommentListPanel").css({
                width: a + "px",
                height: b - c + "px"
            }), $(".dtree-wrap").css({
                width: a + "px",
                height: b - 58 - c + "px"
            }), C && C.reinitialise()
        }

        function f(a, b, c) {
            y ? E && (h(a, b, c), t()) : r(a, b, c), e()
        }

        function g(a) {
            var b = $(a);
            for (i = 0; i < b.length; i++) titleDom = b[i], $(titleDom).css("display", "inline"), $(titleDom).width() && $(".dtree-content").width() && $(titleDom).width() > $(titleDom).closest("li").width() - 17 && ($(titleDom).css({
                "text-overflow": "ellipsis",
                overflow: "hidden",
                display: "block"
            }), $(titleDom).off("mouseover").on("mouseover", function(a) {
                $("#pupup-replyannot-span").html($(titleDom).html()), $("#pupup-replyannot-span").css({
                    left: a.pageX + 10,
                    top: a.pageY + 18
                }), $("#pupup-replyannot-span").show()
            }), $(titleDom).off("mouseleave").on("mouseleave", function() {
                $("#pupup-replyannot-span").hide()
            })), $(titleDom).css("display", "block")
        }

        function h(a, b, c) {
            if (a.length > 0) {
                var d = a[a.length - 1].pageIndex,
                    e = j(a);
                "" !== e && (n(e, d), s(b))
            }
            var f = $(".dtree-content").find(".more");
            if (c) {
                if (0 == f.length) {
                    var h = '<div class="more">' + i18n.t("PCLng.Panel.ShowMore") + "</div>";
                    y = !0, $(".dtree-content").append(h)
                }
            } else $(".dtree-content .more").hide();
            H || g(".dtree-content .fwr-cmtReply-title"), H = !0
        }

        function j(a) {
            for (var b = "", c = 0; c < a.length; c++) {
                var d = !1,
                    e = "";
                e += "<li page-index=" + a[c].pageIndex + '><div class="page-desc"><em class="open"></em><span>', e += i18n.t("CommentList.Page") + (parseInt(a[c].pageIndex) + 1) + '</span><div class="line"></div></div><ul>';
                for (var f = a[c].annotsArr, g = 0; g < f.length; g++) {
                    var h = "";
                    f[g].visible && (h += k(f[g], a[c].pageIndex, !1), "" === h ? d = !1 : (d = !0, e += h))
                }
                e += "</ul></li>", d || (e = ""), b += e
            }
            return b
        }

        function k(a, b, c, d) {
            if ($(".dtree-content li[page-index = " + b + '][annot-name="' + a.annotName + '"]')[0]) return "";
            var e = "",
                f = "",
                g = "";
            return c && (f = "selected "), g = "annot-class ", e += '<li class="' + f + g + 'annot-insert" page-index="' + b + '" annot-name="' + a.annotName + '" annot-title="' + a.title + '">', e += '<div class="annot-box">', d ? (emStyle = 'style="float:left"', labelBegin = "<div class='fwr-cmtReply-title'>", labelEnd = "</div>") : (emStyle = "", labelBegin = "<span>", labelEnd = "</span>"), e += '<em class="open" ' + emStyle + "></em>" + labelBegin + a.subject + labelEnd, e += '<div class="desc"><h4>' + a.title + "</h4><i>", e += w.timestampToDateString(a.modifyDate, w.AnnotTimeFormat), e += "</i></div>", e += "cmt" == a.from ? '<p style="min-height:18px" class="first-display" contenteditable="true">' + w.htmlEncodeEx(a.contents) + "</p>" : '<p style="min-height:18px">' + w.htmlEncodeEx(a.contents) + "</p>",
                e += '<div class="control">', z.isAnnot() && ("FreeText" !== a.subType && (e += '<span class="cmtCtrl reply desc">' + i18n.t("CommentList.Reply") + "</span>"), e += '<span class="cmtCtrl del"  style="float: right;">' + i18n.t("CommentList.Delete") + "</span>"), e += "</div>", e += '<div class="line"></div>', e += "</div>", e += l(a, b), e += "</li>"
        }

        function l(a, b) {
            var c = "";
            if (a.hasOwnProperty("getReplyChain")) {
                var d = a.getReplyChain,
                    e = d.length;
                if (e > 0) {
                    var f = a.isParentReply ? "style='padding:0'" : "";
                    c += "<ul " + f + ">";
                    for (var g = 0; e > g; g++) c += k(d[g], b, !1, !0);
                    c += "</ul>"
                }
            }
            return c
        }

        function m(a, b, c, d) {
            if ($(".dtree-content li[page-index = " + b + '][annot-name="' + a.annotName + '"]')[0]) return !1;
            var e = "";
            c ? ($(".dtree-content .selected").removeClass("selected"), e = k(a, b, !0, a.isReply)) : e = k(a, b, !1, a.isReply);
            var f = $(".dtree-content>ul>li[page-index=" + b + "]>ul");
            if (f[0])
                if (a.parent) {
                    var h = $(".dtree-content li[page-index = " + b + '][annot-name="' + a.parent + '"]'),
                        i = h.children("ul")[0],
                        j = a.isParentReply ? "style='padding:0'" : "";
                    i && 0 != i.length ? $(i).append(e) : h.append("<ul " + j + ">" + e + "</ul>")
                } else f.append(e);
            else {
                var l = "<li page-index=" + b + ">";
                l += '<div class="page-desc">', l += '<em class="open"></em><span>' + i18n.t("CommentList.Page"), l += b + 1 + '</span><div class="line"></div></div><ul>', l += e, l += "</ul></li>", n(l, b)
            }
            if (d === !1) {
                var m = $(".dtree-content [annot-name=" + a.annotName + "]");
                m.hide(), m.parent().siblings(".page-desc").hide()
            }
            return g(".dtree-content [annot-name='" + a.annotName + "'] .fwr-cmtReply-title"), $(".first-display").focus(), a.isReply ? !1 : !0
        }

        function n(a, b) {
            var c = 0,
                d = 0;
            $(".dtree-content>ul>li[page-index]").each(function(a, e) {
                return d = parseInt($(e).attr("page-index")), d > b ? (c = d, !1) : void 0
            });
            var e = $(".dtree-content>ul>li[page-index=" + c + "]");
            e && c > b ? e.before(a) : $(".dtree-content>ul").append(a)
        }

        function o(a) {
            var b = $(".dtree-content [annot-name=" + a.annotName + "]>.annot-box"),
                c = b.find("p"),
                d = b.find("h4"),
                e = a.contents,
                f = a.title,
                g = c.html(),
                h = d.text();
            w.htmlEncodeEx(e) !== g && c.html(w.htmlEncodeEx(e)), f !== h && d.text(a.title), b.find("i").text(w.timestampToDateString(a.modifyDate, w.AnnotTimeFormat))
        }

        function p(a, b) {
            if (!C) return !1;
            var c = $(".dtree-content li[annot-name=" + a + "][page-index=" + b + "]"),
                d = c.position().top,
                e = $(".dtree-wrap").height(),
                f = c.height(),
                g = d - e / 2 + f;
            d > e - f ? C.scrollToY(g) : C.scrollToY(0)
        }

        function q(a, b) {
            var c = $(".dtree-content>ul>li[page-index=" + b + "]>ul>li"),
                d = c.size(),
                e = 0;
            c.each(function(a, b) {
                "none" !== this.style.display && e++
            }), 1 === d ? $(".dtree-content>ul>li[page-index=" + b + "]").remove() : (1 === e && $(".dtree-content>ul>li[page-index=" + b + "]>.page-desc").hide(), $(".dtree-content [annot-name=" + a + "]").remove())
        }

        function r(a, b, c) {
            for (var d = 0; d < a.length; d++)
                for (var e = a[d].annotsArr, f = 0; f < e.length; f++) e[f].visible && m(e[f], a[d].pageIndex, !1);
            $(".dtreebar em").html(b), c || $(".dtree-content .more").hide(), y = !0
        }

        function s(a) {
            var b = "";
            b = a > 1 ? i18n.t("CommentList.Comments") : i18n.t("CommentList.Comment"), $(".dtreebar .ml5").html(b), $(".dtreebar em").html(a)
        }

        function t() {
            null == C && (v(), u())
        }

        function u() {
            $(".dtree-openall").off("click").on("click", function() {
                $(".dtree-content>ul").find("ul").show(), $(".dtree-content>ul").find(".desc").show(), $(".dtree-content>ul").find(".close").addClass("open").removeClass("close"), e()
            }), $(".dtree-content").off("click", ".first-display").on("click", ".first-display", function() {
                return !1
            }), $(".dtree-closeall").off("click").on("click", function() {
                $(".dtree-content>ul").find("ul").hide(), $(".dtree-content>ul").find(".open").addClass("close").removeClass("open"), e()
            }), $(".dtree-content").off("click", "em").on("click", "em", function() {
                var a = $(this).parent();
                return $(this).hasClass("open") ? (a.siblings("ul").hide(), $(this).siblings(".desc").hide(), $(this).removeClass("open").addClass("close"), $($(this).siblings()[0]).hasClass("fwr-cmtReply-title") || $(this).css("float", "left")) : ($(this).siblings(".desc").show(), $(this).parent().siblings("ul").show(), $(this).removeClass("close").addClass("open")), e(), !1
            })
        }

        function v() {
            if (null == C) {
                var a = {
                        showArrows: !1,
                        animateScroll: !1,
                        contentWidth: 181
                    },
                    b = "";
                switch (D.scrollBarType) {
                    case WebPDF.PDFView.ScrollBarType.CUSTOM_SCROLL_BAR:
                        b = $(".dtree-wrap").fwrJScrollPane(a);
                        break;
                    case WebPDF.PDFView.ScrollBarType.NATIVE_SCROLL_BAR:
                        b = $(".dtree-wrap").WebPDFNativeScroll(a);
                        break;
                    default:
                        $.error("Unsupported type of scroll bar.")
                }
                return C = b.data("jsp")
            }
        }
        var w = WebPDF.Common,
            x = ($(".fwrm-panel-commentlist"), $("#commentListBtn"), $("#navigationPanel"), $("#navigationPanelClose"), $("#navigationPanelTitle"), !1),
            y = !0,
            z = null,
            A = null,
            B = null,
            C = null,
            D = null,
            E = !0,
            F = a("core/Common/Interface"),
            G = a("core/Plugins/CommentList/CommentListView");
        d.prototype = {
            initView: function() {
                var a = '<div id="docViewer_fxCommentListPanel" class="fwr-commentlist-panel"';
                a += 'style="height:100%;overflow: hidden;outline: none; display:none">', a += '<div class="dtreebar"><span class="dtree-openall mr12" title="' + i18n.t("CommentList.Expand") + '"></span>', a += '<span class="dtree-closeall mr12" title="' + i18n.t("CommentList.Collapse") + '"></span>', a += '<em>0</em><span class="ml5">' + i18n.t("CommentList.Comment") + "</span></div>", a += '<div class="hide-tip">' + i18n.t("CommentList.HideTip") + "</div>", a += '<div class="dtree-wrap"><div class="dtree-content"><ul>', a += "</ul>", a += "</div></div>", a += "</div>", $("#navigationPanel").append(a), B = $("#docViewer_fxCommentListPanel"), x = !0
            },
            isInit: function() {
                return $("#docViewer_fxCommentListPanel").hasClass("fwr-commentlist-panel")
            },
            clear: function() {
                B && (B.empty(), B.remove(), B = null), C && (C = null), x = !1
            },
            resizeScrollBar: function() {
                e()
            },
            loadAnnots: function(a, b, c) {
                f(a, b, c), y || (c || $(".dtree-content .more").hide(), y = !0);
                for (var d = 0; d < a.length; d++)
                    for (var e = a[d].annotsArr, g = 0; g < e.length; g++) m(e[g], a[d].pageIndex, !1, !0)
            },
            isCommentlistLoad: function() {
                return x
            },
            triggerAddAnnot: function(a, b, c) {
                t();
                var d = c,
                    f = b.annotsArr,
                    g = parseInt(b.pageIndex);
                if (b.annot) {
                    $(".hide-tip").hide();
                    var h = $(".dtree-content>ul>li[page-index=" + g + "]>.page-desc"),
                        i = h.css("display");
                    "none" === i && h.show();
                    var j = $.extend(b.annot, {
                            annotJSONData: b.annotJson ? b.annotJson.annotJSONData : {}
                        }),
                        k = b.isSelect;
                    "undefined" == typeof b.isSelect && (k = !0), m(j, g, k) && d++
                } else if (f.length > 0)
                    for (var l = 0; l < f.length; l++) {
                        var n = f[l];
                        f[l].visible && (b.isShow ? m(n, g, !1) && d++ : m(n, g, !1, !1))
                    }
                var o = b.pageAnnotUnload;
                return o && o.length <= 0 && $(".dtree-content .more").hide(), s(d), e(), d
            },
            triggerAnnotVisibleChanged: WebPDF.Common.debounce(function(a, b) {
                var c = 0,
                    d = 0,
                    f = WebPDF.ViewerInstance.getPageCount(),
                    g = WebPDF.Common.getReaderApp().getMainView().getDocView();
                if (z.isLargeFile())
                    if (b.isShow) {
                        var h = b.pageAnnotUnload.reduce(function(a, b) {
                            return a[b] = !1, a
                        }, Array(f).fill(!0)).reduce(function(a, b, c) {
                            return b && a.push(c), a
                        }, []);
                        h.forEach(function(a) {
                            var b = g.getPDFDoc().getPage(a),
                                e = 0;
                            b.enumAnnots(function(a) {
                                if (!a.isAnnotDel() && a.isVisible()) {
                                    var b = B.find("li[annot-name='" + a.getAnnotName() + "']");
                                    if (!(b.length <= 0)) {
                                        if (c++, !a.isShowInViewer()) return void b.hide();
                                        d++, b.show(), e++
                                    }
                                }
                            });
                            var f = B.find(".dtree-content>ul>li[page-index=" + a + "]>.page-desc");
                            e > 0 ? f.show() : f.hide()
                        })
                    } else B.find("li[annot-name]").hide(), B.find(".dtree-content>ul>li[page-index]>.page-desc").hide(), d = 0;
                else
                    for (var i = 0; f > i; i++) {
                        var j = g.getPDFDoc().getPage(i),
                            k = 0;
                        j.enumAnnots(function(a) {
                            if (!a.isAnnotDel() && a.isVisible()) {
                                var e = $("li[annot-name='" + a.getAnnotName() + "']");
                                if (!(e.length <= 0)) {
                                    if (c++, !a.isShowInViewer() || !b.isShow) return void e.hide();
                                    d++, e.show(), k++
                                }
                            }
                        }), k > 0 ? $(".dtree-content>ul>li[page-index=" + i + "]>.page-desc").show() : $(".dtree-content>ul>li[page-index=" + i + "]>.page-desc").hide()
                    }
                return c > 0 && 0 >= d ? $(".hide-tip").show() : $(".hide-tip").hide(), s(d), e(), d
            }, 500, !1),
            triggerAnnotSelected: function(a, b) {
                if (!(z.isOffline() || b.annotName && 0 == $(".dtree-content [annot-name=" + b.annotName + "]").length)) {
                    var c = b.annotName;
                    if ($($(".dtree-content>ul>li>ul").find("li")).removeClass("selected"), c) {
                        $(".dtree-content>ul>li>ul>li").removeClass("selected");
                        var d = WebPDF.Common.getReaderApp().getDocView().getPageView(b.pageIndex).getPDFPage().getAnnotByName(b.annotName),
                            f = d.isReadOnly(),
                            g = d.canReplay();
                        f && $(".dtree-content li[annot-name='" + b.annotName + "'] span[class='cmtCtrl del']").hide(), g || $(".dtree-content li[annot-name='" + b.annotName + "'] span[class='cmtCtrl reply desc']").hide(), $(".dtree-content [annot-name=" + c + "][page-index=" + b.pageIndex + "]").addClass("selected"), p(c, b.pageIndex), e()
                    }
                }
            },
            triggerDeleteAnnot: function(a, b) {
                q(a, b)
            },
            triggerUpdateAnnot: function(a, b) {
                o(b.annot), e()
            },
            onUpdateAnnotContent: function(a) {
                $(".dtree-content").off("blur", ".first-display").on("blur", ".first-display", function() {
                    var b = $(".first-display").html(),
                        c = $($(this).parents("li[annot-name]")[0]),
                        d = c.attr("annot-name"),
                        e = c.attr("page-index");
                    a(e, d, b), $(".first-display").off("click"), $(".first-display").removeAttr("contenteditable"), $(".first-display").removeClass("first-display")
                })
            },
            onDeleteAnnot: function(a) {
                $(".dtree-content").off("click", ".del").on("click", ".del", function() {
                    var b = parseInt($(this).parents(".selected").attr("page-index")),
                        c = $(this).parents(".selected").attr("annot-name");
                    return a(b, c), !1
                })
            },
            onReplyAnnot: function(a) {
                $(".dtree-content").off("click", ".reply").on("click", ".reply", function() {
                    var b = parseInt($(this).parents(".selected").attr("page-index")),
                        c = $(this).parents(".selected").attr("annot-name");
                    return a(b, c), !1
                })
            },
            onGotoPosition: function() {
                $(".dtree-content").off("click", ".annot-class").on("click", ".annot-class", function(a) {
                    $(".dtree-content>ul>li>ul>li").removeClass("selected"), $(this).addClass("selected");
                    var b = parseInt($(this).attr("page-index")),
                        c = $(this).attr("annot-name"),
                        d = WebPDF.Common.getReaderApp().getDocView().getPageView(b).getPDFPage().getAnnotByName(c),
                        f = d.isReadOnly(),
                        g = d.canReplay();
                    return f && $(".dtree-content li[annot-name='" + c + "'] span[class='cmtCtrl del']").hide(), g || $(".dtree-content li[annot-name='" + c + "'] span[class='cmtCtrl reply desc']").hide(), A.gotoPosition(b, c), e(), !1
                })
            },
            onLoadAnnots: function(a) {
                $(".dtree-content").off("click", ".more").on("click", ".more", function() {
                    y && (y = !1, a(f, $.noop, !0))
                })
            },
            updateAnnotCount: function(a) {
                s(a)
            },
            removeAnnotContent: function(a) {
                $(".dtree-content [annot-name=" + a.annotName + "]").remove()
            },
            initCLPanel: function() {
                y && t(), e()
            }
        }, F.extend(d, G), $(window).resize(function() {
            e()
        });
        var H = !1;
        return d
    }), define("core/Plugins/Signature/SignaturePlugin", ["core/Plugins/Signature/SignatureView", "core/Common/Math/Rect", "core/WebPDF", "core/Plugins/Signature/SignatureService", "core/Plugins/Signature/PDFSignature", "core/Common/Math/Point", "core/Plugins/Signature/NormalSigToolHandler", "core/Plugins/Signature/StraddleSigToolHandler", "core/Plugins/Signature/SignatureMouseHandler"], function(a, b, c) {
        var d = (WebPDF.Config, a("core/Plugins/Signature/SignatureView")),
            e = a("core/Plugins/Signature/SignatureService"),
            f = a("core/Plugins/Signature/NormalSigToolHandler"),
            g = a("core/Plugins/Signature/StraddleSigToolHandler");
        a("core/Plugins/Signature/PDFSignature"), a("core/Plugins/Signature/SignatureMouseHandler"), WebPDF.SignaturePlugin = function(a) {
            function b() {
                $(c).on(WebPDF.EventList.PAGE_SHOW_COMPLETE, function(a, b) {
                    var c = this.getPluginByName(WebPDF.SignaturePluginName);
                    c && c.getSigView().onPageShowComplete(b.pageView)
                }).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function(a, b) {
                    var c = this.getPluginByName(WebPDF.SignaturePluginName);
                    c && c.getSigView().onDocViewZoom(b.newScale)
                }).on(WebPDF.EventList.PAGE_VISIBLE, function(a, b) {
                    var d = c.getMainView();
                    if (d) {
                        var e = d.getDocView(),
                            f = this.getPluginByName(WebPDF.SignaturePluginName);
                        if (f)
                            for (var g = 0; g < b.pages.length; g++) f.getSigView().updateSigPosition(e.getPageView(b.pages[g]))
                    }
                })
            }
            var c = a,
                h = this,
                i = new d(c);
            i.init();
            var j = new e(c);
            WebPDF.SignaturePluginName = "Signature Plugin", this.getName = function() {
                return WebPDF.SignaturePluginName
            }, this.onRegister = function() {}, this.getReaderApp = function() {
                return c
            }, this.getSigService = function() {
                return j
            }, this.getSigView = function() {
                return i
            }, this.init = function() {
                var a = new WebPDF.Event.SignatureMouseHandler(h);
                c.registerMousePtHandler(a);
                var d = new f(c, h);
                c.registerToolHandler(d);
                var e = new g(c, h);
                c.registerToolHandler(e), c.isSignatureEventInit() || (b(), c.setSignatureEventInit(!0))
            }, this.unload = function() {}, this.getReaderApp = function() {
                return c
            }, this.onBeforeUnload = function() {}, this._browser = function() {
                WebPDF.Environment.ie && (WebPDF.Environment.ie8 || WebPDF.Environment.ie8Compact || WebPDF.Environment.ie7Compact || WebPDF.Environment.ie6Compact) && (ie8_below = !0), WebPDF.Environment.safari && Number(WebPDF.Environment.version) > Number(print_lowest_safari) && (safari = !0)
            }, this.createPageSignatureSignHtml = function(a, b) {
                i.showSignedSignature(a, b)
            }, this.sign = function(a) {
                return WebPDF.Engine.JR ? void console.log("function sign is not spported with JR") : void j.sign(a)
            }, this.cancelSign = function(a) {
                var b = c.getMainView().getDocView();
                i.deleteSignature(a), b.setSigAddFlag(!1)
            }, this.getSignatureInfo = function(a, b, d, e, f, g, h) {
                if (null == a) return null;
                var i = a.getPageIndex(),
                    j = c.getMainView().getDocView(),
                    k = j.getPageView(i),
                    l = (a.getRotation(), a.getSigName()),
                    m = k.getPDFPage(),
                    n = m.getSigByName(l);
                if (b && n.setLocation(b), d && n.setReason(d), e && n.setStraddleType(e), g && n.setStraddlePercent(g), f && n.setStraddlePageRange(f), h) {
                    var o = null;
                    1 == e || 2 == e ? (o = k.getPDFPageHeight(), "top" == h ? h = o : "bottom" == h ? h = 0 : "middle" == h && (h = o / 2)) : 3 == e || 4 == e ? (o = k.getPDFPageWidth(), "right" == h ? h = o : "left" == h ? h = 0 : "middle" == h && (h = o / 2)) : 0 == e && (h = k.getPDFPageHeight() / 2), n.setStraddlePos(h)
                }
                var p = n.getRect();
                n.generatePosionByRect(p);
                var q = JSON.stringify(n.getSigJSONData());
                return q
            }
        }, b.createPlugin = function(a) {
            var b = new WebPDF.SignaturePlugin(a);
            return b
        }
    }), define("core/Plugins/Signature/SignatureView", ["core/Common/Math/Rect", "core/WebPDF"], function(a, b, c) {
        a("core/Common/Math/Rect");
        var d = (WebPDF.RectUtils, WebPDF.PDFRect),
            e = (WebPDF.Common, WebPDF.PDFPoint),
            d = WebPDF.PDFRect;
        return WebPDF.SignatureView = function(a) {
            function b() {
                var a = $("#" + y);
                a.webPDFModal("hide")
            }

            function c(a) {
                function b(a) {
                    var b = decodeURIComponent(a);
                    return encodeURIComponent(b)
                }
                var c = a.lastIndexOf("/"),
                    d = a.substring(c + 1),
                    e = b(d),
                    f = a.replace(d, e);
                return f
            }

            function f(a, b) {
                var c = "",
                    d = "";
                WebPDF.AccountInstance && (c = WebPDF.AccountInstance.getUserAccount(), d = WebPDF.AccountInstance.getUserId());
                var e = WebPDF.ViewerInstance.getFileName();
                e = e.split(".")[0] + "_signed.pdf";
                var f = {};
                apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getSignedDocument ? f = apiConfig.signature.getSignedDocument : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getSignedDocument ? f = apiConfig.signature.getSignedDocument() : console.error("apiConfig.signature.getSignedDocument format error,mush object or function"), f = f ? f : {};
                var g = {
                    params: {
                        userName: c,
                        userId: d,
                        file: b,
                        fileName: e
                    }
                };
                $.extend(!0, f, g);
                var h = "signature",
                    i = {
                        params: JSON.stringify(f),
                        type: h
                    };
                $.ajax({
                    url: a + "api/file/add",
                    type: "POST",
                    data: i,
                    async: !1,
                    success: function(c) {
                        var d = c.result;
                        if (null == d) return void alert(i18n.t("ParseError.ConvertFileFail") + b);
                        if ("LicenseInvalid" == d) return void alert(i18n.t("ParseError.LicenseInvalid"));
                        if ("LicenseExpired" == d) return void alert(i18n.t("ParseError.LicenseExpired"));
                        if ("OutOfFileSizeLimit" == d) return void alert(i18n.t("ParseError.OutOfViewerFileSizeLimit"));
                        var e = a + d + "/view";
                        "undefined" != typeof viewTheme && "" != viewTheme && (e = e + "?theme=" + viewTheme), e = a + "asserts/" + d, WebPDF.ViewerInstance.openFile(e)
                    },
                    error: function() {
                        alert(i18n.t("ParseError.FailToOpen") + b)
                    }
                })
            }

            function g(a, d, e, f, g, k, l, m, n) {
                function o() {
                    var a = {};
                    apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getSignature ? a = apiConfig.signature.getSignature : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getSignature ? a = apiConfig.signature.getSignature() : console.error("apiConfig.signature.getSignature format error,mush object or function"), a = a ? a : {};
                    var b = {
                        params: {
                            imgUrl: c(f),
                            cert: g
                        }
                    };
                    return $.extend(!0, a, b), JSON.stringify(a)
                }

                function p() {
                    var a = {};
                    apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getContents ? a = apiConfig.signature.getContents : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getContents ? a = apiConfig.signature.getContents() : console.error("apiConfig.signature.getContents format error,mush object or function"), a = a ? a : {};
                    var b = {
                        params: {
                            cert: g,
                            filter: "Adobe.PPKLite",
                            subFilter: "adbe.pkcs7.sha1"
                        }
                    };
                    return $.extend(!0, a, b), JSON.stringify(a)
                }

                function q() {
                    var a = {};
                    return apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.exportSignedDocument ? a = apiConfig.signature.exportSignedDocument : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.exportSignedDocument ? a = apiConfig.signature.exportSignedDocument() : console.error("apiConfig.signature.exportSignedDocument format error,mush object or function"), a = a ? a : {}, JSON.stringify(a)
                }

                function r(a, c) {
                    b(), h(a, c)
                }

                function s(c, d) {
                    b();
                    var e = WebPDF.ViewerInstance.getPluginByName(WebPDF.SignaturePluginName);
                    e.cancelSign(a), i(c, d)
                }
                var t = WebPDF.ViewerInstance.getPluginByName(WebPDF.SignaturePluginName),
                    u = t.getSignatureInfo(a, d, e, k, m, l, n),
                    v = {
                        properties: u,
                        information: o(),
                        contentParams: p(),
                        exportParams: q(),
                        success: r,
                        fail: s
                    };
                t.sign(v), j()
            }

            function h(a, b) {
                if (!document.getElementById(w)) {
                    var c = "<div id='" + w + "'style='position: absolute;left: 35%;top: 20%;'><div style='position:absolute;text-align:left;left:2px;top:3px;width:396px;height:30px;z-index:17;' class='fwr-sig-layer2'><div style='position:absolute;top:7px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.SigFinishTitle' >Signature</div></div><div  style='text-align:left;width:400px;height:150px;z-index:16;' class='fwr-sig-layer1'><div  style='width:399px;height:2px;z-index:18; ' class='fwr-sig-Line'/><div style='position:absolute;top:60px;left: 40px;font-size: 12px' class='fwr-sig-font2 fwr-sig-layer-margin2'><div class='fwr-icons-sigtip fwr-sigtip-finish' style='margin-right: 15px;'></div>" + a + "</div><input type='submit' id='sigViewbutton' data-i18n='[value]Signature.View' style='position:absolute;left:140px;top:110px; width:115px;' class='fwr-sig-button fwr-sig-normal-button'><input type='submit' id='sigOrignalButton' data-i18n='[value]Signature.OriginalFile' style='position:absolute;left:270px;top:110px; width: 115px;' class='fwr-sig-button fwr-sig-normal-button'></div></div>";
                    t.append(c), $("#sigOrignalButton").off("click").on("click", function() {
                        $("#" + w).hide(), t.hide();
                        var a = WebPDF.ViewerInstance.getFileID(),
                            b = v + "asserts/" + a;
                        WebPDF.ViewerInstance.openFile(b)
                    })
                }
                $("#sigViewbutton").off("click").on("click", function() {
                    $("#" + w).hide(), t.hide(), f(v, b)
                }), $("#" + w).show(), $("#" + w).draggable(), $("#" + w).i18n(), t.show()
            }

            function i(a, b) {
                if (!document.getElementById(x)) {
                    var c = "<div id='" + x + "'style='position: absolute;left: 35%;top: 20%;'><div style='position:absolute;text-align:left;left:2px;top:3px;width:396px;height:30px;z-index:17;' class='fwr-sig-layer2'><div style='position:absolute;top:7px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.SigFinishTitle' >Signature</div></div><div  style='text-align:left;width:400px;height:150px;z-index:16;' class='fwr-sig-layer1'><div  style='width:399px;height:2px;z-index:18; ' class='fwr-sig-Line'/><div style='position:absolute;top:60px;left: 40px;font-size: 18px' class='fwr-sig-font2 fwr-sig-layer-margin2'><div class='fwr-icons-sigtip fwr-sigtip-fail'  style='margin-right: 15px;'></div>" + a + "</div><input type='submit' id='sigfailbutton' data-i18n='[value]Signature.OkButton' style='position:absolute;left:270px;top:110px; width:70px;' class='fwr-sig-button fwr-sig-normal-button'></div></div>";
                    t.append(c), $("#sigfailbutton").off("click").on("click", function() {
                        $("#" + x).hide(), t.hide()
                    })
                }
                $("#" + x).draggable(), $("#" + x).i18n(), $("#" + x).show(), t.show()
            }

            function j() {
                var a = null;
                if (!document.getElementById(y)) {
                    var b = "<div class='apply-signing' id='" + y + "'style='top: 50%;position: absolute;left: 45%;'></div>",
                        c = o.getMainFrameId();
                    $("#" + c).append(b);
                    var a = $("#" + y);
                    return a.webPDFModal({
                        keyboard: !1,
                        backdrop: "static",
                        manager: "#docViewer"
                    }), !0
                }
                var a = $("#" + y);
                a.webPDFModal("show")
            }

            function k() {
                for (var a = "", b = 0; b < Configs.Signature.certs.length; b++) a += "<option  value='" + Configs.Signature.certs[b].cert + "'>" + Configs.Signature.certs[b].title + "</option>";
                return a
            }

            function l(a) {
                for (var b = "", c = 0; c < Configs.Signature.certs.length; c++)
                    if (Configs.Signature.certs[c].cert == a)
                        for (var d = 0; d < Configs.Signature.certs[c].icons.length; d++) b += "<option  value='" + Configs.Signature.certs[c].icons[d].src + "'>" + Configs.Signature.certs[c].icons[d].title + "</option>";
                return b
            }

            function m() {
                $.support.placeholder || $("input").each(function() {
                    var a = $(this).attr("placeholder");
                    if (a) {
                        var b = $(this).defaultValue;
                        b || $(this).val(a).css("color", "#999"), $(this).focus(function() {
                            $(this).val() == a && $(this).val("")
                        }), $(this).blur(function() {
                            "" == $(this).val() && $(this).val(a).css("color", "#999")
                        }), $(this).keydown(function() {
                            $(this).css("color", "")
                        })
                    }
                })
            }

            function n(a) {
                var b = /^(\d+)-(\d+)?$/g,
                    c = b.test(a);
                if (!c) return !1;
                var d = a.split("-"),
                    e = parseInt(d[0]),
                    f = parseInt(d[1]);
                if (isNaN(f)) return !1;
                var g = WebPDF.ViewerInstance.getPageCount();
                return 1 > e || f > g || e > f || e == f ? !1 : !0
            }
            var o = a,
                p = this,
                q = [],
                r = [],
                s = !1,
                t = null,
                u = WebPDF.optionParameters.baseUrl,
                v = WebPDF.optionParameters.serverBaseUrl;
            new e(0, 0);
            this.init = function() {
                if (!document.getElementById("signatureDlgLayer")) {
                    var a = "<div id='signatureDlgLayer' style='width:100%;height:100%;top:0;left:0;z-index: 1060;position: absolute; display:none'></div>";
                    $("body").append(a)
                }
                t = $("#signatureDlgLayer")
            }, this.clearAllSelection = function() {
                for (var a = r.length, b = 0; a > b; b++) {
                    var c = r[b];
                    $("#" + c).remove(), delete r[b]
                }
                r.length = 0, r = []
            }, this.clearAllSigLayer = function() {
                for (var a = q.length, b = 0; a > b; b++) {
                    var c = q[b];
                    $("#" + c).remove(), delete q[b]
                }
                q.length = 0
            }, this.isAddSig = function() {
                return 0 == q.length ? !1 : !0
            }, this.blindSigEvent = function(a) {
                $("#" + a).off("mousedown").on("mousedown", function(a) {
                    (0 == a.button || 1 == a.button) && (this.classList.add("fwr-sig-layer-select"), r.push(this.id))
                })
            }, this.addSignature = function(a, b) {
                this.clearAllSigLayer(), this.hideSigLayer(), this.addSigHTML(a, b);
                var c = b.getSigName(),
                    d = b.getRect(),
                    e = a.pdfRectToDevice(d, !0),
                    f = this.getPageSigID(a, c);
                this.updatePageViewSigLayerPos(f, e), q.push(f);
                var g = o.getMainView().getDocView();
                g.setSigAddFlag(!0)
            }, this.deleteSignature = function(a) {
                if (null == a) return !1;
                for (var b = a.getPageIndex(), c = o.getMainView().getDocView(), d = c.getPageView(b), e = this.getPageSigID(d, a.getSigName()), f = r.length, g = f - 1; g > -1; g--) {
                    var h = r[g];
                    h == e && (delete r[g], r.pop(g))
                }
                for (var f = q.length, g = f - 1; g > -1; g--) {
                    var i = q[g];
                    i == e && ($("#" + i).remove(), delete q[g], q.pop(g))
                }
                var j = d.getPDFPage();
                j.deleteSigByName(a.getSigName());
                var c = o.getMainView().getDocView();
                c.setSigAddFlag(!1)
            }, this.getsigVisibleOffset = function(a, b, c, d, e, f) {
                var g = a.getPageViewHeight(),
                    h = a.getPageViewWidth(),
                    i = c - e,
                    j = d - f,
                    k = this.getSigPageviewRect(b),
                    l = a.getDocView().getRotate();
                if (i > 0) {
                    var m = 0;
                    90 == l ? (i = -i, m = k.top - i, 0 > m && (i = -k.top)) : 180 == l ? (i = -i, m = k.left + i, 0 > m && (i = -k.left)) : 270 == l ? (m = k.bottom + i, m > h && (i = h - k.bottom)) : (m = k.right + i, m > h && (i = h - k.right))
                } else {
                    var n = 0;
                    90 == l ? (i = -i, n = k.bottom + i, n > h && (i = h - k.bottom)) : 180 == l ? (i = -i, n = k.right + i, n > h && (i = h - k.right)) : 270 == l ? (n = k.top + i, 0 > n && (i = -k.top)) : (n = k.left + i, 0 > n && (i = 0 - k.left))
                }
                if (j > 0) {
                    var o = 0;
                    90 == l ? (o = k.right + j, o > g && (j = g - k.right)) : 180 == l ? (j = -j, o = k.top + j, 0 > o && (j = -k.top)) : 270 == l ? (j = -j, o = k.left + j, 0 > o && (j = -k.left)) : (o = k.bottom + j, o > g && (j = g - k.bottom))
                } else {
                    var p = 0;
                    90 == l ? (p = k.left + j, 0 > p && (j = -k.left)) : 180 == l ? (j = -j, p = k.bottom + j, p > g && (j = g - k.bottom)) : 270 == l ? (j = -j, p = k.right + j, p > g && (j = g - k.right)) : (p = k.top + j, 0 > p && (j = 0 - k.top))
                }
                return {
                    x: i,
                    y: j
                }
            }, this.isSignatureSelected = function(a, b) {
                for (var c = this.getPageSigID(a, b.getSigName()), d = r.length, e = 0; d > e; e++) {
                    var f = r[e];
                    if (f == c) return !0
                }
                return !1
            }, this.getSigjasonData = function(a) {
                if (null == a) return !1;
                var b = a.getPageIndex(),
                    c = o.getMainView().getDocView(),
                    d = c.getPageView(b),
                    e = a.getSigName(),
                    f = d.getPDFPage(),
                    g = f.getSigByName(e),
                    h = JSON.stringify(g.getSigJSONData());
                return h
            }, this.isSigSelect = function() {
                var a = r.length;
                return 0 == a ? !1 : !0
            }, this.onSigSelectedLButtonDown = function(a, b) {
                if (this.isSignatureSelected(a, b)) return !0;
                if (!b.isLayerBoder()) {
                    var c = this.getPageSigID(a, b.getSigName()),
                        d = $("#" + c);
                    d.addClass("fwr-sig-layer-select");
                    var e = d.width(),
                        f = d.height();
                    this.updateSigBorderHtml(c, e, f, !0)
                }
                r.push(c)
            }, this.updateSelectSigPosition = function() {
                for (var a = r.length, b = 0; a > b; b++) {
                    var c = r[b],
                        e = $("#" + c),
                        f = e.css("left"),
                        g = e.css("top"),
                        h = e.css("height"),
                        i = e.css("width"),
                        j = parseInt(e[0].getAttribute("pageIndex")),
                        k = e[0].getAttribute("Signame"),
                        l = o.getMainView().getDocView(),
                        m = l.getPageView(j),
                        n = new d,
                        p = new d;
                    n.top = parseFloat(g), n.left = parseFloat(f), n.bottom = n.top + parseFloat(h), n.right = n.left + parseFloat(i);
                    var q = l.getRotate();
                    90 == q ? (p.top = n.left, p.left = m.getPageViewWidth() - (n.top + parseFloat(h)), p.bottom = n.left + parseFloat(i), p.right = m.getPageViewWidth() - n.top, n = p) : 180 == q ? (p.top = m.getPageViewHeight() - (n.top + parseFloat(h)), p.left = m.getPageViewWidth() - n.right, p.bottom = p.top + parseFloat(h), p.right = p.left + parseFloat(i), n = p) : 270 == q && (p.top = m.getPageViewHeight() - (n.left + parseFloat(i)), p.left = n.top, p.bottom = p.top + parseFloat(i), p.right = p.left + parseFloat(h), n = p);
                    var s = m.deviceRectToPDF(n, !0),
                        t = m.getPDFPage(),
                        u = t.getSigByName(k);
                    u.setRect(s)
                }
            }, this.moveSelectedSig = function(a, b, c, d, e) {
                if (!this.isSigSelect()) return !1;
                for (var f = 0; f < r.length; f++) {
                    var g = r[0],
                        h = this.getsigVisibleOffset(a, g, b, c, d, e);
                    this.moveSigPosition(g, h.x, h.y)
                }
            }, this.onSigChangeRect = function(a, b, c, d, e, f) {
                for (var g = 0; g < r.length; g++) {
                    var h = r[0],
                        i = this.getsigVisibleOffset(a, h, b, c, d, e),
                        j = this.getSigPageviewRect(h),
                        k = a.getDocView().getRotate();
                    if (j.left > j.right) {
                        var l = j.left;
                        j.left = j.right, j.right = l
                    }
                    if (j.bottom < j.top) {
                        var l = j.bottom;
                        j.bottom = j.top, j.top = l
                    }
                    if (90 == k || 270 == k) {
                        var m = i.x;
                        i.x = i.y, i.y = m
                    }
                    this.calculateRectBydirec(j, f, i), this.updatePageViewSigLayerPos(h, j), this.updateSigBorderHtml(h, j.right - j.left, j.bottom - j.top, !0)
                }
            }, this.calculateRectBydirec = function(a, b, c) {
                var d;
                switch (b) {
                    case 0:
                        d = a.top + c.y, a.top = d, a.left = a.left + c.x;
                        break;
                    case 1:
                        d = a.top + c.y, a.top = d;
                        break;
                    case 2:
                        a.top = a.top + c.y, a.right = a.right + c.x;
                        break;
                    case 3:
                        a.left = a.left + c.x;
                        break;
                    case 4:
                        a.right = a.right + c.x;
                        break;
                    case 5:
                        a.left = a.left + c.x, a.bottom = a.bottom + c.y;
                        break;
                    case 6:
                        a.bottom = a.bottom + c.y;
                        break;
                    case 7:
                        a.right = a.right + c.x, a.bottom = a.bottom + c.y
                }
                a.bottom < a.top && (a.top = a.bottom), a.right < a.left && (a.left = a.right)
            }, this.setImageUrl = function(a, b) {
                if (null == a) return !1;
                var c = a.getPageIndex(),
                    d = o.getMainView().getDocView(),
                    e = d.getPageView(c),
                    f = a.getSigName(),
                    g = e.getPDFPage(),
                    h = g.getSigByName(f);
                h.setImageUrl(b);
                var i = this.getPageSigImageID(e, f);
                this.changeSigImage(i, b)
            }, this.cancelSign = function(a) {
                var b = o.getMainView().getDocView();
                this.clearAllSelection(), this.clearAllSigLayer(), b.setSigAddFlag(!1)
            }, this.unbindSigEvent = function(a) {
                $("#" + a).off("mousedown")
            }, this.clearSelected = function(a) {
                $("#" + a).removeClass("fwr-sig-layer-select")
            }, this.updatePageViewSigLayerPos = function(a, b) {
                $("#" + a).css({
                    left: b.left + "px",
                    top: b.top + "px",
                    height: b.bottom - b.top + "px",
                    width: b.right - b.left + "px"
                })
            }, this.getSigPageviewRect = function(a) {
                var b = $("#" + a),
                    c = new d;
                return c.top = parseFloat(b.css("top")), c.left = parseFloat(b.css("left")), c.bottom = c.top + parseFloat(b.css("height")), c.right = c.left + parseFloat(b.css("width")), c
            }, this.moveSigPosition = function(a, b, c) {
                var d = o.getDocView().getRotate();
                90 == d || 270 == d ? ($("#" + a).css("left", parseFloat($("#" + a).css("left")) + c + "px"), $("#" + a).css("top", parseFloat($("#" + a).css("top")) + b + "px")) : ($("#" + a).css("left", parseFloat($("#" + a).css("left")) + b + "px"), $("#" + a).css("top", parseFloat($("#" + a).css("top")) + c + "px"))
            }, this.changeSigImage = function(a, b) {
                $("#" + a).attr("src", b)
            }, this.changeSigOpacity = function(a, b) {
                $("#" + a).css({
                    opacity: b
                })
            }, this.getPageViewSigLayerHtml = function(a) {
                var b = p.getSigLayerID(a),
                    c = "<div id='" + b + "' class ='fwr-signature-layer'></div>";
                return c
            }, this.getPageViewSigHtml = function(a, b) {
                var c = b.getSigName(),
                    d = p.getPageSigID(a, c),
                    e = p.getPageSigImageID(a, c),
                    f = "<div style='position: absolute;' id='" + d + "'pageIndex ='" + a.getPageIndex() + "' sigName='" + c + "'><div style='width: 100%;height: 100%'class ='fwr-signature-layer fwr-signature' pageIndex='" + a.getPageIndex() + "' sigName='" + c + "'><div id='" + e + "'style='width:100%; height:100%' class='fwr-sig-hideimage'> </div></div></div>";
                return f
            }, this.removeBorderHmtl = function(a) {
                var b = a + "_sigBorder",
                    c = $("#" + b);
                c.remove()
            }, this.getSigSelectBorderHtml = function(a, b, c, d) {
                var e = o.getDocView().getRotate(),
                    f = a + "_sigBorder";
                this.removeBorderHmtl(a);
                var g = "";
                if (g = 90 == e || 270 == e ? "<div id='" + f + "'><div class ='fwr-signature-select-border' style='left: -4px;top: -4px; cursor:ne-resize' dir='0'></div><div class ='fwr-signature-select-border' style='left:" + (b / 2 - 4) + "px;top: -4px; cursor:e-resize' dir='1'></div> <div class ='fwr-signature-select-border' style='left:" + (b - 4) + "px;top: -4px; cursor:nw-resize' dir='2'></div> <div class ='fwr-signature-select-border' style='left: -4px;top:" + (c / 2 - 4) + "px; cursor:n-resize' dir='3'></div> <div class ='fwr-signature-select-border' style='left:" + (b - 4) + "px;top:" + (c / 2 - 4) + "px; cursor:n-resize' dir='4'></div> <div class ='fwr-signature-select-border' style='left: -4px;top:" + (c - 4) + "px; cursor:nw-resize' dir='5'></div> <div class ='fwr-signature-select-border' style='left:" + (b / 2 - 4) + "px;top:" + (c - 4) + "px; cursor:e-resize' dir='6'></div> <div class ='fwr-signature-select-border' style='left:" + (b - 4) + "px;top:" + (c - 4) + "px; cursor:ne-resize' dir='7'></div> " : "<div id='" + f + "'><div class ='fwr-signature-select-border' style='left: -4px;top: -4px; cursor:nw-resize' dir='0'></div><div class ='fwr-signature-select-border' style='left:" + (b / 2 - 4) + "px;top: -4px; cursor:n-resize' dir='1'></div> <div class ='fwr-signature-select-border' style='left:" + (b - 4) + "px;top: -4px; cursor:ne-resize' dir='2'></div> <div class ='fwr-signature-select-border' style='left: -4px;top:" + (c / 2 - 4) + "px; cursor:e-resize' dir='3'></div> <div class ='fwr-signature-select-border' style='left:" + (b - 4) + "px;top:" + (c / 2 - 4) + "px; cursor:e-resize' dir='4'></div> <div class ='fwr-signature-select-border' style='left: -4px;top:" + (c - 4) + "px; cursor:ne-resize' dir='5'></div> <div class ='fwr-signature-select-border' style='left:" + (b / 2 - 4) + "px;top:" + (c - 4) + "px; cursor:n-resize' dir='6'></div> <div class ='fwr-signature-select-border' style='left:" + (b - 4) + "px;top:" + (c - 4) + "px; cursor:nw-resize' dir='7'></div> ", 1 == d) {
                    var h = "",
                        i = "";
                    90 == e ? (i = "rotate(-" + e + "deg) translateX(-17px) translateY(-17px)", i += "transform:" + i + ";-webkit-transform:" + i + ";-moz-transform:" + i + ";-o-transform;-ms-transform:" + i + ";", h = "<div class='cok-bg' style='left:" + (b + 5) + "px;top:0px; background-image:url(" + u + "images/cancel-ok-bg.png); position: absolute; width: 60px;" + i + " '>") : 180 == e ? (i = "rotate(-" + e + "deg)", i += "transform:" + i + ";-webkit-transform:" + i + ";-moz-transform:" + i + ";-o-transform;-ms-transform:" + i + ";", h = "<div class='cok-bg' style='left:0px;top:-30px; background-image:url(" + u + "images/cancel-ok-bg.png); position: absolute; width: 60px;" + i + "'>") : 270 == e ? (i = "rotate(-" + e + "deg) translateX(-17px) translateY(-17px)", i += "transform:" + i + ";-webkit-transform:" + i + ";-moz-transform:" + i + ";-o-transform;-ms-transform:" + i + ";", h = "<div class='cok-bg' style='left:-65px;top:" + (c - 25) + "px; background-image:url(" + u + "images/cancel-ok-bg.png); position: absolute; width: 60px;" + i + "'>") : (i = "rotate(-" + e + "deg) translateX(-17px) translateY(-17px)", h = "<div class='cok-bg' style='left:" + (b - 60) + "px;top:" + (c + 5) + "px; background-image:url(" + u + "images/cancel-ok-bg.png); position: absolute; width: 60px;'>"), h += "<div class='fwr-icons-sigbtn fwr-sigbtn-cancel' id='sigDeleteId' style='width: 25px;height: 25px;display: inline-block ;cursor: default;'></div><div class='fwr-icons-sigbtn fwr-sigbtn-ok' id='sigAttributesSetting' style='width: 25px;height: 25px;display: inline-block;margin-left: 7px; cursor: default;'></div></div>", g += h
                }
                return g += "</div>"
            }, this.createSignatureHtml = function(a, b) {
                var c = b.getSigName(),
                    d = p.getPageSigID(a, c),
                    e = "<div id='" + d + "' class ='fwr-signature-sign fwr-signature fwr-annot-data' pageIndex ='" + a.getPageIndex() + "' sigName='" + c + "'></div>";
                return e
            }, this.getPageSigContainerID = function(a) {
                return a.getPageViewContainerID() + "_SignatureContainer"
            }, this.getPageSignedContainerID = function(a) {
                return a.getPageViewContainerID() + "_SignatureSigned"
            }, this.getSigLayerID = function(a) {
                return a.getDocViewContainerID() + "_sig_bound_select"
            }, this.getPageSigID = function(a, b) {
                return a.getPageViewContainerID() + "_Signature_" + b
            }, this.getPageSigImageID = function(a, b) {
                return a.getPageViewContainerID() + "_Signature_image" + b
            }, this.onPageShowComplete = function(a) {
                if (!a || a.isPageLoadError()) return !1;
                a.getPageIndex();
                if (!a.isSignatureContainerAdd()) {
                    var b = "<div id='" + this.getPageSigContainerID(a) + "'> </div>";
                    $("#" + a.getPageViewContainerID()).append(b);
                    var c = "<div id='" + this.getPageSignedContainerID(a) + "'> </div>";
                    $("#" + a.getPageViewContainerID()).append(c), a.setSignatureContainerAdd(!0)
                }
                return !0
            }, this.updateSigBorderHtml = function(a, b, c, d) {
                var e = this.getSigSelectBorderHtml(a, b, c, d),
                    f = $("#" + a);
                if (f.append(e), void 0 != f[0]) {
                    var g = parseInt(f[0].getAttribute("pageIndex"));
                    if (!isNaN(g)) {
                        var h = f[0].getAttribute("Signame"),
                            i = o.getMainView().getDocView(),
                            j = i.getPageView(g),
                            k = j.getPDFPage(),
                            l = k.getSigByName(h);
                        $("#sigAttributesSetting").off("mousedown").bind("mousedown", function() {
                            return p.showNormalSigDialog(l), !1
                        }), $("#sigDeleteId").off("mousedown").bind("mousedown", function() {
                            return p.deleteSignature(l), !1
                        })
                    }
                }
            }, this.updateSigPosition = function(a) {
                if (null != a) {
                    var b = a.getPDFPage();
                    b.enumSignature(function(b) {
                        var c = b.getSigName(),
                            d = p.getPageSigID(a, c),
                            e = b.getRect(),
                            f = a.pdfRectToDevice(e, !0);
                        p.updatePageViewSigLayerPos(d, f);
                        var g = f.right - f.left,
                            h = f.bottom - f.top;
                        "signature" == b.getType() || b.isLayerBoder() || p.updateSigBorderHtml(d, g, h, !0)
                    })
                }
            }, this.onDocViewZoom = function(a) {
                for (var b = o.getMainView().getDocView(), c = b.getVisiblePageRange(), d = $("#" + b.getDocViewContainerID()), e = b.getDocViewDimension(), f = e.height, g = e.width, h = d.offset(), i = c.begin; i <= c.end; i++) this.updateSigPosition(b.getPageView(i), g, f, h, !0)
            }, this.showSignedSignature = function(a, b) {
                if (a && this.onPageShowComplete(b), null != b) {
                    var c = b.getPDFPage(),
                        d = this.getPageSignedContainerID(b);
                    c.enumSignature(function(a) {
                        if (!a.isStraddle() && !a.isShow()) return !0;
                        var c = p.createSignatureHtml(b, a);
                        $("#" + d).append(c);
                        var e = a.getRect(),
                            f = b.pdfRectToDevice(e, !0),
                            g = a.getSigName(),
                            h = p.getPageSigID(b, g);
                        p.updatePageViewSigLayerPos(h, f), $("#" + h).off("dblclick tap").on("dblclick tap", function() {
                            function a(a) {
                                return 10 > a ? "0" + a : a.toString()
                            }
                            var b = $(this).attr("signame"),
                                c = parseInt($(this).attr("pageindex")),
                                d = o.getMainView().getDocView(),
                                e = d.getPageView(c);
                            if (null == e) return !1;
                            var f = e.getPDFPage(),
                                g = f.getSigByName(b);
                            if (null == g) return !1;
                            var h = g.getReason();
                            void 0 == h && (h = "");
                            var i = g.getLocation();
                            void 0 == i && (i = "");
                            var j = g.getSigner(),
                                k = new Date(1e3 * parseInt(g.getModifyTime())),
                                l = k.getMonth() + 1 + "/" + k.getDate() + "/" + k.getFullYear() + " " + a(k.getHours()) + ":" + a(k.getMinutes()) + ":" + a(k.getSeconds());
                            return l += k.getHours() < 12 ? " AM" : " PM", p.showSignatureProperties(j, h, i, l), !1
                        })
                    })
                }
            }, this.setNoteCursor = function() {
                var a = o.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? (b.addClass("fwr-note-cursor-ie"), b.css("cursor", "crosshair")) : b.addClass("fwr-note-cursor")
            }, this.cancelNoteCursor = function() {
                var a = o.getMainView().getDocView(),
                    b = $("#" + a.getDocViewContainerID());
                WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 ? b.removeClass("fwr-note-cursor-ie") : b.removeClass("fwr-note-cursor"), a.setSigAddFlag(!1)
            }, this.getSigByEvent = function(a) {
                var b = null,
                    c = null;
                if ($(a).hasClass("fwr-signature")) {
                    var d = parseInt(a.getAttribute("pageIndex")),
                        e = a.getAttribute("Signame"),
                        f = WebPDF.ViewerInstance.getPluginByName(WebPDF.SignaturePluginName),
                        g = f.getReaderApp().getMainView().getDocView();
                    c = g.getPageView(d);
                    var h = c.getPDFPage();
                    b = h.getSigByName(e)
                }
                return {
                    signature: b,
                    page: c
                }
            }, this.isSigBorderClick = function(a, b) {
                return $(a).hasClass("fwr-signature-select-border") && (b._direc = parseInt(a.getAttribute("dir")), b._isSelectedBorderClick = !0), b._isSelectedBorderClick
            }, this.addSigHTML = function(a, b) {
                var c = this.getPageViewSigHtml(a, b),
                    d = this.getPageSigContainerID(a);
                $("#" + d).append(c)
            }, this.showSigLayer = function(a) {
                var b = this.getSigLayerID(a);
                if (!s) {
                    var c = this.getPageViewSigLayerHtml(a),
                        d = $("#" + a.getDocViewContainerID()),
                        e = a.getPageView(0);
                    null != e && e.isContentCreated() ? $("#" + e.getPageViewContainerID()).parent().parent().append(c) : d.append(c), s = !0
                }
                $("#" + b).show()
            }, this.hideSigLayer = function() {
                var a = o.getMainView().getDocView(),
                    b = this.getSigLayerID(a),
                    c = $("#" + b).find("div");
                null != c && c.remove(), $("#" + b).hide()
            };
            var w = "sigSuccessDlg",
                x = "sigFailDlg",
                y = "signatrueSigningDlg",
                z = "sigSettingDlg";
            this.showNormalSigDialog = function(a) {
                if (!document.getElementById(z)) {
                    var b = "<div id='" + z + "'style='position: absolute;left: 35%;top: 20%;cursor:auto'><div style='text-align:left;width:400px;height:444px;z-index:16;' class='fwr-sig-layer1'><div style='width:399px;height:2px;z-index:18; ' class='fwr-sig-Line'/><div  style='top:54px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.SignAs'>Sign As:</div><select name='sigCertificateType' size='1' id='sigCertificateTypeID' class='fwr-sig-combobox fwr-sig-normal-certificate fwr-sig-normal-combobox'>" + k() + "</select><div style='top:90px;' class='fwr-sig-font1 fwr-sig-layer-margin1'  data-i18n='Signature.TextForSign'>Text For Signing:</div><div style='top:130px' class='fwr-sig-font2 fwr-sig-layer-margin2' data-i18n='Signature.Location'>Location:</div><input type='text' id='sigLocationID' style='left:114px;top:125px;width:246px;' class='fwr-sig-editbox fwr-sig-normal-editbox' name='normalEditbox1' placeholder='Input your location here'><div style='top:170px' class='fwr-sig-font2 fwr-sig-layer-margin2' data-i18n='Signature.Reason'>Reason:</div><input type='text' id='sigReasonID' style='left:114px;top:165px;width:246px;' class='fwr-sig-editbox fwr-sig-normal-editbox' name='normalEditbox2' placeholder='Input the reason you sign this document here'><div style='top:210px' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.Preview' >Signature Preview:</div><div style='top:240px' class='fwr-sig-font2 fwr-sig-layer-margin2' data-i18n='Signature.AppType' >Appearance Type:</div><select name='sigAppType' size='1' id='sigAppTypeID' style='top: 235px;' class='fwr-sig-combobox fwr-sig-combobox-apptype fwr-sig-normal-combobox'>" + l(Configs.Signature.certs[0].cert) + "</select><div style='text-align:left;left:20px;top:275px;width:340px;height:116px;z-index:11;' class='fwr-sig-layer1 fwr-sig-img'><img id='sigImageID' src='" + u + Configs.Signature.certs[0].icons[0].src + "' alt='' style='width: 30%;height: 80%;left: 40%;position: absolute;top: 10%;'></div></div><div style='text-align:left;left:2px;top:3px;width:396px;height:30px;z-index:17;'  class='fwr-sig-layer2'><div style='top:7px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.HeadTitle'>Sign Document</div><div class='sig-close' style='position:absolute;left:374px;top:6px;width:12px;height:18px;text-align:left;z-index:13;'><div id='closeDlgID'></div></div><input type='submit' id='settingbutton' data-i18n='[value]Signature.ButtonSin' style='left:230px' class='fwr-sig-button fwr-sig-normal-button'><input type='submit' id='cancelButton' data-i18n='[value]Signature.ButtonCancel' style='left:310px' class='fwr-sig-button fwr-sig-normal-button'></div></div>";
                    $("#signatureDlgLayer").append(b), $("#sigAppTypeID").off("change").on("change", function() {
                        var a = $("#sigAppTypeID").val(),
                            b = u + a;
                        $("#sigImageID").attr("src", b)
                    }), $("#sigCertificateTypeID").off("change").on("change", function() {
                        var a = $("#sigCertificateTypeID").val(),
                            b = l(a);
                        $("#sigAppTypeID").empty(), $("#sigAppTypeID").html(b), $("#sigAppTypeID").change()
                    }), $("#cancelButton").off("click").on("click", function() {
                        $("#" + z).hide(), t.hide()
                    }), $("#closeDlgID").off("click").on("click", function() {
                        $("#" + z).hide(), t.hide()
                    })
                }
                $("#settingbutton").off("click").on("click", function() {
                    var b = $("#sigCertificateTypeID").val(),
                        c = $("#sigReasonID").val(),
                        d = $("#sigLocationID").val(),
                        e = $("#sigImageID").attr("src");
                    $("#" + z).hide(), g(a, d, c, e, b)
                }), m(), $("#" + z).i18n(), $("#" + z).draggable(), $("#" + z).show(), $("#sigReasonID").val() != $("#sigReasonID").attr("placeholder") && $("#sigReasonID").attr("value", ""), $("#sigLocationID").val() != $("#sigLocationID").attr("placeholder") && $("#sigLocationID").attr("value", ""), t.show()
            };
            var A = "straddleSigSettingDlg";
            this.showStraddleSigDialog = function(a) {
                function b(a) {
                    1 == a ? ($("#radioOfPage").slider("disable"), $("#radioOfPage").slider("value", 50), $("#radioOfPageValue").html(50), $("#straddlePosId").attr("disabled", !0), $(".fwr-sig-strd-radioMarge").addClass("disabled"), $(".fwr-sig-strd-posMsg").addClass("disabled")) : ($("#straddlePosId").attr("disabled", !1), $("#radioOfPage").slider("enable"), $(".fwr-sig-strd-radioMarge").removeClass("disabled"), $(".fwr-sig-strd-posMsg").removeClass("disabled"))
                }
                if (!document.getElementById(A)) {
                    var c = "<div id='" + A + "'style='position: absolute;left: 35%;top: 10px; cursor:auto'><div style='text-align:left;width:400px;height:500px;z-index:16;' class='fwr-sig-layer1'><div  style='width:399px;height:2px;z-index:18; ' class='fwr-sig-Line'/><div  style='top:45px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.SignAs'>Sign As:</div><select name='strdsigCertificateType' size='1' id='straddleCertTypeID' class='fwr-sig-straddle-certificate fwr-sig-combobox fwr-sig-straddle-combobox'>" + k() + "</select><div style='top:75px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.TextForSign'>Text For Signing:</div><div style='top:100px' class='fwr-sig-font2 fwr-sig-layer-straddle-margin' data-i18n='Signature.Location'>Location:</div><input type='text' id='strdsigLocationID' style='left:114px;top:100px;width:246px;' class='fwr-sig-editbox fwr-sig-straddle-editbox' name='Editbox1' placeholder='Input your location here'><div style='top:130px' class='fwr-sig-font2 fwr-sig-layer-straddle-margin' data-i18n='Signature.Reason'>Reason:</div><input type='text' id='strdsigReasonID' style='left:114px;top:130px;width:246px;' class='fwr-sig-editbox fwr-sig-straddle-editbox' name='Editbox1' placeholder='Input the reason you sign this document here'><div style='top:160px' class='fwr-sig-font2 fwr-sig-layer-straddle-margin' data-i18n='Signature.Straddle.Type'>Straddle typle:</div><select name='strdsigType' size='1' id='straddleSigTypeId' class='fwr-sig-combobox fwr-sig-combobox-strdType fwr-sig-straddle-combobox'><option  value='2' data-i18n='Signature.Straddle.Type2'>right</option><option  value='1' data-i18n='Signature.Straddle.Type1'>left</option><option  value='0' data-i18n='Signature.Straddle.Type0'>middle</option><option  value='3' data-i18n='Signature.Straddle.Type3'>top</option><option  value='4' data-i18n='Signature.Straddle.Type4'>bottom</option></select><div style='top:190px' class='fwr-sig-font2 fwr-sig-layer-straddle-margin fwr-sig-strd-posMsg' data-i18n='Signature.Straddle.Position'>Position of Straddle:</div><select name='straddlePos' size='1' id='straddlePosId' class='fwr-sig-combobox fwr-sig-combobox-strdPos fwr-sig-straddle-combobox fwr-sig-strd-posMsg'><option  value='top' data-i18n='Signature.Straddle.Type3'>top</option><option  value='middle' data-i18n='Signature.Straddle.Type0'>middle</option><option  value='bottom' data-i18n='Signature.Straddle.Type4'>bottom</option></select><div style='position: absolute;top:220px;width: 100%;'><div style='' class='fwr-sig-font2 fwr-sig-layer-straddle-margin' data-i18n='Signature.Straddle.PageRange'>Page Range:</div><input type='text' id='strdPageRangeID' style='left:155px;width:205px;' class='fwr-sig-editbox fwr-sig-straddle-editbox' name='Editbox1' value='1-2'><div id='strdPageRangeCheckMsg' style='margin-top:25px;display:none;margin-left: 30px;' class='fwr-sig-strd-pageRange' data-i18n='Signature.Straddle.ErrorPageRange'>Page you entered need to be a range</div><div id='radioHint' class='fwr-sig-font2 fwr-sig-layer-straddle-margin fwr-sig-strd-radioMarge' data-i18n='Signature.Straddle.Radio'>Radio of signature at first page:</div><div id='radioOfPage' style='position:absolute;left:198px;width:125px;height:7px;' class='fwr-sig-strd-sliderMarge fwr-sig-strd-radioOffsetMarge'></div><div id='radioOfPageValue' style='position:absolute;left:330px;' class='fwr-sig-font2 fwr-sig-strd-radioMarge'>50</div><div id='radioPercent' style='position:absolute;left:350px;' class='fwr-sig-font2 fwr-sig-strd-radioMarge'>%</div></div><div style='top:280px' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.Preview'>Signature Preview:</div><div style='top:310px' class='fwr-sig-font2 fwr-sig-layer-straddle-margin' data-i18n='Signature.AppType' >Appearance Type:</div><select name='straddlesigAppType' size='1' id='straddleSigAppTypeID' style='top: 310px;left:155px;width:205px;' class='fwr-sig-combobox fwr-sig-combobox-apptype fwr-sig-straddle-combobox'>" + l(Configs.Signature.certs[0].cert) + "</select><div style='text-align:left;left:20px;top:336px;width:340px;height:110px;z-index:11;' class='fwr-sig-layer1 fwr-sig-img'><img id='strdsigImageID' src= '" + u + Configs.Signature.certs[0].icons[0].src + "' alt='' style='width: 30%;height: 80%;left: 40%;position: absolute;top: 10%;'></div></div><div style='text-align:left;left:2px;top:3px;width:396px;height:30px;z-index:17;'  class='fwr-sig-layer2'><div style='top:7px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.HeadTitle'>Sign Document</div><div class='sig-close' style='position:absolute;left:374px;top:6px;width:12px;height:18px;text-align:left;z-index:13;'><div id='straddleCloseDlgID'></div></div><input type='submit' id='straddleSettingbutton' data-i18n='[value]Signature.ButtonSin' style='left:230px' class='fwr-sig-button fwr-sig-straddle-button'><input type='submit' id='StraddleCancelButton' data-i18n='[value]Signature.ButtonCancel' style='left:310px' class='fwr-sig-button fwr-sig-straddle-button'></div></div>";
                    t.append(c), $("#straddleSigAppTypeID").off("change").on("change", function() {
                        var a = $("#straddleSigAppTypeID").val(),
                            b = u + a;
                        $("#strdsigImageID").attr("src", b)
                    }), $("#straddleCertTypeID").off("change").on("change", function() {
                        var a = $("#straddleCertTypeID").val(),
                            b = l(a);
                        $("#straddleSigAppTypeID").empty(), $("#straddleSigAppTypeID").html(b), $("#straddleSigAppTypeID").change()
                    }), $("#straddleSigTypeId").off("change").on("change", function() {
                        var a = $(this).val();
                        $("#straddlePosId option").each(function() {
                            $(this).remove()
                        });
                        var c = null,
                            d = !1;
                        3 == a || 4 == a ? c = "<option  value='left' data-i18n='Signature.Straddle.Type1'>left</option><option  value='middle' data-i18n='Signature.Straddle.Type0'>middle</option><option  value='right' data-i18n='Signature.Straddle.Type2'>right</option>" : 1 == a || 2 == a ? c = "<option  value='top' data-i18n='Signature.Straddle.Type3'>top</option><option  value='middle' data-i18n='Signature.Straddle.Type0'>middle</option><option  value='bottom' data-i18n='Signature.Straddle.Type4'>bottom</option>" : (c = "<option  value='middle' data-i18n='Signature.Straddle.Type0'>middle</option>", d = !0), $("#straddlePosId").append(c), b(d), $("#straddlePosId").i18n()
                    }), $("#strdPageRangeID").on("blur", function() {
                        var a = $(this).val(),
                            b = n(a);
                        b ? ($("#strdPageRangeCheckMsg").hide(), $("#radioOfPage").addClass("fwr-sig-strd-sliderMarge"), $("#radioOfPageValue").addClass("fwr-sig-strd-radioMarge"), $("#radioPercent").addClass("fwr-sig-strd-radioMarge"), $("#radioHint").addClass("fwr-sig-strd-radioMarge")) : ($("#strdPageRangeCheckMsg").show(), $("#radioOfPage").removeClass("fwr-sig-strd-sliderMarge"), $("#radioOfPageValue").removeClass("fwr-sig-strd-radioMarge"), $("#radioPercent").removeClass("fwr-sig-strd-radioMarge"), $("#radioHint").removeClass("fwr-sig-strd-radioMarge"))
                    });
                    var d = {
                        orientation: "horizontal",
                        animate: !1,
                        range: !1,
                        min: 1,
                        max: 80,
                        value: 50,
                        slide: function(a, b) {
                            $("#radioOfPageValue").html(b.value)
                        }
                    };
                    $("#radioOfPage").slider(d)
                }
                $("#straddleSettingbutton").off("click").on("click", function() {
                    var b = $("#strdPageRangeID").val(),
                        c = n(b);
                    if (!c) return $("#strdPageRangeCheckMsg").show(), $("#radioOfPage").removeClass("fwr-sig-strd-sliderMarge"), $("#radioOfPageValue").removeClass("fwr-sig-strd-radioMarge"), $("#radioPercent").removeClass("fwr-sig-strd-radioMarge"), void $("#radioHint").removeClass("fwr-sig-strd-radioMarge");
                    $("#strdPageRangeCheckMsg").hide(), $("#radioOfPage").addClass("fwr-sig-strd-sliderMarge"), $("#radioOfPageValue").addClass("fwr-sig-strd-radioMarge"), $("#radioPercent").addClass("fwr-sig-strd-radioMarge"), $("#radioHint").addClass("fwr-sig-strd-radioMarge");
                    var d = $("#straddleCertTypeID").val(),
                        e = $("#strdsigReasonID").val(),
                        f = $("#strdsigLocationID").val(),
                        h = $("#strdsigImageID").attr("src"),
                        i = parseInt($("#straddleSigTypeId").val()),
                        j = $("#radioOfPageValue").html() / 100,
                        k = b.split("-"),
                        l = parseInt(k[0]),
                        m = parseInt(k[1]),
                        o = "";
                    isNaN(m) ? o += l - 1 : o = l - 1 + "-" + (m - 1);
                    var p = $("#straddlePosId").val(),
                        i = parseInt($("#straddleSigTypeId").val());
                    $("#" + A).hide(), g(a, f, e, h, d, i, j, o, p)
                }), $("#StraddleCancelButton").off("click").on("click", function() {
                    var b = WebPDF.ViewerInstance.getPluginByName(WebPDF.SignaturePluginName);
                    b.cancelSign(a), $("#" + A).hide(), t.hide()
                }), $("#straddleCloseDlgID").off("click").on("click", function() {
                    var b = WebPDF.ViewerInstance.getPluginByName(WebPDF.SignaturePluginName);
                    b.cancelSign(a), $("#" + A).hide(), t.hide()
                }), m(), $("#strdsigReasonID").val() != $("#strdsigReasonID").attr("placeholder") && $("#strdsigReasonID").attr("value", ""), $("#strdsigLocationID").val() != $("#strdsigLocationID").attr("placeholder") && $("#strdsigLocationID").attr("value", ""), $("#strdPageRangeID").attr("value", "1-2"), $("#strdPageRangeCheckMsg").hide(), $("#radioOfPage").addClass("fwr-sig-strd-sliderMarge"), $("#radioOfPageValue").addClass("fwr-sig-strd-radioMarge"), $("#radioPercent").addClass("fwr-sig-strd-radioMarge"), $("#radioHint").addClass("fwr-sig-strd-radioMarge"), $("#radioOfPageValue").html(50), $("#radioOfPage").slider("value", 50), $("#" + A).i18n(), $("#" + A).draggable(), $("#" + A).show(), t.show()
            };
            var B = "sigProDlg";
            this.showSignatureProperties = function(a, b, c, d) {
                if (o.isMobile()) {
                    var e = "<B data-i18n='Signature.SignedBy'>Sign By: </B>" + a + "<br><B data-i18n='Signature.Reason'>Reason: </B>" + b + "<br><B data-i18n='Signature.Date'>Date: </B>" + d + "<br><B data-i18n='Signature.Location'>Location: </B>" + c + "<br>",
                        f = i18n.t("Signature.SigPropertiesTitle");
                    WebPDF.alert(null, f, e)
                } else {
                    var e = "<B data-i18n='Signature.SignedBy'>Sign By: </B><input type='text' id='sigLocationID'  readonly='readonly' class='fwr-sig-property-editbox'  value='" + a + "'><br><B data-i18n='Signature.Reason'>Reason: </B><input type='text' id='sigLocationID'  readonly='readonly' class='fwr-sig-property-editbox'  value='" + b + "'><br><B data-i18n='Signature.Date'>Date: </B><input type='text' id='sigLocationID'  readonly='readonly' class='fwr-sig-property-editbox'  value='" + d + "'><br><B data-i18n='Signature.Location'>Location: </B><input type='text' id='sigLocationID' readonly='readonly' class='fwr-sig-property-editbox'  value='" + c + "'><br>";
                    if (!document.getElementById(B)) {
                        var g = "<div id='" + B + "'style='position: absolute;left: 35%;top: 20%;'><div style='position:absolute;text-align:left;left:2px;top:3px;width:446px;height:30px;z-index:17;' class='fwr-sig-layer2'><div style='position:absolute;top:7px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='Signature.SigPropertiesTitle' >Signature Properties</div></div><div  style='text-align:left;width:450px;height:210px;z-index:16;' class='fwr-sig-layer1'><div  style='width:449px;height:2px;z-index:18; ' class='fwr-sig-Line'/><div id='sigMessageId' align='right' style='position:absolute;top:60px;left: 40px;font-size: 15px' class='fwr-sig-font2 fwr-sig-layer-margin2'></div><input type='submit' id='sigfailbutton' data-i18n='[value]Signature.OkButton' style='position:absolute;left:330px;top:165px; width:70px;' class='fwr-sig-button fwr-sig-normal-button'></div></div>";
                        t.append(g), $("#sigfailbutton").off("click").on("click", function() {
                            $("#" + B).hide(), t.hide()
                        })
                    }
                    $("#sigMessageId").html(e), $("#" + B).draggable(), $("#" + B).i18n(), $("#" + B).show(), t.show()
                }
            }
        }, WebPDF.SignatureView
    }), define("core/Plugins/Signature/SignatureService", ["core/Plugins/Signature/PDFSignature", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        PDFSiganture = a("core/Plugins/Signature/PDFSignature");
        return SignatureService = function(a) {
            _readerApp = a, this.createNormalSignatrue = function(a, b, c) {
                var d = {
                    isStraddle: !1,
                    imgUrl: "",
                    pageIndex: a.getPageIndex(),
                    r: c,
                    signer: "signer",
                    dn: "domain",
                    reason: "",
                    location: "",
                    contact: "contactInfo@email.com",
                    rc: null,
                    hash: 1
                };
                d.rc = [b.left, b.top, b.right, b.bottom];
                var e = new PDFSiganture(d, WebPDF.Signature.SignatureType.Normal),
                    f = WebPDF.Common.generateUUID();
                return e.setSigName(f), a.addSignature(e), e
            }, this.createStraddleSignatrue = function(a, b, c) {
                var d = {
                    isStraddle: !0,
                    imgUrl: "",
                    pageIndex: a.getPageIndex(),
                    r: c,
                    signer: "signer",
                    dn: "domain",
                    reason: "",
                    location: "",
                    contact: "contactInfo@email.com",
                    rc: null,
                    straddle: {
                        type: 0,
                        position: 0,
                        range: "",
                        percent: 0
                    },
                    filter: "Adobe.PPKLite",
                    subFilter: "adbe.pkcs7.sha1",
                    hash: 1
                };
                d.rc = [b.left, b.top, b.right, b.bottom];
                var e = new PDFSiganture(d, WebPDF.Signature.SignatureType.Straddle),
                    f = WebPDF.Common.generateUUID();
                return e.setSigName(f), a.addSignature(e), e
            }, this.sign = function(a) {
                _readerApp = WebPDF.Tool.getReaderApp();
                var b = _readerApp.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    c = "";
                if (b) {
                    var d = b.getAnnotationDataToSave();
                    c = JSON.stringify(d)
                }
                var e = _readerApp.getPDFDoc(),
                    f = null;
                e && 2 == e.getDocType() && (f = WebPDF.FormPlugin.getFormXML(!0));
                var g = _readerApp.getPluginByName(WebPDF.InkSignPluginName),
                    h = "";
                g && (h = g.getInkSignData());
                var i = e.getAllDisaplyWateramrkInfo(),
                    j = _readerApp.getFileID(),
                    k = _readerApp.getBaseUrl() + "api/signature/" + j + "/stamp";
                a.annotData = c, a.formData = f, a.inkData = h, a.watermarkData = i, successCallback = a.success, failCallback = a.fail, a.success = null, a.fail = null, $.ajax({
                    type: "POST",
                    url: k,
                    data: a,
                    success: function(a) {
                        var b = a.resultMsg;
                        if (0 == a.resultCode && "" != a.resultBody.exparams) b = i18n.t("Signature.SigScuess"), successCallback(b, a.resultBody.exparams);
                        else {
                            switch (a.resultCode) {
                                case 101:
                                    b = i18n.t("Signature.SigUserNone");
                                    break;
                                case 102:
                                    b = i18n.t("Signature.SigDocNone");
                                    break;
                                case 201:
                                    b = i18n.t("Signature.SignatureUnregistered");
                                    break;
                                default:
                                    b = i18n.t("Signature.SigError")
                            }
                            failCallback(b, a.resultBody.exparams)
                        }
                    },
                    error: function() {
                        var a = i18n.t("Signature.SigError");
                        failCallback(a, "")
                    }
                })
            }, this.calculateRectBydirec = function(a, b, c) {
                var d;
                switch (b) {
                    case 0:
                        d = a.top + c.y, a.top = d, a.left = a.left + c.x;
                        break;
                    case 1:
                        d = a.top + c.y, a.top = d;
                        break;
                    case 2:
                        a.top = a.top + c.y, a.right = a.right + c.x;
                        break;
                    case 3:
                        a.left = a.left + c.x;
                        break;
                    case 4:
                        a.right = a.right + c.x;
                        break;
                    case 5:
                        a.left = a.left + c.x, a.bottom = a.bottom + c.y;
                        break;
                    case 6:
                        a.bottom = a.bottom + c.y;
                        break;
                    case 7:
                        a.right = a.right + c.x, a.bottom = a.bottom + c.y
                }
                a.bottom < a.top && (a.top = a.bottom), a.right < a.left && (a.left = a.right)
            }
        }, SignatureService
    }), define("core/Plugins/Signature/NormalSigToolHandler", ["core/Plugins/Signature/PDFSignature", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        WebPDF.Tools.TOOL_NAME_NORMALSIG = "Normal Signature Tool";
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect;
        a("core/Plugins/Signature/PDFSignature");
        return WebPDF.Tools.NormalSigToolHandler = function(a, b) {
            var c = a,
                f = b.getSigView(),
                g = b.getSigService(),
                h = this,
                i = !1,
                j = !1,
                k = new d(0, 0),
                l = new d(0, 0);
            this.onInit = function(a) {
                c = a
            }, this.isEnabled = function() {
                return !0
            }, this.isProcessing = function() {
                return j
            }, this.onDestroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_NORMALSIG
            }, this.onActivate = function() {
                f.setNoteCursor()
            }, this.onDeactivate = function() {
                f.cancelNoteCursor(), f.clearAllSelection(), f.clearAllSigLayer(), j = !1
            }, this.getSigRect = function(a) {
                var b, c = a.getPageViewOffsetpt(k.x, k.y),
                    d = a.getPageViewOffsetpt(l.x, l.y),
                    f = new e(c.x, c.y, d.x, d.y);
                return f.left > f.right && (b = f.left, f.left = f.right, f.right = b), f.bottom < f.top && (b = f.bottom, f.bottom = f.top, f.top = b), f
            }, this.getSignPDFRect = function(a) {
                var b = c.getMainView().getDocView(),
                    d = b.getRotate(),
                    e = a.getPageViewOffsetpt(k.x, k.y),
                    f = a.getPageViewOffsetpt(l.x, l.y),
                    g = b.getPageViewRender().getPixelsPerPoint(),
                    h = a.getScale(),
                    i = Math.abs(e.x - f.x) / (g * h * 2),
                    j = Math.abs(e.y - f.y) / (g * h * 2),
                    m = new WebPDF.PDFPoint((e.x + f.x) / 2, (e.y + f.y) / 2);
                m = a.devicePtToPDF(m);
                var n = null;
                return 0 == d || 180 == d ? n = new WebPDF.PDFRect(m.x - i, m.y + j, m.x + i, m.y - j) : (90 == d || 270 == d) && (n = new WebPDF.PDFRect(m.x - j, m.y + i, m.x + j, m.y - i)), n
            }, this.onLButtonDown = function(a) {
                var b = c.getMainView().getDocView();
                if (b.isSigAdded()) return !1;
                var d = b.getPageViewByPosition(a.pageX, a.pageY);
                return !d || d.isPageLoadLimit() ? !1 : (WebPDF.Common.preventDefaults(a, !0), k.x = a.pageX, k.y = a.pageY, i = !0, j = !0, !0)
            }, this.onLButtonUp = function(a) {
                if (!i) return !1;
                i = !1, j = !1;
                var b = c.getMainView().getDocView();
                if (b.isSigAdded()) return !1;
                var d = b.getPageViewByPosition(l.x, l.y);
                if (null == d) return !1;
                var e = h.getSignPDFRect(d),
                    k = d.getPDFPage(),
                    m = 90 * d.getPDFPage().getPageRotate() + d.getDocView().getRotate(),
                    n = g.createNormalSignatrue(k, e, m);
                return f.addSignature(d, n), f.onSigSelectedLButtonDown(d, n), l.x = 0, l.y = 0, !0
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                if (!i) return !1;
                var b = c.getMainView().getDocView();
                if (!b.isSigAdded()) {
                    var d = b.getPageViewByPosition(a.pageX, a.pageY);
                    if (null == d) return !1;
                    var e = b.getPageViewByPosition(k.x, k.y);
                    if (null == e) return !1;
                    if (d.getPageIndex() != e.getPageIndex()) return !1;
                    l.x = a.pageX, l.y = a.pageY;
                    var g = h.getLayerRect(),
                        j = f.getSigLayerID(b);
                    if (null != j && void 0 != j) {
                        f.showSigLayer(b), f.updatePageViewSigLayerPos(j, g);
                        var m = g.right - g.left,
                            n = g.bottom - g.top,
                            o = f.getSigLayerID(b);
                        return f.updateSigBorderHtml(o, m, n), !0
                    }
                }
            }, this.getLayerRect = function() {
                var a = Math.abs(l.x - k.x),
                    b = Math.abs(l.y - k.y),
                    d = null,
                    f = null;
                l.x < k.x && l.y < k.y && (d = l.x, f = l.y), l.x > k.x && l.y < k.y && (d = k.x, f = l.y), l.x < k.x && l.y > k.y && (d = l.x, f = k.y), l.x > k.x && l.y > k.y && (d = k.x, f = k.y);
                var g = c.getMainView().getDocView(),
                    h = g.getDocViewClientRect(),
                    i = g.getScrollApi(),
                    j = 0,
                    m = 0;
                i && (j = i.getContentPositionX(), m = i.getContentPositionY()), d = d - h.left + j, f = f - h.bottom + m;
                var n = new e(d, f, d + a, f + b);
                return n
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Tools.NormalSigToolHandler
    }), define("core/Plugins/Signature/StraddleSigToolHandler", ["core/Plugins/Signature/PDFSignature", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        WebPDF.Tools.TOOL_NAME_CROSSPAGESIG = "Straddle Signature Tool";
        var d = WebPDF.PDFPoint,
            e = WebPDF.PDFRect;
        a("core/Plugins/Signature/PDFSignature");
        return WebPDF.Tools.StraddleSigToolHandler = function(a, b) {
            var c = a,
                f = b.getSigView(),
                g = b.getSigService(),
                h = this,
                i = !1,
                j = !1,
                k = new d(0, 0),
                l = new d(0, 0);
            this.onInit = function(a) {
                c = a
            }, this.onDestroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_CROSSPAGESIG
            }, this.getSigRect = function(a) {
                var b, c = a.getPageViewOffsetpt(k.x, k.y),
                    d = a.getPageViewOffsetpt(l.x, l.y),
                    f = new e(c.x, c.y, d.x, d.y);
                return f.left > f.right && (b = f.left, f.left = f.right, f.right = b), f.bottom < f.top && (b = f.bottom, f.bottom = f.top, f.top = b), f
            }, this.getSignPDFRect = function(a) {
                var b = c.getMainView().getDocView(),
                    d = b.getRotate(),
                    e = a.getPageViewOffsetpt(k.x, k.y),
                    f = a.getPageViewOffsetpt(l.x, l.y),
                    g = b.getPageViewRender().getPixelsPerPoint(),
                    h = a.getScale(),
                    i = Math.abs(e.x - f.x) / (g * h * 2),
                    j = Math.abs(e.y - f.y) / (g * h * 2),
                    m = new WebPDF.PDFPoint((e.x + f.x) / 2, (e.y + f.y) / 2);
                m = a.devicePtToPDF(m);
                var n = null;
                return 0 == d || 180 == d ? n = new WebPDF.PDFRect(m.x - i, m.y + j, m.x + i, m.y - j) : (90 == d || 270 == d) && (n = new WebPDF.PDFRect(m.x - j, m.y + i, m.x + j, m.y - i)), n
            }, this.getLayerRect = function() {
                var a = Math.abs(l.x - k.x),
                    b = Math.abs(l.y - k.y),
                    d = null,
                    f = null;
                l.x < k.x && l.y < k.y && (d = l.x, f = l.y), l.x > k.x && l.y < k.y && (d = k.x, f = l.y), l.x < k.x && l.y > k.y && (d = l.x, f = k.y), l.x > k.x && l.y > k.y && (d = k.x, f = k.y);
                var g = c.getMainView().getDocView(),
                    h = g.getDocViewClientRect(),
                    i = g.getScrollApi(),
                    j = 0,
                    m = 0;
                i && (j = i.getContentPositionX(), m = i.getContentPositionY()), d = d - h.left + j, f = f - h.bottom + m;
                var n = new e(d, f, d + a, f + b);
                return n
            }, this.onActivate = function() {
                f.setNoteCursor()
            }, this.onDeactivate = function() {
                f.cancelNoteCursor(), f.clearAllSelection(), f.clearAllSigLayer(), j = !1
            }, this.isEnabled = function() {
                return !0
            }, this.isProcessing = function() {
                return !0
            }, this.onLButtonDown = function(a) {
                var b = c.getMainView().getDocView();
                if (b.isSigAdded()) return !1;
                var d = b.getPageViewByPosition(a.pageX, a.pageY);
                return !d || d.isPageLoadLimit() ? !1 : (k.x = a.pageX, k.y = a.pageY, i = !0, j = !0, !0)
            }, this.onLButtonUp = function(a) {
                if (!i) return !1;
                i = !1, j = !1;
                var b = c.getMainView().getDocView();
                if (b.isSigAdded()) return !1;
                var d = b.getPageViewByPosition(l.x, l.y);
                if (null == d) return !1;
                var e = 90 * d.getPDFPage().getPageRotate() + b.getRotate(),
                    k = h.getSignPDFRect(d),
                    m = d.getPDFPage(),
                    n = g.createStraddleSignatrue(m, k, e);
                return f.addSignature(d, n), f.onSigSelectedLButtonDown(d, n), f.showStraddleSigDialog(n), l.x = 0, l.y = 0, !0
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onMouseMove = function(a) {
                if (!i) return !1;
                var b = c.getMainView().getDocView();
                if (!b.isSigAdded()) {
                    var d = b.getPageViewByPosition(a.pageX, a.pageY);
                    if (null == d) return !1;
                    var e = b.getPageViewByPosition(k.x, k.y);
                    if (null == e) return !1;
                    if (d.getPageIndex() != e.getPageIndex()) return !1;
                    l.x = a.pageX, l.y = a.pageY;
                    var g = h.getLayerRect(),
                        j = f.getSigLayerID(b);
                    if (null != j && void 0 != j) return f.showSigLayer(b), f.updatePageViewSigLayerPos(j, g), !0
                }
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Tools.StraddleSigToolHandler
    }), define("core/Plugins/Signature/SignatureMouseHandler", [], function(a, b, c) {
        var d = WebPDF.PDFPoint,
            e = (WebPDF.PDFRect, function(a) {
                this.signaturePlugin = a, this.sigView = a.getSigView(), this._beginPoint = new d(0, 0), this._endPoint = new d(0, 0), this._isLbuttonDown = !1, this._direc = 0, this._isSelectedBorderClick = !1
            });
        return e.prototype = {
            getType: function() {
                return "Signature Mouse Handler"
            },
            onLButtonDown: function(a) {
                var b = this.sigView.isSigBorderClick(a.target, this),
                    c = this.sigView.getSigByEvent(a.target.parentElement);
                if (null == c.signature && !b) return !1;
                var d = this.signaturePlugin.getReaderApp().getMainView().getDocView(),
                    e = d.getPageViewByPosition(a.pageX, a.pageY);
                return null == e ? !1 : (this._beginPoint.x = a.pageX, this._beginPoint.y = a.pageY, this._isLbuttonDown = !0, !0)
            },
            onLButtonUp: function(a) {
                return this.sigView.isSigSelect() ? (this.sigView.updateSelectSigPosition(), this._isLbuttonDown = !1, void(this._isSelectedBorderClick = !1)) : !1
            },
            onLButtonDblClk: function(a) {
                var b = this.sigView.getSigByEvent(a.target.parentElement);
                if (null == b.signature) return !1;
                var c = this.signaturePlugin.getReaderApp().getMainView().getDocView(),
                    d = c.getPageViewByPosition(a.pageX, a.pageY);
                return null == d ? !1 : (this.sigView.onSigSelectedLButtonDown(d, b.signature), !0)
            },
            onMouseMove: function(a) {
                if (!this.sigView.isSigSelect()) return !1;
                if (!this._isLbuttonDown) return !1;
                var b = this.signaturePlugin.getReaderApp().getMainView().getDocView(),
                    c = b.getPageViewByPosition(a.pageX, a.pageY);
                return null == c ? !1 : (this._isSelectedBorderClick ? this.sigView.onSigChangeRect(c, a.pageX, a.pageY, this._beginPoint.x, this._beginPoint.y, this._direc) : this.sigView.moveSelectedSig(c, a.pageX, a.pageY, this._beginPoint.x, this._beginPoint.y), this._beginPoint.x = a.pageX, this._beginPoint.y = a.pageY, !0)
            },
            onRButtonDown: function(a) {
                return !1
            },
            onRButtonUp: function(a) {
                return !1
            },
            onRButtonDblClk: function(a) {
                return !1
            },
            onMouseWheel: function(a) {
                return !1
            },
            onMouseOver: function(a) {
                return !1
            },
            onMouseOut: function(a) {
                return this.onMouseLeave(a)
            },
            onMouseLeave: function(a) {
                return !1
            },
            onMouseEnter: function(a) {
                return this.onMouseOver(a)
            },
            onDoubleTap: function(a) {
                return !1
            },
            onPinchIn: function(a) {
                return !1
            },
            onPinchOut: function(a) {
                return !1
            },
            onHold: function(a) {
                return !1
            }
        }, WebPDF.Event.SignatureMouseHandler = e, WebPDF.Event.SignatureMouseHandler
    }), define("core/Plugins/InkSign/InkSignPlugin", ["core/Plugins/InkSign/InkSignToolHandler", "core/Plugins/InkSign/PDFInkSignLoader", "core/Plugins/InkSign/PDFInkSign", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect", "core/Common/Math/Matrix", "core/Plugins/InkSign/MobileInkSignView", "core/Plugins/InkSign/InkSignView", "core/Common/Interface", "core/Plugins/InkSign/PCInkSignView", "core/Plugins/InkSign/InkSignService"], function(a, b, c) {
        var d = (WebPDF.Config, a("core/Plugins/InkSign/InkSignToolHandler"));
        a("core/Plugins/InkSign/PDFInkSignLoader"), a("core/Common/Math/Matrix");
        var e = WebPDF.PDFMatrix;
        WebPDF.InkSignPlugin = function(b) {
            function c() {
                $(k).on(WebPDF.EventList.PAGE_SHOW_COMPLETE, function(a, b) {
                    var c = this.getPluginByName(WebPDF.InkSignPluginName),
                        d = null;
                    c && (d = c.getSignService()), d && d.onPageShowComplete(b.pageView)
                }).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function(a, b) {
                    var c = this.getPluginByName(WebPDF.InkSignPluginName),
                        d = null;
                    c && (d = c.getSignService()), d && d.onDocViewZoom(b.newScale)
                }).on(WebPDF.EventList.PAGE_VISIBLE, function(a, b) {
                    var c = k.getMainView();
                    if (c) {
                        var d = c.getDocView(),
                            e = this.getPluginByName(WebPDF.InkSignPluginName),
                            f = null;
                        if (e && (f = e.getSignService()), f)
                            for (var g = 0; g < b.pages.length; g++) f.updateSigPosition(d.getPageView(b.pages[g]))
                    }
                })
            }

            function f(a) {
                var b = k.getMainView().getDocView();
                if (a.length > 0)
                    for (var c = 0; c < a.length; c++)
                        for (var d = a[c].pageIndex, f = b.getPageView(d), h = a[c].inkSignList, j = 0; j < h.length; j++) {
                            var l = h[j].rc,
                                m = f.getPDFPage().getPageMatrix(),
                                n = new e;
                            n.SetReverse(m), l = n.TransFormRect(l[0], l[1], l[2], l[3]), l[0] > l[2] && (temp = l[0], l[0] = l[2], l[2] = temp), l[3] > l[1] && (temp = l[1], l[1] = l[3], l[3] = temp);
                            for (var o = h[j].inkData.rect, p = h[j].inkData.pencil, q = 0; q < p.length; q++) {
                                var r = p[q].points;
                                p[q].points = i(f, l, o, r);
                                var s = p[q].color;
                                s = s.substring(1, s.length), s = g(s), p[q].color = s
                            }
                        }
                return a
            }

            function g(a) {
                return parseInt(a, 16)
            }

            function h(a, b) {
                var c = (a.rc, a.inkData),
                    d = c.rect;
                d[0] = d[0] / b, d[1] = d[1] / b, d[2] = d[2] / b, d[3] = d[3] / b, c.rect = d;
                for (var e = c.pencil, f = 0; f < e.length; f++) {
                    e[f].width = e[f].width / b;
                    for (var g = 0; g < e[f].points.length; g++) e[f].points[g][0] = e[f].points[g][0] / b, e[f].points[g][1] = e[f].points[g][1] / b
                }
            }

            function i(a, b, c, d) {
                var e = a.getPDFPage(),
                    f = 90 * e.getPageRotate();
                0 > f && (f %= 360, f += 360);
                for (var g = f % 360, h = [], i = 0, j = 0, k = a.pointToPDF([0, 0]), l = k[1], m = k[0], n = 0; n < d.length; n++) {
                    d[n][0] = d[n][0] - c[0], d[n][1] = d[n][1] - c[1];
                    var o = a.pointToPDF(d[n]),
                        p = 0,
                        q = 0;
                    b[1] !== o[1] && (p = l - o[1]), b[0] !== o[0] && (q = m - o[0]), 0 === i && (90 === g ? (j = -b[0], i = o[1] - b[3] + p) : 180 === g ? (j = o[0] - b[2] + q, i = o[1] - b[3] + p) : 270 === g ? (j = o[0] - b[2] + q, i = o[1] - b[1] + p) : (j = -b[0], i = o[1] - b[1] + p)), o[0] = o[0] - j, o[1] = o[1] - i, h.push(o)
                }
                return h
            }
            var j, k = b,
                l = this,
                m = null;
            WebPDF.InkSignPluginName = "InkSign Plugin";
            var n = null,
                o = null;
            this.getName = function() {
                return WebPDF.InkSignPluginName
            }, this.onRegister = function() {}, this.getReaderApp = function() {
                return k
            }, this.getSignService = function() {
                return o
            }, this.getInkSignView = function() {
                return n
            }, this.getCurInkSignature = function(a) {
                return null == m && $.isFunction(a) && (m = a), null != m ? m.call() : null
            }, this.init = function() {
                if ($(k).trigger(WebPDF.EventList.INKSIGN_INIT), navigator.userAgent.match(/mobile|Android|iPhone|ios|iPod/i)) {
                    var e = a("core/Plugins/InkSign/MobileInkSignView");
                    n = new e(b)
                } else {
                    var f = a("core/Plugins/InkSign/PCInkSignView");
                    n = new f(b)
                }
                o = a("core/Plugins/InkSign/InkSignService").createInkSignService(b), o.setViewCallback(n.getSigPageviewRect, n.moveSigPosition, n.addInkSignContainer, n.setCanvasSize, n.createPageViewSigHTML, n.updateCanvasData, n.updateSigSelectBorderHtml, n.updateInkSignParentByZoom, n.createSignByNoCert, n.updateInkSignParentPos), j = new d(this), k.registerToolHandler(j), k.isInkSignEventInit() || (c(), k.setInkSignEventInit(!0));
                var g = new WebPDF.PDFInkSignLoader;
                g.asyncLoadInkSign(k, k.getPDFDoc())
            }, this.unload = function() {}, this.onBeforeUnload = function() {}, this._browser = function() {
                WebPDF.Environment.ie && (WebPDF.Environment.ie8 || WebPDF.Environment.ie8Compact || WebPDF.Environment.ie7Compact || WebPDF.Environment.ie6Compact) && (ie8_below = !0), WebPDF.Environment.safari && Number(WebPDF.Environment.version) > Number(print_lowest_safari) && (safari = !0)
            }, this.getInkSignInfo = function(a, b, c) {
                if (null == a) return null;
                var d = a.getPageIndex(),
                    e = k.getMainView().getDocView(),
                    f = e.getPageView(d),
                    g = a.getSigName(),
                    i = f.getPDFPage(),
                    j = i.getInkSigByName(g),
                    l = $.extend(!0, {}, j);
                b && l.setLocation(b), c && l.setReason(c);
                var m = l.getRect();
                l.generatePosionByRect(m);
                var n = f.getScale();
                1 != n && h(l.getSigJSONData(), n);
                var o = JSON.stringify(l.getSigJSONData());
                return o
            }, this.sign = function(a) {
                var b = a.sigJSONData.pageIndex,
                    c = k.getMainView().getDocView(),
                    d = c.getPageView(b),
                    e = d.getScale();
                o.createSignByNoCert(d, a, e), n.removeInkSignParent();
                var f = k.getPDFDoc(),
                    g = f.getPage(b),
                    i = g.getInkSignJsonData();
                return 1 != e && h(a.sigJSONData, e), i.push(a.sigJSONData), c.setModified(!0), !1
            }, this.getInkSignData = function() {
                for (var a = k.getMainView().getDocView(), b = k.getPDFDoc(), c = b.getPageCount(), d = [], e = 0; c > e; e++) {
                    var g = a.getPageView(e),
                        h = {};
                    h.pageIndex = e;
                    var i = g.getPDFPage().getInkSignJsonData();
                    if (h.inkSignList = i, i.length > 0) {
                        var j = $.extend(!0, {}, h);
                        d.push(j)
                    }
                }
                return d = f(d), 0 == d.length ? null : JSON.stringify(d)
            }, this.save = function() {
                return new Promise(function(a, b) {
                    var c = k.getBaseUrl() + "api/signature/inkSign/save",
                        d = l.getInkSignData();
                    if (null == d) return void a();
                    var e = {
                        fileId: k.getFileID(),
                        signData: d
                    };
                    $.ajax({
                        type: "post",
                        url: c,
                        dataType: "json",
                        data: e,
                        success: function(b) {
                            var c = b.error;
                            if (0 != c);
                            else {
                                k.updateVersion(b.version);
                                var d = k.getMainView().getDocView();
                                d.setModified(!1), a()
                            }
                        },
                        error: function(a) {
                            b(i18n.t("saveData.inkSignDataFail"))
                        }
                    })
                })
            }, this.replace = function() {
                n.replace(function(a, b, c, d) {
                    var e = l.getCurInkSignature();
                    l.getSignService().createInkSign(e, a, b, c, d)
                })
            }, this.signWithCert = function(a) {
                var b = k.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    c = null;
                if (b) {
                    var d = b.getAnnotationDataToSave();
                    c = JSON.stringify(d)
                }
                var e = k.getPDFDoc(),
                    f = null;
                e && 2 == e.getDocType() && (f = WebPDF.FormPlugin.getFormXML(!0));
                var g = l.getInkSignData(),
                    h = e.getAllDisaplyWateramrkInfo(),
                    i = k.getFileID(),
                    j = k.getBaseUrl() + "api/signature/" + i + "/stamp";
                a.annotData = c, a.formData = f, a.inkData = g, a.watermarkData = h, successCallback = a.success, failCallback = a.fail, a.success = null, a.fail = null, $.ajax({
                    type: "POST",
                    url: j,
                    data: a,
                    success: function(a) {
                        var b = a.resultMsg;
                        if (0 == a.resultCode && "" != a.resultBody.exparams) b = i18n.t("InkSign.SigScuess"), successCallback(b, a.resultBody.exparams);
                        else {
                            switch (a.resultCode) {
                                case 101:
                                    b = i18n.t("InkSign.SigUserNone");
                                    break;
                                case 102:
                                    b = i18n.t("InkSign.SigDocNone");
                                    break;
                                case 201:
                                    b = i18n.t("InkSign.SignatureUnregistered");
                                    break;
                                default:
                                    b = i18n.t("InkSign.SigError")
                            }
                            failCallback(b, a.resultBody.exparams)
                        }
                    },
                    error: function() {
                        var a = i18n.t("InkSign.SigError");
                        failCallback(a, "")
                    }
                })
            }, this.cancelSign = function(a) {
                var b = k.getMainView().getDocView();
                o.deleteInkSign(a), b.setInkSigAddFlag(!1)
            }
        }, b.createPlugin = function(a) {
            var b = new WebPDF.InkSignPlugin(a);
            return b
        }
    }), define("core/Plugins/InkSign/InkSignToolHandler", [], function(a, b, c) {
        WebPDF.Tools.TOOL_NAME_INKSIGN = "InkSign Tool";
        var d = WebPDF.PDFPoint;
        WebPDF.PDFRect;
        return WebPDF.Tools.InkSignToolHandler = function(a, b) {
            var c, e = null,
                f = a,
                g = this,
                h = !1,
                i = !1,
                j = !1;
            _beginPoint = new d(0, 0), _endPoint = new d(0, 0), this.onInit = function(a) {
                e = a
            }, this.isEnabled = function() {
                return !0
            }, this.isProcessing = function() {
                return i
            }, this.onDestroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_INKSIGN
            }, this.onActivate = function() {}, this.onDeactivate = function() {
                var a = e.getMainView().getDocView();
                a.setInkSigAddFlag(!1), f.getInkSignView().removeInkSignParent(), $(e).trigger(WebPDF.EventList.INKSIGN_TOOL_DEACTIVATE)
            }, this.onLButtonDown = function(a) {
                var b = a.target.parentElement,
                    c = e.getMainView().getDocView(),
                    d = c.getPageViewByPosition(a.pageX, a.pageY);
                if (!d || d.isPageLoadLimit()) return !1;
                var f = g.isSigBorderClick(a.target, b),
                    i = g.getSigByEvent(a.target, b);
                return 0 != i || f ? (_beginPoint.x = a.pageX, _beginPoint.y = a.pageY, h = !0, !0) : !1
            }, this.onMouseMove = function(a) {
                if (!h) return !1;
                var b = f.getReaderApp().getMainView().getDocView(),
                    d = b.getPageViewByPosition(a.pageX, a.pageY);
                return null == d ? (h = !1, !1) : (f.getInkSignView().mouseMove(function(b) {
                    j ? f.getSignService().onSigChangeRect(d, b, a.pageX, a.pageY, _beginPoint.x, _beginPoint.y, c) : f.getSignService().onSigSelectedMousemove(d, b, a.pageX, a.pageY, _beginPoint.x, _beginPoint.y)
                }), _beginPoint.x = a.pageX, _beginPoint.y = a.pageY, !0)
            }, this.onLButtonUp = function(a) {
                h = !1, j = !1;
                var b = e.getMainView().getDocView(),
                    c = b.getPageViewByPosition(a.pageX, a.pageY),
                    d = b.getRotate();
                if (!c || c.isPageLoadLimit()) return !1;
                var g = f.getCurInkSignature();
                return f.getInkSignView().lButtonUp(g, function() {
                    f.getSignService().createInkSign(g, c, a.pageX, a.pageY, d)
                }), !0
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.getLayerRect = function() {}, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }, this.isSigBorderClick = function(a, b) {
                var d = f.getInkSignView().isSigBorderClick(a, b);
                return d && (c = d.direc, j = d.isClick), j
            }, this.getSigByEvent = function(a, b) {
                return f.getInkSignView().getSigByEvent(a, b)
            }
        }, WebPDF.Tools.InkSignToolHandler
    }), define("core/Plugins/InkSign/PDFInkSignLoader", ["core/Plugins/InkSign/PDFInkSign", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        a("core/Plugins/InkSign/PDFInkSign");
        var d = WebPDF.InkSign.PDFInkSign,
            e = a("core/Common/Math/Rect");
        WebPDF.PDFInkSignLoader = function() {
            function a(a, d) {
                if (d && d.length > 0)
                    for (var e = 0; e < d.length; e++)
                        for (var f = d[e].pageIndex, g = d[e].inkSignList, h = 0; h < g.length; h++)
                            for (var i = g[h].rc, j = g[h].inkData.rect, k = g[h].inkData.pencil, l = 0; l < k.length; l++) {
                                var m = k[l].points;
                                k[l].points = c(a, f, i, j, m);
                                var n = k[l].color;
                                n = "#" + b(n), k[l].color = n
                            }
                return d
            }

            function b(a) {
                var a = a.toString(16),
                    b = a.length;
                if (a.length < 6)
                    for (var c = 0; 6 - b > c; c++) a = "0" + a;
                return a
            }

            function c(a, b, c, d, f) {
                var g = a.getMainView().getDocView(),
                    h = g.getPageView(b);
                c = new e(c[0], c[1], c[2], c[3]);
                for (var i = h.getScale(), j = [], k = 0; k < f.length; k++) {
                    var l = h.pdfPointToDevice(f[k]),
                        m = h.pdfRectToDevice(c, !0),
                        n = [];
                    n[0] = l[0] - m.left + d[0], n[1] = l[1] - m.top + d[1], n[0] = (n[0] + d[0] * (i - 1)) / i, n[1] = (n[1] + d[1] * (i - 1)) / i, j.push(n)
                }
                return j
            }
            this.asyncLoadInkSign = function(b, c) {
                var e = b.getBaseUrl() + "api/signature/inkSign/signData?" + Math.random(),
                    f = {
                        fileId: b.getFileID()
                    };
                $.ajax({
                    type: "GET",
                    url: e,
                    dataType: "json",
                    headers: {
                        "x-auth-doc": b.getPDFPassword()
                    },
                    data: f,
                    success: function(e) {
                        if (null == e) return void console.warn("Get inksign data error: response is null");
                        var f = e.error;
                        if (0 != f) {
                            var g = e.data;
                            if ("undefined" == typeof g || null == g) return
                        } else {
                            var h = $.parseJSON(e.data);
                            if (h = a(b, h))
                                for (var i = 0; i < h.length; i++) {
                                    var j = h[i].pageIndex,
                                        k = c.getPage(j),
                                        l = h[i].inkSignList;
                                    k.setInkSignJsonData(l);
                                    for (var m = 0; m < l.length; m++) {
                                        var n = new d(l[m], "inksign");
                                        k.addInkSign(n)
                                    }
                                }
                        }
                    },
                    error: function(a) {
                        console.log(a)
                    }
                })
            }
        }
    }), define("core/Plugins/InkSign/MobileInkSignView", ["core/Plugins/InkSign/InkSignView", "core/Common/Interface", "core/WebPDF"], function(a, b, c) {
        function d(a) {
            d.superclass.constructor.call(this, a), i = a
        }

        function e(a) {
            $(a).remove()
        }

        function f(a, b, c) {
            var d = i.getMainView().getDocView(),
                e = parseInt(a.attr("pageIndex"));
            isNaN(e) && (e = d.getCurPageIndex());
            var f = d.getPageView(e).getScale(),
                g = a.find("canvas"),
                h = i.getPixelsPerPoint(),
                j = parseFloat(g.width()) / (f * h),
                k = parseFloat(g.height()) / (f * h),
                l = $('<canvas width="' + j + '" height="' + k + '"></canvas>')[0];
            l.getContext("2d");
            l.width = j, l.height = k;
            var m = 1 / (f * h),
                n = b.sigJSONData.inkData,
                o = n.per;
            c(l, n, m, o);
            var p = l.toDataURL();
            $(i).trigger(WebPDF.EventList.INKSIGN_SIGN, {
                inkSign: b,
                canvasImgData: p
            })
        }
        var g = a("core/Plugins/InkSign/InkSignView"),
            h = a("core/Common/Interface"),
            i = null;
        return d.prototype = {
            initView: function() {},
            updateSigMenuPosition: function(a, b) {
                var c = i.getMainView().getDocView(),
                    d = c.getRotate(),
                    g = $(".fwr-inksign-parent"),
                    h = $(g).offset(),
                    j = $("#inksign-doc-menu"),
                    k = $(g).width();
                d % 180 != 0 && (k = $(g).height());
                var l = $(j).width() + 1,
                    m = $(window).width(),
                    n = h.left + (k - $(j).width()) / 2;
                0 > n && (n = 0), n + l > m && (n = m - l);
                var o = 0;
                h.top < $(j).height() ? (o = h.top + $(g).height(), $("#inksign-menuArrow-up").show(), $("#inksign-menuArrow-down").hide()) : (o = h.top - $(j).height(), $("#inksign-menuArrow-down").show(), $("#inksign-menuArrow-up").hide()), $(j).css({
                        left: n,
                        top: o,
                        visibility: "visible"
                    }),
                    function(b) {
                        $("#inksign-btnSign").off("tap").bind("tap", function() {
                            return f(g, a, b), $(j).css({
                                visibility: "hidden"
                            }), !1
                        }), $("#inksign-btnCancel").off("tap").bind("tap", function() {
                            return $(j).css({
                                visibility: "hidden"
                            }), e(g), WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_INKSIGN), !1
                        })
                    }(b)
            }
        }, h.extend(d, g), d
    }), define("core/Plugins/InkSign/InkSignView", [], function(a, b, c) {
        function d(a) {
            f = a, g = this
        }
        var e = WebPDF.PDFRect,
            f = null,
            g = null;
        return d.prototype = {
            initView: function() {},
            getSigPageviewRect: function() {
                var a = $(".fwr-inksign-parent"),
                    b = new e;
                return b.top = parseFloat(a.css("top")), b.left = parseFloat(a.css("left")), b.bottom = b.top + parseFloat(a.css("height")), b.right = b.left + parseFloat(a.css("width")), b
            },
            moveSigPosition: function(a, b, c, d) {
                var e = f.getDocView().getRotate(),
                    g = $(".fwr-inksign-parent"),
                    h = g.css("left"),
                    i = g.css("top"),
                    j = parseFloat(g.css("width")),
                    k = parseFloat(g.css("height")),
                    l = a.getPageViewWidth(),
                    m = a.getPageViewHeight(),
                    n = l;
                (270 == e || 90 == e) && (l = m, m = n), 90 == e || 270 == e ? (i = parseFloat(i) + b, h = parseFloat(h) + c) : (i = parseFloat(i) + c, h = parseFloat(h) + b), d > i && (i = d), d > h && (h = d), h + j > l - d && (h = l - j - d), i + k > m - d && (i = m - k - d), g.css("left", h + "px"), g.css("top", i + "px")
            },
            createInkSignHtml: function(a, b, c) {
                c = c ? c : 1;
                var d = b.getSigName(),
                    e = g.getPageSigID(a, d),
                    f = g.getPageSigCanvansID(a, d),
                    h = b.getRect(),
                    i = a.pdfRectToDevice(h, !0),
                    j = (i.right - i.left) * c,
                    k = (i.bottom - i.top) * c,
                    l = i.left * c,
                    m = i.top * c,
                    n = "left:" + l + "px;top:" + m + "px;width:" + j + "px;height:" + k + "px",
                    o = "<div id='" + e + "' class ='fwr-annot-data fwr-inksign-sign' pageIndex ='" + a.getPageIndex() + "' sigName='" + d + "' style='" + n + "'><canvas id=" + f + " class='vml' width=" + j + " height=" + k + "></canvas></div>";
                return o
            },
            getPageViewSigHtml: function(a, b, c, d, e, f) {
                var g = b.getSigName(),
                    h = '<div class="fwr-inksign-parent" pageIndex="' + a.getPageIndex() + '" sigName="' + g + '"  style="width:' + e + "px;height:" + f + "px;top:" + c + "px;left:" + d + 'px;z-index:5;"><canvas></canvas><div class="fwr-inksign-change"><div class="p-top-left" data-dir="1"></div><div class="p-top-right" data-dir="2"></div><div class="p-bottom-left" data-dir="3"></div><div class="p-bottom-right" data-dir="4"></div></div><div class="fwr-inksign-bg"></div></div>';
                return h
            },
            getPageSignedContainerID: function(a) {
                return a.getPageViewContainerID() + "_inkSignedContainer"
            },
            getSigSelectBorderHtml: function() {
                var a = f.getDocView().getRotate(),
                    b = $(".fwr-inksign-parent").width(),
                    c = $(".fwr-inksign-parent").height(),
                    d = $(".fwr-inksign-parent .fwr-inksign-control").width();
                $(".fwr-inksign-parent .fwr-inksign-control").height();
                $(".fwr-inksign-parent .fwr-inksign-change,.fwr-inksign-parent .fwr-inksign-control").remove();
                var e = "";
                e = 90 == a || 270 == a ? '<div class="fwr-inksign-change"><div class="p-top-left" data-dir="1" style="cursor:ne-resize"></div><div class="p-top-right" data-dir="2" style="cursor:nw-resize"></div><div class="p-bottom-left" data-dir="3" style="cursor:nw-resize"></div><div class="p-bottom-right" data-dir="4" style="cursor:ne-resize"></div></div>' : '<div class="fwr-inksign-change"><div class="p-top-left" data-dir="1" style="cursor:nw-resize"></div><div class="p-top-right" data-dir="2" style="cursor:ne-resize"></div><div class="p-bottom-left" data-dir="3" style="cursor:ne-resize"></div><div class="p-bottom-right" data-dir="4" style="cursor:nw-resize"></div></div>';
                var g = "",
                    h = "",
                    i = 0,
                    j = 0;
                return 90 == a ? (i = c - 17, j = 48, h = "rotate(-" + a + "deg) translateX(" + i + "px) translateY(" + j + "px)", h += "transform:" + h + ";-webkit-transform:" + h + ";-moz-transform:" + h + ";-o-transform;-ms-transform:" + h + ";", g = '<div class="fwr-inksign-control cok-bg" style="' + h + '"><span class="fwr-icons-sigbtn inksign-cancel"></span><span class="fwr-icons-sigbtn inksign-ok"></span></div>') : 180 == a ? (i = d - 50, j = c + 36, h = "rotate(-" + a + "deg) translateX(" + i + "px) translateY(" + j + "px)", h += "transform:" + h + ";-webkit-transform:" + h + ";-moz-transform:" + h + ";-o-transform;-ms-transform:" + h + ";", g = '<div class="fwr-inksign-control cok-bg" style="' + h + '"><span class="fwr-icons-sigbtn inksign-cancel"></span><span class="fwr-icons-sigbtn inksign-ok"></span></div>') : 270 == a ? (i = 17 - d, j = b - 13, h = "rotate(-" + a + "deg) translateX(" + i + "px) translateY(" + j + "px)", h += "transform:" + h + ";-webkit-transform:" + h + ";-moz-transform:" + h + ";-o-transform;-ms-transform:" + h + ";", g = '<div class="fwr-inksign-control cok-bg" style="' + h + '"><span class="fwr-icons-sigbtn inksign-cancel"></span><span class="fwr-icons-sigbtn inksign-ok"></span></div>') : (h = "rotate(-" + a + "deg) translateX(-17px) translateY(-17px)", g = '<div class="fwr-inksign-control cok-bg" style="' + h + '"><span class="fwr-icons-sigbtn inksign-cancel"></span><span class="fwr-icons-sigbtn inksign-ok"></span></div>'), e += g
            },
            getPageSigID: function(a, b) {
                return a.getPageViewContainerID() + "_inksign_" + b
            },
            getPageSigCanvansID: function(a, b) {
                return a.getPageViewContainerID() + "_inksign_canvas_" + b
            },
            addInkSignContainer: function(a) {
                if (!a.isInkSignContainerAdd()) {
                    var b = "<div id='" + g.getPageSignedContainerID(a) + "'> </div>";
                    $("#" + a.getPageViewContainerID()).append(b), a.setInkSignContainerAdd(!0)
                }
            },
            setCanvasSize: function(a, b) {
                var c = $(".fwr-inksign-parent canvas").get(0);
                return c.width = a, c.height = b, c
            },
            createPageViewSigHTML: function(a, b, c, d, e, f) {
                var h = g.getPageViewSigHtml(a, b, c, d, e, f),
                    i = g.getPageSignedContainerID(a);
                $("#" + i).append(h)
            },
            updateCanvasData: function(a, b, c, d) {
                var e = g.getPageSigID(a, b),
                    f = "#" + e,
                    h = c.right - c.left,
                    i = c.bottom - c.top;
                $(f).css({
                    left: c.left + "px",
                    top: c.top + "px",
                    height: i + "px",
                    width: h + "px"
                });
                var j = $(f).find("canvas").get(0);
                if (j) {
                    j.height = i, j.width = h;
                    var k = $.extend(!0, {}, d);
                    return {
                        canvas: j,
                        canvasData: k
                    }
                }
            },
            updateSigSelectBorderHtml: function(a, b) {
                var c = f.getMainView().getDocView(),
                    d = $(".fwr-inksign-parent"),
                    e = parseInt(d.attr("pageIndex"));
                if (!isNaN(e)) {
                    var h = d.attr("Signame"),
                        i = c.getPageView(e),
                        j = i.getPDFPage(),
                        k = j.getInkSigByName(h);
                    g.updateSigMenuPosition(k, a, b)
                }
            },
            updateInkSignParentByZoom: function(a) {
                var b = a.getPageViewContainerID(),
                    c = $("#" + b).find(".fwr-inksign-parent");
                if (c.get(0)) {
                    var d = c.attr("Signame"),
                        e = a.getPDFPage(),
                        f = e.getInkSigByName(d),
                        g = f.getRect(),
                        h = f.getInkData(),
                        i = a.pdfRectToDevice(g, !0),
                        j = i.right - i.left,
                        k = i.bottom - i.top;
                    $(".fwr-inksign-parent").css({
                        left: i.left + "px",
                        top: i.top + "px",
                        height: k + "px",
                        width: j + "px"
                    });
                    var l = $(".fwr-inksign-parent").find("canvas").get(0);
                    return l.height = k, l.width = j, {
                        canvas: l,
                        canvasData: h,
                        width: j,
                        height: k,
                        inkSign: f,
                        deviceRect: i
                    }
                }
            },
            getInkSignsHtmlContent: function(a, b) {
                if (a) {
                    b = b ? b : 1;
                    var c = "<div id='" + g.getPageSignedContainerID(a) + "'> ",
                        d = a.getPDFPage();
                    return d.enumInkSign(function(d) {
                        c += g.createInkSignHtml(a, d, b)
                    }), c += "</div>"
                }
            },
            createSignByNoCert: function(a, b) {
                var c = g.getPageSignedContainerID(a),
                    d = g.createInkSignHtml(a, b);
                $("#" + c).append(d);
                var e = g.getPageSigID(a, b.getSigName()),
                    f = $("#" + e).find("canvas").get(0);
                return null == f || $.support.canvas || (uuClass.Canvas.InitCavansElement(f), f = $("#" + e).find("canvas").get(0)), f
            },
            updateInkSignParentPos: function(a) {
                var b = $(".fwr-inksign-parent");
                if (b.get(0)) {
                    var c = a.right - a.left,
                        d = a.bottom - a.top;
                    b.css({
                        left: a.left + "px",
                        top: a.top + "px",
                        height: d + "px",
                        width: c + "px"
                    });
                    var e = b.find("canvas").get(0);
                    e.height = d, e.width = c;
                    var f = b.attr("Signame");
                    return {
                        canvas: e,
                        sigName: f
                    }
                }
            },
            updateSelectSigPosition: function() {
                var a = $(".fwr-inksign-parent"),
                    b = parseInt(a.attr("pageIndex")),
                    c = a.attr("Signame"),
                    d = f.getMainView().getDocView(),
                    g = d.getPageView(b),
                    h = new e,
                    i = new e;
                h.top = parseFloat(a.css("top")), h.left = parseFloat(a.css("left")), h.bottom = h.top + parseFloat(a.css("height")), h.right = h.left + parseFloat(a.css("width"));
                var j = d.getRotate();
                90 == j ? (i.top = h.left, i.left = g.getPageViewWidth() - (h.top + parseFloat(a.css("height"))), i.bottom = h.left + parseFloat(a.css("width")), i.right = g.getPageViewWidth() - h.top, h = i) : 180 == j ? (i.top = g.getPageViewHeight() - (h.top + parseFloat(a.css("height"))), i.left = g.getPageViewWidth() - h.right, i.bottom = i.top + parseFloat(a.css("height")), i.right = i.left + parseFloat(a.css("width")), h = i) : 270 == j && (i.top = g.getPageViewHeight() - (h.left + parseFloat(a.css("width"))), i.left = h.top, i.bottom = i.top + parseFloat(a.css("width")), i.right = i.left + parseFloat(a.css("height")), h = i);
                var k = g.deviceRectToPDF(h, !0),
                    l = g.getPDFPage(),
                    m = l.getInkSigByName(c);
                m.setRect(k)
            },
            removeInkSignParent: function() {
                $(".fwr-inksign-parent").get(0) && $(".fwr-inksign-parent").remove()
            },
            replace: function(a) {
                var b = $(".fwr-inksign-parent");
                if (!b.get(0)) return !1;
                var c = parseInt(b.attr("pageIndex")),
                    d = f.getMainView().getDocView(),
                    e = d.getPageView(c),
                    h = b.attr("Signame"),
                    i = e.getPDFPage();
                i.deleteInkSigByName(h);
                var j, k, l = parseFloat(b.css("top")),
                    m = parseFloat(b.css("left")),
                    n = parseFloat(b.width()),
                    o = parseFloat(b.height()),
                    p = d.getRotate();
                270 == p ? (k = e.getPageViewHeight() - m - n / 2, j = l + o / 2) : 90 == p ? (k = m + n / 2, j = e.getPageViewWidth() - l - o / 2) : 180 == p ? (j = e.getPageViewWidth() - m - n / 2, k = e.getPageViewHeight() - l - o / 2) : (j = m + n / 2, k = l + o / 2);
                var q = $("#" + e.getPageViewContainerID()).offset(),
                    r = j + q.left,
                    s = k + q.top;
                b.remove(), a(e, r, s, p), g.updateSelectSigPosition()
            },
            mouseMove: function(a) {
                var b = $(".fwr-inksign-parent").get(0);
                b && a(b)
            },
            lButtonUp: function(a, b) {
                null != a && null == $(".fwr-inksign-parent").get(0) ? b() : $(".fwr-inksign-parent").get(0) && g.updateSelectSigPosition()
            },
            isSigBorderClick: function(a, b) {
                if ($(b).hasClass("fwr-inksign-change")) {
                    var c = parseInt($(a).data("dir"));
                    return {
                        isClick: !0,
                        direc: c
                    }
                }
                return !1
            },
            getSigByEvent: function(a, b) {
                return $(b).hasClass("fwr-inksign-parent") && "CANVAS" == a.nodeName ? !0 : !1
            }
        }, d
    }), define("core/Plugins/InkSign/PCInkSignView", ["core/Plugins/InkSign/InkSignView", "core/Common/Interface", "core/WebPDF"], function(a, b, c) {
        function d(a) {
            d.superclass.constructor.call(this, a), i = a, j = this
        }

        function e(a) {
            $(a).remove()
        }

        function f(a, b, c) {
            var d = i.getMainView().getDocView(),
                e = parseInt(a.attr("pageIndex"));
            isNaN(e) && (e = d.getCurPageIndex());
            var f = d.getPageView(e).getScale(),
                g = a.find("canvas"),
                h = i.getPixelsPerPoint(),
                j = parseFloat(g.width()) / (f * h),
                k = parseFloat(g.height()) / (f * h),
                l = $('<canvas width="' + j + '" height="' + k + '"></canvas>')[0];
            l.getContext("2d");
            l.width = j, l.height = k;
            var m = 1 / (f * h),
                n = b.sigJSONData.inkData,
                o = n.per;
            c(l, n, m, o);
            var p = l.toDataURL();
            $(i).trigger(WebPDF.EventList.INKSIGN_SIGN, {
                inkSign: b,
                canvasImgData: p
            })
        }
        var g = a("core/Plugins/InkSign/InkSignView"),
            h = a("core/Common/Interface"),
            i = null,
            j = null;
        return d.prototype = {
            initView: function() {},
            updateSigMenuPosition: function(a, b, c) {
                var d = $(".fwr-inksign-parent"),
                    g = j.getSigSelectBorderHtml();
                d.append(g), g = j.getSigSelectBorderHtml(), d.append(g);
                var h = i.getMainView().getDocView(),
                    k = parseInt(d.attr("pageIndex"));
                if (!isNaN(k)) {
                    var l = d.attr("Signame"),
                        m = h.getPageView(k),
                        n = m.getPDFPage(),
                        o = n.getInkSigByName(l);
                    ! function(a, b) {
                        d.find(".inksign-ok").off("click").bind("click", function() {
                            return f($(this).parents(".fwr-inksign-parent"), o, a), b(), !1
                        }), d.find(".inksign-cancel").off("click").bind("click", function() {
                            return e($(".fwr-inksign-parent")), WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), n.deleteInkSigByName(l), b(), $(i).trigger(WebPDF.EventList.INKSIGN_TOOL_DEACTIVATE), !1
                        })
                    }(b, c)
                }
            }
        }, h.extend(d, g), d
    }), define("core/Plugins/InkSign/InkSignService", ["core/Plugins/InkSign/PDFInkSign", "core/WebPDF", "core/Common/Math/Point", "core/Common/Math/Rect"], function(a, b, c) {
        function d(a) {
            function b() {
                j = 0, m = null, n = 0, k = 0, l = 0
            }

            function c(a) {
                var b = a.rect[0],
                    c = a.rect[1],
                    d = a.rect[2],
                    e = a.rect[3],
                    f = d - b + o,
                    g = e - c + o;
                return {
                    width: f,
                    height: g
                }
            }

            function d(a) {
                var b = 1,
                    d = c(a),
                    e = q / p,
                    f = d.width / d.height;
                b = f > e ? parseFloat(d.width / q) : parseFloat(d.height / p);
                for (var g = $.extend(!0, {}, a), h = 0; h < g.rect.length; h++) g.rect[h] = g.rect[h] / b;
                for (var i = 0; i < g.pencil.length; i++) {
                    for (var j = 0; j < g.pencil[i].points.length; j++) g.pencil[i].points[j][0] = g.pencil[i].points[j][0] / b, g.pencil[i].points[j][1] = g.pencil[i].points[j][1] / b;
                    g.pencil[i].width = g.pencil[i].width / b < s ? s : g.pencil[i].width / b
                }
                return g
            }

            function f(a, b, c, d, e) {
                var f = a.getDocView().getPageViewRender().getPixelsPerPoint(),
                    g = c / f,
                    h = d / f,
                    i = g / 2,
                    j = h / 2,
                    k = null;
                k = new WebPDF.PDFRect(e.x - i, e.y + j, e.x + i, e.y - j);
                var l = a.getPDFPage(),
                    m = l.getPageWidth(),
                    n = l.getPageHeight(),
                    o = r / f;
                return k.left < o && WebPDF.RectUtils.offset(k, 0 - k.left + o, 0), k.bottom < o && WebPDF.RectUtils.offset(k, 0, 0 - k.bottom + o), k.right > m - o && WebPDF.RectUtils.offset(k, m - k.right - o, 0), k.top > n - o && WebPDF.RectUtils.offset(k, 0, n - k.top - o), k
            }

            function g() {
                for (var a = Configs.InkSign.sizes, b = 0, c = 0; c < a.length; c++) b < a[c] && (b = a[c]);
                return b
            }
            var h = a,
                i = this,
                j = 0,
                k = 0,
                l = 0,
                m = null,
                n = 1,
                o = g(),
                p = 85,
                q = 135,
                r = 4,
                s = 1.5,
                t = {},
                u = null,
                v = null;
            _addInkSignContainerFun = null, _setCanvasSizeFun = null, _createPageViewSigHTMLFun = null, _updateCanvasDataFun = null, _updateSigSelectBorderHtmlFun = null, _updateInkSignParentByZoomFun = null, _createSignByNoCertFun = null, _updateInkSignParentPosFun = null, this.init = function() {
                j = 0, k = 0, l = 0, m = null, n = 1, t = {}
            }, this.setViewCallback = function(a, b, c, d, e, f, g, h, i, j) {
                u = a, v = b, _addInkSignContainerFun = c, _setCanvasSizeFun = d, _createPageViewSigHTMLFun = e, _updateCanvasDataFun = f, _updateSigSelectBorderHtmlFun = g, _updateInkSignParentByZoomFun = h, _createSignByNoCertFun = i, _updateInkSignParentPosFun = j
            }, this.createInkSign = function(a, g, o, p, q) {
                var r = d(a);
                m = r;
                var s = c(m);
                n = s.width / s.height, j = s.width, l = s.width;
                var t = g.getScale(),
                    u = s.width * t,
                    v = s.height * t,
                    w = g.getPageViewOffsetpt(o, p),
                    x = g.devicePtToPDF(w),
                    y = f(g, q, s.width, s.height, x),
                    z = 90 * g.getPDFPage().getPageRotate(),
                    A = {
                        isStraddle: !1,
                        pageIndex: g.getPageIndex(),
                        r: z,
                        signer: "signer",
                        dn: "domain",
                        reason: "",
                        location: "",
                        contact: "contactInfo@email.com",
                        rc: null,
                        hash: 1,
                        subty: "InkSign",
                        inkData: r
                    },
                    B = g.pdfRectToDevice(y, !0),
                    C = u / j,
                    D = $.extend(!0, {}, m);
                D = i.seiriCanvasDatas(D, C), A.inkData = D, A.rc = [y.left, y.top, y.right, y.bottom];
                var E = new e(A, WebPDF.InkSign.InkSignType.Normal),
                    F = g.getPDFPage(),
                    G = WebPDF.Common.generateUUID();
                E.setSigName(G), F.addInkSign(E), k = B, u = B.right - B.left, v = B.bottom - B.top, _createPageViewSigHTMLFun(g, E, B.top, B.left, u, v);
                var H = _setCanvasSizeFun(u, v);
                i.drawCanvas(H, r, t, C), _updateSigSelectBorderHtmlFun(i.drawCanvas, b);
                var I = h.getMainView().getDocView();
                I.setInkSigAddFlag(!0)
            }, this.onPageShowComplete = function(a) {
                if (!a || a.isPageLoadError()) return !1;
                if (t[a.getPageIndex()]) return !0;
                _addInkSignContainerFun(a), i.createPageInkSigns(a);
                a.getPageIndex();
                return t[a.getPageIndex()] = !0, !0
            }, this.onDocViewZoom = function(a) {
                for (var b = h.getMainView().getDocView(), c = b.getVisiblePageRange(), d = c.begin; d <= c.end; d++) i.updateSigPosition(b.getPageView(d)), i.updateInkSignParentByZoom(b.getPageView(d))
            }, this.updateSigPosition = function(a) {
                if (a) {
                    var c = a.getPDFPage();
                    c.enumInkSign(function(b) {
                        var c = b.getSigName(),
                            d = b.getRect(),
                            e = b.getInkData(),
                            f = a.pdfRectToDevice(d, !0);
                        i.updatePageViewSigLayerPos(a, c, f, e)
                    }), _updateSigSelectBorderHtmlFun(i.drawCanvas, b)
                }
            }, this.updateInkSignParentByZoom = function(a) {
                var c = _updateInkSignParentByZoomFun(a);
                if (c) {
                    var d = c.width / j,
                        e = c.width / l,
                        f = i.seiriCanvasDatas(c.canvasData, e);
                    c.inkSign.setInkData(f), i.drawCanvas(c.canvas, f, 1, d), _updateSigSelectBorderHtmlFun(i.drawCanvas, b), l = c.width, k = c.deviceRect
                }
            }, this.createPageInkSigns = function(a) {
                if (a) {
                    var b = a.getPDFPage(),
                        c = a.getScale();
                    b.enumInkSign(function(b) {
                        i.createSignByNoCert(a, b, c)
                    })
                }
            }, this.createSignByNoCert = function(a, b, c) {
                c = c ? c : 1;
                var d = _createSignByNoCertFun(a, b);
                i.drawInkSign(a, b, d, c)
            }, this.drawInkSign = function(a, b, c, d) {
                if (!a || !b || !c) return !1;
                var e = b.sigJSONData.inkData,
                    f = e.per;
                i.drawCanvas(c, e, d, f)
            }, this.deleteInkSign = function(a) {
                if (null == a) return !1;
                var b = a.getPageIndex(),
                    c = h.getMainView().getDocView(),
                    d = c.getPageView(b),
                    e = d.getPDFPage();
                e.deleteInkSigByName(a.getSigName()), c.setInkSigAddFlag(!1)
            }, this.cancelInkSign = function(a) {
                var b = h.getMainView().getDocView();
                b.setInkSigAddFlag(!1)
            }, this.onSigChangeRect = function(a, c, d, e, f, g, h) {
                var j, l = i.getsigVisibleOffset(a, c, d, e, f, g, !1),
                    m = $.extend(!0, {}, k),
                    o = a.getDocView().getRotate();
                if (m.left > m.right && (j = m.left, m.left = m.right, m.right = j), m.bottom < m.top && (j = m.bottom, m.bottom = m.top, m.top = j), 90 == o || 270 == o) {
                    var p = l.x;
                    l.x = l.y, l.y = p
                }
                l.x = l.y * n, i.calculateRectBydirec(a, m, h, l), i.updateInkSignParentPos(a, m, o), _updateSigSelectBorderHtmlFun(i.drawCanvas, b)
            }, this.updateInkSignParentPos = function(a, b, c) {
                var d = a.getPageViewWidth() - r,
                    e = a.getPageViewHeight() - r,
                    f = d;
                if ((270 == c || 90 == c) && (d = e, e = f), b.right > d) return !1;
                if (b.bottom > e) return !1;
                if (b.left < r) return !1;
                if (b.top < r) return !1;
                var g = b.right - b.left,
                    h = g / j,
                    n = _updateInkSignParentPosFun(b);
                if (n) {
                    var o = $.extend(!0, {}, m);
                    o = i.seiriCanvasDatas(o, h);
                    var p = a.getPDFPage(),
                        q = p.getInkSigByName(n.sigName);
                    q.setInkData(o);
                    var s = a.getDocView().getRotate();
                    pdfRect = a.deviceRectToPDF(b, !0, s), q.setRect(pdfRect), i.drawCanvas(n.canvas, o, 1, h), l = g, k = b
                }
            }, this.updatePageViewSigLayerPos = function(a, b, c, d) {
                var e = _updateCanvasDataFun(a, b, c, d);
                if (e) {
                    var f = a.getScale();
                    i.drawCanvas(e.canvas, e.canvasData, f, e.canvasData.per)
                }
            }, this.seiriCanvasDatas = function(a, b) {
                var c = $.extend(!0, {}, a),
                    d = c.rect;
                d[0] = d[0] * b, d[1] = d[1] * b, d[2] = d[2] * b, d[3] = d[3] * b, c.rect = d;
                for (var e = c.pencil, f = 0; f < e.length; f++) {
                    e[f].width = e[f].width * b;
                    for (var g = 0; g < e[f].points.length; g++) e[f].points[g][0] = e[f].points[g][0] * b, e[f].points[g][1] = e[f].points[g][1] * b
                }
                return c.per = b, c
            }, this.drawCanvas = function(a, b, c, d) {
                for (var e = a, f = e.getContext("2d"), g = b.rect[0], h = b.rect[1], i = b.pencil, j = 0; j < i.length; j++) {
                    f.strokeStyle = i[j].color, f.lineWidth = i[j].width * c, f.beginPath();
                    for (var k = i[j].points, l = 0; l < k.length; l++) 0 === l ? f.moveTo((k[l][0] - g) * c + d * o * c / 2, (k[l][1] - h) * c + d * o * c / 2) : f.lineTo((k[l][0] - g) * c + d * o * c / 2, (k[l][1] - h) * c + d * o * c / 2);
                    f.stroke()
                }
            }, this.calculateRectBydirec = function(a, b, c, d) {
                var e;
                switch (c) {
                    case 1:
                        e = b.top + d.y, b.top = e, b.left = b.left + d.x, b.bottom < b.top && (b.top = b.bottom), b.right < b.left && (b.left = b.right);
                        break;
                    case 2:
                        b.top = b.top + d.y, b.right = b.right - d.x, b.bottom < b.top && (b.top = b.bottom);
                        break;
                    case 3:
                        b.left = b.left - d.x, b.bottom = b.bottom + d.y, b.right < b.left && (b.left = b.right);
                        break;
                    case 4:
                        b.right = b.right + d.x, b.bottom = b.bottom + d.y, b.bottom < b.top && (b.bottom = b.top), b.right < b.left && (b.right = b.left)
                }
            }, this.getsigVisibleOffset = function(a, b, c, d, e, f, g) {
                var h = a.getPageViewHeight(),
                    i = a.getPageViewWidth(),
                    j = c - e,
                    k = d - f,
                    l = u(),
                    m = a.getDocView().getRotate();
                if (j > 0) {
                    var n = 0;
                    90 == m ? (j = -j, n = l.top - j, 0 > n && (j = -l.top)) : 180 == m ? (j = -j, n = l.left + j, 0 > n && (j = -l.left)) : 270 == m ? (n = l.bottom + j, n > i && (j = i - l.bottom)) : (n = l.right + j, n > i && (j = i - l.right))
                } else {
                    var o = 0;
                    90 == m ? (j = -j, o = l.bottom + j, o > i && (j = i - l.bottom)) : 180 == m ? (j = -j, o = l.right + j, o > i && (j = i - l.right)) : 270 == m ? (o = l.top + j, 0 > o && (j = -l.top)) : (o = l.left + j, 0 > o && (j = 0 - l.left))
                }
                if (k > 0) {
                    var p = 0;
                    90 == m ? (p = l.right + k, p > h && (k = h - l.right)) : 180 == m ? (k = -k, p = l.top + k, 0 > p && (k = -l.top)) : 270 == m ? (k = -k, p = l.left + k, 0 > p && (k = -l.left)) : (p = l.bottom + k, p > h && (k = h - l.bottom))
                } else {
                    var q = 0;
                    90 == m ? (q = l.left + k, 0 > q && (k = -l.left)) : 180 == m ? (k = -k, q = l.bottom + k, q > h && (k = h - l.bottom)) : 270 == m ? (k = -k, q = l.right + k, q > h && (k = h - l.right)) : (q = l.top + k, 0 > q && g && (k = 0 - l.top))
                }
                return {
                    x: j,
                    y: k
                }
            }, this.onSigSelectedMousemove = function(a, c, d, e, f, g) {
                var h = i.getsigVisibleOffset(a, c, d, e, f, g, !0);
                v(a, h.x, h.y, r), _updateSigSelectBorderHtmlFun(i.drawCanvas, b);
                var j = u();
                k = j
            }, this.isPageInkSignCreated = function(a) {
                return t[a]
            }
        }
        var e = (WebPDF.PDFRect, a("core/Plugins/InkSign/PDFInkSign")),
            f = null;
        b.createInkSignService = function(a) {
            return null == f ? f = new d(a) : f.init(), f
        }
    }), define("core/Plugins/PanAndZoom/panAndZoomPlugin", ["core/Plugins/PanAndZoom/panAndZoomView", "core/Plugins/PanAndZoom/panAndZoomMousePtHandler"], function(a, b, c) {
        var d = a("core/Plugins/PanAndZoom/panAndZoomView"),
            e = a("core/Plugins/PanAndZoom/panAndZoomMousePtHandler");
        WebPDF.PanAndZoomPluginName = "PanAndZoom Plugin", PanAndZoomPlugin = function(a) {
            var b = a,
                c = !1,
                f = !1;
            this.enable = function() {
                f = !0
            }, this.disable = function() {
                f = !1
            }, this.getName = function() {
                return WebPDF.PanAndZoomPluginName
            }, this.onRegister = function() {}, this.init = function() {
                $(b).on(WebPDF.EventList.DOCUMENT_LOADED, function(a, b) {
                    WebPDF.Tool.getReaderApp().isLargeFile() && $(".highZoom").addClass("PAZDisabled"), d.clearData()
                }).on(WebPDF.EventList.DOCVIEW_PAGE_CHANGED, function(a, e) {
                    if (b.getMainView() && c && f) {
                        d.adjustScreenSize(b);
                        var g = WebPDF.Tool.getReaderApp().getDocView(),
                            h = g.getCurPageIndex();
                        b.isAnnot() && d.annotLoaded(WebPDF.Tool.getReaderApp(), {
                            pageIndex: h
                        }), b.isForm() && d.loadControls(g.getPageView(h), h), d.setButtonStatus(h, g.getPageCount())
                    }
                }).on(WebPDF.EventList.DOCVIEW_ZOOM_CHANGED, function(a, e) {
                    b.getMainView() && c && f && d.zoom(b)
                }).on(WebPDF.EventList.DOCVIEW_SCROLL, function(a, e) {
                    b.getMainView() && c && f && d.adjustVisivleRect(b)
                }).on(WebPDF.EventList.DOCVIEW_RESIZE, function(a, e) {
                    b.getMainView() && c && f && d.adjustVisivleRect(b)
                }).on(WebPDF.EventList.DOCVIEW_ROTATE_CHANGED, function(a, e) {
                    b.getMainView() && c && f && (d.adjustScreenSize(b), d.adjustAnnotsMatrix(b.getDocView().getRotate()))
                }).on(WebPDF.EventList.LAYOUTSHOWMODE_CHANGED, function(a, e) {
                    b.getMainView() && c && f && d.adjustScreenSize(b)
                }).on(WebPDF.EventList.ANNOT_DELETED, function(a, e) {
                    b.getMainView() && c && d.updateAnnot(b, e.annotName, e.pageIndex, !0)
                }).on(WebPDF.EventList.ANNOT_ADDED, function(a, e) {
                    if (b.getMainView() && c && e.annot) {
                        var f;
                        e.annotObject && "Squiggly" === e.annotObject.getSubType() && (f = 1), d.updateAnnot(b, e.annot.annotName, e.pageIndex, !1, f)
                    }
                }).on(WebPDF.EventList.ANNOT_ADDED_NOFilter, function(a, e) {
                    b.getMainView() && c && e.annot && d.updateAnnot(b, e.annot.annotName, e.pageIndex, !1)
                }).on(WebPDF.EventList.ANNOT_UPDATED, function(a, e) {
                    b.getMainView() && c && d.updateAnnot(b, e.annot.annotName, e.pageIndex, !1)
                }).on(WebPDF.EventList.ANNOTS_LOADED_SUCCESS, function(a, e) {
                    b.getMainView() && c && d.annotLoaded(b, e)
                })
            }, this.unload = function() {}, this.showDlg = function() {
                d.showDlg(), c = !0, _inkSignTool = new e(this, d), b.registerToolHandler(_inkSignTool), WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_PanAndZoom)
            }
        }, b.createPlugin = function(a) {
            return WebPDF.PanAndZoomPlugin || (WebPDF.PanAndZoomPlugin = new PanAndZoomPlugin(a)), WebPDF.PanAndZoomPlugin
        }
    }), define("core/Plugins/PanAndZoom/panAndZoomView", [], function(a, b, c) {
        function d(a, b, c) {
            if (1 > c) return void console.log("page background image couldn't be retrieved.!");
            var e = a.getBaseUrl() + "asserts/" + a.getFileID() + "/image/" + b + "/100?formMode=false&accessToken=accessToken",
                f = new XMLHttpRequest;
            f.open("GET", e), f.responseType = "arraybuffer", f.send(), f.onload = function(e) {
                if (4 === f.readyState)
                    if (f.response.byteLength > 23) {
                        var g = new Blob([f.response], {
                            type: "image/png"
                        });
                        $(".fwr-PAZ-img").attr("src", URL.createObjectURL(g))
                    } else p === b && setTimeout(function() {
                        d(a, b, c - 1)
                    }, 800 * (26 - c))
            }
        }

        function e(a, b) {
            var c = 500;
            a > b && (c = 350);
            var d = c,
                e = b * c / a;
            return $(".fwr-PAZ-body").height() - e < 20 && (e = $(".fwr-PAZ-body").height() - 20, d = a * e / b), $(".fwr-PAZ-body").width() - d < 20 && (d = $(".fwr-PAZ-body").width() - 20, e = b * d / a), j = d / a, [d, e]
        }

        function f(a) {
            var b = a.getDocView(),
                c = b.getPageView(q),
                d = r.left * c.getPageViewWidth(),
                e = r.top * c.getPageViewHeight(),
                f = b.getScrollApi(),
                g = $("#docViewer_ViewContainer").width() - f.getScrollBarWidth(),
                h = $("#docViewer_ViewContainer").height() - f.getScrollBarHeight(),
                i = d + s.x * g,
                j = e + s.y * h;
            return 0 > i && (i = 0), 0 > j && (j = 0), c.getPageViewHeight() < h && (j = 0), void b.gotoPage(q, i, j)
        }

        function g(a, b, c, d, e, f) {
            for (var g in b) {
                var h = b[g];
                if (null != h && !("Markup" != h.getType() && h.getType() != WebPDF.Annot.AnnotType.Callout || "Ink" != h.getSubType() && h.getSubType() != WebPDF.Annot.AnnotType.Circle && h.getSubType() != WebPDF.Annot.AnnotType.Polygon && h.getSubType() != WebPDF.Annot.AnnotType.PolyLine && h.getSubType() != WebPDF.Annot.AnnotType.Square && h.getSubType() != WebPDF.Annot.AnnotType.Line && h.getType() != WebPDF.Annot.AnnotType.Callout && h.getSubType() != WebPDF.Tools.TOOL_NAME_COMMENT_SQUIGGLY && h.getSubType() != WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET)) {
                    c.getAnnotCavansDivID(a, h.getAnnotName());
                    d.each(function() {
                        var b = document.getElementById($(this).attr("pazTarget")),
                            d = "";
                        b ? (d = this.outerHTML, f ? d = d.replace("<canvas", "<img src=" + b.toDataURL()).replace("</canvas>", "</img>") : (c.showAInkAnnot(a, h, !1, this, e), d = d.replace("<canvas", "<img src=" + b.toDataURL()).replace("</canvas>", "</img>"))) : $(this).parent().remove(), $(this).parent().append(d)
                    })
                }
            }
        }

        function h(a, b, c, d) {
            $(".fwr-PAZ-anchor.leftTop").css({
                left: a - 2,
                top: b - 2
            }), $(".fwr-PAZ-anchor.rightTop").css({
                left: c,
                top: b - 2
            }), $(".fwr-PAZ-anchor.leftBottom").css({
                left: a - 2,
                top: d
            }), $(".fwr-PAZ-anchor.rightBottom").css({
                left: c,
                top: d
            })
        }

        function i() {
            WebPDF.Tool.getReaderApp().isLargeFile() && $(".highZoom").addClass("PAZDisabled"), $("#PAZBorderColor").spectrum({
                color: "red",
                preferredFormat: "hex"
            }), $("#PAZBorderColor").off("change").on("change", function(a) {
                var b = $(this).val();
                n = b, $(".fwr-PAZ-border").css("border-color", b), $("[class*=fwr-PAZ-anchor]").css("border-color", b)
            }), $(".tooltip li a,.tooltip li div").off("mouseover").on("mouseover", function() {
                return $(this).siblings("span").css({
                    left: $(this).css("left")
                }).show(), !1
            }).off("mouseleave").on("mouseleave", function() {
                return $(this).siblings("span").css({
                    left: $(this).css("left")
                }).hide(), !1
            }), $(".fwr-PAZ-foot .fwr-select-zoom").off("mouseleave").on("mouseleave", function() {
                return $("#PAZZoomBox").hide(), !1
            }).off("mouseover").on("mouseover", function() {
                return $("#PAZZoomBox").show(), !1
            }), $("#PAZZoomBox").off("mouseleave").on("mouseleave", function() {
                return $("#PAZZoomBox").hide(), !1
            }), $("#PAZZoomOptions li").off("click").on("click", function(a) {
                if (!$(this).hasClass("PAZDisabled")) {
                    $("#PAZZoomBox").hide();
                    var b = $(this).text(),
                        c = parseFloat(b);
                    c ? (c /= 100, WebPDF.ViewerInstance.zoomTo(c)) : b === i18n.t("ZoomLevel.FitWidth") ? WebPDF.ViewerInstance.zoomTo(WebPDF.ZOOM_FIT_WIDTH) : b === i18n.t("ZoomLevel.FitPage") ? WebPDF.ViewerInstance.zoomTo(WebPDF.ZOOM_FIT_PAGE) : WebPDF.ViewerInstance.zoomTo(b)
                }
            }), $(".fwr-select-zoom-out.fwr-PAZ").off("click").on("click", function(a) {
                var b = WebPDF.Tool.getReaderApp().getDocView();
                b.zoomOut()
            }), $(".fwr-select-zoom-in.fwr-PAZ").off("click").on("click", function(a) {
                var b = WebPDF.Tool.getReaderApp().getDocView();
                b.zoomIn()
            }), $(".fwr-PAZ-target").off("click").on("click", function(a) {
                var b = WebPDF.Tool.getReaderApp().getDocView();
                b.getPageView(b.getCurPageIndex());
                switch (a.target.classList[1]) {
                    case "first":
                        b.gotoPage(0);
                        break;
                    case "preview":
                        b.gotoPrevPage();
                        break;
                    case "next":
                        b.gotoNextPage();
                        break;
                    case "last":
                        b.gotoPage(b.getPageCount() - 1)
                }
            }), $("a.fwr-PAZ-header").off("click").on("click", function(a) {
                WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND)
            }), $(".fwr-PAZ-dialog").off("resize").on("resize", function() {
                k.adjustScreenSize(WebPDF.Tool.getReaderApp(), !0), k.adjustAnnotsMatrix(WebPDF.Tool.getReaderApp().getDocView().getRotate()), $(".fwr-select-PAZpage.tooltip").css("left", ($("#PAZBorderColor+div").position().left - 246) / 2 + 110)
            }), $(".fwr-PAZ-dialog").resizable({
                handles: "n, e, s, w, ne, se, sw, nw ",
                autoHide: !0,
                minHeight: 300,
                maxHeight: 650,
                minWidth: 280,
                maxWidth: 500
            })
        }
        var j, k = function() {},
            l = !0,
            m = !1,
            n = "#FF0000";
        k.showDlg = function() {
            if ($(".fwr-PAZ-dialog").length < 1) {
                for (var a = '<div class="fwr-modal fwr-PAZ-dialog" >   <div class="fwr-modal-header fwr-PAZ-header">       <a class="close fwr-PAZ-header" webpdf-data-dismiss="modal"></a>       <h4 class="fwr-PAZ-header">' + i18n.t("panAndZoom.title") + '</h4>   </div>    <div class="fwr-PAZ-body">       <div class="fwr-PAZ-pageContainer">           <img class="fwr-PAZ-img" src="" style="background-color: white;"/>           <div class="fwr-PAZ-border">           </div>               <div class="fwr-PAZ-anchor leftTop"></div>               <div class="fwr-PAZ-anchor rightTop"></div>               <div class="fwr-PAZ-anchor leftBottom"></div>               <div class="fwr-PAZ-anchor rightBottom"></div>           <div class="fwr-PAZ-annot"/>           <div class="fwr-PAZ-formControls"/>       </div>   </div>   <div class="fwr-PAZ-foot">       <ul class="fwr-select-zoom tooltip" style="margin-left:5px;">           <li class="fwr-select-zoom-out">               <a class="fwr-select-zoom-out fwr-select-zoom-icons fwr-PAZ"></a>               <span class="fwr-toolbar-tip">                   <div>' + i18n.t("CommandUI.ZoomOut") + '</div>               </span>           </li>           <li class="fwr-select-zoom-in" style="float: right;">               <a class="fwr-select-zoom-in fwr-select-zoom-icons fwr-PAZ"></a>               <span class="fwr-toolbar-tip disabled" style="display: none;">                   <div>' + i18n.t("CommandUI.ZoomIn") + '</div>               </span>           </li>           <div class="fwr-select-box">               <input type="text" id="PAZScaleInput" readonly="readonly" name="select_showbox" style="cursor:pointer" class="fwr-select-showbox" value="100%">               <div id="PAZZoomBox" class="fwr-select-optionbox" style="display: none;">                   <ul id="PAZZoomOptions" class="fwr-select-option">{zoomList}                   </ul>               </div>           </div>       </ul>       <ul class="fwr-select-PAZpage tooltip">           <li class="">               <div class="fwr-PAZ-target first"></div>               <span class="fwr-toolbar-tip" style="display: none;">                   <div>' + i18n.t("CommandUI.GoFirstPage") + '</div>               </span>           </li>           <li class="">               <div class="fwr-PAZ-target preview"></div>               <span class="fwr-toolbar-tip " style="display: none;">                   <div>' + i18n.t("CommandUI.GoPrevPage") + '</div>               </span>           </li>           <li class="">               <div class="fwr-PAZ-target next"></div>               <span class="fwr-toolbar-tip" style="display: none;">                   <div>' + i18n.t("CommandUI.GoNextPage") + '</div>               </span>           </li>           <li class="">               <div class="fwr-PAZ-target last"></div>               <span class="fwr-toolbar-tip" style="display: none;">                   <div>' + i18n.t("CommandUI.GoLastPage") + '</div>               </span>           </li>       </ul>       <div>           <input id="PAZBorderColor" />       </div>   </div></div', b = "", c = WebPDF.ViewerInstance.getZoomLevels(), d = 0; d < c.length; d++) {
                    var e = 100 * c[d];
                    if (!isNaN(e)) {
                        var f = e > 200 ? "highZoom" : "";
                        b += '<li class="fwr-select-option-li ' + f + '">' + e + "%</li>"
                    }
                }
                b += '<li class="fwr-select-option-li">' + i18n.t("ZoomLevel.FitPage") + '</li><li class="fwr-select-option-li">' + i18n.t("ZoomLevel.FitWidth") + "</li>", $("#docViewer").append(a.replace(/\{zoomList\}/, b)), i()
            } else $(".fwr-PAZ-dialog").show(), $("#PAZBorderColor").spectrum({
                color: n,
                preferredFormat: "hex"
            }), $(".fwr-PAZ-border").css("border-color", n), $("[class*=fwr-PAZ-anchor]").css("border-color", n);
            var g = WebPDF.Tool.getReaderApp().getDocView(),
                h = g.getCurPageIndex();
            $("#PAZScaleInput").val($("#zoomSelectInput").val()), k.adjustScreenSize(WebPDF.Tool.getReaderApp()), k.adjustAnnotsMatrix(WebPDF.Tool.getReaderApp().getDocView().getRotate()), k.setButtonStatus(h, g.getPageCount()), WebPDF.Tool.getReaderApp().isAnnot() && k.annotLoaded(WebPDF.Tool.getReaderApp(), {
                pageIndex: h
            }), WebPDF.Tool.getReaderApp().isForm() && k.loadControls(g.getPageView(h), h)
        };
        var o, p;
        k.adjustScreenSize = function(a, b) {
            var c = a.getDocView(),
                f = c.getDocViewClientRect(),
                g = (f.right - f.left, f.top - f.bottom, c.getCurPageIndex()),
                h = c.getPageView(g),
                i = h.getPageViewWidth(),
                j = h.getPageViewHeight(),
                l = e(i, j),
                m = l[0],
                n = l[1],
                q = ($(".fwr-PAZ-body").width() - m) / 2,
                r = ($(".fwr-PAZ-body").height() - n) / 2;
            $(".fwr-PAZ-pageContainer").css({
                width: m + 4,
                height: n + 4,
                left: q - 2,
                top: r - 2
            }), b || (o && (clearTimeout(o), o = null), o = setTimeout(function() {
                p = g, d(a, g, 25), o = null
            }, 300));
            var s = (c.getRotate() + 360) % 360;
            switch ($(".fwr-PAZ-img").css("transform", "rotate(" + s + "deg)"), s) {
                case 90:
                    $(".fwr-PAZ-img").css({
                        width: n,
                        height: m,
                        left: m + 2,
                        top: 2
                    });
                    break;
                case 180:
                    $(".fwr-PAZ-img").css({
                        width: m,
                        height: n,
                        left: m + 2,
                        top: n + 2
                    });
                    break;
                case 270:
                    $(".fwr-PAZ-img").css({
                        width: n,
                        height: m,
                        left: 2,
                        top: n + 2
                    });
                    break;
                default:
                    $(".fwr-PAZ-img").css({
                        left: 2,
                        top: 2,
                        width: m,
                        height: n
                    })
            }
            k.adjustVisivleRect(a)
        }, k.adjustVisivleRect = function(a) {
            var b = a.getDocView(),
                c = b.getPageView(b.getCurPageIndex()),
                d = c.getPageViewWidth(),
                f = c.getPageViewHeight();
            e(d, f);
            var g = b.getScrollApi(),
                i = new WebPDF.PDFRect,
                k = $("#docViewer_ViewContainer").position();
            i.right = k.left + $("#docViewer_ViewContainer").width() - g.getScrollBarWidth(), i.bottom = k.top + $("#docViewer_ViewContainer").height() - g.getScrollBarHeight(), i.left = k.left, i.top = k.top;
            var m = new WebPDF.PDFRect,
                n = c.getPageViewHtmlOffset();
            m.left = n.left, m.top = n.top, m.right = m.left + d, m.bottom = m.top + f, WebPDF.RectUtils.intersectInUserSpace(i, m);
            var o = 0,
                p = 0,
                q = 0,
                r = 0;
            l ? (o = (i.left - n.left) * j, p = (i.top - n.top) * j, q = (i.right - i.left) * j, r = (i.bottom - i.top) * j, $(".fwr-PAZ-border").css({
                width: q,
                height: r,
                left: o,
                top: p
            })) : (o = parseFloat($(".fwr-PAZ-border").css("left")), p = parseFloat($(".fwr-PAZ-border").css("top")), q = parseFloat($(".fwr-PAZ-border").css("width")), r = parseFloat($(".fwr-PAZ-border").css("height"))), h(o, p, o + q, p + r)
        }, k.adjustAnnotsMatrix = function(a) {
            var b = new WebPDF.PDFMatrix,
                c = (360 - a) * Math.PI / 180;
            b.a = Math.cos(c), b.b = -Math.sin(c), b.c = Math.sin(c), b.d = Math.cos(c);
            var d = new WebPDF.PDFMatrix,
                e = WebPDF.Tool.getReaderApp().getDocView(),
                f = e.getPageView(e.getCurPageIndex());
            switch (d.a = d.d = $(".fwr-PAZ-img").width() / (4 * f.getPDFPageWidth() / 3), b = WebPDF.PDFMatrix.Concat2mt(d, b), a) {
                case 270:
                    b.f = $(".fwr-PAZ-img").width();
                    break;
                case 180:
                    b.e = $(".fwr-PAZ-img").width(), b.f = $(".fwr-PAZ-img").height();
                    break;
                case 90:
                    b.e = $(".fwr-PAZ-img").height();
                    break;
                case 0:
            }
            $(".fwr-PAZ-annot").css("transform", "matrix(" + b.a + "," + b.b + "," + b.c + "," + b.d + "," + b.e + "," + b.f + ")"), $(".fwr-PAZ-formControls").css("transform", "matrix(" + b.a + "," + b.b + "," + b.c + "," + b.d + "," + b.e + "," + b.f + ")")
        }, k.setButtonStatus = function(a, b) {
            0 === a ? ($(".fwr-PAZ-target.first").addClass("PAZDisabled"), $(".fwr-PAZ-target.preview").addClass("PAZDisabled"), $(".fwr-PAZ-target.next").removeClass("PAZDisabled"), $(".fwr-PAZ-target.last").removeClass("PAZDisabled")) : a === b - 1 ? ($(".fwr-PAZ-target.first").removeClass("PAZDisabled"), $(".fwr-PAZ-target.preview").removeClass("PAZDisabled"), $(".fwr-PAZ-target.next").addClass("PAZDisabled"), $(".fwr-PAZ-target.last").addClass("PAZDisabled")) : $(".fwr-PAZ-target").removeClass("PAZDisabled"), q = a
        }, k.clearData = function() {
            r = {}, s = {
                x: 0,
                y: 0
            }, t = -1, u = {}, q = -1
        };
        var q, r = {},
            s = {
                x: 0,
                y: 0
            };
        k.zoom = function(a) {
            $("#PAZScaleInput").val($("#zoomSelectInput").val()), k.adjustVisivleRect(a), m && f(a);
            var b = WebPDF.ViewerInstance.getZoomLevels();
            b[0] === a.getDocView().getScale() ? ($(".fwr-select-zoom-in").removeClass("PAZDisabled"), $(".fwr-select-zoom-out").addClass("PAZDisabled")) : b[b.length - 1] === a.getDocView().getScale() ? ($(".fwr-select-zoom-in").addClass("PAZDisabled"), $(".fwr-select-zoom-out").removeClass("PAZDisabled")) : ($(".fwr-select-zoom-in").removeClass("PAZDisabled"), $(".fwr-select-zoom-out").removeClass("PAZDisabled"))
        }, k.zoomInToolMove = function(a, b, c) {
            var d = WebPDF.Tool.getReaderApp().getDocView(),
                e = d.getCurPageIndex(),
                f = d.getPageView(e),
                g = d.getScale();
            if (isNaN(g)) {
                var h = f.getPageViewHeight();
                g = d.getRotate() % 180 === 0 ? h / f.getPDFPageHeight() : h / f.getPDFPageWidth()
            }
            var i = !1;
            switch (a.classList[1]) {
                case "leftTop":
                    b > 0 && (i = !0);
                    break;
                case "rightTop":
                    0 > b && (i = !0);
                    break;
                case "leftBottom":
                    b > 0 && (i = !0);
                    break;
                case "rightBottom":
                    0 > b && (i = !0)
            }
            i ? d.zoomIn() : d.zoomOut()
        }, k.zoomInToolStart = function(a) {
            m = !0;
            var b = $(".fwr-PAZ-border").width() - 4,
                c = $(".fwr-PAZ-border").height() - 4,
                d = $(".fwr-PAZ-img").width(),
                e = $(".fwr-PAZ-img").height();
            switch (r = $(".fwr-PAZ-border").position(), a.classList[1]) {
                case "leftTop":
                    r.left = (r.left + b) / d, r.top = (r.top + c) / e, s.x = -1, s.y = -1, $(".fwr-PAZ-border,.fwr-PAZ-body").css("cursor", "nw-resize");
                    break;
                case "rightTop":
                    r.left = r.left / d, r.top = (r.top + c) / e, s.x = 0, s.y = -1, $(".fwr-PAZ-border,.fwr-PAZ-body").css("cursor", "ne-resize");
                    break;
                case "leftBottom":
                    r.left = (r.left + b) / d, r.top = r.top / e, s.x = -1, s.y = 0, $(".fwr-PAZ-border,.fwr-PAZ-body").css("cursor", "sw-resize");
                    break;
                case "rightBottom":
                    s.x = 0, s.y = 0, r.left = r.left / d, r.top = r.top / e, $(".fwr-PAZ-border,.fwr-PAZ-body").css("cursor", "se-resize")
            }
        }, k.zoomInToolEnd = function() {
            $(".fwr-PAZ-body").css("cursor", "initial"), $(".fwr-PAZ-border").css("cursor", "url(../../../images/reader/cursor/hand.cur),auto"), m = !1
        }, k.moveInToolStart = function() {
            $(".fwr-PAZ-border").css("cursor", "url(../../../images/reader/cursor/catch.cur),auto")
        }, k.moveInToolMove = function(a, b, c) {
            var d = $(".fwr-PAZ-border").position(),
                e = $(".fwr-PAZ-border").width(),
                f = $(".fwr-PAZ-border").height(),
                g = $(".fwr-PAZ-img").width(),
                h = $(".fwr-PAZ-img").height(),
                i = WebPDF.Tool.getReaderApp(),
                j = i.getDocView(),
                k = j.getRotate();
            if (k % 180 !== 0) {
                var l = g;
                g = h, h = l
            }
            d.left + b <= 0 && (b = -d.left), d.left + b + e >= g && (b = g - d.left - e);
            var m = 0,
                n = j.getScale();
            if (isNaN(n)) {
                var o = j.getPageView(0),
                    p = o.getPageViewHeight();
                n = j.getRotate() % 180 === 0 ? p / o.getPDFPageHeight() : p / o.getPDFPageWidth()
            }
            2 === i.getDocView().getPdfViewerShowMode() && (m = 1 > 1 * n ? 1 : 1 * n), d.top + c <= m && (c = m - d.top), d.top + c + f >= h - m && (c = h - d.top - f - m);
            var o = j.getPageView(j.getCurPageIndex());
            b = b * o.getPageViewWidth() / g, c = c * o.getPageViewHeight() / h;
            var q = j.getScrollApi(),
                r = 5 > 5 * n ? 5 : 5 * n;
            (Math.abs(b) > r || Math.abs(c) > r) && q.scrollBy(b, c)
        }, k.moveInToolEnd = function() {
            $(".fwr-PAZ-border").css("cursor", "url(../../../images/reader/cursor/hand.cur),auto")
        };
        var t = -1,
            u = {};
        return k.annotLoaded = function(a, b) {
            if (!($(".fwr-PAZ-dialog").length < 1 || t == b.pageIndex)) {
                var c = a.getDocView(),
                    d = c.getCurPageIndex();
                if (b.pageIndex === d) {
                    if ($(".fwr-PAZ-annot").empty(), !(d in u)) {
                        var e = c.getPageView(d),
                            f = c.getRotate() % 180 === 0 ? e.getPageViewWidth() : e.getPageViewHeight(),
                            h = f / (4 * e.getPDFPageWidth() / 3),
                            i = a.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                            j = i.getUIManager(),
                            k = j.createAnnotsHtmlContent(e, 1 / h, !0, !0);
                        k = k.replace(/id=([\s\S]+?')/g, "pazTarget=$1");
                        var l = $(k),
                            m = e.getPDFPage().getAnnotsMap(),
                            n = l.find(".vml"),
                            o = i.isPageAnnotCreated(e.getPageIndex());
                        g(e, m, i, n, h, o), u[d] = l.html()
                    }
                    $(".fwr-PAZ-annot").append(u[d]), t = d
                }
            }
        }, k.updateAnnot = function(a, b, c, d) {
            if (!($(".fwr-PAZ-dialog").length < 1)) {
                var e = a.getDocView(),
                    f = e.getCurPageIndex();
                if (c === f && f in u) {
                    for (; $(".fwr-PAZ-annot [pazTarget*=" + b + "]").length > 0;) $(".fwr-PAZ-annot [pazTarget*=" + b + "]").remove(), $(u[f]).remove("[pazTarget*=" + b + "]");
                    if (d) return;
                    var h = e.getPageView(f),
                        i = e.getRotate() % 180 === 0 ? h.getPageViewWidth() : h.getPageViewHeight(),
                        j = i / (4 * h.getPDFPageWidth() / 3),
                        k = h.getPDFPage().getAnnotByName(b),
                        l = a.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(),
                        m = l.getUIManager(),
                        n = m.createAAnnotHtmlContent(h, k, b, 1 / j, null, !0, null, !0);
                    n = n.replace(" = ", "=").replace(/id=([\s\S]+?'|")/g, "pazTarget=$1");
                    var o = $("<div>" + n + "</div>"),
                        p = h.getPDFPage().getAnnotsMap(),
                        q = o.find(".vml"),
                        r = l.isPageAnnotCreated(h.getPageIndex());
                    g(h, p, l, q, j, r), $(u[f]).append(o.html()), $(".fwr-PAZ-annot").append(o.html())
                }
            }
        }, k.loadControls = function(a, b) {
            var c = WebPDF.FormPlugin.getUIManager(),
                d = WebPDF.FormPlugin.getFormService(),
                e = d.getPageControls(b);
            if (e) {
                var f = [],
                    g = c.getControlsHTML(a, e, e.bgUrl, f, {
                        scale: 1
                    });
                g = g.replace(/id=[\s\S]*? /g, ""), $(".fwr-PAZ-formControls").empty().append(g)
            }
        }, k
    }), define("core/Plugins/PanAndZoom/panAndZoomMousePtHandler", [], function(a, b, c) {
        WebPDF.Tools.TOOL_NAME_PanAndZoom = "PanAndZoom Tool";
        WebPDF.PDFPoint, WebPDF.PDFRect;
        return WebPDF.Tools.PanAndZoomToolHandler = function(a, b) {
            _plugin = a, _view = b;
            var c, d = !1,
                e = {},
                f = !1,
                g = {},
                h = !1;
            this.onInit = function(a) {
                _readerApp = a
            }, this.isEnabled = function() {
                return !0
            }, this.onDestroy = function() {}, this.getName = function() {
                return WebPDF.Tools.TOOL_NAME_PanAndZoom
            }, this.onActivate = function() {
                $("#btnPanAndZoomTool").addClass("selected"), a.enable()
            }, this.onDeactivate = function() {
                a.disable(), $("a.sp-cancel").click(), $(".fwr-PAZ-dialog").hide(), $("#btnPanAndZoomTool").removeClass("selected")
            }, this.isProcessing = function() {
                return !0
            }, this.onLButtonUp = function(a) {
                if (d) {
                    d = !1;
                    var b = a.pageX - e.x,
                        i = a.pageY - e.y;
                    if (c && (Math.abs(b) > 15 || Math.abs(b) > 15)) {
                        e.x = a.pageX, e.y = a.pageY;
                        _view.zoomInToolMove(c, b, i)
                    }
                    return _view.zoomInToolEnd(), c = null, !1
                }
                if (f) {
                    f = !1;
                    var b = a.pageX - g.x,
                        i = a.pageY - g.y;
                    if (c) {
                        g.x = a.pageX, g.y = a.pageY;
                        _view.moveInToolMove(c, b, i)
                    }
                    return _view.moveInToolEnd(), c = null, !1
                }
                if (h) {
                    h = !1;
                    var b = a.pageX - g.x,
                        i = a.pageY - g.y;
                    if (c) {
                        g.x = a.pageX, g.y = a.pageY;
                        var j = $(".fwr-PAZ-dialog").offset();
                        j.left += b, j.top += i, $(".fwr-PAZ-dialog").offset(j)
                    }
                }
            }, this.onLButtonDown = function(a) {
                return $(a.target).hasClass("fwr-PAZ-anchor") ? (d = !0, e.x = a.pageX, e.y = a.pageY, c = a.target, _view.zoomInToolStart(c), !1) : $(a.target).hasClass("fwr-PAZ-border") ? (f = !0, g.x = a.pageX, g.y = a.pageY, c = a.target, _view.moveInToolStart(c), !1) : $(a.target).hasClass("fwr-PAZ-header") ? (h = !0, g.x = a.pageX, g.y = a.pageY, c = a.target, !0) : void 0
            }, this.onMouseMove = function(a) {
                if (d) {
                    var b = a.pageX - e.x,
                        i = a.pageY - e.y;
                    if (c && (Math.abs(b) > 15 || Math.abs(b) > 15)) {
                        e.x = a.pageX, e.y = a.pageY;
                        _view.zoomInToolMove(c, b, i)
                    }
                } else if (f) {
                    var b = a.pageX - g.x,
                        i = a.pageY - g.y;
                    if (c) {
                        g.x = a.pageX, g.y = a.pageY;
                        _view.moveInToolMove(c, b, i)
                    }
                } else if (h) {
                    var b = a.pageX - g.x,
                        i = a.pageY - g.y;
                    if (c) {
                        g.x = a.pageX, g.y = a.pageY;
                        var j = $(".fwr-PAZ-dialog").offset();
                        j.left += b, j.top += i, $(".fwr-PAZ-dialog").offset(j)
                    }
                    return !0
                }
                return !1
            }, this.onLButtonDblClk = function(a) {
                return !1
            }, this.onRButtonDown = function(a) {
                return !1
            }, this.onRButtonUp = function(a) {
                return !1
            }, this.onRButtonDblClk = function(a) {
                return !1
            }, this.onMouseWheel = function(a) {
                return !1
            }, this.onMouseOver = function(a) {
                return !1
            }, this.onMouseOut = function(a) {
                return !1
            }, this.onMouseEnter = function(a) {
                return !1
            }, this.onMouseLeave = function(a) {
                return !1
            }, this.onKeyDown = function(a) {
                return !1
            }, this.onKeyUp = function(a) {
                return !1
            }, this.onChar = function(a) {
                return !1
            }
        }, WebPDF.Tools.PanAndZoomToolHandler
    }), define("core/Plugins/Snapshot/SnapshotPlugin", ["core/WebPDF", "core/Plugins/Snapshot/SnapshotToolHandler", "core/Common/Common", "core/Interface/IReaderToolHandler", "core/Tools/Tools", "core/Interface/IReaderPlugin"], function(a, b, c) {
        function d(a) {
            h.call(this), this.getName = function() {
                return f
            }, this.init = function() {
                var b = new g(a);
                a.registerToolHandler(b)
            }
        }
        var e = a("core/WebPDF"),
            f = e.SNAPSHOT_PLUGIN_NAME = "SnapshotPlugin",
            g = a("core/Plugins/Snapshot/SnapshotToolHandler");
        a("core/Interface/IReaderPlugin");
        var h = e.IReaderPlugin;
        ! function() {
            var a = function() {};
            a.prototype = h.prototype, d.prototype = new a
        }(), e.SnapshotPlugin = d, b.createPlugin = function(a) {
            return new d(a)
        }
    }), define("core/Plugins/Snapshot/SnapshotToolHandler", ["core/Common/Common", "core/WebPDF", "core/Interface/IReaderToolHandler", "core/Tools/Tools"], function(a, b, c) {
        function d(a) {
            function b() {
                var a = E[0] - D[0],
                    b = E[1] - D[1];
                C.css({
                    width: Math.abs(a),
                    height: Math.abs(b),
                    left: Math.min(D[0], E[0]),
                    top: Math.min(D[1], E[1])
                })
            }

            function c() {
                for (var a, b, c = Math.min(D[0], E[0]), d = Math.min(D[1], E[1]), e = Math.max(D[0], E[0]), f = Math.max(D[1], E[1]), g = !1, h = !1, i = A.getVisiblePageRange(), j = A.getRotate() % 180, k = i.begin, l = i.end; l >= k; k++) {
                    var m = A.getPageView(k),
                        n = m.getPageViewContainerID(),
                        o = $("#" + n),
                        p = o.offset();
                    if (a = o.width(), b = o.height(), j) {
                        var q = a;
                        a = b, b = q
                    }
                    var r = p.left,
                        s = p.top,
                        t = r + a,
                        u = s + b;
                    if (t >= c && u >= d && e >= r && f >= s) {
                        c = Math.max(c, r), d = Math.max(d, s), e = Math.min(e, t), f = Math.min(f, u), g = !0;
                        break
                    }
                }
                a = e - c, b = f - d;
                var v = {
                    width: a,
                    height: b,
                    left: c,
                    top: d
                };
                g && a && b ? h = !0 : x(), C.css(v);
                var w = v;
                return w.readySnapshot = h, w
            }

            function d(a, b, c, d) {
                C.addClass("doing");
                for (var e, f = A.getVisiblePageRange(), h = f.begin; h <= f.end; h++) {
                    var i = A.getPageView(h),
                        j = i.getPageViewRect();
                    if (j.left <= a && j.bottom <= b && j.top >= b - d && j.right >= a + c) {
                        e = h;
                        break
                    }
                }
                if ("number" == typeof e) {
                    var k = A.getPageView(e),
                        l = $("#" + k.getPageViewContainerID()),
                        m = l.offset();
                    g(l).then(function(e) {
                        return q(e, m, a, b, c, d)
                    }).then(function(a) {
                        return r(a)
                    }).then(function(a) {
                        G = a, C.addClass("success").removeClass("doing")
                    })
                }
            }

            function g(a) {
                var b = a.find("canvas");
                return h(b), window.html2canvas(a.get(0), {
                    logging: !1
                }).then(function(a) {
                    return $(".fwr-typewriter-annot-nor-temp-snapshot").remove(), $(".temp-snapshot-hidden").removeClass("temp-snapshot-hidden"), a
                })
            }

            function h(a) {
                a.each(function(a, b) {
                    var c = $(b),
                        d = b.toDataURL(),
                        e = $("<img>");
                    e.attr("src", d).addClass("fwr-annot-canvas-snapshot"), e.get(0).setAttribute("style", b.getAttribute("style")), c.addClass("temp-snapshot-hidden").after(e)
                })
            }

            function q(a, b, c, d, e, f) {
                c -= b.left, d -= b.top;
                var g = $('<canvas width="' + e + '" height="' + f + '"></canvas>')[0];
                return g.getContext("2d").drawImage(a, c, d, e, f, 0, 0, e, f), g.toDataURL("image/png")
            }

            function r(a) {
                return s(a)
            }

            function s(a) {
                return u(a).then(function(a) {
                    return new Promise(function(b, c) {
                        var d = document.createElement("img");
                        d.onload = function() {
                            b(this)
                        }, d.src = a, F.html(d)
                    })
                })
            }

            function t(a) {
                for (var b = a.split(","), c = b[0].match(/:(.*?);/)[1], d = atob(b[1]), e = d.length, f = new Uint8Array(e); e--;) f[e] = d.charCodeAt(e);
                return new Blob([f], {
                    type: c
                })
            }

            function u(a) {
                var b = t(a),
                    c = new FormData;
                return c.append("file", b), new Promise(function(a, b) {
                    $.ajax({
                        url: WebPDF.serverBaseUrl + "api/v2/doc/upload/tempfile",
                        method: "POST",
                        data: c,
                        contentType: !1,
                        processData: !1,
                        success: function(c) {
                            return "0" === c.resultCode ? a(WebPDF.serverBaseUrl + "api/v2/doc/" + c.resultBody.docid + "/download/tempfile") : void b()
                        },
                        error: function() {
                            b()
                        }
                    })
                })
            }

            function v() {
                if (C) return C.find(".fwr-snapshot-tool-div-control-download").removeAttr("href"), C;
                var a = [];
                return a.push('<div class="fwr-snapshot-tool-div">'), a.push('<div class="fwr-snapshot-tool-div-tip">'), a.push('<div class="fwr-snapshot-tool-div-tip-doing">' + j + "</div>"), a.push('<div class="fwr-snapshot-tool-div-tip-success">' + k + "</div>"), a.push('<div class="fwr-snapshot-tool-div-tip-error">' + l + "</div>"), a.push("</div>"), a.push('<div class="fwr-snapshot-tool-div-controls">'), a.push('<button type="button" class="fwr-snapshot-tool-div-control fwr-snapshot-tool-div-control-copy" title="' + m + '"></button>'), a.push('<button type="button" class="fwr-snapshot-tool-div-control fwr-snapshot-tool-div-control-cancel" title="' + n + '"></button>'), a.push('<a class="fwr-snapshot-tool-div-control fwr-snapshot-tool-div-control-download" download="snapshot.png" title="' + p + '">↓</a>'), a.push("</div>"), a.push("</div>"), C = $(a.join("")).appendTo(i), w(), C
            }

            function w() {
                C.on("click", ".fwr-snapshot-tool-div-control-copy", function() {
                    e(G), G = null, x(), y()
                }).on("click", ".fwr-snapshot-tool-div-control-cancel", function() {
                    G = null, x()
                }).on("click", ".fwr-snapshot-tool-div-control-download", function() {
                    var a = document.createElement("a");
                    if ("download" in a) this.href = G.src;
                    else {
                        var b = document.createElement("iframe");
                        b.onload = function() {
                            this.contentDocument.execCommand("saveas", !1, "snapshot.png"), document.body.removeChild(b)
                        }, b.src = G.src, document.body.appendChild(b)
                    }
                    G = null, x()
                })
            }

            function x() {
                C && C.addClass("hidden").removeClass("success error doing")
            }

            function y() {
                H = H || $('<div class="fwr-snapshot-tool-success-tip hidden"></div>').appendTo(i), H.removeClass("hidden"), H.html(o), clearTimeout(I), I = setTimeout(function() {
                    H.addClass("hidden")
                }, 1500)
            }
            var z = !1;
            f.call(this);
            var A, B, C, D, E, F, G, H, I, J = "fwr-snapshot-tool-active",
                K = {};
            $(a).on(WebPDF.EventList.DOCVIEW_SCROLL, function() {
                G = null, x()
            }), this.onActivate = function() {
                A = a.getMainView().getDocView(), B = $("#" + A.getDocViewContainerID()), B.addClass(J), F = $('<div contenteditable="true" style="position: fixed; top: -10px; left: -10px; width: 0; height: 0; overflow: hidden;"></div>').appendTo(i)
            }, this.onDeactivate = function() {
                A = null, B.removeClass(J), B = null, C && C.remove(), C = null, F && F.remove(), F = null, K = {}, H && H.remove(), H = null
            }, this.onLButtonDown = function(a) {
                z = !0, v(), x(), C.removeClass("hidden"), D = E = [a.clientX, a.clientY], b()
            }, this.onMouseMove = function(a) {
                z && (E = [a.clientX, a.clientY], b())
            }, this.onLButtonUp = function(a) {
                if (z) {
                    z = !1;
                    var b = c();
                    b.readySnapshot && d(b.left, b.top, b.width, b.height)
                }
            }
        }
        var e, f = (a("core/Common/Common"), a("core/Interface/IReaderToolHandler")),
            g = a("core/Tools/Tools"),
            h = g.TOOL_NAME_SNAPSHOT = "SnapshotTool",
            i = $("body"),
            j = i18n.t("snapshot.doing"),
            k = i18n.t("snapshot.success"),
            l = i18n.t("snapshot.error"),
            m = i18n.t("snapshot.copy"),
            n = i18n.t("snapshot.cancel"),
            o = i18n.t("snapshot.copySuccess"),
            p = i18n.t("snapshot.download");
        return e = document.body.createControlRange ? function(a) {
                var b = document.body.createControlRange();
                b.addElement(a), b.execCommand("copy")
            } : function(a) {
                var b = window.getSelection();
                b.removeAllRanges();
                var c = document.createRange();
                c.selectNode(a), b.addRange(c), document.execCommand("copy")
            },
            function() {
                var a = function() {};
                a.prototype = f.prototype, d.prototype = new a
            }(), d.prototype.getName = function() {
                return h
            }, d
    }), define("core/Interface/IReaderToolHandler", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        return d.IReaderToolHandler = function() {}, d.IReaderToolHandler.prototype = {
            onInit: function(a) {},
            onDestroy: function() {},
            getName: function() {},
            onActivate: function() {},
            onDeactivate: function() {},
            isEnabled: function() {
                return !1
            },
            isProcessing: function() {
                return !1
            },
            onLButtonDown: function(a) {},
            onLButtonUp: function(a) {},
            onLButtonDblClk: function(a) {},
            onMouseMove: function(a) {},
            onRButtonDown: function(a) {},
            onRButtonUp: function(a) {},
            onRButtonDblClk: function(a) {},
            onMouseWheel: function(a) {},
            onMouseOver: function(a) {},
            onMouseOut: function(a) {},
            onMouseEnter: function(a) {},
            onMouseLeave: function(a) {},
            onDoubleTap: function(a) {},
            onPinchIn: function(a) {},
            onPinchOut: function(a) {},
            onHold: function(a) {}
        }, d.IReaderToolHandler
    }), define("core/Interface/IReaderPlugin", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.IReaderPlugin = function() {
            this.getName = function() {
                return "IPlugin"
            }, this.onRegister = function() {}, this.init = function() {}, this.unload = function() {}
        }, b.createPlugin = function(a) {
            return null
        }
    }), define("core/Common/Event", [], function(a, b, c) {
        return WebPDF.EventList = {
            APP_READY: "appReady",
            PAGE_VISIBLE: "pageVisible",
            PAGE_INVISIBLE: "pageInVisible",
            PAGE_SHOW_COMPLETE: "pageShowComplete",
            DOCUMENT_LOADED: "documentLoaded",
            DOCUMENT_CLOSED: "documentClosed",
            PAGE_TEXT_LOADED: "pageTextLoaded",
            DOCUMENT_SAVED: "documentSaved",
            DOCVIEW_PRE_RESIZE: "docViewPreResize",
            DOCVIEW_RESIZE: "docViewResized",
            DOCVIEW_SCROLL: "docViewScroll",
            DOCVIEW_ZOOM_CHANGED: "docViewZoomChanged",
            DOCVIEW_ROTATE_CHANGED: "docViewRotateChanged",
            DOCVIEW_PAGE_CHANGED: "pageChanged",
            MAINFRAME_RESIZE: "mainframeResized",
            TOOL_CHANGED: "toolChanged",
            LAYOUTSHOWMODE_CHANGED: "layoutShowModeChanged",
            DOC_MODIFY_STATE_CHANGED: "docModified",
            SEARCH_ALL_FINISHED: "searchAllFinished",
            INKSIGN_INIT: "inkSignInit",
            INKSIGN_CREATEPANEL: "inkSignCreatePanel",
            INKSIGN_SIGN: "inkSignSign",
            INKSIGN_TOOL_DEACTIVATE: "inkSignToolDeactivate",
            INKSIGN_MOBILE_UPDATEUI: "inkSignMobileUpdateUI",
            INKSIGN_MOBILE_SELECTORADDINKSIGN: "inkSignMobileSelectOrAddInkSign",
            CPDFENGINE_READY: "cPDFEngineReady",
            ANNOT_DELETED: "annotDelete",
            ANNOT_ADDED: "annotAdded",
            ANNOT_ADDED_NOFilter: "annotAddedWithoutFilter",
            ANNOT_SELECTED: "annotSelected",
            ANNOT_UPDATED: "annotUpdated",
            ANNOTS_LOADED_SUCCESS: "annotLoadedSuccess",
            ANNOTS_VISIBILITY_CHANGED: "annotsVisibleChanged",
            USER_LOGIN_STATE_CHANGED: "userLoginStateChanged",
            USER_CONFIG_CHANGED: "userConfigChanged",
            OFFLINEMODE_CHANGED: "offlineModeChanged",
            PAGES_PREPARE_PRINT: "pagesPrePrint",
            PAGE_SHOW_LIMIT: "pageShowLimit"
        }, WebPDF.EventList
    }), define("core/Framework/File/FileUtils", ["core/WebPDF", "core/Common/ServerService", "core/Common/apis", "core/Common/ajax/index", "core/Common/ajax/AjaxEndpoint", "core/Common/ajax/polyfill", "core/Common/ajax/template", "core/Common/ajax/Ajax", "core/Common/ajax/FilterChain", "core/Common/ajax/utils", "core/Common/ajax/errors", "core/Common/ajax/commonAjaxFilters"], function(a, b, c) {
        function d(a, b, c, d, e) {
            $.ajax({
                url: a + "api/file/add",
                type: "POST",
                data: c,
                success: function(a) {
                    d && "function" == typeof d && d(a)
                },
                error: function() {
                    e && "function" == typeof e && e()
                }
            })
        }

        function e(a) {
            return r.ViewerInstance.isDocModified() ? (r.confirm(null, i18n.t("saveDialog.dlgTitle"), i18n.t("saveDialog.confirmContent"), i18n.t("saveDialog.saveBtnTitle"), i18n.t("saveDialog.cancel"), function(b) {
                var c = !0;
                b && (c = r.ViewerInstance.save(!0, !1)), a && c && a(b)
            }), !0) : !1
        }

        function f(a) {
            function b(a) {
                function b() {
                    c(f)
                }
                var f = d(a);
                if (f) return 0 == f.size ? (r.alert(null, null, i18n.t("document.invalid")), void F[0].reset()) : void(e(b) || c(f))
            }

            function c(b) {
                r.Common.getEngine(a, function(a) {
                    r.Engine.JR ? o(b) : l(b)
                })
            }

            function d(a) {
                var b = a.target.files ? a.target.files[0] : null;
                !b && a.dataTransfer && a.dataTransfer.files.length > 0 && (b = a.dataTransfer.files[0]);
                var c = r.Environment.ie8OrLower || r.Environment.ie9Compact;
                return r.Engine.JR || !r.Engine.JR && !c ? b : !0
            }

            function f(b, c) {
                fileName = c.name, $.ajax({
                    type: "GET",
                    url: a + "api/file/exist?fileMd5=" + b + "&version=" + w + "&fileSize=" + v + "&fileUrl=" + encodeURIComponent(fileName),
                    success: function(d) {
                        var e = JSON.parse(d);
                        if (0 == e.resultCode) G.val(""), p(!0, e.docId, fileName, "");
                        else {
                            var f = new XMLHttpRequest,
                                g = a + "api/file/upload?fileMd5=" + b + "&version=" + w + "&fileSize=" + v + "&fileUrl=" + encodeURIComponent(c.name);
                            f.open("post", g, !0);
                            var h = new FormData;
                            h.append("file", c), f.onload = function(a) {
                                r.closeUploading();
                                var b = JSON.parse(this.responseText);
                                G.val(""), 0 == b.resultCode ? p(!0, b.docId, fileName, b.fileMd5) : r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                            }, f.onerror = function(a, b, c) {
                                r.closeUploading(), r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                            }, f.upload.onloadstart = function() {
                                r.uploading(null, 0)
                            }, f.upload.onprogress = function(a, b, c, d) {
                                r.uploading(null, parseInt(a.loaded / a.total))
                            }, f.send(h)
                        }
                    },
                    beforeSend: function() {
                        r.uploading(null, 0)
                    },
                    uploadProgress: function(a, b, c, d) {
                        r.uploading(null, d)
                    },
                    error: function(a) {
                        r.closeUploading(), r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"));
                    }
                })
            }

            function g(a) {
                function b() {
                    var b = e * d,
                        g = b + d >= a.size ? a.size : b + d;
                    f.readAsArrayBuffer(c.call(a, b, g))
                }
                var c = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice,
                    d = 1048576,
                    e = 0,
                    f = new FileReader;
                a.size;
                chunks = Math.ceil(a.size / d);
                var g = new Array;
                f.onload = function(a) {
                    if (g.push(a.target.result), e++, e < chunks) b();
                    else {
                        var c = new Uint8Array(g[0]);
                        length = c.length, r.ViewerInstance.importAnnotsFromXFDF(c), E.val("")
                    }
                }, f.onerror = function() {
                    console.warn("oops, something went wrong.")
                }, b()
            }

            function i(b) {
                r.Common.getEngine(a, function(a) {
                    r.Engine.JR ? j(b) : k(b)
                })
            }

            function j(a) {
                var b = new FileReader;
                b.readAsArrayBuffer(a), b.onload = function(a) {
                    var b = new Uint8Array(a.target.result),
                        c = {
                            type: "fileBuffer",
                            fileBuffer: b
                        };
                    r.ViewerInstance.importAnnotsFromFDF(c), G.val("")
                }
            }

            function k(a) {
                var b = r.Tool.getReaderApp().getBaseUrl() + "asserts/getAnnotsDataFromFDFFile",
                    c = {
                        type: "POST",
                        url: b,
                        dataType: "json",
                        success: function(a) {
                            if (r.closeUploading(), G.val(""), a && 0 == a.error) {
                                var b = String.utf8ArrayToString(a.data),
                                    c = r.Tool.getReaderApp().getPDFDoc();
                                if (c) {
                                    var d = $.parseJSON(b);
                                    c.importAnnotsFromJsonData(d.annotsArr)
                                }
                            } else r.alert(null, null, i18n.t("PCLng.ToolBar.ImportFile.FDFFailed"))
                        },
                        error: function(a, b, c) {
                            r.closeUploading(), r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                        },
                        beforeSend: function() {
                            r.uploading(null, 0)
                        },
                        uploadProgress: function(a, b, c, d) {
                            r.uploading(null, d)
                        }
                    };
                F && (F.ajaxSubmit(c), G.val(""))
            }

            function l(a) {
                if (r.Environment.ie8OrLower || r.Environment.ie9Compact) {
                    var b = "";
                    w = "", v = 0, G.val() ? n(b) : f(b, a)
                } else {
                    if (!s(a.size)) return;
                    m(a)
                }
            }

            function m(a) {
                function b() {
                    var b = e * d,
                        f = b + d >= a.size ? a.size : b + d;
                    h.readAsArrayBuffer(c.call(a, b, f))
                }
                var c = File.prototype.slice || File.prototype.mozSlice || File.prototype.webkitSlice,
                    d = 1048576,
                    e = 0,
                    g = new SparkMD5.ArrayBuffer,
                    h = new FileReader,
                    i = "";
                v = a.size, h.onload = function(b) {
                    if (0 == e) {
                        if (b.target.result.byteLength < d) g.append(b.target.result);
                        else {
                            var c = new Uint8Array(b.target.result),
                                h = new Uint8Array(c.subarray(0, 1024));
                            g.append(h.buffer)
                        }
                        return i = g.end(), w = a.lastModifiedDate ? a.lastModifiedDate.toGMTString() : new Date(a.lastModified).toGMTString(), G.val() ? void n(i) : void f(i, a)
                    }
                }, h.onerror = function() {
                    console.warn("oops, something went wrong.")
                }, b()
            }

            function n(b) {
                var c = t();
                if (c && "" != c && _checkFileNameValid(c)) {
                    var d = G.val();
                    $.ajax({
                        type: "GET",
                        url: a + "api/file/exist?fileMd5=" + b + "&version=" + w + "&fileSize=" + v + "&fileUrl=" + d,
                        cache: !1,
                        success: function(e) {
                            var f = JSON.parse(e);
                            if (0 == f.resultCode) G.val(""), p(!0, f.docId, c, "");
                            else {
                                r.uploading(null, 0);
                                var g = {
                                    type: "POST",
                                    url: a + "api/file/upload?fileMd5=" + b + "&version=" + w + "&fileSize=" + v + "&fileUrl=" + d,
                                    success: function(a) {
                                        r.closeUploading();
                                        var b = JSON.parse(a);
                                        G.val(""), 0 == b.resultCode ? p(!0, b.docId, c, b.fileMd5) : r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                                    },
                                    error: function(a, b, c) {
                                        r.closeUploading(), r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                                    },
                                    beforeSend: function() {
                                        r.uploading(null, 0)
                                    },
                                    uploadProgress: function(a, b, c, d) {
                                        r.uploading(null, d)
                                    }
                                };
                                F && (F.ajaxSubmit(g), G.val(""))
                            }
                        },
                        beforeSend: function() {
                            r.uploading(null, 0)
                        },
                        uploadProgress: function(a, b, c, d) {
                            r.uploading(null, d)
                        },
                        error: function(a) {
                            r.closeUploading(), r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                        }
                    })
                }
            }

            function o(a) {
                var b = G.val();
                if ("" == b && (b = a.name), _checkFileNameValid(b)) {
                    var c = new FileReader;
                    c.readAsArrayBuffer(a), c.onload = function(c) {
                        function d() {
                            r.closeWaiting(), p(!0, b, t(), ""), G.val("")
                        }
                        var e = new Uint8Array(c.target.result);
                        u = e.buffer, v = a.size, w = a.lastModifiedDate ? a.lastModifiedDate.toGMTString() : new Date(a.lastModified).toGMTString(), 0 == b.length && (b = a.name), r.ViewerInstance.loadDataControl(r.Engine.JR);
                        var f = r.ViewerInstance.getDataControl(),
                            g = {
                                type: "initLoad",
                                success: d
                            };
                        f.initLoad(g)
                    }
                }
            }

            function p(b, c, d, e) {
                c && "" != c && (q(), h(a, c, u, b, d, v, w, function(a) {
                    r.closeWaiting()
                }, !0, e))
            }

            function q() {
                $("#homepage").is(":hidden") || ($("#homepage").hide(), $("#toolbar").show(), $("#frame").show())
            }

            function s(a) {
                var b = a / 1024 / 1024,
                    c = 50;
                return r.ConnectPdf || (c = 200), b > c ? (50 == c ? r.alert(null, null, i18n.t("ParseError.OutOfFileSizeLimit")) : r.alert(null, null, i18n.t("ParseError.OutOfViewerFileSizeLimit")), !1) : !0
            }

            function t() {
                if (!G) return "";
                var a = G.get(0).value,
                    b = a.lastIndexOf("/");
                return b >= 0 ? a.substr(b + 1) : (b = a.lastIndexOf("\\"), b >= 0 ? a.substr(b + 1) : a)
            }
            var u = null,
                v = null,
                w = null,
                x = $("#fileUploadForm"),
                y = $("#path"),
                z = $("#fileUploadForm2"),
                A = $("#path2"),
                B = $("#fdfFileUploadForm"),
                C = $("#fdfPath"),
                D = $("#xfdfFileUploadForm"),
                E = $("#xfdfPath"),
                F = null,
                G = null;
            y.change(function(a) {
                F = x, G = y, b(a)
            }), A.change(function(a) {
                F = z, G = A, b(a)
            }), C.change(function(a) {
                F = B, G = C;
                var b = d(a);
                b && i(b)
            }), r.Environment.ie8OrLower || r.Environment.ie9Compact ? E.remove() : E.on("change", function(a) {
                if (r.Environment.ie8OrLower || r.Environment.ie9Compact) return void r.alert(null, null, i18n.t("Compatible.IE9orLower"));
                F = D, G = E;
                var b = d(a);
                b && g(b)
            }), r.FileUtils.openLocalDRM = function(a, c) {
                F = $("#homepage-open-form"), G = c, b(a)
            }
        }

        function g(a, b, c, d) {
            function f() {
                h(g, j, null, k, l, 0, m, c, null, null, b)
            }
            var g = r.optionParameters.serverBaseUrl,
                i = getDocUri(),
                j = "",
                k = null,
                l = "",
                m = "";
            if (d = d !== !1, null != i) {
                if ("1" === getUrlParam("iswrapper")) return;
                k = parseInt(getUrlParam("islocal")), l = getUrlParam("fileName"), l && (l = window.decodeURIComponent(l)), m = getUrlParam("lmd"), m && (m = window.decodeURIComponent(m)), j = i
            } else a && (j = a);
            return k = k ? !0 : !1, j ? "http" !== j.slice(0, 4) ? !1 : d && e(f) ? !0 : void h(g, j, null, k, l, 0, m, c, null, null, b) : void 0
        }

        function h(a, b, c, d, e, f, g, h, l, m, n) {
            function o(i) {
                if (r.waiting(null, null, i18n.t("Load.Loading")), !r.Engine.JR) {
                    $("#inkSignList").hide();
                    var l = k(b, d, e, g, i);
                    return j(a, b, d, l, h)
                }
                if (d !== !0)
                    if (b.indexOf("http") >= 0) {
                        var m = b.lastIndexOf("/");
                        e = b.substring(m + 1), r.Common.xhFile(b, e, h)
                    } else r.closeWaiting(), alert(i18n.t("CommonLng.Create.URLError")), $.isFunction(h) && h();
                else if (c) {
                    var n;
                    if (1048576 > f) n = c;
                    else {
                        var o = new Uint8Array(c),
                            p = new Uint8Array(o.subarray(0, 1024));
                        n = p.buffer
                    }
                    var q = new SparkMD5.ArrayBuffer;
                    q.append(n);
                    var s = q.end();
                    r.Common.openFilebyJR(s, g, f, e, c, b, !0)
                }
            }
            if (l) {
                if (n) return i({
                    url: b
                });
                o(m)
            } else r.Common.getEngine(a, function(a) {
                function c() {
                    r.closeWaiting(), n ? i({
                        url: b
                    }) : o(m)
                }
                r.ViewerInstance.loadDataControl(r.Engine.JR);
                var d = r.ViewerInstance.getDataControl(),
                    e = {
                        type: "initLoad",
                        success: c
                    };
                d.initLoad(e)
            })
        }

        function i(a) {
            function b() {
                return r.waiting(null, null, i18n.t("Load.Loading")), s.pretreat({
                    filetype: d,
                    zooms: e,
                    tileRender: !1,
                    fileuri: JSON.stringify({
                        params: {
                            userName: r.AccountInstance.getUserAccount(),
                            userId: r.AccountInstance.getUserId(),
                            file: a.url
                        }
                    })
                }).then(function(a) {
                    var b = a.taskid;
                    return s.waitingForPretreatTaskComplete(b).then(function(a) {
                        return s.parsePages(a.docid, a.uuid, 0, 3).then(function() {
                            r.closeWaiting();
                            var b = {
                                isLargeFile: !0,
                                docId: a.docid,
                                taskId: a.taskId
                            };
                            return c(a.uuid, b), a
                        })
                    }, function(a) {
                        return r.closeWaiting(), a.msg ? r.alert(null, null, a.msg) : r.alert(null, null, i18n.t("ParseError.FailToOpen")), Promise.reject(a)
                    })
                })
            }

            function c(a, b) {
                var c = r.optionParameters.serverBaseUrl + "asserts/" + a;
                r.ViewerInstance.openFile(c, b)
            }
            var d = a.filetype || "http",
                e = a.zooms || "-1,100";
            e instanceof Array && (e = e.join(","));
            var f = r.Tool.getReaderApp();
            return f.isOffline() ? Promise.reject(new Error("offline mode")) : b()
        }

        function j(a, b, c, e, f) {
            function h(d) {
                var h = d.result;
                if (null == h) {
                    if (r.closeWaiting(), c) {
                        var i = JSON.parse(e.params),
                            k = i.fileName;
                        setTimeout(function() {
                            alert(i18n.t("ParseError.ConvertFileFail") + k)
                        }, 100)
                    } else setTimeout(function() {
                        alert(i18n.t("ParseError.ConvertFileFail") + b)
                    }, 100);
                    return null != f && f(!1), null
                }
                if ("LicenseInvalid" == h) return r.closeWaiting(), setTimeout(function() {
                    alert(i18n.t("ParseError.LicenseInvalid"))
                }, 100), null != f && f(!1), null;
                if ("LicenseExpired" == h) return r.closeWaiting(), setTimeout(function() {
                    alert(i18n.t("ParseError.LicenseExpired"))
                }, 100), null != f && f(!1), null;
                if ("OutOfFileSizeLimit" == h) return r.closeWaiting(), r.Environment.mobile ? r.ConnectPdf ? alert(i18n.t("ParseError.OutOfFileSizeLimit")) : setTimeout(function() {
                    alert(i18n.t("ParseError.OutOfViewerFileSizeLimit"))
                }, 100) : r.confirmed(null, null, "CommonDialog.ConfirmOpenLargeFile").then(function() {
                    g(b, !0, f, !1);
                    var a = JSON.parse(e.params),
                        c = r.Tool.getReaderApp();
                    a.fileName && c.setFileName(a.fileName)
                }, function() {}), null;
                if (j = a + "asserts/" + h, "undefined" != typeof r && null != r.ViewerInstance) {
                    r.ViewerInstance.openFile(j), null != f && f(!0);
                    var i = JSON.parse(e.params),
                        l = r.Tool.getReaderApp();
                    return i.fileName && l.setFileName(i.fileName), void $(window).resize()
                }
            }

            function i() {
                if (r.closeWaiting(), r.closeUploading(), f && f(!1), c) {
                    var a = $("#upfile");
                    setTimeout(function() {
                        var b = a.val();
                        b || (b = r.Tool.readerApp.fileUrl), alert("FailToOpen:" + b)
                    }, 100)
                } else setTimeout(function() {
                    alert("FailToOpen:" + b)
                }, 100)
            }
            var j = null;
            return d(a, b, e, h, i), j
        }

        function k(a, b, c, d, e) {
            var f = "",
                g = "",
                h = "",
                i = "";
            if (r.AccountInstance && (h = r.AccountInstance.getUserAccount(), i = r.AccountInstance.getUserId()), b) {
                var j = d;
                g = "local", f = {
                    userName: h,
                    userId: i,
                    file: a,
                    fileName: c,
                    lastModifiedDate: j,
                    fileMd5: e
                }, f = JSON.stringify(f)
            } else {
                a = a.replace(/^\s*/g, "").replace(/\s*$/g, "");
                var k = {};
                apiConfig && apiConfig.document && "object" == typeof apiConfig.document.getDocument ? k = apiConfig.document.getDocument : apiConfig && apiConfig.document && "function" == typeof apiConfig.document.getDocument ? k = apiConfig.document.getDocument() : console.error("apiConfig.document.getDocument format error,mush object or function"), k = k ? k : {};
                var f = {
                    params: {
                        userName: h,
                        userId: i,
                        file: a
                    }
                };
                $.extend(!0, k, f), f = JSON.stringify(k), g = "http"
            }
            return {
                params: f,
                type: g
            }
        }

        function l(a) {
            function b() {
                n(c, f)
            }
            var c = t,
                d = isEnableCookie();
            if (!d) return void alert(i18n.t("MobileLng.CookieTip"));
            var f = null,
                g = null,
                h = getDocUri();
            if (h ? f = h : a && (f = a), f) {
                if (e(b)) return !0;
                g = n(c, f)
            }
            o()
        }

        function m(a, b, c, e) {
            function f(d) {
                var f = d.result;
                if (null == f) return r.closeWaiting(), alert(i18n.t("ParseError.ConvertFileFail") + b), showPage("homePage"), null;
                if ("LicenseInvalid" == f) return r.closeWaiting(), alert(i18n.t("ParseError.LicenseInvalid")), showPage("homePage"), null;
                if ("LicenseExpired" == f) return r.closeWaiting(), alert(i18n.t("ParseError.LicenseExpired")), showPage("homePage"), null;
                if ("OutOfFileSizeLimit" == f) return r.closeWaiting(), r.ConnectPdf ? alert(i18n.t("ParseError.OutOfFileSizeLimit")) : alert(i18n.t("ParseError.OutOfViewerFileSizeLimit")), showPage("homePage"), null;
                h = a + "asserts/" + f;
                var g = {
                    url: b,
                    data: c,
                    isLocal: !1
                };
                setCookie("historyFile", JSON.stringify(g), "/"), "undefined" != typeof r && null != r.ViewerInstance && (r.ViewerInstance.setFileUrl(b), r.ViewerInstance.openFile(h), null != e && e())
            }

            function g() {
                showPage("homePage"), r.closeWaiting(), alert("FailToOpen:" + b)
            }
            var h = null;
            return d(a, b, c, f, g), h
        }

        function n(a, b, c) {
            b = b.replace(/^\s*/g, "").replace(/\s*$/g, "");
            var d = Configs.DefaultUserId,
                e = Configs.DefaultAccount;
            r.AccountInstance && (d = r.AccountInstance.getUserId(), e = r.AccountInstance.getUserAccount());
            var f = {
                    params: {
                        userName: e,
                        userId: d,
                        file: b
                    }
                },
                g = {};
            apiConfig && apiConfig.document && "object" == typeof apiConfig.document.getDocument ? g = apiConfig.document.getDocument : apiConfig && apiConfig.document && "function" == typeof apiConfig.document.getDocument ? g = apiConfig.document.getDocument() : console.error("apiConfig.document.getDocument format error,mush object or function"), g = g ? g : {}, $.extend(!0, g, f), f = JSON.stringify(g);
            var h = "http",
                i = {
                    params: f,
                    type: h
                };
            return r.Engine = {
                JR: !1
            }, r.ViewerInstance.loadDataControl(r.Engine.JR), m(a, b, i, c)
        }

        function o() {
            if (r.Environment.mobile) {
                var a = null;
                window.onorientationchange = function() {
                    null != r && null != r.ViewerInstance && (window.scrollTo(0, 0), a && clearTimeout(a), a = setTimeout(function() {
                        window.onresize(), a = null
                    }, 500)), $("#fwr-annots-context-menu").hide(), $("#fwr-textSelect-context-menu").hide()
                }
            }
        }

        function p(a, b, c, d, e) {
            r.Common.openFilebyJR(a, d, c, e, b.buffer, e, !1)
        }

        function q(a, b, c, d, e) {
            function f(c) {
                function f(b) {
                    var c = JSON.parse(b);
                    if (c && 0 == c.resultCode) {
                        var f = c.docId;
                        return l(g, f, e, d, a)
                    }
                    r.closeUploading(), r.alert(null, null, i18n.t("CommonLng.Create.FailToUpload"))
                }

                function l(a, b, c, d, e) {
                    $("#inkSignList").hide();
                    var f = k(b, !0, c, d, e);
                    return j(a, b, !0, f, function() {
                        r.closeWaiting()
                    })
                }
                var m = JSON.parse(c);
                if (0 == m.resultCode) {
                    var n = m.docId;
                    return l(g, n, e, d, a)
                }
                h.success = f, h.fileBuffer = b, i.uploadFile(h)
            }
            var g = r.optionParameters.serverBaseUrl,
                h = {
                    fileMd5: a,
                    version: d,
                    fileSize: c,
                    fileUrl: e,
                    success: f
                },
                i = r.Tool.getReaderApp().getDataControl();
            i.isFileExist(h)
        }
        var r = a("core/WebPDF"),
            s = a("core/Common/ServerService"),
            t = r.optionParameters.serverBaseUrl;
        return r.FileUtils = {
            init: function() {
                r.Environment.mobile || f(t)
            },
            openFileByUri: function(a, b) {
                r.Environment.mobile ? l(a) : g(a, b)
            },
            openFileByFileId: function(a, b) {
                var c = r.Common.joinUrl(r.serverBaseUrl, "asserts", a);
                b ? (r.waiting(null, null, i18n.t("Load.Loading")), s.fetchDocIdByFileUUID(a).then(function(b) {
                    var d = 3;
                    s.parsePages(b, a, 0, d).then(function(a) {
                        r.ViewerInstance.openFile(c, {
                            isLargeFile: !0,
                            docId: b,
                            taskId: a.taskid
                        })
                    })
                })) : r.ViewerInstance.openFile(c, {
                    isLargeFile: !1
                })
            },
            openFileByStream: function(a, b, c) {
                function d() {
                    var d = a.length,
                        e = (r.optionParameters.serverBaseUrl, new SparkMD5.ArrayBuffer);
                    if (1048576 > d) e.append(a);
                    else {
                        var f = a.subarray(0, 1024);
                        e.append(f)
                    }
                    var g = e.end();
                    r.Engine.JR ? p(g, a, d, b, c) : q(g, a, d, b, c)
                }
                e(d) || d()
            },
            openLastOpenedFile: function() {
                var a = r.Tool.getReaderApp(),
                    b = a.getCurOfflineFile();
                if (b = JSON.parse(b), !a.isOffline() || !b || !b.uuid) return !1;
                var c = r.optionParameters.serverBaseUrl;
                return r.Common.getEngine(c, function(c) {
                    function d() {
                        r.closeWaiting(), a.openOfflineCacheFile(b.uuid)
                    }
                    r.ViewerInstance.loadDataControl(r.Engine.JR);
                    var e = r.ViewerInstance.getDataControl(),
                        f = {
                            type: "initLoad",
                            success: d
                        };
                    e.initLoad(f)
                }), !0
            }
        }, r.FileUtils.init(), r.FileUtils
    }), define("core/Plugins/Annot/Stamp/StampListManager", [], function(a, b, c) {
        function d() {
            function a() {
                var a = getLanguage().toLowerCase(),
                    b = "zh-cn";
                return a.match(/zh-CN/gi) || (b = "en-us"), b
            }
            var b = 0,
                c = 0,
                d = null;
            this.initList = function(e, f, g) {
                var h = null;
                WebPDF.AccountInstance && (h = WebPDF.AccountInstance.getUserConfig()), h && (b = h.userId, c = h.userName, $.ajax({
                    url: WebPDF.serverBaseUrl + "api/systemuser/stamplist?uuid=" + b,
                    type: "GET",
                    success: function(b) {
                        var c = JSON.stringify(b).replace(/\{lang\}/g, a());
                        d = JSON.parse(c), null === d ? f() : e(d, g)
                    },
                    error: function(a) {
                        null === d ? f() : e(d)
                    }
                }))
            }, this.getStamp = function(a, b, c) {
                for (var e = 0 == a ? d["default"] : d.customized.catalogs, f = e.length, g = 0; f > g; g++) {
                    var h = e[g];
                    if (h.en_title === b || h.zh_title === b || h.title === b) {
                        var i = h.stamps,
                            j = i.length;
                        return c > j ? null : i[c]
                    }
                }
            };
            var e;
            this.backupList = function() {
                e = JSON.stringify(d)
            }, this.revert = function() {
                d = JSON.parse(e), e = ""
            }, this.checkCatalogName = function(a) {
                for (var b = 0; 1 > b; b++)
                    for (var c = 0 == b ? d["default"] : d.customized.catalogs, e = c.length, f = 0; e > f; f++) {
                        var g = c[f];
                        if (g.en_title === a || g.zh_title === a || g.title === a) return !1
                    }
                return !0
            };
            var f = !1;
            this.deleteStamp = function(a, b, c) {
                for (var e = 0 == a ? d["default"] : d.customized.catalogs, g = e.length, h = 0; g > h; h++) {
                    var i = e[h];
                    if (i.title === b) {
                        if (-1 === c) return i.del = 1, void(f = !0);
                        var j = i.stamps;
                        j[c].del = 1, f = !0
                    }
                }
            }, this.showDefault = function(a) {
                f = !(a === d.customized.showDefault), d.customized.showDefault = a
            }, this.addStamp = function(a, c, e) {
                return f = !0, new Promise(function(f, g) {
                    var h = d.customized.catalogs,
                        i = (h.length, new XMLHttpRequest),
                        j = WebPDF.serverBaseUrl + "api/systemuser/" + b + "/addStamp";
                    i.open("post", j, !0);
                    var k = new FormData;
                    k.append("file", c), k.append("title", a), k.append("name", e), k.append("stampList", JSON.stringify(d.customized)), i.onload = function(a) {
                        d.customized = JSON.parse(this.response), f()
                    }, i.onerror = function(a, b, c) {
                        console.log(data), g(data)
                    }, i.send(k)
                })
            }, this.update = function() {
                0 !== b && f && $.ajax({
                    url: WebPDF.serverBaseUrl + "api/systemuser/" + b + "/updateStamp",
                    type: "POST",
                    data: {
                        stampList: JSON.stringify(d.customized)
                    },
                    success: function(a) {
                        d.customized = a
                    },
                    error: function(a) {
                        console.log(a)
                    }
                })
            }, this.getStampList = function() {
                return d
            }, this.isChanged = !0
        }
        return d
    }), define("core/Plugins/Annot/Stamp/StampList", ["core/Plugins/Annot/Stamp/StampListManager", "core/Plugins/Annot/Stamp/StampView"], function(a, b, c) {
        function d() {
            this.stampListId = "stampList", this.init = function(a) {
                h || (g.setManager(f), WebPDF.waiting(null, null, i18n.t("cPDFError.NewVersion.UploadingBtn")), f.initList(g.initToolbar, null, a), h = !0)
            }, this.save = function() {
                f.save()
            }, this.manageStamp = function() {
                h ? g.showManageDlg() : this.init(g.showManageDlg)
            }
        }
        var e = a("core/Plugins/Annot/Stamp/StampListManager"),
            f = new e,
            g = a("core/Plugins/Annot/Stamp/StampView"),
            h = !1;
        WebPDF.StampPlugin = new d
    }), define("core/Plugins/Annot/Stamp/StampView", [], function(a, b, c) {
        function d() {
            $(".fwr-stamp-tree").empty();
            var a = "",
                b = i.getStampList().customized;
            if (b && b.catalogs) {
                var c = b.catalogs.length,
                    d = !0;
                $(".fwr-stamp-right>img").attr("src", "");
                for (var e = 0; c > e; e++) {
                    var g = b.catalogs[e];
                    if (1 !== g.del) {
                        var h = g.title,
                            j = g.stamps,
                            k = j.length;
                        a += '<li  class="fwr-stamp-leaf">   <div class="fwr-stamp-swtich tabOpen"></div>   <div class="fwr-stamp-lable catalog">' + h + "</div></li>", a += '<ul class="fwr-stamp-subCatalog" title="' + h + '">';
                        for (var l = 0; k > l; l++)
                            if (!j[l].del) {
                                var m = j[l].name,
                                    n = "";
                                d && (n = "selected", d = !1, $(".fwr-stamp-right>img").attr("src", "/" + j[l].icon)), a += '<li  class="fwr-stamp-leaf"><div class="fwr-stamp-lable ' + n + '" index=' + l + ">" + m + "</div></li>"
                            }
                        a += "</ul>"
                    }
                }
                $(".fwr-stamp-tree").append(a), f()
            }
        }

        function e(a) {
            var b = $(a + " img"),
                c = $(a),
                d = b.width(),
                e = b.height();
            if (0 !== d) {
                var f = c.width(),
                    g = c.height(),
                    h = 0,
                    i = 0;
                f > d && (h = (f - d) / 2), g > e && (i = (g - e) / 2), b.css("padding", i + "px " + h + "px")
            }
        }

        function f() {
            $(".fwr-stamp-swtich").off("click").on("click", function(a) {
                var b = $(this).siblings(".fwr-stamp-lable").html();
                return $(this).hasClass("tabOpen") ? ($(this).removeClass("tabOpen"), $(".fwr-stamp-subCatalog[title=" + b + "]").addClass("fwr-hidden")) : ($(this).addClass("tabOpen"), $(".fwr-stamp-subCatalog[title=" + b + "]").removeClass("fwr-hidden")), !1
            }), $(".fwr-stamp-lable").off("click").on("click", function(a) {
                $(".fwr-stamp-lable.selected").removeClass("selected"), $(this).addClass("selected");
                var b = $($(this).parents("ul")[0]).attr("title"),
                    c = $(this).attr("index"),
                    d = i.getStamp(1, b, c);
                return d ? $(".fwr-stamp-right img").attr("src", "/" + d.icon) : $(".fwr-stamp-right img").attr("src", ""), !1
            })
        }

        function g() {
            0 === i.getStampList().customized.showDefault ? $(".fwr-stamp-showDefault").attr("checked", "checked") : $(".fwr-stamp-showDefault").removeAttr("checked"), $(".fwr-stamp-tab").off("click").on("click", function(a) {
                $(".fwr-stamp-tab.selected").removeClass("selected"), $(this).addClass("selected")
            }), $(".fwr-stamp-showDefault").off("change").on("change", function(a) {
                $(this).is(":checked") ? i.showDefault(0) : i.showDefault(1)
            });
            var a = null;
            $(".fwr-stamp-button.add").off("click").on("click", function(b) {
                for (var c = '<option value="&lt;to name a new category&gt;">&lt;to name a new category&gt;</option>', f = i.getStampList().customized.catalogs, g = 0; g < f.length; g++) {
                    var h = f[g],
                        j = h.title;
                    c += "<option value=" + j + ">" + j + "</option>"
                }
                var k = !1;
                if (a) k = !0, a.webPDFModal("show");
                else {
                    var l = "fwr-stamp-addInput",
                        m = "";
                    WebPDF.Environment.safari && (l = "", m = "safari");
                    var n = '<div class="fwr-modal fwr-hide fwr-fade fwr-in fwr-stamp-addDlg">   <div class="fwr-modal-header">       <a class="close" webpdf-data-dismiss="modal"></a>       <h4 >' + i18n.t("PCLng.ToolBar.ManageStamp") + '</h4>   </div>   <div class="fwr-modal-body" style="">       <div class="fwr-stamp-addBody">           <div class="fwr-stamp-addLeft" style="border: 1px solid #3A3737;">               <img src="" draggable="false" style="max-height: 100%;max-width: 100%;"> </img>           </div>           <div class="fwr-stamp-addRight">               <div class="">                   <div class="fwr-stamp-addContainer">                       <div class="fwr-stamp-addLable">' + i18n.t("stamp.selectFile") + '</div>                       <input type="file" id="newStampInput" class="' + l + '" accept="image/png,image/gif,image/jpeg,image/bmp"></input>                   </div>                   <div class="fwr-stamp-addContainer">                       <div class="fwr-stamp-addLable">' + i18n.t("stamp.catalog") + '</div>                       <div style="height:25px">                       <span><select id="addCatalog" class="fwr-stamp-addSel">' + c + '                       </select></span>                       <input id="addSelInput" class="' + m + '" />                           </div>                   </div>                   <div class="fwr-stamp-addContainer">                       <div class="fwr-stamp-addLable">' + i18n.t("stamp.name") + '</div>                       <input type="text" id="addName" style="width:200px" class="fwr-stamp-addInput"></input>                   </div>               </div>           </div>       </div>   </div>   <div class="fwr-modal-footer" >       <a href="#" class="btn btn-cancel" webpdf-data-dismiss="modal">' + i18n.t("OnBeforeUnload.Cancel") + '</a>       <div id="btnAddStamp" class="btn btn-success">' + i18n.t("OnBeforeUnload.Ok") + "</div>   </div></div>";
                    a = $(n), a.webPDFModal({
                        keyboard: !1,
                        backdrop: "static",
                        "padding-top": "15px",
                        "padding-right": "30px",
                        "padding-bottom": "15px",
                        "padding-left": "30px",
                        zindex: "1055"
                    })
                }
                k && ($("#addCatalog").empty().append(c), $("#newStampInput").val(""), $("#addName").val(""), $(".fwr-stamp-addLeft>img").attr("src", "")), $("#addCatalog").val("<to name a new category>"), $("#addSelInput").val("<to name a new category>"), $("#addCatalog").off("change").on("change", function(a) {
                    $("#addSelInput").val(this.selectedOptions[0].innerText)
                });
                var o, p, q, r;
                $("#newStampInput").off("change").on("change", function(a) {
                    if (p = a.target.files ? a.target.files[0] : null, !p && a.dataTransfer && (p = a.dataTransfer.files[0]), !p) return !1;
                    var b = new FileReader;
                    b.readAsArrayBuffer(p), b.onload = function(a) {
                        o = new Blob([a.target.result], {
                            type: p.type
                        });
                        var b = URL.createObjectURL(o);
                        $(".fwr-stamp-addLeft>img").attr("src", b), r = p.name, $("#addName").val(p.name)
                    }
                }), $("#addSelInput").off("blur").on("blur", function(a) {
                    i.checkCatalogName($(this).val()) || ($("#addSelInput").val("<to name a new category>"), $(".fwr-stamp-addDlg").parent().css("z-index", "1069"), WebPDF.alert(null, null, "catalog name should be different from predefined name."))
                }), $("#btnAddStamp").off("click").on("click", function(b) {
                    return q = $("#addSelInput").val(), "<to name a new category>" === $("#addSelInput").val() || 0 === $("#addSelInput").val().length || 0 === $("#addSelInput").val().trim().length ? ($(".fwr-stamp-addDlg").parent().css("z-index", "1069"), void WebPDF.alert(null, null, "catalog name is invalid.")) : (r = $("#addName").val(), null !== o && r && 0 != r.length ? ($(".fwr-stamp-addLeft>img").attr("src", ""), $("#addName").val(""), void i.addStamp(q, p, r).then(function() {
                        a.webPDFModal("hide"), d(), $("#newStampInput").val("")
                    }, function() {})) : ($(".fwr-stamp-addDlg").parent().css("z-index", "1069"), void WebPDF.alert(null, null, "please fill up stamp's property.")))
                }), $(".fwr-stamp-addLeft img").off("load").on("load", function(a) {
                    e(".fwr-stamp-addLeft")
                })
            }), $(".fwr-stamp-button.delete").off("click").on("click", function(a) {
                if ($(".fwr-stamp-lable.selected").hasClass("catalog")) i.deleteStamp(1, WebPDF.Common.htmlDecode($(".fwr-stamp-lable.selected").html()), -1);
                else {
                    var b = parseInt($(".fwr-stamp-lable.selected").attr("index")),
                        c = $($(".fwr-stamp-lable.selected").parents("ul").get(0)).attr("title");
                    i.deleteStamp(1, c, b)
                }
                return d(), !1
            }), $("#btnUpdateStamp").off("click").on("click", function(a) {
                i.update(), d(), h.initToolbar(i.getStampList()), j.webPDFModal("hide")
            }), $("#btnCancelStamp").off("click").on("click", function(a) {
                i.revert()
            }), $(".fwr-stamp-right img").off("load").on("load", function(a) {
                e(".fwr-stamp-right")
            })
        }
        var h = function() {},
            i = null;
        h.setManager = function(a) {
            i = a
        }, h.initToolbar = function(a, b) {
            var c = $("#" + WebPDF.StampPlugin.stampListId);
            c.empty();
            for (var d = WebPDF.optionParameters.baseUrl, e = "", f = "", g = 0; 2 > g; g++) {
                stampList = 0 == g ? a["default"] : a.customized.catalogs;
                var i = 0 == g ? " defaultStamp" : "";
                if (stampList)
                    for (var j = stampList.length, k = 0; j > k; k++) {
                        var l = stampList[k];
                        if (1 !== l.del) {
                            var m, n = !1;
                            if (l.title) m = l.title, n = !0;
                            else {
                                m = l.en_title;
                                var o = getLanguage().toLowerCase();
                                o.match(/zh-CN/gi) && (m = l.zh_title)
                            }
                            f = "<li  class='fwr-stamp-title" + i + "'> <div class='fwr-stamp-titlepos'> " + m + "</div></li>", e += f;
                            for (var p = l.stamps, q = p.length, r = 0, s = 0; q > s; s++)
                                if (1 !== p[s].del) {
                                    r++;
                                    var t = n ? "customizedStamp" : "",
                                        u = "";
                                    /.gif$/gi.test(p[s].icon) && (u = " customizedStampGIF");
                                    var v = '<li class="' + t + " fwr-toolbar-stampIcon fwr-toolbar-stampBorder" + i + '"><img class="fwr-toolbar-stampimg' + u + '"  src="' + d + p[s].icon + '" index="' + s + '" type="' + g + '" title="' + m + '">';
                                    if (void 0 != p[s].dynamic) {
                                        for (var w = p[s].dynamic, x = "", y = 0; y < w.length; y++) x += w[y], y !== w.length - 1 && (x += ",");
                                        v += "<p class = 'fwr-stamp-dynamicinfo'  index='" + s + "' title='" + m + "'>", v += x, x += "</p>"
                                    }
                                    v += "</li>", e += v
                                }
                            for (var z = r % 3, A = 0; 3 - z > A && 0 !== z; A++) e += '<li class="' + t + " fwr-stamp-blank fwr-toolbar-stampBorder" + i + '"></li>'
                        }
                    }
            }
            e += '<li style="height:8px"  class="fwr-stamp-title"> <div class="fwr-stamp-titlepos"></div></li>', c.append(e), a.customized.showDefault || $(".defaultStamp").hide(), h.bindStampListEvents(), b && b(), WebPDF.closeWaiting()
        }, h.bindStampListEvents = function() {
            var a = $("#" + WebPDF.StampPlugin.stampListId);
            a.off("cilck", ".fwr-toolbar-stampIcon").on("click", ".fwr-toolbar-stampIcon", function(a) {
                $(".fwr-toolbar-stampIcon").removeClass("selected");
                var b = ($(a.target).parent().addClass("selected"), parseInt(a.target.getAttribute("index"))),
                    c = a.target.getAttribute("title"),
                    d = a.target.getAttribute("type");
                "p" === a.target.tagName.toLowerCase() && (d = a.target.previousElementSibling.getAttribute("type"));
                var e = i.getStamp(d, c, b);
                WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_STAMP);
                var f = WebPDF.ViewerInstance.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_STAMP);
                f.setCurrentStamp(e)
            });
            document.getElementsByClassName("customizedStampGIF")
        };
        var j = null;
        return h.showManageDlg = function() {
            if (i.backupList(), j) j.webPDFModal("show");
            else {
                var a = '<div class="fwr-modal fwr-hide fwr-fade fwr-in fwr-protect-password">   <div class="fwr-modal-header">       <a class="close" webpdf-data-dismiss="modal"></a>       <h4 >' + i18n.t("PCLng.ToolBar.ManageStamp") + '</h4>   </div>   <div class="fwr-modal-body" style="">       <div class="fwr-stamp-body">           <ul class="fwr-stamp-title">               <li class="fwr-stamp-tab custimized selected">                   <div class="fwr-stamp-tabBTN">' + i18n.t("stamp.categories") + '</div>               </li>               <li class="fwr-stamp-static preview">                   <div class="fwr-stamp-tabBTN" style="margin-left:5px">' + i18n.t("stamp.preview") + '</div>               </li>           </ul>           <div class="fwr-stamp-left">               <ul class="fwr-stamp-tree">               </ul>               <div class="fwr-stamp-buttons">                   <div class="btn fwr-stamp-button add" style="font-size:14px;">' + i18n.t("stamp.add") + '</div>                   <div class="btn fwr-stamp-button delete" style="font-size:14px;">' + i18n.t("CommentList.Delete") + '</div>                   <div style="margin-top: 2px;margin-left: 2px;height: 20px;">                       <input type="checkbox" class="fwr-stamp-showDefault" style="width: 16px;height: 16px;position: relative;top: 4px;"/>                       <span style="font-size:14px;">' + i18n.t("stamp.hideDefault") + '</span>                   </div>               </div>           </div>           <div class="fwr-stamp-right">               <img src="" draggable="false" style="max-height: 100%;max-width: 100%;"> </img>           </div>       </div>   </div>   <div class="fwr-modal-footer" >       <a id="btnCancelStamp" href="#" class="btn btn-cancel" webpdf-data-dismiss="modal">' + i18n.t("OnBeforeUnload.Cancel") + '</a>       <div id="btnUpdateStamp" class="btn btn-success">' + i18n.t("OnBeforeUnload.Ok") + "</div>   </div></div>";
                j = $(a), j.webPDFModal({
                    keyboard: !1,
                    backdrop: "static",
                    "padding-top": "15px",
                    "padding-right": "30px",
                    "padding-bottom": "15px",
                    "padding-left": "30px"
                })
            }
            d(), g()
        }, h
    }), define("core/Plugins/InkSign/InkSignListManager", [], function(a, b, c) {
        function d(a) {
            function b(a, b, c, d) {
                var e = a / c,
                    f = b / d,
                    g = f > e ? e : f,
                    h = c * g,
                    i = d * g,
                    j = (a - h) / 2,
                    k = (b - i) / 2;
                return {
                    left: j,
                    top: k,
                    width: h,
                    height: i,
                    scale: g
                }
            }

            function c(a, b, c, d, e) {
                if (!WebPDF.Environment.ie8OrLower) {
                    var f = a.getContext("2d");
                    f.strokeStyle = b.color, f.lineWidth = b.width * c, f.beginPath();
                    for (var g = b.points, h = 0; h < g.length; h++) 0 === h ? f.moveTo((g[h][0] - d) * c, (g[h][1] - e) * c) : f.lineTo((g[h][0] - d) * c, (g[h][1] - e) * c);
                    f.stroke()
                }
            }
            var d = a,
                e = this,
                f = [],
                g = 0,
                h = null;
            this.initList = function() {
                var a = null;
                WebPDF.AccountInstance && (a = WebPDF.AccountInstance.getUserConfig()), a && (g = a.userId, h = a.userName, f = a.inkSignList)
            }, this.getList = function() {
                return f
            }, this.get = function(a) {
                for (var b = 0; b < f.length; b++)
                    if (f[b].inkSignId == a) return f[b];
                return null
            }, this.getCount = function() {
                return f ? f.length : 0
            }, this.save = function(a, b, c) {
                if (null === g || "Anonymous" == g || 0 === g) return $.isFunction(b) && b.call(), !1;
                var e = null;
                WebPDF.AccountInstance && (e = WebPDF.AccountInstance.getUserConfig()), e.inkSignList = a;
                var f = d + "api/systemuser/userconfig/save",
                    i = {
                        id: g,
                        userName: h,
                        userConfig: JSON.stringify(e)
                    };
                $.ajax({
                    type: "post",
                    url: f,
                    dataType: "json",
                    data: i,
                    success: function(a) {
                        $.isFunction(b) && b.call()
                    },
                    error: function(a) {
                        $.isFunction(c) && c.call()
                    }
                })
            }, this.del = function(a, b, c) {
                if (a) {
                    for (var d = 0; d < f.length; d++) f[d].inkSignId == a && (1 == f[d].def, f.splice(d, 1));
                    e.save(f, b, c)
                }
            }, this.add = function(a, b, c) {
                return e.get(a.inkSignId) || f.push(a), f.length > 10 ? (f.pop(), WebPDF.alert(null, i18n.t("InkSign.SigAlertTitle"), i18n.t("InkSign.InkSignExceed")), !1) : (e.setDefaultTemplate(a.inkSignId, b, c), a)
            }, this.updateCertById = function(a, b, c, d) {
                for (var g = 0; g < f.length; g++) f[g].inkSignId == b && (f[g].certType = a);
                e.save(f, c, d)
            }, this.getCertById = function(a) {
                for (var b = 0; b < f.length; b++)
                    if (f[b].inkSignId == a) return f[b].certType
            }, this.getDefaultTemplate = function() {
                for (var a = 0; a < f.length; a++)
                    if (1 == f[a].def) return f[a];
                return null
            }, this.setDefaultTemplate = function(a, b, c) {
                for (var d = 0; d < f.length; d++) 1 == f[d].def && (f[d].def = 0);
                for (var g = 0; g < f.length; g++) f[g].inkSignId == a && (f[g].def = 1);
                e.save(f, b, c)
            }, this.drawThumb = function(a, d, e) {
                var f = a.rect[2] - a.rect[0],
                    g = a.rect[3] - a.rect[1],
                    h = a.pencil,
                    i = a.inkSignId,
                    j = b(d, e, f, g),
                    k = a.rect,
                    l = $("#v" + i);
                l.attr("width", j.width + .5).attr("height", j.height + .5), l.css({
                    left: j.left + .5 + "px",
                    top: j.top + .5 + "px",
                    width: j.width + .5 + "px",
                    height: j.height + .5 + "px",
                    position: "absolute"
                });
                for (var m = $("#v" + i).get(0), n = 0; n < h.length; n++) c(m, h[n], j.scale, k[0], k[1])
            }
        }
        return d
    }), define("core/Plugins/Annot/ImageAnnot/ImageAnnotPlugin", [], function(a, b, c) {
        function d() {}

        function e(a) {
            if (a) {
                var b = h(a),
                    c = -1 === j.indexOf(b);
                if (c) return void WebPDF.alert(WebPDF.Tool.readerApp, null, i18n.t("CommonDialog.UnsupportedFileFormat"));
                i(a).then(function(c) {
                    var d = {
                        size: a.size,
                        name: a.name,
                        type: b
                    };
                    g(c, d)
                })
            }
        }

        function f(a, b) {
            var c = -1 === j.indexOf(b.type);
            return c ? void WebPDF.alert(WebPDF.Tool.readerApp, null, i18n.t("CommonDialog.UnsupportedFileFormat")) : void g(a, b)
        }

        function g(a, b) {
            WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_IMAGE);
            var c = WebPDF.ViewerInstance.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_IMAGE),
                d = WebPDF.Common.encodeArrayBufferAsBase64(a),
                e = "data:" + b.type + ";base64," + d,
                f = new Image;
            f.src = e, f.style = "display: none;", f.onload = function() {
                var g = f.naturalWidth,
                    h = f.naturalHeight;
                c.setCurrentImage({
                    subject: "Image",
                    buffer: a,
                    base64Data: d,
                    imageURL: e,
                    summary: b,
                    naturalWidth: g,
                    naturalHeight: h
                }), f.remove()
            }, document.body.appendChild(f)
        }

        function h(a) {
            function b(a) {
                if (!a) return "";
                a = a.toLocaleLowerCase();
                var b = a.lastIndexOf(".");
                return b > -1 ? a.substring(b + 1) : ""
            }
            if (!a) return null;
            var c = !a.name || a.name.length < 1,
                d = a.type && a.type.length > 0;
            if (c || d) return a.type;
            var e = a.name.toLocaleLowerCase();
            return "image/" + b(e)
        }

        function i(a) {
            var b = new FileReader;
            return new Promise(function(c, d) {
                b.onload = function(a) {
                    var b = a.target.result;
                    c(b)
                }, b.onerror = function(a) {
                    d(a)
                }, b.readAsArrayBuffer(a)
            })
        }
        var j = ["image/png", "image/gif", "image/jpg", "image/jpeg"];
        d.prototype.setCurrentImageFile = e, d.prototype.setCurrentImageBuffer = f, WebPDF.ImageAnnotPlugin = new d
    }), define("core/Plugins/InkSign/PCInkSign", ["core/Plugins/InkSign/InkSignListManager", "core/Common/WriteCanvasTool"], function(a, b, c) {
        function d() {
            function b() {
                var a = null;
                if (!H) {
                    var b = "<div class='apply-signing' id='" + I + "'style='top: 50%;position: absolute;left: 45%;'></div>";
                    return $("#" + E).append(b), H = !0, a = $("#" + I), a.webPDFModal({
                        keyboard: !1,
                        backdrop: "static",
                        manager: "#" + E
                    }), !0
                }
                a = $("#" + I), a.webPDFModal("show")
            }

            function c() {
                var a = $("#" + I);
                a.webPDFModal("hide")
            }

            function d(a, b) {
                if (!J) {
                    var c = "<div id='" + K + "'style='position: absolute;left: 35%;top: 20%;'><div style='position:absolute;text-align:left;left:2px;top:3px;width:396px;height:30px;z-index:17;' class='fwr-sig-layer2'><div style='position:absolute;top:7px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='InkSign.SigFinishTitle' >InkSign</div></div><div  style='text-align:left;width:400px;height:150px;z-index:16;' class='fwr-sig-layer1'><div  style='width:399px;height:2px;z-index:18; ' class='fwr-sig-Line'/><div style='position:absolute;top:60px;left: 40px;font-size: 12px' class='fwr-sig-font2 fwr-sig-layer-margin2'><div class='fwr-icons-sigtip fwr-sigtip-finish'  style='margin-right: 15px;'></div>" + a + "</div><input type='submit' id='inksigViewbutton' data-i18n='[value]InkSign.View' style='position:absolute;left:140px;top:110px; width:115px;' class='fwr-sig-button fwr-sig-normal-button'><input type='submit' id='inksigOrignalButton' data-i18n='[value]InkSign.OriginalFile' style='position:absolute;left:270px;top:110px; width: 115px;' class='fwr-sig-button fwr-sig-normal-button'></div></div>";
                    J = !0, G.append(c), $("#inksigOrignalButton").off("click").on("click", function() {
                        var a = WebPDF.ViewerInstance.getFileID(),
                            b = r + "asserts/" + a;
                        WebPDF.ViewerInstance.openFile(b), $("#" + K).hide(), G.hide()
                    })
                }
                $("#inksigViewbutton").off("click").on("click", function() {
                    q(r, b), $("#" + K).hide(), G.hide()
                }), $("#" + K).show(), $("#" + K).draggable(), $("#" + K).i18n(), G.show()
            }

            function e(a, b) {
                if (!L) {
                    var c = "<div id='" + M + "'style='height: 100%;position: absolute;width: 100%;left: 35%;top: 20%;'><div style='position:absolute;text-align:left;left:2px;top:3px;width:396px;height:30px;z-index:17;' class='fwr-sig-layer2'><div style='position:absolute;top:7px;' class='fwr-sig-font1 fwr-sig-layer-margin1' data-i18n='InkSign.SigFinishTitle' >Signature</div></div><div  style='text-align:left;width:400px;height:150px;z-index:16;' class='fwr-sig-layer1'><div  style='width:399px;height:2px;z-index:18; ' class='fwr-sig-Line'/><div style='position:absolute;top:60px;left: 40px;font-size: 18px' class='fwr-sig-font2 fwr-sig-layer-margin2'><div class='fwr-icons-sigtip fwr-sigtip-fail' style='margin-right: 15px;'></div>" + a + "</div><input type='submit' id='inksigfailbutton' data-i18n='[value]InkSign.OkButton' style='position:absolute;left:270px;top:110px; width:70px;' class='fwr-sig-button fwr-sig-normal-button'></div></div>";
                    L = !0, G.append(c), $("#inksigfailbutton").off("click").on("click", function() {
                        $("#" + M).hide(), G.hide()
                    })
                }
                $("#" + M).draggable(), $("#" + M).i18n(), $("#" + M).show(), G.show()
            }

            function f(a, f, g, h, i) {
                function j() {
                    var a = {};
                    apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getSignature ? a = apiConfig.signature.getSignature : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getSignature ? a = apiConfig.signature.getSignature() : console.error("apiConfig.signature.getSignature format error,mush object or function"), a = a ? a : {};
                    var b = {
                        params: {
                            imgData: h,
                            cert: i
                        }
                    };
                    return $.extend(!0, a, b), JSON.stringify(a)
                }

                function k() {
                    var a = {};
                    apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getContents ? a = apiConfig.signature.getContents : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getContents ? a = apiConfig.signature.getContents() : console.error("apiConfig.signature.getContents format error,mush object or function"), a = a ? a : {};
                    var b = {
                        params: {
                            cert: i,
                            filter: "Adobe.PPKLite",
                            subFilter: "adbe.pkcs7.sha1"
                        }
                    };
                    return $.extend(!0, a, b), JSON.stringify(a)
                }

                function l() {
                    var a = {};
                    return apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.exportSignedDocument ? a = apiConfig.signature.exportSignedDocument : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.exportSignedDocument ? a = apiConfig.signature.exportSignedDocument() : console.error("apiConfig.signature.exportSignedDocument format error,mush object or function"), a = a ? a : {}, JSON.stringify(a)
                }

                function m(a, b) {
                    c(), d(a, b), u.hide(), $(window).resize()
                }

                function n(b, d) {
                    c();
                    var f = WebPDF.ViewerInstance.getPluginByName(WebPDF.InkSignPluginName);
                    f.cancelSign(a), e(b, d)
                }
                var o = WebPDF.ViewerInstance.getPluginByName(WebPDF.InkSignPluginName),
                    p = o.getInkSignInfo(a, f, g),
                    q = {
                        properties: p,
                        information: j(),
                        contentParams: k(),
                        exportParams: l(),
                        success: m,
                        fail: n
                    };
                o.signWithCert(q), b()
            }

            function g() {
                if (!WebPDF.AccountInstance.getUserConfig()) return !1;
                C.getCurInkSignature(function() {
                    return D.getDefaultTemplate()
                }), w && (w = null), $("#inkSignArea").remove();
                var a = WebPDF.AccountInstance.getUserConfig().inkSignList,
                    b = '<div id="inkSignArea" class="fwr-inksign-panel">';
                b += "<ul>", b += "<li>", b += '<div class="inksign-box">', b += '<span class="fwr-icons-inksign-list inksign-add"></span>', b += "</div>", b += "</li>";
                for (var c = "", d = a.length - 1; d >= 0; d--) c += j(a[d]);
                b = b + c + "</ul></div>", u.html('<div class="fwr-Nav-panel-title">' + i18n.t("CommonLng.SettingList.Panel.InkSign") + '</div><a class="close-inksign"></a>'), u.append(b), v = $("#inkSignArea"), v.find("canvas").each(function(b) {
                    var c = a.length - 1 - b;
                    D.drawThumb(a[c], 135, 64)
                }), v.find("li:first").off("click").on("click", function() {
                    x.createInkSignBoard()
                }), v.off("click", ".inksign-del").on("click", ".inksign-del", function() {
                    var a = $(this).parents("li").data("inksignid"),
                        b = $(this);
                    return D.del(a, function() {
                        b.parents("li").remove(), x.resizeScrollbar()
                    }), !1
                }), v.off("click", "li:gt(0)").on("click", "li:gt(0)", function(a) {
                    var b = $(this),
                        c = b.data("inksignid"),
                        d = D.getDefaultTemplate();
                    (null == d || d.inkSignId != c) && D.setDefaultTemplate(c, function() {
                        b.addClass("selected").siblings("").removeClass("selected"), C.replace()
                    })
                }), v.off("click", ".inksign-select-cert").on("click", ".inksign-select-cert", function(a) {
                    var b = WebPDF.ViewerInstance.isLargeFile();
                    if (b) return !1;
                    v.find(".inksign-control").removeClass("show"), $(this).parent().addClass("show");
                    var c = w.getContentPositionY(),
                        d = $(this).parents(".inksign-box").parent().position().top + 24,
                        e = d - c,
                        f = 0;
                    f = w.getIsScrollableV() ? $(this).parents(".inksign-box").parent().width() + 70 : $(this).parents(".inksign-box").parent().width() + 35;
                    var g = $(this).parents(".inksign-box").parent().data("inksignid"),
                        i = D.getCertById(g);
                    $(".cert-panel").remove();
                    var j = h(i, g, f, e, d);
                    return $(".fwr-inksign-list").append(j), !1
                }), u.off("click", ".cert-panel li").on("click", ".cert-panel li", function() {
                    var a = $(this),
                        b = $(this).data(A);
                    "" == b && (b = "");
                    var c = $(this).parents(".cert-panel").data("orgid");
                    return D.updateCertById(b, c, function() {
                        var d = $("#inkSignArea li[data-inksignid=" + c + "]");
                        d.find(".inksign-control").removeClass("show"), "" != b ? d.find(".inksign-cert").get(0) || d.find(".inksign-box").append('<span class="fwr-icons-inksign-list inksign-cert"></span>') : d.find(".inksign-cert").remove(), a.parents(".cert-panel").remove()
                    }), !1
                }), u.off("click", ".close-inksign").on("click", ".close-inksign", function() {
                    WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND)
                }), k(), x.resizeScrollbar(), $(document).off("click").on("click", function() {
                    var a = $(".cert-panel");
                    a.get(0) && a.remove(), $(".inksign-control").removeClass("show")
                })
            }

            function h(a, b, c, d, e) {
                var f = '<div class="cert-panel" data-orgid="' + b + '" style="left:-' + c + "px;top:" + d + 'px;" data-oritop=' + e + "><ul>",
                    g = ' class="selected"';
                f += '<li data-cert="" ', "" == a && (f += g), f += ">" + i18n.t("InkSign.None") + "</li>";
                for (var h = Configs.InkSign.certs, i = 0; i < h.length; i++) f += "<li data-" + A + ' ="' + h[i].cert + '" ', a == h[i].cert && (f += g), f += " >" + h[i].title + "</li>";
                return f += '</ul><div class="sign-arrow"></div>'
            }

            function i(a) {
                var b = $(".cert-panel"),
                    c = parseInt(b.data("oritop")),
                    d = parseInt(b.css("top"));
                if (12 >= d && ($(".inksign-control").removeClass("show"), b.remove()), 0 == a) {
                    if (d == c) return !1;
                    b.css("top", c)
                } else d = c - a, b.css("top", d)
            }

            function j(a) {
                var b = "";
                b += '<li data-inksignid="' + a.inkSignId + '"', 1 == a.def && (b += ' class="selected"'), b += ">", b += '<div class="inksign-box">', b += '<canvas width="135" id="v' + a.inkSignId + '" height="64"></canvas>', "" != a.certType && (b += '<span class="fwr-icons-inksign-list inksign-cert"></span>');
                var c = WebPDF.ViewerInstance.isLargeFile();
                return b += '<div class="inksign-control">', b += '<span class="fwr-icons-inksign-list inksign-select-cert' + (c ? " disabled" : "") + '"></span>', b += '<span class="fwr-icons-inksign-list inksign-del"></span>', b += "</div>", b += "</div>", b += "</li>"
            }

            function k() {
                if (null == w) {
                    var a = {
                            showArrows: !1,
                            animateScroll: !1
                        },
                        b = "";
                    switch (WebPDF.optionParameters.scrollBarType) {
                        case WebPDF.PDFView.ScrollBarType.CUSTOM_SCROLL_BAR:
                            b = v.bind("jsp-scroll-y", function(a, b, c, d) {
                                i(b)
                            }).fwrJScrollPane(a);
                            break;
                        case WebPDF.PDFView.ScrollBarType.NATIVE_SCROLL_BAR:
                            b = v.WebPDFNativeScroll(a);
                            break;
                        default:
                            $.error("Unsupported type of scroll bar.")
                    }
                    return w = b.data("jsp")
                }
            }

            function l() {
                fwrInksignName = $(".fwr-inksign-name");
                var a = $("#" + E).width(),
                    b = fwrInksignName.width(),
                    c = (a - b) / 2 + 49;
                fwrInksignName.css("marginLeft", c), WebPDF.ViewerInstance.isLargeFile() ? $("#certType").addClass("hidden") : $("#certType").removeClass("hidden")
            }

            function m(a, b) {
                for (var c = "", d = Configs.InkSign.default_set[b], e = " selected", f = 0, g = 0; g < a.length; g++) f = g + 1, c += '<span class="fwr-inksign-icon ' + b + "-" + f, d == a[g] && (c += e), c += '" data-' + b + '="' + a[g] + '"></span>';
                return c
            }

            function n() {
                for (var a = '<option value="">' + i18n.t("InkSign.None") + "</option>", b = Configs.InkSign.certs, c = Configs.InkSign.default_set.cert, d = ' selected="selected"', e = 0; e < b.length; e++) a += '<option value="' + b[e].cert + '" ', c == b[e].cert && (a += d), a += ">" + b[e].title + "</option>";
                return a
            }

            function o(a, b, c) {
                $(".fwr-inksign-color span").off().click(function() {
                    return b = $(this).data(y), $(this).addClass("selected").siblings().removeClass("selected"), a.setColor(b), !1
                }), $(".fwr-inksign-size span").off().click(function() {
                    return c = $(this).data(z), $(this).addClass("selected").siblings().removeClass("selected"), a.setSize(c), !1
                }), $(".fwr-inksign-clean span").off().click(function() {
                    a.clearCanvas()
                }), $(".fwr-inksign-name .close,#inkSignBtnCancel").off().click(function() {
                    a.reset(), $(".fwr-inksign-name").hide(), WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND)
                }), $("#inkSignBtnOk").off().click(function() {
                    var b = a.getWriteData($("#certType").val());
                    return 0 == b.pencil.length ? (WebPDF.alert(null, i18n.t("InkSign.SigAlertTitle"), i18n.t("InkSign.CreateEmptyContent")), !1) : void(b = D.add(b, function() {
                        $("#inkSignArea li").removeClass("selected"), p(b, D), $(".fwr-inksign-name").hide(), x.resizeScrollbar(), a.reset()
                    }))
                })
            }

            function p(a, b) {
                var c = j(a);
                $("#inkSignArea ul li:eq(0)").after(c), b.drawThumb(a, 135, 64)
            }

            function q(a, b) {
                var c = "",
                    d = "";
                WebPDF.AccountInstance && (c = WebPDF.AccountInstance.getUserAccount(), d = WebPDF.AccountInstance.getUserId());
                var e = WebPDF.ViewerInstance.getFileName();
                e = e.split(".")[0] + "_signed.pdf";
                var f = {};
                apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getSignedDocument ? f = apiConfig.signature.getSignedDocument : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getSignedDocument ? f = apiConfig.signature.getSignedDocument() : console.error("apiConfig.signature.getSignedDocument format error,mush object or function"), f = f ? f : {};
                var g = {
                    params: {
                        userName: c,
                        userId: d,
                        file: b,
                        fileName: e
                    }
                };
                $.extend(!0, f, g);
                var h = "signature",
                    i = {
                        params: JSON.stringify(f),
                        type: h
                    };
                $.ajax({
                    url: a + "api/file/add",
                    type: "POST",
                    data: i,
                    async: !1,
                    success: function(c) {
                        var d = c.result;
                        if (null == d) return void alert(i18n.t("ParseError.ConvertFileFail") + b);
                        if ("LicenseInvalid" == d) return void alert(i18n.t("ParseError.LicenseInvalid"));
                        if ("LicenseExpired" == d) return void alert(i18n.t("ParseError.LicenseExpired"));
                        if ("OutOfFileSizeLimit" == d) return void alert(i18n.t("ParseError.OutOfFileSizeLimit"));
                        var e = a + d + "/view";
                        "undefined" != typeof viewTheme && "" != viewTheme && (e = e + "?theme=" + viewTheme), e = a + "asserts/" + d, WebPDF.ViewerInstance.openFile(e)
                    },
                    error: function() {
                        alert(i18n.t("ParseError.FailToOpen") + b)
                    }
                })
            }
            var r = WebPDF.optionParameters.serverBaseUrl,
                s = a("core/Plugins/InkSign/InkSignListManager"),
                t = a("core/Common/WriteCanvasTool"),
                u = $("#" + Configs.InkSignListId),
                v = $("#inkSignArea"),
                w = null,
                x = this,
                y = Configs.InkSign.data_title.color,
                z = Configs.InkSign.data_title.size,
                A = Configs.InkSign.data_title.cert,
                B = null,
                C = null,
                D = new s(r),
                E = WebPDF.Tool.getReaderApp().getMainFrameId(),
                F = "<div id='inkSignDlgLayer' style='width:100%;height:100%;top:0; left:0;z-index: 1060;position: absolute; display:none'></div>";
            $("body").append(F);
            var G = $("#inkSignDlgLayer");
            $(window).resize(function() {
                x.resizeScrollbar()
            }), this.getInkSignListMgr = function() {
                return null != D ? D : null
            }, this.resizeScrollbar = function() {
                var a = u.outerWidth(),
                    b = u.outerHeight();
                v.css({
                    width: a + "px",
                    height: b - 38 + "px"
                }), w && w.reinitialise()
            }, WebPDF.ViewerInstance.on(WebPDF.EventList.INKSIGN_INIT, function(a, b) {
                C = WebPDF.ViewerInstance.getPluginByName(WebPDF.InkSignPluginName), D.initList(), g()
            }).on(WebPDF.EventList.USER_CONFIG_CHANGED, function(a, b) {
                C = WebPDF.ViewerInstance.getPluginByName(WebPDF.InkSignPluginName), C && (D.initList(), g())
            }).on(WebPDF.EventList.INKSIGN_CREATEPANEL, function(a, b) {
                return u.is(":hidden") && (u.show(), $(window).resize(), x.resizeScrollbar()), null == D ? !1 : void(0 == D.getCount() && x.createInkSignBoard())
            }), WebPDF.ViewerInstance.on(WebPDF.EventList.INKSIGN_SIGN, function(a, b) {
                var c = b.inkSign.sigJSONData.inkData.certType,
                    d = null,
                    e = null,
                    g = b.canvasImgData;
                if ("" == c) {
                    var h = WebPDF.ViewerInstance.getPluginByName(WebPDF.InkSignPluginName);
                    h.sign(b.inkSign)
                } else f(b.inkSign, e, d, g, c)
            }), WebPDF.ViewerInstance.on(WebPDF.EventList.INKSIGN_TOOL_DEACTIVATE, function(a, b) {
                var c = $("#inkSignList"),
                    d = $(".fwr-inksign-name");
                c.get(0) && (c.hide(), $(window).resize()), d.get(0) && d.is(":visible") && d.hide()
            });
            var H = !1,
                I = "inkSigningDlg",
                J = !1,
                K = "inksigSuccessDlg",
                L = !1,
                M = "inksigFailDlg";
            this.createInkSignBoard = function() {
                var a = $(".fwr-inksign-name"),
                    b = Configs.InkSign.default_set.color,
                    c = Configs.InkSign.default_set.size,
                    d = null;
                if (a.get(0)) return a.is(":hidden") ? (a.show(), l(), d = $(".fwr-inksign-canvas canvas").get(0), null == B && (B = new t(d, b, c)), o(B, b, c), !1) : !1;
                var e = '<div class="fwr-modal-pop fwr-inksign-name"><span class="fwr-inksign-icon close"></span><div class="fwr-inksign-header"><h4>' + i18n.t("InkSign.CreateTitle") + '</h4></div><div class="fwr-inksign-tool"><div class="fwr-inksign-tool-box"><div class="fwr-inksign-color">' + m(Configs.InkSign.colors, y) + '</div><div class="fwr-inksign-size">' + m(Configs.InkSign.sizes, z) + '</div><div class="fwr-inksign-clean"><span class="fwr-inksign-icon"></span></div></div></div><div class="fwr-inksign-canvas"><canvas id="inksign_canvas" width="745" height="350"></canvas></div><div class="fwr-inksign-bottom"><div class="fwr-inksign-left"><div class="fwr-inksign-select"><select name="certType" id="certType">' + n() + '</select></div></div><div class="fwr-inksign-right"><div id="inkSignBtnOk" class="fwr-inksign-btn mr20">' + i18n.t("InkSign.OkButton") + '</div><div id="inkSignBtnCancel" class="fwr-inksign-btn">' + i18n.t("InkSign.CancelButton") + "</div></div></div></div>";
                $(".fwr-inksign-name").remove(), $("#frame").append(e), WebPDF.ViewerInstance.isLargeFile() && $("#certType").addClass("hidden"), l(), d = $(".fwr-inksign-canvas canvas").get(0), null == B && (B = new t(d, b, c)), o(B, b, c)
            }
        }
        d()
    }), define("core/Common/WriteCanvasTool", [], function(a, b, c) {
        function d(a, b, c) {
            var d = new e(a);
            d.clearCanvas();
            var f = b,
                g = c;
            this.setColor = function(a) {
                f = a
            }, this.setSize = function(a) {
                g = a
            }, this.reset = function() {
                d = new e(a), d.clearCanvas()
            }, this.clearCanvas = function() {
                null != d && d.clearCanvas()
            }, this.getWriteData = function(a) {
                if (null != d) {
                    var b = d.getWrites();
                    if (b.inkSignId) return b;
                    var c = new Date,
                        e = c.valueOf(),
                        f = Math.floor(e / 1e3).toString();
                    return b.def = 0, b.inkSignId = f, b.certType = a, b
                }
            };
            var h = !1;
            WebPDF.Environment.mobile ? ($(a).off("touchstart").on("touchstart", function(a) {
                h = !0, d.onMouseDown(a.originalEvent.touches[0], f, g)
            }), $(a).off("touchmove").on("touchmove", function(a) {
                h && d.onMouseMove(a.originalEvent.touches[0]), a.preventDefault(), a.stopPropagation()
            }), $(a).off("touchend").on("touchend", function(a) {
                h && (d.onMouseUp(), h = !1)
            })) : (a.onmousedown = function(a) {
                h = !0, d.onMouseDown(a, f, g)
            }, document.onmousemove = function(a) {
                h && ("inksign_canvas" !== a.target.id && (h = !1, d.onMouseUp()), d.onMouseMove(a))
            }, document.onmouseup = function(a) {
                h && (d.onMouseUp(), h = !1)
            })
        }

        function e(a) {
            var b = a,
                c = new Object;
            c.pencil = [], c.rect = [], c.per = 1;
            var d = null,
                e = [],
                f = b.getContext("2d"),
                g = 0,
                h = 0,
                i = 0,
                j = 0;
            this.getWrites = function() {
                return c
            }, this.onMouseDown = function(a, c, k) {
                d = new Object, d.color = c, d.width = k, e = [], f.strokeStyle = c, f.lineWidth = k;
                var l = $(b).offset(),
                    m = a.pageX - l.left,
                    n = a.pageY - l.top;
                if (f.beginPath(), !(0 > m || 0 > n || m > b.width || n > b.height)) {
                    f.moveTo(m, n);
                    var o = [];
                    return o[0] = m, o[1] = n, e.push(o), 0 == g && 0 == i && 0 == h && 0 == j ? (g = m, h = m, i = n, j = n) : (g > m && (g = m), m > h && (h = m), i > n && (i = n), n > j && (j = n)), !0
                }
            }, this.onMouseMove = function(a) {
                var c = a.pageX,
                    d = a.pageY,
                    k = $(b).offset(),
                    l = c - k.left,
                    m = d - k.top;
                0 > l && (l = 0), 0 > m && (m = 0), l > b.width && (l = b.width), m > b.height && (m = b.height), f.lineTo(l, m), f.stroke(), f.moveTo(l, m);
                var n = [];
                return n[0] = l, n[1] = m, e.push(n), g > l && (g = l), l > h && (h = l), i > m && (i = m), m > j && (j = m), !0
            }, this.onMouseUp = function() {
                return f.closePath(), d.points = e, d && d.points.length > 1 && (c.rect = [], c.rect.push(g), c.rect.push(i), c.rect.push(h), c.rect.push(j), c.pencil.push(d)), !0
            }, this.clearCanvas = function() {
                c.pencil = [], c.rect = [], g = 0, h = 0, i = 0, j = 0, f.clearRect(0, 0, b.width, b.height)
            }
        }
        return d
    }), define("core/Plugins/InkSign/MobileInkSign", ["core/Plugins/InkSign/InkSignListManager", "core/Common/WriteCanvasTool"], function(a, b, c) {
        function d() {
            function b() {
                t.openDrawInkSignPage()
            }

            function c(a) {
                a.stopPropagation(), a.preventDefault()
            }

            function d() {
                return WebPDF.ViewerInstance.getToolHandlerByName(WebPDF.Tools.TOOL_NAME_INKSIGN)
            }

            function e() {
                WebPDF.ViewerInstance.on(WebPDF.EventList.INKSIGN_INIT, function(a, b) {
                    o = WebPDF.ViewerInstance.getPluginByName(WebPDF.InkSignPluginName), p.initList(), u.initInkSignList()
                }).on(WebPDF.EventList.USER_CONFIG_CHANGED, function(a, b) {
                    o = WebPDF.ViewerInstance.getPluginByName(WebPDF.InkSignPluginName), o && (p.initList(), u.initInkSignList())
                }).on(WebPDF.EventList.INKSIGN_MOBILE_UPDATEUI, function(a, b) {
                    q.updateUI()
                }).on(WebPDF.EventList.INKSIGN_MOBILE_SELECTORADDINKSIGN, function(a, b) {
                    q.selectOrAddInkSign()
                }), WebPDF.ViewerInstance.on(WebPDF.EventList.INKSIGN_SIGN, function(a, b) {
                    function c(a, b) {
                        var c = {};
                        apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getSignature ? c = apiConfig.signature.getSignature : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getSignature ? c = apiConfig.signature.getSignature() : console.error("apiConfig.signature.getSignature format error,mush object or function"), c = c ? c : {};
                        var d = {
                            params: {
                                imgData: a,
                                cert: b
                            }
                        };
                        return $.extend(!0, c, d), JSON.stringify(c)
                    }

                    function d(a) {
                        var b = {};
                        apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getContents ? b = apiConfig.signature.getContents : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getContents ? b = apiConfig.signature.getContents() : console.error("apiConfig.signature.getContents format error,mush object or function"), b = b ? b : {};
                        var c = {
                            params: {
                                cert: a,
                                filter: "Adobe.PPKLite",
                                subFilter: "adbe.pkcs7.sha1"
                            }
                        };
                        return $.extend(!0, b, c), JSON.stringify(b)
                    }

                    function e() {
                        var a = {};
                        return apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.exportSignedDocument ? a = apiConfig.signature.exportSignedDocument : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.exportSignedDocument ? a = apiConfig.signature.exportSignedDocument() : console.error("apiConfig.signature.exportSignedDocument format error,mush object or function"), a = a ? a : {}, JSON.stringify(a)
                    }

                    function g(a, b) {
                        v.hideInkSignSigingDialog(), v.showSignScuessDialog(a, b)
                    }

                    function h(a, b) {
                        v.hideInkSignSigingDialog(), o.cancelSign(m), v.showSignfailDialog(a, b)
                    }
                    var i = b.inkSign.sigJSONData.inkData.certType,
                        j = null,
                        k = null,
                        l = b.canvasImgData;
                    if ("" == i) o.sign(b.inkSign);
                    else {
                        var m = b.inkSign,
                            n = o.getInkSignInfo(b.inkSign, k, j),
                            b = {
                                properties: n,
                                information: c(l, i),
                                contentParams: d(i),
                                exportParams: e(),
                                success: g,
                                fail: h
                            };
                        o.signWithCert(b), v.showInkSignSigingDialog()
                    }
                    f()
                })
            }

            function f() {
                $("#fwrm_btnInksign").removeClass("selected"), WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_HAND), q.updateUI()
            }

            function g(a) {
                var b = a.inkSignId,
                    c = a.certType,
                    d = a.def,
                    e = "";
                e += '<li data-inkSignId="' + b + '" data-cert="' + c + '"', 1 == d && (e += ' class="selected"'), e += ">", e += '<div class="inksign-box">', e += '<canvas  id="v' + b + '" ></canvas>', e += "" != c ? '<span class="inksign-cert"><svg><use xlink:href="#icon-cert-selected"></use></svg></span>' : '<span class="inksign-cert" style="display:none"><svg><use xlink:href="#icon-cert-selected"></use></svg></span>', e += "</div>", e += "</li>", $(".fwrm-area-inksign ul").prepend(e), p.drawThumb(a, w.width, w.height)
            }

            function h(a, b) {
                var c = "",
                    d = "";
                WebPDF.AccountInstance && (c = WebPDF.AccountInstance.getUserAccount(), d = WebPDF.AccountInstance.getUserId());
                var e = WebPDF.ViewerInstance.getFileName(),
                    f = {};
                apiConfig && apiConfig.signature && "object" == typeof apiConfig.signature.getSignedDocument ? f = apiConfig.signature.getSignedDocument : apiConfig && apiConfig.signature && "function" == typeof apiConfig.signature.getSignedDocument ? f = apiConfig.signature.getSignedDocument() : console.error("apiConfig.signature.getSignedDocument format error,mush object or function"), f = f ? f : {};
                var g = {
                    params: {
                        userName: c,
                        userId: d,
                        file: b,
                        fileName: e
                    }
                };
                $.extend(!0, f, g);
                var h = "signature",
                    i = {
                        params: JSON.stringify(f),
                        type: h
                    };
                $.ajax({
                    url: a + "api/file/add",
                    type: "POST",
                    data: i,
                    async: !1,
                    success: function(c) {
                        var d = c.result;
                        if (null == d) return void alert(i18n.t("ParseError.ConvertFileFail") + b);
                        if ("LicenseInvalid" == d) return void alert(i18n.t("ParseError.LicenseInvalid"));
                        if ("LicenseExpired" == d) return void alert(i18n.t("ParseError.LicenseExpired"));
                        if ("OutOfFileSizeLimit" == d) return void alert(i18n.t("ParseError.OutOfFileSizeLimit"));
                        var e = a + d + "/view";
                        "undefined" != typeof viewTheme && "" != viewTheme && (e = e + "?theme=" + viewTheme), e = a + "asserts/" + d, WebPDF.ViewerInstance.openFile(e)
                    },
                    error: function() {
                        alert(i18n.t("ParseError.FailToOpen") + b)
                    }
                })
            }

            function i() {
                function a() {
                    $(window).off("orientationchange").on("orientationchange", function(a) {
                        if (i && j) {
                            delete j, j = null;
                            var b = $(".fwrm-inksign-canvas");
                            $(".fwrm-inksign-canvas canvas").attr("width", b.width()).attr("height", b.height()), j = new n(i, e, f)
                        }
                    }), $("#ink-btn-cert").off("tap").on("tap", function(a) {
                        c(a), $("#ink-pop-cert").show()
                    }), $("#ink-pop-cert").off("tap").on("tap", function(a) {
                        c(a), $("#ink-pop-cert").hide()
                    }), $("#ink-pop-cert ul > li").off("tap").on("tap", function(a) {
                        c(a), $("#ink-pop-cert").hide()
                    }), $("#ink-btn-color").off("tap").on("tap", function(a) {
                        c(a), $("#ink-pop-color").show()
                    }), $("#ink-pop-color").off("tap").on("tap", function(a) {
                        c(a), $("#ink-pop-color").hide()
                    }), $(".fwrm-color-set").off("tap").on("tap", function(a) {
                        return c(a), !1
                    }), $("#ink-pop-cert-list li").off("tap").on("tap", function(a) {
                        return c(a), h = $(this).data("cert"), $("#ink-pop-cert-list li").children(".selected").removeClass("selected"), $($(this).children().get(1)).addClass("selected"), !1
                    }), $(".fwrm-ink-color span").off("tap").on("tap", function(a) {
                        return c(a), e = $(this).data("color"), j.setColor(e), $(this).addClass("selected").siblings().removeClass("selected"), !1
                    }), $(".fwrm-ink-size .ico-size").off("tap").on("tap", function(a) {
                        return c(a), f = $(this).data("size"), j.setSize(f), $(this).addClass("selected").siblings().removeClass("selected"), !1
                    }), $("#ink-btn-clean").off("tap").on("tap", function(a) {
                        c(a), j.clearCanvas()
                    }), $("#ink-btn-cancel").off("tap").on("tap", function(a) {
                        return c(a), j.clearCanvas(), d(), !1
                    }), $("#ink-btn-ok").off("tap").on("tap", function(a) {
                        if (c(a), !k) {
                            k = !0;
                            var b = j.getWriteData(h);
                            if (0 == b.pencil.length) return WebPDF.alert(null, i18n.t("InkSign.SigAlertTitle"), i18n.t("InkSign.CreateEmptyContent")), k = !1, !1;
                            b = p.add(b, function() {
                                $(".fwrm-inksign-list li").removeClass("selected"), g(b), d(), p.setDefaultTemplate(b.inkSignId, function() {
                                    WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_INKSIGN), o.replace()
                                }), k = !1
                            }, function() {
                                k = !1
                            }), b || (k = !1)
                        }
                    })
                }

                function b() {
                    for (var a = $(".fwrm-ink-color span").siblings(), b = $(".fwrm-ink-size span").siblings(), c = $("#ink-pop-cert-list li").siblings(), d = 0; 4 > d; d++) {
                        i18n.t("InkSign.None");
                        $(a[d]).attr("data-" + Configs.InkSign.data_title.color, Configs.InkSign.colors[d]), $(b[d]).attr("data-" + Configs.InkSign.data_title.size, Configs.InkSign.sizes[d]), $(c[d]).attr("data-" + Configs.InkSign.data_title.cert, Configs.InkSign.certs[d].cert), $(c[d]).children().get(0).innerText = Configs.InkSign.certs[d].title, Configs.InkSign.colors[d] == Configs.InkSign.default_set.color && $(a[d]).addClass("selected"), Configs.InkSign.sizes[d] == Configs.InkSign.default_set.size && $(b[d]).addClass("selected"), Configs.InkSign.certs[d].cert == Configs.InkSign.default_set.cert && $($(c[d]).children().get(1)).addClass("selected")
                    }
                }

                function d() {
                    $(".fwrm-creat-inksign").hide()
                }
                var e = Configs.InkSign.default_set.color,
                    f = Configs.InkSign.default_set.size,
                    h = "",
                    i = ($(".fwrm-inksign-canvas canvas"), null),
                    j = null,
                    k = !1;
                this.openDrawInkSignPage = function() {
                    $(".fwrm-creat-inksign").show();
                    var a = $(".fwrm-inksign-canvas");
                    return $(".fwrm-inksign-canvas canvas").attr("width", a.width()).attr("height", a.height()), i = $(".fwrm-inksign-canvas canvas").get(0), j ? void j.reset() : void(j = new n(i, e, f))
                }, b(), a()
            }

            function j() {
                function a() {
                    $("#inksign-btn-switch").off("tap").on("tap", function(a) {
                        c(a), f($(this).attr("class").indexOf("fwrm-inksign-switch-up") > 0 ? !0 : !1)
                    }), $(".inksign-add-box").off("tap").off("tap").on("tap", function(a) {
                        b()
                    }), $("#inksign-btnCert").live("tap", function(a) {
                        if (null != h) {
                            var b = $(h).data(Configs.InkSign.data_title.cert);
                            $("#inksign-list-cert-list li");
                            $("#inksign-list-cert-list li").each(function() {
                                var a = $(this);
                                a.data(Configs.InkSign.data_title.cert) === b && ($("#inksign-list-cert-list li").children().removeClass("selected"), $(a.children().get(1)).addClass("selected"))
                            }), $("#inksign-Menu").css({
                                visibility: "hidden"
                            }), $("#inksign-list-pop-cert").show()
                        }
                    }), $("#inksign-btnDel").live("tap", function(a) {
                        if (null != h) {
                            var b = $(h).data(Configs.InkSign.data_title.inksignid);
                            p.del(b), $("#inksign-Menu").css({
                                visibility: "hidden"
                            }), $(h).remove(), h = null
                        }
                    }), $("#inksign-area .inksign-box").live("click", function(a) {
                        WebPDF.ViewerInstance.setCurrentToolByName(WebPDF.Tools.TOOL_NAME_INKSIGN);
                        var b = $(this).parents("li").data(Configs.InkSign.data_title.inksignid),
                            c = p.getDefaultTemplate(),
                            d = this;
                        return c ? void(c && c.inkSignId != b && p.setDefaultTemplate(b, function() {
                            $(d).parents("li").addClass("selected").siblings("").removeClass("selected"), o.replace()
                        })) : void p.setDefaultTemplate(b, function() {
                            $(d).parents("li").addClass("selected").siblings("").removeClass("selected")
                        })
                    }), $("#inksign-area li").live("taphold", function(a) {
                        c(a), h = this;
                        var b = $(this).offset(),
                            e = $("#inksign-Menu"),
                            f = b.left + ($(this).width() - $(e).width()) / 2,
                            g = $(e).width() + 1,
                            i = $(window).width();
                        0 > f && (f = 0), f + g > i && (f = i - g);
                        var j = b.top - $(e).height();
                        $(e).css({
                            left: f,
                            top: j,
                            visibility: "visible"
                        }), d(e)
                    }), $("#inksign-list-pop-cert").off("tap").on("tap", function(a) {
                        a.stopPropagation(), a.preventDefault(), $("#inksign-list-pop-cert").hide()
                    }), $("#inksign-list-pop-cert ul > li").off("tap").on("tap", function(a) {
                        return c(a), $("#inksign-list-pop-cert li").children(".selected").removeClass("selected"), $($(this).children().get(1)).addClass("selected"), !1
                    }), $("#inksign-list-cert-ok").off("tap").on("tap", function(a) {
                        var b = $("#inksign-list-pop-cert li"),
                            c = "";
                        if (null != h && null != p) {
                            for (var d in b)
                                if ($(b[d]).find(".selected").length > 0) {
                                    c = $(b[d]).data(Configs.InkSign.data_title.cert);
                                    break
                                }
                            var e = $(h).data(Configs.InkSign.data_title.inksignid);
                            $(h).data(Configs.InkSign.data_title.cert, c), p.updateCertById(c, e), $("#ink-pop-cert").hide(), c == Configs.InkSign.certs[0].cert ? $(h).find(".inksign-cert").hide() : $(h).find(".inksign-cert").show()
                        }
                    })
                }

                function d(a) {
                    $(a).data("popup") || (a.wrap('<div class="fwrm-popup"></div>'), a.data("popup", "1")), $(".fwrm-popup").off("tap").on("tap", function(b) {
                        $(".fwrm-popup").css({
                            visibility: "hidden"
                        }), a.css({
                            visibility: "hidden"
                        })
                    }), $(".fwrm-popup").css({
                        visibility: "visible"
                    })
                }

                function e() {
                    for (var a = $("#inksign-list-cert-list li").siblings(), b = 0; 4 > b; b++) $(a[b]).attr("data-cert", Configs.InkSign.certs[b].cert), $(a[b]).children().get(0).innerText = Configs.InkSign.certs[b].title, Configs.InkSign.certs[b].cert == Configs.InkSign.default_set.cert && $($(a[b]).children().get(1)).addClass("selected")
                }

                function f(a) {
                    var b = $("#inksign-btn-switch");
                    a ? (b.removeClass("fwrm-inksign-switch-up"), b.addClass("fwrm-inksign-switch-down"), $("#" + s.ID_AREA).show()) : (b.removeClass("fwrm-inksign-switch-down"), b.addClass("fwrm-inksign-switch-up"), $("#" + s.ID_AREA).hide()), window.onresize()
                }
                var h = null;
                this.initInkSignList = function() {
                    var a = WebPDF.AccountInstance.getUserConfig().inkSignList;
                    o.getCurInkSignature(function() {
                        return p.getDefaultTemplate()
                    }), $("#inksign-area ul li").remove();
                    for (var b = a, c = 0; c < b.length; c++) g(b[c])
                }, this.showPanel = function(a) {
                    if (a) r.is(":hidden") && r.show(), f(!0);
                    else {
                        if (r.is(":hidden")) return;
                        r.hide(), window.onresize()
                    }
                }, e(), a()
            }

            function k() {
                var a = !1,
                    b = "inkSigningDlg";
                this.showInkSignSigingDialog = function() {
                    var c = null;
                    if (!a) {
                        var d = "<div id='" + b + "'class='fwrm-apply-signing'><img src='" + l + "images/ui/apply-signing.gif'></image></div>",
                            e = WebPDF.Tool.getReaderApp().getMainFrameId();
                        return $("#" + e).append(d), a = !0, c = $("#" + b), c.webPDFModal({
                            keyboard: !1,
                            backdrop: "static",
                            manager: "#" + e
                        }), !0
                    }
                    c = $("#" + b), c.webPDFModal("show")
                }, this.hideInkSignSigingDialog = function() {
                    var a = $("#" + b);
                    a.webPDFModal("hide")
                }, this.showSignScuessDialog = function(a, b) {
                    var c = '<span class="svg-sign-success"><svg><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#icon-ok"></use></svg></span>' + a,
                        d = i18n.t("Signature.View"),
                        e = i18n.t("Signature.OriginalFile"),
                        f = function(a) {
                            if (a) h(l, b);
                            else {
                                var c = WebPDF.ViewerInstance.getFileID(),
                                    d = l + "asserts/" + c;
                                WebPDF.ViewerInstance.openFile(d)
                            }
                            WebPDF.endConfirm()
                        };
                    WebPDF.confirm(null, i18n.t("InkSign.SigFinishTitle"), c, d, e, f)
                }, this.showSignfailDialog = function(a, b) {
                    var c = "<img src='" + l + "images/sig_fail.png' style='height: 17px;margin-right: 15px;'>" + a;
                    i18n.t("Signature.View"), i18n.t("Signature.OriginalFile");
                    WebPDF.alert(null, i18n.t("InkSign.SigAlertTitle"), c)
                }
            }
            var l = WebPDF.optionParameters.serverBaseUrl,
                m = a("core/Plugins/InkSign/InkSignListManager"),
                n = a("core/Common/WriteCanvasTool"),
                o = null,
                p = new m(l),
                q = this,
                r = $("#" + Configs.InkSignListId),
                s = {
                    ID_AREA: "inksign-area"
                };
            Configs.InkSign.certs.unshift({
                cert: "",
                title: i18n.t("InkSign.None")
            });
            var t = new i,
                u = new j,
                v = new k,
                w = {
                    width: 100,
                    height: 64
                };
            this.init = function() {
                e()
            }, this.updateUI = function() {
                var a = WebPDF.ViewerInstance.getCurToolHandlerName(),
                    b = d();
                return b && a == b.getName() ? void u.showPanel(!0) : (u.showPanel(!1), void $("#inksign-doc-menu").css({
                    visibility: "hidden"
                }))
            }, this.selectOrAddInkSign = function() {
                0 == p.getCount() && b(), q.updateUI()
            }
        }
        return d
    }), define("core/Framework/DocumentLoader", ["core/Framework/PDFDocument", "core/Framework/PDFPage", "core/Common/Math/Matrix", "core/WebPDF", "core/Plugins/Annot/Undo/AnnotUndoStack", "core/Plugins/DocProperties/PDFDocProperties", "core/Plugins/DocProperties/DocProperties"], function(a, b, c) {
        a("core/Framework/PDFDocument"), a("core/Plugins/DocProperties/PDFDocProperties"), WebPDF.DocumentLoader = function() {
            function a(a) {
                var b = null;
                try {
                    var c = a.ConnectedInfo && a.ConnectedInfo.isConnectedPDF ? parseInt(a.ConnectedInfo.isConnectedPDF) : 0,
                        d = a.ConnectedInfo ? a.ConnectedInfo.docId : null,
                        e = a.ConnectedInfo ? a.ConnectedInfo.versionId : null,
                        f = a.SecurityType ? a.SecurityType : 0;
                    b = new WebPDF.PDFDocument(parseInt(a.doctype), parseInt(a.DocPermission), c, d, e, f, a.SourceDocId);
                    for (var g = 0; g < a.PagesInfo.length; g++) {
                        var h = new WebPDF.PDFPage(a.PagesInfo[g]);
                        b.addPage(h)
                    }
                    if (a && a.dppinfo && a.dppinfo.ppt) {
                        var i = new WebPDF.DocProperties.PDFDocProperties(a.dppinfo.ppt);
                        b.setDocProperties(i)
                    } else b.setDocProperties(null)
                } catch (j) {
                    return console.error(j), null
                }
                return b
            }
            var b = !1;
            this.isDocumentLoaded = function() {
                return b
            }, this.asyncLoadDocument = function(c, d, e, f, g) {
                function h(d) {
                    if (!d.response) return void g(d.response);
                    var e = d.error;
                    if (0 === e) try {
                        var h = $.parseJSON(d.docInfo),
                            i = a(h);
                        i.loadWatermark(), c.setTrail(d.trail), d.xhr && c.setSessionId(d.xhr.getResponseHeader("x-auth-token")), f(i, d.response), b = !0
                    } catch (j) {
                        console.error(j), f(null, d.response)
                    } else d.pdfBffer && WebPDF.Tool.readerApp.setPDFbuffer(d.pdfBffer), g(d.response)
                }

                function i() {
                    g(null)
                }
                if (!$.isFunction(f) || !$.isFunction(g)) return void $.error("both 'doneHandler' and 'failedHandler' must be function.");
                var j = c.getOptions().url + "manifest";
                WebPDF.ConnectPdf && (j = c.getBaseUrl() + "cpdf/" + c.getFileID() + "/manifest");
                var k = {
                        language: c.getOptions().language
                    },
                    l = c.getPDFbuffer(),
                    m = c.getDataControl();
                d = "undefined" !== d && d ? WebPDF.Engine.JR ? window.atob(d) : d : "";
                var n = {
                        url: j,
                        buf: l,
                        pdfPassword: d,
                        requestData: k
                    },
                    o = {
                        type: "loadPDF",
                        data: n,
                        success: h,
                        error: i
                    };
                m.loadPDF(o)
            }
        }
    }), define("core/Framework/PDFDocument", ["core/Framework/PDFPage", "core/Common/Math/Matrix", "core/WebPDF", "core/Plugins/Annot/Undo/AnnotUndoStack"], function(require, exports, module) {
        require("core/Framework/PDFPage");
        var AnnotUndoStack = require("core/Plugins/Annot/Undo/AnnotUndoStack"),
            AnnotDataJsonFormat = {
                pageIndex: "number",
                annotations: "annots"
            };
        WebPDF.PDFDocument = function(docType, docPermission, isConnectedPDF, docId, versionId, securityType, sourceDocId) {
            function traverseTitles() {
                var a = [],
                    b = {};
                for (var c in currentDocumentAnnotMaps) {
                    var d = currentDocumentAnnotMaps[c];
                    void 0 == currentDocumentAnnotTitleMaps[d.title] ? (b[d.title] = !0, a.push(d.title)) : b[d.title] = currentDocumentAnnotTitleMaps[d.title]
                }
                currentDocumentAnnotTitleMaps = b, currentDocumentAnnotTitles = a
            }

            function save_file(a, b) {
                webpdfsaveAs(b, a)
            }

            function waitFormDataSuccess(a, b, c, d, e, f) {
                2 === a.getDocType() && WebPDF.FormPlugin && (c.formData = WebPDF.FormPlugin.getFormXML(!0));
                var g = {
                    type: "exportDocument",
                    data: c,
                    success: d,
                    error: e
                };
                b.exportDocument(g)
            }

            function getFormXML() {
                return WebPDF.FormPlugin.getFormXML(!0)
            }

            function createIFrame(a, b, c) {
                var d;
                $("#" + b) && $("#" + b).remove(), d = $('<iframe src="javascript:void(0);" name="' + a + '" id="' + b + '"></iframe>').appendTo("body").hide(), d.get(0).attachEvent ? d.get(0).attachEvent("onload", function(a) {
                    var b = d.get(0).contentWindow.document.body.innerHTML;
                    void 0 !== typeof c && null != c && c(b)
                }) : d.get(0).onload = function(a) {
                    var b = d.get(0).contentWindow.document.body.innerHTML;
                    void 0 !== typeof c && null != c && c(b)
                }
            }

            function transformAnnotData(a, b) {
                var c = a.getPDFPage();
                if (b.rc) {
                    var d = c.transRectWithPageMatrix(b.rc[0], b.rc[1], b.rc[2], b.rc[3]);
                    b.rc = [d.left, d.bottom, d.right, d.top]
                }
                if (b.ftcl)
                    for (var e = 0; e < b.ftcl.length; e += 2) {
                        var f = c.getPageMatrix().TransFormPoint(b.ftcl[e], b.ftcl[e + 1]);
                        b.ftcl[e] = f[0], b.ftcl[e + 1] = f[1]
                    }
                if (b.l)
                    for (var e = 0; e < b.l.length; e += 2) {
                        var f = c.getPageMatrix().TransFormPoint(b.l[e], b.l[e + 1]);
                        b.l[e] = f[0], b.l[e + 1] = f[1]
                    }
                if (b.ikl)
                    for (var e = 0; e < b.ikl.length; e++)
                        for (var g = b.ikl[e], h = 0; h < g.length; h += 2) {
                            var f = c.getPageMatrix().TransFormPoint(g[h], g[h + 1]);
                            g[h] = f[0], g[h + 1] = f[1]
                        }
                if (b.vts)
                    for (var e = 0; e < b.vts.length; e += 2) {
                        var f = c.getPageMatrix().TransFormPoint(b.vts[e], b.vts[e + 1]);
                        b.vts[e] = f[0], b.vts[e + 1] = f[1]
                    }
                b.rd
            }
            var _docType = docType,
                _docProperties = null,
                _docPermission = docPermission,
                _isConnectedPDF = isConnectedPDF,
                _docId = docId,
                _versionId = versionId,
                _pdfPages = [],
                _watermarkInfo = null,
                _userWatermarkInfo = null,
                _securityType = securityType,
                _trailWatermarkInfo = null,
                _isTrialWaterMark = !0,
                _sourceDocId = sourceDocId,
                _isAllAnnotsLoaded = !1,
                _isUserAnnotLoaded = !1,
                _isCReview = !1;
            _readerApp = WebPDF.Tool.getReaderApp();
            var _formWidgets = [],
                _signatrueMap = {},
                _inkSignMap = {},
                _self = this,
                _offLineBuffer = null,
                _annotUndoStack = new AnnotUndoStack,
                _annotContentEditUndoStack = new AnnotUndoStack,
                currentDocumentAnnotTitles = [],
                currentDocumentAnnotTitleMaps = {},
                currentDocumentAnnotMaps = {};
            WebPDF.ViewerInstance.on(WebPDF.EventList.ANNOT_ADDED, function(a, b) {
                var c = [];
                b.annot ? c[0] = b.annot : b.annotsArr ? c = b.annotsArr : (console.error("invalid annot data"), console.error(b));
                for (var d = 0; d < c.length; d++) void 0 == currentDocumentAnnotTitleMaps[c[d].title] && (currentDocumentAnnotTitleMaps[c[d].title] = !0), currentDocumentAnnotMaps[c[d].annotName] = c[d]
            }).on(WebPDF.EventList.ANNOT_DELETED, function(a, b) {
                delete currentDocumentAnnotMaps[b.annotName]
            }), this.updatePDFAnnotTitleStatus = function(a, b) {
                b ? currentDocumentAnnotTitleMaps[b] = a : $.each(currentDocumentAnnotTitleMaps, function(b, c) {
                    currentDocumentAnnotTitleMaps[b] = a
                })
            }, this.getPDFAnnotTitles = function() {
                return traverseTitles(), currentDocumentAnnotTitles
            }, this.getPDFAnnotTitleMaps = function() {
                return traverseTitles(), currentDocumentAnnotTitleMaps
            }, this.addAnnotUndo = function(a) {
                _annotUndoStack.add(a)
            }, this.addAnnotContentEditUndo = function(a) {
                _annotContentEditUndoStack.add(a)
            }, this.clearAnnotContentEditUndo = function() {
                _annotContentEditUndoStack.clear()
            }, this.clearAnnotUndo = function() {
                _annotContentEditUndoStack.clear(), _annotUndoStack.clear()
            }, this.getAnnotUndo = function(a) {
                if (a) {
                    var b = _annotContentEditUndoStack.undo();
                    return !b && _annotContentEditUndoStack.getSize() > 0 ? b : b ? b : _annotUndoStack.undo()
                }
                var c = _annotContentEditUndoStack.redo();
                return c ? c : _annotUndoStack.redo()
            }, this.getDocId = function() {
                return _docId
            }, this.getVersionId = function() {
                return _versionId
            }, this.getSourceDocId = function() {
                return _sourceDocId
            };
            var defaultWmkConfigs = {
                add: !0,
                content: "",
                fontSize: 12,
                fontFamily: '"Segoe UI", sans-serif',
                fontWeight: "normal",
                fontStyle: !1,
                rotation: 0,
                color: 11259615,
                scale: 1,
                opacity: .75,
                isDynamic: !1,
                userName: !1,
                ip: !1,
                openTime: !1
            };
            this.hasPermission = function(a) {
                return 0 == (_docPermission & a) ? !1 : !0
            }, this.isConnectedPDF = function() {
                return _isConnectedPDF
            }, this.getSecurityType = function() {
                return _securityType
            }, this.addFormWidget = function(a) {
                var b = jQuery.inArray(a, _formWidgets);
                if (!(b >= 0)) {
                    var c = _formWidgets.length;
                    _formWidgets[c] = a
                }
            }, this.saveCPDFFile = function(a, b, c) {
                _readerApp.getFileBuffer(b, !0, function(d) {
                    var e = d,
                        f = d.length;
                    if (f > 1048576 && (e = d.subarray(f - 1048576, f)), !_isConnectedPDF) {
                        var g = WebPDF.Common.sha256(e);
                        b || (b = Math.random()), _readerApp.storeDigestId(b, g);
                        var h = {
                            uuid: b,
                            cDocId: c
                        };
                        WebPDF.ViewerInstance.fire("docChange", h)
                    }
                    var i = new Blob([d], {
                        type: "application/pdf"
                    });
                    save_file(a, i)
                })
            }, this.exportDocumentToRemote = function(pushUrl, heads, params, language) {
                function successLoad(data) {
                    var result = eval("(" + data + ")");
                    alert(i18n.t(result.message))
                }

                function errorLoad() {
                    WebPDF.closeDownloading()
                }
                var readerApp = WebPDF.Tool.getReaderApp(),
                    exportURL = readerApp.getOptions().url + "exportToRemote?accessToken=" + WebPDF.AccountInstance.getAccessToken(),
                    annotPlugin = readerApp.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    annots = [];
                annotPlugin && (annots = annotPlugin.getAnnotationDataToSave());
                var annotData = JSON.stringify(annots),
                    inkSignPlugin = readerApp.getPluginByName(WebPDF.InkSignPluginName),
                    inkSignData = "";
                inkSignPlugin && (inkSignData = inkSignPlugin.getInkSignData());
                var wmInfo = this.getAllDisaplyWateramrkInfo(),
                    formData = null,
                    dataControl = readerApp.getDataControl(),
                    data = {
                        url: exportURL,
                        annotData: annotData,
                        formData: formData,
                        pushUrl: pushUrl,
                        inkSignData: inkSignData,
                        wmInfo: wmInfo,
                        fileName: readerApp.getFileName(),
                        pDFDocument: this,
                        language: language,
                        heads: heads,
                        params: params
                    };
                waitFormDataSuccess(this, dataControl, data, successLoad, errorLoad)
            }, this.exportDocument = function(a, b, c, d, e, f, g) {
                function h(a) {
                    if (c) {
                        if (a.indexOf('"result":"0"') > 0 && $.isFunction(e)) return void e("export document success");
                        a.indexOf('"result":"-1"') > 0 && $.isFunction(f) && (f("export document fail"), $.error("export document fail,the result:" + a))
                    } else if (WebPDF.Engine.JR && WebPDF.closeDownloading(), 0 === a.error)
                        if (g && g.bToStream) $.isFunction(g.recieve) && g.recieve(new Uint8Array(a.docmentContent));
                        else {
                            "" === a.fileName && "Untitled.pdf" == a.fileName;
                            var b = new Blob([a.docmentContent], {
                                type: "application/pdf"
                            });
                            save_file(a.fileName, b)
                        }
                    else console.error("export document error:" + a.error)
                }

                function i() {
                    c ? $.isFunction(f) && f() : WebPDF.closeDownloading()
                }
                var j = WebPDF.Tool.getReaderApp(),
                    k = "";
                k = c ? j.getOptions().url + "export" : j.getOptions().url + "exportDocument?accessToken=" + WebPDF.AccountInstance.getAccessToken();
                var l = j.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    m = [];
                l && (m = l.getAnnotationDataToSave());
                var n = JSON.stringify(m),
                    o = j.getPluginByName(WebPDF.InkSignPluginName),
                    p = "";
                o && (p = o.getInkSignData());
                var q = this.getAllDisaplyWateramrkInfo(),
                    r = null,
                    s = j.getDataControl(),
                    t = 0,
                    u = a ? a : j.getFileName(),
                    v = {
                        url: k,
                        annotData: n,
                        formData: r,
                        inkSignData: p,
                        wmInfo: q,
                        fileName: u,
                        pDFDocument: this,
                        language: b,
                        params: d
                    };
                waitFormDataSuccess(this, s, v, h, i, t)
            }, this.exportFormXML = function(a, b, c, d, e) {
                function f(a) {
                    if (b) {
                        if (a.indexOf('"result":"0"') > 0 && $.isFunction(d)) return void d("export form xml success");
                        if (a.indexOf('"result":"-1"') > 0 && $.isFunction(e)) return e("export form xml fail"), void $.error("export form xml fail,the result:" + a)
                    } else {
                        if (WebPDF.closeDownloading(), null == a.originalXML) return void g();
                        var c = getFormXML(),
                            f = a.originalXML,
                            h = WebPDF.Common.joinFromXML(c, f);
                        "" == a.fileName && (a.fileName = "Untitled.pdf");
                        var i = new Blob([h], {
                            type: "text/xml"
                        });
                        save_file(a.fileName.substring(0, a.fileName.lastIndexOf(".")) + ".xml", i)
                    }
                }

                function g() {
                    WebPDF.closeDownloading(), $.isFunction(e) && e("export Form XML error"), console.error("export Form XML error")
                }
                var h = WebPDF.Tool.getReaderApp(),
                    i = "",
                    j = getFormXML(),
                    k = h.getDataControl();
                null == a && (a = h.getFileName()), i = b ? h.getOptions().url + "form/xml/remote/exportXml?accessToken=" + WebPDF.AccountInstance.getAccessToken() : h.getOptions().url + "form/xml/exportXml?accessToken=" + WebPDF.AccountInstance.getAccessToken();
                var l = {
                        url: i,
                        fileName: a,
                        pDFDocument: this,
                        xmlData: j,
                        params: c,
                        isExportRomete: b
                    },
                    m = {
                        type: "exportFormXML",
                        data: l,
                        success: f,
                        error: g
                    };
                k.exportFormXML(m)
            }, this.importFormXML = function(a) {
                var b = $(a).find("fields");
                return null == b || void 0 === b ? void alert("The import file form is error.") : void WebPDF.g_pFormPlugin.setFormDataByXMLData(b)
            }, this.getFormXMLData = function() {
                return getFormXML()
            }, this.exportToFDF = function() {
                function a() {
                    WebPDF.closeDownloading()
                }

                function b(a) {
                    if (WebPDF.closeDownloading(), null == a.fdfStream) return void WebPDF.alert(null, null, i18n.t("PCLng.ToolBar.ExportFile.FDFFailed"));
                    "" == a.fileName && (a.fileName = "Untitled.fdf");
                    var b = new Blob([a.fdfStream], {
                        type: "text/fdf"
                    });
                    save_file(a.fileName.substring(0, a.fileName.lastIndexOf(".")) + ".fdf", b)
                }
                var c = WebPDF.Tool.getReaderApp(),
                    d = c.getDataControl(),
                    e = c.getOptions().url + "exportToFDF?accessToken=" + WebPDF.AccountInstance.getAccessToken(),
                    f = c.getFileName(),
                    g = c.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotationDataToSave(),
                    h = JSON.stringify(g),
                    i = {
                        exportFDFURL: e,
                        fileName: f,
                        pDFDocument: this,
                        annotData: h,
                        readerApp: c
                    },
                    j = {
                        type: "exportFDF",
                        data: i,
                        success: b,
                        error: a
                    };
                d.exportFDF(j)
            }, this.importAnnotsFromFDF = function(a) {
                function b(a) {
                    if (a && 0 == a.error) {
                        var b = $.parseJSON(a.data);
                        _self.importAnnotsFromJsonData(b.annotsArr)
                    } else WebPDF.alert(null, null, i18n.t("PCLng.ToolBar.ImportFile.FDFFailed"));
                    WebPDF.closeWaiting()
                }
                WebPDF.ViewerInstance.loadDataControl(WebPDF.Engine.JR);
                var c = WebPDF.ViewerInstance.getDataControl(),
                    d = null;
                if (WebPDF.Engine.JR) {
                    if ("fileUrl" == a.type) {
                        var e = new XMLHttpRequest;
                        e.open("GET", a.fileUrl, !0), e.responseType = "arraybuffer", e.send(), e.onload = function(b) {
                            var c = new Uint8Array(this.response);
                            a.fileBuffer = c
                        }
                    }
                    d = {
                        type: "getAnnotsDataFromFDF",
                        fileBuffer: a.fileBuffer,
                        success: b
                    }
                } else {
                    var f = WebPDF.Tool.getReaderApp().getBaseUrl() + "asserts/getAnnotsDataFromFDF";
                    d = {
                        url: f,
                        paramType: a.type,
                        fileUrl: a.fileUrl,
                        fileBuffer: a.fileBuffer,
                        success: b
                    }
                }
                c.getAnnotsDataFromFDF(d)
            }, this.importAnnotsFromJsonData = function(a) {
                if (a) {
                    a.length > 0 && _readerApp.clearAnnotUndo();
                    for (var b = 0; b < a.length; b++) {
                        var c = a[b],
                            d = c[AnnotDataJsonFormat.pageIndex],
                            e = this.getPage(d);
                        if (e)
                            for (var f = c[AnnotDataJsonFormat.annotations], g = 0; g < f.length; g++) {
                                var h = f[g],
                                    i = _readerApp.getMainView().getDocView().getPageView(d);
                                transformAnnotData(i, h);
                                var j = !1;
                                if ("StrikeOutTextEdit" == h.it) {
                                    var k = i.getPDFPage().getAnnotByName(h.irt);
                                    k.setGrp(h.n), j = !0
                                }
                                i.isAnnotExist(h.n) ? i.updateAnnot(h, h.n) : i.importAnnotFromJsonData(h, !1, !0, e.isAnnotLoaded(), j)
                            }
                    }
                }
            }, this.exportToXFDF = function(a, b) {
                function c(c) {
                    var h = _self.getPage(c);
                    if (h && (h.enumAnnots(function(a) {
                            if (!a.isAnnotDel()) {
                                var b = a.getSubType();
                                if (h.isSupportedXFDFType(a)) {
                                    var e = d.createElement(b.toLowerCase());
                                    f.appendChild(e), e.setAttribute("page", c), a.exportPropertyToXFDF(d, e)
                                }
                            }
                        }), c == g - 1)) {
                        var i = _readerApp.getFileName();
                        if (i) {
                            var j = d.createElement("f");
                            e.appendChild(j), j.setAttribute("href", i)
                        }
                        if (_sourceDocId) {
                            var k = $.parseJSON(_sourceDocId),
                                l = d.createElement("ids");
                            e.appendChild(l), l.setAttribute("original", k.original), l.setAttribute("modified", k.original)
                        }
                        var m = "";
                        m = document.implementation && document.implementation.createDocument ? (new XMLSerializer).serializeToString(d) : d.xml, (WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11) && (m = m.replace(new RegExp("NS\\d:", "g"), ""), m = m.replace(new RegExp('xmlns:NS\\d=""', "g"), "")), WebPDF.Environment.gecko === !0 && (m = m.replace(new RegExp(' xmlns=""', "g"), "")), m = '<?xml version="1.0" encoding="UTF-8"?>' + m;
                        var n = new Blob([m], {
                            type: "text/xfdf"
                        });
                        if (a) {
                            var o = new FileReader;
                            o.readAsArrayBuffer(n), o.onload = function(a) {
                                var c = new Uint8Array(o.result);
                                b(c)
                            }
                        } else {
                            var p = i.lastIndexOf(".");
                            i = i.substr(0, p), i += ".xfdf", save_file(i, n)
                        }
                    }
                }
                var d = null;
                d = document.implementation && document.implementation.createDocument ? document.implementation.createDocument("", "", null) : new ActiveXObject("Microsoft.XMLDOM");
                var e = null;
                WebPDF.Environment.gecko === !0 ? e = d.createElementNS("http://ns.adobe.com/xfdf/", "xfdf") : (e = d.createElement("xfdf"), e.setAttribute("xmlns", "http://ns.adobe.com/xfdf/")), d.appendChild(e), WebPDF.Environment.ie || WebPDF.Environment.ieAtLeast11 || e.setAttribute("xml:space", "preserve");
                var f = d.createElement("annots");
                e.appendChild(f);
                for (var g = _pdfPages.length, h = 0; h < _pdfPages.length; h++) c(h)
            }, this.importAnnotsFromXFDFBuffer = function(a) {
                var b = String.utf8ArrayToString(a),
                    c = $.parseXML(b);
                "xfdf" != c.documentElement.tagName && console.error("error!");
                var d = c.documentElement.getElementsByTagName("annots");
                d.length > 0 && _readerApp.clearAnnotUndo();
                for (var e = 0; e < d.length; e++)
                    for (var f = d[e], g = 0; g < f.childNodes.length; g++) {
                        var h = f.childNodes[g];
                        if (1 == h.nodeType) {
                            var i = parseInt(h.getAttribute("page")),
                                j = _readerApp.getMainView().getDocView().getPageView(i);
                            j && j.importAnnotFromXFDF(h, WebPDF.AccountInstance.getUserAccount(), !1, !1)
                        }
                    }
            }, this.exportPdf = function(a, b, c, d, e, f, g, h, i, j, k) {
                function l(a, b, c, d, e, f, g, h, i, k) {
                    var l = "iframe_download_pdf_data",
                        m = l;
                    createIFrame(l, m, k);
                    var n = _self.getDocProperties(),
                        o = n._docPropertiesJSONData;
                    o = JSON.stringify(o);
                    var p = {
                            heads: j,
                            params: JSON.stringify(i),
                            language: h,
                            watermarkInfo: g,
                            inkData: f,
                            formData: e,
                            annotsData: d,
                            fileName: c,
                            metaData: o
                        },
                        q = $("<form>").attr({
                            target: m,
                            action: a,
                            method: b
                        });
                    for (var r in p) {
                        var s = $("<input>");
                        s.attr({
                            type: "hidden",
                            id: r,
                            name: r
                        }).val(p[r]), q.append(s)
                    }
                    $("body").append(q), q.submit().remove()
                }
                a && (WebPDF.ConnectPdf && !WebPDF.ConnectPdf.isConnectedPDF() ? WebPDF.ConnectPdf.convertTocPdf(function(a, d) {
                    if (!d) return void WebPDF.ConnectPdf.failConvertCpdf_callback();
                    var e = a + "asserts/" + d + "/exportDocument?accessToken=" + WebPDF.AccountInstance.getAccessToken();
                    l(e, b, c, null, null, null, g, h)
                }, k, WebPDF.ConnectPdf.failConvertCpdf_callback) : l(a, b, c, d, e, f, g, h, k, i))
            }, this.downloadAnnotFDFbyForm = function(a, b, c, d, e) {
                if ("undefined" != typeof a && null !== a) {
                    var f = "iframe_download_annot_data",
                        g = f;
                    createIFrame(f, g, e);
                    var h = g,
                        i = "iframe_download_annot_data_formobj";
                    $("#" + i) && $("#" + i).remove();
                    var j = $('<form target="' + h + '"></form>').attr("action", a).attr("id", i).attr("method", b);
                    j.append($("<input type='hidden' id='fileName' name='fileName' />").val(c)), j.append($("<input type='hidden' id='annotsData' name='annotsData' />").val(d)), $("body").append(j), j.submit(), e()
                }
            }, this.exportFormXml = function(a, b, c, d, e) {
                if ("undefined" != typeof a && null !== a) {
                    var f = "iframe_download_form_xml_data",
                        g = f;
                    createIFrame(f, g, e);
                    var h = g,
                        i = "iframe_download_form_xml_data_formObj";
                    $("#" + i) && $("#" + i).remove();
                    var j = $('<form target="' + h + '"></form>').attr("action", a).attr("id", i).attr("method", b);
                    j.append($("<input type='hidden' id='fileName' name='fileName' />").val(c)), j.append($("<input type='hidden' id='formXmlData' name='formXmlData' />").val(d)), $("body").append(j), j.submit()
                }
            }, this.exportFormXmlToRemote = function(a, b, c, d, e, f) {
                if ("undefined" != typeof a && null !== a) {
                    var g = "iframe_download_form_xml_data_remote",
                        h = g;
                    createIFrame(g, h, f);
                    var i = h,
                        j = "iframe_download_form_xml_data_remote_formObj";
                    $("#" + j) && $("#" + j).remove();
                    var k = $('<form target="' + i + '"></form>').attr("action", a).attr("id", j).attr("method", b);
                    k.append($("<input type='hidden' id='fileName' name='fileName' />").val(c)), k.append($("<input type='hidden' id='params' name='params' />").val(d)), k.append($("<input type='hidden' id='formXmlData' name='formXmlData' />").val(e)), $("body").append(k), k.submit()
                }
            }, this.getPageCount = function() {
                return _pdfPages.length
            }, this.getPage = function(a) {
                return isNaN(a) ? null : _pdfPages[a]
            }, this.setDocType = function(a) {
                _docType = a
            }, this.getDocType = function() {
                return _docType
            }, this.setDocProperties = function(a) {
                _docProperties = a
            }, this.getDocProperties = function() {
                return _docProperties
            }, this.addPage = function(a) {
                _pdfPages.push(a)
            }, this.deletePage = function(a) {
                return isNaN(a) || a > _pdfPages.length || 0 > a ? !1 : (delete _pdfPages[a], _pdfPages.splice(a, 1), !0)
            }, this.loadWatermark = function() {
                var a = WebPDF.Tool.getReaderApp();
                if (!a.isOffline()) {
                    var b = a.getOptions().baseUrl + "api/watermark/info",
                        c = {
                            userId: a.getIP()
                        };
                   /* $.ajax({
                         url: b + "?" + Math.random(),
                        type: "GET",
                         data: c,
                         async: !1,
                         timeout: 500,
                         success: function(a) {
                             if (0 == a.resultCode) {
                                 var b = a.resultBody.hasWaterMark;
                                 _isTrialWaterMark = null == b || "0" == b ? !1 : !0;
                                 var c = $.parseJSON(a.resultBody.content);
                                 c.globalWatermark && (_watermarkInfo = $.parseJSON(c.globalWatermark), _watermarkInfo.color = parseInt(_watermarkInfo.color, 16)), c.userWatermark && (_userWatermarkInfo = $.parseJSON(c.userWatermark))
                             }
                         },
                        error: function() {
                             alert("Fail to load watermark")
                         }
                     }),_userWatermarkInfo = WebPDF.AccountInstance.getWatermarkInfo()*/
                    var a = {"resultCode":"0","resultMsg":"","resultBody":{"content":"{\"userWatermark\":\"\",\"globalWatermark\":\"{\\\"add\\\":false,\\\"content\\\":\\\"test watermark\\\",\\\"fontSize\\\":20,\\\"fontFamily\\\":\\\"Segoe UI, sans-serif\\\",\\\"fontWeight\\\":\\\"normal\\\",\\\"fontStyle\\\":false,\\\"rotation\\\":0,\\\"color\\\":\\\"abcedf\\\",\\\"scale\\\":1,\\\"opacity\\\":1,\\\"isFixed\\\":\\\"true\\\",\\\"isDynamic\\\":false,\\\"userName\\\":false,\\\"ip\\\":false,\\\"openTime\\\":false,\\\"transparency\\\":100}\"}","hasWaterMark":"0"}};
                     if (0 == a.resultCode) {
                        var b = a.resultBody.hasWaterMark;
                        _isTrialWaterMark = null == b || "0" == b ? !1 : !0;
                        var c = $.parseJSON(a.resultBody.content);
                        c.globalWatermark && (_watermarkInfo = $.parseJSON(c.globalWatermark), _watermarkInfo.color = parseInt(_watermarkInfo.color, 16)), c.userWatermark && (_userWatermarkInfo = $.parseJSON(c.userWatermark))
                    }
                    _userWatermarkInfo = WebPDF.AccountInstance.getWatermarkInfo();
                }
            }, this.getWatermarkInfo = function() {
                return _watermarkInfo
            }, this.getUserWatermarkInfo = function() {
                return _userWatermarkInfo
            }, this.getTrailWatermarkInfo = function() {
                if (null == _trailWatermarkInfo) {
                    var a = {
                        add: !0,
                        content: "<nobr>Foxit WebPDF Viewer Trial</nobr><br><nobr>Please contact at: sales@foxitsoftware.com</nobr>",
                        fontFamily: "Helvetica, sans-serif",
                        rotation: -45,
                        color: 16711680,
                        opacity: .5
                    };
                    _trailWatermarkInfo = $.extend(defaultWmkConfigs, a)
                }
                return _trailWatermarkInfo
            }, this.getAllDisaplyWateramrkInfo = function() {
                function getWMDynamicInfo(a) {
                    var b = a.content,
                        c = WebPDF.Tool.getReaderApp(),
                        d = !1;
                    if (a.isDynamic) {
                        if (b = "", a.userName) {
                            var e = null;
                            WebPDF.AccountInstance && (e = WebPDF.AccountInstance.getUserAccount()), b += e, d = !0
                        }
                        a.ip && (d && (b += "\r"), b += c.getIP()), a.openTime && (d && (b += "\r"), b += c.getDocView().getOpenTime())
                    }
                    return b
                }

                function getPDFFontFamily(a) {
                    switch (a.fontFamily) {
                        case "'Arial Black', Gadget, sans-serif":
                            return "Arial Black";
                        case "'Arial Narrow', sans-serif":
                            return "Arial";
                        case "'Bookman Old Style', serif":
                            return "Bookman Old Style";
                        case "'Comic Sans MS', cursive":
                            return "Comic Sans MS";
                        case "Courier, monospace":
                            return "Courier";
                        case "'Courier New', Courier, monospace":
                            return "Courier New";
                        case "Garamond, serif":
                            return "Garamond";
                        case "Georgia, serif":
                            return "Georgia";
                        case "Impact, Charcoal, sans-serif":
                            return "Impact";
                        case "'Lucida Console', Monaco, monospace":
                            return "Lucida";
                        case "'Lucida Sans Unicode', 'Lucida Grande', sans-serif":
                            return "Lucida Sans Unicode";
                        case "'MS Sans Serif', Geneva, sans-serif":
                            return "MS Sans Serif";
                        case "'MS Serif', 'New York', sans-serif":
                            return "MS Serif";
                        case "'Palatino Linotype', 'Book Antiqua', Palatino, serif":
                            return "Palatino Linotype";
                        case "'Segoe UI', sans-serif":
                            return "Segoe UI";
                        case "Symbol, sans-serif":
                            return "Symbol";
                        case "Tahoma, Geneva, sans-serif":
                            return "Tahoma";
                        case "'Times New Roman', Times, serif":
                            return "Times New Roman";
                        case "'Trebuchet MS', Helvetica, sans-serif":
                            return "Trebuchet MS";
                        case "Verdana, Geneva, sans-serif":
                            return "Verdana";
                        default:
                            return "Helvetica"
                    }
                }
                var wmInfo = [],
                    waterMark, pageCount = this.getPageCount(),
                    pageRange = [0, pageCount],
                    readerApp = WebPDF.Tool.getReaderApp(),
                    pixelsPerPoint = readerApp.getPixelsPerPoint();
                if (_isTrialWaterMark) {
                    waterMark = $.extend({}, this.getTrailWatermarkInfo()), waterMark.content = waterMark.content.replace(/\<nobr\>/g, "").replace(/\<\/nobr>/g, "").replace(/\<br\>/g, "\r"), waterMark.fontFamily = getPDFFontFamily(waterMark);
                    var scale = readerApp.getDocView().getScale();
                    isNaN(scale) && (scale = 1), waterMark.fontSize = waterMark.fontSize / pixelsPerPoint / scale, waterMark.rotation = -1 * waterMark.rotation, waterMark.pageRange = pageRange, wmInfo.push(waterMark)
                }
                null != _userWatermarkInfo && _userWatermarkInfo.add === !0 && (waterMark = $.extend({}, _userWatermarkInfo), waterMark.content = getWMDynamicInfo(waterMark), waterMark.fontFamily = getPDFFontFamily(waterMark), waterMark.fontSize = waterMark.fontSize / pixelsPerPoint, waterMark.rotation = -1 * waterMark.rotation, waterMark.pageRange = pageRange, wmInfo.push(waterMark)), null != _watermarkInfo && _watermarkInfo.add === !0 && (waterMark = $.extend({}, _watermarkInfo), waterMark.content = getWMDynamicInfo(waterMark), waterMark.fontFamily = getPDFFontFamily(waterMark), waterMark.fontSize = waterMark.fontSize / pixelsPerPoint, waterMark.rotation = -1 * waterMark.rotation, waterMark.pageRange = pageRange, wmInfo.push(waterMark));
                var wmInfoStr = "";
                return eval("wmInfoStr = '" + JSON.stringify(wmInfo) + "';"), wmInfoStr
            }, this.isTrialWaterMark = function() {
                return _isTrialWaterMark
            }, this.addSignature = function(a) {
                _signatrueMap[a.getSigName()] = a
            }, this.getSigByName = function(a) {
                return null == _signatrueMap ? null : _signatrueMap[a]
            }, this.deleteSigByName = function(a) {
                delete _signatrueMap[a]
            }, this.getSigCount = function() {
                return _signatrueMap.size()
            }, this.enumSignature = function(a) {
                for (var b in _signatrueMap)
                    if (a.call(_self, _signatrueMap[b]) === !1) break
            }, this.addInkSign = function(a) {
                _inkSignMap[a.getInkSigName()] = a
            }, this.getInkSigByName = function(a) {
                return null == _inkSignMap ? null : _inkSignMap[a]
            }, this.deleteInkSigByName = function(a) {
                delete _inkSignMap[a]
            }, this.getInkSigCount = function() {
                return _inkSignMap.size()
            }, this.enumInkSign = function(a) {
                for (var b in _inkSignMap)
                    if (a.call(_self, _inkSignMap[b]) === !1) break
            }, this.getAnnotationInfo = function(a, b) {
                function c(a) {
                    var c = {},
                        d = [],
                        e = _self.getPage(a);
                    null == e && $.isFunction(b) && b(null), e.enumAnnots(function(a) {
                        if (!a.isAnnotDel()) {
                            var b = {};
                            b.name = a.getAnnotName(), b.type = a.getType(), b.getSubType = a.getSubType(), b.subject = a.getSubject(), b.title = a.getTitle(), b.flag = a.getFlags(), b.createTime = WebPDF.Common.timestampToDateString(a.getCreationDate(), WebPDF.Common.AnnotTimeFormat), b.modifyTime = WebPDF.Common.timestampToDateString(a.getModifyDate(), WebPDF.Common.AnnotTimeFormat), b.contents = a.getContents(), d.push(b)
                        }
                    }), c.pageIndex = a, c.annots = d, $.isFunction(b) && b(c)
                }
                var d = this.getPage(a);
                if (d.isAnnotLoaded()) return void c(a);
                var e = WebPDF.Tool.getReaderApp(),
                    f = e.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                    g = f.getAnnotHandlerMgr(),
                    h = e.getDocView().getPageView(a);
                g.getAnnotbyPage(h, c, c)
            }, this.getOfflineBuffer = function() {
                return this._offLineBuffer
            }, this.setOfflineBuffer = function(a) {
                this._offLineBuffer = a
            }, this.setUserAnnotLoaded = function(a) {
                _isUserAnnotLoaded = a
            }, this.isUserAnnotLoaded = function() {
                return _isUserAnnotLoaded
            }, this.loadAllAnnotations = function() {
                var a = new Promise(function(a, b) {
                    function c(a, b, c) {
                        var e = {};
                        e.pageIndex = a, e.annotsArr = [];
                        for (var f = _readerApp.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME).getAnnotHandlerMgr(), g = 0; g < b.length; g++) {
                            var h = c.getAnnotByName(b[g].n);
                            h && f.needShowComment(h.getSubType()) && e.annotsArr.push(f.packageAnnot(h))
                        }
                        d.push(e)
                    }
                    var d = [],
                        e = _readerApp.getMainView().getDocView(),
                        f = e.getPageAnnotUnLoad();
                    if (f.length <= 0) return void a();
                    var g = new WebPDF.Annot.PDFAnnotationLoader;
                    g.asyncLoadCommentAnnotation(_readerApp, _readerApp.getPDFDoc(), f, f.length, function(b) {
                        for (var d = b.length, f = 0; d > f; f++) {
                            var g = e.getPageView(b[f]),
                                h = g.getPDFPage(),
                                i = h.getCommentListAnnotCount();
                            if (i) {
                                var j = h.getAnnotJsonData();
                                c(b[f], j, h)
                            }
                        }
                        a()
                    }, function() {
                        b()
                    })
                });
                return a
            }, this.getPageIndexByPageObjNum = function(a) {
                for (var b = 0; b < _pdfPages.length; b++) {
                    var c = _pdfPages[b];
                    if (c && c.getPageObjNum() === a) return b
                }
                return -1
            }, this.setReviewType = function(a) {
                _isCReview = a
            }, this.isCReview = function() {
                return _isCReview
            }, this.insertPagesFromSteam = function(a, b, c, d, e) {
                return new Promise(function(f, g) {
                    var h = WebPDF.Tool.getReaderApp().getBaseUrl(),
                        i = _readerApp.getFileID(),
                        j = _readerApp.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                        k = [];
                    j && (k = j.getAnnotationDataToSave());
                    var l = JSON.stringify(k),
                        m = _readerApp.getPluginByName(WebPDF.InkSignPluginName),
                        n = "";
                    m && (n = m.getInkSignData());
                    var o = (_self.getAllDisaplyWateramrkInfo(), null),
                        p = new XMLHttpRequest,
                        q = h + "pageOrganize/uploadAndInsertPages?fileId=" + i + "&formData=" + o + "&fileName=" + b + "&docPwd=" + c + "&insertPos=" + e.toString();
                    p.open("post", q, !0);
                    var r = new FormData;
                    r.append("annotsData", l), r.append("inkSignData", n), r.append("pageRanges", d);
                    var s = new Blob([a], {
                        type: "application/pdf"
                    });
                    r.append("fileStream", s), p.onload = function(a) {
                        WebPDF.closeUploading();
                        var b = $.parseJSON(this.response),
                            c = b.uuid;
                        if (c) {
                            if ("OutOfFileSizeLimit" === c) return WebPDF.ConnectPdf ? alert(i18n.t("ParseError.OutOfFileSizeLimit")) : setTimeout(function() {
                                alert(i18n.t("ParseError.OutOfViewerFileSizeLimit"))
                            }, 100), void g(i18n.t("ParseError.OutOfViewerFileSizeLimit"));
                            q = h + "asserts/" + c, WebPDF.ViewerInstance.openFile(q);
                            var d = WebPDF.Tool.getReaderApp();
                            return b.fileName && d.setFileName(b.fileName), $(window).resize(), void f()
                        }
                        WebPDF.alert(null, null, i18n.t("PageOrganize.InsertPagesFailed")), g(i18n.t("PageOrganize.InsertPagesFailed"))
                    }, p.onerror = function(a, b, c) {
                        WebPDF.closeUploading(), WebPDF.alert(null, null, i18n.t("CommonLng.Create.FailToUpload")), g(i18n.t("CommonLng.Create.FailToUpload"))
                    }, p.upload.onloadstart = function() {
                        WebPDF.uploading(null, 0)
                    }, p.upload.onprogress = function(a, b, c, d) {
                        WebPDF.uploading(null, parseInt(a.loaded / a.total))
                    }, p.send(r)
                })
            }, this.flattenPages = function(a, b, c) {
                return new Promise(function(d, e) {
                    var f = WebPDF.Tool.getReaderApp(),
                        g = f.getDataControl();
                    if (g) {
                        var h = {
                                uuid: a,
                                pageRanges: b,
                                flag: c,
                                password: f.getPDFPassword()
                            },
                            i = f.getDocView();
                        if (isDocModified = i.isModified(), isDocModified) {
                            var j = f.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                                k = [];
                            j && (k = j.getAnnotationDataToSave()), h.annotsData = JSON.stringify(k);
                            var l = f.getPluginByName(WebPDF.InkSignPluginName);
                            l && (h.inkSignData = l.getInkSignData()), h.formData = WebPDF.FormPlugin.getFormXML(!0)
                        }
                        return g.flattenPages(h).then(function(a) {
                            d(a)
                        }, function() {
                            e()
                        }), !0
                    }
                    return e(), !1
                })
            }, this.splitDoc = function(a, b) {
                return new Promise(function(c, d) {
                    var e = WebPDF.Tool.getReaderApp(),
                        f = e.getDataControl();
                    if (f) {
                        var g = {
                                uuid: a,
                                pageRanges: b,
                                password: e.getPDFPassword()
                            },
                            h = e.getDocView();
                        if (isDocModified = h.isModified(), isDocModified) {
                            var i = e.getPluginByName(WebPDF.BASEANNOT_PLUGIN_NAME),
                                j = [];
                            i && (j = i.getAnnotationDataToSave()), g.annotsData = JSON.stringify(j);
                            var k = e.getPluginByName(WebPDF.InkSignPluginName);
                            k && (g.inkSignData = k.getInkSignData()), g.formData = WebPDF.FormPlugin.getFormXML(!0)
                        }
                        return f.splitDocByRange(g).then(function(a) {
                            c(a)
                        }, function() {
                            d()
                        }), !0
                    }
                    return d(), !1
                })
            }
        }
    }), define("core/Framework/PDFPage", ["core/Common/Math/Matrix", "core/WebPDF"], function(a, b, c) {
        a("core/Common/Math/Matrix");
        var d = WebPDF.PDFMatrix;
        WebPDF.PageDataJsonFormat = {
            PAGE_WIDTH: "width",
            PAGE_HEIGHT: "height",
            PAGE_ROTATE: "rotate",
            PAGE_INDEX: "number",
            PAGE_MATRIX: "matrix",
            PAGE_OBJNUM: "objNum",
            PAGE_LABEL: "pageLabel"
        }, WebPDF.PDFPage = function(a) {
            function b() {
                try {
                    e = a[s.PAGE_INDEX], f = a[s.PAGE_OBJNUM], g = a[s.PAGE_WIDTH], h = a[s.PAGE_HEIGHT], i = a[s.PAGE_ROTATE], i = (i + 4) % 4, j = new d;
                    var b = a[s.PAGE_MATRIX];
                    "undefined" != typeof b && null != b ? j.Set(b[0], b[1], b[2], b[3], b[4], b[5]) : j.Set(1, 0, 0, 1, 0, 0), k = a[s.PAGE_LABEL]
                } catch (c) {
                    return console.error(c), !1
                }
                return !0
            }

            function c(a, b) {
                if (null == b) return null;
                var c = b[a];
                if (c) return c;
                for (var d in b)
                    if ("getReplyAnnotByName" in b[d] && (c = b[d].getReplyAnnotByName(a))) return c
            }
            var e, f, g, h, i = 0,
                j = null,
                k = "",
                l = [],
                m = {},
                n = !1,
                o = {},
                p = {},
                q = [],
                r = this,
                s = WebPDF.PageDataJsonFormat;
            b() || $.error("Init PDFPage failed:" + a), this.updateAnnot = function(a, b) {
                m[a] = b
            }, this.getPageIndex = function() {
                return e
            }, this.getPageObjNum = function() {
                return f
            }, this.getPageWidth = function() {
                return g
            }, this.getPageHeight = function() {
                return h
            }, this.setPageWidth = function(a) {
                g = a
            }, this.setPageHeight = function(a) {
                h = a
            }, this.getPageRotate = function() {
                return i
            }, this.setPageRotate = function(a) {
                i = a
            }, this.getPageMatrix = function() {
                return j
            }, this.getPageLabel = function() {
                return k
            }, this.getAnnotByName = function(a) {
                return null == m ? null : c(a, m)
            }, this.enumAnnots = function(a) {
                for (var b in m) {
                    var c = m[b];
                    if (c && !c.isAnnotDel() && a.call(r, c) === !1) break
                }
            }, this.getAnnotsMap = function() {
                return m
            }, this.deleteAnnots = function(a) {
                for (var b = 0; b < l.length; b++) {
                    var c = l[b],
                        d = c[WebPDF.Annot.AnnotDataJSONFormat.name];
                    a[d] && (l.splice(b, 1), b -= 1, delete m[d])
                }
            }, this.addAnnot = function(a) {
                return m[a.getAnnotName()] = a
            }, this.getAnnotCount = function() {
                var a = 0;
                for (var b in m) m.hasOwnProperty(b) && a++;
                return a
            }, this.getCommentListAnnotCount = function() {
                var a = 0,
                    b = ["Highlight", WebPDF.Annot.AnnotType.Text, WebPDF.Annot.AnnotType.Ink, "Underline", "StrikeOut", "Squiggly", "Caret", "FreeText", WebPDF.Annot.AnnotType.Stamp, WebPDF.Annot.AnnotType.Circle, WebPDF.Annot.AnnotType.Square, WebPDF.Annot.AnnotType.Line];
                for (var c in m)
                    if (m.hasOwnProperty(c) && m[c].isVisible()) {
                        var d = m[c].getSubType();
                        for (var e in b)
                            if (b[e] === d) {
                                a++;
                                break
                            }
                    }
                return a
            }, this.getAnnotJsonData = function() {
                return l
            }, this.n = 0, this.setAnnotJsonData = function(a) {
                l = a
            }, this.setAnnotLoaded = function(a) {
                n = a
            }, this.isAnnotLoaded = function() {
                return n
            }, this.setInkSignJsonData = function(a) {
                q = a
            }, this.getInkSignJsonData = function() {
                return q
            }, this.addSignature = function(a) {
                o[a.getSigName()] = a
            }, this.getSigByName = function(a) {
                return null == o ? null : o[a]
            }, this.deleteSigByName = function(a) {
                delete o[a]
            }, this.getSigCount = function() {
                return o.size()
            }, this.enumSignature = function(a) {
                for (var b in o)
                    if (a.call(r, o[b]) === !1) break
            }, this.addInkSign = function(a) {
                p[a.getSigName()] = a
            }, this.getInkSigByName = function(a) {
                return null == p ? null : p[a]
            }, this.deleteInkSigByName = function(a) {
                delete p[a]
            }, this.getInkSigCount = function() {
                return p.size()
            }, this.enumInkSign = function(a) {
                for (var b in p)
                    if (a.call(r, p[b]) === !1) break
            }, this.getInkSignMap = function() {
                return p
            }, this.transRectWithPageMatrix = function(a) {
                var b = this.getPageMatrix(),
                    c = b.TransFormRect(a.left, a.top, a.right, a.bottom),
                    d = new WebPDF.PDFRect(c[0], c[1], c[2], c[3]);
                return d
            }, this.transRectWithPageMatrix = function(a, b, c, d) {
                var e = this.getPageMatrix(),
                    f = e.TransFormRect(a, b, c, d),
                    g = new WebPDF.PDFRect(f[0], f[1], f[2], f[3]);
                return g
            }, this.transRectToPDF = function(a) {
                var b = this.getPageMatrix(),
                    c = new WebPDF.PDFMatrix;
                c.SetReverse(b);
                var d = c.TransFormRect(a.left, a.top, a.right, a.bottom),
                    e = new WebPDF.PDFRect(d[0], d[1], d[2], d[3]);
                return e
            }, this.transformPointToPDF = function(a, b) {
                var c = this.getPageMatrix(),
                    d = new WebPDF.PDFMatrix;
                d.SetReverse(c);
                var e = d.TransFormPoint(a, b),
                    f = new WebPDF.PDFPoint(e[0], e[1]);
                return f
            }, this.filterExistAnnots = function(a, b) {
                for (var c = [], d = 0; d < b.length; d++) {
                    for (var e = b[d], f = !1, g = 0; g < a.length; g++)
                        if (e[WebPDF.Annot.AnnotDataJSONFormat.name] === a[g][WebPDF.Annot.AnnotDataJSONFormat.name] && "1" !== e[WebPDF.Annot.AnnotDataJSONFormat.del]) {
                            f = !0;
                            break
                        }
                    f || c.push(e)
                }
                return c
            }, this.isSupportedXFDFType = function(a) {
                var b = a.getSubType();
                return b === WebPDF.Annot.AnnotType.Text || b === WebPDF.Annot.AnnotType.Ink || b === WebPDF.Annot.AnnotType.Line || b === WebPDF.Annot.AnnotType.Square || b === WebPDF.Annot.AnnotType.Circle || b === WebPDF.Annot.AnnotType.FreeText || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_UNDERLINE || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_HIGHLIGHT || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_SQUIGGLY || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_STRIKEOUT || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_REPLACE || b === WebPDF.Annot.CommentAnnotType.COMMENTTYPE_CARET || b === WebPDF.Annot.AnnotType.Polygon || b === WebPDF.Annot.AnnotType.PolyLine || b === WebPDF.Annot.AnnotType.Textbox || "TextBox" === b ? !0 : !1
            }
        }
    }), define("core/Plugins/Annot/Undo/AnnotUndoStack", [], function(a, b, c) {
        function d(a) {
            this.annotUndoStack = [], this.annotUndoIndex = 0
        }
        return d.prototype = {
            add: function(a) {
                this.annotUndoIndex < this.annotUndoStack.length && (this.annotUndoStack = this.annotUndoStack.slice(0, this.annotUndoIndex)), this.annotUndoStack[this.annotUndoIndex++] = a, this.annotUndoStack.length = this.annotUndoIndex
            },
            undo: function() {
                return this.annotUndoIndex > 0 ? this.annotUndoStack[--this.annotUndoIndex] : void 0
            },
            redo: function() {
                return this.annotUndoIndex < this.annotUndoStack.length ? this.annotUndoStack[this.annotUndoIndex++] : void 0
            },
            clear: function() {
                this.annotUndoStack = [], this.annotUndoIndex = 0
            },
            concat: function(a) {
                this.annotUndoIndex = this.annotUndoStack.length, this.annotUndoStack.push.apply(this.annotUndoStack, a.annotUndoStack)
            },
            getSize: function() {
                return this.annotUndoStack.length
            }
        }, d
    }), define("core/Plugins/DocProperties/PDFDocProperties", ["core/Plugins/DocProperties/DocProperties", "core/WebPDF"], function(a, b, c) {
        a("core/Plugins/DocProperties/DocProperties");
        var d = WebPDF.DocProperties.DocPropertiesJsonFormat;
        return WebPDF.DocProperties.PDFDocProperties = function(a) {
            this._docPropertiesJSONData = a
        }, WebPDF.DocProperties.PDFDocProperties.prototype = {
            getAuthor: function() {
                return this._docPropertiesJSONData[d.author]
            },
            getCreator: function() {
                return this._docPropertiesJSONData[d.creator]
            },
            getProducer: function() {
                return this._docPropertiesJSONData[d.producer]
            },
            getTitle: function() {
                return this._docPropertiesJSONData[d.title]
            },
            getSubject: function() {
                return this._docPropertiesJSONData[d.subject]
            },
            getKeywords: function() {
                return this._docPropertiesJSONData[d.keywords]
            },
            getCreationDate: function() {
                return this._docPropertiesJSONData[d.creationData] + "UTC"
            },
            getModifyDate: function() {
                return this._docPropertiesJSONData[d.modData] + "UTC"
            },
            getVersion: function() {
                return this._docPropertiesJSONData[d.version]
            }
        }, WebPDF.DocProperties.PDFDocProperties
    }), define("core/Plugins/DocProperties/DocProperties", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.DocProperties = {}, d.DocProperties.DocPropertiesJsonFormat = {
            docpropertyinfo: "dppinfo",
            properties: "ppt",
            author: "atr",
            creator: "ctr",
            producer: "pdr",
            title: "title",
            subject: "sbj",
            keywords: "kwd",
            creationData: "ctd",
            modData: "mdd",
            version: "ver"
        };
        var e = d.DocProperties.DocPropertiesJsonFormat,
            f = function(a) {
                this.m_JsonDocPropertiesData = a, this.GetAuthor = function() {
                    return this.m_JsonDocPropertiesData[e.author]
                }, this.GetCreator = function() {
                    return this.m_JsonDocPropertiesData[e.creator]
                }, this.GetProducer = function() {
                    return this.m_JsonDocPropertiesData[e.producer]
                }, this.GetTitle = function() {
                    return this.m_JsonDocPropertiesData[e.title]
                }, this.GetSubject = function() {
                    return this.m_JsonDocPropertiesData[e.subject]
                }, this.GetKeywords = function() {
                    return this.m_JsonDocPropertiesData[e.keywords]
                }, this.GetCreationDate = function() {
                    return this.m_JsonDocPropertiesData[e.creationData]
                }, this.GetModifyDate = function() {
                    return this.m_JsonDocPropertiesData[e.modData]
                }, this.GetVersion = function() {
                    return this.m_JsonDocPropertiesData[e.version]
                }
            };
        return d.DocProperties.DocProperties = f, d.DocProperties.DocProperties
    }), define("core/ImageEngine/ImagePageViewRender", ["core/ImageEngine/ImageEngine", "core/Common/Common", "core/WebPDF", "core/Framework/Config", "core/ImageEngine/ImageLazyLoad", "core/ImageEngine/ImageTitlesLazyLoad", "core/Framework/AjaxRetryManager", "core/ImageEngine/JSImagePageViewRender", "core/ImageEngine/ServerImagePageViewRender"], function(a, b, c) {
        a("core/ImageEngine/ImageEngine"), a("core/Common/Common"), a("core/Framework/Config");
        WebPDF.Config, a("core/ImageEngine/ImageLazyLoad"), a("core/ImageEngine/ImageTitlesLazyLoad");
        a("core/Framework/AjaxRetryManager");
        var d = WebPDF.ImageEngine;
        return d.GetImageErrorCode = {
            ERROR_SUCCESS: 0,
            ERROR_PAGE_DISPLAY_LIMIT: 1,
            ERROR_CREATE_IMG_FAILED: 2,
            ERROR_INPROGRESS: 3
        }, d.ImagePageViewRender = function() {
            function b(a, b) {
                var c = {
                    pageWidth: 0,
                    pageHeight: 0
                };
                return null == a ? c : (1 == b ? (c.pageWidth = a.getPDFPageWidth() * i.getPixelsPerPoint(), c.pageHeight = a.getPDFPageHeight() * i.getPixelsPerPoint()) : (c.pageWidth = a.getPageViewWidth(), c.pageHeight = a.getPageViewHeight(), a.getDocView().getRotate() % 180 != 0 && (c.pageWidth = a.getPageViewHeight(), c.pageHeight = a.getPageViewWidth())), c)
            }

            function c(a, c, d, f) {
                var g = b(c, d),
                    h = .75 * g.pageWidth,
                    i = c.getDocView().getPDFDoc(),
                    j = i.getTrailWatermarkInfo();
                j.width = h, e(a, j, c, d, f)
            }

            function e(a, c, d, e, f) {
                function g(a, b, c) {
                    var d = a.outerHeight(),
                        e = a.outerWidth(),
                        f = new WebPDF.PDFMatrix,
                        g = Math.cos(-b.rotation),
                        h = Math.sin(-b.rotation);
                    f.Set(g, h, -h, g, 0, 0);
                    for (var i = f.TransFormRect(0, d, e, 0), j = Math.abs(i[2] - i[0]), k = Math.abs(i[3] - i[1]), l = b.fontSize * b.scale, m = WebPDF.Tool.getReaderApp().getPixelsPerPoint();
                        (j > c.pageWidth || k > c.pageHeight) && !(1 > l);) {
                        l -= 1, a.css({
                            lineHeight: l * m + "px",
                            fontSize: l + "px"
                        }), e = a.outerWidth(), d = a.outerHeight(), a.css({
                            left: (c.pageWidth - e) / 2 + "px",
                            top: (c.pageHeight - d) / 2 + "px"
                        });
                        var i = f.TransFormRect(0, d, e, 0),
                            j = Math.abs(i[2] - i[0]),
                            k = Math.abs(i[3] - i[1])
                    }
                }

                function i(a) {
                    var b = Math.min(a.pageWidth, a.pageHeight);
                    return Math.SQRT2 * b / 2
                }

                function j(a, b, c) {
                    var e = b.content;
                    b.isDynamic && "false" != b.isDynamic && (e = "", b.userName && (e += WebPDF.AccountInstance.getUserAccount()), b.ip && (e += "<br />", e += h.isMobile() ? h.getIP() : "<a>" + h.getIP() + "<a>"), b.openTime && (e += "<br />", e += d.getDocView().getOpenTime())), a.html(e);
                    var g = parseInt(b.rotation) + f,
                        j = (parseFloat(b.opacity), parseInt(b.color));
                    j = 16777215 & j, j = j.toString(16);
                    for (var k = "", l = 0; l < 6 - j.length; ++l) k += "0";
                    j = "#" + k + j;
                    var m = b.fontSize * b.scale;
                    a.attr({
                        style: "word-break: break-all"
                    }), a.css({
                        position: "absolute",
                        textAlign: "center",
                        verticalAlign: "top",
                        lineHeight: "normal",
                        fontWeight: b.fontWeight,
                        fontFamily: b.fontFamily,
                        fontStyle: b.fontStyle ? "italic" : "normal",
                        fontSize: m + "px",
                        opacity: b.opacity,
                        color: j,
                        overflow: "hidden"
                    }), a.css("z-index", "2"), WebPDF.Common.addTranslateCss(a, g);
                    var n = WebPDF.Tool.getReaderApp().getPixelsPerPoint();
                    if (b.width) {
                        var o = a.width(),
                            p = b.width ? b.width : pageWidth;
                        !isNaN(o) && o > 0 && (m = m * p / o, b.fontSize = m, a.css({
                            fontSize: m + "px",
                            lineHeight: m * n + "px"
                        }))
                    } else {
                        var q = i(c);
                        a.css({
                            width: q + "px"
                        })
                    }
                    if (WebPDF.Environment.ie8OrLower) {
                        var r = "progid:DXImageTransform.Microsoft.Alpha(Opacity=75)",
                            s = g * Math.PI * 2 / 360,
                            t = Math.cos(s),
                            u = Math.sin(s),
                            v = "M11=" + t + ", M12=" + -u + ", M21=" + u + ", M22=" + t,
                            w = "progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand'," + v + ")",
                            x = r + " " + w;
                        a.css({
                            "-ms-filter": x,
                            filter: x
                        })
                    }
                    a.css({
                        left: (c.pageWidth - a.width()) / 2 + "px",
                        top: (c.pageHeight - a.height()) / 2 + "px"
                    })
                }
                if (f = f ? f : 0, "undefined" == typeof c || null == c || "undefined" != typeof c.add && 0 == c.add) return void a.hide();
                var k = b(d, e);
                j(a, c, k), g(a, c, k)
            }
            var f = {},
                g = -1,
                h = null,
                i = this;
            this.clearCache = function() {
                f = {}
            }, this.getMaxRenderedPageIndex = function() {
                return g
            }, this.setReaderApp = function(a) {
                h = a
            }, this.setImageRenderEngine = function() {
                this.clearCache(), WebPDF.Engine.JR ? a("core/ImageEngine/JSImagePageViewRender").JSImagePageViewRender.call(this, h, d, f) : a("core/ImageEngine/ServerImagePageViewRender").ServerImagePageViewRender.call(this, h, d, f, g)
            }, this.getPageImgUrl = function(a, b, c, d) {
                h.isLargeFile() && (d = !1), b = b ? 100 * b : 100;
                var e = c ? "thumb" : b + "",
                    f = "";
                return f = "thumb" != e && d ? h.getOptions().url + "imagestatus/" + a + "/" + e + "/" + Configs.tile.size : h.getOptions().url + "image/" + a + "/" + e, f += "?accessToken=" + WebPDF.AccountInstance.getAccessToken(), h.isFormMode() && (f += "&formMode=true"), h.isLargeFile() && (f += "&islarge=true"), f
            }, this.getPixelsPerPoint = function() {
                return 96 / 72
            }, this.renderPageWatermark = function(a) {
                var b = a.getDocView(),
                    d = b.getPDFDoc();
                d.isTrialWaterMark() && c($("#" + a.getTrialWatermarkID()), a, !1), e($("#" + a.getWatermarkID()), d.getWatermarkInfo(), a, !1), e($("#" + a.getUserWatermarkID()), d.getUserWatermarkInfo(), a, !1)
            }, this.getWatermarkHtmlContent = function(a, b, d) {
                function f(a, b, c) {
                    var d = "",
                        e = a.clone();
                    e.show();
                    var f = parseInt(a.css("left")) * c,
                        g = parseInt(a.css("top")) * c,
                        h = parseInt(a.css("font-size")) * c;
                    return e.css({
                        width: a.width() * c,
                        left: f,
                        top: g,
                        "font-size": h + "px",
                        "line-height": h * WebPDF.Tool.getReaderApp().getPixelsPerPoint() + "px"
                    }), d += e.prop("outerHTML")
                }
                if (null == a) return "";
                var g = "",
                    h = a.getDocView().getPDFDoc();
                if (h.isTrialWaterMark()) {
                    var i = $('<div id="' + a.getTrialWatermarkID() + '"></div>');
                    $("body").append(i), i.hide(), c(i, a, !0, d), g += f(i, a, b), i.remove()
                }
                var j = $('<div id="' + a.getWatermarkID() + '"></div>');
                $("body").append(j), j.hide(), e(j, h.getWatermarkInfo(), a, !0, d), g += f(j, a, b), j.remove();
                var k = $('<div id="' + a.getUserWatermarkID() + '"></div>');
                return $("body").append(k), k.hide(), e(k, h.getUserWatermarkInfo(), a, !0, d), g += f(k, a, b), k.remove(), g
            }
        }, WebPDF.ImageEngine.ImagePageViewRender
    }), define("core/ImageEngine/ImageEngine", [], function(a, b, c) {
        window.WebPDF || (window.WebPDF = {}), window.WebPDF.ImageEngine = {}
    }), define("core/Framework/AjaxRetryManager", ["core/WebPDF"], function(a, b, c) {
        var d = a("core/WebPDF");
        d.AjaxRetryManager = {
            getNextPageImageRequestInterval: function(a, b, c) {
                var d = c + 2;
                return b > d || b >= a + 2 ? 1e3 : 1500 * (a + 2 - b)
            },
            getNextAnnotDataRequestInterval: function(a) {
                return 500 * a
            },
            getNextBookmarkDataRequestInterval: function(a) {
                return 500 * a
            },
            getNextFormXmlRequestInterval: function(a, b, c) {
                var d = c + 2;
                return b > d || b >= a + 2 ? 1e3 : 1500 * (a + 2 - b)
            }
        }
    }), define("core/ImageEngine/JSImagePageViewRender", [], function(a, b, c) {
        function d(a, b, c) {
            var d = this;
            this.currentRenderPage = null, this.isRegister = !1, this.loadThumb = function(b, c, d, e) {
                function f(b) {
                    if (b.imageData) {
                        var c = new Blob([b.imageData], {
                                type: "image/png"
                            }),
                            d = URL.createObjectURL(c);
                        $("#" + b.imageId).attr("src", d)
                    } else {
                        var e = WebPDF.Common.joinUrl(a.getBaseUrl(), "images/reader/imgFailed.png");
                        $("#" + b.imageId).attr("src", e)
                    }
                }
                var g = this.getPageImgUrl(c, b.getScale(), !0),
                    h = a.getDataControl(),
                    i = {
                        pageIndex: c,
                        imageId: d
                    },
                    j = {
                        type: "getThumbImg",
                        data: i,
                        success: f
                    };
                return h.getThumbImg(j), g
            }, this.renderPage = function(b, e) {
                function f() {
                    var a = d.currentRenderPage.getPageLoaderImageID();
                    $("#" + a).show(), $("#" + a).find("p").show()
                }

                function g(b) {
                    var d = a.getMainView().getDocView().getPageView(b.pageIndex);
                    if (null == b.imageData) {
                        var e = WebPDF.Common.joinUrl(a.getBaseUrl(), "images/reader/imgFailed.png");
                        $("#" + d.getPageBackgroundImgID()).attr("src", e).load(function (){
                            d.show(), d.setPageLoaded(!0), d.setAnnotLoad(!0);
                            var h = (d.isThumb() || !d.isThumbnailLoaded() ? "thumb" : "page") + b.pageIndex;
                            c[h] = null, $(a).trigger(WebPDF.EventList.PAGE_SHOW_COMPLETE, {
                                pageView: d
                            })
                        })
                    } else {
                        var f = new Blob([b.imageData], {
                                type: "image/png"
                            }),
                            g = URL.createObjectURL(f);
                        $("#" + d.getPageBackgroundImgID()).attr("src", g).load(function (){
                            let dd1 = new Date();
                            let pageLoadTime = dd1.getTime() - window.openFileBufStartTime;
                            console.log("Time taken to create the blob from pdf is "+(pageLoadTime/1000)+" secs");
                            d.show(), d.setPageLoaded(!0), d.setAnnotLoad(!0);
                            var h = (d.isThumb() || !d.isThumbnailLoaded() ? "thumb" : "page") + b.pageIndex;
                            c[h] = null, $(a).trigger(WebPDF.EventList.PAGE_SHOW_COMPLETE, {
                                pageView: d
                            })
                        })
                    }
                }
                if (b && b.isContentCreated() && !b.isPageLoaded()) {
                    d.currentRenderPage = b;
                    var h = a.getDataControl();
                    if (0 == this.isRegister) {
                        var i = {
                            type: "loadFontInfo",
                            data: o,
                            success: f
                        };
                        h.loadFontInfo(i), this.isRegister = !0
                    }
                    var j = b.getPageIndex(),
                        k = (b.isThumb() || !b.isThumbnailLoaded() ? "thumb" : "page") + j;
                    if (b.isThumbnailLoaded() ? b.setAnnotLoad(!0) : b.setAnnotLoad(!1), !c[k]) {
                        var l = 1,
                            m = b.getDocView(),
                            n = m.getVisiblePageRange();
                        if (j <= n.begin - l || j >= n.end + l) return;
                        c[k] = b;
                        var o = {
                                pageIndex: j,
                                scale: b.getScale(),
                                docPermission: a.getDocPermission()
                            },
                            i = {
                                type: "getPageImg",
                                data: o,
                                success: g
                            };
                        h.getPageImg(i), this.renderPageWatermark(b)
                    }
                }
            }
        }
        b.JSImagePageViewRender = d
    }), define("core/ImageEngine/ServerImagePageViewRender", ["core/ImageEngine/ImageTitlesLazyLoad", "core/WebPDF"], function(a, b, c) {
        function d(a, b, c, d) {
            function g(b) {
                var c = Configs.Rendering.tileZoomList;
                if (c.indexOf(b) < 0) {
                    b = b > c[c.length - 1] ? c[c.length - 1] : b, b = b < c[0] ? c[0] : b;
                    for (var d = 0; d < c.length; d++)
                        if ("number" == typeof c[d] && b <= c[d]) {
                            b = c[d];
                            break
                        }
                }
                return navigator.userAgent.match(/mobile/i) && 1 > b && (b = 1), a.getTileConfig().enable || (b = 1), b
            }

            function h(a, b) {
                var c = a.getPageIndex(),
                    d = (a.isThumb() || !a.isThumbnailLoaded() ? "thumb" : "page") + c + "_zoom" + b;
                return d
            }

            function i(b) {
                if (!b.isThumb() && b.isThumbnailLoaded()) {
                    var c = a.getTileConfig();
                    if (c.enable) {
                        var d = (a.getOptions().url + "image/" + b.getPageIndex() + "/", b.getDocView().getScrollApi()),
                            f = {
                                url: a.getOptions().url + "image/" + b.getPageIndex() + "/",
                                readerApp: a,
                                curPageView: b,
                                left: d.getContentPositionX(),
                                top: d.getContentPositionY()
                            };
                        new e(f)
                    } else {
                        var g = l.getPageImgUrl(b.getPageIndex(), 1, !1, c.enable);
                        $("#" + b.getPageBackgroundImgID()).attr("src", g)
                    }
                    b.setPageLoaded(!0)
                }
            }

            function j(a) {
                if (a.isThumb()) return a.setPageLoaded(!0), !1;
                if (a.isThumbnailLoaded()) return !1;
                a.setThumbnailLoaded(!0);
                var b = l.getPageImgUrl(a.getPageIndex(), a.getScale(), !0);
                return $("#" + a.getPageBackgroundImgID()).attr("src", b), !0
            }

            function k(b, c) {
                b.isThumb() || b.setThumbnailLoaded(!0), b.setPageLoaded(!0);
                var d = WebPDF.Common.joinUrl(a.getBaseUrl(), "images/reader/imgFailed.png");
                c ? b.showErrorPage(d) : ($(a).trigger(WebPDF.EventList.PAGE_SHOW_LIMIT, {
                    pageIndex: b.getPageIndex()
                }), b.showErrorPage(d), b.setPageLoadLimit(!0))
            }
            var l = this;
            this.loadThumb = function(c, d, e, f) {
                function g(a, g) {
                    var h = g == b.GetImageErrorCode.ERROR_INPROGRESS;
                    return h ? void setTimeout(function() {
                        l.loadThumb(c, d, e, --f)
                    }, 2e3) : void $("#" + e).attr("src", i)
                }

                function h() {}
                var i = l.getPageImgUrl(d, c.getScale(), !0);
                if (0 >= f) return console.warn("Maximum number of retries exceeded for render thumb page: " + d), i;
                var j = a.getDataControl(),
                    k = {
                        url: i,
                        readApp: a,
                        pageView: c
                    },
                    m = {
                        data: k,
                        success: g,
                        error: h
                    };
                return j.getThumbImg(m), i
            }, this.renderPage = function(e, m) {
                function n(e, m) {
                    function o(b) {
                        c[s] = null, b.setPageLoaded(!0), b.showErrorPage(WebPDF.Common.joinUrl(a.getBaseUrl(), "/images/reader/imgFailed.png")), b.isThumb() || (b.setPageLoadError(!0), $(a).trigger(WebPDF.EventList.PAGE_SHOW_COMPLETE, {
                            pageView: b
                        }))
                    }

                    function p(g, h) {
                        var l = !1,
                            o = h == b.GetImageErrorCode.ERROR_CREATE_IMG_FAILED,
                            p = h == b.GetImageErrorCode.ERROR_PAGE_DISPLAY_LIMIT,
                            q = h == b.GetImageErrorCode.ERROR_INPROGRESS;
                        if (o || p) l = !0;
                        else if (q) return -1 === d && (d = 0), c[s] = f, void setTimeout(function() {
                            n(g, m - 1)
                        }, 2e3);
                        if (d = g.getPageIndex(), c[s] = e, l) k(g, o);
                        else {
                            if (g.show(), j(g)) return void setTimeout(function() {
                                n(g, WebPDF.Config.defaults.requestRetryCount)
                            }, 500);
                            i(g)
                        }!g.isThumb() && g.isPageLoaded() && (g.setPageLoadError(l), $(a).trigger(WebPDF.EventList.PAGE_SHOW_COMPLETE, {
                            pageView: g
                        }))
                    }
                    if (e && e.isContentCreated()) {
                        var q = e.getPageIndex(),
                            r = g(e.getScale()),
                            s = h(e, r);
                        if (0 >= m) return console.warn("Maximum number of retries exceeded for render page: " + q + "; thumb:" + e.isThumb()), void(c[s] = null);
                        e.isThumbnailLoaded() ? e.setAnnotLoad(!0) : e.setAnnotLoad(!1);
                        var t = c[s] == f && m != WebPDF.Config.defaults.requestRetryCount;
                        if (!c[s] || t) {
                            if (e.setPageLoaded(!1), a.isLargeFile() && e.isThumbnailLoaded()) p(e, 0);
                            else {
                                var u = {
                                    data: {
                                        url: l.getPageImgUrl(q, r, e.isThumb() || !e.isThumbnailLoaded(), a.getTileConfig().enable),
                                        readApp: a,
                                        pageView: e
                                    },
                                    success: p,
                                    error: o
                                };
                                a.getDataControl().getPageImg(u)
                            }
                            l.renderPageWatermark(e)
                        }
                    }
                }

                function o(a, b) {
                    n(a, b - 1)
                }
                o(e, m)
            }
        }
        var e = a("core/ImageEngine/ImageTitlesLazyLoad"),
            f = 1;
        b.ServerImagePageViewRender = d
    });