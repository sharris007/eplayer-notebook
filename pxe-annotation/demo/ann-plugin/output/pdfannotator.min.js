pdfAnnotatorInstance=function(){function a(a){$("body").mousedown(function(b){H&&$(b.target).parents("#root").length&&0==$(b.target).parents("#openPopupHighlight").length&&$("#openPopupHighlight").is(":visible")&&(g(),a())}),$(document).on("keyup",function(a){27===a.keyCode&&$("#openPopupHighlight").is(":visible")&&g()})}function b(a,b,d,e,i,j,k,o,q){try{document.getElementById("openPopupHighlight").remove()}catch(a){}var r=$("#docViewer_ViewContainer").offset().left,y=$("#docViewer_ViewContainer").width();v=j,b.left=r+y-($(".fwr-single-page").offset().left+287),b.top=b.top+document.getElementsByClassName("headerBar")[0].clientHeight-20;var z=document.createElement("div");z.setAttribute("id","openPopupHighlight"),z.style.left=b.left+"px",z.style.top=b.top+"px",z.style.width=b.width+"px",z.style.height=b.height+"px",z.style.position="absolute",z.innerHTML=C,document.getElementById(i).appendChild(z),D.saveHighlightCallback=d,D.editHighlightCallback=e,p=a,s=!1,t=!1,u=!0,H=!0,I=k,J=o,w=i,x=q,$("#color-button-yellow, #color-button-green, #color-button-pink").on("click",function(a){c(a)}),$("#note-text-area").on("input",function(a){m(a)}),$("#note-text-area").on("click",function(a){$("#note-text-area").focus()}),$("#deleteIcon").on("click",function(a){f(),document.getElementById("label-confirm").innerHTML=v.messages.confirm,document.getElementById("ann-confirm-cancel").innerHTML=v.messages.cancel,document.getElementById("ann-confirm-del").innerHTML=v.messages.delete}),$("#editIcon").on("click",function(a){h()}),$("#cancel-saving").on("click",function(a){g()}),$("#save-annotation").on("click",function(a){l(!1)}),$("#ann-share").on("click",function(a){n(a)}),$(".annotator-edit-container").hide(),F=$("#note-text-area")[0].scrollHeight||40,$(G).find(".annotator-share-text, .annotator-share").hide(),document.getElementById("note-text-area").placeholder=v.messages.writeNote,document.getElementById("cancel-saving").innerHTML=v.messages.cancel,document.getElementById("save-annotation").innerHTML=v.messages.save,document.getElementById("share-text").innerHTML=v.messages.share}function c(a){r=a.currentTarget.value;var b=a.currentTarget.id;if("color-button-pink"==b?q="pink":"color-button-green"==b?q="green":"color-button-yellow"==b&&(q="yellow"),$("#annotator-outer-id").hasClass("hide-note")?k():l(!0),$(".annotator-editor").removeClass("hide-note"),$(".annotator-color").removeClass("active"),$(a.target).addClass("active"),$(G).find(".annotator-listing .characters-left").remove(),$("#letter-count").text(3e3-$(G).find("textarea").val().length),u){var c=$("#annotator-outer-id").position().top+$("#annotator-outer-id").find("form").height()-$("#annotator-outer-id").find(".annotator-panel-1").height();$("#annotator-outer-id").css({top:c}),u=!1}d()}function d(){var a=$(".annotator-widget").offset().top,b=$(".annotator-widget").offset().left,c=$(".annotator-widget").height(),d=$(".annotator-widget").width(),e=$("#"+w).offset().top,f=$("#"+w).height();f+=e,a+c>f&&(a=f-c,$(".annotator-widget").offset({top:a,left:b}),$(".annotator-widget").width(d),$(".annotator-widget").height(c))}function e(){void 0!=D.deleteHighlightCallback&&D.deleteHighlightCallback(p.id),$(G).addClass(E.hide);var a=$(G).find(".annotator-panel-1"),b=$(G).find(".annotator-panel-2"),c=$(G).find(".annotator-panel-3"),d=$(G).find(".annotator-panel-4");a.removeClass("hide-popup"),b.removeClass("overlay"),c.removeClass("overlay"),d.remove(),$(G).addClass("hide-note"),H=!1}function f(){var a=$(G).find(".annotator-panel-1"),b=$(G).find(".annotator-panel-2"),c=$(G).find(".annotator-panel-3"),d=$(G).find(".annotator-panel-4");$(b).find("textarea").val().trim()?(a.addClass("hide-popup").after(B),d.addClass("annotator-panel-triangle"),b.addClass("overlay"),c.addClass("overlay"),$("#ann-confirm-cancel").on("click",function(a){i()}),$("#ann-confirm-del").on("click",function(a){e()})):e()}function g(){$(G).addClass(E.hide),$(G).addClass("hide-note").removeClass("show-edit-options"),$(".annotator-edit-container").show(),$(".annotator-panel-1").removeClass("disabled-save"),i()}function h(){$(G).addClass("show-edit-options"),$(G).find("textarea").show(),$(G).find("#noteContainer").hide(),$(G).find("textarea").css({"pointer-events":"all",opacity:"1"}),$(G).find("input").css({"pointer-events":"all",opacity:"1"}),$(G).find("textarea").val().length&&3==I&&-1!=J&&"6"!==x&&"88"!==x?$(G).find(".annotator-share-text, .annotator-share").show():$(G).find(".annotator-share-text, .annotator-share").hide(),t=!0}function i(){var a=$(G).find(".annotator-panel-1"),b=$(G).find(".annotator-panel-2"),c=$(G).find(".annotator-panel-3"),d=$(G).find(".annotator-panel-4");a.removeClass("hide-popup"),b.removeClass("overlay"),c.removeClass("overlay"),d.remove(),H=!1}function j(a){p=a}function k(){var a="",b={currHighlightColor:q,currHighlightColorCode:r,noteText:a,isShared:s};D.saveHighlightCallback(p,b)}function l(a){var b,c={};a?void 0!=q&&(c.currHighlightColor=q):(b=document.getElementById("note-text-area").value,c.currHighlightColor=q,c.isShared=s,c.noteText=b),D.editHighlightCallback(p.id,c),a||g()}function m(a){t?($(G).addClass("show-edit-options"),3==I&&-1!=J&&"6"!==x&&"88"!==x?$(G).find(".annotator-share-text, .annotator-share").show():$(G).find(".annotator-share-text, .annotator-share").hide()):(a.target.value.length?$(G).addClass("show-edit-options"):$(G).removeClass("show-edit-options"),3==I&&-1!=J&&a.target.value.length&&"6"!==x&&"88"!==x?$(G).find(".annotator-share-text, .annotator-share").show():$(G).find(".annotator-share-text, .annotator-share").hide())}function n(a){$(a.target).hasClass("on")?($(a.target).removeClass("on"),s=!1,$("#color-button-yellow").prop("disabled",!1),$("#color-button-green").prop("disabled",!1),$("#color-button-pink").prop("disabled",!1),$("#color-button-yellow").css({background:"#ffd232"}),$("#color-button-green").css({background:"#55df49"}),$("#color-button-pink").css({background:"#fc92cf"}),$("#color-button-"+q).addClass("active")):($(a.target).addClass("on"),s=!0,$("#color-button-yellow").prop("disabled",!0),$("#color-button-green").prop("disabled",!0),$("#color-button-pink").prop("disabled",!0),$("#color-button-yellow").css({background:"#fff1c1"}),$("#color-button-green").css({background:"#CCF5C8"}),$("#color-button-pink").css({background:"#FEDEF0"}),$(".annotator-color").removeClass("active"))}function o(a,b,e,i,j,k,o,v,y){var z=$("#"+a.id),A=z[0].children[0],B=j,K={left:A.offsetLeft,top:A.offsetTop,width:A.offsetWidth,height:A.offsetHeight};try{document.getElementById("openPopupHighlight").remove()}catch(a){}var L=$("#docViewer_ViewContainer").offset().left,M=$("#docViewer_ViewContainer").width();K.left=L+M-($(".fwr-single-page").offset().left+287),K.top=K.top+document.getElementsByClassName("headerBar")[0].clientHeight-20,void 0!==o&&(K.top=o+document.getElementsByClassName("headerBar")[0].clientHeight-20);var N=document.createElement("div");if(N.setAttribute("id","openPopupHighlight"),N.style.left=K.left+"px",N.style.top=K.top+"px",N.style.width=K.width+"px",N.style.height=K.height+"px",N.style.position="absolute",N.innerHTML=C,document.getElementById(i).appendChild(N),D.editHighlightCallback=b,D.deleteHighlightCallback=e,p=a,I=k,J=v,w=i,x=y,$("#color-button-yellow, #color-button-green, #color-button-pink").on("click",function(a){a.stopPropagation(),c(a)}),$("#note-text-area").on("input",function(a){m(a)}),$("#note-text-area").on("click",function(a){$("#note-text-area").focus()}),$("#deleteIcon").on("click",function(a){f(),document.getElementById("label-confirm").innerHTML=B.messages.confirm,document.getElementById("ann-confirm-cancel").innerHTML=B.messages.cancel,document.getElementById("ann-confirm-del").innerHTML=B.messages.delete}),$("#editIcon").on("click",function(a){h(),document.getElementById("cancel-saving").innerHTML=B.messages.cancel}),$("#cancel-saving").on("click",function(a){g()}),$("#save-annotation").on("click",function(a){l(!1)}),$("#ann-share").on("click",function(a){n(a)}),$(G).removeClass(E.hide),a.comment&&a.comment.length||$(".annotator-edit-container").hide(),a.color||a.shared){$(".annotator-editor").removeClass("hide-note");var O,P,Q=$(G).find("textarea").prop("scrollHeight");P=$(G).find("textarea").height(),$(G).find("textarea").height(Q),O=$(G).position().top,pos=Q-P+O,$(G).css({top:pos})}s=a.shared,t=!1,a.shared?$(".annotator-share").addClass("on"):$(".annotator-share").removeClass("on"),$(".annotator-item input").length||$(".annotator-item").prepend('<div class="noteContainer" id = "noteContainer" style="height:100px;"></div>'),$(".annotator-color").removeClass("active"),a.shared||$("#color-button-"+a.color).addClass("active"),q=a.color,r=$("#color-button-"+a.color).val(),$(G).find(".annotator-save").addClass(E.focus),$(G).find(".annotator-listing .characters-left").remove(),$("#note-text-area").val(a.comment),$("#letter-count").text(3e3-$(G).find("textarea").val().length),F=$("#note-text-area")[0].scrollHeight||40,a.comment&&a.comment.length||($(G).find("textarea").css({"pointer-events":"all",opacity:"1"}),$(G).find("input").css({"pointer-events":"all",opacity:"1"})),$(G).find(":input:first").focus(),$(G).find("textarea").val().length>0?($($(G)).find("#noteContainer").html($(G).find("textarea").val()),$($(G).find("textarea")).hide(),$($(G)).find("#noteContainer").show()):($($(G).find("textarea")).show(),$($(G)).find("#noteContainer").hide());var R=$("#annotator-outer-id").position().top+$("#annotator-outer-id").find("form").height()-$("#annotator-outer-id").find(".annotator-panel-1").height();$("#annotator-outer-id").css({top:R}),u=!1,H=!0,document.getElementById("share-text").innerHTML=B.messages.share,document.getElementById("save-annotation").innerHTML=B.messages.save,d(),$(G).find(".annotator-share-text, .annotator-share").hide(),2==I&&a.shared?($(G).removeClass("show-edit-options"),$(G).find(".characters-left").css({visibility:"hidden"}),$("#color-button-yellow").prop("disabled",!0),$("#color-button-green").prop("disabled",!0),$("#color-button-pink").prop("disabled",!0),$("#color-button-yellow").css({background:"#fff1c1"}),$("#color-button-green").css({background:"#CCF5C8"}),$("#color-button-pink").css({background:"#FEDEF0"}),$(".annotator-edit-container").hide(),$(".annotator-delete-container").hide()):a.shared&&($("#color-button-yellow").prop("disabled",!0),$("#color-button-green").prop("disabled",!0),$("#color-button-pink").prop("disabled",!0),$("#color-button-yellow").css({background:"#fff1c1"}),$("#color-button-green").css({background:"#CCF5C8"}),$("#color-button-pink").css({background:"#FEDEF0"}))}var p,q,r,s,t,u,v,w,x,y='<div class="annotator-panel-1 annotator-panel-triangle"><div class="annotator-color-container"><input id="color-button-yellow" type="button" class="annotator-color annotator-yellow" value="#FFD232"/><input id="color-button-green" type="button" class="annotator-color annotator-green" value="#55DF49"/><input id="color-button-pink" type="button" class="annotator-color annotator-pink" value="#FC92CF"/></div><div id="deleteIcon" class="annotator-delete-container"></div><div id="editIcon" class="annotator-edit-container"></div></div>',z='<div class="annotator-panel-2"><ul class="annotator-listing"><li class="annotator-item"><textarea maxlength="3000" id="note-text-area" placeholder="Write a note." style="pointer-events: all; opacity: 1; max-height:75px; min-height:75px; resize:none"></textarea></li></ul></div>',A='<div class="annotator-panel-3"><div class="annotator-controls"><div class="ann-share-section"><label id="share-text" class="annotator-share-text">Share</label><div id="ann-share" class="annotator-share"></div></div><div class="ann-cancelsave-section"><a id="cancel-saving" class="annotator-cancel">CANCEL</a><a id="save-annotation" class="annotator-save annotator-focus">SAVE</a></div></div></div>',B='<div class="annotator-panel-4 annotator-panel-triangle"><div class="ann-confirm-section"><label id="label-confirm" class="annotator-confirm">Confirm?</label></div><div class="ann-canceldelete-section"><a id="ann-confirm-cancel" class="annotator-confirm-cancel">CANCEL</a><a id="ann-confirm-del" class="annotator-confirm-delete">DELETE</a></div></div></div>',C='<div id="annotator-outer-id" class="annotator-outer annotator-editor hide-note"><form id="highlight-note-form" class="annotator-widget">'+y+z+A+"</form></div>",D={},E={hide:"annotator-hide",focus:"annotator-focus"},F=null,G="#openPopupHighlight",H=!1,I=0,J=0;return{showCreateHighlightPopup:b,init:a,showSelectedHighlight:o,setCurrentHighlight:j}}();